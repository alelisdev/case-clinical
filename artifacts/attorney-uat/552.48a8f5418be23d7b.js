"use strict";(self.webpackChunkattorney=self.webpackChunkattorney||[]).push([[552],{31552:(L,p,n)=>{n.r(p),n.d(p,{FirmRegisterModule:()=>I});var g=n(36895),u=n(30144),T=n(34643),C=n(57267),f=n(70655),h=n(24280),D=n(54004),v=n(18505),x=n(63900),e=n(94650),S=n(73602);let b=(()=>{class s extends h.m1{constructor(t,r,a){super({loading:!1}),this.data=t,this.router=r,this.route=a,this.errors$=this.select(i=>i.errors),this.loading$=this.select(i=>i.loading),this.item$=this.select(i=>i.item),this.firmStatuses$=this.select(i=>i.firmStatuses||[]),this.documents$=this.select(i=>i.documents||[]),this.vm$=this.select(this.errors$,this.loading$,this.item$,this.firmStatuses$,this.documents$,(i,o,c,l,d)=>({errors:i,loading:o,item:c,firmStatuses:l,documents:d}),{debounce:!0}),this.filterFirmStatuses=i=>this.data.userFirmStatuses({input:{name:i}}).pipe((0,h._b)(o=>{let c=o.data.items;return this.patchState({firmStatuses:c}),c},o=>this.patchState({errors:o.graphQLErrors?o.graphQLErrors:o})),(0,D.U)(o=>o.data.items)),this.addFirmStatus=this.updater((i,o)=>Object.assign(Object.assign({},i),{firmStatuses:i.firmStatuses.concat(o)})),this.addDocument=this.updater((i,o)=>Object.assign(Object.assign({},i),{documents:i.documents.concat(o)})),this.createFirmEffect=this.effect(i=>i.pipe((0,v.b)(()=>this.patchState({loading:!0})),(0,x.w)(o=>this.data.userCreateFirm({input:o}).pipe((0,h._b)(c=>{var l,d;return this.patchState({item:c.data.created,errors:c.errors,loading:!1}),this.router.navigate(["..",null===(d=null===(l=c.data)||void 0===l?void 0:l.created)||void 0===d?void 0:d.id],{relativeTo:this.route})},c=>this.patchState({loading:!1,errors:c.graphQLErrors?c.graphQLErrors:c}))))))}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(S.q),e.LFG(u.F0),e.LFG(u.gz))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();var w=n(12138),y=n(61135),$=n(80529),V=n(71873),O=n(34077);function N(s,m){if(1&s){const t=e.EpF();e.TgZ(0,"div",8)(1,"ui-button",9),e.NdJ("click",function(a){e.CHM(t);const i=e.oxw(2);return e.KtG(i.handleDiscardClick(a))}),e.qZA()()}}function W(s,m){if(1&s&&e._UZ(0,"ui-card-header",10),2&s){e.oxw();const t=e.MAs(4);e.Q6J("title","Create New")("controlsTemplate",t)}}function E(s,m){1&s&&(e.TgZ(0,"div",11),e.GkF(1),e.qZA())}function M(s,m){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,N,2,0,"ng-template",null,3,e.W1O),e.YNc(5,W,1,2,"ng-template",null,4,e.W1O),e.YNc(7,E,2,0,"ng-template",null,5,e.W1O),e.TgZ(9,"ui-panel",6)(10,"ui-form",7),e.NdJ("submitForm",function(a){e.CHM(t);const i=e.oxw();return e.KtG(i.createIntake(a))}),e.qZA()()()(),e.BQk()}if(2&s){const t=e.MAs(6),r=e.MAs(8),a=e.oxw();e.xp6(9),e.Q6J("headerTemplate",t)("footerTemplate",r),e.xp6(1),e.Q6J("fields",a.steps)("model",a.model)("options",a.options)}}let A=(()=>{class s{constructor(t,r,a,i,o,c){this.store=t,this.data=r,this.router=a,this.route=i,this.http=o,this.toast=c,this.vm$=this.store.vm$,this.firmStatuses$=this.store.firmStatuses$,this.pageTitle="Register",this.signatureDoc="",this.signatureDoc$=new y.X(this.signatureDoc),this.errors=null,this.canProgress=!1,this.alert={type:"success",message:""},this.showAlert=!1,this.model={},this.options={formState:{mainModel:this.model}},this.fields=[{key:"registrantSignature",type:"file-viewer",templateOptions:{label:"Please Sign",document$:this.signatureDoc$,signatureBoxName:"txSign",ownerName:"PCH",signerName:"",signerInitials:"",documentSubmit:l=>{console.log("signature",l)}},hooks:{afterViewChecked:()=>{setTimeout(()=>{console.log("in the afterViewChecked",TXDocumentViewer),this.GetTemplate("EULA")},100)},onDestroy:()=>{null!==document.getElementById("txViewer")&&typeof TXDocumentViewer<"u"&&(console.log("in the destroy",TXDocumentViewer),TXDocumentViewer)}}}]}ngOnDestroy(){null!==document.getElementById("txViewer")&&typeof TXDocumentViewer<"u"&&(console.log("in the destroy",TXDocumentViewer),TXDocumentViewer)}handleDiscardClick(t){t?.preventDefault(),this.router.navigate([".."],{relativeTo:this.route})}createFirm(t){""!=this.parentFirmStatusId&&(t=Object.assign(Object.assign({},t),{firmStatusId:this.parentFirmStatusId})),this.store.createFirmEffect(t)}submit(){return(0,f.mG)(this,void 0,void 0,function*(){yield this.register(this.model)})}register(t){return(0,f.mG)(this,void 0,void 0,function*(){const{name:r}=t;this.model.eula.name=""===r||null==r?"Firm EULA":r+"Firm EULA",yield this.store.createFirmEffect(t)})}checkDocumentViewer(){null!==TXDocumentViewer&&(console.log("hit the check"),TXDocumentViewer.init({containerID:"txViewer",viewerSettings:{signatureSettings:this.GetSignatureSettingsForUser(),userNames:[],dock:1,documentData:this.signatureDoc,documentPath:"test.docx",toolbarDocked:!0,isSelectionActivated:!0,showThumbnailPane:!0,resources:null,basePath:"https://documentserver.caseclinical.com:443/MemberOnboarding"}}),TXDocumentViewer.setSubmitCallback(this.documentSubmit.bind(this)))}documentSubmit(t){console.log("hit the submit"),this.http.post("https://documentserver.caseclinical.com:443/MemberOnboarding/DownloadPdf",{document:t.document}).subscribe(a=>{let i={name:this.model.name,encoding:"PDF",attachment:a.document,extension:".pdf"};return this.toast.success("Signature received, move to next step"),this.toggleProgress(!0),this.model.eula=i})}GetSignatureSettingsForUser(){var t;return{ownerName:"PCH",signatureBoxName:"txSign",signerName:null===(t=this.model)||void 0===t?void 0:t.name,signerInitials:"",showSignatureBar:!0}}GetTemplate(t){return this.data.userTemplate({templateId:t}).pipe((0,h._b)(r=>{console.log(r.data),this.signatureDoc=r.data.item.attachment},r=>console.log(r)),(0,v.b)(r=>this.http.post("https://documentserver.caseclinical.com:443/MemberOnboarding/MergeRawStringDocument",{data:JSON.stringify(this.model),template:this.signatureDoc}).subscribe(i=>{let o=i.document;return this.signatureDoc=o,this.signatureDoc$.next(this.signatureDoc),this.checkDocumentViewer(),this.toggleProgress(!1),o}))).subscribe()}toggleProgress(t){this.canProgress=t}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(b),e.Y36(S.q),e.Y36(u.F0),e.Y36(u.gz),e.Y36($.eN),e.Y36(V.F))},s.\u0275cmp=e.Xpm({type:s,selectors:[["ng-component"]],features:[e._Bn([b,{provide:w.gx,useValue:{showError:!0}}])],decls:2,vars:3,consts:[[4,"ngIf"],[1,"inset-0","absolute","overflow-y-auto"],[1,"p-2","md:p-4"],["controlsTemplate",""],["headerTemplate",""],["footerTemplate",""],[1,"",3,"headerTemplate","footerTemplate"],[3,"fields","model","options","submitForm"],[1,"px-6","space-x-3"],["label","Discard","variant","white",3,"click"],[3,"title","controlsTemplate"],[1,"flex","items-center","justify-end","pt-3","pb-6","dark:bg-transparent"]],template:function(t,r){1&t&&(e.YNc(0,M,11,5,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,r.vm$))},dependencies:[g.O5,O.a,g.Ov],encapsulation:2}),s})();var P=n(19859),X=n(70383),F=n(24006);const G=[{path:"",component:A}];let I=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[g.ez,P.t,F.u5,F.UX,X.L,u.Bz.forChild(G),C.I,T.z]}),s})()}}]);
(function(m,ie){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=m.document?ie(m,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return ie(a)}:ie(m)})(typeof window<"u"?window:this,function(m,ie){"use strict";var a=[],R=Object.getPrototypeOf,I=a.slice,E=a.flat?function(O){return a.flat.call(O)}:function(O){return a.concat.apply([],O)},_=a.push,d=a.indexOf,u={},g=u.toString,f=u.hasOwnProperty,v=f.toString,c=v.call(Object),i={},r=function(q){return"function"==typeof q&&"number"!=typeof q.nodeType&&"function"!=typeof q.item},s=function(q){return null!=q&&q===q.window},t=m.document,n={type:!0,src:!0,nonce:!0,noModule:!0};function o(O,q,Z){var re,de,fe=(Z=Z||t).createElement("script");if(fe.text=O,q)for(re in n)(de=q[re]||q.getAttribute&&q.getAttribute(re))&&fe.setAttribute(re,de);Z.head.appendChild(fe).parentNode.removeChild(fe)}function h(O){return null==O?O+"":"object"==typeof O||"function"==typeof O?u[g.call(O)]||"object":typeof O}var l="3.6.0",e=function(O,q){return new e.fn.init(O,q)};function p(O){var q=!!O&&"length"in O&&O.length,Z=h(O);return!r(O)&&!s(O)&&("array"===Z||0===q||"number"==typeof q&&q>0&&q-1 in O)}e.fn=e.prototype={jquery:l,constructor:e,length:0,toArray:function(){return I.call(this)},get:function(O){return null==O?I.call(this):O<0?this[O+this.length]:this[O]},pushStack:function(O){var q=e.merge(this.constructor(),O);return q.prevObject=this,q},each:function(O){return e.each(this,O)},map:function(O){return this.pushStack(e.map(this,function(q,Z){return O.call(q,Z,q)}))},slice:function(){return this.pushStack(I.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(e.grep(this,function(O,q){return(q+1)%2}))},odd:function(){return this.pushStack(e.grep(this,function(O,q){return q%2}))},eq:function(O){var q=this.length,Z=+O+(O<0?q:0);return this.pushStack(Z>=0&&Z<q?[this[Z]]:[])},end:function(){return this.prevObject||this.constructor()},push:_,sort:a.sort,splice:a.splice},e.extend=e.fn.extend=function(){var O,q,Z,re,de,fe,ve=arguments[0]||{},Te=1,Re=arguments.length,ke=!1;for("boolean"==typeof ve&&(ke=ve,ve=arguments[Te]||{},Te++),"object"!=typeof ve&&!r(ve)&&(ve={}),Te===Re&&(ve=this,Te--);Te<Re;Te++)if(null!=(O=arguments[Te]))for(q in O)re=O[q],"__proto__"!==q&&ve!==re&&(ke&&re&&(e.isPlainObject(re)||(de=Array.isArray(re)))?(Z=ve[q],fe=de&&!Array.isArray(Z)?[]:de||e.isPlainObject(Z)?Z:{},de=!1,ve[q]=e.extend(ke,fe,re)):void 0!==re&&(ve[q]=re));return ve},e.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(O){throw new Error(O)},noop:function(){},isPlainObject:function(O){var q,Z;return!(!O||"[object Object]"!==g.call(O)||(q=R(O))&&("function"!=typeof(Z=f.call(q,"constructor")&&q.constructor)||v.call(Z)!==c))},isEmptyObject:function(O){var q;for(q in O)return!1;return!0},globalEval:function(O,q,Z){o(O,{nonce:q&&q.nonce},Z)},each:function(O,q){var Z,re=0;if(p(O))for(Z=O.length;re<Z&&!1!==q.call(O[re],re,O[re]);re++);else for(re in O)if(!1===q.call(O[re],re,O[re]))break;return O},makeArray:function(O,q){var Z=q||[];return null!=O&&(p(Object(O))?e.merge(Z,"string"==typeof O?[O]:O):_.call(Z,O)),Z},inArray:function(O,q,Z){return null==q?-1:d.call(q,O,Z)},merge:function(O,q){for(var Z=+q.length,re=0,de=O.length;re<Z;re++)O[de++]=q[re];return O.length=de,O},grep:function(O,q,Z){for(var de=[],fe=0,ve=O.length,Te=!Z;fe<ve;fe++)!q(O[fe],fe)!==Te&&de.push(O[fe]);return de},map:function(O,q,Z){var re,de,fe=0,ve=[];if(p(O))for(re=O.length;fe<re;fe++)null!=(de=q(O[fe],fe,Z))&&ve.push(de);else for(fe in O)null!=(de=q(O[fe],fe,Z))&&ve.push(de);return E(ve)},guid:1,support:i}),"function"==typeof Symbol&&(e.fn[Symbol.iterator]=a[Symbol.iterator]),e.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(O,q){u["[object "+q+"]"]=q.toLowerCase()});var b=
/*!
     * Sizzle CSS Selector Engine v2.3.6
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://js.foundation/
     *
     * Date: 2021-02-16
     */function(O){var q,Z,re,de,fe,ve,Te,Re,ke,Le,ze,xe,Ke,ot,vt,at,Dt,Pt,jt,wt="sizzle"+1*new Date,ht=O.document,Ut=0,_t=0,kt=Nn(),Mn=Nn(),Pn=Nn(),Kt=Nn(),mn=function(ye,we){return ye===we&&(ze=!0),0},yn={}.hasOwnProperty,Ft=[],hn=Ft.pop,Gt=Ft.push,pn=Ft.push,di=Ft.slice,bn=function(ye,we){for(var Me=0,$e=ye.length;Me<$e;Me++)if(ye[Me]===we)return Me;return-1},Gn="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Et="[\\x20\\t\\r\\n\\f]",_n="(?:\\\\[\\da-fA-F]{1,6}"+Et+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",ui="\\["+Et+"*("+_n+")(?:"+Et+"*([*^$|!~]?=)"+Et+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+_n+"))|)"+Et+"*\\]",qn=":("+_n+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ui+")*)|.*)\\)|)",Ui=new RegExp(Et+"+","g"),Dn=new RegExp("^"+Et+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Et+"+$","g"),Fi=new RegExp("^"+Et+"*,"+Et+"*"),fi=new RegExp("^"+Et+"*([>+~]|"+Et+")"+Et+"*"),ji=new RegExp(Et+"|>"),Ki=new RegExp(qn),$i=new RegExp("^"+_n+"$"),xn={ID:new RegExp("^#("+_n+")"),CLASS:new RegExp("^\\.("+_n+")"),TAG:new RegExp("^("+_n+"|[*])"),ATTR:new RegExp("^"+ui),PSEUDO:new RegExp("^"+qn),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Et+"*(even|odd|(([+-]|)(\\d*)n|)"+Et+"*(?:([+-]|)"+Et+"*(\\d+)|))"+Et+"*\\)|)","i"),bool:new RegExp("^(?:"+Gn+")$","i"),needsContext:new RegExp("^"+Et+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Et+"*((?:-\\d)?\\d*)"+Et+"*\\)|)(?=[^-]|$)","i")},Hi=/HTML$/i,Vi=/^(?:input|select|textarea|button)$/i,Wi=/^h\d$/i,An=/^[^{]+\{\s*\[native \w/,Gi=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,zn=/[+~]/,un=new RegExp("\\\\[\\da-fA-F]{1,6}"+Et+"?|\\\\([^\\r\\n\\f])","g"),fn=function(ye,we){var Me="0x"+ye.slice(1)-65536;return we||(Me<0?String.fromCharCode(Me+65536):String.fromCharCode(Me>>10|55296,1023&Me|56320))},hi=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,pi=function(ye,we){return we?"\0"===ye?"\ufffd":ye.slice(0,-1)+"\\"+ye.charCodeAt(ye.length-1).toString(16)+" ":"\\"+ye},gi=function(){xe()},qi=Bn(function(ye){return!0===ye.disabled&&"fieldset"===ye.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{pn.apply(Ft=di.call(ht.childNodes),ht.childNodes)}catch{pn={apply:Ft.length?function(we,Me){Gt.apply(we,di.call(Me))}:function(we,Me){for(var $e=we.length,Oe=0;we[$e++]=Me[Oe++];);we.length=$e-1}}}function Rt(ye,we,Me,$e){var Oe,We,Ye,Xe,Ze,lt,ct,ut=we&&we.ownerDocument,bt=we?we.nodeType:9;if(Me=Me||[],"string"!=typeof ye||!ye||1!==bt&&9!==bt&&11!==bt)return Me;if(!$e&&(xe(we),we=we||Ke,vt)){if(11!==bt&&(Ze=Gi.exec(ye)))if(Oe=Ze[1]){if(9===bt){if(!(Ye=we.getElementById(Oe)))return Me;if(Ye.id===Oe)return Me.push(Ye),Me}else if(ut&&(Ye=ut.getElementById(Oe))&&jt(we,Ye)&&Ye.id===Oe)return Me.push(Ye),Me}else{if(Ze[2])return pn.apply(Me,we.getElementsByTagName(ye)),Me;if((Oe=Ze[3])&&Z.getElementsByClassName&&we.getElementsByClassName)return pn.apply(Me,we.getElementsByClassName(Oe)),Me}if(Z.qsa&&!Kt[ye+" "]&&(!at||!at.test(ye))&&(1!==bt||"object"!==we.nodeName.toLowerCase())){if(ct=ye,ut=we,1===bt&&(ji.test(ye)||fi.test(ye))){for(((ut=zn.test(ye)&&Jn(we.parentNode)||we)!==we||!Z.scope)&&((Xe=we.getAttribute("id"))?Xe=Xe.replace(hi,pi):we.setAttribute("id",Xe=wt)),We=(lt=ve(ye)).length;We--;)lt[We]=(Xe?"#"+Xe:":scope")+" "+Ln(lt[We]);ct=lt.join(",")}try{return pn.apply(Me,ut.querySelectorAll(ct)),Me}catch{Kt(ye,!0)}finally{Xe===wt&&we.removeAttribute("id")}}}return Re(ye.replace(Dn,"$1"),we,Me,$e)}function Nn(){var ye=[];return function we(Me,$e){return ye.push(Me+" ")>re.cacheLength&&delete we[ye.shift()],we[Me+" "]=$e}}function Xt(ye){return ye[wt]=!0,ye}function Zt(ye){var we=Ke.createElement("fieldset");try{return!!ye(we)}catch{return!1}finally{we.parentNode&&we.parentNode.removeChild(we),we=null}}function Yn(ye,we){for(var Me=ye.split("|"),$e=Me.length;$e--;)re.attrHandle[Me[$e]]=we}function vi(ye,we){var Me=we&&ye,$e=Me&&1===ye.nodeType&&1===we.nodeType&&ye.sourceIndex-we.sourceIndex;if($e)return $e;if(Me)for(;Me=Me.nextSibling;)if(Me===we)return-1;return ye?1:-1}function zi(ye){return function(we){return"input"===we.nodeName.toLowerCase()&&we.type===ye}}function Yi(ye){return function(we){var Me=we.nodeName.toLowerCase();return("input"===Me||"button"===Me)&&we.type===ye}}function mi(ye){return function(we){return"form"in we?we.parentNode&&!1===we.disabled?"label"in we?"label"in we.parentNode?we.parentNode.disabled===ye:we.disabled===ye:we.isDisabled===ye||we.isDisabled!==!ye&&qi(we)===ye:we.disabled===ye:"label"in we&&we.disabled===ye}}function Sn(ye){return Xt(function(we){return we=+we,Xt(function(Me,$e){for(var Oe,We=ye([],Me.length,we),Ye=We.length;Ye--;)Me[Oe=We[Ye]]&&(Me[Oe]=!($e[Oe]=Me[Oe]))})})}function Jn(ye){return ye&&typeof ye.getElementsByTagName<"u"&&ye}for(q in Z=Rt.support={},fe=Rt.isXML=function(ye){var Me=ye&&(ye.ownerDocument||ye).documentElement;return!Hi.test(ye&&ye.namespaceURI||Me&&Me.nodeName||"HTML")},xe=Rt.setDocument=function(ye){var we,Me,$e=ye?ye.ownerDocument||ye:ht;return $e==Ke||9!==$e.nodeType||!$e.documentElement||(ot=(Ke=$e).documentElement,vt=!fe(Ke),ht!=Ke&&(Me=Ke.defaultView)&&Me.top!==Me&&(Me.addEventListener?Me.addEventListener("unload",gi,!1):Me.attachEvent&&Me.attachEvent("onunload",gi)),Z.scope=Zt(function(Oe){return ot.appendChild(Oe).appendChild(Ke.createElement("div")),typeof Oe.querySelectorAll<"u"&&!Oe.querySelectorAll(":scope fieldset div").length}),Z.attributes=Zt(function(Oe){return Oe.className="i",!Oe.getAttribute("className")}),Z.getElementsByTagName=Zt(function(Oe){return Oe.appendChild(Ke.createComment("")),!Oe.getElementsByTagName("*").length}),Z.getElementsByClassName=An.test(Ke.getElementsByClassName),Z.getById=Zt(function(Oe){return ot.appendChild(Oe).id=wt,!Ke.getElementsByName||!Ke.getElementsByName(wt).length}),Z.getById?(re.filter.ID=function(Oe){var We=Oe.replace(un,fn);return function(Ye){return Ye.getAttribute("id")===We}},re.find.ID=function(Oe,We){if(typeof We.getElementById<"u"&&vt){var Ye=We.getElementById(Oe);return Ye?[Ye]:[]}}):(re.filter.ID=function(Oe){var We=Oe.replace(un,fn);return function(Ye){var Xe=typeof Ye.getAttributeNode<"u"&&Ye.getAttributeNode("id");return Xe&&Xe.value===We}},re.find.ID=function(Oe,We){if(typeof We.getElementById<"u"&&vt){var Ye,Xe,Ze,lt=We.getElementById(Oe);if(lt){if((Ye=lt.getAttributeNode("id"))&&Ye.value===Oe)return[lt];for(Ze=We.getElementsByName(Oe),Xe=0;lt=Ze[Xe++];)if((Ye=lt.getAttributeNode("id"))&&Ye.value===Oe)return[lt]}return[]}}),re.find.TAG=Z.getElementsByTagName?function(Oe,We){return typeof We.getElementsByTagName<"u"?We.getElementsByTagName(Oe):Z.qsa?We.querySelectorAll(Oe):void 0}:function(Oe,We){var Ye,Xe=[],Ze=0,lt=We.getElementsByTagName(Oe);if("*"===Oe){for(;Ye=lt[Ze++];)1===Ye.nodeType&&Xe.push(Ye);return Xe}return lt},re.find.CLASS=Z.getElementsByClassName&&function(Oe,We){if(typeof We.getElementsByClassName<"u"&&vt)return We.getElementsByClassName(Oe)},Dt=[],at=[],(Z.qsa=An.test(Ke.querySelectorAll))&&(Zt(function(Oe){var We;ot.appendChild(Oe).innerHTML="<a id='"+wt+"'></a><select id='"+wt+"-\r\\' msallowcapture=''><option selected=''></option></select>",Oe.querySelectorAll("[msallowcapture^='']").length&&at.push("[*^$]="+Et+"*(?:''|\"\")"),Oe.querySelectorAll("[selected]").length||at.push("\\["+Et+"*(?:value|"+Gn+")"),Oe.querySelectorAll("[id~="+wt+"-]").length||at.push("~="),(We=Ke.createElement("input")).setAttribute("name",""),Oe.appendChild(We),Oe.querySelectorAll("[name='']").length||at.push("\\["+Et+"*name"+Et+"*="+Et+"*(?:''|\"\")"),Oe.querySelectorAll(":checked").length||at.push(":checked"),Oe.querySelectorAll("a#"+wt+"+*").length||at.push(".#.+[+~]"),Oe.querySelectorAll("\\\f"),at.push("[\\r\\n\\f]")}),Zt(function(Oe){Oe.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var We=Ke.createElement("input");We.setAttribute("type","hidden"),Oe.appendChild(We).setAttribute("name","D"),Oe.querySelectorAll("[name=d]").length&&at.push("name"+Et+"*[*^$|!~]?="),2!==Oe.querySelectorAll(":enabled").length&&at.push(":enabled",":disabled"),ot.appendChild(Oe).disabled=!0,2!==Oe.querySelectorAll(":disabled").length&&at.push(":enabled",":disabled"),Oe.querySelectorAll("*,:x"),at.push(",.*:")})),(Z.matchesSelector=An.test(Pt=ot.matches||ot.webkitMatchesSelector||ot.mozMatchesSelector||ot.oMatchesSelector||ot.msMatchesSelector))&&Zt(function(Oe){Z.disconnectedMatch=Pt.call(Oe,"*"),Pt.call(Oe,"[s!='']:x"),Dt.push("!=",qn)}),at=at.length&&new RegExp(at.join("|")),Dt=Dt.length&&new RegExp(Dt.join("|")),we=An.test(ot.compareDocumentPosition),jt=we||An.test(ot.contains)?function(Oe,We){var Ye=9===Oe.nodeType?Oe.documentElement:Oe,Xe=We&&We.parentNode;return Oe===Xe||!(!Xe||1!==Xe.nodeType||!(Ye.contains?Ye.contains(Xe):Oe.compareDocumentPosition&&16&Oe.compareDocumentPosition(Xe)))}:function(Oe,We){if(We)for(;We=We.parentNode;)if(We===Oe)return!0;return!1},mn=we?function(Oe,We){if(Oe===We)return ze=!0,0;var Ye=!Oe.compareDocumentPosition-!We.compareDocumentPosition;return Ye||(1&(Ye=(Oe.ownerDocument||Oe)==(We.ownerDocument||We)?Oe.compareDocumentPosition(We):1)||!Z.sortDetached&&We.compareDocumentPosition(Oe)===Ye?Oe==Ke||Oe.ownerDocument==ht&&jt(ht,Oe)?-1:We==Ke||We.ownerDocument==ht&&jt(ht,We)?1:Le?bn(Le,Oe)-bn(Le,We):0:4&Ye?-1:1)}:function(Oe,We){if(Oe===We)return ze=!0,0;var Ye,Xe=0,Ze=Oe.parentNode,lt=We.parentNode,ct=[Oe],ut=[We];if(!Ze||!lt)return Oe==Ke?-1:We==Ke?1:Ze?-1:lt?1:Le?bn(Le,Oe)-bn(Le,We):0;if(Ze===lt)return vi(Oe,We);for(Ye=Oe;Ye=Ye.parentNode;)ct.unshift(Ye);for(Ye=We;Ye=Ye.parentNode;)ut.unshift(Ye);for(;ct[Xe]===ut[Xe];)Xe++;return Xe?vi(ct[Xe],ut[Xe]):ct[Xe]==ht?-1:ut[Xe]==ht?1:0}),Ke},Rt.matches=function(ye,we){return Rt(ye,null,null,we)},Rt.matchesSelector=function(ye,we){if(xe(ye),Z.matchesSelector&&vt&&!Kt[we+" "]&&(!Dt||!Dt.test(we))&&(!at||!at.test(we)))try{var Me=Pt.call(ye,we);if(Me||Z.disconnectedMatch||ye.document&&11!==ye.document.nodeType)return Me}catch{Kt(we,!0)}return Rt(we,Ke,null,[ye]).length>0},Rt.contains=function(ye,we){return(ye.ownerDocument||ye)!=Ke&&xe(ye),jt(ye,we)},Rt.attr=function(ye,we){(ye.ownerDocument||ye)!=Ke&&xe(ye);var Me=re.attrHandle[we.toLowerCase()],$e=Me&&yn.call(re.attrHandle,we.toLowerCase())?Me(ye,we,!vt):void 0;return void 0!==$e?$e:Z.attributes||!vt?ye.getAttribute(we):($e=ye.getAttributeNode(we))&&$e.specified?$e.value:null},Rt.escape=function(ye){return(ye+"").replace(hi,pi)},Rt.error=function(ye){throw new Error("Syntax error, unrecognized expression: "+ye)},Rt.uniqueSort=function(ye){var we,Me=[],$e=0,Oe=0;if(ze=!Z.detectDuplicates,Le=!Z.sortStable&&ye.slice(0),ye.sort(mn),ze){for(;we=ye[Oe++];)we===ye[Oe]&&($e=Me.push(Oe));for(;$e--;)ye.splice(Me[$e],1)}return Le=null,ye},de=Rt.getText=function(ye){var we,Me="",$e=0,Oe=ye.nodeType;if(Oe){if(1===Oe||9===Oe||11===Oe){if("string"==typeof ye.textContent)return ye.textContent;for(ye=ye.firstChild;ye;ye=ye.nextSibling)Me+=de(ye)}else if(3===Oe||4===Oe)return ye.nodeValue}else for(;we=ye[$e++];)Me+=de(we);return Me},(re=Rt.selectors={cacheLength:50,createPseudo:Xt,match:xn,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(ye){return ye[1]=ye[1].replace(un,fn),ye[3]=(ye[3]||ye[4]||ye[5]||"").replace(un,fn),"~="===ye[2]&&(ye[3]=" "+ye[3]+" "),ye.slice(0,4)},CHILD:function(ye){return ye[1]=ye[1].toLowerCase(),"nth"===ye[1].slice(0,3)?(ye[3]||Rt.error(ye[0]),ye[4]=+(ye[4]?ye[5]+(ye[6]||1):2*("even"===ye[3]||"odd"===ye[3])),ye[5]=+(ye[7]+ye[8]||"odd"===ye[3])):ye[3]&&Rt.error(ye[0]),ye},PSEUDO:function(ye){var we,Me=!ye[6]&&ye[2];return xn.CHILD.test(ye[0])?null:(ye[3]?ye[2]=ye[4]||ye[5]||"":Me&&Ki.test(Me)&&(we=ve(Me,!0))&&(we=Me.indexOf(")",Me.length-we)-Me.length)&&(ye[0]=ye[0].slice(0,we),ye[2]=Me.slice(0,we)),ye.slice(0,3))}},filter:{TAG:function(ye){var we=ye.replace(un,fn).toLowerCase();return"*"===ye?function(){return!0}:function(Me){return Me.nodeName&&Me.nodeName.toLowerCase()===we}},CLASS:function(ye){var we=kt[ye+" "];return we||(we=new RegExp("(^|"+Et+")"+ye+"("+Et+"|$)"))&&kt(ye,function(Me){return we.test("string"==typeof Me.className&&Me.className||typeof Me.getAttribute<"u"&&Me.getAttribute("class")||"")})},ATTR:function(ye,we,Me){return function($e){var Oe=Rt.attr($e,ye);return null==Oe?"!="===we:!we||(Oe+="","="===we?Oe===Me:"!="===we?Oe!==Me:"^="===we?Me&&0===Oe.indexOf(Me):"*="===we?Me&&Oe.indexOf(Me)>-1:"$="===we?Me&&Oe.slice(-Me.length)===Me:"~="===we?(" "+Oe.replace(Ui," ")+" ").indexOf(Me)>-1:"|="===we&&(Oe===Me||Oe.slice(0,Me.length+1)===Me+"-"))}},CHILD:function(ye,we,Me,$e,Oe){var We="nth"!==ye.slice(0,3),Ye="last"!==ye.slice(-4),Xe="of-type"===we;return 1===$e&&0===Oe?function(Ze){return!!Ze.parentNode}:function(Ze,lt,ct){var ut,bt,It,dt,xt,Lt,$t=We!==Ye?"nextSibling":"previousSibling",At=Ze.parentNode,kn=Xe&&Ze.nodeName.toLowerCase(),On=!ct&&!Xe,Ht=!1;if(At){if(We){for(;$t;){for(dt=Ze;dt=dt[$t];)if(Xe?dt.nodeName.toLowerCase()===kn:1===dt.nodeType)return!1;Lt=$t="only"===ye&&!Lt&&"nextSibling"}return!0}if(Lt=[Ye?At.firstChild:At.lastChild],Ye&&On){for(Ht=(xt=(ut=(bt=(It=(dt=At)[wt]||(dt[wt]={}))[dt.uniqueID]||(It[dt.uniqueID]={}))[ye]||[])[0]===Ut&&ut[1])&&ut[2],dt=xt&&At.childNodes[xt];dt=++xt&&dt&&dt[$t]||(Ht=xt=0)||Lt.pop();)if(1===dt.nodeType&&++Ht&&dt===Ze){bt[ye]=[Ut,xt,Ht];break}}else if(On&&(Ht=xt=(ut=(bt=(It=(dt=Ze)[wt]||(dt[wt]={}))[dt.uniqueID]||(It[dt.uniqueID]={}))[ye]||[])[0]===Ut&&ut[1]),!1===Ht)for(;(dt=++xt&&dt&&dt[$t]||(Ht=xt=0)||Lt.pop())&&((Xe?dt.nodeName.toLowerCase()!==kn:1!==dt.nodeType)||!++Ht||(On&&((bt=(It=dt[wt]||(dt[wt]={}))[dt.uniqueID]||(It[dt.uniqueID]={}))[ye]=[Ut,Ht]),dt!==Ze)););return(Ht-=Oe)===$e||Ht%$e==0&&Ht/$e>=0}}},PSEUDO:function(ye,we){var Me,$e=re.pseudos[ye]||re.setFilters[ye.toLowerCase()]||Rt.error("unsupported pseudo: "+ye);return $e[wt]?$e(we):$e.length>1?(Me=[ye,ye,"",we],re.setFilters.hasOwnProperty(ye.toLowerCase())?Xt(function(Oe,We){for(var Ye,Xe=$e(Oe,we),Ze=Xe.length;Ze--;)Oe[Ye=bn(Oe,Xe[Ze])]=!(We[Ye]=Xe[Ze])}):function(Oe){return $e(Oe,0,Me)}):$e}},pseudos:{not:Xt(function(ye){var we=[],Me=[],$e=Te(ye.replace(Dn,"$1"));return $e[wt]?Xt(function(Oe,We,Ye,Xe){for(var Ze,lt=$e(Oe,null,Xe,[]),ct=Oe.length;ct--;)(Ze=lt[ct])&&(Oe[ct]=!(We[ct]=Ze))}):function(Oe,We,Ye){return we[0]=Oe,$e(we,null,Ye,Me),we[0]=null,!Me.pop()}}),has:Xt(function(ye){return function(we){return Rt(ye,we).length>0}}),contains:Xt(function(ye){return ye=ye.replace(un,fn),function(we){return(we.textContent||de(we)).indexOf(ye)>-1}}),lang:Xt(function(ye){return $i.test(ye||"")||Rt.error("unsupported lang: "+ye),ye=ye.replace(un,fn).toLowerCase(),function(we){var Me;do{if(Me=vt?we.lang:we.getAttribute("xml:lang")||we.getAttribute("lang"))return(Me=Me.toLowerCase())===ye||0===Me.indexOf(ye+"-")}while((we=we.parentNode)&&1===we.nodeType);return!1}}),target:function(ye){var we=O.location&&O.location.hash;return we&&we.slice(1)===ye.id},root:function(ye){return ye===ot},focus:function(ye){return ye===Ke.activeElement&&(!Ke.hasFocus||Ke.hasFocus())&&!!(ye.type||ye.href||~ye.tabIndex)},enabled:mi(!1),disabled:mi(!0),checked:function(ye){var we=ye.nodeName.toLowerCase();return"input"===we&&!!ye.checked||"option"===we&&!!ye.selected},selected:function(ye){return!0===ye.selected},empty:function(ye){for(ye=ye.firstChild;ye;ye=ye.nextSibling)if(ye.nodeType<6)return!1;return!0},parent:function(ye){return!re.pseudos.empty(ye)},header:function(ye){return Wi.test(ye.nodeName)},input:function(ye){return Vi.test(ye.nodeName)},button:function(ye){var we=ye.nodeName.toLowerCase();return"input"===we&&"button"===ye.type||"button"===we},text:function(ye){var we;return"input"===ye.nodeName.toLowerCase()&&"text"===ye.type&&(null==(we=ye.getAttribute("type"))||"text"===we.toLowerCase())},first:Sn(function(){return[0]}),last:Sn(function(ye,we){return[we-1]}),eq:Sn(function(ye,we,Me){return[Me<0?Me+we:Me]}),even:Sn(function(ye,we){for(var Me=0;Me<we;Me+=2)ye.push(Me);return ye}),odd:Sn(function(ye,we){for(var Me=1;Me<we;Me+=2)ye.push(Me);return ye}),lt:Sn(function(ye,we,Me){for(var $e=Me<0?Me+we:Me>we?we:Me;--$e>=0;)ye.push($e);return ye}),gt:Sn(function(ye,we,Me){for(var $e=Me<0?Me+we:Me;++$e<we;)ye.push($e);return ye})}}).pseudos.nth=re.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})re.pseudos[q]=zi(q);for(q in{submit:!0,reset:!0})re.pseudos[q]=Yi(q);function yi(){}function Ln(ye){for(var we=0,Me=ye.length,$e="";we<Me;we++)$e+=ye[we].value;return $e}function Bn(ye,we,Me){var $e=we.dir,Oe=we.next,We=Oe||$e,Ye=Me&&"parentNode"===We,Xe=_t++;return we.first?function(Ze,lt,ct){for(;Ze=Ze[$e];)if(1===Ze.nodeType||Ye)return ye(Ze,lt,ct);return!1}:function(Ze,lt,ct){var ut,bt,It,dt=[Ut,Xe];if(ct){for(;Ze=Ze[$e];)if((1===Ze.nodeType||Ye)&&ye(Ze,lt,ct))return!0}else for(;Ze=Ze[$e];)if(1===Ze.nodeType||Ye)if(bt=(It=Ze[wt]||(Ze[wt]={}))[Ze.uniqueID]||(It[Ze.uniqueID]={}),Oe&&Oe===Ze.nodeName.toLowerCase())Ze=Ze[$e]||Ze;else{if((ut=bt[We])&&ut[0]===Ut&&ut[1]===Xe)return dt[2]=ut[2];if(bt[We]=dt,dt[2]=ye(Ze,lt,ct))return!0}return!1}}function Qn(ye){return ye.length>1?function(we,Me,$e){for(var Oe=ye.length;Oe--;)if(!ye[Oe](we,Me,$e))return!1;return!0}:ye[0]}function Un(ye,we,Me,$e,Oe){for(var We,Ye=[],Xe=0,Ze=ye.length,lt=null!=we;Xe<Ze;Xe++)(We=ye[Xe])&&(!Me||Me(We,$e,Oe))&&(Ye.push(We),lt&&we.push(Xe));return Ye}function Xn(ye,we,Me,$e,Oe,We){return $e&&!$e[wt]&&($e=Xn($e)),Oe&&!Oe[wt]&&(Oe=Xn(Oe,We)),Xt(function(Ye,Xe,Ze,lt){var ct,ut,bt,It=[],dt=[],xt=Xe.length,Lt=Ye||function Ji(ye,we,Me){for(var $e=0,Oe=we.length;$e<Oe;$e++)Rt(ye,we[$e],Me);return Me}(we||"*",Ze.nodeType?[Ze]:Ze,[]),$t=!ye||!Ye&&we?Lt:Un(Lt,It,ye,Ze,lt),At=Me?Oe||(Ye?ye:xt||$e)?[]:Xe:$t;if(Me&&Me($t,At,Ze,lt),$e)for(ct=Un(At,dt),$e(ct,[],Ze,lt),ut=ct.length;ut--;)(bt=ct[ut])&&(At[dt[ut]]=!($t[dt[ut]]=bt));if(Ye){if(Oe||ye){if(Oe){for(ct=[],ut=At.length;ut--;)(bt=At[ut])&&ct.push($t[ut]=bt);Oe(null,At=[],ct,lt)}for(ut=At.length;ut--;)(bt=At[ut])&&(ct=Oe?bn(Ye,bt):It[ut])>-1&&(Ye[ct]=!(Xe[ct]=bt))}}else At=Un(At===Xe?At.splice(xt,At.length):At),Oe?Oe(null,Xe,At,lt):pn.apply(Xe,At)})}function Zn(ye){for(var we,Me,$e,Oe=ye.length,We=re.relative[ye[0].type],Ye=We||re.relative[" "],Xe=We?1:0,Ze=Bn(function(ut){return ut===we},Ye,!0),lt=Bn(function(ut){return bn(we,ut)>-1},Ye,!0),ct=[function(ut,bt,It){var dt=!We&&(It||bt!==ke)||((we=bt).nodeType?Ze(ut,bt,It):lt(ut,bt,It));return we=null,dt}];Xe<Oe;Xe++)if(Me=re.relative[ye[Xe].type])ct=[Bn(Qn(ct),Me)];else{if((Me=re.filter[ye[Xe].type].apply(null,ye[Xe].matches))[wt]){for($e=++Xe;$e<Oe&&!re.relative[ye[$e].type];$e++);return Xn(Xe>1&&Qn(ct),Xe>1&&Ln(ye.slice(0,Xe-1).concat({value:" "===ye[Xe-2].type?"*":""})).replace(Dn,"$1"),Me,Xe<$e&&Zn(ye.slice(Xe,$e)),$e<Oe&&Zn(ye=ye.slice($e)),$e<Oe&&Ln(ye))}ct.push(Me)}return Qn(ct)}return yi.prototype=re.filters=re.pseudos,re.setFilters=new yi,ve=Rt.tokenize=function(ye,we){var Me,$e,Oe,We,Ye,Xe,Ze,lt=Mn[ye+" "];if(lt)return we?0:lt.slice(0);for(Ye=ye,Xe=[],Ze=re.preFilter;Ye;){for(We in(!Me||($e=Fi.exec(Ye)))&&($e&&(Ye=Ye.slice($e[0].length)||Ye),Xe.push(Oe=[])),Me=!1,($e=fi.exec(Ye))&&(Me=$e.shift(),Oe.push({value:Me,type:$e[0].replace(Dn," ")}),Ye=Ye.slice(Me.length)),re.filter)($e=xn[We].exec(Ye))&&(!Ze[We]||($e=Ze[We]($e)))&&(Me=$e.shift(),Oe.push({value:Me,type:We,matches:$e}),Ye=Ye.slice(Me.length));if(!Me)break}return we?Ye.length:Ye?Rt.error(ye):Mn(ye,Xe).slice(0)},Te=Rt.compile=function(ye,we){var Me,$e=[],Oe=[],We=Pn[ye+" "];if(!We){for(we||(we=ve(ye)),Me=we.length;Me--;)(We=Zn(we[Me]))[wt]?$e.push(We):Oe.push(We);We=Pn(ye,function Qi(ye,we){var Me=we.length>0,$e=ye.length>0,Oe=function(We,Ye,Xe,Ze,lt){var ct,ut,bt,It=0,dt="0",xt=We&&[],Lt=[],$t=ke,At=We||$e&&re.find.TAG("*",lt),kn=Ut+=null==$t?1:Math.random()||.1,On=At.length;for(lt&&(ke=Ye==Ke||Ye||lt);dt!==On&&null!=(ct=At[dt]);dt++){if($e&&ct){for(ut=0,!Ye&&ct.ownerDocument!=Ke&&(xe(ct),Xe=!vt);bt=ye[ut++];)if(bt(ct,Ye||Ke,Xe)){Ze.push(ct);break}lt&&(Ut=kn)}Me&&((ct=!bt&&ct)&&It--,We&&xt.push(ct))}if(It+=dt,Me&&dt!==It){for(ut=0;bt=we[ut++];)bt(xt,Lt,Ye,Xe);if(We){if(It>0)for(;dt--;)xt[dt]||Lt[dt]||(Lt[dt]=hn.call(Ze));Lt=Un(Lt)}pn.apply(Ze,Lt),lt&&!We&&Lt.length>0&&It+we.length>1&&Rt.uniqueSort(Ze)}return lt&&(Ut=kn,ke=$t),xt};return Me?Xt(Oe):Oe}(Oe,$e)),We.selector=ye}return We},Re=Rt.select=function(ye,we,Me,$e){var Oe,We,Ye,Xe,Ze,lt="function"==typeof ye&&ye,ct=!$e&&ve(ye=lt.selector||ye);if(Me=Me||[],1===ct.length){if((We=ct[0]=ct[0].slice(0)).length>2&&"ID"===(Ye=We[0]).type&&9===we.nodeType&&vt&&re.relative[We[1].type]){if(!(we=(re.find.ID(Ye.matches[0].replace(un,fn),we)||[])[0]))return Me;lt&&(we=we.parentNode),ye=ye.slice(We.shift().value.length)}for(Oe=xn.needsContext.test(ye)?0:We.length;Oe--&&!re.relative[Xe=(Ye=We[Oe]).type];)if((Ze=re.find[Xe])&&($e=Ze(Ye.matches[0].replace(un,fn),zn.test(We[0].type)&&Jn(we.parentNode)||we))){if(We.splice(Oe,1),!(ye=$e.length&&Ln(We)))return pn.apply(Me,$e),Me;break}}return(lt||Te(ye,ct))($e,we,!vt,Me,!we||zn.test(ye)&&Jn(we.parentNode)||we),Me},Z.sortStable=wt.split("").sort(mn).join("")===wt,Z.detectDuplicates=!!ze,xe(),Z.sortDetached=Zt(function(ye){return 1&ye.compareDocumentPosition(Ke.createElement("fieldset"))}),Zt(function(ye){return ye.innerHTML="<a href='#'></a>","#"===ye.firstChild.getAttribute("href")})||Yn("type|href|height|width",function(ye,we,Me){if(!Me)return ye.getAttribute(we,"type"===we.toLowerCase()?1:2)}),(!Z.attributes||!Zt(function(ye){return ye.innerHTML="<input/>",ye.firstChild.setAttribute("value",""),""===ye.firstChild.getAttribute("value")}))&&Yn("value",function(ye,we,Me){if(!Me&&"input"===ye.nodeName.toLowerCase())return ye.defaultValue}),Zt(function(ye){return null==ye.getAttribute("disabled")})||Yn(Gn,function(ye,we,Me){var $e;if(!Me)return!0===ye[we]?we.toLowerCase():($e=ye.getAttributeNode(we))&&$e.specified?$e.value:null}),Rt}(m);e.find=b,e.expr=b.selectors,e.expr[":"]=e.expr.pseudos,e.uniqueSort=e.unique=b.uniqueSort,e.text=b.getText,e.isXMLDoc=b.isXML,e.contains=b.contains,e.escapeSelector=b.escape;var y=function(O,q,Z){for(var re=[],de=void 0!==Z;(O=O[q])&&9!==O.nodeType;)if(1===O.nodeType){if(de&&e(O).is(Z))break;re.push(O)}return re},w=function(O,q){for(var Z=[];O;O=O.nextSibling)1===O.nodeType&&O!==q&&Z.push(O);return Z},x=e.expr.match.needsContext;function B(O,q){return O.nodeName&&O.nodeName.toLowerCase()===q.toLowerCase()}var J=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function z(O,q,Z){return r(q)?e.grep(O,function(re,de){return!!q.call(re,de,re)!==Z}):q.nodeType?e.grep(O,function(re){return re===q!==Z}):"string"!=typeof q?e.grep(O,function(re){return d.call(q,re)>-1!==Z}):e.filter(q,O,Z)}e.filter=function(O,q,Z){var re=q[0];return Z&&(O=":not("+O+")"),1===q.length&&1===re.nodeType?e.find.matchesSelector(re,O)?[re]:[]:e.find.matches(O,e.grep(q,function(de){return 1===de.nodeType}))},e.fn.extend({find:function(O){var q,Z,re=this.length,de=this;if("string"!=typeof O)return this.pushStack(e(O).filter(function(){for(q=0;q<re;q++)if(e.contains(de[q],this))return!0}));for(Z=this.pushStack([]),q=0;q<re;q++)e.find(O,de[q],Z);return re>1?e.uniqueSort(Z):Z},filter:function(O){return this.pushStack(z(this,O||[],!1))},not:function(O){return this.pushStack(z(this,O||[],!0))},is:function(O){return!!z(this,"string"==typeof O&&x.test(O)?e(O):O||[],!1).length}});var M,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,j=e.fn.init=function(O,q,Z){var re,de;if(!O)return this;if(Z=Z||M,"string"==typeof O){if(!(re="<"===O[0]&&">"===O[O.length-1]&&O.length>=3?[null,O,null]:L.exec(O))||!re[1]&&q)return!q||q.jquery?(q||Z).find(O):this.constructor(q).find(O);if(re[1]){if(e.merge(this,e.parseHTML(re[1],(q=q instanceof e?q[0]:q)&&q.nodeType?q.ownerDocument||q:t,!0)),J.test(re[1])&&e.isPlainObject(q))for(re in q)r(this[re])?this[re](q[re]):this.attr(re,q[re]);return this}return(de=t.getElementById(re[2]))&&(this[0]=de,this.length=1),this}return O.nodeType?(this[0]=O,this.length=1,this):r(O)?void 0!==Z.ready?Z.ready(O):O(e):e.makeArray(O,this)};j.prototype=e.fn,M=e(t);var C=/^(?:parents|prev(?:Until|All))/,F={children:!0,contents:!0,next:!0,prev:!0};function V(O,q){for(;(O=O[q])&&1!==O.nodeType;);return O}e.fn.extend({has:function(O){var q=e(O,this),Z=q.length;return this.filter(function(){for(var re=0;re<Z;re++)if(e.contains(this,q[re]))return!0})},closest:function(O,q){var Z,re=0,de=this.length,fe=[],ve="string"!=typeof O&&e(O);if(!x.test(O))for(;re<de;re++)for(Z=this[re];Z&&Z!==q;Z=Z.parentNode)if(Z.nodeType<11&&(ve?ve.index(Z)>-1:1===Z.nodeType&&e.find.matchesSelector(Z,O))){fe.push(Z);break}return this.pushStack(fe.length>1?e.uniqueSort(fe):fe)},index:function(O){return O?"string"==typeof O?d.call(e(O),this[0]):d.call(this,O.jquery?O[0]:O):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(O,q){return this.pushStack(e.uniqueSort(e.merge(this.get(),e(O,q))))},addBack:function(O){return this.add(null==O?this.prevObject:this.prevObject.filter(O))}}),e.each({parent:function(O){var q=O.parentNode;return q&&11!==q.nodeType?q:null},parents:function(O){return y(O,"parentNode")},parentsUntil:function(O,q,Z){return y(O,"parentNode",Z)},next:function(O){return V(O,"nextSibling")},prev:function(O){return V(O,"previousSibling")},nextAll:function(O){return y(O,"nextSibling")},prevAll:function(O){return y(O,"previousSibling")},nextUntil:function(O,q,Z){return y(O,"nextSibling",Z)},prevUntil:function(O,q,Z){return y(O,"previousSibling",Z)},siblings:function(O){return w((O.parentNode||{}).firstChild,O)},children:function(O){return w(O.firstChild)},contents:function(O){return null!=O.contentDocument&&R(O.contentDocument)?O.contentDocument:(B(O,"template")&&(O=O.content||O),e.merge([],O.childNodes))}},function(O,q){e.fn[O]=function(Z,re){var de=e.map(this,q,Z);return"Until"!==O.slice(-5)&&(re=Z),re&&"string"==typeof re&&(de=e.filter(re,de)),this.length>1&&(F[O]||e.uniqueSort(de),C.test(O)&&de.reverse()),this.pushStack(de)}});var N=/[^\x20\t\r\n\f]+/g;function S(O){return O}function U(O){throw O}function W(O,q,Z,re){var de;try{O&&r(de=O.promise)?de.call(O).done(q).fail(Z):O&&r(de=O.then)?de.call(O,q,Z):q.apply(void 0,[O].slice(re))}catch(fe){Z.apply(void 0,[fe])}}e.Callbacks=function(O){O="string"==typeof O?function T(O){var q={};return e.each(O.match(N)||[],function(Z,re){q[re]=!0}),q}(O):e.extend({},O);var q,Z,re,de,fe=[],ve=[],Te=-1,Re=function(){for(de=de||O.once,re=q=!0;ve.length;Te=-1)for(Z=ve.shift();++Te<fe.length;)!1===fe[Te].apply(Z[0],Z[1])&&O.stopOnFalse&&(Te=fe.length,Z=!1);O.memory||(Z=!1),q=!1,de&&(fe=Z?[]:"")},ke={add:function(){return fe&&(Z&&!q&&(Te=fe.length-1,ve.push(Z)),function Le(ze){e.each(ze,function(xe,Ke){r(Ke)?(!O.unique||!ke.has(Ke))&&fe.push(Ke):Ke&&Ke.length&&"string"!==h(Ke)&&Le(Ke)})}(arguments),Z&&!q&&Re()),this},remove:function(){return e.each(arguments,function(Le,ze){for(var xe;(xe=e.inArray(ze,fe,xe))>-1;)fe.splice(xe,1),xe<=Te&&Te--}),this},has:function(Le){return Le?e.inArray(Le,fe)>-1:fe.length>0},empty:function(){return fe&&(fe=[]),this},disable:function(){return de=ve=[],fe=Z="",this},disabled:function(){return!fe},lock:function(){return de=ve=[],!Z&&!q&&(fe=Z=""),this},locked:function(){return!!de},fireWith:function(Le,ze){return de||(ze=[Le,(ze=ze||[]).slice?ze.slice():ze],ve.push(ze),q||Re()),this},fire:function(){return ke.fireWith(this,arguments),this},fired:function(){return!!re}};return ke},e.extend({Deferred:function(O){var q=[["notify","progress",e.Callbacks("memory"),e.Callbacks("memory"),2],["resolve","done",e.Callbacks("once memory"),e.Callbacks("once memory"),0,"resolved"],["reject","fail",e.Callbacks("once memory"),e.Callbacks("once memory"),1,"rejected"]],Z="pending",re={state:function(){return Z},always:function(){return de.done(arguments).fail(arguments),this},catch:function(fe){return re.then(null,fe)},pipe:function(){var fe=arguments;return e.Deferred(function(ve){e.each(q,function(Te,Re){var ke=r(fe[Re[4]])&&fe[Re[4]];de[Re[1]](function(){var Le=ke&&ke.apply(this,arguments);Le&&r(Le.promise)?Le.promise().progress(ve.notify).done(ve.resolve).fail(ve.reject):ve[Re[0]+"With"](this,ke?[Le]:arguments)})}),fe=null}).promise()},then:function(fe,ve,Te){var Re=0;function ke(Le,ze,xe,Ke){return function(){var ot=this,vt=arguments,at=function(){var Pt,jt;if(!(Le<Re)){if((Pt=xe.apply(ot,vt))===ze.promise())throw new TypeError("Thenable self-resolution");r(jt=Pt&&("object"==typeof Pt||"function"==typeof Pt)&&Pt.then)?Ke?jt.call(Pt,ke(Re,ze,S,Ke),ke(Re,ze,U,Ke)):(Re++,jt.call(Pt,ke(Re,ze,S,Ke),ke(Re,ze,U,Ke),ke(Re,ze,S,ze.notifyWith))):(xe!==S&&(ot=void 0,vt=[Pt]),(Ke||ze.resolveWith)(ot,vt))}},Dt=Ke?at:function(){try{at()}catch(Pt){e.Deferred.exceptionHook&&e.Deferred.exceptionHook(Pt,Dt.stackTrace),Le+1>=Re&&(xe!==U&&(ot=void 0,vt=[Pt]),ze.rejectWith(ot,vt))}};Le?Dt():(e.Deferred.getStackHook&&(Dt.stackTrace=e.Deferred.getStackHook()),m.setTimeout(Dt))}}return e.Deferred(function(Le){q[0][3].add(ke(0,Le,r(Te)?Te:S,Le.notifyWith)),q[1][3].add(ke(0,Le,r(fe)?fe:S)),q[2][3].add(ke(0,Le,r(ve)?ve:U))}).promise()},promise:function(fe){return null!=fe?e.extend(fe,re):re}},de={};return e.each(q,function(fe,ve){var Te=ve[2],Re=ve[5];re[ve[1]]=Te.add,Re&&Te.add(function(){Z=Re},q[3-fe][2].disable,q[3-fe][3].disable,q[0][2].lock,q[0][3].lock),Te.add(ve[3].fire),de[ve[0]]=function(){return de[ve[0]+"With"](this===de?void 0:this,arguments),this},de[ve[0]+"With"]=Te.fireWith}),re.promise(de),O&&O.call(de,de),de},when:function(O){var q=arguments.length,Z=q,re=Array(Z),de=I.call(arguments),fe=e.Deferred(),ve=function(Te){return function(Re){re[Te]=this,de[Te]=arguments.length>1?I.call(arguments):Re,--q||fe.resolveWith(re,de)}};if(q<=1&&(W(O,fe.done(ve(Z)).resolve,fe.reject,!q),"pending"===fe.state()||r(de[Z]&&de[Z].then)))return fe.then();for(;Z--;)W(de[Z],ve(Z),fe.reject);return fe.promise()}});var k=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;e.Deferred.exceptionHook=function(O,q){m.console&&m.console.warn&&O&&k.test(O.name)&&m.console.warn("jQuery.Deferred exception: "+O.message,O.stack,q)},e.readyException=function(O){m.setTimeout(function(){throw O})};var D=e.Deferred();function Q(){t.removeEventListener("DOMContentLoaded",Q),m.removeEventListener("load",Q),e.ready()}e.fn.ready=function(O){return D.then(O).catch(function(q){e.readyException(q)}),this},e.extend({isReady:!1,readyWait:1,ready:function(O){(!0===O?--e.readyWait:e.isReady)||(e.isReady=!0,!(!0!==O&&--e.readyWait>0)&&D.resolveWith(t,[e]))}}),e.ready.then=D.then,"complete"===t.readyState||"loading"!==t.readyState&&!t.documentElement.doScroll?m.setTimeout(e.ready):(t.addEventListener("DOMContentLoaded",Q),m.addEventListener("load",Q));var ee=function(O,q,Z,re,de,fe,ve){var Te=0,Re=O.length,ke=null==Z;if("object"===h(Z))for(Te in de=!0,Z)ee(O,q,Te,Z[Te],!0,fe,ve);else if(void 0!==re&&(de=!0,r(re)||(ve=!0),ke&&(ve?(q.call(O,re),q=null):(ke=q,q=function(Le,ze,xe){return ke.call(e(Le),xe)})),q))for(;Te<Re;Te++)q(O[Te],Z,ve?re:re.call(O[Te],Te,q(O[Te],Z)));return de?O:ke?q.call(O):Re?q(O[0],Z):fe},ae=/^-ms-/,ue=/-([a-z])/g;function be(O,q){return q.toUpperCase()}function X(O){return O.replace(ae,"ms-").replace(ue,be)}var H=function(O){return 1===O.nodeType||9===O.nodeType||!+O.nodeType};function ne(){this.expando=e.expando+ne.uid++}ne.uid=1,ne.prototype={cache:function(O){var q=O[this.expando];return q||(q={},H(O)&&(O.nodeType?O[this.expando]=q:Object.defineProperty(O,this.expando,{value:q,configurable:!0}))),q},set:function(O,q,Z){var re,de=this.cache(O);if("string"==typeof q)de[X(q)]=Z;else for(re in q)de[X(re)]=q[re];return de},get:function(O,q){return void 0===q?this.cache(O):O[this.expando]&&O[this.expando][X(q)]},access:function(O,q,Z){return void 0===q||q&&"string"==typeof q&&void 0===Z?this.get(O,q):(this.set(O,q,Z),void 0!==Z?Z:q)},remove:function(O,q){var Z,re=O[this.expando];if(void 0!==re){if(void 0!==q)for((Z=(q=Array.isArray(q)?q.map(X):(q=X(q))in re?[q]:q.match(N)||[]).length);Z--;)delete re[q[Z]];(void 0===q||e.isEmptyObject(re))&&(O.nodeType?O[this.expando]=void 0:delete O[this.expando])}},hasData:function(O){var q=O[this.expando];return void 0!==q&&!e.isEmptyObject(q)}};var ce=new ne,te=new ne,P=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,A=/[A-Z]/g;function G(O,q,Z){var re;if(void 0===Z&&1===O.nodeType)if(re="data-"+q.replace(A,"-$&").toLowerCase(),"string"==typeof(Z=O.getAttribute(re))){try{Z=function $(O){return"true"===O||"false"!==O&&("null"===O?null:O===+O+""?+O:P.test(O)?JSON.parse(O):O)}(Z)}catch{}te.set(O,q,Z)}else Z=void 0;return Z}e.extend({hasData:function(O){return te.hasData(O)||ce.hasData(O)},data:function(O,q,Z){return te.access(O,q,Z)},removeData:function(O,q){te.remove(O,q)},_data:function(O,q,Z){return ce.access(O,q,Z)},_removeData:function(O,q){ce.remove(O,q)}}),e.fn.extend({data:function(O,q){var Z,re,de,fe=this[0],ve=fe&&fe.attributes;if(void 0===O){if(this.length&&(de=te.get(fe),1===fe.nodeType&&!ce.get(fe,"hasDataAttrs"))){for(Z=ve.length;Z--;)ve[Z]&&0===(re=ve[Z].name).indexOf("data-")&&(re=X(re.slice(5)),G(fe,re,de[re]));ce.set(fe,"hasDataAttrs",!0)}return de}return"object"==typeof O?this.each(function(){te.set(this,O)}):ee(this,function(Te){var Re;if(fe&&void 0===Te)return void 0!==(Re=te.get(fe,O))||void 0!==(Re=G(fe,O))?Re:void 0;this.each(function(){te.set(this,O,Te)})},null,q,arguments.length>1,null,!0)},removeData:function(O){return this.each(function(){te.remove(this,O)})}}),e.extend({queue:function(O,q,Z){var re;if(O)return re=ce.get(O,q=(q||"fx")+"queue"),Z&&(!re||Array.isArray(Z)?re=ce.access(O,q,e.makeArray(Z)):re.push(Z)),re||[]},dequeue:function(O,q){var Z=e.queue(O,q=q||"fx"),re=Z.length,de=Z.shift(),fe=e._queueHooks(O,q);"inprogress"===de&&(de=Z.shift(),re--),de&&("fx"===q&&Z.unshift("inprogress"),delete fe.stop,de.call(O,function(){e.dequeue(O,q)},fe)),!re&&fe&&fe.empty.fire()},_queueHooks:function(O,q){var Z=q+"queueHooks";return ce.get(O,Z)||ce.access(O,Z,{empty:e.Callbacks("once memory").add(function(){ce.remove(O,[q+"queue",Z])})})}}),e.fn.extend({queue:function(O,q){var Z=2;return"string"!=typeof O&&(q=O,O="fx",Z--),arguments.length<Z?e.queue(this[0],O):void 0===q?this:this.each(function(){var re=e.queue(this,O,q);e._queueHooks(this,O),"fx"===O&&"inprogress"!==re[0]&&e.dequeue(this,O)})},dequeue:function(O){return this.each(function(){e.dequeue(this,O)})},clearQueue:function(O){return this.queue(O||"fx",[])},promise:function(O,q){var Z,re=1,de=e.Deferred(),fe=this,ve=this.length,Te=function(){--re||de.resolveWith(fe,[fe])};for("string"!=typeof O&&(q=O,O=void 0),O=O||"fx";ve--;)(Z=ce.get(fe[ve],O+"queueHooks"))&&Z.empty&&(re++,Z.empty.add(Te));return Te(),de.promise(q)}});var se=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,he=new RegExp("^(?:([+-])=|)("+se+")([a-z%]*)$","i"),pe=["Top","Right","Bottom","Left"],me=t.documentElement,Ee=function(O){return e.contains(O.ownerDocument,O)},_e={composed:!0};me.getRootNode&&(Ee=function(O){return e.contains(O.ownerDocument,O)||O.getRootNode(_e)===O.ownerDocument});var Se=function(O,q){return"none"===(O=q||O).style.display||""===O.style.display&&Ee(O)&&"none"===e.css(O,"display")};function De(O,q,Z,re){var de,fe,ve=20,Te=re?function(){return re.cur()}:function(){return e.css(O,q,"")},Re=Te(),ke=Z&&Z[3]||(e.cssNumber[q]?"":"px"),Le=O.nodeType&&(e.cssNumber[q]||"px"!==ke&&+Re)&&he.exec(e.css(O,q));if(Le&&Le[3]!==ke){for(ke=ke||Le[3],Le=+(Re/=2)||1;ve--;)e.style(O,q,Le+ke),(1-fe)*(1-(fe=Te()/Re||.5))<=0&&(ve=0),Le/=fe;e.style(O,q,(Le*=2)+ke),Z=Z||[]}return Z&&(Le=+Le||+Re||0,de=Z[1]?Le+(Z[1]+1)*Z[2]:+Z[2],re&&(re.unit=ke,re.start=Le,re.end=de)),de}var Ae={};function Ne(O){var q,Z=O.ownerDocument,re=O.nodeName,de=Ae[re];return de||(q=Z.body.appendChild(Z.createElement(re)),de=e.css(q,"display"),q.parentNode.removeChild(q),"none"===de&&(de="block"),Ae[re]=de,de)}function qe(O,q){for(var Z,re,de=[],fe=0,ve=O.length;fe<ve;fe++)(re=O[fe]).style&&(Z=re.style.display,q?("none"===Z&&(de[fe]=ce.get(re,"display")||null,de[fe]||(re.style.display="")),""===re.style.display&&Se(re)&&(de[fe]=Ne(re))):"none"!==Z&&(de[fe]="none",ce.set(re,"display",Z)));for(fe=0;fe<ve;fe++)null!=de[fe]&&(O[fe].style.display=de[fe]);return O}e.fn.extend({show:function(){return qe(this,!0)},hide:function(){return qe(this)},toggle:function(O){return"boolean"==typeof O?O?this.show():this.hide():this.each(function(){Se(this)?e(this).show():e(this).hide()})}});var q,Z,Be=/^(?:checkbox|radio)$/i,Ge=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ue=/^$|^module$|\/(?:java|ecma)script/i;q=t.createDocumentFragment().appendChild(t.createElement("div")),(Z=t.createElement("input")).setAttribute("type","radio"),Z.setAttribute("checked","checked"),Z.setAttribute("name","t"),q.appendChild(Z),i.checkClone=q.cloneNode(!0).cloneNode(!0).lastChild.checked,q.innerHTML="<textarea>x</textarea>",i.noCloneChecked=!!q.cloneNode(!0).lastChild.defaultValue,q.innerHTML="<option></option>",i.option=!!q.lastChild;var K={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Y(O,q){var Z;return Z=typeof O.getElementsByTagName<"u"?O.getElementsByTagName(q||"*"):typeof O.querySelectorAll<"u"?O.querySelectorAll(q||"*"):[],void 0===q||q&&B(O,q)?e.merge([O],Z):Z}function oe(O,q){for(var Z=0,re=O.length;Z<re;Z++)ce.set(O[Z],"globalEval",!q||ce.get(q[Z],"globalEval"))}K.tbody=K.tfoot=K.colgroup=K.caption=K.thead,K.th=K.td,i.option||(K.optgroup=K.option=[1,"<select multiple='multiple'>","</select>"]);var le=/<|&#?\w+;/;function ge(O,q,Z,re,de){for(var fe,ve,Te,Re,ke,Le,ze=q.createDocumentFragment(),xe=[],Ke=0,ot=O.length;Ke<ot;Ke++)if((fe=O[Ke])||0===fe)if("object"===h(fe))e.merge(xe,fe.nodeType?[fe]:fe);else if(le.test(fe)){for(ve=ve||ze.appendChild(q.createElement("div")),Te=(Ge.exec(fe)||["",""])[1].toLowerCase(),ve.innerHTML=(Re=K[Te]||K._default)[1]+e.htmlPrefilter(fe)+Re[2],Le=Re[0];Le--;)ve=ve.lastChild;e.merge(xe,ve.childNodes),(ve=ze.firstChild).textContent=""}else xe.push(q.createTextNode(fe));for(ze.textContent="",Ke=0;fe=xe[Ke++];)if(re&&e.inArray(fe,re)>-1)de&&de.push(fe);else if(ke=Ee(fe),ve=Y(ze.appendChild(fe),"script"),ke&&oe(ve),Z)for(Le=0;fe=ve[Le++];)Ue.test(fe.type||"")&&Z.push(fe);return ze}var Ie=/^([^.]*)(?:\.(.+)|)/;function Ce(){return!0}function Pe(){return!1}function He(O,q){return O===function Fe(){try{return t.activeElement}catch{}}()==("focus"===q)}function je(O,q,Z,re,de,fe){var ve,Te;if("object"==typeof q){for(Te in"string"!=typeof Z&&(re=re||Z,Z=void 0),q)je(O,Te,Z,re,q[Te],fe);return O}if(null==re&&null==de?(de=Z,re=Z=void 0):null==de&&("string"==typeof Z?(de=re,re=void 0):(de=re,re=Z,Z=void 0)),!1===de)de=Pe;else if(!de)return O;return 1===fe&&(ve=de,de=function(Re){return e().off(Re),ve.apply(this,arguments)},de.guid=ve.guid||(ve.guid=e.guid++)),O.each(function(){e.event.add(this,q,de,re,Z)})}function et(O,q,Z){Z?(ce.set(O,q,!1),e.event.add(O,q,{namespace:!1,handler:function(re){var de,fe,ve=ce.get(this,q);if(1&re.isTrigger&&this[q]){if(ve.length)(e.event.special[q]||{}).delegateType&&re.stopPropagation();else if(ve=I.call(arguments),ce.set(this,q,ve),de=Z(this,q),this[q](),ve!==(fe=ce.get(this,q))||de?ce.set(this,q,!1):fe={},ve!==fe)return re.stopImmediatePropagation(),re.preventDefault(),fe&&fe.value}else ve.length&&(ce.set(this,q,{value:e.event.trigger(e.extend(ve[0],e.Event.prototype),ve.slice(1),this)}),re.stopImmediatePropagation())}})):void 0===ce.get(O,q)&&e.event.add(O,q,Ce)}e.event={global:{},add:function(O,q,Z,re,de){var fe,ve,Te,Re,ke,Le,ze,xe,Ke,ot,vt,at=ce.get(O);if(H(O))for(Z.handler&&(Z=(fe=Z).handler,de=fe.selector),de&&e.find.matchesSelector(me,de),Z.guid||(Z.guid=e.guid++),(Re=at.events)||(Re=at.events=Object.create(null)),(ve=at.handle)||(ve=at.handle=function(Dt){return typeof e<"u"&&e.event.triggered!==Dt.type?e.event.dispatch.apply(O,arguments):void 0}),ke=(q=(q||"").match(N)||[""]).length;ke--;)Ke=vt=(Te=Ie.exec(q[ke])||[])[1],ot=(Te[2]||"").split(".").sort(),Ke&&(ze=e.event.special[Ke]||{},ze=e.event.special[Ke=(de?ze.delegateType:ze.bindType)||Ke]||{},Le=e.extend({type:Ke,origType:vt,data:re,handler:Z,guid:Z.guid,selector:de,needsContext:de&&e.expr.match.needsContext.test(de),namespace:ot.join(".")},fe),(xe=Re[Ke])||((xe=Re[Ke]=[]).delegateCount=0,(!ze.setup||!1===ze.setup.call(O,re,ot,ve))&&O.addEventListener&&O.addEventListener(Ke,ve)),ze.add&&(ze.add.call(O,Le),Le.handler.guid||(Le.handler.guid=Z.guid)),de?xe.splice(xe.delegateCount++,0,Le):xe.push(Le),e.event.global[Ke]=!0)},remove:function(O,q,Z,re,de){var fe,ve,Te,Re,ke,Le,ze,xe,Ke,ot,vt,at=ce.hasData(O)&&ce.get(O);if(at&&(Re=at.events)){for(ke=(q=(q||"").match(N)||[""]).length;ke--;)if(Ke=vt=(Te=Ie.exec(q[ke])||[])[1],ot=(Te[2]||"").split(".").sort(),Ke){for(ze=e.event.special[Ke]||{},xe=Re[Ke=(re?ze.delegateType:ze.bindType)||Ke]||[],Te=Te[2]&&new RegExp("(^|\\.)"+ot.join("\\.(?:.*\\.|)")+"(\\.|$)"),ve=fe=xe.length;fe--;)Le=xe[fe],(de||vt===Le.origType)&&(!Z||Z.guid===Le.guid)&&(!Te||Te.test(Le.namespace))&&(!re||re===Le.selector||"**"===re&&Le.selector)&&(xe.splice(fe,1),Le.selector&&xe.delegateCount--,ze.remove&&ze.remove.call(O,Le));ve&&!xe.length&&((!ze.teardown||!1===ze.teardown.call(O,ot,at.handle))&&e.removeEvent(O,Ke,at.handle),delete Re[Ke])}else for(Ke in Re)e.event.remove(O,Ke+q[ke],Z,re,!0);e.isEmptyObject(Re)&&ce.remove(O,"handle events")}},dispatch:function(O){var q,Z,re,de,fe,ve,Te=new Array(arguments.length),Re=e.event.fix(O),ke=(ce.get(this,"events")||Object.create(null))[Re.type]||[],Le=e.event.special[Re.type]||{};for(Te[0]=Re,q=1;q<arguments.length;q++)Te[q]=arguments[q];if(Re.delegateTarget=this,!Le.preDispatch||!1!==Le.preDispatch.call(this,Re)){for(ve=e.event.handlers.call(this,Re,ke),q=0;(de=ve[q++])&&!Re.isPropagationStopped();)for(Re.currentTarget=de.elem,Z=0;(fe=de.handlers[Z++])&&!Re.isImmediatePropagationStopped();)(!Re.rnamespace||!1===fe.namespace||Re.rnamespace.test(fe.namespace))&&(Re.handleObj=fe,Re.data=fe.data,void 0!==(re=((e.event.special[fe.origType]||{}).handle||fe.handler).apply(de.elem,Te))&&!1===(Re.result=re)&&(Re.preventDefault(),Re.stopPropagation()));return Le.postDispatch&&Le.postDispatch.call(this,Re),Re.result}},handlers:function(O,q){var Z,re,de,fe,ve,Te=[],Re=q.delegateCount,ke=O.target;if(Re&&ke.nodeType&&!("click"===O.type&&O.button>=1))for(;ke!==this;ke=ke.parentNode||this)if(1===ke.nodeType&&("click"!==O.type||!0!==ke.disabled)){for(fe=[],ve={},Z=0;Z<Re;Z++)void 0===ve[de=(re=q[Z]).selector+" "]&&(ve[de]=re.needsContext?e(de,this).index(ke)>-1:e.find(de,this,null,[ke]).length),ve[de]&&fe.push(re);fe.length&&Te.push({elem:ke,handlers:fe})}return ke=this,Re<q.length&&Te.push({elem:ke,handlers:q.slice(Re)}),Te},addProp:function(O,q){Object.defineProperty(e.Event.prototype,O,{enumerable:!0,configurable:!0,get:r(q)?function(){if(this.originalEvent)return q(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[O]},set:function(Z){Object.defineProperty(this,O,{enumerable:!0,configurable:!0,writable:!0,value:Z})}})},fix:function(O){return O[e.expando]?O:new e.Event(O)},special:{load:{noBubble:!0},click:{setup:function(O){var q=this||O;return Be.test(q.type)&&q.click&&B(q,"input")&&et(q,"click",Ce),!1},trigger:function(O){var q=this||O;return Be.test(q.type)&&q.click&&B(q,"input")&&et(q,"click"),!0},_default:function(O){var q=O.target;return Be.test(q.type)&&q.click&&B(q,"input")&&ce.get(q,"click")||B(q,"a")}},beforeunload:{postDispatch:function(O){void 0!==O.result&&O.originalEvent&&(O.originalEvent.returnValue=O.result)}}}},e.removeEvent=function(O,q,Z){O.removeEventListener&&O.removeEventListener(q,Z)},e.Event=function(O,q){if(!(this instanceof e.Event))return new e.Event(O,q);O&&O.type?(this.originalEvent=O,this.type=O.type,this.isDefaultPrevented=O.defaultPrevented||void 0===O.defaultPrevented&&!1===O.returnValue?Ce:Pe,this.target=O.target&&3===O.target.nodeType?O.target.parentNode:O.target,this.currentTarget=O.currentTarget,this.relatedTarget=O.relatedTarget):this.type=O,q&&e.extend(this,q),this.timeStamp=O&&O.timeStamp||Date.now(),this[e.expando]=!0},e.Event.prototype={constructor:e.Event,isDefaultPrevented:Pe,isPropagationStopped:Pe,isImmediatePropagationStopped:Pe,isSimulated:!1,preventDefault:function(){var O=this.originalEvent;this.isDefaultPrevented=Ce,O&&!this.isSimulated&&O.preventDefault()},stopPropagation:function(){var O=this.originalEvent;this.isPropagationStopped=Ce,O&&!this.isSimulated&&O.stopPropagation()},stopImmediatePropagation:function(){var O=this.originalEvent;this.isImmediatePropagationStopped=Ce,O&&!this.isSimulated&&O.stopImmediatePropagation(),this.stopPropagation()}},e.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},e.event.addProp),e.each({focus:"focusin",blur:"focusout"},function(O,q){e.event.special[O]={setup:function(){return et(this,O,He),!1},trigger:function(){return et(this,O),!0},_default:function(){return!0},delegateType:q}}),e.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(O,q){e.event.special[O]={delegateType:q,bindType:q,handle:function(Z){var re,fe=Z.relatedTarget,ve=Z.handleObj;return(!fe||fe!==this&&!e.contains(this,fe))&&(Z.type=ve.origType,re=ve.handler.apply(this,arguments),Z.type=q),re}}}),e.fn.extend({on:function(O,q,Z,re){return je(this,O,q,Z,re)},one:function(O,q,Z,re){return je(this,O,q,Z,re,1)},off:function(O,q,Z){var re,de;if(O&&O.preventDefault&&O.handleObj)return re=O.handleObj,e(O.delegateTarget).off(re.namespace?re.origType+"."+re.namespace:re.origType,re.selector,re.handler),this;if("object"==typeof O){for(de in O)this.off(de,q,O[de]);return this}return(!1===q||"function"==typeof q)&&(Z=q,q=void 0),!1===Z&&(Z=Pe),this.each(function(){e.event.remove(this,O,Z,q)})}});var Ve=/<script|<style|<link/i,Je=/checked\s*(?:[^=]|=\s*.checked.)/i,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function tt(O,q){return B(O,"table")&&B(11!==q.nodeType?q:q.firstChild,"tr")&&e(O).children("tbody")[0]||O}function Qe(O){return O.type=(null!==O.getAttribute("type"))+"/"+O.type,O}function Ct(O){return"true/"===(O.type||"").slice(0,5)?O.type=O.type.slice(5):O.removeAttribute("type"),O}function it(O,q){var Z,re,de,ve,Te,Re;if(1===q.nodeType){if(ce.hasData(O)&&(Re=ce.get(O).events))for(de in ce.remove(q,"handle events"),Re)for(Z=0,re=Re[de].length;Z<re;Z++)e.event.add(q,de,Re[de][Z]);te.hasData(O)&&(ve=te.access(O),Te=e.extend({},ve),te.set(q,Te))}}function rt(O,q){var Z=q.nodeName.toLowerCase();"input"===Z&&Be.test(O.type)?q.checked=O.checked:("input"===Z||"textarea"===Z)&&(q.defaultValue=O.defaultValue)}function yt(O,q,Z,re){q=E(q);var de,fe,ve,Te,Re,ke,Le=0,ze=O.length,xe=ze-1,Ke=q[0],ot=r(Ke);if(ot||ze>1&&"string"==typeof Ke&&!i.checkClone&&Je.test(Ke))return O.each(function(vt){var at=O.eq(vt);ot&&(q[0]=Ke.call(this,vt,at.html())),yt(at,q,Z,re)});if(ze&&(fe=(de=ge(q,O[0].ownerDocument,!1,O,re)).firstChild,1===de.childNodes.length&&(de=fe),fe||re)){for(Te=(ve=e.map(Y(de,"script"),Qe)).length;Le<ze;Le++)Re=de,Le!==xe&&(Re=e.clone(Re,!0,!0),Te&&e.merge(ve,Y(Re,"script"))),Z.call(O[Le],Re,Le);if(Te)for(ke=ve[ve.length-1].ownerDocument,e.map(ve,Ct),Le=0;Le<Te;Le++)Ue.test((Re=ve[Le]).type||"")&&!ce.access(Re,"globalEval")&&e.contains(ke,Re)&&(Re.src&&"module"!==(Re.type||"").toLowerCase()?e._evalUrl&&!Re.noModule&&e._evalUrl(Re.src,{nonce:Re.nonce||Re.getAttribute("nonce")},ke):o(Re.textContent.replace(St,""),Re,ke))}return O}function nt(O,q,Z){for(var re,de=q?e.filter(q,O):O,fe=0;null!=(re=de[fe]);fe++)!Z&&1===re.nodeType&&e.cleanData(Y(re)),re.parentNode&&(Z&&Ee(re)&&oe(Y(re,"script")),re.parentNode.removeChild(re));return O}e.extend({htmlPrefilter:function(O){return O},clone:function(O,q,Z){var re,de,fe,ve,Te=O.cloneNode(!0),Re=Ee(O);if(!(i.noCloneChecked||1!==O.nodeType&&11!==O.nodeType||e.isXMLDoc(O)))for(ve=Y(Te),re=0,de=(fe=Y(O)).length;re<de;re++)rt(fe[re],ve[re]);if(q)if(Z)for(fe=fe||Y(O),ve=ve||Y(Te),re=0,de=fe.length;re<de;re++)it(fe[re],ve[re]);else it(O,Te);return(ve=Y(Te,"script")).length>0&&oe(ve,!Re&&Y(O,"script")),Te},cleanData:function(O){for(var q,Z,re,de=e.event.special,fe=0;void 0!==(Z=O[fe]);fe++)if(H(Z)){if(q=Z[ce.expando]){if(q.events)for(re in q.events)de[re]?e.event.remove(Z,re):e.removeEvent(Z,re,q.handle);Z[ce.expando]=void 0}Z[te.expando]&&(Z[te.expando]=void 0)}}}),e.fn.extend({detach:function(O){return nt(this,O,!0)},remove:function(O){return nt(this,O)},text:function(O){return ee(this,function(q){return void 0===q?e.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=q)})},null,O,arguments.length)},append:function(){return yt(this,arguments,function(O){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||tt(this,O).appendChild(O)})},prepend:function(){return yt(this,arguments,function(O){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var q=tt(this,O);q.insertBefore(O,q.firstChild)}})},before:function(){return yt(this,arguments,function(O){this.parentNode&&this.parentNode.insertBefore(O,this)})},after:function(){return yt(this,arguments,function(O){this.parentNode&&this.parentNode.insertBefore(O,this.nextSibling)})},empty:function(){for(var O,q=0;null!=(O=this[q]);q++)1===O.nodeType&&(e.cleanData(Y(O,!1)),O.textContent="");return this},clone:function(O,q){return O=O??!1,q=q??O,this.map(function(){return e.clone(this,O,q)})},html:function(O){return ee(this,function(q){var Z=this[0]||{},re=0,de=this.length;if(void 0===q&&1===Z.nodeType)return Z.innerHTML;if("string"==typeof q&&!Ve.test(q)&&!K[(Ge.exec(q)||["",""])[1].toLowerCase()]){q=e.htmlPrefilter(q);try{for(;re<de;re++)1===(Z=this[re]||{}).nodeType&&(e.cleanData(Y(Z,!1)),Z.innerHTML=q);Z=0}catch{}}Z&&this.empty().append(q)},null,O,arguments.length)},replaceWith:function(){var O=[];return yt(this,arguments,function(q){var Z=this.parentNode;e.inArray(this,O)<0&&(e.cleanData(Y(this)),Z&&Z.replaceChild(q,this))},O)}}),e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(O,q){e.fn[O]=function(Z){for(var re,de=[],fe=e(Z),ve=fe.length-1,Te=0;Te<=ve;Te++)re=Te===ve?this:this.clone(!0),e(fe[Te])[q](re),_.apply(de,re.get());return this.pushStack(de)}});var st=new RegExp("^("+se+")(?!px)[a-z%]+$","i"),Nt=function(O){var q=O.ownerDocument.defaultView;return(!q||!q.opener)&&(q=m),q.getComputedStyle(O)},ft=function(O,q,Z){var re,de,fe={};for(de in q)fe[de]=O.style[de],O.style[de]=q[de];for(de in re=Z.call(O),q)O.style[de]=fe[de];return re},mt=new RegExp(pe.join("|"),"i");function qt(O,q,Z){var re,de,fe,ve,Te=O.style;return(Z=Z||Nt(O))&&(""===(ve=Z.getPropertyValue(q)||Z[q])&&!Ee(O)&&(ve=e.style(O,q)),!i.pixelBoxStyles()&&st.test(ve)&&mt.test(q)&&(re=Te.width,de=Te.minWidth,fe=Te.maxWidth,Te.minWidth=Te.maxWidth=Te.width=ve,ve=Z.width,Te.width=re,Te.minWidth=de,Te.maxWidth=fe)),void 0!==ve?ve+"":ve}function pt(O,q){return{get:function(){if(!O())return(this.get=q).apply(this,arguments);delete this.get}}}!function(){function O(){if(ke){Re.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",ke.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",me.appendChild(Re).appendChild(ke);var Le=m.getComputedStyle(ke);Z="1%"!==Le.top,Te=12===q(Le.marginLeft),ke.style.right="60%",fe=36===q(Le.right),re=36===q(Le.width),ke.style.position="absolute",de=12===q(ke.offsetWidth/3),me.removeChild(Re),ke=null}}function q(Le){return Math.round(parseFloat(Le))}var Z,re,de,fe,ve,Te,Re=t.createElement("div"),ke=t.createElement("div");ke.style&&(ke.style.backgroundClip="content-box",ke.cloneNode(!0).style.backgroundClip="",i.clearCloneStyle="content-box"===ke.style.backgroundClip,e.extend(i,{boxSizingReliable:function(){return O(),re},pixelBoxStyles:function(){return O(),fe},pixelPosition:function(){return O(),Z},reliableMarginLeft:function(){return O(),Te},scrollboxSize:function(){return O(),de},reliableTrDimensions:function(){var Le,ze,xe,Ke;return null==ve&&(Le=t.createElement("table"),ze=t.createElement("tr"),xe=t.createElement("div"),Le.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ze.style.cssText="border:1px solid",ze.style.height="1px",xe.style.height="9px",xe.style.display="block",me.appendChild(Le).appendChild(ze).appendChild(xe),Ke=m.getComputedStyle(ze),ve=parseInt(Ke.height,10)+parseInt(Ke.borderTopWidth,10)+parseInt(Ke.borderBottomWidth,10)===ze.offsetHeight,me.removeChild(Le)),ve}}))}();var gt=["Webkit","Moz","ms"],on=t.createElement("div").style,Tt={};function zt(O){return e.cssProps[O]||Tt[O]||(O in on?O:Tt[O]=function Mt(O){for(var q=O[0].toUpperCase()+O.slice(1),Z=gt.length;Z--;)if((O=gt[Z]+q)in on)return O}(O)||O)}var an=/^(none|table(?!-c[ea]).+)/,en=/^--/,cn={position:"absolute",visibility:"hidden",display:"block"},tn={letterSpacing:"0",fontWeight:"400"};function nn(O,q,Z){var re=he.exec(q);return re?Math.max(0,re[2]-(Z||0))+(re[3]||"px"):q}function Yt(O,q,Z,re,de,fe){var ve="width"===q?1:0,Te=0,Re=0;if(Z===(re?"border":"content"))return 0;for(;ve<4;ve+=2)"margin"===Z&&(Re+=e.css(O,Z+pe[ve],!0,de)),re?("content"===Z&&(Re-=e.css(O,"padding"+pe[ve],!0,de)),"margin"!==Z&&(Re-=e.css(O,"border"+pe[ve]+"Width",!0,de))):(Re+=e.css(O,"padding"+pe[ve],!0,de),"padding"!==Z?Re+=e.css(O,"border"+pe[ve]+"Width",!0,de):Te+=e.css(O,"border"+pe[ve]+"Width",!0,de));return!re&&fe>=0&&(Re+=Math.max(0,Math.ceil(O["offset"+q[0].toUpperCase()+q.slice(1)]-fe-Re-Te-.5))||0),Re}function rn(O,q,Z){var re=Nt(O),fe=(!i.boxSizingReliable()||Z)&&"border-box"===e.css(O,"boxSizing",!1,re),ve=fe,Te=qt(O,q,re),Re="offset"+q[0].toUpperCase()+q.slice(1);if(st.test(Te)){if(!Z)return Te;Te="auto"}return(!i.boxSizingReliable()&&fe||!i.reliableTrDimensions()&&B(O,"tr")||"auto"===Te||!parseFloat(Te)&&"inline"===e.css(O,"display",!1,re))&&O.getClientRects().length&&(fe="border-box"===e.css(O,"boxSizing",!1,re),(ve=Re in O)&&(Te=O[Re])),(Te=parseFloat(Te)||0)+Yt(O,q,Z||(fe?"border":"content"),ve,re,Te)+"px"}function Ot(O,q,Z,re,de){return new Ot.prototype.init(O,q,Z,re,de)}e.extend({cssHooks:{opacity:{get:function(O,q){if(q){var Z=qt(O,"opacity");return""===Z?"1":Z}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(O,q,Z,re){if(O&&3!==O.nodeType&&8!==O.nodeType&&O.style){var de,fe,ve,Te=X(q),Re=en.test(q),ke=O.style;if(Re||(q=zt(Te)),ve=e.cssHooks[q]||e.cssHooks[Te],void 0===Z)return ve&&"get"in ve&&void 0!==(de=ve.get(O,!1,re))?de:ke[q];if("string"==(fe=typeof Z)&&(de=he.exec(Z))&&de[1]&&(Z=De(O,q,de),fe="number"),null==Z||Z!=Z)return;"number"===fe&&!Re&&(Z+=de&&de[3]||(e.cssNumber[Te]?"":"px")),!i.clearCloneStyle&&""===Z&&0===q.indexOf("background")&&(ke[q]="inherit"),(!ve||!("set"in ve)||void 0!==(Z=ve.set(O,Z,re)))&&(Re?ke.setProperty(q,Z):ke[q]=Z)}},css:function(O,q,Z,re){var de,fe,ve,Te=X(q);return en.test(q)||(q=zt(Te)),(ve=e.cssHooks[q]||e.cssHooks[Te])&&"get"in ve&&(de=ve.get(O,!0,Z)),void 0===de&&(de=qt(O,q,re)),"normal"===de&&q in tn&&(de=tn[q]),""===Z||Z?(fe=parseFloat(de),!0===Z||isFinite(fe)?fe||0:de):de}}),e.each(["height","width"],function(O,q){e.cssHooks[q]={get:function(Z,re,de){if(re)return!an.test(e.css(Z,"display"))||Z.getClientRects().length&&Z.getBoundingClientRect().width?rn(Z,q,de):ft(Z,cn,function(){return rn(Z,q,de)})},set:function(Z,re,de){var fe,ve=Nt(Z),Te=!i.scrollboxSize()&&"absolute"===ve.position,ke=(Te||de)&&"border-box"===e.css(Z,"boxSizing",!1,ve),Le=de?Yt(Z,q,de,ke,ve):0;return ke&&Te&&(Le-=Math.ceil(Z["offset"+q[0].toUpperCase()+q.slice(1)]-parseFloat(ve[q])-Yt(Z,q,"border",!1,ve)-.5)),Le&&(fe=he.exec(re))&&"px"!==(fe[3]||"px")&&(Z.style[q]=re,re=e.css(Z,q)),nn(0,re,Le)}}}),e.cssHooks.marginLeft=pt(i.reliableMarginLeft,function(O,q){if(q)return(parseFloat(qt(O,"marginLeft"))||O.getBoundingClientRect().left-ft(O,{marginLeft:0},function(){return O.getBoundingClientRect().left}))+"px"}),e.each({margin:"",padding:"",border:"Width"},function(O,q){e.cssHooks[O+q]={expand:function(Z){for(var re=0,de={},fe="string"==typeof Z?Z.split(" "):[Z];re<4;re++)de[O+pe[re]+q]=fe[re]||fe[re-2]||fe[0];return de}},"margin"!==O&&(e.cssHooks[O+q].set=nn)}),e.fn.extend({css:function(O,q){return ee(this,function(Z,re,de){var fe,ve,Te={},Re=0;if(Array.isArray(re)){for(fe=Nt(Z),ve=re.length;Re<ve;Re++)Te[re[Re]]=e.css(Z,re[Re],!1,fe);return Te}return void 0!==de?e.style(Z,re,de):e.css(Z,re)},O,q,arguments.length>1)}}),e.Tween=Ot,Ot.prototype={constructor:Ot,init:function(O,q,Z,re,de,fe){this.elem=O,this.prop=Z,this.easing=de||e.easing._default,this.options=q,this.start=this.now=this.cur(),this.end=re,this.unit=fe||(e.cssNumber[Z]?"":"px")},cur:function(){var O=Ot.propHooks[this.prop];return O&&O.get?O.get(this):Ot.propHooks._default.get(this)},run:function(O){var q,Z=Ot.propHooks[this.prop];return this.pos=q=this.options.duration?e.easing[this.easing](O,this.options.duration*O,0,1,this.options.duration):O,this.now=(this.end-this.start)*q+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),Z&&Z.set?Z.set(this):Ot.propHooks._default.set(this),this}},Ot.prototype.init.prototype=Ot.prototype,Ot.propHooks={_default:{get:function(O){var q;return 1!==O.elem.nodeType||null!=O.elem[O.prop]&&null==O.elem.style[O.prop]?O.elem[O.prop]:(q=e.css(O.elem,O.prop,""))&&"auto"!==q?q:0},set:function(O){e.fx.step[O.prop]?e.fx.step[O.prop](O):1!==O.elem.nodeType||!e.cssHooks[O.prop]&&null==O.elem.style[zt(O.prop)]?O.elem[O.prop]=O.now:e.style(O.elem,O.prop,O.now+O.unit)}}},Ot.propHooks.scrollTop=Ot.propHooks.scrollLeft={set:function(O){O.elem.nodeType&&O.elem.parentNode&&(O.elem[O.prop]=O.now)}},e.easing={linear:function(O){return O},swing:function(O){return.5-Math.cos(O*Math.PI)/2},_default:"swing"},e.fx=Ot.prototype.init,e.fx.step={};var Bt,Vt,ln=/^(?:toggle|show|hide)$/,dn=/queueHooks$/;function Jt(){Vt&&(!1===t.hidden&&m.requestAnimationFrame?m.requestAnimationFrame(Jt):m.setTimeout(Jt,e.fx.interval),e.fx.tick())}function sn(){return m.setTimeout(function(){Bt=void 0}),Bt=Date.now()}function Wt(O,q){var Z,re=0,de={height:O};for(q=q?1:0;re<4;re+=2-q)de["margin"+(Z=pe[re])]=de["padding"+Z]=O;return q&&(de.opacity=de.width=O),de}function En(O,q,Z){for(var re,de=(Qt.tweeners[q]||[]).concat(Qt.tweeners["*"]),fe=0,ve=de.length;fe<ve;fe++)if(re=de[fe].call(Z,q,O))return re}function Qt(O,q,Z){var re,de,fe=0,ve=Qt.prefilters.length,Te=e.Deferred().always(function(){delete Re.elem}),Re=function(){if(de)return!1;for(var ze=Bt||sn(),xe=Math.max(0,ke.startTime+ke.duration-ze),ot=1-(xe/ke.duration||0),vt=0,at=ke.tweens.length;vt<at;vt++)ke.tweens[vt].run(ot);return Te.notifyWith(O,[ke,ot,xe]),ot<1&&at?xe:(at||Te.notifyWith(O,[ke,1,0]),Te.resolveWith(O,[ke]),!1)},ke=Te.promise({elem:O,props:e.extend({},q),opts:e.extend(!0,{specialEasing:{},easing:e.easing._default},Z),originalProperties:q,originalOptions:Z,startTime:Bt||sn(),duration:Z.duration,tweens:[],createTween:function(ze,xe){var Ke=e.Tween(O,ke.opts,ze,xe,ke.opts.specialEasing[ze]||ke.opts.easing);return ke.tweens.push(Ke),Ke},stop:function(ze){var xe=0,Ke=ze?ke.tweens.length:0;if(de)return this;for(de=!0;xe<Ke;xe++)ke.tweens[xe].run(1);return ze?(Te.notifyWith(O,[ke,1,0]),Te.resolveWith(O,[ke,ze])):Te.rejectWith(O,[ke,ze]),this}}),Le=ke.props;for(function Tn(O,q){var Z,re,de,fe,ve;for(Z in O)if(de=q[re=X(Z)],fe=O[Z],Array.isArray(fe)&&(de=fe[1],fe=O[Z]=fe[0]),Z!==re&&(O[re]=fe,delete O[Z]),(ve=e.cssHooks[re])&&"expand"in ve)for(Z in fe=ve.expand(fe),delete O[re],fe)Z in O||(O[Z]=fe[Z],q[Z]=de);else q[re]=de}(Le,ke.opts.specialEasing);fe<ve;fe++)if(re=Qt.prefilters[fe].call(ke,O,Le,ke.opts))return r(re.stop)&&(e._queueHooks(ke.elem,ke.opts.queue).stop=re.stop.bind(re)),re;return e.map(Le,En,ke),r(ke.opts.start)&&ke.opts.start.call(O,ke),ke.progress(ke.opts.progress).done(ke.opts.done,ke.opts.complete).fail(ke.opts.fail).always(ke.opts.always),e.fx.timer(e.extend(Re,{elem:O,anim:ke,queue:ke.opts.queue})),ke}e.Animation=e.extend(Qt,{tweeners:{"*":[function(O,q){var Z=this.createTween(O,q);return De(Z.elem,O,he.exec(q),Z),Z}]},tweener:function(O,q){r(O)?(q=O,O=["*"]):O=O.match(N);for(var Z,re=0,de=O.length;re<de;re++)(Qt.tweeners[Z=O[re]]=Qt.tweeners[Z]||[]).unshift(q)},prefilters:[function wn(O,q,Z){var re,de,fe,ve,Te,Re,ke,Le,ze="width"in q||"height"in q,xe=this,Ke={},ot=O.style,vt=O.nodeType&&Se(O),at=ce.get(O,"fxshow");for(re in Z.queue||(null==(ve=e._queueHooks(O,"fx")).unqueued&&(ve.unqueued=0,Te=ve.empty.fire,ve.empty.fire=function(){ve.unqueued||Te()}),ve.unqueued++,xe.always(function(){xe.always(function(){ve.unqueued--,e.queue(O,"fx").length||ve.empty.fire()})})),q)if(ln.test(de=q[re])){if(delete q[re],fe=fe||"toggle"===de,de===(vt?"hide":"show")){if("show"!==de||!at||void 0===at[re])continue;vt=!0}Ke[re]=at&&at[re]||e.style(O,re)}if((Re=!e.isEmptyObject(q))||!e.isEmptyObject(Ke))for(re in ze&&1===O.nodeType&&(Z.overflow=[ot.overflow,ot.overflowX,ot.overflowY],null==(ke=at&&at.display)&&(ke=ce.get(O,"display")),"none"===(Le=e.css(O,"display"))&&(ke?Le=ke:(qe([O],!0),ke=O.style.display||ke,Le=e.css(O,"display"),qe([O]))),("inline"===Le||"inline-block"===Le&&null!=ke)&&"none"===e.css(O,"float")&&(Re||(xe.done(function(){ot.display=ke}),null==ke&&(ke="none"===(Le=ot.display)?"":Le)),ot.display="inline-block")),Z.overflow&&(ot.overflow="hidden",xe.always(function(){ot.overflow=Z.overflow[0],ot.overflowX=Z.overflow[1],ot.overflowY=Z.overflow[2]})),Re=!1,Ke)Re||(at?"hidden"in at&&(vt=at.hidden):at=ce.access(O,"fxshow",{display:ke}),fe&&(at.hidden=!vt),vt&&qe([O],!0),xe.done(function(){for(re in vt||qe([O]),ce.remove(O,"fxshow"),Ke)e.style(O,re,Ke[re])})),Re=En(vt?at[re]:0,re,xe),re in at||(at[re]=Re.start,vt&&(Re.end=Re.start,Re.start=0))}],prefilter:function(O,q){q?Qt.prefilters.unshift(O):Qt.prefilters.push(O)}}),e.speed=function(O,q,Z){var re=O&&"object"==typeof O?e.extend({},O):{complete:Z||!Z&&q||r(O)&&O,duration:O,easing:Z&&q||q&&!r(q)&&q};return e.fx.off?re.duration=0:"number"!=typeof re.duration&&(re.duration=re.duration in e.fx.speeds?e.fx.speeds[re.duration]:e.fx.speeds._default),(null==re.queue||!0===re.queue)&&(re.queue="fx"),re.old=re.complete,re.complete=function(){r(re.old)&&re.old.call(this),re.queue&&e.dequeue(this,re.queue)},re},e.fn.extend({fadeTo:function(O,q,Z,re){return this.filter(Se).css("opacity",0).show().end().animate({opacity:q},O,Z,re)},animate:function(O,q,Z,re){var de=e.isEmptyObject(O),fe=e.speed(q,Z,re),ve=function(){var Te=Qt(this,e.extend({},O),fe);(de||ce.get(this,"finish"))&&Te.stop(!0)};return ve.finish=ve,de||!1===fe.queue?this.each(ve):this.queue(fe.queue,ve)},stop:function(O,q,Z){var re=function(de){var fe=de.stop;delete de.stop,fe(Z)};return"string"!=typeof O&&(Z=q,q=O,O=void 0),q&&this.queue(O||"fx",[]),this.each(function(){var de=!0,fe=null!=O&&O+"queueHooks",ve=e.timers,Te=ce.get(this);if(fe)Te[fe]&&Te[fe].stop&&re(Te[fe]);else for(fe in Te)Te[fe]&&Te[fe].stop&&dn.test(fe)&&re(Te[fe]);for(fe=ve.length;fe--;)ve[fe].elem===this&&(null==O||ve[fe].queue===O)&&(ve[fe].anim.stop(Z),de=!1,ve.splice(fe,1));(de||!Z)&&e.dequeue(this,O)})},finish:function(O){return!1!==O&&(O=O||"fx"),this.each(function(){var q,Z=ce.get(this),re=Z[O+"queue"],de=Z[O+"queueHooks"],fe=e.timers,ve=re?re.length:0;for(Z.finish=!0,e.queue(this,O,[]),de&&de.stop&&de.stop.call(this,!0),q=fe.length;q--;)fe[q].elem===this&&fe[q].queue===O&&(fe[q].anim.stop(!0),fe.splice(q,1));for(q=0;q<ve;q++)re[q]&&re[q].finish&&re[q].finish.call(this);delete Z.finish})}}),e.each(["toggle","show","hide"],function(O,q){var Z=e.fn[q];e.fn[q]=function(re,de,fe){return null==re||"boolean"==typeof re?Z.apply(this,arguments):this.animate(Wt(q,!0),re,de,fe)}}),e.each({slideDown:Wt("show"),slideUp:Wt("hide"),slideToggle:Wt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(O,q){e.fn[O]=function(Z,re,de){return this.animate(q,Z,re,de)}}),e.timers=[],e.fx.tick=function(){var O,q=0,Z=e.timers;for(Bt=Date.now();q<Z.length;q++)!(O=Z[q])()&&Z[q]===O&&Z.splice(q--,1);Z.length||e.fx.stop(),Bt=void 0},e.fx.timer=function(O){e.timers.push(O),e.fx.start()},e.fx.interval=13,e.fx.start=function(){Vt||(Vt=!0,Jt())},e.fx.stop=function(){Vt=null},e.fx.speeds={slow:600,fast:200,_default:400},e.fn.delay=function(O,q){return O=e.fx&&e.fx.speeds[O]||O,this.queue(q=q||"fx",function(Z,re){var de=m.setTimeout(Z,O);re.stop=function(){m.clearTimeout(de)}})},function(){var O=t.createElement("input"),Z=t.createElement("select").appendChild(t.createElement("option"));O.type="checkbox",i.checkOn=""!==O.value,i.optSelected=Z.selected,(O=t.createElement("input")).value="t",O.type="radio",i.radioValue="t"===O.value}();var ei,Rn=e.expr.attrHandle;e.fn.extend({attr:function(O,q){return ee(this,e.attr,O,q,arguments.length>1)},removeAttr:function(O){return this.each(function(){e.removeAttr(this,O)})}}),e.extend({attr:function(O,q,Z){var re,de,fe=O.nodeType;if(3!==fe&&8!==fe&&2!==fe)return typeof O.getAttribute>"u"?e.prop(O,q,Z):((1!==fe||!e.isXMLDoc(O))&&(de=e.attrHooks[q.toLowerCase()]||(e.expr.match.bool.test(q)?ei:void 0)),void 0!==Z?null===Z?void e.removeAttr(O,q):de&&"set"in de&&void 0!==(re=de.set(O,Z,q))?re:(O.setAttribute(q,Z+""),Z):de&&"get"in de&&null!==(re=de.get(O,q))?re:(re=e.find.attr(O,q))??void 0)},attrHooks:{type:{set:function(O,q){if(!i.radioValue&&"radio"===q&&B(O,"input")){var Z=O.value;return O.setAttribute("type",q),Z&&(O.value=Z),q}}}},removeAttr:function(O,q){var Z,re=0,de=q&&q.match(N);if(de&&1===O.nodeType)for(;Z=de[re++];)O.removeAttribute(Z)}}),ei={set:function(O,q,Z){return!1===q?e.removeAttr(O,Z):O.setAttribute(Z,Z),Z}},e.each(e.expr.match.bool.source.match(/\w+/g),function(O,q){var Z=Rn[q]||e.find.attr;Rn[q]=function(re,de,fe){var ve,Te,Re=de.toLowerCase();return fe||(Te=Rn[Re],Rn[Re]=ve,ve=null!=Z(re,de,fe)?Re:null,Rn[Re]=Te),ve}});var bi=/^(?:input|select|textarea|button)$/i,_i=/^(?:a|area)$/i;function gn(O){return(O.match(N)||[]).join(" ")}function vn(O){return O.getAttribute&&O.getAttribute("class")||""}function Fn(O){return Array.isArray(O)?O:"string"==typeof O&&O.match(N)||[]}e.fn.extend({prop:function(O,q){return ee(this,e.prop,O,q,arguments.length>1)},removeProp:function(O){return this.each(function(){delete this[e.propFix[O]||O]})}}),e.extend({prop:function(O,q,Z){var re,de,fe=O.nodeType;if(3!==fe&&8!==fe&&2!==fe)return(1!==fe||!e.isXMLDoc(O))&&(de=e.propHooks[q=e.propFix[q]||q]),void 0!==Z?de&&"set"in de&&void 0!==(re=de.set(O,Z,q))?re:O[q]=Z:de&&"get"in de&&null!==(re=de.get(O,q))?re:O[q]},propHooks:{tabIndex:{get:function(O){var q=e.find.attr(O,"tabindex");return q?parseInt(q,10):bi.test(O.nodeName)||_i.test(O.nodeName)&&O.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),i.optSelected||(e.propHooks.selected={get:function(O){return null},set:function(O){}}),e.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){e.propFix[this.toLowerCase()]=this}),e.fn.extend({addClass:function(O){var q,Z,re,de,fe,ve,Te,Re=0;if(r(O))return this.each(function(ke){e(this).addClass(O.call(this,ke,vn(this)))});if((q=Fn(O)).length)for(;Z=this[Re++];)if(de=vn(Z),re=1===Z.nodeType&&" "+gn(de)+" "){for(ve=0;fe=q[ve++];)re.indexOf(" "+fe+" ")<0&&(re+=fe+" ");de!==(Te=gn(re))&&Z.setAttribute("class",Te)}return this},removeClass:function(O){var q,Z,re,de,fe,ve,Te,Re=0;if(r(O))return this.each(function(ke){e(this).removeClass(O.call(this,ke,vn(this)))});if(!arguments.length)return this.attr("class","");if((q=Fn(O)).length)for(;Z=this[Re++];)if(de=vn(Z),re=1===Z.nodeType&&" "+gn(de)+" "){for(ve=0;fe=q[ve++];)for(;re.indexOf(" "+fe+" ")>-1;)re=re.replace(" "+fe+" "," ");de!==(Te=gn(re))&&Z.setAttribute("class",Te)}return this},toggleClass:function(O,q){var Z=typeof O,re="string"===Z||Array.isArray(O);return"boolean"==typeof q&&re?q?this.addClass(O):this.removeClass(O):r(O)?this.each(function(de){e(this).toggleClass(O.call(this,de,vn(this),q),q)}):this.each(function(){var de,fe,ve,Te;if(re)for(fe=0,ve=e(this),Te=Fn(O);de=Te[fe++];)ve.hasClass(de)?ve.removeClass(de):ve.addClass(de);else(void 0===O||"boolean"===Z)&&((de=vn(this))&&ce.set(this,"__className__",de),this.setAttribute&&this.setAttribute("class",de||!1===O?"":ce.get(this,"__className__")||""))})},hasClass:function(O){var q,Z,re=0;for(q=" "+O+" ";Z=this[re++];)if(1===Z.nodeType&&(" "+gn(vn(Z))+" ").indexOf(q)>-1)return!0;return!1}});var Si=/\r/g;e.fn.extend({val:function(O){var q,Z,re,de=this[0];return arguments.length?(re=r(O),this.each(function(fe){var ve;1===this.nodeType&&(null==(ve=re?O.call(this,fe,e(this).val()):O)?ve="":"number"==typeof ve?ve+="":Array.isArray(ve)&&(ve=e.map(ve,function(Te){return null==Te?"":Te+""})),(!(q=e.valHooks[this.type]||e.valHooks[this.nodeName.toLowerCase()])||!("set"in q)||void 0===q.set(this,ve,"value"))&&(this.value=ve))})):de?(q=e.valHooks[de.type]||e.valHooks[de.nodeName.toLowerCase()])&&"get"in q&&void 0!==(Z=q.get(de,"value"))?Z:"string"==typeof(Z=de.value)?Z.replace(Si,""):Z??"":void 0}}),e.extend({valHooks:{option:{get:function(O){return e.find.attr(O,"value")??gn(e.text(O))}},select:{get:function(O){var q,Z,re,de=O.options,fe=O.selectedIndex,ve="select-one"===O.type,Te=ve?null:[],Re=ve?fe+1:de.length;for(re=fe<0?Re:ve?fe:0;re<Re;re++)if(((Z=de[re]).selected||re===fe)&&!Z.disabled&&(!Z.parentNode.disabled||!B(Z.parentNode,"optgroup"))){if(q=e(Z).val(),ve)return q;Te.push(q)}return Te},set:function(O,q){for(var Z,re,de=O.options,fe=e.makeArray(q),ve=de.length;ve--;)((re=de[ve]).selected=e.inArray(e.valHooks.option.get(re),fe)>-1)&&(Z=!0);return Z||(O.selectedIndex=-1),fe}}}}),e.each(["radio","checkbox"],function(){e.valHooks[this]={set:function(O,q){if(Array.isArray(q))return O.checked=e.inArray(e(O).val(),q)>-1}},i.checkOn||(e.valHooks[this].get=function(O){return null===O.getAttribute("value")?"on":O.value})}),i.focusin="onfocusin"in m;var ti=/^(?:focusinfocus|focusoutblur)$/,ni=function(O){O.stopPropagation()};e.extend(e.event,{trigger:function(O,q,Z,re){var de,fe,ve,Te,Re,ke,Le,ze,xe=[Z||t],Ke=f.call(O,"type")?O.type:O,ot=f.call(O,"namespace")?O.namespace.split("."):[];if(fe=ze=ve=Z=Z||t,3!==Z.nodeType&&8!==Z.nodeType&&!ti.test(Ke+e.event.triggered)&&(Ke.indexOf(".")>-1&&(ot=Ke.split("."),Ke=ot.shift(),ot.sort()),Re=Ke.indexOf(":")<0&&"on"+Ke,(O=O[e.expando]?O:new e.Event(Ke,"object"==typeof O&&O)).isTrigger=re?2:3,O.namespace=ot.join("."),O.rnamespace=O.namespace?new RegExp("(^|\\.)"+ot.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,O.result=void 0,O.target||(O.target=Z),q=null==q?[O]:e.makeArray(q,[O]),Le=e.event.special[Ke]||{},re||!Le.trigger||!1!==Le.trigger.apply(Z,q))){if(!re&&!Le.noBubble&&!s(Z)){for(ti.test((Te=Le.delegateType||Ke)+Ke)||(fe=fe.parentNode);fe;fe=fe.parentNode)xe.push(fe),ve=fe;ve===(Z.ownerDocument||t)&&xe.push(ve.defaultView||ve.parentWindow||m)}for(de=0;(fe=xe[de++])&&!O.isPropagationStopped();)ze=fe,O.type=de>1?Te:Le.bindType||Ke,(ke=(ce.get(fe,"events")||Object.create(null))[O.type]&&ce.get(fe,"handle"))&&ke.apply(fe,q),(ke=Re&&fe[Re])&&ke.apply&&H(fe)&&(O.result=ke.apply(fe,q),!1===O.result&&O.preventDefault());return O.type=Ke,!re&&!O.isDefaultPrevented()&&(!Le._default||!1===Le._default.apply(xe.pop(),q))&&H(Z)&&Re&&r(Z[Ke])&&!s(Z)&&((ve=Z[Re])&&(Z[Re]=null),e.event.triggered=Ke,O.isPropagationStopped()&&ze.addEventListener(Ke,ni),Z[Ke](),O.isPropagationStopped()&&ze.removeEventListener(Ke,ni),e.event.triggered=void 0,ve&&(Z[Re]=ve)),O.result}},simulate:function(O,q,Z){var re=e.extend(new e.Event,Z,{type:O,isSimulated:!0});e.event.trigger(re,null,q)}}),e.fn.extend({trigger:function(O,q){return this.each(function(){e.event.trigger(O,q,this)})},triggerHandler:function(O,q){var Z=this[0];if(Z)return e.event.trigger(O,q,Z,!0)}}),i.focusin||e.each({focus:"focusin",blur:"focusout"},function(O,q){var Z=function(re){e.event.simulate(q,re.target,e.event.fix(re))};e.event.special[q]={setup:function(){var re=this.ownerDocument||this.document||this,de=ce.access(re,q);de||re.addEventListener(O,Z,!0),ce.access(re,q,(de||0)+1)},teardown:function(){var re=this.ownerDocument||this.document||this,de=ce.access(re,q)-1;de?ce.access(re,q,de):(re.removeEventListener(O,Z,!0),ce.remove(re,q))}}});var In=m.location,ii={guid:Date.now()},jn=/\?/;e.parseXML=function(O){var q,Z;if(!O||"string"!=typeof O)return null;try{q=(new m.DOMParser).parseFromString(O,"text/xml")}catch{}return Z=q&&q.getElementsByTagName("parsererror")[0],(!q||Z)&&e.error("Invalid XML: "+(Z?e.map(Z.childNodes,function(re){return re.textContent}).join("\n"):O)),q};var Ei=/\[\]$/,ri=/\r?\n/g,wi=/^(?:submit|button|image|reset|file)$/i,Ti=/^(?:input|select|textarea|keygen)/i;function Kn(O,q,Z,re){var de;if(Array.isArray(q))e.each(q,function(fe,ve){Z||Ei.test(O)?re(O,ve):Kn(O+"["+("object"==typeof ve&&null!=ve?fe:"")+"]",ve,Z,re)});else if(Z||"object"!==h(q))re(O,q);else for(de in q)Kn(O+"["+de+"]",q[de],Z,re)}e.param=function(O,q){var Z,re=[],de=function(fe,ve){var Te=r(ve)?ve():ve;re[re.length]=encodeURIComponent(fe)+"="+encodeURIComponent(Te??"")};if(null==O)return"";if(Array.isArray(O)||O.jquery&&!e.isPlainObject(O))e.each(O,function(){de(this.name,this.value)});else for(Z in O)Kn(Z,O[Z],q,de);return re.join("&")},e.fn.extend({serialize:function(){return e.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var O=e.prop(this,"elements");return O?e.makeArray(O):this}).filter(function(){var O=this.type;return this.name&&!e(this).is(":disabled")&&Ti.test(this.nodeName)&&!wi.test(O)&&(this.checked||!Be.test(O))}).map(function(O,q){var Z=e(this).val();return null==Z?null:Array.isArray(Z)?e.map(Z,function(re){return{name:q.name,value:re.replace(ri,"\r\n")}}):{name:q.name,value:Z.replace(ri,"\r\n")}}).get()}});var Ri=/%20/g,Ii=/#.*$/,Ci=/([?&])_=[^&]*/,Mi=/^(.*?):[ \t]*([^\r\n]*)$/gm,ki=/^(?:GET|HEAD)$/,Oi=/^\/\//,si={},$n={},oi="*/".concat("*"),Hn=t.createElement("a");function ai(O){return function(q,Z){"string"!=typeof q&&(Z=q,q="*");var re,de=0,fe=q.toLowerCase().match(N)||[];if(r(Z))for(;re=fe[de++];)"+"===re[0]?(re=re.slice(1)||"*",(O[re]=O[re]||[]).unshift(Z)):(O[re]=O[re]||[]).push(Z)}}function ci(O,q,Z,re){var de={},fe=O===$n;function ve(Te){var Re;return de[Te]=!0,e.each(O[Te]||[],function(ke,Le){var ze=Le(q,Z,re);return"string"!=typeof ze||fe||de[ze]?fe?!(Re=ze):void 0:(q.dataTypes.unshift(ze),ve(ze),!1)}),Re}return ve(q.dataTypes[0])||!de["*"]&&ve("*")}function Vn(O,q){var Z,re,de=e.ajaxSettings.flatOptions||{};for(Z in q)void 0!==q[Z]&&((de[Z]?O:re||(re={}))[Z]=q[Z]);return re&&e.extend(!0,O,re),O}Hn.href=In.href,e.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:In.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(In.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":oi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":e.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(O,q){return q?Vn(Vn(O,e.ajaxSettings),q):Vn(e.ajaxSettings,O)},ajaxPrefilter:ai(si),ajaxTransport:ai($n),ajax:function(O,q){"object"==typeof O&&(q=O,O=void 0);var Z,re,de,fe,ve,Te,Re,ke,Le,ze,xe=e.ajaxSetup({},q=q||{}),Ke=xe.context||xe,ot=xe.context&&(Ke.nodeType||Ke.jquery)?e(Ke):e.event,vt=e.Deferred(),at=e.Callbacks("once memory"),Dt=xe.statusCode||{},Pt={},jt={},wt="canceled",ht={readyState:0,getResponseHeader:function(_t){var kt;if(Re){if(!fe)for(fe={};kt=Mi.exec(de);)fe[kt[1].toLowerCase()+" "]=(fe[kt[1].toLowerCase()+" "]||[]).concat(kt[2]);kt=fe[_t.toLowerCase()+" "]}return null==kt?null:kt.join(", ")},getAllResponseHeaders:function(){return Re?de:null},setRequestHeader:function(_t,kt){return null==Re&&(_t=jt[_t.toLowerCase()]=jt[_t.toLowerCase()]||_t,Pt[_t]=kt),this},overrideMimeType:function(_t){return null==Re&&(xe.mimeType=_t),this},statusCode:function(_t){var kt;if(_t)if(Re)ht.always(_t[ht.status]);else for(kt in _t)Dt[kt]=[Dt[kt],_t[kt]];return this},abort:function(_t){var kt=_t||wt;return Z&&Z.abort(kt),Ut(0,kt),this}};if(vt.promise(ht),xe.url=((O||xe.url||In.href)+"").replace(Oi,In.protocol+"//"),xe.type=q.method||q.type||xe.method||xe.type,xe.dataTypes=(xe.dataType||"*").toLowerCase().match(N)||[""],null==xe.crossDomain){Te=t.createElement("a");try{Te.href=xe.url,Te.href=Te.href,xe.crossDomain=Hn.protocol+"//"+Hn.host!=Te.protocol+"//"+Te.host}catch{xe.crossDomain=!0}}if(xe.data&&xe.processData&&"string"!=typeof xe.data&&(xe.data=e.param(xe.data,xe.traditional)),ci(si,xe,q,ht),Re)return ht;for(Le in(ke=e.event&&xe.global)&&0==e.active++&&e.event.trigger("ajaxStart"),xe.type=xe.type.toUpperCase(),xe.hasContent=!ki.test(xe.type),re=xe.url.replace(Ii,""),xe.hasContent?xe.data&&xe.processData&&0===(xe.contentType||"").indexOf("application/x-www-form-urlencoded")&&(xe.data=xe.data.replace(Ri,"+")):(ze=xe.url.slice(re.length),xe.data&&(xe.processData||"string"==typeof xe.data)&&(re+=(jn.test(re)?"&":"?")+xe.data,delete xe.data),!1===xe.cache&&(re=re.replace(Ci,"$1"),ze=(jn.test(re)?"&":"?")+"_="+ii.guid+++ze),xe.url=re+ze),xe.ifModified&&(e.lastModified[re]&&ht.setRequestHeader("If-Modified-Since",e.lastModified[re]),e.etag[re]&&ht.setRequestHeader("If-None-Match",e.etag[re])),(xe.data&&xe.hasContent&&!1!==xe.contentType||q.contentType)&&ht.setRequestHeader("Content-Type",xe.contentType),ht.setRequestHeader("Accept",xe.dataTypes[0]&&xe.accepts[xe.dataTypes[0]]?xe.accepts[xe.dataTypes[0]]+("*"!==xe.dataTypes[0]?", "+oi+"; q=0.01":""):xe.accepts["*"]),xe.headers)ht.setRequestHeader(Le,xe.headers[Le]);if(xe.beforeSend&&(!1===xe.beforeSend.call(Ke,ht,xe)||Re))return ht.abort();if(wt="abort",at.add(xe.complete),ht.done(xe.success),ht.fail(xe.error),Z=ci($n,xe,q,ht)){if(ht.readyState=1,ke&&ot.trigger("ajaxSend",[ht,xe]),Re)return ht;xe.async&&xe.timeout>0&&(ve=m.setTimeout(function(){ht.abort("timeout")},xe.timeout));try{Re=!1,Z.send(Pt,Ut)}catch(_t){if(Re)throw _t;Ut(-1,_t)}}else Ut(-1,"No Transport");function Ut(_t,kt,Mn,Pn){var Kt,mn,yn,Ft,hn,Gt=kt;Re||(Re=!0,ve&&m.clearTimeout(ve),Z=void 0,de=Pn||"",ht.readyState=_t>0?4:0,Kt=_t>=200&&_t<300||304===_t,Mn&&(Ft=function Pi(O,q,Z){for(var re,de,fe,ve,Te=O.contents,Re=O.dataTypes;"*"===Re[0];)Re.shift(),void 0===re&&(re=O.mimeType||q.getResponseHeader("Content-Type"));if(re)for(de in Te)if(Te[de]&&Te[de].test(re)){Re.unshift(de);break}if(Re[0]in Z)fe=Re[0];else{for(de in Z){if(!Re[0]||O.converters[de+" "+Re[0]]){fe=de;break}ve||(ve=de)}fe=fe||ve}if(fe)return fe!==Re[0]&&Re.unshift(fe),Z[fe]}(xe,ht,Mn)),!Kt&&e.inArray("script",xe.dataTypes)>-1&&e.inArray("json",xe.dataTypes)<0&&(xe.converters["text script"]=function(){}),Ft=function Di(O,q,Z,re){var de,fe,ve,Te,Re,ke={},Le=O.dataTypes.slice();if(Le[1])for(ve in O.converters)ke[ve.toLowerCase()]=O.converters[ve];for(fe=Le.shift();fe;)if(O.responseFields[fe]&&(Z[O.responseFields[fe]]=q),!Re&&re&&O.dataFilter&&(q=O.dataFilter(q,O.dataType)),Re=fe,fe=Le.shift())if("*"===fe)fe=Re;else if("*"!==Re&&Re!==fe){if(!(ve=ke[Re+" "+fe]||ke["* "+fe]))for(de in ke)if((Te=de.split(" "))[1]===fe&&(ve=ke[Re+" "+Te[0]]||ke["* "+Te[0]])){!0===ve?ve=ke[de]:!0!==ke[de]&&(fe=Te[0],Le.unshift(Te[1]));break}if(!0!==ve)if(ve&&O.throws)q=ve(q);else try{q=ve(q)}catch(ze){return{state:"parsererror",error:ve?ze:"No conversion from "+Re+" to "+fe}}}return{state:"success",data:q}}(xe,Ft,ht,Kt),Kt?(xe.ifModified&&((hn=ht.getResponseHeader("Last-Modified"))&&(e.lastModified[re]=hn),(hn=ht.getResponseHeader("etag"))&&(e.etag[re]=hn)),204===_t||"HEAD"===xe.type?Gt="nocontent":304===_t?Gt="notmodified":(Gt=Ft.state,mn=Ft.data,Kt=!(yn=Ft.error))):(yn=Gt,(_t||!Gt)&&(Gt="error",_t<0&&(_t=0))),ht.status=_t,ht.statusText=(kt||Gt)+"",Kt?vt.resolveWith(Ke,[mn,Gt,ht]):vt.rejectWith(Ke,[ht,Gt,yn]),ht.statusCode(Dt),Dt=void 0,ke&&ot.trigger(Kt?"ajaxSuccess":"ajaxError",[ht,xe,Kt?mn:yn]),at.fireWith(Ke,[ht,Gt]),ke&&(ot.trigger("ajaxComplete",[ht,xe]),--e.active||e.event.trigger("ajaxStop")))}return ht},getJSON:function(O,q,Z){return e.get(O,q,Z,"json")},getScript:function(O,q){return e.get(O,void 0,q,"script")}}),e.each(["get","post"],function(O,q){e[q]=function(Z,re,de,fe){return r(re)&&(fe=fe||de,de=re,re=void 0),e.ajax(e.extend({url:Z,type:q,dataType:fe,data:re,success:de},e.isPlainObject(Z)&&Z))}}),e.ajaxPrefilter(function(O){var q;for(q in O.headers)"content-type"===q.toLowerCase()&&(O.contentType=O.headers[q]||"")}),e._evalUrl=function(O,q,Z){return e.ajax({url:O,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(re){e.globalEval(re,q,Z)}})},e.fn.extend({wrapAll:function(O){var q;return this[0]&&(r(O)&&(O=O.call(this[0])),q=e(O,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&q.insertBefore(this[0]),q.map(function(){for(var Z=this;Z.firstElementChild;)Z=Z.firstElementChild;return Z}).append(this)),this},wrapInner:function(O){return r(O)?this.each(function(q){e(this).wrapInner(O.call(this,q))}):this.each(function(){var q=e(this),Z=q.contents();Z.length?Z.wrapAll(O):q.append(O)})},wrap:function(O){var q=r(O);return this.each(function(Z){e(this).wrapAll(q?O.call(this,Z):O)})},unwrap:function(O){return this.parent(O).not("body").each(function(){e(this).replaceWith(this.childNodes)}),this}}),e.expr.pseudos.hidden=function(O){return!e.expr.pseudos.visible(O)},e.expr.pseudos.visible=function(O){return!!(O.offsetWidth||O.offsetHeight||O.getClientRects().length)},e.ajaxSettings.xhr=function(){try{return new m.XMLHttpRequest}catch{}};var xi={0:200,1223:204},Cn=e.ajaxSettings.xhr();i.cors=!!Cn&&"withCredentials"in Cn,i.ajax=Cn=!!Cn,e.ajaxTransport(function(O){var q,Z;if(i.cors||Cn&&!O.crossDomain)return{send:function(re,de){var fe,ve=O.xhr();if(ve.open(O.type,O.url,O.async,O.username,O.password),O.xhrFields)for(fe in O.xhrFields)ve[fe]=O.xhrFields[fe];for(fe in O.mimeType&&ve.overrideMimeType&&ve.overrideMimeType(O.mimeType),!O.crossDomain&&!re["X-Requested-With"]&&(re["X-Requested-With"]="XMLHttpRequest"),re)ve.setRequestHeader(fe,re[fe]);q=function(Te){return function(){q&&(q=Z=ve.onload=ve.onerror=ve.onabort=ve.ontimeout=ve.onreadystatechange=null,"abort"===Te?ve.abort():"error"===Te?"number"!=typeof ve.status?de(0,"error"):de(ve.status,ve.statusText):de(xi[ve.status]||ve.status,ve.statusText,"text"!==(ve.responseType||"text")||"string"!=typeof ve.responseText?{binary:ve.response}:{text:ve.responseText},ve.getAllResponseHeaders()))}},ve.onload=q(),Z=ve.onerror=ve.ontimeout=q("error"),void 0!==ve.onabort?ve.onabort=Z:ve.onreadystatechange=function(){4===ve.readyState&&m.setTimeout(function(){q&&Z()})},q=q("abort");try{ve.send(O.hasContent&&O.data||null)}catch(Te){if(q)throw Te}},abort:function(){q&&q()}}}),e.ajaxPrefilter(function(O){O.crossDomain&&(O.contents.script=!1)}),e.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(O){return e.globalEval(O),O}}}),e.ajaxPrefilter("script",function(O){void 0===O.cache&&(O.cache=!1),O.crossDomain&&(O.type="GET")}),e.ajaxTransport("script",function(O){var q,Z;if(O.crossDomain||O.scriptAttrs)return{send:function(re,de){q=e("<script>").attr(O.scriptAttrs||{}).prop({charset:O.scriptCharset,src:O.url}).on("load error",Z=function(fe){q.remove(),Z=null,fe&&de("error"===fe.type?404:200,fe.type)}),t.head.appendChild(q[0])},abort:function(){Z&&Z()}}});var O,li=[],Wn=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var O=li.pop()||e.expando+"_"+ii.guid++;return this[O]=!0,O}}),e.ajaxPrefilter("json jsonp",function(O,q,Z){var re,de,fe,ve=!1!==O.jsonp&&(Wn.test(O.url)?"url":"string"==typeof O.data&&0===(O.contentType||"").indexOf("application/x-www-form-urlencoded")&&Wn.test(O.data)&&"data");if(ve||"jsonp"===O.dataTypes[0])return re=O.jsonpCallback=r(O.jsonpCallback)?O.jsonpCallback():O.jsonpCallback,ve?O[ve]=O[ve].replace(Wn,"$1"+re):!1!==O.jsonp&&(O.url+=(jn.test(O.url)?"&":"?")+O.jsonp+"="+re),O.converters["script json"]=function(){return fe||e.error(re+" was not called"),fe[0]},O.dataTypes[0]="json",de=m[re],m[re]=function(){fe=arguments},Z.always(function(){void 0===de?e(m).removeProp(re):m[re]=de,O[re]&&(O.jsonpCallback=q.jsonpCallback,li.push(re)),fe&&r(de)&&de(fe[0]),fe=de=void 0}),"script"}),i.createHTMLDocument=((O=t.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===O.childNodes.length),e.parseHTML=function(O,q,Z){return"string"!=typeof O?[]:("boolean"==typeof q&&(Z=q,q=!1),q||(i.createHTMLDocument?((re=(q=t.implementation.createHTMLDocument("")).createElement("base")).href=t.location.href,q.head.appendChild(re)):q=t),fe=!Z&&[],(de=J.exec(O))?[q.createElement(de[1])]:(de=ge([O],q,fe),fe&&fe.length&&e(fe).remove(),e.merge([],de.childNodes)));var re,de,fe},e.fn.load=function(O,q,Z){var re,de,fe,ve=this,Te=O.indexOf(" ");return Te>-1&&(re=gn(O.slice(Te)),O=O.slice(0,Te)),r(q)?(Z=q,q=void 0):q&&"object"==typeof q&&(de="POST"),ve.length>0&&e.ajax({url:O,type:de||"GET",dataType:"html",data:q}).done(function(Re){fe=arguments,ve.html(re?e("<div>").append(e.parseHTML(Re)).find(re):Re)}).always(Z&&function(Re,ke){ve.each(function(){Z.apply(this,fe||[Re.responseText,ke,Re])})}),this},e.expr.pseudos.animated=function(O){return e.grep(e.timers,function(q){return O===q.elem}).length},e.offset={setOffset:function(O,q,Z){var re,de,fe,ve,Te,Re,Le=e.css(O,"position"),ze=e(O),xe={};"static"===Le&&(O.style.position="relative"),Te=ze.offset(),fe=e.css(O,"top"),Re=e.css(O,"left"),("absolute"===Le||"fixed"===Le)&&(fe+Re).indexOf("auto")>-1?(ve=(re=ze.position()).top,de=re.left):(ve=parseFloat(fe)||0,de=parseFloat(Re)||0),r(q)&&(q=q.call(O,Z,e.extend({},Te))),null!=q.top&&(xe.top=q.top-Te.top+ve),null!=q.left&&(xe.left=q.left-Te.left+de),"using"in q?q.using.call(O,xe):ze.css(xe)}},e.fn.extend({offset:function(O){if(arguments.length)return void 0===O?this:this.each(function(de){e.offset.setOffset(this,O,de)});var q,Z,re=this[0];return re?re.getClientRects().length?{top:(q=re.getBoundingClientRect()).top+(Z=re.ownerDocument.defaultView).pageYOffset,left:q.left+Z.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var O,q,Z,re=this[0],de={top:0,left:0};if("fixed"===e.css(re,"position"))q=re.getBoundingClientRect();else{for(q=this.offset(),Z=re.ownerDocument,O=re.offsetParent||Z.documentElement;O&&(O===Z.body||O===Z.documentElement)&&"static"===e.css(O,"position");)O=O.parentNode;O&&O!==re&&1===O.nodeType&&((de=e(O).offset()).top+=e.css(O,"borderTopWidth",!0),de.left+=e.css(O,"borderLeftWidth",!0))}return{top:q.top-de.top-e.css(re,"marginTop",!0),left:q.left-de.left-e.css(re,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var O=this.offsetParent;O&&"static"===e.css(O,"position");)O=O.offsetParent;return O||me})}}),e.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(O,q){var Z="pageYOffset"===q;e.fn[O]=function(re){return ee(this,function(de,fe,ve){var Te;if(s(de)?Te=de:9===de.nodeType&&(Te=de.defaultView),void 0===ve)return Te?Te[q]:de[fe];Te?Te.scrollTo(Z?Te.pageXOffset:ve,Z?ve:Te.pageYOffset):de[fe]=ve},O,re,arguments.length)}}),e.each(["top","left"],function(O,q){e.cssHooks[q]=pt(i.pixelPosition,function(Z,re){if(re)return re=qt(Z,q),st.test(re)?e(Z).position()[q]+"px":re})}),e.each({Height:"height",Width:"width"},function(O,q){e.each({padding:"inner"+O,content:q,"":"outer"+O},function(Z,re){e.fn[re]=function(de,fe){var ve=arguments.length&&(Z||"boolean"!=typeof de),Te=Z||(!0===de||!0===fe?"margin":"border");return ee(this,function(Re,ke,Le){var ze;return s(Re)?0===re.indexOf("outer")?Re["inner"+O]:Re.document.documentElement["client"+O]:9===Re.nodeType?(ze=Re.documentElement,Math.max(Re.body["scroll"+O],ze["scroll"+O],Re.body["offset"+O],ze["offset"+O],ze["client"+O])):void 0===Le?e.css(Re,ke,Te):e.style(Re,ke,Le,Te)},q,ve?de:void 0,ve)}})}),e.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(O,q){e.fn[q]=function(Z){return this.on(q,Z)}}),e.fn.extend({bind:function(O,q,Z){return this.on(O,null,q,Z)},unbind:function(O,q){return this.off(O,null,q)},delegate:function(O,q,Z,re){return this.on(q,O,Z,re)},undelegate:function(O,q,Z){return 1===arguments.length?this.off(O,"**"):this.off(q,O||"**",Z)},hover:function(O,q){return this.mouseenter(O).mouseleave(q||O)}}),e.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(O,q){e.fn[q]=function(Z,re){return arguments.length>0?this.on(q,null,Z,re):this.trigger(q)}});var Ni=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;e.proxy=function(O,q){var Z,re,de;if("string"==typeof q&&(Z=O[q],q=O,O=Z),r(O))return re=I.call(arguments,2),de=function(){return O.apply(q||this,re.concat(I.call(arguments)))},de.guid=O.guid=O.guid||e.guid++,de},e.holdReady=function(O){O?e.readyWait++:e.ready(!0)},e.isArray=Array.isArray,e.parseJSON=JSON.parse,e.nodeName=B,e.isFunction=r,e.isWindow=s,e.camelCase=X,e.type=h,e.now=Date.now,e.isNumeric=function(O){var q=e.type(O);return("number"===q||"string"===q)&&!isNaN(O-parseFloat(O))},e.trim=function(O){return null==O?"":(O+"").replace(Ni,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return e});var Li=m.jQuery,Bi=m.$;return e.noConflict=function(O){return m.$===e&&(m.$=Bi),O&&m.jQuery===e&&(m.jQuery=Li),e},typeof ie>"u"&&(m.jQuery=m.$=e),e}),function(m){"function"==typeof define&&define.amd?define(["jquery"],m):m("object"==typeof exports?require("jquery"):jQuery)}(function(m){"use strict";var ie=function(E,_){m.each(["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"],function(u,g){typeof m(E).data(g)<"u"&&((_="object"==typeof _?_:{})[g]=m(E).data(g))}),this.$ns="bootstrap-markdown",this.$element=m(E),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=m.extend(!0,{},m.fn.markdown.defaults,_,this.$element.data("options")),this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};ie.prototype={constructor:ie,__alterButtons:function(E,_){var u="all"==E,g=this;m.each(this.$handler,function(f,v){!1==(!u&&v.indexOf(E)<0)&&_(g.$editor.find('button[data-handler="'+v+'"]'))})},__buildButtons:function(E,_){var d,u=this.$ns,g=this.$handler,f=this.$callback;for(d=0;d<E.length;d++){var v,c=E[d];for(v=0;v<c.length;v++){var i,r=c[v].data,s=m("<div/>",{class:"btn-group"});for(i=0;i<r.length;i++){var n,o,t=r[i],h=u+"-"+t.name,l=this.__getIcon(t),e=t.btnText?t.btnText:"",p=t.btnClass?t.btnClass:"btn",b=t.tabIndex?t.tabIndex:"-1",y=typeof t.hotkey<"u"?t.hotkey:"",w=typeof jQuery.hotkeys<"u"&&""!==y?" ("+y+")":"";(n=m("<button></button>")).text(" "+this.__localize(e)).addClass("btn-default btn-sm").addClass(p),p.match(/btn\-(primary|success|info|warning|danger|link)/)&&n.removeClass("btn-default"),n.attr({type:"button",title:this.__localize(t.title)+w,tabindex:b,"data-provider":u,"data-handler":h,"data-hotkey":y}),!0===t.toggle&&n.attr("data-toggle","button"),(o=m("<span/>")).addClass(l),o.prependTo(n),s.append(n),g.push(h),f.push(t.callback)}_.append(s)}}return _},__setListener:function(){var E=typeof this.$textarea.attr("rows")<"u",_=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",d=E?this.$textarea.attr("rows"):_;this.$textarea.attr("rows",d),this.$options.resize&&this.$textarea.css("resize",this.$options.resize),this.$textarea.data("markdown",this)},__setEventListeners:function(){this.$textarea.on({focus:m.proxy(this.focus,this),keyup:m.proxy(this.keyup,this),change:m.proxy(this.change,this),select:m.proxy(this.select,this)}),this.eventSupported("keydown")&&this.$textarea.on("keydown",m.proxy(this.keydown,this)),this.eventSupported("keypress")&&this.$textarea.on("keypress",m.proxy(this.keypress,this))},__handle:function(E){var _=m(E.currentTarget),d=this.$handler,u=this.$callback,g=_.attr("data-handler"),v=u[d.indexOf(g)];m(E.currentTarget).focus(),v(this),this.change(this),g.indexOf("cmdSave")<0&&this.$textarea.focus(),E.preventDefault()},__localize:function(E){var _=m.fn.markdown.messages,d=this.$options.language;return typeof _<"u"&&typeof _[d]<"u"&&typeof _[d][E]<"u"?_[d][E]:E},__getIcon:function(E){if("object"==typeof E){var _=this.$options.customIcons[E.name];return typeof _>"u"?E.icon[this.$options.iconlibrary]:_}return E},setFullscreen:function(E){var _=this.$editor,d=this.$textarea;!0===E?(_.addClass("md-fullscreen-mode"),m("body").addClass("md-nooverflow"),this.$options.onFullscreen(this)):(_.removeClass("md-fullscreen-mode"),m("body").removeClass("md-nooverflow"),this.$options.onFullscreenExit(this),!0===this.$isPreview&&this.hidePreview().showPreview()),this.$isFullscreen=E,d.focus()},showEditor:function(){var _,E=this,d=this.$ns,u=this.$element,v=(u.css("height"),u.css("width"),this.$editable),c=this.$handler,i=this.$callback,r=this.$options,s=m("<div/>",{class:"md-editor",click:function(){E.focus()}});if(null===this.$editor){var t=m("<div/>",{class:"md-header btn-toolbar"}),n=[];if(r.buttons.length>0&&(n=n.concat(r.buttons[0])),r.additionalButtons.length>0&&m.each(r.additionalButtons[0],function(w,x){var B=m.grep(n,function(J,z){return J.name===x.name});B.length>0?B[0].data=B[0].data.concat(x.data):n.push(r.additionalButtons[0][w])}),r.reorderButtonGroups.length>0&&(n=n.filter(function(w){return r.reorderButtonGroups.indexOf(w.name)>-1}).sort(function(w,x){return r.reorderButtonGroups.indexOf(w.name)<r.reorderButtonGroups.indexOf(x.name)?-1:r.reorderButtonGroups.indexOf(w.name)>r.reorderButtonGroups.indexOf(x.name)?1:0})),n.length>0&&(t=this.__buildButtons([n],t)),r.fullscreen.enable&&t.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(r.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(w){w.preventDefault(),E.setFullscreen(!0)}),s.append(t),u.is("textarea"))u.before(s),(_=u).addClass("md-input"),s.append(_);else{var o="function"==typeof toMarkdown?toMarkdown(u.html()):u.html(),h=m.trim(o);_=m("<textarea/>",{class:"md-input",val:h}),s.append(_),v.el=u,v.type=u.prop("tagName").toLowerCase(),v.content=u.html(),m(u[0].attributes).each(function(){v.attrKeys.push(this.nodeName),v.attrValues.push(this.nodeValue)}),u.replaceWith(s)}var p,l=m("<div/>",{class:"md-footer"}),e=!1;if(r.savable){e=!0;var b="cmdSave";c.push(b),i.push(r.onSave),l.append('<button class="btn btn-success" data-provider="'+d+'" data-handler="'+b+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}if(p="function"==typeof r.footer?r.footer(this):r.footer,""!==m.trim(p)&&(e=!0,l.append(p)),e&&s.append(l),r.width&&"inherit"!==r.width&&(jQuery.isNumeric(r.width)?(s.css("display","table"),_.css("width",r.width+"px")):s.addClass(r.width)),r.height&&"inherit"!==r.height)if(jQuery.isNumeric(r.height)){var y=r.height;t&&(y=Math.max(0,y-t.outerHeight())),l&&(y=Math.max(0,y-l.outerHeight())),_.css("height",y+"px")}else s.addClass(r.height);this.$editor=s,this.$textarea=_,this.$editable=v,this.$oldContent=this.getContent(),this.__setListener(),this.__setEventListeners(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',m.proxy(this.__handle,this)),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this.eventSupported("keydown")&&"object"==typeof jQuery.hotkeys&&t.find('[data-provider="bootstrap-markdown"]').each(function(){var w=m(this),x=w.attr("data-hotkey");""!==x.toLowerCase()&&_.bind("keydown",x,function(){return w.trigger("click"),!1})}),"preview"===r.initialstate?this.showPreview():"fullscreen"===r.initialstate&&r.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();return r.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),r.fullscreen.enable&&!1!==r.fullscreen&&(this.$editor.append('<div class="md-fullscreen-controls"><a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(r.fullscreen.icons.fullscreenOff)+'"></span></a></div>'),this.$editor.on("click",".exit-fullscreen",function(w){w.preventDefault(),E.setFullscreen(!1)})),this.hideButtons(r.hiddenButtons),this.disableButtons(r.disabledButtons),r.dropZoneOptions&&(this.$editor.dropzone?(r.dropZoneOptions.init||(r.dropZoneOptions.init=function(){var w=0;this.on("drop",function(x){w=_.prop("selectionStart")}),this.on("success",function(x,B){var J=_.val();_.val(J.substring(0,w)+"\n![description]("+B+")\n"+J.substring(w))}),this.on("error",function(x,B,J){console.log("Error:",B)})}),this.$editor.addClass("dropzone"),this.$editor.dropzone(r.dropZoneOptions)):console.log("dropZoneOptions was configured, but DropZone was not detected.")),!0===r.enableDropDataUri&&this.$editor.on("drop",function(w){var x=_.prop("selectionStart");w.stopPropagation(),w.preventDefault(),m.each(w.originalEvent.dataTransfer.files,function(B,J){var M,L,z=new FileReader;z.onload=(L=(M=J).type.split("/")[0],function(j){var C=_.val();_.val("image"===L?C.substring(0,x)+'\n<img src="'+j.target.result+'" />\n'+C.substring(x):C.substring(0,x)+'\n<a href="'+j.target.result+'">Download '+M.name+"</a>\n"+C.substring(x))}),z.readAsDataURL(J)})}),r.onShow(this),this},parseContent:function(E){return E=E||this.$textarea.val(),this.$options.parser?this.$options.parser(E):"object"==typeof markdown?markdown.toHTML(E):"function"==typeof marked?marked(E):E},showPreview:function(){var g,f,E=this.$options,_=this.$textarea,d=_.next(),u=m("<div/>",{class:"md-preview","data-provider":"markdown-preview"});return!0===this.$isPreview||(this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),g="string"==typeof(f=E.onPreview(this,u))?f:this.parseContent(),u.html(g),d&&"md-footer"==d.attr("class")?u.insertBefore(d):_.parent().append(u),u.css({width:_.outerWidth()+"px","min-height":_.outerHeight()+"px",height:"auto"}),this.$options.resize&&u.css("resize",this.$options.resize),_.hide(),u.data("markdown",this),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all"))),this},hidePreview:function(){return this.$isPreview=!1,this.$editor.find('div[data-provider="markdown-preview"]').remove(),this.enableButtons("all"),this.disableButtons(this.$options.disabledButtons),this.$options.onPreviewEnd(this),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(E){return this.$textarea.val(E),this},findSelection:function(E){var d;if((d=this.getContent().indexOf(E))>=0&&E.length>0){var g,u=this.getSelection();return this.setSelection(d,d+E.length),g=this.getSelection(),this.setSelection(u.start,u.end),g}return null},getSelection:function(){var E=this.$textarea[0];return("selectionStart"in E&&function(){var _=E.selectionEnd-E.selectionStart;return{start:E.selectionStart,end:E.selectionEnd,length:_,text:E.value.substr(E.selectionStart,_)}}||function(){return null})()},setSelection:function(E,_){var d=this.$textarea[0];return("selectionStart"in d&&function(){d.selectionStart=E,d.selectionEnd=_}||function(){return null})()},replaceSelection:function(E){var _=this.$textarea[0];return("selectionStart"in _&&function(){return _.value=_.value.substr(0,_.selectionStart)+E+_.value.substr(_.selectionEnd,_.value.length),_.selectionStart=_.value.length,this}||function(){return _.value+=E,jQuery(_)})()},getNextTab:function(){if(0===this.$nextTab.length)return null;var E,_=this.$nextTab.shift();return"function"==typeof _?E=_():"object"==typeof _&&_.length>0&&(E=_),E},setNextTab:function(E,_){if("string"==typeof E){var d=this;this.$nextTab.push(function(){return d.findSelection(E)})}else if("number"==typeof E&&"number"==typeof _){var u=this.getSelection();this.setSelection(E,_),this.$nextTab.push(this.getSelection()),this.setSelection(u.start,u.end)}},__parseButtonNameParam:function(E){return"string"==typeof E?E.split(" "):E},enableButtons:function(E){var _=this.__parseButtonNameParam(E),d=this;return m.each(_,function(u,g){d.__alterButtons(_[u],function(f){f.removeAttr("disabled")})}),this},disableButtons:function(E){var _=this.__parseButtonNameParam(E),d=this;return m.each(_,function(u,g){d.__alterButtons(_[u],function(f){f.attr("disabled","disabled")})}),this},hideButtons:function(E){var _=this.__parseButtonNameParam(E),d=this;return m.each(_,function(u,g){d.__alterButtons(_[u],function(f){f.addClass("hidden")})}),this},showButtons:function(E){var _=this.__parseButtonNameParam(E),d=this;return m.each(_,function(u,g){d.__alterButtons(_[u],function(f){f.removeClass("hidden")})}),this},eventSupported:function(E){var _=E in this.$element;return _||(this.$element.setAttribute(E,"return;"),_="function"==typeof this.$element[E]),_},keyup:function(E){var _=!1;switch(E.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var d;if(null!==(d=this.getNextTab())){var u=this;setTimeout(function(){u.setSelection(d.start,d.end)},500),_=!0}else{var g=this.getSelection();g.start==g.end&&g.end==this.getContent().length?_=!1:(this.setSelection(this.getContent().length,this.getContent().length),_=!0)}break;case 13:_=!1;for(var f=this.getContent().split(""),v=this.getSelection().start,c=-1,i=v-2;i>=0;i--)if("\n"===f[i]){c=i;break}if("---"==f.slice(c+1,c+4).join(""))break;var r=f[c+1];if("-"===r)this.addBullet(v);else if(m.isNumeric(r)){var s=this.getBulletNumber(c+1);s&&this.addNumberedBullet(v,s)}break;case 27:this.$isFullscreen&&this.setFullscreen(!1),_=!1;break;default:_=!1}_&&(E.stopPropagation(),E.preventDefault()),this.$options.onChange(this)},insertContent:function(E,_){var d=this.getContent().slice(0,E),u=this.getContent().slice(E+1);this.setContent(d.concat(_).concat(u))},addBullet:function(E){this.insertContent(E,"- \n"),this.setSelection(E+2,E+2)},addNumberedBullet:function(E,_){this.insertContent(E,_+1+". \n");var u=_.toString().length+2;this.setSelection(E+u,E+u)},getBulletNumber:function(E){var _=this.getContent().slice(E).split(".")[0];return m.isNumeric(_)?parseInt(_):null},change:function(E){return this.$options.onChange(this),this},select:function(E){return this.$options.onSelect(this),this},focus:function(E){var _=this.$options,u=this.$editor;return u.addClass("active"),m(document).find(".md-editor").each(function(){var g;m(this).attr("id")!==u.attr("id")&&(null===(g=m(this).find("textarea").data("markdown"))&&(g=m(this).find('div[data-provider="markdown-preview"]').data("markdown")),g&&g.blur())}),_.onFocus(this),this},blur:function(E){var _=this.$options,d=_.hideable,u=this.$editor,g=this.$editable;if(u.hasClass("active")||0===this.$element.parent().length){if(u.removeClass("active"),d)if(null!==g.el){var f=m("<"+g.type+"/>"),v=this.getContent(),c=this.parseContent(v);m(g.attrKeys).each(function(i,r){f.attr(g.attrKeys[i],g.attrValues[i])}),f.html(c),u.replaceWith(f)}else u.hide();_.onBlur(this)}return this}};var a=m.fn.markdown;m.fn.markdown=function(E){return this.each(function(){var _=m(this),d=_.data("markdown");d||_.data("markdown",d=new ie(this,"object"==typeof E&&E))})},m.fn.markdown.messages={},m.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",parser:null,dropZoneOptions:null,enableDropDataUri:!1,buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold","fa-5":"fas fa-bold",octicons:"octicon octicon-bold"},callback:function(E){var _,d,u=E.getSelection(),g=E.getContent();_=0===u.length?E.__localize("strong text"):u.text,"**"===g.substr(u.start-2,2)&&"**"===g.substr(u.end,2)?(E.setSelection(u.start-2,u.end+2),E.replaceSelection(_),d=u.start-2):(E.replaceSelection("**"+_+"**"),d=u.start+2),E.setSelection(d,d+_.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic","fa-5":"fas fa-italic",octicons:"octicon octicon-italic"},callback:function(E){var _,d,u=E.getSelection(),g=E.getContent();_=0===u.length?E.__localize("emphasized text"):u.text,"_"===g.substr(u.start-1,1)&&"_"===g.substr(u.end,1)?(E.setSelection(u.start-1,u.end+1),E.replaceSelection(_),d=u.start-1):(E.replaceSelection("_"+_+"_"),d=u.start+1),E.setSelection(d,d+_.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font","fa-5":"fas fa-heading",octicons:"octicon octicon-text-size"},callback:function(E){var _,d,f,v,u=E.getSelection(),g=E.getContent();_=0===u.length?E.__localize("heading text"):u.text+"\n","### "===g.substr(u.start-(f=4),f)||"###"===g.substr(u.start-(f=3),f)?(E.setSelection(u.start-f,u.end),E.replaceSelection(_),d=u.start-f):u.start>0&&(v=g.substr(u.start-1,1))&&"\n"!=v?(E.replaceSelection("\n\n### "+_),d=u.start+6):(E.replaceSelection("### "+_),d=u.start+4),E.setSelection(d,d+_.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link","fa-5":"fas fa-link",octicons:"octicon octicon-link"},callback:function(E){var _,d,f,u=E.getSelection();E.getContent(),_=0===u.length?E.__localize("enter link description here"):u.text,f=prompt(E.__localize("Insert Hyperlink"),"http://");var v=new RegExp("^((http|https)://|(mailto:)|(//))[a-z0-9]","i");if(null!==f&&""!==f&&"http://"!==f&&v.test(f)){var c=m("<div>"+f+"</div>").text();E.replaceSelection("["+_+"]("+c+")"),E.setSelection(d=u.start+1,d+_.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture","fa-5":"far fa-image",octicons:"octicon octicon-file-media"},callback:function(E){var _,d,f,u=E.getSelection();E.getContent(),_=0===u.length?E.__localize("enter image description here"):u.text,f=prompt(E.__localize("Insert Image Hyperlink"),"http://");var v=new RegExp("^((http|https)://|(//))[a-z0-9]","i");if(null!==f&&""!==f&&"http://"!==f&&v.test(f)){var c=m("<div>"+f+"</div>").text();E.replaceSelection("!["+_+"]("+c+' "'+E.__localize("enter image title here")+'")'),d=u.start+2,E.setNextTab(E.__localize("enter image title here")),E.setSelection(d,d+_.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul","fa-5":"fas fa-list-ul",octicons:"octicon octicon-list-unordered"},callback:function(E){var _,d,u=E.getSelection();if(E.getContent(),0===u.length)_=E.__localize("list text here"),E.replaceSelection("- "+_),d=u.start+2;else if(u.text.indexOf("\n")<0)E.replaceSelection("- "+(_=u.text)),d=u.start+2;else{var f=[];_=(f=u.text.split("\n"))[0],m.each(f,function(v,c){f[v]="- "+c}),E.replaceSelection("\n\n"+f.join("\n")),d=u.start+4}E.setSelection(d,d+_.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol","fa-5":"fas fa-list-ol",octicons:"octicon octicon-list-ordered"},callback:function(E){var _,d,u=E.getSelection();if(E.getContent(),0===u.length)_=E.__localize("list text here"),E.replaceSelection("1. "+_),d=u.start+3;else if(u.text.indexOf("\n")<0)E.replaceSelection("1. "+(_=u.text)),d=u.start+3;else{var f=1,v=[];_=(v=u.text.split("\n"))[0],m.each(v,function(c,i){v[c]=f+". "+i,f++}),E.replaceSelection("\n\n"+v.join("\n")),d=u.start+5}E.setSelection(d,d+_.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-console",fa:"fa fa-code","fa-3":"icon-code","fa-5":"fas fa-code",octicons:"octicon octicon-code"},callback:function(E){var _,d,u=E.getSelection(),g=E.getContent();_=0===u.length?E.__localize("code text here"):u.text,"```\n"===g.substr(u.start-4,4)&&"\n```"===g.substr(u.end,4)?(E.setSelection(u.start-4,u.end+4),E.replaceSelection(_),d=u.start-4):"`"===g.substr(u.start-1,1)&&"`"===g.substr(u.end,1)?(E.setSelection(u.start-1,u.end+1),E.replaceSelection(_),d=u.start-1):g.indexOf("\n")>-1?(E.replaceSelection("```\n"+_+"\n```"),d=u.start+4):(E.replaceSelection("`"+_+"`"),d=u.start+1),E.setSelection(d,d+_.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left","fa-5":"fas fa-quote-left",octicons:"octicon octicon-quote"},callback:function(E){var _,d,u=E.getSelection();if(E.getContent(),0===u.length)_=E.__localize("quote here"),E.replaceSelection("> "+_),d=u.start+2;else if(u.text.indexOf("\n")<0)E.replaceSelection("> "+(_=u.text)),d=u.start+2;else{var f=[];_=(f=u.text.split("\n"))[0],m.each(f,function(v,c){f[v]="> "+c}),E.replaceSelection("\n\n"+f.join("\n")),d=u.start+4}E.setSelection(d,d+_.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search","fa-5":"fas fa-search",octicons:"octicon octicon-search"},callback:function(E){!1===E.$isPreview?E.showPreview():E.hidePreview()}}]}]],customIcons:{},additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{name:"fullscreenOn",icon:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full","fa-5":"fas fa-expand-arrows-alt",octicons:"octicon octicon-link-external"}},fullscreenOff:{name:"fullscreenOff",icon:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small","fa-5":"fas fa-compress",octicons:"octicon octicon-browser"}}}},onShow:function(E){},onPreview:function(E){},onPreviewEnd:function(E){},onSave:function(E){},onBlur:function(E){},onFocus:function(E){},onChange:function(E){},onFullscreen:function(E){},onFullscreenExit:function(E){},onSelect:function(E){}},m.fn.markdown.Constructor=ie,m.fn.markdown.noConflict=function(){return m.fn.markdown=a,this};var R=function(E){var _=E;_.data("markdown")?_.data("markdown").showEditor():_.markdown()};m(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(E){R(m(this)),E.preventDefault()}).on("click focusin",function(E){var _;_=m(document.activeElement),m(document).find(".md-editor").each(function(){var d=m(this),u=_.closest(".md-editor")[0]===this,g=d.find("textarea").data("markdown")||d.find('div[data-provider="markdown-preview"]').data("markdown");g&&!u&&g.blur()})}).ready(function(){m('textarea[data-provide="markdown"]').each(function(){R(m(this))})})});var _self=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{},Prism=function(m){var ie=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,R={},I={manual:m.Prism&&m.Prism.manual,disableWorkerMessageHandler:m.Prism&&m.Prism.disableWorkerMessageHandler,util:{encode:function s(t){return t instanceof E?new E(t.type,s(t.content),t.alias):Array.isArray(t)?t.map(s):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(s){return Object.prototype.toString.call(s).slice(8,-1)},objId:function(s){return s.__id||Object.defineProperty(s,"__id",{value:++a}),s.__id},clone:function s(t,n){var o,h;switch(n=n||{},I.util.type(t)){case"Object":if(h=I.util.objId(t),n[h])return n[h];for(var l in n[h]=o={},t)t.hasOwnProperty(l)&&(o[l]=s(t[l],n));return o;case"Array":return h=I.util.objId(t),n[h]?n[h]:(n[h]=o=[],t.forEach(function(e,p){o[p]=s(e,n)}),o);default:return t}},getLanguage:function(s){for(;s;){var t=ie.exec(s.className);if(t)return t[1].toLowerCase();s=s.parentElement}return"none"},setLanguage:function(s,t){s.className=s.className.replace(RegExp(ie,"gi"),""),s.classList.add("language-"+t)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(o){var s=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(o.stack)||[])[1];if(s){var t=document.getElementsByTagName("script");for(var n in t)if(t[n].src==s)return t[n]}return null}},isActive:function(s,t,n){for(var o="no-"+t;s;){var h=s.classList;if(h.contains(t))return!0;if(h.contains(o))return!1;s=s.parentElement}return!!n}},languages:{plain:R,plaintext:R,text:R,txt:R,extend:function(s,t){var n=I.util.clone(I.languages[s]);for(var o in t)n[o]=t[o];return n},insertBefore:function(s,t,n,o){var h=(o=o||I.languages)[s],l={};for(var e in h)if(h.hasOwnProperty(e)){if(e==t)for(var p in n)n.hasOwnProperty(p)&&(l[p]=n[p]);n.hasOwnProperty(e)||(l[e]=h[e])}var b=o[s];return o[s]=l,I.languages.DFS(I.languages,function(y,w){w===b&&y!=s&&(this[y]=l)}),l},DFS:function s(t,n,o,h){h=h||{};var l=I.util.objId;for(var e in t)if(t.hasOwnProperty(e)){n.call(t,e,t[e],o||e);var p=t[e],b=I.util.type(p);"Object"!==b||h[l(p)]?"Array"===b&&!h[l(p)]&&(h[l(p)]=!0,s(p,n,e,h)):(h[l(p)]=!0,s(p,n,null,h))}}},plugins:{},highlightAll:function(s,t){I.highlightAllUnder(document,s,t)},highlightAllUnder:function(s,t,n){var o={callback:n,container:s,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};I.hooks.run("before-highlightall",o),o.elements=Array.prototype.slice.apply(o.container.querySelectorAll(o.selector)),I.hooks.run("before-all-elements-highlight",o);for(var l,h=0;l=o.elements[h++];)I.highlightElement(l,!0===t,o.callback)},highlightElement:function(s,t,n){var o=I.util.getLanguage(s),h=I.languages[o];I.util.setLanguage(s,o);var l=s.parentElement;l&&"pre"===l.nodeName.toLowerCase()&&I.util.setLanguage(l,o);var p={element:s,language:o,grammar:h,code:s.textContent};function b(w){p.highlightedCode=w,I.hooks.run("before-insert",p),p.element.innerHTML=p.highlightedCode,I.hooks.run("after-highlight",p),I.hooks.run("complete",p),n&&n.call(p.element)}if(I.hooks.run("before-sanity-check",p),(l=p.element.parentElement)&&"pre"===l.nodeName.toLowerCase()&&!l.hasAttribute("tabindex")&&l.setAttribute("tabindex","0"),!p.code)return I.hooks.run("complete",p),void(n&&n.call(p.element));if(I.hooks.run("before-highlight",p),p.grammar)if(t&&m.Worker){var y=new Worker(I.filename);y.onmessage=function(w){b(w.data)},y.postMessage(JSON.stringify({language:p.language,code:p.code,immediateClose:!0}))}else b(I.highlight(p.code,p.grammar,p.language));else b(I.util.encode(p.code))},highlight:function(s,t,n){var o={code:s,grammar:t,language:n};if(I.hooks.run("before-tokenize",o),!o.grammar)throw new Error('The language "'+o.language+'" has no grammar.');return o.tokens=I.tokenize(o.code,o.grammar),I.hooks.run("after-tokenize",o),E.stringify(I.util.encode(o.tokens),o.language)},tokenize:function(s,t){var n=t.rest;if(n){for(var o in n)t[o]=n[o];delete t.rest}var h=new u;return g(h,h.head,s),d(s,h,t,h.head,0),function v(s){for(var t=[],n=s.head.next;n!==s.tail;)t.push(n.value),n=n.next;return t}(h)},hooks:{all:{},add:function(s,t){var n=I.hooks.all;n[s]=n[s]||[],n[s].push(t)},run:function(s,t){var n=I.hooks.all[s];if(n&&n.length)for(var h,o=0;h=n[o++];)h(t)}},Token:E};function E(s,t,n,o){this.type=s,this.content=t,this.alias=n,this.length=0|(o||"").length}function _(s,t,n,o){s.lastIndex=t;var h=s.exec(n);if(h&&o&&h[1]){var l=h[1].length;h.index+=l,h[0]=h[0].slice(l)}return h}function d(s,t,n,o,h,l){for(var e in n)if(n.hasOwnProperty(e)&&n[e]){var p=n[e];p=Array.isArray(p)?p:[p];for(var b=0;b<p.length;++b){if(l&&l.cause==e+","+b)return;var y=p[b],w=y.inside,x=!!y.lookbehind,B=!!y.greedy,J=y.alias;if(B&&!y.pattern.global){var z=y.pattern.toString().match(/[imsuy]*$/)[0];y.pattern=RegExp(y.pattern.source,z+"g")}for(var M=y.pattern||y,L=o.next,j=h;L!==t.tail&&!(l&&j>=l.reach);j+=L.value.length,L=L.next){var C=L.value;if(t.length>s.length)return;if(!(C instanceof E)){var V,F=1;if(B){if(!(V=_(M,j,s,x))||V.index>=s.length)break;var U=V.index,N=V.index+V[0].length,T=j;for(T+=L.value.length;U>=T;)T+=(L=L.next).value.length;if(j=T-=L.value.length,L.value instanceof E)continue;for(var S=L;S!==t.tail&&(T<N||"string"==typeof S.value);S=S.next)F++,T+=S.value.length;F--,C=s.slice(j,T),V.index-=j}else if(!(V=_(M,0,C,x)))continue;var W=V[0],k=C.slice(0,U=V.index),D=C.slice(U+W.length),Q=j+C.length;l&&Q>l.reach&&(l.reach=Q);var ee=L.prev;if(k&&(ee=g(t,ee,k),j+=k.length),f(t,ee,F),L=g(t,ee,new E(e,w?I.tokenize(W,w):W,J,W)),D&&g(t,L,D),F>1){var ue={cause:e+","+b,reach:Q};d(s,t,n,L.prev,j,ue),l&&ue.reach>l.reach&&(l.reach=ue.reach)}}}}}}function u(){var s={value:null,prev:null,next:null},t={value:null,prev:s,next:null};s.next=t,this.head=s,this.tail=t,this.length=0}function g(s,t,n){var o=t.next,h={value:n,prev:t,next:o};return t.next=h,o.prev=h,s.length++,h}function f(s,t,n){for(var o=t.next,h=0;h<n&&o!==s.tail;h++)o=o.next;t.next=o,o.prev=t,s.length-=h}if(m.Prism=I,E.stringify=function s(t,n){if("string"==typeof t)return t;if(Array.isArray(t)){var o="";return t.forEach(function(b){o+=s(b,n)}),o}var h={type:t.type,content:s(t.content,n),tag:"span",classes:["token",t.type],attributes:{},language:n},l=t.alias;l&&(Array.isArray(l)?Array.prototype.push.apply(h.classes,l):h.classes.push(l)),I.hooks.run("wrap",h);var e="";for(var p in h.attributes)e+=" "+p+'="'+(h.attributes[p]||"").replace(/"/g,"&quot;")+'"';return"<"+h.tag+' class="'+h.classes.join(" ")+'"'+e+">"+h.content+"</"+h.tag+">"},!m.document)return m.addEventListener&&(I.disableWorkerMessageHandler||m.addEventListener("message",function(s){var t=JSON.parse(s.data),n=t.language,h=t.immediateClose;m.postMessage(I.highlight(t.code,I.languages[n],n)),h&&m.close()},!1)),I;var c=I.util.currentScript();function i(){I.manual||I.highlightAll()}if(c&&(I.filename=c.src,c.hasAttribute("data-manual")&&(I.manual=!0)),!I.manual){var r=document.readyState;"loading"===r||"interactive"===r&&c&&c.defer?document.addEventListener("DOMContentLoaded",i):window.requestAnimationFrame?window.requestAnimationFrame(i):window.setTimeout(i,16)}return I}(_self);typeof module<"u"&&module.exports&&(module.exports=Prism),typeof global<"u"&&(global.Prism=Prism),Prism.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity,Prism.languages.markup.doctype.inside["internal-subset"].inside=Prism.languages.markup,Prism.hooks.add("wrap",function(m){"entity"===m.type&&(m.attributes.title=m.content.replace(/&amp;/,"&"))}),Object.defineProperty(Prism.languages.markup.tag,"addInlined",{value:function(ie,a){var R={};R["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[a]},R.cdata=/^<!\[CDATA\[|\]\]>$/i;var I={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:R}};I["language-"+a]={pattern:/[\s\S]+/,inside:Prism.languages[a]};var E={};E[ie]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return ie}),"i"),lookbehind:!0,greedy:!0,inside:I},Prism.languages.insertBefore("markup","cdata",E)}}),Object.defineProperty(Prism.languages.markup.tag,"addAttribute",{value:function(m,ie){Prism.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+m+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[ie,"language-"+ie],inside:Prism.languages[ie]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.xml=Prism.languages.extend("markup",{}),Prism.languages.ssml=Prism.languages.xml,Prism.languages.atom=Prism.languages.xml,Prism.languages.rss=Prism.languages.xml,function(m){var ie=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;m.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+ie.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+ie.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+ie.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+ie.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:ie,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},m.languages.css.atrule.inside.rest=m.languages.css;var a=m.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))}(Prism),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),Prism.languages.js=Prism.languages.javascript,function(){if(!(typeof Prism>"u"||typeof document>"u")){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var R={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},I="data-src-status",E="loading",_="loaded",u="pre[data-src]:not(["+I+'="'+_+'"]):not(['+I+'="'+E+'"])';Prism.hooks.add("before-highlightall",function(c){c.selector+=", "+u}),Prism.hooks.add("before-sanity-check",function(c){var i=c.element;if(i.matches(u)){c.code="",i.setAttribute(I,E);var r=i.appendChild(document.createElement("CODE"));r.textContent="Loading\u2026";var s=i.getAttribute("data-src"),t=c.language;if("none"===t){var n=(/\.(\w+)$/.exec(s)||[,"none"])[1];t=R[n]||n}Prism.util.setLanguage(r,t),Prism.util.setLanguage(i,t);var o=Prism.plugins.autoloader;o&&o.loadLanguages(t),function g(c,i,r){var s=new XMLHttpRequest;s.open("GET",c,!0),s.onreadystatechange=function(){4==s.readyState&&(s.status<400&&s.responseText?i(s.responseText):r(s.status>=400?function(c,i){return"\u2716 Error "+c+" while fetching file: "+i}(s.status,s.statusText):"\u2716 Error: File does not exist or is empty"))},s.send(null)}(s,function(h){i.setAttribute(I,_);var l=function f(c){var i=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(c||"");if(i){var r=Number(i[1]),t=i[3];return i[2]?t?[r,Number(t)]:[r,void 0]:[r,r]}}(i.getAttribute("data-range"));if(l){var e=h.split(/\r\n?|\n/g),p=l[0],b=null==l[1]?e.length:l[1];p<0&&(p+=e.length),p=Math.max(0,Math.min(p-1,e.length)),b<0&&(b+=e.length),b=Math.max(0,Math.min(b,e.length)),h=e.slice(p,b).join("\n"),i.hasAttribute("data-start")||i.setAttribute("data-start",String(p+1))}r.textContent=h,Prism.highlightElement(r)},function(h){i.setAttribute(I,"failed"),r.textContent=h})}}),Prism.plugins.fileHighlight={highlight:function(i){for(var t,r=(i||document).querySelectorAll(u),s=0;t=r[s++];)Prism.highlightElement(t)}};var v=!1;Prism.fileHighlight=function(){v||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),v=!0),Prism.plugins.fileHighlight.highlight.apply(this,arguments)}}}(),function(m){var ie=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;m.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:[^;{\\s\"']|\\s+(?!\\s)|"+ie.source+")*?(?:;|(?=\\s*\\{))"),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+ie.source+"|(?:[^\\\\\r\n()\"']|\\\\[^])*)\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+ie.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+ie.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:ie,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},m.languages.css.atrule.inside.rest=m.languages.css;var a=m.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))}(Prism),Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp("(^|[^\\w$])(?:NaN|Infinity|0[bB][01]+(?:_[01]+)*n?|0[oO][0-7]+(?:_[0-7]+)*n?|0[xX][\\dA-Fa-f]+(?:_[\\dA-Fa-f]+)*n?|\\d+(?:_\\d+)*n|(?:\\d+(?:_\\d+)*(?:\\.(?:\\d+(?:_\\d+)*)?)?|\\.\\d+(?:_\\d+)*)(?:[Ee][+-]?\\d+(?:_\\d+)*)?)(?![\\w$])"),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp("((?:^|[^$\\w\\xA0-\\uFFFF.\"'\\])\\s]|\\b(?:return|yield))\\s*)/(?:(?:\\[(?:[^\\]\\\\\r\n]|\\\\.)*\\]|\\\\.|[^/\\\\\\[\r\n])+/[dgimyus]{0,7}|(?:\\[(?:[^[\\]\\\\\r\n]|\\\\.|\\[(?:[^[\\]\\\\\r\n]|\\\\.|\\[(?:[^[\\]\\\\\r\n]|\\\\.)*\\])*\\])*\\]|\\\\.|[^/\\\\\\[\r\n])+/[dgimyus]{0,7}v[dgimyus]{0,7})(?=(?:\\s|/\\*(?:[^*]|\\*(?!/))*\\*/)*(?:$|[\r\n,.;:})\\]]|//))"),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute("on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)","javascript")),Prism.languages.js=Prism.languages.javascript,function(m){m.languages.typescript=m.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),m.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete m.languages.typescript.parameter,delete m.languages.typescript["literal-property"];var ie=m.languages.extend("typescript",{});delete ie["class-name"],m.languages.typescript["class-name"].inside=ie,m.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:ie}}}}),m.languages.ts=m.languages.typescript}(Prism),function m(ie,a,R){function I(d,u){if(!a[d]){if(!ie[d]){var g="function"==typeof require&&require;if(!u&&g)return g(d,!0);if(E)return E(d,!0);var f=new Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f}var v=a[d]={exports:{}};ie[d][0].call(v.exports,function(c){return I(ie[d][1][c]||c)},v,v.exports,m,ie,a,R)}return a[d].exports}for(var E="function"==typeof require&&require,_=0;_<R.length;_++)I(R[_]);return I}({1:[function(m,ie,a){"use strict";for(var R=/[\\\"\x00-\x1F]/g,I={},E=0;E<32;++E)I[String.fromCharCode(E)]="\\U"+("0000"+E.toString(16)).slice(-4).toUpperCase();function _(f){return R.lastIndex=0,f.replace(R,function(v){return I[v]})}I["\b"]="\\b",I["\t"]="\\t",I["\n"]="\\n",I["\f"]="\\f",I["\r"]="\\r",I['"']='\\"',I["\\"]="\\\\",ie.exports={stringify:function d(f){switch(typeof f){case"string":return'"'+_(f)+'"';case"number":return isFinite(f)?f:"null";case"boolean":return f;case"object":return null===f?"null":Array.isArray(f)?function u(f){for(var v="[",c="",i=0;i<f.length;++i)c+=v,v=",",c+=d(f[i]);return","!=v?"[]":c+"]"}(f):function g(f){var v="{",c="",i=Object.keys(f);i.sort();for(var r=0;r<i.length;++r){var s=i[r];c+=v+'"'+_(s)+'":',v=",",c+=d(f[s])}return","!=v?"{}":c+"}"}(f);default:throw new Error("Cannot stringify: "+typeof f)}}}},{}],2:[function(m,ie,a){"use strict";const R=a;R.bignum=m("bn.js"),R.define=m("./asn1/api").define,R.base=m("./asn1/base"),R.constants=m("./asn1/constants"),R.decoders=m("./asn1/decoders"),R.encoders=m("./asn1/encoders")},{"./asn1/api":3,"./asn1/base":5,"./asn1/constants":9,"./asn1/decoders":11,"./asn1/encoders":14,"bn.js":18}],3:[function(m,ie,a){"use strict";const R=m("./encoders"),I=m("./decoders"),E=m("inherits");function d(u,g){this.name=u,this.body=g,this.decoders={},this.encoders={}}a.define=function(g,f){return new d(g,f)},d.prototype._createNamed=function(g){const f=this.name;function v(c){this._initNamed(c,f)}return E(v,g),v.prototype._initNamed=function(i,r){g.call(this,i,r)},new v(this)},d.prototype._getDecoder=function(g){return this.decoders.hasOwnProperty(g=g||"der")||(this.decoders[g]=this._createNamed(I[g])),this.decoders[g]},d.prototype.decode=function(g,f,v){return this._getDecoder(f).decode(g,v)},d.prototype._getEncoder=function(g){return this.encoders.hasOwnProperty(g=g||"der")||(this.encoders[g]=this._createNamed(R[g])),this.encoders[g]},d.prototype.encode=function(g,f,v){return this._getEncoder(f).encode(g,v)}},{"./decoders":11,"./encoders":14,inherits:146}],4:[function(m,ie,a){"use strict";const R=m("inherits"),I=m("../base/reporter").Reporter,E=m("safer-buffer").Buffer;function _(u,g){I.call(this,g),E.isBuffer(u)?(this.base=u,this.offset=0,this.length=u.length):this.error("Input not Buffer")}function d(u,g){if(Array.isArray(u))this.length=0,this.value=u.map(function(f){return d.isEncoderBuffer(f)||(f=new d(f,g)),this.length+=f.length,f},this);else if("number"==typeof u){if(!(0<=u&&u<=255))return g.error("non-byte EncoderBuffer value");this.value=u,this.length=1}else if("string"==typeof u)this.value=u,this.length=E.byteLength(u);else{if(!E.isBuffer(u))return g.error("Unsupported type: "+typeof u);this.value=u,this.length=u.length}}R(_,I),a.DecoderBuffer=_,_.isDecoderBuffer=function(g){return g instanceof _||"object"==typeof g&&E.isBuffer(g.base)&&"DecoderBuffer"===g.constructor.name&&"number"==typeof g.offset&&"number"==typeof g.length&&"function"==typeof g.save&&"function"==typeof g.restore&&"function"==typeof g.isEmpty&&"function"==typeof g.readUInt8&&"function"==typeof g.skip&&"function"==typeof g.raw},_.prototype.save=function(){return{offset:this.offset,reporter:I.prototype.save.call(this)}},_.prototype.restore=function(g){const f=new _(this.base);return f.offset=g.offset,f.length=this.offset,this.offset=g.offset,I.prototype.restore.call(this,g.reporter),f},_.prototype.isEmpty=function(){return this.offset===this.length},_.prototype.readUInt8=function(g){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(g||"DecoderBuffer overrun")},_.prototype.skip=function(g,f){if(!(this.offset+g<=this.length))return this.error(f||"DecoderBuffer overrun");const v=new _(this.base);return v._reporterState=this._reporterState,v.offset=this.offset,v.length=this.offset+g,this.offset+=g,v},_.prototype.raw=function(g){return this.base.slice(g?g.offset:this.offset,this.length)},a.EncoderBuffer=d,d.isEncoderBuffer=function(g){return g instanceof d||"object"==typeof g&&"EncoderBuffer"===g.constructor.name&&"number"==typeof g.length&&"function"==typeof g.join},d.prototype.join=function(g,f){return g||(g=E.alloc(this.length)),f||(f=0),0===this.length||(Array.isArray(this.value)?this.value.forEach(function(v){v.join(g,f),f+=v.length}):("number"==typeof this.value?g[f]=this.value:"string"==typeof this.value?g.write(this.value,f):E.isBuffer(this.value)&&this.value.copy(g,f),f+=this.length)),g}},{"../base/reporter":7,inherits:146,"safer-buffer":251}],5:[function(m,ie,a){"use strict";const R=a;R.Reporter=m("./reporter").Reporter,R.DecoderBuffer=m("./buffer").DecoderBuffer,R.EncoderBuffer=m("./buffer").EncoderBuffer,R.Node=m("./node")},{"./buffer":4,"./node":6,"./reporter":7}],6:[function(m,ie,a){"use strict";const R=m("../base/reporter").Reporter,I=m("../base/buffer").EncoderBuffer,E=m("../base/buffer").DecoderBuffer,_=m("minimalistic-assert"),d=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],u=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(d);function f(c,i,r){const s={};this._baseState=s,s.name=r,s.enc=c,s.parent=i||null,s.children=null,s.tag=null,s.args=null,s.reverseArgs=null,s.choice=null,s.optional=!1,s.any=!1,s.obj=!1,s.use=null,s.useDecoder=null,s.key=null,s.default=null,s.explicit=null,s.implicit=null,s.contains=null,s.parent||(s.children=[],this._wrap())}ie.exports=f;const v=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];f.prototype.clone=function(){const i=this._baseState,r={};v.forEach(function(t){r[t]=i[t]});const s=new this.constructor(r.parent);return s._baseState=r,s},f.prototype._wrap=function(){const i=this._baseState;u.forEach(function(r){this[r]=function(){const t=new this.constructor(this);return i.children.push(t),t[r].apply(t,arguments)}},this)},f.prototype._init=function(i){const r=this._baseState;_(null===r.parent),i.call(this),r.children=r.children.filter(function(s){return s._baseState.parent===this},this),_.equal(r.children.length,1,"Root node can have only one child")},f.prototype._useArgs=function(i){const r=this._baseState,s=i.filter(function(t){return t instanceof this.constructor},this);i=i.filter(function(t){return!(t instanceof this.constructor)},this),0!==s.length&&(_(null===r.children),r.children=s,s.forEach(function(t){t._baseState.parent=this},this)),0!==i.length&&(_(null===r.args),r.args=i,r.reverseArgs=i.map(function(t){if("object"!=typeof t||t.constructor!==Object)return t;const n={};return Object.keys(t).forEach(function(o){o==(0|o)&&(o|=0),n[t[o]]=o}),n}))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach(function(c){f.prototype[c]=function(){throw new Error(c+" not implemented for encoding: "+this._baseState.enc)}}),d.forEach(function(c){f.prototype[c]=function(){const r=this._baseState,s=Array.prototype.slice.call(arguments);return _(null===r.tag),r.tag=c,this._useArgs(s),this}}),f.prototype.use=function(i){_(i);const r=this._baseState;return _(null===r.use),r.use=i,this},f.prototype.optional=function(){return this._baseState.optional=!0,this},f.prototype.def=function(i){const r=this._baseState;return _(null===r.default),r.default=i,r.optional=!0,this},f.prototype.explicit=function(i){const r=this._baseState;return _(null===r.explicit&&null===r.implicit),r.explicit=i,this},f.prototype.implicit=function(i){const r=this._baseState;return _(null===r.explicit&&null===r.implicit),r.implicit=i,this},f.prototype.obj=function(){const i=this._baseState,r=Array.prototype.slice.call(arguments);return i.obj=!0,0!==r.length&&this._useArgs(r),this},f.prototype.key=function(i){const r=this._baseState;return _(null===r.key),r.key=i,this},f.prototype.any=function(){return this._baseState.any=!0,this},f.prototype.choice=function(i){const r=this._baseState;return _(null===r.choice),r.choice=i,this._useArgs(Object.keys(i).map(function(s){return i[s]})),this},f.prototype.contains=function(i){const r=this._baseState;return _(null===r.use),r.contains=i,this},f.prototype._decode=function(i,r){const s=this._baseState;if(null===s.parent)return i.wrapResult(s.children[0]._decode(i,r));let h,t=s.default,n=!0,o=null;if(null!==s.key&&(o=i.enterKey(s.key)),s.optional){let l=null;if(null!==s.explicit?l=s.explicit:null!==s.implicit?l=s.implicit:null!==s.tag&&(l=s.tag),null!==l||s.any){if(n=this._peekTag(i,l,s.any),i.isError(n))return n}else{const e=i.save();try{null===s.choice?this._decodeGeneric(s.tag,i,r):this._decodeChoice(i,r),n=!0}catch{n=!1}i.restore(e)}}if(s.obj&&n&&(h=i.enterObject()),n){if(null!==s.explicit){const e=this._decodeTag(i,s.explicit);if(i.isError(e))return e;i=e}const l=i.offset;if(null===s.use&&null===s.choice){let e;s.any&&(e=i.save());const p=this._decodeTag(i,null!==s.implicit?s.implicit:s.tag,s.any);if(i.isError(p))return p;s.any?t=i.raw(e):i=p}if(r&&r.track&&null!==s.tag&&r.track(i.path(),l,i.length,"tagged"),r&&r.track&&null!==s.tag&&r.track(i.path(),i.offset,i.length,"content"),s.any||(t=null===s.choice?this._decodeGeneric(s.tag,i,r):this._decodeChoice(i,r)),i.isError(t))return t;if(!s.any&&null===s.choice&&null!==s.children&&s.children.forEach(function(p){p._decode(i,r)}),s.contains&&("octstr"===s.tag||"bitstr"===s.tag)){const e=new E(t);t=this._getUse(s.contains,i._reporterState.obj)._decode(e,r)}}return s.obj&&n&&(t=i.leaveObject(h)),null===s.key||null===t&&!0!==n?null!==o&&i.exitKey(o):i.leaveKey(o,s.key,t),t},f.prototype._decodeGeneric=function(i,r,s){const t=this._baseState;return"seq"===i||"set"===i?null:"seqof"===i||"setof"===i?this._decodeList(r,i,t.args[0],s):/str$/.test(i)?this._decodeStr(r,i,s):"objid"===i&&t.args?this._decodeObjid(r,t.args[0],t.args[1],s):"objid"===i?this._decodeObjid(r,null,null,s):"gentime"===i||"utctime"===i?this._decodeTime(r,i,s):"null_"===i?this._decodeNull(r,s):"bool"===i?this._decodeBool(r,s):"objDesc"===i?this._decodeStr(r,i,s):"int"===i||"enum"===i?this._decodeInt(r,t.args&&t.args[0],s):null!==t.use?this._getUse(t.use,r._reporterState.obj)._decode(r,s):r.error("unknown tag: "+i)},f.prototype._getUse=function(i,r){const s=this._baseState;return s.useDecoder=this._use(i,r),_(null===s.useDecoder._baseState.parent),s.useDecoder=s.useDecoder._baseState.children[0],s.implicit!==s.useDecoder._baseState.implicit&&(s.useDecoder=s.useDecoder.clone(),s.useDecoder._baseState.implicit=s.implicit),s.useDecoder},f.prototype._decodeChoice=function(i,r){const s=this._baseState;let t=null,n=!1;return Object.keys(s.choice).some(function(o){const h=i.save(),l=s.choice[o];try{const e=l._decode(i,r);if(i.isError(e))return!1;t={type:o,value:e},n=!0}catch{return i.restore(h),!1}return!0},this),n?t:i.error("Choice not matched")},f.prototype._createEncoderBuffer=function(i){return new I(i,this.reporter)},f.prototype._encode=function(i,r,s){const t=this._baseState;if(null!==t.default&&t.default===i)return;const n=this._encodeValue(i,r,s);return void 0===n||this._skipDefault(n,r,s)?void 0:n},f.prototype._encodeValue=function(i,r,s){const t=this._baseState;if(null===t.parent)return t.children[0]._encode(i,r||new R);let n=null;if(this.reporter=r,t.optional&&void 0===i){if(null===t.default)return;i=t.default}let o=null,h=!1;if(t.any)n=this._createEncoderBuffer(i);else if(t.choice)n=this._encodeChoice(i,r);else if(t.contains)o=this._getUse(t.contains,s)._encode(i,r),h=!0;else if(t.children)o=t.children.map(function(l){if("null_"===l._baseState.tag)return l._encode(null,r,i);if(null===l._baseState.key)return r.error("Child should have a key");const e=r.enterKey(l._baseState.key);if("object"!=typeof i)return r.error("Child expected, but input is not object");const p=l._encode(i[l._baseState.key],r,i);return r.leaveKey(e),p},this).filter(function(l){return l}),o=this._createEncoderBuffer(o);else if("seqof"===t.tag||"setof"===t.tag){if(!t.args||1!==t.args.length)return r.error("Too many args for : "+t.tag);if(!Array.isArray(i))return r.error("seqof/setof, but data is not Array");const l=this.clone();l._baseState.implicit=null,o=this._createEncoderBuffer(i.map(function(e){return this._getUse(this._baseState.args[0],i)._encode(e,r)},l))}else null!==t.use?n=this._getUse(t.use,s)._encode(i,r):(o=this._encodePrimitive(t.tag,i),h=!0);if(!t.any&&null===t.choice){const l=null!==t.implicit?t.implicit:t.tag,e=null===t.implicit?"universal":"context";null===l?null===t.use&&r.error("Tag could be omitted only for .use()"):null===t.use&&(n=this._encodeComposite(l,h,e,o))}return null!==t.explicit&&(n=this._encodeComposite(t.explicit,!1,"context",n)),n},f.prototype._encodeChoice=function(i,r){const s=this._baseState,t=s.choice[i.type];return t||_(!1,i.type+" not found in "+JSON.stringify(Object.keys(s.choice))),t._encode(i.value,r)},f.prototype._encodePrimitive=function(i,r){const s=this._baseState;if(/str$/.test(i))return this._encodeStr(r,i);if("objid"===i&&s.args)return this._encodeObjid(r,s.reverseArgs[0],s.args[1]);if("objid"===i)return this._encodeObjid(r,null,null);if("gentime"===i||"utctime"===i)return this._encodeTime(r,i);if("null_"===i)return this._encodeNull();if("int"===i||"enum"===i)return this._encodeInt(r,s.args&&s.reverseArgs[0]);if("bool"===i)return this._encodeBool(r);if("objDesc"===i)return this._encodeStr(r,i);throw new Error("Unsupported tag: "+i)},f.prototype._isNumstr=function(i){return/^[0-9 ]*$/.test(i)},f.prototype._isPrintstr=function(i){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(i)}},{"../base/buffer":4,"../base/reporter":7,"minimalistic-assert":223}],7:[function(m,ie,a){"use strict";const R=m("inherits");function I(_){this._reporterState={obj:null,path:[],options:_||{},errors:[]}}function E(_,d){this.path=_,this.rethrow(d)}a.Reporter=I,I.prototype.isError=function(d){return d instanceof E},I.prototype.save=function(){const d=this._reporterState;return{obj:d.obj,pathLen:d.path.length}},I.prototype.restore=function(d){const u=this._reporterState;u.obj=d.obj,u.path=u.path.slice(0,d.pathLen)},I.prototype.enterKey=function(d){return this._reporterState.path.push(d)},I.prototype.exitKey=function(d){const u=this._reporterState;u.path=u.path.slice(0,d-1)},I.prototype.leaveKey=function(d,u,g){const f=this._reporterState;this.exitKey(d),null!==f.obj&&(f.obj[u]=g)},I.prototype.path=function(){return this._reporterState.path.join("/")},I.prototype.enterObject=function(){const d=this._reporterState,u=d.obj;return d.obj={},u},I.prototype.leaveObject=function(d){const u=this._reporterState,g=u.obj;return u.obj=d,g},I.prototype.error=function(d){let u;const g=this._reporterState,f=d instanceof E;if(u=f?d:new E(g.path.map(function(v){return"["+JSON.stringify(v)+"]"}).join(""),d.message||d,d.stack),!g.options.partial)throw u;return f||g.errors.push(u),u},I.prototype.wrapResult=function(d){const u=this._reporterState;return u.options.partial?{result:this.isError(d)?null:d,errors:u.errors}:d},R(E,Error),E.prototype.rethrow=function(d){if(this.message=d+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,E),!this.stack)try{throw new Error(this.message)}catch(u){this.stack=u.stack}return this}},{inherits:146}],8:[function(m,ie,a){"use strict";function R(I){const E={};return Object.keys(I).forEach(function(_){(0|_)==_&&(_|=0),E[I[_]]=_}),E}a.tagClass={0:"universal",1:"application",2:"context",3:"private"},a.tagClassByName=R(a.tagClass),a.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},a.tagByName=R(a.tag)},{}],9:[function(m,ie,a){"use strict";const R=a;R._reverse=function(E){const _={};return Object.keys(E).forEach(function(d){(0|d)==d&&(d|=0),_[E[d]]=d}),_},R.der=m("./der")},{"./der":8}],10:[function(m,ie,a){"use strict";const R=m("inherits"),I=m("bn.js"),E=m("../base/buffer").DecoderBuffer,_=m("../base/node"),d=m("../constants/der");function u(c){this.enc="der",this.name=c.name,this.entity=c,this.tree=new g,this.tree._init(c.body)}function g(c){_.call(this,"der",c)}function f(c,i){let r=c.readUInt8(i);if(c.isError(r))return r;const s=d.tagClass[r>>6],t=0==(32&r);if(31==(31&r)){let o=r;for(r=0;128==(128&o);){if(o=c.readUInt8(i),c.isError(o))return o;r<<=7,r|=127&o}}else r&=31;return{cls:s,primitive:t,tag:r,tagStr:d.tag[r]}}function v(c,i,r){let s=c.readUInt8(r);if(c.isError(s))return s;if(!i&&128===s)return null;if(!(128&s))return s;const t=127&s;if(t>4)return c.error("length octect is too long");s=0;for(let n=0;n<t;n++){s<<=8;const o=c.readUInt8(r);if(c.isError(o))return o;s|=o}return s}ie.exports=u,u.prototype.decode=function(i,r){return E.isDecoderBuffer(i)||(i=new E(i,r)),this.tree._decode(i,r)},R(g,_),g.prototype._peekTag=function(i,r,s){if(i.isEmpty())return!1;const t=i.save(),n=f(i,'Failed to peek tag: "'+r+'"');return i.isError(n)?n:(i.restore(t),n.tag===r||n.tagStr===r||n.tagStr+"of"===r||s)},g.prototype._decodeTag=function(i,r,s){const t=f(i,'Failed to decode tag of "'+r+'"');if(i.isError(t))return t;let n=v(i,t.primitive,'Failed to get length of "'+r+'"');if(i.isError(n))return n;if(!s&&t.tag!==r&&t.tagStr!==r&&t.tagStr+"of"!==r)return i.error('Failed to match tag: "'+r+'"');if(t.primitive||null!==n)return i.skip(n,'Failed to match body of: "'+r+'"');const o=i.save(),h=this._skipUntilEnd(i,'Failed to skip indefinite length body: "'+this.tag+'"');return i.isError(h)?h:(n=i.offset-o.offset,i.restore(o),i.skip(n,'Failed to match body of: "'+r+'"'))},g.prototype._skipUntilEnd=function(i,r){for(;;){const s=f(i,r);if(i.isError(s))return s;const t=v(i,s.primitive,r);if(i.isError(t))return t;let n;if(n=s.primitive||null!==t?i.skip(t):this._skipUntilEnd(i,r),i.isError(n))return n;if("end"===s.tagStr)break}},g.prototype._decodeList=function(i,r,s,t){const n=[];for(;!i.isEmpty();){const o=this._peekTag(i,"end");if(i.isError(o))return o;const h=s.decode(i,"der",t);if(i.isError(h)&&o)break;n.push(h)}return n},g.prototype._decodeStr=function(i,r){if("bitstr"===r){const s=i.readUInt8();return i.isError(s)?s:{unused:s,data:i.raw()}}if("bmpstr"===r){const s=i.raw();if(s.length%2==1)return i.error("Decoding of string type: bmpstr length mismatch");let t="";for(let n=0;n<s.length/2;n++)t+=String.fromCharCode(s.readUInt16BE(2*n));return t}if("numstr"===r){const s=i.raw().toString("ascii");return this._isNumstr(s)?s:i.error("Decoding of string type: numstr unsupported characters")}if("octstr"===r)return i.raw();if("objDesc"===r)return i.raw();if("printstr"===r){const s=i.raw().toString("ascii");return this._isPrintstr(s)?s:i.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(r)?i.raw().toString():i.error("Decoding of string type: "+r+" unsupported")},g.prototype._decodeObjid=function(i,r,s){let t;const n=[];let o=0,h=0;for(;!i.isEmpty();)h=i.readUInt8(),o<<=7,o|=127&h,128&h||(n.push(o),o=0);if(128&h&&n.push(o),t=s?n:[n[0]/40|0,n[0]%40].concat(n.slice(1)),r){let p=r[t.join(" ")];void 0===p&&(p=r[t.join(".")]),void 0!==p&&(t=p)}return t},g.prototype._decodeTime=function(i,r){const s=i.raw().toString();let t,n,o,h,l,e;if("gentime"===r)t=0|s.slice(0,4),n=0|s.slice(4,6),o=0|s.slice(6,8),h=0|s.slice(8,10),l=0|s.slice(10,12),e=0|s.slice(12,14);else{if("utctime"!==r)return i.error("Decoding "+r+" time is not supported yet");t=0|s.slice(0,2),n=0|s.slice(2,4),o=0|s.slice(4,6),h=0|s.slice(6,8),l=0|s.slice(8,10),e=0|s.slice(10,12),t=t<70?2e3+t:1900+t}return Date.UTC(t,n-1,o,h,l,e,0)},g.prototype._decodeNull=function(){return null},g.prototype._decodeBool=function(i){const r=i.readUInt8();return i.isError(r)?r:0!==r},g.prototype._decodeInt=function(i,r){const s=i.raw();let t=new I(s);return r&&(t=r[t.toString(10)]||t),t},g.prototype._use=function(i,r){return"function"==typeof i&&(i=i(r)),i._getDecoder("der").tree}},{"../base/buffer":4,"../base/node":6,"../constants/der":8,"bn.js":18,inherits:146}],11:[function(m,ie,a){"use strict";const R=a;R.der=m("./der"),R.pem=m("./pem")},{"./der":10,"./pem":12}],12:[function(m,ie,a){"use strict";const R=m("inherits"),I=m("safer-buffer").Buffer,E=m("./der");function _(d){E.call(this,d),this.enc="pem"}R(_,E),ie.exports=_,_.prototype.decode=function(u,g){const f=u.toString().split(/[\r\n]+/g),v=g.label.toUpperCase(),c=/^-----(BEGIN|END) ([^-]+)-----$/;let i=-1,r=-1;for(let n=0;n<f.length;n++){const o=f[n].match(c);if(null!==o&&o[2]===v){if(-1!==i){if("END"!==o[1])break;r=n;break}if("BEGIN"!==o[1])break;i=n}}if(-1===i||-1===r)throw new Error("PEM section not found for: "+v);const s=f.slice(i+1,r).join("");s.replace(/[^a-z0-9+/=]+/gi,"");const t=I.from(s,"base64");return E.prototype.decode.call(this,t,g)}},{"./der":10,inherits:146,"safer-buffer":251}],13:[function(m,ie,a){"use strict";const R=m("inherits"),I=m("safer-buffer").Buffer,E=m("../base/node"),_=m("../constants/der");function d(v){this.enc="der",this.name=v.name,this.entity=v,this.tree=new u,this.tree._init(v.body)}function u(v){E.call(this,"der",v)}function g(v){return v<10?"0"+v:v}ie.exports=d,d.prototype.encode=function(c,i){return this.tree._encode(c,i).join()},R(u,E),u.prototype._encodeComposite=function(c,i,r,s){const t=function f(v,c,i,r){let s;if("seqof"===v?v="seq":"setof"===v&&(v="set"),_.tagByName.hasOwnProperty(v))s=_.tagByName[v];else{if("number"!=typeof v||(0|v)!==v)return r.error("Unknown tag: "+v);s=v}return s>=31?r.error("Multi-octet tag encoding unsupported"):(c||(s|=32),s|=_.tagClassByName[i||"universal"]<<6,s)}(c,i,r,this.reporter);if(s.length<128){const h=I.alloc(2);return h[0]=t,h[1]=s.length,this._createEncoderBuffer([h,s])}let n=1;for(let h=s.length;h>=256;h>>=8)n++;const o=I.alloc(2+n);o[0]=t,o[1]=128|n;for(let h=1+n,l=s.length;l>0;h--,l>>=8)o[h]=255&l;return this._createEncoderBuffer([o,s])},u.prototype._encodeStr=function(c,i){if("bitstr"===i)return this._createEncoderBuffer([0|c.unused,c.data]);if("bmpstr"===i){const r=I.alloc(2*c.length);for(let s=0;s<c.length;s++)r.writeUInt16BE(c.charCodeAt(s),2*s);return this._createEncoderBuffer(r)}return"numstr"===i?this._isNumstr(c)?this._createEncoderBuffer(c):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===i?this._isPrintstr(c)?this._createEncoderBuffer(c):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(i)||"objDesc"===i?this._createEncoderBuffer(c):this.reporter.error("Encoding of string type: "+i+" unsupported")},u.prototype._encodeObjid=function(c,i,r){if("string"==typeof c){if(!i)return this.reporter.error("string objid given, but no values map found");if(!i.hasOwnProperty(c))return this.reporter.error("objid not found in values map");c=i[c].split(/[\s.]+/g);for(let o=0;o<c.length;o++)c[o]|=0}else if(Array.isArray(c)){c=c.slice();for(let o=0;o<c.length;o++)c[o]|=0}if(!Array.isArray(c))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(c));if(!r){if(c[1]>=40)return this.reporter.error("Second objid identifier OOB");c.splice(0,2,40*c[0]+c[1])}let s=0;for(let o=0;o<c.length;o++){let h=c[o];for(s++;h>=128;h>>=7)s++}const t=I.alloc(s);let n=t.length-1;for(let o=c.length-1;o>=0;o--){let h=c[o];for(t[n--]=127&h;(h>>=7)>0;)t[n--]=128|127&h}return this._createEncoderBuffer(t)},u.prototype._encodeTime=function(c,i){let r;const s=new Date(c);return"gentime"===i?r=[g(s.getUTCFullYear()),g(s.getUTCMonth()+1),g(s.getUTCDate()),g(s.getUTCHours()),g(s.getUTCMinutes()),g(s.getUTCSeconds()),"Z"].join(""):"utctime"===i?r=[g(s.getUTCFullYear()%100),g(s.getUTCMonth()+1),g(s.getUTCDate()),g(s.getUTCHours()),g(s.getUTCMinutes()),g(s.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+i+" time is not supported yet"),this._encodeStr(r,"octstr")},u.prototype._encodeNull=function(){return this._createEncoderBuffer("")},u.prototype._encodeInt=function(c,i){if("string"==typeof c){if(!i)return this.reporter.error("String int or enum given, but no values map");if(!i.hasOwnProperty(c))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(c));c=i[c]}if("number"!=typeof c&&!I.isBuffer(c)){const t=c.toArray();!c.sign&&128&t[0]&&t.unshift(0),c=I.from(t)}if(I.isBuffer(c)){let t=c.length;0===c.length&&t++;const n=I.alloc(t);return c.copy(n),0===c.length&&(n[0]=0),this._createEncoderBuffer(n)}if(c<128)return this._createEncoderBuffer(c);if(c<256)return this._createEncoderBuffer([0,c]);let r=1;for(let t=c;t>=256;t>>=8)r++;const s=new Array(r);for(let t=s.length-1;t>=0;t--)s[t]=255&c,c>>=8;return 128&s[0]&&s.unshift(0),this._createEncoderBuffer(I.from(s))},u.prototype._encodeBool=function(c){return this._createEncoderBuffer(c?255:0)},u.prototype._use=function(c,i){return"function"==typeof c&&(c=c(i)),c._getEncoder("der").tree},u.prototype._skipDefault=function(c,i,r){const s=this._baseState;let t;if(null===s.default)return!1;const n=c.join();if(void 0===s.defaultBuffer&&(s.defaultBuffer=this._encodeValue(s.default,i,r).join()),n.length!==s.defaultBuffer.length)return!1;for(t=0;t<n.length;t++)if(n[t]!==s.defaultBuffer[t])return!1;return!0}},{"../base/node":6,"../constants/der":8,inherits:146,"safer-buffer":251}],14:[function(m,ie,a){"use strict";const R=a;R.der=m("./der"),R.pem=m("./pem")},{"./der":13,"./pem":15}],15:[function(m,ie,a){"use strict";const R=m("inherits"),I=m("./der");function E(_){I.call(this,_),this.enc="pem"}R(E,I),ie.exports=E,E.prototype.encode=function(d,u){const f=I.prototype.encode.call(this,d).toString("base64"),v=["-----BEGIN "+u.label+"-----"];for(let c=0;c<f.length;c+=64)v.push(f.slice(c,c+64));return v.push("-----END "+u.label+"-----"),v.join("\n")}},{"./der":13,inherits:146}],16:[function(m,ie,a){(function(R){(function(){"use strict";var I=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],E=typeof globalThis>"u"?R:globalThis;ie.exports=function(){for(var d=[],u=0;u<I.length;u++)"function"==typeof E[I[u]]&&(d[d.length]=I[u]);return d}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],17:[function(m,ie,a){"use strict";a.byteLength=function f(t){var n=g(t),h=n[1];return 3*(n[0]+h)/4-h},a.toByteArray=function c(t){var n,y,o=g(t),h=o[0],l=o[1],e=new E(function v(t,n,o){return 3*(n+o)/4-o}(0,h,l)),p=0,b=l>0?h-4:h;for(y=0;y<b;y+=4)n=I[t.charCodeAt(y)]<<18|I[t.charCodeAt(y+1)]<<12|I[t.charCodeAt(y+2)]<<6|I[t.charCodeAt(y+3)],e[p++]=n>>16&255,e[p++]=n>>8&255,e[p++]=255&n;return 2===l&&(n=I[t.charCodeAt(y)]<<2|I[t.charCodeAt(y+1)]>>4,e[p++]=255&n),1===l&&(n=I[t.charCodeAt(y)]<<10|I[t.charCodeAt(y+1)]<<4|I[t.charCodeAt(y+2)]>>2,e[p++]=n>>8&255,e[p++]=255&n),e},a.fromByteArray=function s(t){for(var n,o=t.length,h=o%3,l=[],e=16383,p=0,b=o-h;p<b;p+=e)l.push(r(t,p,p+e>b?b:p+e));return 1===h?l.push(R[(n=t[o-1])>>2]+R[n<<4&63]+"=="):2===h&&l.push(R[(n=(t[o-2]<<8)+t[o-1])>>10]+R[n>>4&63]+R[n<<2&63]+"="),l.join("")};for(var R=[],I=[],E=typeof Uint8Array<"u"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,u=_.length;d<u;++d)R[d]=_[d],I[_.charCodeAt(d)]=d;function g(t){var n=t.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=t.indexOf("=");return-1===o&&(o=n),[o,o===n?0:4-o%4]}function i(t){return R[t>>18&63]+R[t>>12&63]+R[t>>6&63]+R[63&t]}function r(t,n,o){for(var l=[],e=n;e<o;e+=3)l.push(i((t[e]<<16&16711680)+(t[e+1]<<8&65280)+(255&t[e+2])));return l.join("")}I["-".charCodeAt(0)]=62,I["_".charCodeAt(0)]=63},{}],18:[function(m,ie,a){!function(R,I){"use strict";function E(z,M){if(!z)throw new Error(M||"Assertion failed")}function _(z,M){z.super_=M;var L=function(){};L.prototype=M.prototype,z.prototype=new L,z.prototype.constructor=z}function d(z,M,L){if(d.isBN(z))return z;this.negative=0,this.words=null,this.length=0,this.red=null,null!==z&&(("le"===M||"be"===M)&&(L=M,M=10),this._init(z||0,M||10,L||"be"))}var u;"object"==typeof R?R.exports=d:I.BN=d,d.BN=d,d.wordSize=26;try{u=typeof window<"u"&&typeof window.Buffer<"u"?window.Buffer:m("buffer").Buffer}catch{}function g(z,M){var L=z.charCodeAt(M);return L>=65&&L<=70?L-55:L>=97&&L<=102?L-87:L-48&15}function f(z,M,L){var j=g(z,L);return L-1>=M&&(j|=g(z,L-1)<<4),j}function v(z,M,L,j){for(var C=0,F=Math.min(z.length,L),V=M;V<F;V++){var N=z.charCodeAt(V)-48;C*=j,C+=N>=49?N-49+10:N>=17?N-17+10:N}return C}d.isBN=function(M){return M instanceof d||null!==M&&"object"==typeof M&&M.constructor.wordSize===d.wordSize&&Array.isArray(M.words)},d.max=function(M,L){return M.cmp(L)>0?M:L},d.min=function(M,L){return M.cmp(L)<0?M:L},d.prototype._init=function(M,L,j){if("number"==typeof M)return this._initNumber(M,L,j);if("object"==typeof M)return this._initArray(M,L,j);"hex"===L&&(L=16),E(L===(0|L)&&L>=2&&L<=36);var C=0;"-"===(M=M.toString().replace(/\s+/g,""))[0]&&(C++,this.negative=1),C<M.length&&(16===L?this._parseHex(M,C,j):(this._parseBase(M,L,C),"le"===j&&this._initArray(this.toArray(),L,j)))},d.prototype._initNumber=function(M,L,j){M<0&&(this.negative=1,M=-M),M<67108864?(this.words=[67108863&M],this.length=1):M<4503599627370496?(this.words=[67108863&M,M/67108864&67108863],this.length=2):(E(M<9007199254740992),this.words=[67108863&M,M/67108864&67108863,1],this.length=3),"le"===j&&this._initArray(this.toArray(),L,j)},d.prototype._initArray=function(M,L,j){if(E("number"==typeof M.length),M.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(M.length/3),this.words=new Array(this.length);for(var C=0;C<this.length;C++)this.words[C]=0;var F,V,N=0;if("be"===j)for(C=M.length-1,F=0;C>=0;C-=3)this.words[F]|=(V=M[C]|M[C-1]<<8|M[C-2]<<16)<<N&67108863,this.words[F+1]=V>>>26-N&67108863,(N+=24)>=26&&(N-=26,F++);else if("le"===j)for(C=0,F=0;C<M.length;C+=3)this.words[F]|=(V=M[C]|M[C+1]<<8|M[C+2]<<16)<<N&67108863,this.words[F+1]=V>>>26-N&67108863,(N+=24)>=26&&(N-=26,F++);return this.strip()},d.prototype._parseHex=function(M,L,j){this.length=Math.ceil((M.length-L)/6),this.words=new Array(this.length);for(var C=0;C<this.length;C++)this.words[C]=0;var N,F=0,V=0;if("be"===j)for(C=M.length-1;C>=L;C-=2)N=f(M,L,C)<<F,this.words[V]|=67108863&N,F>=18?(F-=18,this.words[V+=1]|=N>>>26):F+=8;else for(C=(M.length-L)%2==0?L+1:L;C<M.length;C+=2)N=f(M,L,C)<<F,this.words[V]|=67108863&N,F>=18?(F-=18,this.words[V+=1]|=N>>>26):F+=8;this.strip()},d.prototype._parseBase=function(M,L,j){this.words=[0],this.length=1;for(var C=0,F=1;F<=67108863;F*=L)C++;C--,F=F/L|0;for(var V=M.length-j,N=V%C,T=Math.min(V,V-N)+j,S=0,U=j;U<T;U+=C)S=v(M,U,U+C,L),this.imuln(F),this.words[0]+S<67108864?this.words[0]+=S:this._iaddn(S);if(0!==N){var W=1;for(S=v(M,U,M.length,L),U=0;U<N;U++)W*=L;this.imuln(W),this.words[0]+S<67108864?this.words[0]+=S:this._iaddn(S)}this.strip()},d.prototype.copy=function(M){M.words=new Array(this.length);for(var L=0;L<this.length;L++)M.words[L]=this.words[L];M.length=this.length,M.negative=this.negative,M.red=this.red},d.prototype.clone=function(){var M=new d(null);return this.copy(M),M},d.prototype._expand=function(M){for(;this.length<M;)this.words[this.length++]=0;return this},d.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},d.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},d.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],i=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],r=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function t(z,M,L){L.negative=M.negative^z.negative;var j=z.length+M.length|0;L.length=j,j=j-1|0;var C=0|z.words[0],F=0|M.words[0],V=C*F,T=V/67108864|0;L.words[0]=67108863&V;for(var S=1;S<j;S++){for(var U=T>>>26,W=67108863&T,k=Math.min(S,M.length-1),D=Math.max(0,S-z.length+1);D<=k;D++)U+=(V=(C=0|z.words[S-D|0])*(F=0|M.words[D])+W)/67108864|0,W=67108863&V;L.words[S]=0|W,T=0|U}return 0!==T?L.words[S]=0|T:L.length--,L.strip()}d.prototype.toString=function(M,L){var j;if(L=0|L||1,16===(M=M||10)||"hex"===M){j="";for(var C=0,F=0,V=0;V<this.length;V++){var N=this.words[V],T=(16777215&(N<<C|F)).toString(16);j=0!=(F=N>>>24-C&16777215)||V!==this.length-1?c[6-T.length]+T+j:T+j,(C+=2)>=26&&(C-=26,V--)}for(0!==F&&(j=F.toString(16)+j);j.length%L!=0;)j="0"+j;return 0!==this.negative&&(j="-"+j),j}if(M===(0|M)&&M>=2&&M<=36){var S=i[M],U=r[M];j="";var W=this.clone();for(W.negative=0;!W.isZero();){var k=W.modn(U).toString(M);j=(W=W.idivn(U)).isZero()?k+j:c[S-k.length]+k+j}for(this.isZero()&&(j="0"+j);j.length%L!=0;)j="0"+j;return 0!==this.negative&&(j="-"+j),j}E(!1,"Base should be between 2 and 36")},d.prototype.toNumber=function(){var M=this.words[0];return 2===this.length?M+=67108864*this.words[1]:3===this.length&&1===this.words[2]?M+=4503599627370496+67108864*this.words[1]:this.length>2&&E(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-M:M},d.prototype.toJSON=function(){return this.toString(16)},d.prototype.toBuffer=function(M,L){return E(typeof u<"u"),this.toArrayLike(u,M,L)},d.prototype.toArray=function(M,L){return this.toArrayLike(Array,M,L)},d.prototype.toArrayLike=function(M,L,j){var C=this.byteLength(),F=j||Math.max(1,C);E(C<=F,"byte array longer than desired length"),E(F>0,"Requested array length <= 0"),this.strip();var T,S,V="le"===L,N=new M(F),U=this.clone();if(V){for(S=0;!U.isZero();S++)T=U.andln(255),U.iushrn(8),N[S]=T;for(;S<F;S++)N[S]=0}else{for(S=0;S<F-C;S++)N[S]=0;for(S=0;!U.isZero();S++)T=U.andln(255),U.iushrn(8),N[F-S-1]=T}return N},d.prototype._countBits=Math.clz32?function(M){return 32-Math.clz32(M)}:function(M){var L=M,j=0;return L>=4096&&(j+=13,L>>>=13),L>=64&&(j+=7,L>>>=7),L>=8&&(j+=4,L>>>=4),L>=2&&(j+=2,L>>>=2),j+L},d.prototype._zeroBits=function(M){if(0===M)return 26;var L=M,j=0;return 8191&L||(j+=13,L>>>=13),127&L||(j+=7,L>>>=7),15&L||(j+=4,L>>>=4),3&L||(j+=2,L>>>=2),1&L||j++,j},d.prototype.bitLength=function(){var L=this._countBits(this.words[this.length-1]);return 26*(this.length-1)+L},d.prototype.zeroBits=function(){if(this.isZero())return 0;for(var M=0,L=0;L<this.length;L++){var j=this._zeroBits(this.words[L]);if(M+=j,26!==j)break}return M},d.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},d.prototype.toTwos=function(M){return 0!==this.negative?this.abs().inotn(M).iaddn(1):this.clone()},d.prototype.fromTwos=function(M){return this.testn(M-1)?this.notn(M).iaddn(1).ineg():this.clone()},d.prototype.isNeg=function(){return 0!==this.negative},d.prototype.neg=function(){return this.clone().ineg()},d.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},d.prototype.iuor=function(M){for(;this.length<M.length;)this.words[this.length++]=0;for(var L=0;L<M.length;L++)this.words[L]=this.words[L]|M.words[L];return this.strip()},d.prototype.ior=function(M){return E(0==(this.negative|M.negative)),this.iuor(M)},d.prototype.or=function(M){return this.length>M.length?this.clone().ior(M):M.clone().ior(this)},d.prototype.uor=function(M){return this.length>M.length?this.clone().iuor(M):M.clone().iuor(this)},d.prototype.iuand=function(M){var L;L=this.length>M.length?M:this;for(var j=0;j<L.length;j++)this.words[j]=this.words[j]&M.words[j];return this.length=L.length,this.strip()},d.prototype.iand=function(M){return E(0==(this.negative|M.negative)),this.iuand(M)},d.prototype.and=function(M){return this.length>M.length?this.clone().iand(M):M.clone().iand(this)},d.prototype.uand=function(M){return this.length>M.length?this.clone().iuand(M):M.clone().iuand(this)},d.prototype.iuxor=function(M){var L,j;this.length>M.length?(L=this,j=M):(L=M,j=this);for(var C=0;C<j.length;C++)this.words[C]=L.words[C]^j.words[C];if(this!==L)for(;C<L.length;C++)this.words[C]=L.words[C];return this.length=L.length,this.strip()},d.prototype.ixor=function(M){return E(0==(this.negative|M.negative)),this.iuxor(M)},d.prototype.xor=function(M){return this.length>M.length?this.clone().ixor(M):M.clone().ixor(this)},d.prototype.uxor=function(M){return this.length>M.length?this.clone().iuxor(M):M.clone().iuxor(this)},d.prototype.inotn=function(M){E("number"==typeof M&&M>=0);var L=0|Math.ceil(M/26),j=M%26;this._expand(L),j>0&&L--;for(var C=0;C<L;C++)this.words[C]=67108863&~this.words[C];return j>0&&(this.words[C]=~this.words[C]&67108863>>26-j),this.strip()},d.prototype.notn=function(M){return this.clone().inotn(M)},d.prototype.setn=function(M,L){E("number"==typeof M&&M>=0);var j=M/26|0,C=M%26;return this._expand(j+1),this.words[j]=L?this.words[j]|1<<C:this.words[j]&~(1<<C),this.strip()},d.prototype.iadd=function(M){var L,j,C;if(0!==this.negative&&0===M.negative)return this.negative=0,L=this.isub(M),this.negative^=1,this._normSign();if(0===this.negative&&0!==M.negative)return M.negative=0,L=this.isub(M),M.negative=1,L._normSign();this.length>M.length?(j=this,C=M):(j=M,C=this);for(var F=0,V=0;V<C.length;V++)this.words[V]=67108863&(L=(0|j.words[V])+(0|C.words[V])+F),F=L>>>26;for(;0!==F&&V<j.length;V++)this.words[V]=67108863&(L=(0|j.words[V])+F),F=L>>>26;if(this.length=j.length,0!==F)this.words[this.length]=F,this.length++;else if(j!==this)for(;V<j.length;V++)this.words[V]=j.words[V];return this},d.prototype.add=function(M){var L;return 0!==M.negative&&0===this.negative?(M.negative=0,L=this.sub(M),M.negative^=1,L):0===M.negative&&0!==this.negative?(this.negative=0,L=M.sub(this),this.negative=1,L):this.length>M.length?this.clone().iadd(M):M.clone().iadd(this)},d.prototype.isub=function(M){if(0!==M.negative){M.negative=0;var L=this.iadd(M);return M.negative=1,L._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(M),this.negative=1,this._normSign();var C,F,j=this.cmp(M);if(0===j)return this.negative=0,this.length=1,this.words[0]=0,this;j>0?(C=this,F=M):(C=M,F=this);for(var V=0,N=0;N<F.length;N++)V=(L=(0|C.words[N])-(0|F.words[N])+V)>>26,this.words[N]=67108863&L;for(;0!==V&&N<C.length;N++)V=(L=(0|C.words[N])+V)>>26,this.words[N]=67108863&L;if(0===V&&N<C.length&&C!==this)for(;N<C.length;N++)this.words[N]=C.words[N];return this.length=Math.max(this.length,N),C!==this&&(this.negative=1),this.strip()},d.prototype.sub=function(M){return this.clone().isub(M)};var n=function(M,L,j){var T,S,U,C=M.words,F=L.words,V=j.words,N=0,W=0|C[0],k=8191&W,D=W>>>13,Q=0|C[1],ee=8191&Q,ae=Q>>>13,ue=0|C[2],be=8191&ue,X=ue>>>13,H=0|C[3],ne=8191&H,ce=H>>>13,te=0|C[4],P=8191&te,A=te>>>13,$=0|C[5],G=8191&$,se=$>>>13,he=0|C[6],pe=8191&he,me=he>>>13,Ee=0|C[7],_e=8191&Ee,Se=Ee>>>13,De=0|C[8],Ae=8191&De,Ne=De>>>13,qe=0|C[9],Be=8191&qe,Ge=qe>>>13,Ue=0|F[0],K=8191&Ue,Y=Ue>>>13,oe=0|F[1],le=8191&oe,ge=oe>>>13,Ie=0|F[2],Ce=8191&Ie,Pe=Ie>>>13,He=0|F[3],Fe=8191&He,je=He>>>13,et=0|F[4],Ve=8191&et,Je=et>>>13,St=0|F[5],tt=8191&St,Qe=St>>>13,Ct=0|F[6],it=8191&Ct,rt=Ct>>>13,yt=0|F[7],nt=8191&yt,st=yt>>>13,Nt=0|F[8],ft=8191&Nt,mt=Nt>>>13,qt=0|F[9],pt=8191&qt,gt=qt>>>13;j.negative=M.negative^L.negative,j.length=19;var on=(N+(T=Math.imul(k,K))|0)+((8191&(S=(S=Math.imul(k,Y))+Math.imul(D,K)|0))<<13)|0;N=((U=Math.imul(D,Y))+(S>>>13)|0)+(on>>>26)|0,on&=67108863,T=Math.imul(ee,K),S=(S=Math.imul(ee,Y))+Math.imul(ae,K)|0,U=Math.imul(ae,Y);var Tt=(N+(T=T+Math.imul(k,le)|0)|0)+((8191&(S=(S=S+Math.imul(k,ge)|0)+Math.imul(D,le)|0))<<13)|0;N=((U=U+Math.imul(D,ge)|0)+(S>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,T=Math.imul(be,K),S=(S=Math.imul(be,Y))+Math.imul(X,K)|0,U=Math.imul(X,Y),T=T+Math.imul(ee,le)|0,S=(S=S+Math.imul(ee,ge)|0)+Math.imul(ae,le)|0,U=U+Math.imul(ae,ge)|0;var Mt=(N+(T=T+Math.imul(k,Ce)|0)|0)+((8191&(S=(S=S+Math.imul(k,Pe)|0)+Math.imul(D,Ce)|0))<<13)|0;N=((U=U+Math.imul(D,Pe)|0)+(S>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,T=Math.imul(ne,K),S=(S=Math.imul(ne,Y))+Math.imul(ce,K)|0,U=Math.imul(ce,Y),T=T+Math.imul(be,le)|0,S=(S=S+Math.imul(be,ge)|0)+Math.imul(X,le)|0,U=U+Math.imul(X,ge)|0,T=T+Math.imul(ee,Ce)|0,S=(S=S+Math.imul(ee,Pe)|0)+Math.imul(ae,Ce)|0,U=U+Math.imul(ae,Pe)|0;var zt=(N+(T=T+Math.imul(k,Fe)|0)|0)+((8191&(S=(S=S+Math.imul(k,je)|0)+Math.imul(D,Fe)|0))<<13)|0;N=((U=U+Math.imul(D,je)|0)+(S>>>13)|0)+(zt>>>26)|0,zt&=67108863,T=Math.imul(P,K),S=(S=Math.imul(P,Y))+Math.imul(A,K)|0,U=Math.imul(A,Y),T=T+Math.imul(ne,le)|0,S=(S=S+Math.imul(ne,ge)|0)+Math.imul(ce,le)|0,U=U+Math.imul(ce,ge)|0,T=T+Math.imul(be,Ce)|0,S=(S=S+Math.imul(be,Pe)|0)+Math.imul(X,Ce)|0,U=U+Math.imul(X,Pe)|0,T=T+Math.imul(ee,Fe)|0,S=(S=S+Math.imul(ee,je)|0)+Math.imul(ae,Fe)|0,U=U+Math.imul(ae,je)|0;var an=(N+(T=T+Math.imul(k,Ve)|0)|0)+((8191&(S=(S=S+Math.imul(k,Je)|0)+Math.imul(D,Ve)|0))<<13)|0;N=((U=U+Math.imul(D,Je)|0)+(S>>>13)|0)+(an>>>26)|0,an&=67108863,T=Math.imul(G,K),S=(S=Math.imul(G,Y))+Math.imul(se,K)|0,U=Math.imul(se,Y),T=T+Math.imul(P,le)|0,S=(S=S+Math.imul(P,ge)|0)+Math.imul(A,le)|0,U=U+Math.imul(A,ge)|0,T=T+Math.imul(ne,Ce)|0,S=(S=S+Math.imul(ne,Pe)|0)+Math.imul(ce,Ce)|0,U=U+Math.imul(ce,Pe)|0,T=T+Math.imul(be,Fe)|0,S=(S=S+Math.imul(be,je)|0)+Math.imul(X,Fe)|0,U=U+Math.imul(X,je)|0,T=T+Math.imul(ee,Ve)|0,S=(S=S+Math.imul(ee,Je)|0)+Math.imul(ae,Ve)|0,U=U+Math.imul(ae,Je)|0;var en=(N+(T=T+Math.imul(k,tt)|0)|0)+((8191&(S=(S=S+Math.imul(k,Qe)|0)+Math.imul(D,tt)|0))<<13)|0;N=((U=U+Math.imul(D,Qe)|0)+(S>>>13)|0)+(en>>>26)|0,en&=67108863,T=Math.imul(pe,K),S=(S=Math.imul(pe,Y))+Math.imul(me,K)|0,U=Math.imul(me,Y),T=T+Math.imul(G,le)|0,S=(S=S+Math.imul(G,ge)|0)+Math.imul(se,le)|0,U=U+Math.imul(se,ge)|0,T=T+Math.imul(P,Ce)|0,S=(S=S+Math.imul(P,Pe)|0)+Math.imul(A,Ce)|0,U=U+Math.imul(A,Pe)|0,T=T+Math.imul(ne,Fe)|0,S=(S=S+Math.imul(ne,je)|0)+Math.imul(ce,Fe)|0,U=U+Math.imul(ce,je)|0,T=T+Math.imul(be,Ve)|0,S=(S=S+Math.imul(be,Je)|0)+Math.imul(X,Ve)|0,U=U+Math.imul(X,Je)|0,T=T+Math.imul(ee,tt)|0,S=(S=S+Math.imul(ee,Qe)|0)+Math.imul(ae,tt)|0,U=U+Math.imul(ae,Qe)|0;var cn=(N+(T=T+Math.imul(k,it)|0)|0)+((8191&(S=(S=S+Math.imul(k,rt)|0)+Math.imul(D,it)|0))<<13)|0;N=((U=U+Math.imul(D,rt)|0)+(S>>>13)|0)+(cn>>>26)|0,cn&=67108863,T=Math.imul(_e,K),S=(S=Math.imul(_e,Y))+Math.imul(Se,K)|0,U=Math.imul(Se,Y),T=T+Math.imul(pe,le)|0,S=(S=S+Math.imul(pe,ge)|0)+Math.imul(me,le)|0,U=U+Math.imul(me,ge)|0,T=T+Math.imul(G,Ce)|0,S=(S=S+Math.imul(G,Pe)|0)+Math.imul(se,Ce)|0,U=U+Math.imul(se,Pe)|0,T=T+Math.imul(P,Fe)|0,S=(S=S+Math.imul(P,je)|0)+Math.imul(A,Fe)|0,U=U+Math.imul(A,je)|0,T=T+Math.imul(ne,Ve)|0,S=(S=S+Math.imul(ne,Je)|0)+Math.imul(ce,Ve)|0,U=U+Math.imul(ce,Je)|0,T=T+Math.imul(be,tt)|0,S=(S=S+Math.imul(be,Qe)|0)+Math.imul(X,tt)|0,U=U+Math.imul(X,Qe)|0,T=T+Math.imul(ee,it)|0,S=(S=S+Math.imul(ee,rt)|0)+Math.imul(ae,it)|0,U=U+Math.imul(ae,rt)|0;var tn=(N+(T=T+Math.imul(k,nt)|0)|0)+((8191&(S=(S=S+Math.imul(k,st)|0)+Math.imul(D,nt)|0))<<13)|0;N=((U=U+Math.imul(D,st)|0)+(S>>>13)|0)+(tn>>>26)|0,tn&=67108863,T=Math.imul(Ae,K),S=(S=Math.imul(Ae,Y))+Math.imul(Ne,K)|0,U=Math.imul(Ne,Y),T=T+Math.imul(_e,le)|0,S=(S=S+Math.imul(_e,ge)|0)+Math.imul(Se,le)|0,U=U+Math.imul(Se,ge)|0,T=T+Math.imul(pe,Ce)|0,S=(S=S+Math.imul(pe,Pe)|0)+Math.imul(me,Ce)|0,U=U+Math.imul(me,Pe)|0,T=T+Math.imul(G,Fe)|0,S=(S=S+Math.imul(G,je)|0)+Math.imul(se,Fe)|0,U=U+Math.imul(se,je)|0,T=T+Math.imul(P,Ve)|0,S=(S=S+Math.imul(P,Je)|0)+Math.imul(A,Ve)|0,U=U+Math.imul(A,Je)|0,T=T+Math.imul(ne,tt)|0,S=(S=S+Math.imul(ne,Qe)|0)+Math.imul(ce,tt)|0,U=U+Math.imul(ce,Qe)|0,T=T+Math.imul(be,it)|0,S=(S=S+Math.imul(be,rt)|0)+Math.imul(X,it)|0,U=U+Math.imul(X,rt)|0,T=T+Math.imul(ee,nt)|0,S=(S=S+Math.imul(ee,st)|0)+Math.imul(ae,nt)|0,U=U+Math.imul(ae,st)|0;var nn=(N+(T=T+Math.imul(k,ft)|0)|0)+((8191&(S=(S=S+Math.imul(k,mt)|0)+Math.imul(D,ft)|0))<<13)|0;N=((U=U+Math.imul(D,mt)|0)+(S>>>13)|0)+(nn>>>26)|0,nn&=67108863,T=Math.imul(Be,K),S=(S=Math.imul(Be,Y))+Math.imul(Ge,K)|0,U=Math.imul(Ge,Y),T=T+Math.imul(Ae,le)|0,S=(S=S+Math.imul(Ae,ge)|0)+Math.imul(Ne,le)|0,U=U+Math.imul(Ne,ge)|0,T=T+Math.imul(_e,Ce)|0,S=(S=S+Math.imul(_e,Pe)|0)+Math.imul(Se,Ce)|0,U=U+Math.imul(Se,Pe)|0,T=T+Math.imul(pe,Fe)|0,S=(S=S+Math.imul(pe,je)|0)+Math.imul(me,Fe)|0,U=U+Math.imul(me,je)|0,T=T+Math.imul(G,Ve)|0,S=(S=S+Math.imul(G,Je)|0)+Math.imul(se,Ve)|0,U=U+Math.imul(se,Je)|0,T=T+Math.imul(P,tt)|0,S=(S=S+Math.imul(P,Qe)|0)+Math.imul(A,tt)|0,U=U+Math.imul(A,Qe)|0,T=T+Math.imul(ne,it)|0,S=(S=S+Math.imul(ne,rt)|0)+Math.imul(ce,it)|0,U=U+Math.imul(ce,rt)|0,T=T+Math.imul(be,nt)|0,S=(S=S+Math.imul(be,st)|0)+Math.imul(X,nt)|0,U=U+Math.imul(X,st)|0,T=T+Math.imul(ee,ft)|0,S=(S=S+Math.imul(ee,mt)|0)+Math.imul(ae,ft)|0,U=U+Math.imul(ae,mt)|0;var Yt=(N+(T=T+Math.imul(k,pt)|0)|0)+((8191&(S=(S=S+Math.imul(k,gt)|0)+Math.imul(D,pt)|0))<<13)|0;N=((U=U+Math.imul(D,gt)|0)+(S>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,T=Math.imul(Be,le),S=(S=Math.imul(Be,ge))+Math.imul(Ge,le)|0,U=Math.imul(Ge,ge),T=T+Math.imul(Ae,Ce)|0,S=(S=S+Math.imul(Ae,Pe)|0)+Math.imul(Ne,Ce)|0,U=U+Math.imul(Ne,Pe)|0,T=T+Math.imul(_e,Fe)|0,S=(S=S+Math.imul(_e,je)|0)+Math.imul(Se,Fe)|0,U=U+Math.imul(Se,je)|0,T=T+Math.imul(pe,Ve)|0,S=(S=S+Math.imul(pe,Je)|0)+Math.imul(me,Ve)|0,U=U+Math.imul(me,Je)|0,T=T+Math.imul(G,tt)|0,S=(S=S+Math.imul(G,Qe)|0)+Math.imul(se,tt)|0,U=U+Math.imul(se,Qe)|0,T=T+Math.imul(P,it)|0,S=(S=S+Math.imul(P,rt)|0)+Math.imul(A,it)|0,U=U+Math.imul(A,rt)|0,T=T+Math.imul(ne,nt)|0,S=(S=S+Math.imul(ne,st)|0)+Math.imul(ce,nt)|0,U=U+Math.imul(ce,st)|0,T=T+Math.imul(be,ft)|0,S=(S=S+Math.imul(be,mt)|0)+Math.imul(X,ft)|0,U=U+Math.imul(X,mt)|0;var rn=(N+(T=T+Math.imul(ee,pt)|0)|0)+((8191&(S=(S=S+Math.imul(ee,gt)|0)+Math.imul(ae,pt)|0))<<13)|0;N=((U=U+Math.imul(ae,gt)|0)+(S>>>13)|0)+(rn>>>26)|0,rn&=67108863,T=Math.imul(Be,Ce),S=(S=Math.imul(Be,Pe))+Math.imul(Ge,Ce)|0,U=Math.imul(Ge,Pe),T=T+Math.imul(Ae,Fe)|0,S=(S=S+Math.imul(Ae,je)|0)+Math.imul(Ne,Fe)|0,U=U+Math.imul(Ne,je)|0,T=T+Math.imul(_e,Ve)|0,S=(S=S+Math.imul(_e,Je)|0)+Math.imul(Se,Ve)|0,U=U+Math.imul(Se,Je)|0,T=T+Math.imul(pe,tt)|0,S=(S=S+Math.imul(pe,Qe)|0)+Math.imul(me,tt)|0,U=U+Math.imul(me,Qe)|0,T=T+Math.imul(G,it)|0,S=(S=S+Math.imul(G,rt)|0)+Math.imul(se,it)|0,U=U+Math.imul(se,rt)|0,T=T+Math.imul(P,nt)|0,S=(S=S+Math.imul(P,st)|0)+Math.imul(A,nt)|0,U=U+Math.imul(A,st)|0,T=T+Math.imul(ne,ft)|0,S=(S=S+Math.imul(ne,mt)|0)+Math.imul(ce,ft)|0,U=U+Math.imul(ce,mt)|0;var Ot=(N+(T=T+Math.imul(be,pt)|0)|0)+((8191&(S=(S=S+Math.imul(be,gt)|0)+Math.imul(X,pt)|0))<<13)|0;N=((U=U+Math.imul(X,gt)|0)+(S>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,T=Math.imul(Be,Fe),S=(S=Math.imul(Be,je))+Math.imul(Ge,Fe)|0,U=Math.imul(Ge,je),T=T+Math.imul(Ae,Ve)|0,S=(S=S+Math.imul(Ae,Je)|0)+Math.imul(Ne,Ve)|0,U=U+Math.imul(Ne,Je)|0,T=T+Math.imul(_e,tt)|0,S=(S=S+Math.imul(_e,Qe)|0)+Math.imul(Se,tt)|0,U=U+Math.imul(Se,Qe)|0,T=T+Math.imul(pe,it)|0,S=(S=S+Math.imul(pe,rt)|0)+Math.imul(me,it)|0,U=U+Math.imul(me,rt)|0,T=T+Math.imul(G,nt)|0,S=(S=S+Math.imul(G,st)|0)+Math.imul(se,nt)|0,U=U+Math.imul(se,st)|0,T=T+Math.imul(P,ft)|0,S=(S=S+Math.imul(P,mt)|0)+Math.imul(A,ft)|0,U=U+Math.imul(A,mt)|0;var Bt=(N+(T=T+Math.imul(ne,pt)|0)|0)+((8191&(S=(S=S+Math.imul(ne,gt)|0)+Math.imul(ce,pt)|0))<<13)|0;N=((U=U+Math.imul(ce,gt)|0)+(S>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,T=Math.imul(Be,Ve),S=(S=Math.imul(Be,Je))+Math.imul(Ge,Ve)|0,U=Math.imul(Ge,Je),T=T+Math.imul(Ae,tt)|0,S=(S=S+Math.imul(Ae,Qe)|0)+Math.imul(Ne,tt)|0,U=U+Math.imul(Ne,Qe)|0,T=T+Math.imul(_e,it)|0,S=(S=S+Math.imul(_e,rt)|0)+Math.imul(Se,it)|0,U=U+Math.imul(Se,rt)|0,T=T+Math.imul(pe,nt)|0,S=(S=S+Math.imul(pe,st)|0)+Math.imul(me,nt)|0,U=U+Math.imul(me,st)|0,T=T+Math.imul(G,ft)|0,S=(S=S+Math.imul(G,mt)|0)+Math.imul(se,ft)|0,U=U+Math.imul(se,mt)|0;var Vt=(N+(T=T+Math.imul(P,pt)|0)|0)+((8191&(S=(S=S+Math.imul(P,gt)|0)+Math.imul(A,pt)|0))<<13)|0;N=((U=U+Math.imul(A,gt)|0)+(S>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,T=Math.imul(Be,tt),S=(S=Math.imul(Be,Qe))+Math.imul(Ge,tt)|0,U=Math.imul(Ge,Qe),T=T+Math.imul(Ae,it)|0,S=(S=S+Math.imul(Ae,rt)|0)+Math.imul(Ne,it)|0,U=U+Math.imul(Ne,rt)|0,T=T+Math.imul(_e,nt)|0,S=(S=S+Math.imul(_e,st)|0)+Math.imul(Se,nt)|0,U=U+Math.imul(Se,st)|0,T=T+Math.imul(pe,ft)|0,S=(S=S+Math.imul(pe,mt)|0)+Math.imul(me,ft)|0,U=U+Math.imul(me,mt)|0;var ln=(N+(T=T+Math.imul(G,pt)|0)|0)+((8191&(S=(S=S+Math.imul(G,gt)|0)+Math.imul(se,pt)|0))<<13)|0;N=((U=U+Math.imul(se,gt)|0)+(S>>>13)|0)+(ln>>>26)|0,ln&=67108863,T=Math.imul(Be,it),S=(S=Math.imul(Be,rt))+Math.imul(Ge,it)|0,U=Math.imul(Ge,rt),T=T+Math.imul(Ae,nt)|0,S=(S=S+Math.imul(Ae,st)|0)+Math.imul(Ne,nt)|0,U=U+Math.imul(Ne,st)|0,T=T+Math.imul(_e,ft)|0,S=(S=S+Math.imul(_e,mt)|0)+Math.imul(Se,ft)|0,U=U+Math.imul(Se,mt)|0;var dn=(N+(T=T+Math.imul(pe,pt)|0)|0)+((8191&(S=(S=S+Math.imul(pe,gt)|0)+Math.imul(me,pt)|0))<<13)|0;N=((U=U+Math.imul(me,gt)|0)+(S>>>13)|0)+(dn>>>26)|0,dn&=67108863,T=Math.imul(Be,nt),S=(S=Math.imul(Be,st))+Math.imul(Ge,nt)|0,U=Math.imul(Ge,st),T=T+Math.imul(Ae,ft)|0,S=(S=S+Math.imul(Ae,mt)|0)+Math.imul(Ne,ft)|0,U=U+Math.imul(Ne,mt)|0;var Jt=(N+(T=T+Math.imul(_e,pt)|0)|0)+((8191&(S=(S=S+Math.imul(_e,gt)|0)+Math.imul(Se,pt)|0))<<13)|0;N=((U=U+Math.imul(Se,gt)|0)+(S>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,T=Math.imul(Be,ft),S=(S=Math.imul(Be,mt))+Math.imul(Ge,ft)|0,U=Math.imul(Ge,mt);var sn=(N+(T=T+Math.imul(Ae,pt)|0)|0)+((8191&(S=(S=S+Math.imul(Ae,gt)|0)+Math.imul(Ne,pt)|0))<<13)|0;N=((U=U+Math.imul(Ne,gt)|0)+(S>>>13)|0)+(sn>>>26)|0,sn&=67108863;var Wt=(N+(T=Math.imul(Be,pt))|0)+((8191&(S=(S=Math.imul(Be,gt))+Math.imul(Ge,pt)|0))<<13)|0;return N=((U=Math.imul(Ge,gt))+(S>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,V[0]=on,V[1]=Tt,V[2]=Mt,V[3]=zt,V[4]=an,V[5]=en,V[6]=cn,V[7]=tn,V[8]=nn,V[9]=Yt,V[10]=rn,V[11]=Ot,V[12]=Bt,V[13]=Vt,V[14]=ln,V[15]=dn,V[16]=Jt,V[17]=sn,V[18]=Wt,0!==N&&(V[19]=N,j.length++),j};function h(z,M,L){return(new l).mulp(z,M,L)}function l(z,M){this.x=z,this.y=M}Math.imul||(n=t),d.prototype.mulTo=function(M,L){var j,C=this.length+M.length;return j=10===this.length&&10===M.length?n(this,M,L):C<63?t(this,M,L):C<1024?function o(z,M,L){L.negative=M.negative^z.negative,L.length=z.length+M.length;for(var j=0,C=0,F=0;F<L.length-1;F++){var V=C;C=0;for(var N=67108863&j,T=Math.min(F,M.length-1),S=Math.max(0,F-z.length+1);S<=T;S++){var D=(0|z.words[F-S])*(0|M.words[S]),Q=67108863&D;N=67108863&(Q=Q+N|0),C+=(V=(V=V+(D/67108864|0)|0)+(Q>>>26)|0)>>>26,V&=67108863}L.words[F]=N,j=V,V=C}return 0!==j?L.words[F]=j:L.length--,L.strip()}(this,M,L):h(this,M,L),j},l.prototype.makeRBT=function(M){for(var L=new Array(M),j=d.prototype._countBits(M)-1,C=0;C<M;C++)L[C]=this.revBin(C,j,M);return L},l.prototype.revBin=function(M,L,j){if(0===M||M===j-1)return M;for(var C=0,F=0;F<L;F++)C|=(1&M)<<L-F-1,M>>=1;return C},l.prototype.permute=function(M,L,j,C,F,V){for(var N=0;N<V;N++)C[N]=L[M[N]],F[N]=j[M[N]]},l.prototype.transform=function(M,L,j,C,F,V){this.permute(V,M,L,j,C,F);for(var N=1;N<F;N<<=1)for(var T=N<<1,S=Math.cos(2*Math.PI/T),U=Math.sin(2*Math.PI/T),W=0;W<F;W+=T)for(var k=S,D=U,Q=0;Q<N;Q++){var ee=j[W+Q],ae=C[W+Q],ue=j[W+Q+N],be=C[W+Q+N],X=k*ue-D*be;be=k*be+D*ue,j[W+Q]=ee+(ue=X),C[W+Q]=ae+be,j[W+Q+N]=ee-ue,C[W+Q+N]=ae-be,Q!==T&&(X=S*k-U*D,D=S*D+U*k,k=X)}},l.prototype.guessLen13b=function(M,L){var j=1|Math.max(L,M),C=1&j,F=0;for(j=j/2|0;j;j>>>=1)F++;return 1<<F+1+C},l.prototype.conjugate=function(M,L,j){if(!(j<=1))for(var C=0;C<j/2;C++){var F=M[C];M[C]=M[j-C-1],M[j-C-1]=F,F=L[C],L[C]=-L[j-C-1],L[j-C-1]=-F}},l.prototype.normalize13b=function(M,L){for(var j=0,C=0;C<L/2;C++){var F=8192*Math.round(M[2*C+1]/L)+Math.round(M[2*C]/L)+j;M[C]=67108863&F,j=F<67108864?0:F/67108864|0}return M},l.prototype.convert13b=function(M,L,j,C){for(var F=0,V=0;V<L;V++)j[2*V]=8191&(F+=0|M[V]),j[2*V+1]=8191&(F>>>=13),F>>>=13;for(V=2*L;V<C;++V)j[V]=0;E(0===F),E(0==(-8192&F))},l.prototype.stub=function(M){for(var L=new Array(M),j=0;j<M;j++)L[j]=0;return L},l.prototype.mulp=function(M,L,j){var C=2*this.guessLen13b(M.length,L.length),F=this.makeRBT(C),V=this.stub(C),N=new Array(C),T=new Array(C),S=new Array(C),U=new Array(C),W=new Array(C),k=new Array(C),D=j.words;D.length=C,this.convert13b(M.words,M.length,N,C),this.convert13b(L.words,L.length,U,C),this.transform(N,V,T,S,C,F),this.transform(U,V,W,k,C,F);for(var Q=0;Q<C;Q++){var ee=T[Q]*W[Q]-S[Q]*k[Q];S[Q]=T[Q]*k[Q]+S[Q]*W[Q],T[Q]=ee}return this.conjugate(T,S,C),this.transform(T,S,D,V,C,F),this.conjugate(D,V,C),this.normalize13b(D,C),j.negative=M.negative^L.negative,j.length=M.length+L.length,j.strip()},d.prototype.mul=function(M){var L=new d(null);return L.words=new Array(this.length+M.length),this.mulTo(M,L)},d.prototype.mulf=function(M){var L=new d(null);return L.words=new Array(this.length+M.length),h(this,M,L)},d.prototype.imul=function(M){return this.clone().mulTo(M,this)},d.prototype.imuln=function(M){E("number"==typeof M),E(M<67108864);for(var L=0,j=0;j<this.length;j++){var C=(0|this.words[j])*M,F=(67108863&C)+(67108863&L);L>>=26,L+=C/67108864|0,L+=F>>>26,this.words[j]=67108863&F}return 0!==L&&(this.words[j]=L,this.length++),this},d.prototype.muln=function(M){return this.clone().imuln(M)},d.prototype.sqr=function(){return this.mul(this)},d.prototype.isqr=function(){return this.imul(this.clone())},d.prototype.pow=function(M){var L=function s(z){for(var M=new Array(z.bitLength()),L=0;L<M.length;L++){var C=L%26;M[L]=(z.words[L/26|0]&1<<C)>>>C}return M}(M);if(0===L.length)return new d(1);for(var j=this,C=0;C<L.length&&0===L[C];C++,j=j.sqr());if(++C<L.length)for(var F=j.sqr();C<L.length;C++,F=F.sqr())0!==L[C]&&(j=j.mul(F));return j},d.prototype.iushln=function(M){E("number"==typeof M&&M>=0);var F,L=M%26,j=(M-L)/26,C=67108863>>>26-L<<26-L;if(0!==L){var V=0;for(F=0;F<this.length;F++){var N=this.words[F]&C;this.words[F]=(0|this.words[F])-N<<L|V,V=N>>>26-L}V&&(this.words[F]=V,this.length++)}if(0!==j){for(F=this.length-1;F>=0;F--)this.words[F+j]=this.words[F];for(F=0;F<j;F++)this.words[F]=0;this.length+=j}return this.strip()},d.prototype.ishln=function(M){return E(0===this.negative),this.iushln(M)},d.prototype.iushrn=function(M,L,j){var C;E("number"==typeof M&&M>=0),C=L?(L-L%26)/26:0;var F=M%26,V=Math.min((M-F)/26,this.length),N=67108863^67108863>>>F<<F,T=j;if(C-=V,C=Math.max(0,C),T){for(var S=0;S<V;S++)T.words[S]=this.words[S];T.length=V}if(0!==V)if(this.length>V)for(this.length-=V,S=0;S<this.length;S++)this.words[S]=this.words[S+V];else this.words[0]=0,this.length=1;var U=0;for(S=this.length-1;S>=0&&(0!==U||S>=C);S--){var W=0|this.words[S];this.words[S]=U<<26-F|W>>>F,U=W&N}return T&&0!==U&&(T.words[T.length++]=U),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},d.prototype.ishrn=function(M,L,j){return E(0===this.negative),this.iushrn(M,L,j)},d.prototype.shln=function(M){return this.clone().ishln(M)},d.prototype.ushln=function(M){return this.clone().iushln(M)},d.prototype.shrn=function(M){return this.clone().ishrn(M)},d.prototype.ushrn=function(M){return this.clone().iushrn(M)},d.prototype.testn=function(M){E("number"==typeof M&&M>=0);var L=M%26,j=(M-L)/26;return!(this.length<=j||!(this.words[j]&1<<L))},d.prototype.imaskn=function(M){E("number"==typeof M&&M>=0);var L=M%26,j=(M-L)/26;return E(0===this.negative,"imaskn works only with positive numbers"),this.length<=j?this:(0!==L&&j++,this.length=Math.min(j,this.length),0!==L&&(this.words[this.length-1]&=67108863^67108863>>>L<<L),this.strip())},d.prototype.maskn=function(M){return this.clone().imaskn(M)},d.prototype.iaddn=function(M){return E("number"==typeof M),E(M<67108864),M<0?this.isubn(-M):0!==this.negative?1===this.length&&(0|this.words[0])<M?(this.words[0]=M-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(M),this.negative=1,this):this._iaddn(M)},d.prototype._iaddn=function(M){this.words[0]+=M;for(var L=0;L<this.length&&this.words[L]>=67108864;L++)this.words[L]-=67108864,L===this.length-1?this.words[L+1]=1:this.words[L+1]++;return this.length=Math.max(this.length,L+1),this},d.prototype.isubn=function(M){if(E("number"==typeof M),E(M<67108864),M<0)return this.iaddn(-M);if(0!==this.negative)return this.negative=0,this.iaddn(M),this.negative=1,this;if(this.words[0]-=M,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var L=0;L<this.length&&this.words[L]<0;L++)this.words[L]+=67108864,this.words[L+1]-=1;return this.strip()},d.prototype.addn=function(M){return this.clone().iaddn(M)},d.prototype.subn=function(M){return this.clone().isubn(M)},d.prototype.iabs=function(){return this.negative=0,this},d.prototype.abs=function(){return this.clone().iabs()},d.prototype._ishlnsubmul=function(M,L,j){var F;this._expand(M.length+j);var V,N=0;for(F=0;F<M.length;F++){V=(0|this.words[F+j])+N;var T=(0|M.words[F])*L;N=((V-=67108863&T)>>26)-(T/67108864|0),this.words[F+j]=67108863&V}for(;F<this.length-j;F++)N=(V=(0|this.words[F+j])+N)>>26,this.words[F+j]=67108863&V;if(0===N)return this.strip();for(E(-1===N),N=0,F=0;F<this.length;F++)N=(V=-(0|this.words[F])+N)>>26,this.words[F]=67108863&V;return this.negative=1,this.strip()},d.prototype._wordDiv=function(M,L){var j,C=this.clone(),F=M,V=0|F.words[F.length-1];0!=(j=26-this._countBits(V))&&(F=F.ushln(j),C.iushln(j),V=0|F.words[F.length-1]);var S,T=C.length-F.length;if("mod"!==L){(S=new d(null)).length=T+1,S.words=new Array(S.length);for(var U=0;U<S.length;U++)S.words[U]=0}var W=C.clone()._ishlnsubmul(F,1,T);0===W.negative&&(C=W,S&&(S.words[T]=1));for(var k=T-1;k>=0;k--){var D=67108864*(0|C.words[F.length+k])+(0|C.words[F.length+k-1]);for(D=Math.min(D/V|0,67108863),C._ishlnsubmul(F,D,k);0!==C.negative;)D--,C.negative=0,C._ishlnsubmul(F,1,k),C.isZero()||(C.negative^=1);S&&(S.words[k]=D)}return S&&S.strip(),C.strip(),"div"!==L&&0!==j&&C.iushrn(j),{div:S||null,mod:C}},d.prototype.divmod=function(M,L,j){return E(!M.isZero()),this.isZero()?{div:new d(0),mod:new d(0)}:0!==this.negative&&0===M.negative?(V=this.neg().divmod(M,L),"mod"!==L&&(C=V.div.neg()),"div"!==L&&(F=V.mod.neg(),j&&0!==F.negative&&F.iadd(M)),{div:C,mod:F}):0===this.negative&&0!==M.negative?(V=this.divmod(M.neg(),L),"mod"!==L&&(C=V.div.neg()),{div:C,mod:V.mod}):this.negative&M.negative?(V=this.neg().divmod(M.neg(),L),"div"!==L&&(F=V.mod.neg(),j&&0!==F.negative&&F.isub(M)),{div:V.div,mod:F}):M.length>this.length||this.cmp(M)<0?{div:new d(0),mod:this}:1===M.length?"div"===L?{div:this.divn(M.words[0]),mod:null}:"mod"===L?{div:null,mod:new d(this.modn(M.words[0]))}:{div:this.divn(M.words[0]),mod:new d(this.modn(M.words[0]))}:this._wordDiv(M,L);var C,F,V},d.prototype.div=function(M){return this.divmod(M,"div",!1).div},d.prototype.mod=function(M){return this.divmod(M,"mod",!1).mod},d.prototype.umod=function(M){return this.divmod(M,"mod",!0).mod},d.prototype.divRound=function(M){var L=this.divmod(M);if(L.mod.isZero())return L.div;var j=0!==L.div.negative?L.mod.isub(M):L.mod,C=M.ushrn(1),F=M.andln(1),V=j.cmp(C);return V<0||1===F&&0===V?L.div:0!==L.div.negative?L.div.isubn(1):L.div.iaddn(1)},d.prototype.modn=function(M){E(M<=67108863);for(var L=(1<<26)%M,j=0,C=this.length-1;C>=0;C--)j=(L*j+(0|this.words[C]))%M;return j},d.prototype.idivn=function(M){E(M<=67108863);for(var L=0,j=this.length-1;j>=0;j--){var C=(0|this.words[j])+67108864*L;this.words[j]=C/M|0,L=C%M}return this.strip()},d.prototype.divn=function(M){return this.clone().idivn(M)},d.prototype.egcd=function(M){E(0===M.negative),E(!M.isZero());var L=this,j=M.clone();L=0!==L.negative?L.umod(M):L.clone();for(var C=new d(1),F=new d(0),V=new d(0),N=new d(1),T=0;L.isEven()&&j.isEven();)L.iushrn(1),j.iushrn(1),++T;for(var S=j.clone(),U=L.clone();!L.isZero();){for(var W=0,k=1;!(L.words[0]&k)&&W<26;++W,k<<=1);if(W>0)for(L.iushrn(W);W-- >0;)(C.isOdd()||F.isOdd())&&(C.iadd(S),F.isub(U)),C.iushrn(1),F.iushrn(1);for(var D=0,Q=1;!(j.words[0]&Q)&&D<26;++D,Q<<=1);if(D>0)for(j.iushrn(D);D-- >0;)(V.isOdd()||N.isOdd())&&(V.iadd(S),N.isub(U)),V.iushrn(1),N.iushrn(1);L.cmp(j)>=0?(L.isub(j),C.isub(V),F.isub(N)):(j.isub(L),V.isub(C),N.isub(F))}return{a:V,b:N,gcd:j.iushln(T)}},d.prototype._invmp=function(M){E(0===M.negative),E(!M.isZero());var W,L=this,j=M.clone();L=0!==L.negative?L.umod(M):L.clone();for(var C=new d(1),F=new d(0),V=j.clone();L.cmpn(1)>0&&j.cmpn(1)>0;){for(var N=0,T=1;!(L.words[0]&T)&&N<26;++N,T<<=1);if(N>0)for(L.iushrn(N);N-- >0;)C.isOdd()&&C.iadd(V),C.iushrn(1);for(var S=0,U=1;!(j.words[0]&U)&&S<26;++S,U<<=1);if(S>0)for(j.iushrn(S);S-- >0;)F.isOdd()&&F.iadd(V),F.iushrn(1);L.cmp(j)>=0?(L.isub(j),C.isub(F)):(j.isub(L),F.isub(C))}return(W=0===L.cmpn(1)?C:F).cmpn(0)<0&&W.iadd(M),W},d.prototype.gcd=function(M){if(this.isZero())return M.abs();if(M.isZero())return this.abs();var L=this.clone(),j=M.clone();L.negative=0,j.negative=0;for(var C=0;L.isEven()&&j.isEven();C++)L.iushrn(1),j.iushrn(1);for(;;){for(;L.isEven();)L.iushrn(1);for(;j.isEven();)j.iushrn(1);var F=L.cmp(j);if(F<0){var V=L;L=j,j=V}else if(0===F||0===j.cmpn(1))break;L.isub(j)}return j.iushln(C)},d.prototype.invm=function(M){return this.egcd(M).a.umod(M)},d.prototype.isEven=function(){return 0==(1&this.words[0])},d.prototype.isOdd=function(){return 1==(1&this.words[0])},d.prototype.andln=function(M){return this.words[0]&M},d.prototype.bincn=function(M){E("number"==typeof M);var L=M%26,j=(M-L)/26,C=1<<L;if(this.length<=j)return this._expand(j+1),this.words[j]|=C,this;for(var F=C,V=j;0!==F&&V<this.length;V++){var N=0|this.words[V];F=(N+=F)>>>26,this.words[V]=N&=67108863}return 0!==F&&(this.words[V]=F,this.length++),this},d.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},d.prototype.cmpn=function(M){var j,L=M<0;if(0!==this.negative&&!L)return-1;if(0===this.negative&&L)return 1;if(this.strip(),this.length>1)j=1;else{L&&(M=-M),E(M<=67108863,"Number is too big");var C=0|this.words[0];j=C===M?0:C<M?-1:1}return 0!==this.negative?0|-j:j},d.prototype.cmp=function(M){if(0!==this.negative&&0===M.negative)return-1;if(0===this.negative&&0!==M.negative)return 1;var L=this.ucmp(M);return 0!==this.negative?0|-L:L},d.prototype.ucmp=function(M){if(this.length>M.length)return 1;if(this.length<M.length)return-1;for(var L=0,j=this.length-1;j>=0;j--){var C=0|this.words[j],F=0|M.words[j];if(C!==F){C<F?L=-1:C>F&&(L=1);break}}return L},d.prototype.gtn=function(M){return 1===this.cmpn(M)},d.prototype.gt=function(M){return 1===this.cmp(M)},d.prototype.gten=function(M){return this.cmpn(M)>=0},d.prototype.gte=function(M){return this.cmp(M)>=0},d.prototype.ltn=function(M){return-1===this.cmpn(M)},d.prototype.lt=function(M){return-1===this.cmp(M)},d.prototype.lten=function(M){return this.cmpn(M)<=0},d.prototype.lte=function(M){return this.cmp(M)<=0},d.prototype.eqn=function(M){return 0===this.cmpn(M)},d.prototype.eq=function(M){return 0===this.cmp(M)},d.red=function(M){return new B(M)},d.prototype.toRed=function(M){return E(!this.red,"Already a number in reduction context"),E(0===this.negative,"red works only with positives"),M.convertTo(this)._forceRed(M)},d.prototype.fromRed=function(){return E(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},d.prototype._forceRed=function(M){return this.red=M,this},d.prototype.forceRed=function(M){return E(!this.red,"Already a number in reduction context"),this._forceRed(M)},d.prototype.redAdd=function(M){return E(this.red,"redAdd works only with red numbers"),this.red.add(this,M)},d.prototype.redIAdd=function(M){return E(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,M)},d.prototype.redSub=function(M){return E(this.red,"redSub works only with red numbers"),this.red.sub(this,M)},d.prototype.redISub=function(M){return E(this.red,"redISub works only with red numbers"),this.red.isub(this,M)},d.prototype.redShl=function(M){return E(this.red,"redShl works only with red numbers"),this.red.shl(this,M)},d.prototype.redMul=function(M){return E(this.red,"redMul works only with red numbers"),this.red._verify2(this,M),this.red.mul(this,M)},d.prototype.redIMul=function(M){return E(this.red,"redMul works only with red numbers"),this.red._verify2(this,M),this.red.imul(this,M)},d.prototype.redSqr=function(){return E(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},d.prototype.redISqr=function(){return E(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},d.prototype.redSqrt=function(){return E(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},d.prototype.redInvm=function(){return E(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},d.prototype.redNeg=function(){return E(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},d.prototype.redPow=function(M){return E(this.red&&!M.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,M)};var e={k256:null,p224:null,p192:null,p25519:null};function p(z,M){this.name=z,this.p=new d(M,16),this.n=this.p.bitLength(),this.k=new d(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){p.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function y(){p.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){p.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function x(){p.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function B(z){if("string"==typeof z){var M=d._prime(z);this.m=M.p,this.prime=M}else E(z.gtn(1),"modulus must be greater than 1"),this.m=z,this.prime=null}function J(z){B.call(this,z),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new d(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}p.prototype._tmp=function(){var M=new d(null);return M.words=new Array(Math.ceil(this.n/13)),M},p.prototype.ireduce=function(M){var j,L=M;do{this.split(L,this.tmp),j=(L=(L=this.imulK(L)).iadd(this.tmp)).bitLength()}while(j>this.n);var C=j<this.n?-1:L.ucmp(this.p);return 0===C?(L.words[0]=0,L.length=1):C>0?L.isub(this.p):void 0!==L.strip?L.strip():L._strip(),L},p.prototype.split=function(M,L){M.iushrn(this.n,0,L)},p.prototype.imulK=function(M){return M.imul(this.k)},_(b,p),b.prototype.split=function(M,L){for(var j=4194303,C=Math.min(M.length,9),F=0;F<C;F++)L.words[F]=M.words[F];if(L.length=C,M.length<=9)return M.words[0]=0,void(M.length=1);var V=M.words[9];for(L.words[L.length++]=V&j,F=10;F<M.length;F++){var N=0|M.words[F];M.words[F-10]=(N&j)<<4|V>>>22,V=N}M.words[F-10]=V>>>=22,M.length-=0===V&&M.length>10?10:9},b.prototype.imulK=function(M){M.words[M.length]=0,M.words[M.length+1]=0,M.length+=2;for(var L=0,j=0;j<M.length;j++){var C=0|M.words[j];M.words[j]=67108863&(L+=977*C),L=64*C+(L/67108864|0)}return 0===M.words[M.length-1]&&(M.length--,0===M.words[M.length-1]&&M.length--),M},_(y,p),_(w,p),_(x,p),x.prototype.imulK=function(M){for(var L=0,j=0;j<M.length;j++){var C=19*(0|M.words[j])+L,F=67108863&C;C>>>=26,M.words[j]=F,L=C}return 0!==L&&(M.words[M.length++]=L),M},d._prime=function(M){if(e[M])return e[M];var L;if("k256"===M)L=new b;else if("p224"===M)L=new y;else if("p192"===M)L=new w;else{if("p25519"!==M)throw new Error("Unknown prime "+M);L=new x}return e[M]=L,L},B.prototype._verify1=function(M){E(0===M.negative,"red works only with positives"),E(M.red,"red works only with red numbers")},B.prototype._verify2=function(M,L){E(0==(M.negative|L.negative),"red works only with positives"),E(M.red&&M.red===L.red,"red works only with red numbers")},B.prototype.imod=function(M){return this.prime?this.prime.ireduce(M)._forceRed(this):M.umod(this.m)._forceRed(this)},B.prototype.neg=function(M){return M.isZero()?M.clone():this.m.sub(M)._forceRed(this)},B.prototype.add=function(M,L){this._verify2(M,L);var j=M.add(L);return j.cmp(this.m)>=0&&j.isub(this.m),j._forceRed(this)},B.prototype.iadd=function(M,L){this._verify2(M,L);var j=M.iadd(L);return j.cmp(this.m)>=0&&j.isub(this.m),j},B.prototype.sub=function(M,L){this._verify2(M,L);var j=M.sub(L);return j.cmpn(0)<0&&j.iadd(this.m),j._forceRed(this)},B.prototype.isub=function(M,L){this._verify2(M,L);var j=M.isub(L);return j.cmpn(0)<0&&j.iadd(this.m),j},B.prototype.shl=function(M,L){return this._verify1(M),this.imod(M.ushln(L))},B.prototype.imul=function(M,L){return this._verify2(M,L),this.imod(M.imul(L))},B.prototype.mul=function(M,L){return this._verify2(M,L),this.imod(M.mul(L))},B.prototype.isqr=function(M){return this.imul(M,M.clone())},B.prototype.sqr=function(M){return this.mul(M,M)},B.prototype.sqrt=function(M){if(M.isZero())return M.clone();var L=this.m.andln(3);if(E(L%2==1),3===L){var j=this.m.add(new d(1)).iushrn(2);return this.pow(M,j)}for(var C=this.m.subn(1),F=0;!C.isZero()&&0===C.andln(1);)F++,C.iushrn(1);E(!C.isZero());var V=new d(1).toRed(this),N=V.redNeg(),T=this.m.subn(1).iushrn(1),S=this.m.bitLength();for(S=new d(2*S*S).toRed(this);0!==this.pow(S,T).cmp(N);)S.redIAdd(N);for(var U=this.pow(S,C),W=this.pow(M,C.addn(1).iushrn(1)),k=this.pow(M,C),D=F;0!==k.cmp(V);){for(var Q=k,ee=0;0!==Q.cmp(V);ee++)Q=Q.redSqr();E(ee<D);var ae=this.pow(U,new d(1).iushln(D-ee-1));W=W.redMul(ae),U=ae.redSqr(),k=k.redMul(U),D=ee}return W},B.prototype.invm=function(M){var L=M._invmp(this.m);return 0!==L.negative?(L.negative=0,this.imod(L).redNeg()):this.imod(L)},B.prototype.pow=function(M,L){if(L.isZero())return new d(1).toRed(this);if(0===L.cmpn(1))return M.clone();var C=new Array(16);C[0]=new d(1).toRed(this),C[1]=M;for(var F=2;F<C.length;F++)C[F]=this.mul(C[F-1],M);var V=C[0],N=0,T=0,S=L.bitLength()%26;for(0===S&&(S=26),F=L.length-1;F>=0;F--){for(var U=L.words[F],W=S-1;W>=0;W--){var k=U>>W&1;V!==C[0]&&(V=this.sqr(V)),0!==k||0!==N?(N<<=1,N|=k,(4==++T||0===F&&0===W)&&(V=this.mul(V,C[N]),T=0,N=0)):T=0}S=26}return V},B.prototype.convertTo=function(M){var L=M.umod(this.m);return L===M?L.clone():L},B.prototype.convertFrom=function(M){var L=M.clone();return L.red=null,L},d.mont=function(M){return new J(M)},_(J,B),J.prototype.convertTo=function(M){return this.imod(M.ushln(this.shift))},J.prototype.convertFrom=function(M){var L=this.imod(M.mul(this.rinv));return L.red=null,L},J.prototype.imul=function(M,L){if(M.isZero()||L.isZero())return M.words[0]=0,M.length=1,M;var j=M.imul(L),C=j.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),F=j.isub(C).iushrn(this.shift),V=F;return F.cmp(this.m)>=0?V=F.isub(this.m):F.cmpn(0)<0&&(V=F.iadd(this.m)),V._forceRed(this)},J.prototype.mul=function(M,L){if(M.isZero()||L.isZero())return new d(0)._forceRed(this);var j=M.mul(L),C=j.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),F=j.isub(C).iushrn(this.shift),V=F;return F.cmp(this.m)>=0?V=F.isub(this.m):F.cmpn(0)<0&&(V=F.iadd(this.m)),V._forceRed(this)},J.prototype.invm=function(M){return this.imod(M._invmp(this.m).mul(this.r2))._forceRed(this)}}(typeof ie>"u"||ie,this)},{buffer:20}],19:[function(m,ie,a){var R;function I(_){this.rand=_}if(ie.exports=function(d){return R||(R=new I(null)),R.generate(d)},ie.exports.Rand=I,I.prototype.generate=function(d){return this._rand(d)},I.prototype._rand=function(d){if(this.rand.getBytes)return this.rand.getBytes(d);for(var u=new Uint8Array(d),g=0;g<u.length;g++)u[g]=this.rand.getByte();return u},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?I.prototype._rand=function(d){var u=new Uint8Array(d);return self.crypto.getRandomValues(u),u}:self.msCrypto&&self.msCrypto.getRandomValues?I.prototype._rand=function(d){var u=new Uint8Array(d);return self.msCrypto.getRandomValues(u),u}:"object"==typeof window&&(I.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var E=m("crypto");if("function"!=typeof E.randomBytes)throw new Error("Not supported");I.prototype._rand=function(d){return E.randomBytes(d)}}catch{}},{crypto:20}],20:[function(m,ie,a){},{}],21:[function(m,ie,a){var R=m("safe-buffer").Buffer;function I(f){R.isBuffer(f)||(f=R.from(f));for(var v=f.length/4|0,c=new Array(v),i=0;i<v;i++)c[i]=f.readUInt32BE(4*i);return c}function E(f){for(;0<f.length;f++)f[0]=0}function _(f,v,c,i,r){for(var b,y,w,x,s=c[0],t=c[1],n=c[2],o=c[3],h=f[0]^v[0],l=f[1]^v[1],e=f[2]^v[2],p=f[3]^v[3],B=4,J=1;J<r;J++)b=s[h>>>24]^t[l>>>16&255]^n[e>>>8&255]^o[255&p]^v[B++],y=s[l>>>24]^t[e>>>16&255]^n[p>>>8&255]^o[255&h]^v[B++],w=s[e>>>24]^t[p>>>16&255]^n[h>>>8&255]^o[255&l]^v[B++],x=s[p>>>24]^t[h>>>16&255]^n[l>>>8&255]^o[255&e]^v[B++],h=b,l=y,e=w,p=x;return b=(i[h>>>24]<<24|i[l>>>16&255]<<16|i[e>>>8&255]<<8|i[255&p])^v[B++],y=(i[l>>>24]<<24|i[e>>>16&255]<<16|i[p>>>8&255]<<8|i[255&h])^v[B++],w=(i[e>>>24]<<24|i[p>>>16&255]<<16|i[h>>>8&255]<<8|i[255&l])^v[B++],x=(i[p>>>24]<<24|i[h>>>16&255]<<16|i[l>>>8&255]<<8|i[255&e])^v[B++],[b>>>=0,y>>>=0,w>>>=0,x>>>=0]}var d=[0,1,2,4,8,16,32,64,128,27,54],u=function(){for(var f=new Array(256),v=0;v<256;v++)f[v]=v<128?v<<1:v<<1^283;for(var c=[],i=[],r=[[],[],[],[]],s=[[],[],[],[]],t=0,n=0,o=0;o<256;++o){var h=n^n<<1^n<<2^n<<3^n<<4;c[t]=h=h>>>8^255&h^99,i[h]=t;var l=f[t],e=f[l],p=f[e],b=257*f[h]^16843008*h;r[0][t]=b<<24|b>>>8,r[1][t]=b<<16|b>>>16,r[2][t]=b<<8|b>>>24,r[3][t]=b,s[0][h]=(b=16843009*p^65537*e^257*l^16843008*t)<<24|b>>>8,s[1][h]=b<<16|b>>>16,s[2][h]=b<<8|b>>>24,s[3][h]=b,0===t?t=n=1:(t=l^f[f[f[p^l]]],n^=f[f[n]])}return{SBOX:c,INV_SBOX:i,SUB_MIX:r,INV_SUB_MIX:s}}();function g(f){this._key=I(f),this._reset()}g.blockSize=16,g.keySize=32,g.prototype.blockSize=g.blockSize,g.prototype.keySize=g.keySize,g.prototype._reset=function(){for(var f=this._key,v=f.length,c=v+6,i=4*(c+1),r=[],s=0;s<v;s++)r[s]=f[s];for(s=v;s<i;s++){var t=r[s-1];s%v==0?(t=u.SBOX[(t=t<<8|t>>>24)>>>24]<<24|u.SBOX[t>>>16&255]<<16|u.SBOX[t>>>8&255]<<8|u.SBOX[255&t],t^=d[s/v|0]<<24):v>6&&s%v==4&&(t=u.SBOX[t>>>24]<<24|u.SBOX[t>>>16&255]<<16|u.SBOX[t>>>8&255]<<8|u.SBOX[255&t]),r[s]=r[s-v]^t}for(var n=[],o=0;o<i;o++){var h=i-o,l=r[h-(o%4?0:4)];n[o]=o<4||h<=4?l:u.INV_SUB_MIX[0][u.SBOX[l>>>24]]^u.INV_SUB_MIX[1][u.SBOX[l>>>16&255]]^u.INV_SUB_MIX[2][u.SBOX[l>>>8&255]]^u.INV_SUB_MIX[3][u.SBOX[255&l]]}this._nRounds=c,this._keySchedule=r,this._invKeySchedule=n},g.prototype.encryptBlockRaw=function(f){return _(f=I(f),this._keySchedule,u.SUB_MIX,u.SBOX,this._nRounds)},g.prototype.encryptBlock=function(f){var v=this.encryptBlockRaw(f),c=R.allocUnsafe(16);return c.writeUInt32BE(v[0],0),c.writeUInt32BE(v[1],4),c.writeUInt32BE(v[2],8),c.writeUInt32BE(v[3],12),c},g.prototype.decryptBlock=function(f){var v=(f=I(f))[1];f[1]=f[3],f[3]=v;var c=_(f,this._invKeySchedule,u.INV_SUB_MIX,u.INV_SBOX,this._nRounds),i=R.allocUnsafe(16);return i.writeUInt32BE(c[0],0),i.writeUInt32BE(c[3],4),i.writeUInt32BE(c[2],8),i.writeUInt32BE(c[1],12),i},g.prototype.scrub=function(){E(this._keySchedule),E(this._invKeySchedule),E(this._key)},ie.exports.AES=g},{"safe-buffer":250}],22:[function(m,ie,a){var R=m("./aes"),I=m("safe-buffer").Buffer,E=m("cipher-base"),_=m("inherits"),d=m("./ghash"),u=m("buffer-xor"),g=m("./incr32");function c(i,r,s,t){E.call(this);var n=I.alloc(4,0);this._cipher=new R.AES(r);var o=this._cipher.encryptBlock(n);this._ghash=new d(o),s=function v(i,r,s){if(12===r.length)return i._finID=I.concat([r,I.from([0,0,0,1])]),I.concat([r,I.from([0,0,0,2])]);var t=new d(s),n=r.length,o=n%16;t.update(r),o&&t.update(I.alloc(o=16-o,0)),t.update(I.alloc(8,0));var h=8*n,l=I.alloc(8);l.writeUIntBE(h,0,8),t.update(l),i._finID=t.state;var e=I.from(i._finID);return g(e),e}(this,s,o),this._prev=I.from(s),this._cache=I.allocUnsafe(0),this._secCache=I.allocUnsafe(0),this._decrypt=t,this._alen=0,this._len=0,this._mode=i,this._authTag=null,this._called=!1}_(c,E),c.prototype._update=function(i){if(!this._called&&this._alen){var r=16-this._alen%16;r<16&&(r=I.alloc(r,0),this._ghash.update(r))}this._called=!0;var s=this._mode.encrypt(this,i);return this._ghash.update(this._decrypt?i:s),this._len+=i.length,s},c.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var i=u(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function f(i,r){var s=0;i.length!==r.length&&s++;for(var t=Math.min(i.length,r.length),n=0;n<t;++n)s+=i[n]^r[n];return s}(i,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=i,this._cipher.scrub()},c.prototype.getAuthTag=function(){if(this._decrypt||!I.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},c.prototype.setAuthTag=function(r){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=r},c.prototype.setAAD=function(r){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(r),this._alen+=r.length},ie.exports=c},{"./aes":21,"./ghash":26,"./incr32":27,"buffer-xor":67,"cipher-base":71,inherits:146,"safe-buffer":250}],23:[function(m,ie,a){var R=m("./encrypter"),I=m("./decrypter"),E=m("./modes/list.json");a.createCipher=a.Cipher=R.createCipher,a.createCipheriv=a.Cipheriv=R.createCipheriv,a.createDecipher=a.Decipher=I.createDecipher,a.createDecipheriv=a.Decipheriv=I.createDecipheriv,a.listCiphers=a.getCiphers=function _(){return Object.keys(E)}},{"./decrypter":24,"./encrypter":25,"./modes/list.json":35}],24:[function(m,ie,a){var R=m("./authCipher"),I=m("safe-buffer").Buffer,E=m("./modes"),_=m("./streamCipher"),d=m("cipher-base"),u=m("./aes"),g=m("evp_bytestokey");function v(t,n,o){d.call(this),this._cache=new c,this._last=void 0,this._cipher=new u.AES(n),this._prev=I.from(o),this._mode=t,this._autopadding=!0}function c(){this.cache=I.allocUnsafe(0)}function r(t,n,o){var h=E[t.toLowerCase()];if(!h)throw new TypeError("invalid suite type");if("string"==typeof o&&(o=I.from(o)),"GCM"!==h.mode&&o.length!==h.iv)throw new TypeError("invalid iv length "+o.length);if("string"==typeof n&&(n=I.from(n)),n.length!==h.key/8)throw new TypeError("invalid key length "+n.length);return"stream"===h.type?new _(h.module,n,o,!0):"auth"===h.type?new R(h.module,n,o,!0):new v(h.module,n,o)}m("inherits")(v,d),v.prototype._update=function(t){this._cache.add(t);for(var n,o,h=[];n=this._cache.get(this._autopadding);)o=this._mode.decrypt(this,n),h.push(o);return I.concat(h)},v.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return function i(t){var n=t[15];if(n<1||n>16)throw new Error("unable to decrypt data");for(var o=-1;++o<n;)if(t[o+(16-n)]!==n)throw new Error("unable to decrypt data");if(16!==n)return t.slice(0,16-n)}(this._mode.decrypt(this,t));if(t)throw new Error("data not multiple of block length")},v.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},c.prototype.add=function(t){this.cache=I.concat([this.cache,t])},c.prototype.get=function(t){var n;if(t){if(this.cache.length>16)return n=this.cache.slice(0,16),this.cache=this.cache.slice(16),n}else if(this.cache.length>=16)return n=this.cache.slice(0,16),this.cache=this.cache.slice(16),n;return null},c.prototype.flush=function(){if(this.cache.length)return this.cache},a.createDecipher=function s(t,n){var o=E[t.toLowerCase()];if(!o)throw new TypeError("invalid suite type");var h=g(n,!1,o.key,o.iv);return r(t,h.key,h.iv)},a.createDecipheriv=r},{"./aes":21,"./authCipher":22,"./modes":34,"./streamCipher":37,"cipher-base":71,evp_bytestokey:106,inherits:146,"safe-buffer":250}],25:[function(m,ie,a){var R=m("./modes"),I=m("./authCipher"),E=m("safe-buffer").Buffer,_=m("./streamCipher"),d=m("cipher-base"),u=m("./aes"),g=m("evp_bytestokey");function v(t,n,o){d.call(this),this._cache=new i,this._cipher=new u.AES(n),this._prev=E.from(o),this._mode=t,this._autopadding=!0}m("inherits")(v,d),v.prototype._update=function(t){this._cache.add(t);for(var n,o,h=[];n=this._cache.get();)o=this._mode.encrypt(this,n),h.push(o);return E.concat(h)};var c=E.alloc(16,16);function i(){this.cache=E.allocUnsafe(0)}function r(t,n,o){var h=R[t.toLowerCase()];if(!h)throw new TypeError("invalid suite type");if("string"==typeof n&&(n=E.from(n)),n.length!==h.key/8)throw new TypeError("invalid key length "+n.length);if("string"==typeof o&&(o=E.from(o)),"GCM"!==h.mode&&o.length!==h.iv)throw new TypeError("invalid iv length "+o.length);return"stream"===h.type?new _(h.module,n,o):"auth"===h.type?new I(h.module,n,o):new v(h.module,n,o)}v.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return t=this._mode.encrypt(this,t),this._cipher.scrub(),t;if(!t.equals(c))throw this._cipher.scrub(),new Error("data not multiple of block length")},v.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},i.prototype.add=function(t){this.cache=E.concat([this.cache,t])},i.prototype.get=function(){if(this.cache.length>15){var t=this.cache.slice(0,16);return this.cache=this.cache.slice(16),t}return null},i.prototype.flush=function(){for(var t=16-this.cache.length,n=E.allocUnsafe(t),o=-1;++o<t;)n.writeUInt8(t,o);return E.concat([this.cache,n])},a.createCipheriv=r,a.createCipher=function s(t,n){var o=R[t.toLowerCase()];if(!o)throw new TypeError("invalid suite type");var h=g(n,!1,o.key,o.iv);return r(t,h.key,h.iv)}},{"./aes":21,"./authCipher":22,"./modes":34,"./streamCipher":37,"cipher-base":71,evp_bytestokey:106,inherits:146,"safe-buffer":250}],26:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=R.alloc(16,0);function _(u){var g=R.allocUnsafe(16);return g.writeUInt32BE(u[0]>>>0,0),g.writeUInt32BE(u[1]>>>0,4),g.writeUInt32BE(u[2]>>>0,8),g.writeUInt32BE(u[3]>>>0,12),g}function d(u){this.h=u,this.state=R.alloc(16,0),this.cache=R.allocUnsafe(0)}d.prototype.ghash=function(u){for(var g=-1;++g<u.length;)this.state[g]^=u[g];this._multiply()},d.prototype._multiply=function(){for(var f,c,u=function E(u){return[u.readUInt32BE(0),u.readUInt32BE(4),u.readUInt32BE(8),u.readUInt32BE(12)]}(this.h),g=[0,0,0,0],i=-1;++i<128;){for(0!=(this.state[~~(i/8)]&1<<7-i%8)&&(g[0]^=u[0],g[1]^=u[1],g[2]^=u[2],g[3]^=u[3]),c=0!=(1&u[3]),f=3;f>0;f--)u[f]=u[f]>>>1|(1&u[f-1])<<31;u[0]=u[0]>>>1,c&&(u[0]=u[0]^225<<24)}this.state=_(g)},d.prototype.update=function(u){this.cache=R.concat([this.cache,u]);for(var g;this.cache.length>=16;)g=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(g)},d.prototype.final=function(u,g){return this.cache.length&&this.ghash(R.concat([this.cache,I],16)),this.ghash(_([0,u,0,g])),this.state},ie.exports=d},{"safe-buffer":250}],27:[function(m,ie,a){ie.exports=function R(I){for(var _,E=I.length;E--;){if(255!==(_=I.readUInt8(E))){_++,I.writeUInt8(_,E);break}I.writeUInt8(0,E)}}},{}],28:[function(m,ie,a){var R=m("buffer-xor");a.encrypt=function(I,E){var _=R(E,I._prev);return I._prev=I._cipher.encryptBlock(_),I._prev},a.decrypt=function(I,E){var _=I._prev;I._prev=E;var d=I._cipher.decryptBlock(E);return R(d,_)}},{"buffer-xor":67}],29:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("buffer-xor");function E(_,d,u){var g=d.length,f=I(d,_._cache);return _._cache=_._cache.slice(g),_._prev=R.concat([_._prev,u?d:f]),f}a.encrypt=function(_,d,u){for(var f,g=R.allocUnsafe(0);d.length;){if(0===_._cache.length&&(_._cache=_._cipher.encryptBlock(_._prev),_._prev=R.allocUnsafe(0)),!(_._cache.length<=d.length)){g=R.concat([g,E(_,d,u)]);break}g=R.concat([g,E(_,d.slice(0,f=_._cache.length),u)]),d=d.slice(f)}return g}},{"buffer-xor":67,"safe-buffer":250}],30:[function(m,ie,a){var R=m("safe-buffer").Buffer;function I(_,d,u){for(var i,r,f=-1,c=0;++f<8;)c+=(128&(r=_._cipher.encryptBlock(_._prev)[0]^(i=d&1<<7-f?128:0)))>>f%8,_._prev=E(_._prev,u?i:r);return c}function E(_,d){var u=_.length,g=-1,f=R.allocUnsafe(_.length);for(_=R.concat([_,R.from([d])]);++g<u;)f[g]=_[g]<<1|_[g+1]>>7;return f}a.encrypt=function(_,d,u){for(var g=d.length,f=R.allocUnsafe(g),v=-1;++v<g;)f[v]=I(_,d[v],u);return f}},{"safe-buffer":250}],31:[function(m,ie,a){var R=m("safe-buffer").Buffer;function I(E,_,d){var g=E._cipher.encryptBlock(E._prev)[0]^_;return E._prev=R.concat([E._prev.slice(1),R.from([d?_:g])]),g}a.encrypt=function(E,_,d){for(var u=_.length,g=R.allocUnsafe(u),f=-1;++f<u;)g[f]=I(E,_[f],d);return g}},{"safe-buffer":250}],32:[function(m,ie,a){var R=m("buffer-xor"),I=m("safe-buffer").Buffer,E=m("../incr32");function _(u){var g=u._cipher.encryptBlockRaw(u._prev);return E(u._prev),g}a.encrypt=function(u,g){var f=Math.ceil(g.length/16),v=u._cache.length;u._cache=I.concat([u._cache,I.allocUnsafe(16*f)]);for(var c=0;c<f;c++){var i=_(u),r=v+16*c;u._cache.writeUInt32BE(i[0],r+0),u._cache.writeUInt32BE(i[1],r+4),u._cache.writeUInt32BE(i[2],r+8),u._cache.writeUInt32BE(i[3],r+12)}var s=u._cache.slice(0,g.length);return u._cache=u._cache.slice(g.length),R(g,s)}},{"../incr32":27,"buffer-xor":67,"safe-buffer":250}],33:[function(m,ie,a){a.encrypt=function(R,I){return R._cipher.encryptBlock(I)},a.decrypt=function(R,I){return R._cipher.decryptBlock(I)}},{}],34:[function(m,ie,a){var R={ECB:m("./ecb"),CBC:m("./cbc"),CFB:m("./cfb"),CFB8:m("./cfb8"),CFB1:m("./cfb1"),OFB:m("./ofb"),CTR:m("./ctr"),GCM:m("./ctr")},I=m("./list.json");for(var E in I)I[E].module=R[I[E].mode];ie.exports=I},{"./cbc":28,"./cfb":29,"./cfb1":30,"./cfb8":31,"./ctr":32,"./ecb":33,"./list.json":35,"./ofb":36}],35:[function(m,ie,a){ie.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},{}],36:[function(m,ie,a){(function(R){(function(){var I=m("buffer-xor");function E(_){return _._prev=_._cipher.encryptBlock(_._prev),_._prev}a.encrypt=function(_,d){for(;_._cache.length<d.length;)_._cache=R.concat([_._cache,E(_)]);var u=_._cache.slice(0,d.length);return _._cache=_._cache.slice(d.length),I(d,u)}}).call(this)}).call(this,m("buffer").Buffer)},{buffer:68,"buffer-xor":67}],37:[function(m,ie,a){var R=m("./aes"),I=m("safe-buffer").Buffer,E=m("cipher-base");function d(u,g,f,v){E.call(this),this._cipher=new R.AES(g),this._prev=I.from(f),this._cache=I.allocUnsafe(0),this._secCache=I.allocUnsafe(0),this._decrypt=v,this._mode=u}m("inherits")(d,E),d.prototype._update=function(u){return this._mode.encrypt(this,u,this._decrypt)},d.prototype._final=function(){this._cipher.scrub()},ie.exports=d},{"./aes":21,"cipher-base":71,inherits:146,"safe-buffer":250}],38:[function(m,ie,a){var R=m("browserify-des"),I=m("browserify-aes/browser"),E=m("browserify-aes/modes"),_=m("browserify-des/modes"),d=m("evp_bytestokey");function f(i,r,s){if(i=i.toLowerCase(),E[i])return I.createCipheriv(i,r,s);if(_[i])return new R({key:r,iv:s,mode:i});throw new TypeError("invalid suite type")}function v(i,r,s){if(i=i.toLowerCase(),E[i])return I.createDecipheriv(i,r,s);if(_[i])return new R({key:r,iv:s,mode:i,decrypt:!0});throw new TypeError("invalid suite type")}a.createCipher=a.Cipher=function u(i,r){var s,t;if(i=i.toLowerCase(),E[i])s=E[i].key,t=E[i].iv;else{if(!_[i])throw new TypeError("invalid suite type");s=8*_[i].key,t=_[i].iv}var n=d(r,!1,s,t);return f(i,n.key,n.iv)},a.createCipheriv=a.Cipheriv=f,a.createDecipher=a.Decipher=function g(i,r){var s,t;if(i=i.toLowerCase(),E[i])s=E[i].key,t=E[i].iv;else{if(!_[i])throw new TypeError("invalid suite type");s=8*_[i].key,t=_[i].iv}var n=d(r,!1,s,t);return v(i,n.key,n.iv)},a.createDecipheriv=a.Decipheriv=v,a.listCiphers=a.getCiphers=function c(){return Object.keys(_).concat(I.getCiphers())}},{"browserify-aes/browser":23,"browserify-aes/modes":34,"browserify-des":39,"browserify-des/modes":40,evp_bytestokey:106}],39:[function(m,ie,a){var R=m("cipher-base"),I=m("des.js"),E=m("inherits"),_=m("safe-buffer").Buffer,d={"des-ede3-cbc":I.CBC.instantiate(I.EDE),"des-ede3":I.EDE,"des-ede-cbc":I.CBC.instantiate(I.EDE),"des-ede":I.EDE,"des-cbc":I.CBC.instantiate(I.DES),"des-ecb":I.DES};function u(g){R.call(this);var c,f=g.mode.toLowerCase(),v=d[f];c=g.decrypt?"decrypt":"encrypt";var i=g.key;_.isBuffer(i)||(i=_.from(i)),("des-ede"===f||"des-ede-cbc"===f)&&(i=_.concat([i,i.slice(0,8)]));var r=g.iv;_.isBuffer(r)||(r=_.from(r)),this._des=v.create({key:i,iv:r,type:c})}d.des=d["des-cbc"],d.des3=d["des-ede3-cbc"],ie.exports=u,E(u,R),u.prototype._update=function(g){return _.from(this._des.update(g))},u.prototype._final=function(){return _.from(this._des.final())}},{"cipher-base":71,"des.js":79,inherits:146,"safe-buffer":250}],40:[function(m,ie,a){a["des-ecb"]={key:8,iv:0},a["des-cbc"]=a.des={key:8,iv:8},a["des-ede3-cbc"]=a.des3={key:24,iv:8},a["des-ede3"]={key:24,iv:0},a["des-ede-cbc"]={key:16,iv:8},a["des-ede"]={key:16,iv:0}},{}],41:[function(m,ie,a){(function(R){(function(){var I=m("bn.js"),E=m("randombytes");function d(g){var v,f=g.modulus.byteLength();do{v=new I(E(f))}while(v.cmp(g.modulus)>=0||!v.umod(g.prime1)||!v.umod(g.prime2));return v}function u(g,f){var v=function _(g){var f=d(g);return{blinder:f.toRed(I.mont(g.modulus)).redPow(new I(g.publicExponent)).fromRed(),unblinder:f.invm(g.modulus)}}(f),c=f.modulus.byteLength(),i=new I(g).mul(v.blinder).umod(f.modulus),r=i.toRed(I.mont(f.prime1)),s=i.toRed(I.mont(f.prime2)),t=f.coefficient,n=f.prime1,o=f.prime2,h=r.redPow(f.exponent1).fromRed(),l=s.redPow(f.exponent2).fromRed(),e=h.isub(l).imul(t).umod(n).imul(o);return l.iadd(e).imul(v.unblinder).umod(f.modulus).toArrayLike(R,"be",c)}u.getr=d,ie.exports=u}).call(this)}).call(this,m("buffer").Buffer)},{"bn.js":42,buffer:68,randombytes:244}],42:[function(m,ie,a){!function(R,I){"use strict";function E(j,C){if(!j)throw new Error(C||"Assertion failed")}function _(j,C){j.super_=C;var F=function(){};F.prototype=C.prototype,j.prototype=new F,j.prototype.constructor=j}function d(j,C,F){if(d.isBN(j))return j;this.negative=0,this.words=null,this.length=0,this.red=null,null!==j&&(("le"===C||"be"===C)&&(F=C,C=10),this._init(j||0,C||10,F||"be"))}var u;"object"==typeof R?R.exports=d:I.BN=d,d.BN=d,d.wordSize=26;try{u=typeof window<"u"&&typeof window.Buffer<"u"?window.Buffer:m("buffer").Buffer}catch{}function g(j,C){var F=j.charCodeAt(C);return F>=48&&F<=57?F-48:F>=65&&F<=70?F-55:F>=97&&F<=102?F-87:void E(!1,"Invalid character in "+j)}function f(j,C,F){var V=g(j,F);return F-1>=C&&(V|=g(j,F-1)<<4),V}function v(j,C,F,V){for(var N=0,T=0,S=Math.min(j.length,F),U=C;U<S;U++){var W=j.charCodeAt(U)-48;N*=V,T=W>=49?W-49+10:W>=17?W-17+10:W,E(W>=0&&T<V,"Invalid character"),N+=T}return N}function c(j,C){j.words=C.words,j.length=C.length,j.negative=C.negative,j.red=C.red}if(d.isBN=function(C){return C instanceof d||null!==C&&"object"==typeof C&&C.constructor.wordSize===d.wordSize&&Array.isArray(C.words)},d.max=function(C,F){return C.cmp(F)>0?C:F},d.min=function(C,F){return C.cmp(F)<0?C:F},d.prototype._init=function(C,F,V){if("number"==typeof C)return this._initNumber(C,F,V);if("object"==typeof C)return this._initArray(C,F,V);"hex"===F&&(F=16),E(F===(0|F)&&F>=2&&F<=36);var N=0;"-"===(C=C.toString().replace(/\s+/g,""))[0]&&(N++,this.negative=1),N<C.length&&(16===F?this._parseHex(C,N,V):(this._parseBase(C,F,N),"le"===V&&this._initArray(this.toArray(),F,V)))},d.prototype._initNumber=function(C,F,V){C<0&&(this.negative=1,C=-C),C<67108864?(this.words=[67108863&C],this.length=1):C<4503599627370496?(this.words=[67108863&C,C/67108864&67108863],this.length=2):(E(C<9007199254740992),this.words=[67108863&C,C/67108864&67108863,1],this.length=3),"le"===V&&this._initArray(this.toArray(),F,V)},d.prototype._initArray=function(C,F,V){if(E("number"==typeof C.length),C.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(C.length/3),this.words=new Array(this.length);for(var N=0;N<this.length;N++)this.words[N]=0;var T,S,U=0;if("be"===V)for(N=C.length-1,T=0;N>=0;N-=3)this.words[T]|=(S=C[N]|C[N-1]<<8|C[N-2]<<16)<<U&67108863,this.words[T+1]=S>>>26-U&67108863,(U+=24)>=26&&(U-=26,T++);else if("le"===V)for(N=0,T=0;N<C.length;N+=3)this.words[T]|=(S=C[N]|C[N+1]<<8|C[N+2]<<16)<<U&67108863,this.words[T+1]=S>>>26-U&67108863,(U+=24)>=26&&(U-=26,T++);return this._strip()},d.prototype._parseHex=function(C,F,V){this.length=Math.ceil((C.length-F)/6),this.words=new Array(this.length);for(var N=0;N<this.length;N++)this.words[N]=0;var U,T=0,S=0;if("be"===V)for(N=C.length-1;N>=F;N-=2)U=f(C,F,N)<<T,this.words[S]|=67108863&U,T>=18?(T-=18,this.words[S+=1]|=U>>>26):T+=8;else for(N=(C.length-F)%2==0?F+1:F;N<C.length;N+=2)U=f(C,F,N)<<T,this.words[S]|=67108863&U,T>=18?(T-=18,this.words[S+=1]|=U>>>26):T+=8;this._strip()},d.prototype._parseBase=function(C,F,V){this.words=[0],this.length=1;for(var N=0,T=1;T<=67108863;T*=F)N++;N--,T=T/F|0;for(var S=C.length-V,U=S%N,W=Math.min(S,S-U)+V,k=0,D=V;D<W;D+=N)k=v(C,D,D+N,F),this.imuln(T),this.words[0]+k<67108864?this.words[0]+=k:this._iaddn(k);if(0!==U){var Q=1;for(k=v(C,D,C.length,F),D=0;D<U;D++)Q*=F;this.imuln(Q),this.words[0]+k<67108864?this.words[0]+=k:this._iaddn(k)}this._strip()},d.prototype.copy=function(C){C.words=new Array(this.length);for(var F=0;F<this.length;F++)C.words[F]=this.words[F];C.length=this.length,C.negative=this.negative,C.red=this.red},d.prototype._move=function(C){c(C,this)},d.prototype.clone=function(){var C=new d(null);return this.copy(C),C},d.prototype._expand=function(C){for(;this.length<C;)this.words[this.length++]=0;return this},d.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},d.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},typeof Symbol<"u"&&"function"==typeof Symbol.for)try{d.prototype[Symbol.for("nodejs.util.inspect.custom")]=i}catch{d.prototype.inspect=i}else d.prototype.inspect=i;function i(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var r=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],s=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],t=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(j,C,F){F.negative=C.negative^j.negative;var V=j.length+C.length|0;F.length=V,V=V-1|0;var N=0|j.words[0],T=0|C.words[0],S=N*T,W=S/67108864|0;F.words[0]=67108863&S;for(var k=1;k<V;k++){for(var D=W>>>26,Q=67108863&W,ee=Math.min(k,C.length-1),ae=Math.max(0,k-j.length+1);ae<=ee;ae++)D+=(S=(N=0|j.words[k-ae|0])*(T=0|C.words[ae])+Q)/67108864|0,Q=67108863&S;F.words[k]=0|Q,W=0|D}return 0!==W?F.words[k]=0|W:F.length--,F._strip()}d.prototype.toString=function(C,F){var V;if(F=0|F||1,16===(C=C||10)||"hex"===C){V="";for(var N=0,T=0,S=0;S<this.length;S++){var U=this.words[S],W=(16777215&(U<<N|T)).toString(16);T=U>>>24-N&16777215,(N+=2)>=26&&(N-=26,S--),V=0!==T||S!==this.length-1?r[6-W.length]+W+V:W+V}for(0!==T&&(V=T.toString(16)+V);V.length%F!=0;)V="0"+V;return 0!==this.negative&&(V="-"+V),V}if(C===(0|C)&&C>=2&&C<=36){var k=s[C],D=t[C];V="";var Q=this.clone();for(Q.negative=0;!Q.isZero();){var ee=Q.modrn(D).toString(C);V=(Q=Q.idivn(D)).isZero()?ee+V:r[k-ee.length]+ee+V}for(this.isZero()&&(V="0"+V);V.length%F!=0;)V="0"+V;return 0!==this.negative&&(V="-"+V),V}E(!1,"Base should be between 2 and 36")},d.prototype.toNumber=function(){var C=this.words[0];return 2===this.length?C+=67108864*this.words[1]:3===this.length&&1===this.words[2]?C+=4503599627370496+67108864*this.words[1]:this.length>2&&E(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-C:C},d.prototype.toJSON=function(){return this.toString(16,2)},u&&(d.prototype.toBuffer=function(C,F){return this.toArrayLike(u,C,F)}),d.prototype.toArray=function(C,F){return this.toArrayLike(Array,C,F)},d.prototype.toArrayLike=function(C,F,V){this._strip();var N=this.byteLength(),T=V||Math.max(1,N);E(N<=T,"byte array longer than desired length"),E(T>0,"Requested array length <= 0");var S=function(C,F){return C.allocUnsafe?C.allocUnsafe(F):new C(F)}(C,T);return this["_toArrayLike"+("le"===F?"LE":"BE")](S,N),S},d.prototype._toArrayLikeLE=function(C,F){for(var V=0,N=0,T=0,S=0;T<this.length;T++){var U=this.words[T]<<S|N;C[V++]=255&U,V<C.length&&(C[V++]=U>>8&255),V<C.length&&(C[V++]=U>>16&255),6===S?(V<C.length&&(C[V++]=U>>24&255),N=0,S=0):(N=U>>>24,S+=2)}if(V<C.length)for(C[V++]=N;V<C.length;)C[V++]=0},d.prototype._toArrayLikeBE=function(C,F){for(var V=C.length-1,N=0,T=0,S=0;T<this.length;T++){var U=this.words[T]<<S|N;C[V--]=255&U,V>=0&&(C[V--]=U>>8&255),V>=0&&(C[V--]=U>>16&255),6===S?(V>=0&&(C[V--]=U>>24&255),N=0,S=0):(N=U>>>24,S+=2)}if(V>=0)for(C[V--]=N;V>=0;)C[V--]=0},d.prototype._countBits=Math.clz32?function(C){return 32-Math.clz32(C)}:function(C){var F=C,V=0;return F>=4096&&(V+=13,F>>>=13),F>=64&&(V+=7,F>>>=7),F>=8&&(V+=4,F>>>=4),F>=2&&(V+=2,F>>>=2),V+F},d.prototype._zeroBits=function(C){if(0===C)return 26;var F=C,V=0;return 8191&F||(V+=13,F>>>=13),127&F||(V+=7,F>>>=7),15&F||(V+=4,F>>>=4),3&F||(V+=2,F>>>=2),1&F||V++,V},d.prototype.bitLength=function(){var F=this._countBits(this.words[this.length-1]);return 26*(this.length-1)+F},d.prototype.zeroBits=function(){if(this.isZero())return 0;for(var C=0,F=0;F<this.length;F++){var V=this._zeroBits(this.words[F]);if(C+=V,26!==V)break}return C},d.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},d.prototype.toTwos=function(C){return 0!==this.negative?this.abs().inotn(C).iaddn(1):this.clone()},d.prototype.fromTwos=function(C){return this.testn(C-1)?this.notn(C).iaddn(1).ineg():this.clone()},d.prototype.isNeg=function(){return 0!==this.negative},d.prototype.neg=function(){return this.clone().ineg()},d.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},d.prototype.iuor=function(C){for(;this.length<C.length;)this.words[this.length++]=0;for(var F=0;F<C.length;F++)this.words[F]=this.words[F]|C.words[F];return this._strip()},d.prototype.ior=function(C){return E(0==(this.negative|C.negative)),this.iuor(C)},d.prototype.or=function(C){return this.length>C.length?this.clone().ior(C):C.clone().ior(this)},d.prototype.uor=function(C){return this.length>C.length?this.clone().iuor(C):C.clone().iuor(this)},d.prototype.iuand=function(C){var F;F=this.length>C.length?C:this;for(var V=0;V<F.length;V++)this.words[V]=this.words[V]&C.words[V];return this.length=F.length,this._strip()},d.prototype.iand=function(C){return E(0==(this.negative|C.negative)),this.iuand(C)},d.prototype.and=function(C){return this.length>C.length?this.clone().iand(C):C.clone().iand(this)},d.prototype.uand=function(C){return this.length>C.length?this.clone().iuand(C):C.clone().iuand(this)},d.prototype.iuxor=function(C){var F,V;this.length>C.length?(F=this,V=C):(F=C,V=this);for(var N=0;N<V.length;N++)this.words[N]=F.words[N]^V.words[N];if(this!==F)for(;N<F.length;N++)this.words[N]=F.words[N];return this.length=F.length,this._strip()},d.prototype.ixor=function(C){return E(0==(this.negative|C.negative)),this.iuxor(C)},d.prototype.xor=function(C){return this.length>C.length?this.clone().ixor(C):C.clone().ixor(this)},d.prototype.uxor=function(C){return this.length>C.length?this.clone().iuxor(C):C.clone().iuxor(this)},d.prototype.inotn=function(C){E("number"==typeof C&&C>=0);var F=0|Math.ceil(C/26),V=C%26;this._expand(F),V>0&&F--;for(var N=0;N<F;N++)this.words[N]=67108863&~this.words[N];return V>0&&(this.words[N]=~this.words[N]&67108863>>26-V),this._strip()},d.prototype.notn=function(C){return this.clone().inotn(C)},d.prototype.setn=function(C,F){E("number"==typeof C&&C>=0);var V=C/26|0,N=C%26;return this._expand(V+1),this.words[V]=F?this.words[V]|1<<N:this.words[V]&~(1<<N),this._strip()},d.prototype.iadd=function(C){var F,V,N;if(0!==this.negative&&0===C.negative)return this.negative=0,F=this.isub(C),this.negative^=1,this._normSign();if(0===this.negative&&0!==C.negative)return C.negative=0,F=this.isub(C),C.negative=1,F._normSign();this.length>C.length?(V=this,N=C):(V=C,N=this);for(var T=0,S=0;S<N.length;S++)this.words[S]=67108863&(F=(0|V.words[S])+(0|N.words[S])+T),T=F>>>26;for(;0!==T&&S<V.length;S++)this.words[S]=67108863&(F=(0|V.words[S])+T),T=F>>>26;if(this.length=V.length,0!==T)this.words[this.length]=T,this.length++;else if(V!==this)for(;S<V.length;S++)this.words[S]=V.words[S];return this},d.prototype.add=function(C){var F;return 0!==C.negative&&0===this.negative?(C.negative=0,F=this.sub(C),C.negative^=1,F):0===C.negative&&0!==this.negative?(this.negative=0,F=C.sub(this),this.negative=1,F):this.length>C.length?this.clone().iadd(C):C.clone().iadd(this)},d.prototype.isub=function(C){if(0!==C.negative){C.negative=0;var F=this.iadd(C);return C.negative=1,F._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(C),this.negative=1,this._normSign();var N,T,V=this.cmp(C);if(0===V)return this.negative=0,this.length=1,this.words[0]=0,this;V>0?(N=this,T=C):(N=C,T=this);for(var S=0,U=0;U<T.length;U++)S=(F=(0|N.words[U])-(0|T.words[U])+S)>>26,this.words[U]=67108863&F;for(;0!==S&&U<N.length;U++)S=(F=(0|N.words[U])+S)>>26,this.words[U]=67108863&F;if(0===S&&U<N.length&&N!==this)for(;U<N.length;U++)this.words[U]=N.words[U];return this.length=Math.max(this.length,U),N!==this&&(this.negative=1),this._strip()},d.prototype.sub=function(C){return this.clone().isub(C)};var l=function(C,F,V){var W,k,D,N=C.words,T=F.words,S=V.words,U=0,Q=0|N[0],ee=8191&Q,ae=Q>>>13,ue=0|N[1],be=8191&ue,X=ue>>>13,H=0|N[2],ne=8191&H,ce=H>>>13,te=0|N[3],P=8191&te,A=te>>>13,$=0|N[4],G=8191&$,se=$>>>13,he=0|N[5],pe=8191&he,me=he>>>13,Ee=0|N[6],_e=8191&Ee,Se=Ee>>>13,De=0|N[7],Ae=8191&De,Ne=De>>>13,qe=0|N[8],Be=8191&qe,Ge=qe>>>13,Ue=0|N[9],K=8191&Ue,Y=Ue>>>13,oe=0|T[0],le=8191&oe,ge=oe>>>13,Ie=0|T[1],Ce=8191&Ie,Pe=Ie>>>13,He=0|T[2],Fe=8191&He,je=He>>>13,et=0|T[3],Ve=8191&et,Je=et>>>13,St=0|T[4],tt=8191&St,Qe=St>>>13,Ct=0|T[5],it=8191&Ct,rt=Ct>>>13,yt=0|T[6],nt=8191&yt,st=yt>>>13,Nt=0|T[7],ft=8191&Nt,mt=Nt>>>13,qt=0|T[8],pt=8191&qt,gt=qt>>>13,on=0|T[9],Tt=8191&on,Mt=on>>>13;V.negative=C.negative^F.negative,V.length=19;var zt=(U+(W=Math.imul(ee,le))|0)+((8191&(k=(k=Math.imul(ee,ge))+Math.imul(ae,le)|0))<<13)|0;U=((D=Math.imul(ae,ge))+(k>>>13)|0)+(zt>>>26)|0,zt&=67108863,W=Math.imul(be,le),k=(k=Math.imul(be,ge))+Math.imul(X,le)|0,D=Math.imul(X,ge);var an=(U+(W=W+Math.imul(ee,Ce)|0)|0)+((8191&(k=(k=k+Math.imul(ee,Pe)|0)+Math.imul(ae,Ce)|0))<<13)|0;U=((D=D+Math.imul(ae,Pe)|0)+(k>>>13)|0)+(an>>>26)|0,an&=67108863,W=Math.imul(ne,le),k=(k=Math.imul(ne,ge))+Math.imul(ce,le)|0,D=Math.imul(ce,ge),W=W+Math.imul(be,Ce)|0,k=(k=k+Math.imul(be,Pe)|0)+Math.imul(X,Ce)|0,D=D+Math.imul(X,Pe)|0;var en=(U+(W=W+Math.imul(ee,Fe)|0)|0)+((8191&(k=(k=k+Math.imul(ee,je)|0)+Math.imul(ae,Fe)|0))<<13)|0;U=((D=D+Math.imul(ae,je)|0)+(k>>>13)|0)+(en>>>26)|0,en&=67108863,W=Math.imul(P,le),k=(k=Math.imul(P,ge))+Math.imul(A,le)|0,D=Math.imul(A,ge),W=W+Math.imul(ne,Ce)|0,k=(k=k+Math.imul(ne,Pe)|0)+Math.imul(ce,Ce)|0,D=D+Math.imul(ce,Pe)|0,W=W+Math.imul(be,Fe)|0,k=(k=k+Math.imul(be,je)|0)+Math.imul(X,Fe)|0,D=D+Math.imul(X,je)|0;var cn=(U+(W=W+Math.imul(ee,Ve)|0)|0)+((8191&(k=(k=k+Math.imul(ee,Je)|0)+Math.imul(ae,Ve)|0))<<13)|0;U=((D=D+Math.imul(ae,Je)|0)+(k>>>13)|0)+(cn>>>26)|0,cn&=67108863,W=Math.imul(G,le),k=(k=Math.imul(G,ge))+Math.imul(se,le)|0,D=Math.imul(se,ge),W=W+Math.imul(P,Ce)|0,k=(k=k+Math.imul(P,Pe)|0)+Math.imul(A,Ce)|0,D=D+Math.imul(A,Pe)|0,W=W+Math.imul(ne,Fe)|0,k=(k=k+Math.imul(ne,je)|0)+Math.imul(ce,Fe)|0,D=D+Math.imul(ce,je)|0,W=W+Math.imul(be,Ve)|0,k=(k=k+Math.imul(be,Je)|0)+Math.imul(X,Ve)|0,D=D+Math.imul(X,Je)|0;var tn=(U+(W=W+Math.imul(ee,tt)|0)|0)+((8191&(k=(k=k+Math.imul(ee,Qe)|0)+Math.imul(ae,tt)|0))<<13)|0;U=((D=D+Math.imul(ae,Qe)|0)+(k>>>13)|0)+(tn>>>26)|0,tn&=67108863,W=Math.imul(pe,le),k=(k=Math.imul(pe,ge))+Math.imul(me,le)|0,D=Math.imul(me,ge),W=W+Math.imul(G,Ce)|0,k=(k=k+Math.imul(G,Pe)|0)+Math.imul(se,Ce)|0,D=D+Math.imul(se,Pe)|0,W=W+Math.imul(P,Fe)|0,k=(k=k+Math.imul(P,je)|0)+Math.imul(A,Fe)|0,D=D+Math.imul(A,je)|0,W=W+Math.imul(ne,Ve)|0,k=(k=k+Math.imul(ne,Je)|0)+Math.imul(ce,Ve)|0,D=D+Math.imul(ce,Je)|0,W=W+Math.imul(be,tt)|0,k=(k=k+Math.imul(be,Qe)|0)+Math.imul(X,tt)|0,D=D+Math.imul(X,Qe)|0;var nn=(U+(W=W+Math.imul(ee,it)|0)|0)+((8191&(k=(k=k+Math.imul(ee,rt)|0)+Math.imul(ae,it)|0))<<13)|0;U=((D=D+Math.imul(ae,rt)|0)+(k>>>13)|0)+(nn>>>26)|0,nn&=67108863,W=Math.imul(_e,le),k=(k=Math.imul(_e,ge))+Math.imul(Se,le)|0,D=Math.imul(Se,ge),W=W+Math.imul(pe,Ce)|0,k=(k=k+Math.imul(pe,Pe)|0)+Math.imul(me,Ce)|0,D=D+Math.imul(me,Pe)|0,W=W+Math.imul(G,Fe)|0,k=(k=k+Math.imul(G,je)|0)+Math.imul(se,Fe)|0,D=D+Math.imul(se,je)|0,W=W+Math.imul(P,Ve)|0,k=(k=k+Math.imul(P,Je)|0)+Math.imul(A,Ve)|0,D=D+Math.imul(A,Je)|0,W=W+Math.imul(ne,tt)|0,k=(k=k+Math.imul(ne,Qe)|0)+Math.imul(ce,tt)|0,D=D+Math.imul(ce,Qe)|0,W=W+Math.imul(be,it)|0,k=(k=k+Math.imul(be,rt)|0)+Math.imul(X,it)|0,D=D+Math.imul(X,rt)|0;var Yt=(U+(W=W+Math.imul(ee,nt)|0)|0)+((8191&(k=(k=k+Math.imul(ee,st)|0)+Math.imul(ae,nt)|0))<<13)|0;U=((D=D+Math.imul(ae,st)|0)+(k>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,W=Math.imul(Ae,le),k=(k=Math.imul(Ae,ge))+Math.imul(Ne,le)|0,D=Math.imul(Ne,ge),W=W+Math.imul(_e,Ce)|0,k=(k=k+Math.imul(_e,Pe)|0)+Math.imul(Se,Ce)|0,D=D+Math.imul(Se,Pe)|0,W=W+Math.imul(pe,Fe)|0,k=(k=k+Math.imul(pe,je)|0)+Math.imul(me,Fe)|0,D=D+Math.imul(me,je)|0,W=W+Math.imul(G,Ve)|0,k=(k=k+Math.imul(G,Je)|0)+Math.imul(se,Ve)|0,D=D+Math.imul(se,Je)|0,W=W+Math.imul(P,tt)|0,k=(k=k+Math.imul(P,Qe)|0)+Math.imul(A,tt)|0,D=D+Math.imul(A,Qe)|0,W=W+Math.imul(ne,it)|0,k=(k=k+Math.imul(ne,rt)|0)+Math.imul(ce,it)|0,D=D+Math.imul(ce,rt)|0,W=W+Math.imul(be,nt)|0,k=(k=k+Math.imul(be,st)|0)+Math.imul(X,nt)|0,D=D+Math.imul(X,st)|0;var rn=(U+(W=W+Math.imul(ee,ft)|0)|0)+((8191&(k=(k=k+Math.imul(ee,mt)|0)+Math.imul(ae,ft)|0))<<13)|0;U=((D=D+Math.imul(ae,mt)|0)+(k>>>13)|0)+(rn>>>26)|0,rn&=67108863,W=Math.imul(Be,le),k=(k=Math.imul(Be,ge))+Math.imul(Ge,le)|0,D=Math.imul(Ge,ge),W=W+Math.imul(Ae,Ce)|0,k=(k=k+Math.imul(Ae,Pe)|0)+Math.imul(Ne,Ce)|0,D=D+Math.imul(Ne,Pe)|0,W=W+Math.imul(_e,Fe)|0,k=(k=k+Math.imul(_e,je)|0)+Math.imul(Se,Fe)|0,D=D+Math.imul(Se,je)|0,W=W+Math.imul(pe,Ve)|0,k=(k=k+Math.imul(pe,Je)|0)+Math.imul(me,Ve)|0,D=D+Math.imul(me,Je)|0,W=W+Math.imul(G,tt)|0,k=(k=k+Math.imul(G,Qe)|0)+Math.imul(se,tt)|0,D=D+Math.imul(se,Qe)|0,W=W+Math.imul(P,it)|0,k=(k=k+Math.imul(P,rt)|0)+Math.imul(A,it)|0,D=D+Math.imul(A,rt)|0,W=W+Math.imul(ne,nt)|0,k=(k=k+Math.imul(ne,st)|0)+Math.imul(ce,nt)|0,D=D+Math.imul(ce,st)|0,W=W+Math.imul(be,ft)|0,k=(k=k+Math.imul(be,mt)|0)+Math.imul(X,ft)|0,D=D+Math.imul(X,mt)|0;var Ot=(U+(W=W+Math.imul(ee,pt)|0)|0)+((8191&(k=(k=k+Math.imul(ee,gt)|0)+Math.imul(ae,pt)|0))<<13)|0;U=((D=D+Math.imul(ae,gt)|0)+(k>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,W=Math.imul(K,le),k=(k=Math.imul(K,ge))+Math.imul(Y,le)|0,D=Math.imul(Y,ge),W=W+Math.imul(Be,Ce)|0,k=(k=k+Math.imul(Be,Pe)|0)+Math.imul(Ge,Ce)|0,D=D+Math.imul(Ge,Pe)|0,W=W+Math.imul(Ae,Fe)|0,k=(k=k+Math.imul(Ae,je)|0)+Math.imul(Ne,Fe)|0,D=D+Math.imul(Ne,je)|0,W=W+Math.imul(_e,Ve)|0,k=(k=k+Math.imul(_e,Je)|0)+Math.imul(Se,Ve)|0,D=D+Math.imul(Se,Je)|0,W=W+Math.imul(pe,tt)|0,k=(k=k+Math.imul(pe,Qe)|0)+Math.imul(me,tt)|0,D=D+Math.imul(me,Qe)|0,W=W+Math.imul(G,it)|0,k=(k=k+Math.imul(G,rt)|0)+Math.imul(se,it)|0,D=D+Math.imul(se,rt)|0,W=W+Math.imul(P,nt)|0,k=(k=k+Math.imul(P,st)|0)+Math.imul(A,nt)|0,D=D+Math.imul(A,st)|0,W=W+Math.imul(ne,ft)|0,k=(k=k+Math.imul(ne,mt)|0)+Math.imul(ce,ft)|0,D=D+Math.imul(ce,mt)|0,W=W+Math.imul(be,pt)|0,k=(k=k+Math.imul(be,gt)|0)+Math.imul(X,pt)|0,D=D+Math.imul(X,gt)|0;var Bt=(U+(W=W+Math.imul(ee,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(ee,Mt)|0)+Math.imul(ae,Tt)|0))<<13)|0;U=((D=D+Math.imul(ae,Mt)|0)+(k>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,W=Math.imul(K,Ce),k=(k=Math.imul(K,Pe))+Math.imul(Y,Ce)|0,D=Math.imul(Y,Pe),W=W+Math.imul(Be,Fe)|0,k=(k=k+Math.imul(Be,je)|0)+Math.imul(Ge,Fe)|0,D=D+Math.imul(Ge,je)|0,W=W+Math.imul(Ae,Ve)|0,k=(k=k+Math.imul(Ae,Je)|0)+Math.imul(Ne,Ve)|0,D=D+Math.imul(Ne,Je)|0,W=W+Math.imul(_e,tt)|0,k=(k=k+Math.imul(_e,Qe)|0)+Math.imul(Se,tt)|0,D=D+Math.imul(Se,Qe)|0,W=W+Math.imul(pe,it)|0,k=(k=k+Math.imul(pe,rt)|0)+Math.imul(me,it)|0,D=D+Math.imul(me,rt)|0,W=W+Math.imul(G,nt)|0,k=(k=k+Math.imul(G,st)|0)+Math.imul(se,nt)|0,D=D+Math.imul(se,st)|0,W=W+Math.imul(P,ft)|0,k=(k=k+Math.imul(P,mt)|0)+Math.imul(A,ft)|0,D=D+Math.imul(A,mt)|0,W=W+Math.imul(ne,pt)|0,k=(k=k+Math.imul(ne,gt)|0)+Math.imul(ce,pt)|0,D=D+Math.imul(ce,gt)|0;var Vt=(U+(W=W+Math.imul(be,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(be,Mt)|0)+Math.imul(X,Tt)|0))<<13)|0;U=((D=D+Math.imul(X,Mt)|0)+(k>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,W=Math.imul(K,Fe),k=(k=Math.imul(K,je))+Math.imul(Y,Fe)|0,D=Math.imul(Y,je),W=W+Math.imul(Be,Ve)|0,k=(k=k+Math.imul(Be,Je)|0)+Math.imul(Ge,Ve)|0,D=D+Math.imul(Ge,Je)|0,W=W+Math.imul(Ae,tt)|0,k=(k=k+Math.imul(Ae,Qe)|0)+Math.imul(Ne,tt)|0,D=D+Math.imul(Ne,Qe)|0,W=W+Math.imul(_e,it)|0,k=(k=k+Math.imul(_e,rt)|0)+Math.imul(Se,it)|0,D=D+Math.imul(Se,rt)|0,W=W+Math.imul(pe,nt)|0,k=(k=k+Math.imul(pe,st)|0)+Math.imul(me,nt)|0,D=D+Math.imul(me,st)|0,W=W+Math.imul(G,ft)|0,k=(k=k+Math.imul(G,mt)|0)+Math.imul(se,ft)|0,D=D+Math.imul(se,mt)|0,W=W+Math.imul(P,pt)|0,k=(k=k+Math.imul(P,gt)|0)+Math.imul(A,pt)|0,D=D+Math.imul(A,gt)|0;var ln=(U+(W=W+Math.imul(ne,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(ne,Mt)|0)+Math.imul(ce,Tt)|0))<<13)|0;U=((D=D+Math.imul(ce,Mt)|0)+(k>>>13)|0)+(ln>>>26)|0,ln&=67108863,W=Math.imul(K,Ve),k=(k=Math.imul(K,Je))+Math.imul(Y,Ve)|0,D=Math.imul(Y,Je),W=W+Math.imul(Be,tt)|0,k=(k=k+Math.imul(Be,Qe)|0)+Math.imul(Ge,tt)|0,D=D+Math.imul(Ge,Qe)|0,W=W+Math.imul(Ae,it)|0,k=(k=k+Math.imul(Ae,rt)|0)+Math.imul(Ne,it)|0,D=D+Math.imul(Ne,rt)|0,W=W+Math.imul(_e,nt)|0,k=(k=k+Math.imul(_e,st)|0)+Math.imul(Se,nt)|0,D=D+Math.imul(Se,st)|0,W=W+Math.imul(pe,ft)|0,k=(k=k+Math.imul(pe,mt)|0)+Math.imul(me,ft)|0,D=D+Math.imul(me,mt)|0,W=W+Math.imul(G,pt)|0,k=(k=k+Math.imul(G,gt)|0)+Math.imul(se,pt)|0,D=D+Math.imul(se,gt)|0;var dn=(U+(W=W+Math.imul(P,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(P,Mt)|0)+Math.imul(A,Tt)|0))<<13)|0;U=((D=D+Math.imul(A,Mt)|0)+(k>>>13)|0)+(dn>>>26)|0,dn&=67108863,W=Math.imul(K,tt),k=(k=Math.imul(K,Qe))+Math.imul(Y,tt)|0,D=Math.imul(Y,Qe),W=W+Math.imul(Be,it)|0,k=(k=k+Math.imul(Be,rt)|0)+Math.imul(Ge,it)|0,D=D+Math.imul(Ge,rt)|0,W=W+Math.imul(Ae,nt)|0,k=(k=k+Math.imul(Ae,st)|0)+Math.imul(Ne,nt)|0,D=D+Math.imul(Ne,st)|0,W=W+Math.imul(_e,ft)|0,k=(k=k+Math.imul(_e,mt)|0)+Math.imul(Se,ft)|0,D=D+Math.imul(Se,mt)|0,W=W+Math.imul(pe,pt)|0,k=(k=k+Math.imul(pe,gt)|0)+Math.imul(me,pt)|0,D=D+Math.imul(me,gt)|0;var Jt=(U+(W=W+Math.imul(G,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(G,Mt)|0)+Math.imul(se,Tt)|0))<<13)|0;U=((D=D+Math.imul(se,Mt)|0)+(k>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,W=Math.imul(K,it),k=(k=Math.imul(K,rt))+Math.imul(Y,it)|0,D=Math.imul(Y,rt),W=W+Math.imul(Be,nt)|0,k=(k=k+Math.imul(Be,st)|0)+Math.imul(Ge,nt)|0,D=D+Math.imul(Ge,st)|0,W=W+Math.imul(Ae,ft)|0,k=(k=k+Math.imul(Ae,mt)|0)+Math.imul(Ne,ft)|0,D=D+Math.imul(Ne,mt)|0,W=W+Math.imul(_e,pt)|0,k=(k=k+Math.imul(_e,gt)|0)+Math.imul(Se,pt)|0,D=D+Math.imul(Se,gt)|0;var sn=(U+(W=W+Math.imul(pe,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(pe,Mt)|0)+Math.imul(me,Tt)|0))<<13)|0;U=((D=D+Math.imul(me,Mt)|0)+(k>>>13)|0)+(sn>>>26)|0,sn&=67108863,W=Math.imul(K,nt),k=(k=Math.imul(K,st))+Math.imul(Y,nt)|0,D=Math.imul(Y,st),W=W+Math.imul(Be,ft)|0,k=(k=k+Math.imul(Be,mt)|0)+Math.imul(Ge,ft)|0,D=D+Math.imul(Ge,mt)|0,W=W+Math.imul(Ae,pt)|0,k=(k=k+Math.imul(Ae,gt)|0)+Math.imul(Ne,pt)|0,D=D+Math.imul(Ne,gt)|0;var Wt=(U+(W=W+Math.imul(_e,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(_e,Mt)|0)+Math.imul(Se,Tt)|0))<<13)|0;U=((D=D+Math.imul(Se,Mt)|0)+(k>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,W=Math.imul(K,ft),k=(k=Math.imul(K,mt))+Math.imul(Y,ft)|0,D=Math.imul(Y,mt),W=W+Math.imul(Be,pt)|0,k=(k=k+Math.imul(Be,gt)|0)+Math.imul(Ge,pt)|0,D=D+Math.imul(Ge,gt)|0;var En=(U+(W=W+Math.imul(Ae,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(Ae,Mt)|0)+Math.imul(Ne,Tt)|0))<<13)|0;U=((D=D+Math.imul(Ne,Mt)|0)+(k>>>13)|0)+(En>>>26)|0,En&=67108863,W=Math.imul(K,pt),k=(k=Math.imul(K,gt))+Math.imul(Y,pt)|0,D=Math.imul(Y,gt);var wn=(U+(W=W+Math.imul(Be,Tt)|0)|0)+((8191&(k=(k=k+Math.imul(Be,Mt)|0)+Math.imul(Ge,Tt)|0))<<13)|0;U=((D=D+Math.imul(Ge,Mt)|0)+(k>>>13)|0)+(wn>>>26)|0,wn&=67108863;var Tn=(U+(W=Math.imul(K,Tt))|0)+((8191&(k=(k=Math.imul(K,Mt))+Math.imul(Y,Tt)|0))<<13)|0;return U=((D=Math.imul(Y,Mt))+(k>>>13)|0)+(Tn>>>26)|0,Tn&=67108863,S[0]=zt,S[1]=an,S[2]=en,S[3]=cn,S[4]=tn,S[5]=nn,S[6]=Yt,S[7]=rn,S[8]=Ot,S[9]=Bt,S[10]=Vt,S[11]=ln,S[12]=dn,S[13]=Jt,S[14]=sn,S[15]=Wt,S[16]=En,S[17]=wn,S[18]=Tn,0!==U&&(S[19]=U,V.length++),V};function e(j,C,F){F.negative=C.negative^j.negative,F.length=j.length+C.length;for(var V=0,N=0,T=0;T<F.length-1;T++){var S=N;N=0;for(var U=67108863&V,W=Math.min(T,C.length-1),k=Math.max(0,T-j.length+1);k<=W;k++){var ae=(0|j.words[T-k])*(0|C.words[k]),ue=67108863&ae;U=67108863&(ue=ue+U|0),N+=(S=(S=S+(ae/67108864|0)|0)+(ue>>>26)|0)>>>26,S&=67108863}F.words[T]=U,V=S,S=N}return 0!==V?F.words[T]=V:F.length--,F._strip()}function p(j,C,F){return e(j,C,F)}function b(j,C){this.x=j,this.y=C}Math.imul||(l=h),d.prototype.mulTo=function(C,F){var N=this.length+C.length;return 10===this.length&&10===C.length?l(this,C,F):N<63?h(this,C,F):N<1024?e(this,C,F):p(this,C,F)},b.prototype.makeRBT=function(C){for(var F=new Array(C),V=d.prototype._countBits(C)-1,N=0;N<C;N++)F[N]=this.revBin(N,V,C);return F},b.prototype.revBin=function(C,F,V){if(0===C||C===V-1)return C;for(var N=0,T=0;T<F;T++)N|=(1&C)<<F-T-1,C>>=1;return N},b.prototype.permute=function(C,F,V,N,T,S){for(var U=0;U<S;U++)N[U]=F[C[U]],T[U]=V[C[U]]},b.prototype.transform=function(C,F,V,N,T,S){this.permute(S,C,F,V,N,T);for(var U=1;U<T;U<<=1)for(var W=U<<1,k=Math.cos(2*Math.PI/W),D=Math.sin(2*Math.PI/W),Q=0;Q<T;Q+=W)for(var ee=k,ae=D,ue=0;ue<U;ue++){var be=V[Q+ue],X=N[Q+ue],H=V[Q+ue+U],ne=N[Q+ue+U],ce=ee*H-ae*ne;ne=ee*ne+ae*H,V[Q+ue]=be+(H=ce),N[Q+ue]=X+ne,V[Q+ue+U]=be-H,N[Q+ue+U]=X-ne,ue!==W&&(ce=k*ee-D*ae,ae=k*ae+D*ee,ee=ce)}},b.prototype.guessLen13b=function(C,F){var V=1|Math.max(F,C),N=1&V,T=0;for(V=V/2|0;V;V>>>=1)T++;return 1<<T+1+N},b.prototype.conjugate=function(C,F,V){if(!(V<=1))for(var N=0;N<V/2;N++){var T=C[N];C[N]=C[V-N-1],C[V-N-1]=T,T=F[N],F[N]=-F[V-N-1],F[V-N-1]=-T}},b.prototype.normalize13b=function(C,F){for(var V=0,N=0;N<F/2;N++){var T=8192*Math.round(C[2*N+1]/F)+Math.round(C[2*N]/F)+V;C[N]=67108863&T,V=T<67108864?0:T/67108864|0}return C},b.prototype.convert13b=function(C,F,V,N){for(var T=0,S=0;S<F;S++)V[2*S]=8191&(T+=0|C[S]),V[2*S+1]=8191&(T>>>=13),T>>>=13;for(S=2*F;S<N;++S)V[S]=0;E(0===T),E(0==(-8192&T))},b.prototype.stub=function(C){for(var F=new Array(C),V=0;V<C;V++)F[V]=0;return F},b.prototype.mulp=function(C,F,V){var N=2*this.guessLen13b(C.length,F.length),T=this.makeRBT(N),S=this.stub(N),U=new Array(N),W=new Array(N),k=new Array(N),D=new Array(N),Q=new Array(N),ee=new Array(N),ae=V.words;ae.length=N,this.convert13b(C.words,C.length,U,N),this.convert13b(F.words,F.length,D,N),this.transform(U,S,W,k,N,T),this.transform(D,S,Q,ee,N,T);for(var ue=0;ue<N;ue++){var be=W[ue]*Q[ue]-k[ue]*ee[ue];k[ue]=W[ue]*ee[ue]+k[ue]*Q[ue],W[ue]=be}return this.conjugate(W,k,N),this.transform(W,k,ae,S,N,T),this.conjugate(ae,S,N),this.normalize13b(ae,N),V.negative=C.negative^F.negative,V.length=C.length+F.length,V._strip()},d.prototype.mul=function(C){var F=new d(null);return F.words=new Array(this.length+C.length),this.mulTo(C,F)},d.prototype.mulf=function(C){var F=new d(null);return F.words=new Array(this.length+C.length),p(this,C,F)},d.prototype.imul=function(C){return this.clone().mulTo(C,this)},d.prototype.imuln=function(C){var F=C<0;F&&(C=-C),E("number"==typeof C),E(C<67108864);for(var V=0,N=0;N<this.length;N++){var T=(0|this.words[N])*C,S=(67108863&T)+(67108863&V);V>>=26,V+=T/67108864|0,V+=S>>>26,this.words[N]=67108863&S}return 0!==V&&(this.words[N]=V,this.length++),F?this.ineg():this},d.prototype.muln=function(C){return this.clone().imuln(C)},d.prototype.sqr=function(){return this.mul(this)},d.prototype.isqr=function(){return this.imul(this.clone())},d.prototype.pow=function(C){var F=function o(j){for(var C=new Array(j.bitLength()),F=0;F<C.length;F++)C[F]=j.words[F/26|0]>>>F%26&1;return C}(C);if(0===F.length)return new d(1);for(var V=this,N=0;N<F.length&&0===F[N];N++,V=V.sqr());if(++N<F.length)for(var T=V.sqr();N<F.length;N++,T=T.sqr())0!==F[N]&&(V=V.mul(T));return V},d.prototype.iushln=function(C){E("number"==typeof C&&C>=0);var T,F=C%26,V=(C-F)/26,N=67108863>>>26-F<<26-F;if(0!==F){var S=0;for(T=0;T<this.length;T++){var U=this.words[T]&N;this.words[T]=(0|this.words[T])-U<<F|S,S=U>>>26-F}S&&(this.words[T]=S,this.length++)}if(0!==V){for(T=this.length-1;T>=0;T--)this.words[T+V]=this.words[T];for(T=0;T<V;T++)this.words[T]=0;this.length+=V}return this._strip()},d.prototype.ishln=function(C){return E(0===this.negative),this.iushln(C)},d.prototype.iushrn=function(C,F,V){var N;E("number"==typeof C&&C>=0),N=F?(F-F%26)/26:0;var T=C%26,S=Math.min((C-T)/26,this.length),U=67108863^67108863>>>T<<T,W=V;if(N-=S,N=Math.max(0,N),W){for(var k=0;k<S;k++)W.words[k]=this.words[k];W.length=S}if(0!==S)if(this.length>S)for(this.length-=S,k=0;k<this.length;k++)this.words[k]=this.words[k+S];else this.words[0]=0,this.length=1;var D=0;for(k=this.length-1;k>=0&&(0!==D||k>=N);k--){var Q=0|this.words[k];this.words[k]=D<<26-T|Q>>>T,D=Q&U}return W&&0!==D&&(W.words[W.length++]=D),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},d.prototype.ishrn=function(C,F,V){return E(0===this.negative),this.iushrn(C,F,V)},d.prototype.shln=function(C){return this.clone().ishln(C)},d.prototype.ushln=function(C){return this.clone().iushln(C)},d.prototype.shrn=function(C){return this.clone().ishrn(C)},d.prototype.ushrn=function(C){return this.clone().iushrn(C)},d.prototype.testn=function(C){E("number"==typeof C&&C>=0);var F=C%26,V=(C-F)/26;return!(this.length<=V||!(this.words[V]&1<<F))},d.prototype.imaskn=function(C){E("number"==typeof C&&C>=0);var F=C%26,V=(C-F)/26;return E(0===this.negative,"imaskn works only with positive numbers"),this.length<=V?this:(0!==F&&V++,this.length=Math.min(V,this.length),0!==F&&(this.words[this.length-1]&=67108863^67108863>>>F<<F),this._strip())},d.prototype.maskn=function(C){return this.clone().imaskn(C)},d.prototype.iaddn=function(C){return E("number"==typeof C),E(C<67108864),C<0?this.isubn(-C):0!==this.negative?1===this.length&&(0|this.words[0])<=C?(this.words[0]=C-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(C),this.negative=1,this):this._iaddn(C)},d.prototype._iaddn=function(C){this.words[0]+=C;for(var F=0;F<this.length&&this.words[F]>=67108864;F++)this.words[F]-=67108864,F===this.length-1?this.words[F+1]=1:this.words[F+1]++;return this.length=Math.max(this.length,F+1),this},d.prototype.isubn=function(C){if(E("number"==typeof C),E(C<67108864),C<0)return this.iaddn(-C);if(0!==this.negative)return this.negative=0,this.iaddn(C),this.negative=1,this;if(this.words[0]-=C,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var F=0;F<this.length&&this.words[F]<0;F++)this.words[F]+=67108864,this.words[F+1]-=1;return this._strip()},d.prototype.addn=function(C){return this.clone().iaddn(C)},d.prototype.subn=function(C){return this.clone().isubn(C)},d.prototype.iabs=function(){return this.negative=0,this},d.prototype.abs=function(){return this.clone().iabs()},d.prototype._ishlnsubmul=function(C,F,V){var T;this._expand(C.length+V);var S,U=0;for(T=0;T<C.length;T++){S=(0|this.words[T+V])+U;var W=(0|C.words[T])*F;U=((S-=67108863&W)>>26)-(W/67108864|0),this.words[T+V]=67108863&S}for(;T<this.length-V;T++)U=(S=(0|this.words[T+V])+U)>>26,this.words[T+V]=67108863&S;if(0===U)return this._strip();for(E(-1===U),U=0,T=0;T<this.length;T++)U=(S=-(0|this.words[T])+U)>>26,this.words[T]=67108863&S;return this.negative=1,this._strip()},d.prototype._wordDiv=function(C,F){var V,N=this.clone(),T=C,S=0|T.words[T.length-1];0!=(V=26-this._countBits(S))&&(T=T.ushln(V),N.iushln(V),S=0|T.words[T.length-1]);var k,W=N.length-T.length;if("mod"!==F){(k=new d(null)).length=W+1,k.words=new Array(k.length);for(var D=0;D<k.length;D++)k.words[D]=0}var Q=N.clone()._ishlnsubmul(T,1,W);0===Q.negative&&(N=Q,k&&(k.words[W]=1));for(var ee=W-1;ee>=0;ee--){var ae=67108864*(0|N.words[T.length+ee])+(0|N.words[T.length+ee-1]);for(ae=Math.min(ae/S|0,67108863),N._ishlnsubmul(T,ae,ee);0!==N.negative;)ae--,N.negative=0,N._ishlnsubmul(T,1,ee),N.isZero()||(N.negative^=1);k&&(k.words[ee]=ae)}return k&&k._strip(),N._strip(),"div"!==F&&0!==V&&N.iushrn(V),{div:k||null,mod:N}},d.prototype.divmod=function(C,F,V){return E(!C.isZero()),this.isZero()?{div:new d(0),mod:new d(0)}:0!==this.negative&&0===C.negative?(S=this.neg().divmod(C,F),"mod"!==F&&(N=S.div.neg()),"div"!==F&&(T=S.mod.neg(),V&&0!==T.negative&&T.iadd(C)),{div:N,mod:T}):0===this.negative&&0!==C.negative?(S=this.divmod(C.neg(),F),"mod"!==F&&(N=S.div.neg()),{div:N,mod:S.mod}):this.negative&C.negative?(S=this.neg().divmod(C.neg(),F),"div"!==F&&(T=S.mod.neg(),V&&0!==T.negative&&T.isub(C)),{div:S.div,mod:T}):C.length>this.length||this.cmp(C)<0?{div:new d(0),mod:this}:1===C.length?"div"===F?{div:this.divn(C.words[0]),mod:null}:"mod"===F?{div:null,mod:new d(this.modrn(C.words[0]))}:{div:this.divn(C.words[0]),mod:new d(this.modrn(C.words[0]))}:this._wordDiv(C,F);var N,T,S},d.prototype.div=function(C){return this.divmod(C,"div",!1).div},d.prototype.mod=function(C){return this.divmod(C,"mod",!1).mod},d.prototype.umod=function(C){return this.divmod(C,"mod",!0).mod},d.prototype.divRound=function(C){var F=this.divmod(C);if(F.mod.isZero())return F.div;var V=0!==F.div.negative?F.mod.isub(C):F.mod,N=C.ushrn(1),T=C.andln(1),S=V.cmp(N);return S<0||1===T&&0===S?F.div:0!==F.div.negative?F.div.isubn(1):F.div.iaddn(1)},d.prototype.modrn=function(C){var F=C<0;F&&(C=-C),E(C<=67108863);for(var V=(1<<26)%C,N=0,T=this.length-1;T>=0;T--)N=(V*N+(0|this.words[T]))%C;return F?-N:N},d.prototype.modn=function(C){return this.modrn(C)},d.prototype.idivn=function(C){var F=C<0;F&&(C=-C),E(C<=67108863);for(var V=0,N=this.length-1;N>=0;N--){var T=(0|this.words[N])+67108864*V;this.words[N]=T/C|0,V=T%C}return this._strip(),F?this.ineg():this},d.prototype.divn=function(C){return this.clone().idivn(C)},d.prototype.egcd=function(C){E(0===C.negative),E(!C.isZero());var F=this,V=C.clone();F=0!==F.negative?F.umod(C):F.clone();for(var N=new d(1),T=new d(0),S=new d(0),U=new d(1),W=0;F.isEven()&&V.isEven();)F.iushrn(1),V.iushrn(1),++W;for(var k=V.clone(),D=F.clone();!F.isZero();){for(var Q=0,ee=1;!(F.words[0]&ee)&&Q<26;++Q,ee<<=1);if(Q>0)for(F.iushrn(Q);Q-- >0;)(N.isOdd()||T.isOdd())&&(N.iadd(k),T.isub(D)),N.iushrn(1),T.iushrn(1);for(var ae=0,ue=1;!(V.words[0]&ue)&&ae<26;++ae,ue<<=1);if(ae>0)for(V.iushrn(ae);ae-- >0;)(S.isOdd()||U.isOdd())&&(S.iadd(k),U.isub(D)),S.iushrn(1),U.iushrn(1);F.cmp(V)>=0?(F.isub(V),N.isub(S),T.isub(U)):(V.isub(F),S.isub(N),U.isub(T))}return{a:S,b:U,gcd:V.iushln(W)}},d.prototype._invmp=function(C){E(0===C.negative),E(!C.isZero());var Q,F=this,V=C.clone();F=0!==F.negative?F.umod(C):F.clone();for(var N=new d(1),T=new d(0),S=V.clone();F.cmpn(1)>0&&V.cmpn(1)>0;){for(var U=0,W=1;!(F.words[0]&W)&&U<26;++U,W<<=1);if(U>0)for(F.iushrn(U);U-- >0;)N.isOdd()&&N.iadd(S),N.iushrn(1);for(var k=0,D=1;!(V.words[0]&D)&&k<26;++k,D<<=1);if(k>0)for(V.iushrn(k);k-- >0;)T.isOdd()&&T.iadd(S),T.iushrn(1);F.cmp(V)>=0?(F.isub(V),N.isub(T)):(V.isub(F),T.isub(N))}return(Q=0===F.cmpn(1)?N:T).cmpn(0)<0&&Q.iadd(C),Q},d.prototype.gcd=function(C){if(this.isZero())return C.abs();if(C.isZero())return this.abs();var F=this.clone(),V=C.clone();F.negative=0,V.negative=0;for(var N=0;F.isEven()&&V.isEven();N++)F.iushrn(1),V.iushrn(1);for(;;){for(;F.isEven();)F.iushrn(1);for(;V.isEven();)V.iushrn(1);var T=F.cmp(V);if(T<0){var S=F;F=V,V=S}else if(0===T||0===V.cmpn(1))break;F.isub(V)}return V.iushln(N)},d.prototype.invm=function(C){return this.egcd(C).a.umod(C)},d.prototype.isEven=function(){return 0==(1&this.words[0])},d.prototype.isOdd=function(){return 1==(1&this.words[0])},d.prototype.andln=function(C){return this.words[0]&C},d.prototype.bincn=function(C){E("number"==typeof C);var F=C%26,V=(C-F)/26,N=1<<F;if(this.length<=V)return this._expand(V+1),this.words[V]|=N,this;for(var T=N,S=V;0!==T&&S<this.length;S++){var U=0|this.words[S];T=(U+=T)>>>26,this.words[S]=U&=67108863}return 0!==T&&(this.words[S]=T,this.length++),this},d.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},d.prototype.cmpn=function(C){var V,F=C<0;if(0!==this.negative&&!F)return-1;if(0===this.negative&&F)return 1;if(this._strip(),this.length>1)V=1;else{F&&(C=-C),E(C<=67108863,"Number is too big");var N=0|this.words[0];V=N===C?0:N<C?-1:1}return 0!==this.negative?0|-V:V},d.prototype.cmp=function(C){if(0!==this.negative&&0===C.negative)return-1;if(0===this.negative&&0!==C.negative)return 1;var F=this.ucmp(C);return 0!==this.negative?0|-F:F},d.prototype.ucmp=function(C){if(this.length>C.length)return 1;if(this.length<C.length)return-1;for(var F=0,V=this.length-1;V>=0;V--){var N=0|this.words[V],T=0|C.words[V];if(N!==T){N<T?F=-1:N>T&&(F=1);break}}return F},d.prototype.gtn=function(C){return 1===this.cmpn(C)},d.prototype.gt=function(C){return 1===this.cmp(C)},d.prototype.gten=function(C){return this.cmpn(C)>=0},d.prototype.gte=function(C){return this.cmp(C)>=0},d.prototype.ltn=function(C){return-1===this.cmpn(C)},d.prototype.lt=function(C){return-1===this.cmp(C)},d.prototype.lten=function(C){return this.cmpn(C)<=0},d.prototype.lte=function(C){return this.cmp(C)<=0},d.prototype.eqn=function(C){return 0===this.cmpn(C)},d.prototype.eq=function(C){return 0===this.cmp(C)},d.red=function(C){return new M(C)},d.prototype.toRed=function(C){return E(!this.red,"Already a number in reduction context"),E(0===this.negative,"red works only with positives"),C.convertTo(this)._forceRed(C)},d.prototype.fromRed=function(){return E(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},d.prototype._forceRed=function(C){return this.red=C,this},d.prototype.forceRed=function(C){return E(!this.red,"Already a number in reduction context"),this._forceRed(C)},d.prototype.redAdd=function(C){return E(this.red,"redAdd works only with red numbers"),this.red.add(this,C)},d.prototype.redIAdd=function(C){return E(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,C)},d.prototype.redSub=function(C){return E(this.red,"redSub works only with red numbers"),this.red.sub(this,C)},d.prototype.redISub=function(C){return E(this.red,"redISub works only with red numbers"),this.red.isub(this,C)},d.prototype.redShl=function(C){return E(this.red,"redShl works only with red numbers"),this.red.shl(this,C)},d.prototype.redMul=function(C){return E(this.red,"redMul works only with red numbers"),this.red._verify2(this,C),this.red.mul(this,C)},d.prototype.redIMul=function(C){return E(this.red,"redMul works only with red numbers"),this.red._verify2(this,C),this.red.imul(this,C)},d.prototype.redSqr=function(){return E(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},d.prototype.redISqr=function(){return E(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},d.prototype.redSqrt=function(){return E(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},d.prototype.redInvm=function(){return E(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},d.prototype.redNeg=function(){return E(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},d.prototype.redPow=function(C){return E(this.red&&!C.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,C)};var y={k256:null,p224:null,p192:null,p25519:null};function w(j,C){this.name=j,this.p=new d(C,16),this.n=this.p.bitLength(),this.k=new d(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function x(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function B(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function J(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function z(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function M(j){if("string"==typeof j){var C=d._prime(j);this.m=C.p,this.prime=C}else E(j.gtn(1),"modulus must be greater than 1"),this.m=j,this.prime=null}function L(j){M.call(this,j),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new d(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}w.prototype._tmp=function(){var C=new d(null);return C.words=new Array(Math.ceil(this.n/13)),C},w.prototype.ireduce=function(C){var V,F=C;do{this.split(F,this.tmp),V=(F=(F=this.imulK(F)).iadd(this.tmp)).bitLength()}while(V>this.n);var N=V<this.n?-1:F.ucmp(this.p);return 0===N?(F.words[0]=0,F.length=1):N>0?F.isub(this.p):void 0!==F.strip?F.strip():F._strip(),F},w.prototype.split=function(C,F){C.iushrn(this.n,0,F)},w.prototype.imulK=function(C){return C.imul(this.k)},_(x,w),x.prototype.split=function(C,F){for(var V=4194303,N=Math.min(C.length,9),T=0;T<N;T++)F.words[T]=C.words[T];if(F.length=N,C.length<=9)return C.words[0]=0,void(C.length=1);var S=C.words[9];for(F.words[F.length++]=S&V,T=10;T<C.length;T++){var U=0|C.words[T];C.words[T-10]=(U&V)<<4|S>>>22,S=U}C.words[T-10]=S>>>=22,C.length-=0===S&&C.length>10?10:9},x.prototype.imulK=function(C){C.words[C.length]=0,C.words[C.length+1]=0,C.length+=2;for(var F=0,V=0;V<C.length;V++){var N=0|C.words[V];C.words[V]=67108863&(F+=977*N),F=64*N+(F/67108864|0)}return 0===C.words[C.length-1]&&(C.length--,0===C.words[C.length-1]&&C.length--),C},_(B,w),_(J,w),_(z,w),z.prototype.imulK=function(C){for(var F=0,V=0;V<C.length;V++){var N=19*(0|C.words[V])+F,T=67108863&N;N>>>=26,C.words[V]=T,F=N}return 0!==F&&(C.words[C.length++]=F),C},d._prime=function(C){if(y[C])return y[C];var F;if("k256"===C)F=new x;else if("p224"===C)F=new B;else if("p192"===C)F=new J;else{if("p25519"!==C)throw new Error("Unknown prime "+C);F=new z}return y[C]=F,F},M.prototype._verify1=function(C){E(0===C.negative,"red works only with positives"),E(C.red,"red works only with red numbers")},M.prototype._verify2=function(C,F){E(0==(C.negative|F.negative),"red works only with positives"),E(C.red&&C.red===F.red,"red works only with red numbers")},M.prototype.imod=function(C){return this.prime?this.prime.ireduce(C)._forceRed(this):(c(C,C.umod(this.m)._forceRed(this)),C)},M.prototype.neg=function(C){return C.isZero()?C.clone():this.m.sub(C)._forceRed(this)},M.prototype.add=function(C,F){this._verify2(C,F);var V=C.add(F);return V.cmp(this.m)>=0&&V.isub(this.m),V._forceRed(this)},M.prototype.iadd=function(C,F){this._verify2(C,F);var V=C.iadd(F);return V.cmp(this.m)>=0&&V.isub(this.m),V},M.prototype.sub=function(C,F){this._verify2(C,F);var V=C.sub(F);return V.cmpn(0)<0&&V.iadd(this.m),V._forceRed(this)},M.prototype.isub=function(C,F){this._verify2(C,F);var V=C.isub(F);return V.cmpn(0)<0&&V.iadd(this.m),V},M.prototype.shl=function(C,F){return this._verify1(C),this.imod(C.ushln(F))},M.prototype.imul=function(C,F){return this._verify2(C,F),this.imod(C.imul(F))},M.prototype.mul=function(C,F){return this._verify2(C,F),this.imod(C.mul(F))},M.prototype.isqr=function(C){return this.imul(C,C.clone())},M.prototype.sqr=function(C){return this.mul(C,C)},M.prototype.sqrt=function(C){if(C.isZero())return C.clone();var F=this.m.andln(3);if(E(F%2==1),3===F){var V=this.m.add(new d(1)).iushrn(2);return this.pow(C,V)}for(var N=this.m.subn(1),T=0;!N.isZero()&&0===N.andln(1);)T++,N.iushrn(1);E(!N.isZero());var S=new d(1).toRed(this),U=S.redNeg(),W=this.m.subn(1).iushrn(1),k=this.m.bitLength();for(k=new d(2*k*k).toRed(this);0!==this.pow(k,W).cmp(U);)k.redIAdd(U);for(var D=this.pow(k,N),Q=this.pow(C,N.addn(1).iushrn(1)),ee=this.pow(C,N),ae=T;0!==ee.cmp(S);){for(var ue=ee,be=0;0!==ue.cmp(S);be++)ue=ue.redSqr();E(be<ae);var X=this.pow(D,new d(1).iushln(ae-be-1));Q=Q.redMul(X),D=X.redSqr(),ee=ee.redMul(D),ae=be}return Q},M.prototype.invm=function(C){var F=C._invmp(this.m);return 0!==F.negative?(F.negative=0,this.imod(F).redNeg()):this.imod(F)},M.prototype.pow=function(C,F){if(F.isZero())return new d(1).toRed(this);if(0===F.cmpn(1))return C.clone();var N=new Array(16);N[0]=new d(1).toRed(this),N[1]=C;for(var T=2;T<N.length;T++)N[T]=this.mul(N[T-1],C);var S=N[0],U=0,W=0,k=F.bitLength()%26;for(0===k&&(k=26),T=F.length-1;T>=0;T--){for(var D=F.words[T],Q=k-1;Q>=0;Q--){var ee=D>>Q&1;S!==N[0]&&(S=this.sqr(S)),0!==ee||0!==U?(U<<=1,U|=ee,(4==++W||0===T&&0===Q)&&(S=this.mul(S,N[U]),W=0,U=0)):W=0}k=26}return S},M.prototype.convertTo=function(C){var F=C.umod(this.m);return F===C?F.clone():F},M.prototype.convertFrom=function(C){var F=C.clone();return F.red=null,F},d.mont=function(C){return new L(C)},_(L,M),L.prototype.convertTo=function(C){return this.imod(C.ushln(this.shift))},L.prototype.convertFrom=function(C){var F=this.imod(C.mul(this.rinv));return F.red=null,F},L.prototype.imul=function(C,F){if(C.isZero()||F.isZero())return C.words[0]=0,C.length=1,C;var V=C.imul(F),N=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=V.isub(N).iushrn(this.shift),S=T;return T.cmp(this.m)>=0?S=T.isub(this.m):T.cmpn(0)<0&&(S=T.iadd(this.m)),S._forceRed(this)},L.prototype.mul=function(C,F){if(C.isZero()||F.isZero())return new d(0)._forceRed(this);var V=C.mul(F),N=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=V.isub(N).iushrn(this.shift),S=T;return T.cmp(this.m)>=0?S=T.isub(this.m):T.cmpn(0)<0&&(S=T.iadd(this.m)),S._forceRed(this)},L.prototype.invm=function(C){return this.imod(C._invmp(this.m).mul(this.r2))._forceRed(this)}}(typeof ie>"u"||ie,this)},{buffer:20}],43:[function(m,ie,a){ie.exports=m("./browser/algorithms.json")},{"./browser/algorithms.json":44}],44:[function(m,ie,a){ie.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},{}],45:[function(m,ie,a){ie.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},{}],46:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("create-hash"),E=m("readable-stream"),_=m("inherits"),d=m("./sign"),u=m("./verify"),g=m("./algorithms.json");function f(r){E.Writable.call(this);var s=g[r];if(!s)throw new Error("Unknown message digest");this._hashType=s.hash,this._hash=I(s.hash),this._tag=s.id,this._signType=s.sign}function v(r){E.Writable.call(this);var s=g[r];if(!s)throw new Error("Unknown message digest");this._hash=I(s.hash),this._tag=s.id,this._signType=s.sign}function c(r){return new f(r)}function i(r){return new v(r)}Object.keys(g).forEach(function(r){g[r].id=R.from(g[r].id,"hex"),g[r.toLowerCase()]=g[r]}),_(f,E.Writable),f.prototype._write=function(s,t,n){this._hash.update(s),n()},f.prototype.update=function(s,t){return"string"==typeof s&&(s=R.from(s,t)),this._hash.update(s),this},f.prototype.sign=function(s,t){this.end();var n=this._hash.digest(),o=d(n,s,this._hashType,this._signType,this._tag);return t?o.toString(t):o},_(v,E.Writable),v.prototype._write=function(s,t,n){this._hash.update(s),n()},v.prototype.update=function(s,t){return"string"==typeof s&&(s=R.from(s,t)),this._hash.update(s),this},v.prototype.verify=function(s,t,n){"string"==typeof t&&(t=R.from(t,n)),this.end();var o=this._hash.digest();return u(t,o,s,this._signType,this._tag)},ie.exports={Sign:c,Verify:i,createSign:c,createVerify:i}},{"./algorithms.json":44,"./sign":47,"./verify":48,"create-hash":74,inherits:146,"readable-stream":64,"safe-buffer":250}],47:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("create-hmac"),E=m("browserify-rsa"),_=m("elliptic").ec,d=m("bn.js"),u=m("parse-asn1"),g=m("./curves.json");function r(h,l,e,p){if((h=R.from(h.toArray())).length<l.byteLength()){var b=R.alloc(l.byteLength()-h.length);h=R.concat([b,h])}var y=e.length,w=function t(h,l){h=(h=s(h,l)).mod(l);var e=R.from(h.toArray());if(e.length<l.byteLength()){var p=R.alloc(l.byteLength()-e.length);e=R.concat([p,e])}return e}(e,l),x=R.alloc(y);x.fill(1);var B=R.alloc(y);return B=I(p,B).update(x).update(R.from([0])).update(h).update(w).digest(),x=I(p,B).update(x).digest(),{k:B=I(p,B).update(x).update(R.from([1])).update(h).update(w).digest(),v:x=I(p,B).update(x).digest()}}function s(h,l){var e=new d(h),p=(h.length<<3)-l.bitLength();return p>0&&e.ishrn(p),e}function n(h,l,e){var p,b;do{for(p=R.alloc(0);8*p.length<h.bitLength();)l.v=I(e,l.k).update(l.v).digest(),p=R.concat([p,l.v]);b=s(p,h),l.k=I(e,l.k).update(l.v).update(R.from([0])).digest(),l.v=I(e,l.k).update(l.v).digest()}while(-1!==b.cmp(h));return b}function o(h,l,e,p){return h.toRed(d.mont(e)).redPow(l).fromRed().mod(p)}ie.exports=function f(h,l,e,p,b){var y=u(l);if(y.curve){if("ecdsa"!==p&&"ecdsa/rsa"!==p)throw new Error("wrong private key type");return function v(h,l){var e=g[l.curve.join(".")];if(!e)throw new Error("unknown curve "+l.curve.join("."));var y=new _(e).keyFromPrivate(l.privateKey).sign(h);return R.from(y.toDER())}(h,y)}if("dsa"===y.type){if("dsa"!==p)throw new Error("wrong private key type");return function c(h,l,e){for(var B,p=l.params.priv_key,b=l.params.p,y=l.params.q,w=l.params.g,x=new d(0),J=s(h,y).mod(y),z=!1,M=r(p,y,h,e);!1===z;)x=o(w,B=n(y,M,e),b,y),0===(z=B.invm(y).imul(J.add(p.mul(x))).mod(y)).cmpn(0)&&(z=!1,x=new d(0));return function i(h,l){h=h.toArray(),l=l.toArray(),128&h[0]&&(h=[0].concat(h)),128&l[0]&&(l=[0].concat(l));var p=[48,h.length+l.length+4,2,h.length];return p=p.concat(h,[2,l.length],l),R.from(p)}(x,z)}(h,y,e)}if("rsa"!==p&&"ecdsa/rsa"!==p)throw new Error("wrong private key type");h=R.concat([b,h]);for(var w=y.modulus.byteLength(),x=[0,1];h.length+x.length+1<w;)x.push(255);x.push(0);for(var B=-1;++B<h.length;)x.push(h[B]);return E(x,y)},ie.exports.getKey=r,ie.exports.makeKey=n},{"./curves.json":45,"bn.js":49,"browserify-rsa":41,"create-hmac":76,elliptic:89,"parse-asn1":230,"safe-buffer":250}],48:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("bn.js"),E=m("elliptic").ec,_=m("parse-asn1"),d=m("./curves.json");function v(c,i){if(c.cmpn(0)<=0)throw new Error("invalid sig");if(c.cmp(i)>=i)throw new Error("invalid sig")}ie.exports=function u(c,i,r,s,t){var n=_(r);if("ec"===n.type){if("ecdsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong public key type");return function g(c,i,r){var s=d[r.data.algorithm.curve.join(".")];if(!s)throw new Error("unknown curve "+r.data.algorithm.curve.join("."));return new E(s).verify(i,c,r.data.subjectPrivateKey.data)}(c,i,n)}if("dsa"===n.type){if("dsa"!==s)throw new Error("wrong public key type");return function f(c,i,r){var s=r.data.p,t=r.data.q,n=r.data.g,o=r.data.pub_key,h=_.signature.decode(c,"der"),l=h.s,e=h.r;v(l,t),v(e,t);var p=I.mont(s),b=l.invm(t);return 0===n.toRed(p).redPow(new I(i).mul(b).mod(t)).fromRed().mul(o.toRed(p).redPow(e.mul(b).mod(t)).fromRed()).mod(s).mod(t).cmp(e)}(c,i,n)}if("rsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong public key type");i=R.concat([t,i]);for(var o=n.modulus.byteLength(),h=[1],l=0;i.length+h.length+2<o;)h.push(255),l++;h.push(0);for(var e=-1;++e<i.length;)h.push(i[e]);h=R.from(h);var p=I.mont(n.modulus);c=(c=new I(c).toRed(p)).redPow(new I(n.publicExponent)),c=R.from(c.fromRed().toArray());var b=l<8?1:0;for(o=Math.min(c.length,h.length),c.length!==h.length&&(b=1),e=-1;++e<o;)b|=c[e]^h[e];return 0===b}},{"./curves.json":45,"bn.js":49,elliptic:89,"parse-asn1":230,"safe-buffer":250}],49:[function(m,ie,a){arguments[4][42][0].apply(a,arguments)},{buffer:20,dup:42}],50:[function(m,ie,a){"use strict";var I={};function E(f,v,c){c||(c=Error);var r=function(s){function t(n,o,h){return s.call(this,function i(s,t,n){return"string"==typeof v?v:v(s,t,n)}(n,o,h))||this}return function R(f,v){f.prototype=Object.create(v.prototype),f.prototype.constructor=f,f.__proto__=v}(t,s),t}(c);r.prototype.name=c.name,r.prototype.code=f,I[f]=r}function _(f,v){if(Array.isArray(f)){var c=f.length;return f=f.map(function(i){return String(i)}),c>2?"one of ".concat(v," ").concat(f.slice(0,c-1).join(", "),", or ")+f[c-1]:2===c?"one of ".concat(v," ").concat(f[0]," or ").concat(f[1]):"of ".concat(v," ").concat(f[0])}return"of ".concat(v," ").concat(String(f))}E("ERR_INVALID_OPT_VALUE",function(f,v){return'The value "'+v+'" is invalid for option "'+f+'"'},TypeError),E("ERR_INVALID_ARG_TYPE",function(f,v,c){var i,r;if("string"==typeof v&&function d(f,v,c){return f.substr(!c||c<0?0:+c,v.length)===v}(v,"not ")?(i="must not be",v=v.replace(/^not /,"")):i="must be",function u(f,v,c){return(void 0===c||c>f.length)&&(c=f.length),f.substring(c-v.length,c)===v}(f," argument"))r="The ".concat(f," ").concat(i," ").concat(_(v,"type"));else{var s=function g(f,v,c){return"number"!=typeof c&&(c=0),!(c+v.length>f.length)&&-1!==f.indexOf(v,c)}(f,".")?"property":"argument";r='The "'.concat(f,'" ').concat(s," ").concat(i," ").concat(_(v,"type"))}return r+". Received type ".concat(typeof c)},TypeError),E("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),E("ERR_METHOD_NOT_IMPLEMENTED",function(f){return"The "+f+" method is not implemented"}),E("ERR_STREAM_PREMATURE_CLOSE","Premature close"),E("ERR_STREAM_DESTROYED",function(f){return"Cannot call "+f+" after a stream was destroyed"}),E("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),E("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),E("ERR_STREAM_WRITE_AFTER_END","write after end"),E("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),E("ERR_UNKNOWN_ENCODING",function(f){return"Unknown encoding: "+f},TypeError),E("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),ie.exports.codes=I},{}],51:[function(m,ie,a){(function(R){(function(){"use strict";var I=Object.keys||function(i){var r=[];for(var s in i)r.push(s);return r};ie.exports=f;var E=m("./_stream_readable"),_=m("./_stream_writable");m("inherits")(f,E);for(var d=I(_.prototype),u=0;u<d.length;u++){var g=d[u];f.prototype[g]||(f.prototype[g]=_.prototype[g])}function f(i){if(!(this instanceof f))return new f(i);E.call(this,i),_.call(this,i),this.allowHalfOpen=!0,i&&(!1===i.readable&&(this.readable=!1),!1===i.writable&&(this.writable=!1),!1===i.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",v)))}function v(){this._writableState.ended||R.nextTick(c,this)}function c(i){i.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(r){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=r,this._writableState.destroyed=r)}})}).call(this)}).call(this,m("_process"))},{"./_stream_readable":53,"./_stream_writable":55,_process:237,inherits:146}],52:[function(m,ie,a){"use strict";ie.exports=I;var R=m("./_stream_transform");function I(E){if(!(this instanceof I))return new I(E);R.call(this,E)}m("inherits")(I,R),I.prototype._transform=function(E,_,d){d(null,E)}},{"./_stream_transform":54,inherits:146}],53:[function(m,ie,a){(function(R,I){(function(){"use strict";var E;ie.exports=L,L.ReadableState=M,m("events");var r,d=function(A,$){return A.listeners($).length},u=m("./internal/streams/stream"),g=m("buffer").Buffer,f=I.Uint8Array||function(){},i=m("util");r=i&&i.debuglog?i.debuglog("stream"):function(){};var y,w,x,s=m("./internal/streams/buffer_list"),t=m("./internal/streams/destroy"),o=m("./internal/streams/state").getHighWaterMark,h=m("../errors").codes,l=h.ERR_INVALID_ARG_TYPE,e=h.ERR_STREAM_PUSH_AFTER_EOF,p=h.ERR_METHOD_NOT_IMPLEMENTED,b=h.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;m("inherits")(L,u);var B=t.errorOrDestroy,J=["error","close","destroy","pause","resume"];function M(P,A,$){E=E||m("./_stream_duplex"),"boolean"!=typeof $&&($=A instanceof E),this.objectMode=!!(P=P||{}).objectMode,$&&(this.objectMode=this.objectMode||!!P.readableObjectMode),this.highWaterMark=o(this,P,"readableHighWaterMark",$),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==P.emitClose,this.autoDestroy=!!P.autoDestroy,this.destroyed=!1,this.defaultEncoding=P.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,P.encoding&&(y||(y=m("string_decoder/").StringDecoder),this.decoder=new y(P.encoding),this.encoding=P.encoding)}function L(P){if(E=E||m("./_stream_duplex"),!(this instanceof L))return new L(P);this._readableState=new M(P,this,this instanceof E),this.readable=!0,P&&("function"==typeof P.read&&(this._read=P.read),"function"==typeof P.destroy&&(this._destroy=P.destroy)),u.call(this)}function j(P,A,$,G,se){r("readableAddChunk",A);var pe,he=P._readableState;if(null===A)he.reading=!1,function S(P,A){if(r("onEofChunk"),!A.ended){if(A.decoder){var $=A.decoder.end();$&&$.length&&(A.buffer.push($),A.length+=A.objectMode?1:$.length)}A.ended=!0,A.sync?U(P):(A.needReadable=!1,A.emittedReadable||(A.emittedReadable=!0,W(P)))}}(P,he);else if(se||(pe=function F(P,A){var $;return!function c(P){return g.isBuffer(P)||P instanceof f}(A)&&"string"!=typeof A&&void 0!==A&&!P.objectMode&&($=new l("chunk",["string","Buffer","Uint8Array"],A)),$}(he,A)),pe)B(P,pe);else if(he.objectMode||A&&A.length>0)if("string"!=typeof A&&!he.objectMode&&Object.getPrototypeOf(A)!==g.prototype&&(A=function v(P){return g.from(P)}(A)),G)he.endEmitted?B(P,new b):C(P,he,A,!0);else if(he.ended)B(P,new e);else{if(he.destroyed)return!1;he.reading=!1,he.decoder&&!$?(A=he.decoder.write(A),he.objectMode||0!==A.length?C(P,he,A,!1):k(P,he)):C(P,he,A,!1)}else G||(he.reading=!1,k(P,he));return!he.ended&&(he.length<he.highWaterMark||0===he.length)}function C(P,A,$,G){A.flowing&&0===A.length&&!A.sync?(A.awaitDrain=0,P.emit("data",$)):(A.length+=A.objectMode?1:$.length,G?A.buffer.unshift($):A.buffer.push($),A.needReadable&&U(P)),k(P,A)}Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(A){this._readableState&&(this._readableState.destroyed=A)}}),L.prototype.destroy=t.destroy,L.prototype._undestroy=t.undestroy,L.prototype._destroy=function(P,A){A(P)},L.prototype.push=function(P,A){var G,$=this._readableState;return $.objectMode?G=!0:"string"==typeof P&&((A=A||$.defaultEncoding)!==$.encoding&&(P=g.from(P,A),A=""),G=!0),j(this,P,A,!1,G)},L.prototype.unshift=function(P){return j(this,P,null,!0,!1)},L.prototype.isPaused=function(){return!1===this._readableState.flowing},L.prototype.setEncoding=function(P){y||(y=m("string_decoder/").StringDecoder);var A=new y(P);this._readableState.decoder=A,this._readableState.encoding=this._readableState.decoder.encoding;for(var $=this._readableState.buffer.head,G="";null!==$;)G+=A.write($.data),$=$.next;return this._readableState.buffer.clear(),""!==G&&this._readableState.buffer.push(G),this._readableState.length=G.length,this};var V=1073741824;function T(P,A){return P<=0||0===A.length&&A.ended?0:A.objectMode?1:P!=P?A.flowing&&A.length?A.buffer.head.data.length:A.length:(P>A.highWaterMark&&(A.highWaterMark=function N(P){return P>=V?P=V:(P--,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,P|=P>>>16,P++),P}(P)),P<=A.length?P:A.ended?A.length:(A.needReadable=!0,0))}function U(P){var A=P._readableState;r("emitReadable",A.needReadable,A.emittedReadable),A.needReadable=!1,A.emittedReadable||(r("emitReadable",A.flowing),A.emittedReadable=!0,R.nextTick(W,P))}function W(P){var A=P._readableState;r("emitReadable_",A.destroyed,A.length,A.ended),!A.destroyed&&(A.length||A.ended)&&(P.emit("readable"),A.emittedReadable=!1),A.needReadable=!A.flowing&&!A.ended&&A.length<=A.highWaterMark,X(P)}function k(P,A){A.readingMore||(A.readingMore=!0,R.nextTick(D,P,A))}function D(P,A){for(;!A.reading&&!A.ended&&(A.length<A.highWaterMark||A.flowing&&0===A.length);){var $=A.length;if(r("maybeReadMore read 0"),P.read(0),$===A.length)break}A.readingMore=!1}function ee(P){var A=P._readableState;A.readableListening=P.listenerCount("readable")>0,A.resumeScheduled&&!A.paused?A.flowing=!0:P.listenerCount("data")>0&&P.resume()}function ae(P){r("readable nexttick read 0"),P.read(0)}function be(P,A){r("resume",A.reading),A.reading||P.read(0),A.resumeScheduled=!1,P.emit("resume"),X(P),A.flowing&&!A.reading&&P.read(0)}function X(P){var A=P._readableState;for(r("flow",A.flowing);A.flowing&&null!==P.read(););}function H(P,A){return 0===A.length?null:(A.objectMode?$=A.buffer.shift():!P||P>=A.length?($=A.decoder?A.buffer.join(""):1===A.buffer.length?A.buffer.first():A.buffer.concat(A.length),A.buffer.clear()):$=A.buffer.consume(P,A.decoder),$);var $}function ne(P){var A=P._readableState;r("endReadable",A.endEmitted),A.endEmitted||(A.ended=!0,R.nextTick(ce,A,P))}function ce(P,A){if(r("endReadableNT",P.endEmitted,P.length),!P.endEmitted&&0===P.length&&(P.endEmitted=!0,A.readable=!1,A.emit("end"),P.autoDestroy)){var $=A._writableState;(!$||$.autoDestroy&&$.finished)&&A.destroy()}}function te(P,A){for(var $=0,G=P.length;$<G;$++)if(P[$]===A)return $;return-1}L.prototype.read=function(P){r("read",P),P=parseInt(P,10);var A=this._readableState,$=P;if(0!==P&&(A.emittedReadable=!1),0===P&&A.needReadable&&((0!==A.highWaterMark?A.length>=A.highWaterMark:A.length>0)||A.ended))return r("read: emitReadable",A.length,A.ended),0===A.length&&A.ended?ne(this):U(this),null;if(0===(P=T(P,A))&&A.ended)return 0===A.length&&ne(this),null;var se,G=A.needReadable;return r("need readable",G),(0===A.length||A.length-P<A.highWaterMark)&&r("length less than watermark",G=!0),A.ended||A.reading?r("reading or ended",G=!1):G&&(r("do read"),A.reading=!0,A.sync=!0,0===A.length&&(A.needReadable=!0),this._read(A.highWaterMark),A.sync=!1,A.reading||(P=T($,A))),null===(se=P>0?H(P,A):null)?(A.needReadable=A.length<=A.highWaterMark,P=0):(A.length-=P,A.awaitDrain=0),0===A.length&&(A.ended||(A.needReadable=!0),$!==P&&A.ended&&ne(this)),null!==se&&this.emit("data",se),se},L.prototype._read=function(P){B(this,new p("_read()"))},L.prototype.pipe=function(P,A){var $=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=P;break;case 1:G.pipes=[G.pipes,P];break;default:G.pipes.push(P)}G.pipesCount+=1,r("pipe count=%d opts=%j",G.pipesCount,A);var he=A&&!1===A.end||P===R.stdout||P===R.stderr?Be:me;function me(){r("onend"),P.end()}G.endEmitted?R.nextTick(he):$.once("end",he),P.on("unpipe",function pe(Ge,Ue){r("onunpipe"),Ge===$&&Ue&&!1===Ue.hasUnpiped&&(Ue.hasUnpiped=!0,function Se(){r("cleanup"),P.removeListener("close",Ne),P.removeListener("finish",qe),P.removeListener("drain",Ee),P.removeListener("error",Ae),P.removeListener("unpipe",pe),$.removeListener("end",me),$.removeListener("end",Be),$.removeListener("data",De),_e=!0,G.awaitDrain&&(!P._writableState||P._writableState.needDrain)&&Ee()}())});var Ee=function Q(P){return function(){var $=P._readableState;r("pipeOnDrain",$.awaitDrain),$.awaitDrain&&$.awaitDrain--,0===$.awaitDrain&&d(P,"data")&&($.flowing=!0,X(P))}}($);P.on("drain",Ee);var _e=!1;function De(Ge){r("ondata");var Ue=P.write(Ge);r("dest.write",Ue),!1===Ue&&((1===G.pipesCount&&G.pipes===P||G.pipesCount>1&&-1!==te(G.pipes,P))&&!_e&&(r("false write response, pause",G.awaitDrain),G.awaitDrain++),$.pause())}function Ae(Ge){r("onerror",Ge),Be(),P.removeListener("error",Ae),0===d(P,"error")&&B(P,Ge)}function Ne(){P.removeListener("finish",qe),Be()}function qe(){r("onfinish"),P.removeListener("close",Ne),Be()}function Be(){r("unpipe"),$.unpipe(P)}return $.on("data",De),function z(P,A,$){if("function"==typeof P.prependListener)return P.prependListener(A,$);P._events&&P._events[A]?Array.isArray(P._events[A])?P._events[A].unshift($):P._events[A]=[$,P._events[A]]:P.on(A,$)}(P,"error",Ae),P.once("close",Ne),P.once("finish",qe),P.emit("pipe",$),G.flowing||(r("pipe resume"),$.resume()),P},L.prototype.unpipe=function(P){var A=this._readableState,$={hasUnpiped:!1};if(0===A.pipesCount)return this;if(1===A.pipesCount)return P&&P!==A.pipes||(P||(P=A.pipes),A.pipes=null,A.pipesCount=0,A.flowing=!1,P&&P.emit("unpipe",this,$)),this;if(!P){var G=A.pipes,se=A.pipesCount;A.pipes=null,A.pipesCount=0,A.flowing=!1;for(var he=0;he<se;he++)G[he].emit("unpipe",this,{hasUnpiped:!1});return this}var pe=te(A.pipes,P);return-1===pe||(A.pipes.splice(pe,1),A.pipesCount-=1,1===A.pipesCount&&(A.pipes=A.pipes[0]),P.emit("unpipe",this,$)),this},L.prototype.addListener=L.prototype.on=function(P,A){var $=u.prototype.on.call(this,P,A),G=this._readableState;return"data"===P?(G.readableListening=this.listenerCount("readable")>0,!1!==G.flowing&&this.resume()):"readable"===P&&!G.endEmitted&&!G.readableListening&&(G.readableListening=G.needReadable=!0,G.flowing=!1,G.emittedReadable=!1,r("on readable",G.length,G.reading),G.length?U(this):G.reading||R.nextTick(ae,this)),$},L.prototype.removeListener=function(P,A){var $=u.prototype.removeListener.call(this,P,A);return"readable"===P&&R.nextTick(ee,this),$},L.prototype.removeAllListeners=function(P){var A=u.prototype.removeAllListeners.apply(this,arguments);return("readable"===P||void 0===P)&&R.nextTick(ee,this),A},L.prototype.resume=function(){var P=this._readableState;return P.flowing||(r("resume"),P.flowing=!P.readableListening,function ue(P,A){A.resumeScheduled||(A.resumeScheduled=!0,R.nextTick(be,P,A))}(this,P)),P.paused=!1,this},L.prototype.pause=function(){return r("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(r("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},L.prototype.wrap=function(P){var A=this,$=this._readableState,G=!1;for(var se in P.on("end",function(){if(r("wrapped end"),$.decoder&&!$.ended){var pe=$.decoder.end();pe&&pe.length&&A.push(pe)}A.push(null)}),P.on("data",function(pe){r("wrapped data"),$.decoder&&(pe=$.decoder.write(pe)),$.objectMode&&null==pe||!($.objectMode||pe&&pe.length)||A.push(pe)||(G=!0,P.pause())}),P)void 0===this[se]&&"function"==typeof P[se]&&(this[se]=function(me){return function(){return P[me].apply(P,arguments)}}(se));for(var he=0;he<J.length;he++)P.on(J[he],this.emit.bind(this,J[he]));return this._read=function(pe){r("wrapped _read",pe),G&&(G=!1,P.resume())},this},"function"==typeof Symbol&&(L.prototype[Symbol.asyncIterator]=function(){return void 0===w&&(w=m("./internal/streams/async_iterator")),w(this)}),Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(A){this._readableState&&(this._readableState.flowing=A)}}),L._fromList=H,Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(L.from=function(P,A){return void 0===x&&(x=m("./internal/streams/from")),x(L,P,A)})}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":50,"./_stream_duplex":51,"./internal/streams/async_iterator":56,"./internal/streams/buffer_list":57,"./internal/streams/destroy":58,"./internal/streams/from":60,"./internal/streams/state":62,"./internal/streams/stream":63,_process:237,buffer:68,events:105,inherits:146,"string_decoder/":279,util:20}],54:[function(m,ie,a){"use strict";ie.exports=f;var R=m("../errors").codes,I=R.ERR_METHOD_NOT_IMPLEMENTED,E=R.ERR_MULTIPLE_CALLBACK,_=R.ERR_TRANSFORM_ALREADY_TRANSFORMING,d=R.ERR_TRANSFORM_WITH_LENGTH_0,u=m("./_stream_duplex");function g(i,r){var s=this._transformState;s.transforming=!1;var t=s.writecb;if(null===t)return this.emit("error",new E);s.writechunk=null,s.writecb=null,null!=r&&this.push(r),t(i);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function f(i){if(!(this instanceof f))return new f(i);u.call(this,i),this._transformState={afterTransform:g.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,i&&("function"==typeof i.transform&&(this._transform=i.transform),"function"==typeof i.flush&&(this._flush=i.flush)),this.on("prefinish",v)}function v(){var i=this;"function"!=typeof this._flush||this._readableState.destroyed?c(this,null,null):this._flush(function(r,s){c(i,r,s)})}function c(i,r,s){if(r)return i.emit("error",r);if(null!=s&&i.push(s),i._writableState.length)throw new d;if(i._transformState.transforming)throw new _;return i.push(null)}m("inherits")(f,u),f.prototype.push=function(i,r){return this._transformState.needTransform=!1,u.prototype.push.call(this,i,r)},f.prototype._transform=function(i,r,s){s(new I("_transform()"))},f.prototype._write=function(i,r,s){var t=this._transformState;if(t.writecb=s,t.writechunk=i,t.writeencoding=r,!t.transforming){var n=this._readableState;(t.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},f.prototype._read=function(i){var r=this._transformState;null===r.writechunk||r.transforming?r.needTransform=!0:(r.transforming=!0,this._transform(r.writechunk,r.writeencoding,r.afterTransform))},f.prototype._destroy=function(i,r){u.prototype._destroy.call(this,i,function(s){r(s)})}},{"../errors":50,"./_stream_duplex":51,inherits:146}],55:[function(m,ie,a){(function(R,I){(function(){"use strict";function _(X){var H=this;this.next=null,this.entry=null,this.finish=function(){!function be(X,H,ne){var ce=X.entry;for(X.entry=null;ce;){var te=ce.callback;H.pendingcb--,te(ne),ce=ce.next}H.corkedRequestsFree.next=X}(H,X)}}var d;ie.exports=M,M.WritableState=J;var z,u={deprecate:m("util-deprecate")},g=m("./internal/streams/stream"),f=m("buffer").Buffer,v=I.Uint8Array||function(){},r=m("./internal/streams/destroy"),t=m("./internal/streams/state").getHighWaterMark,n=m("../errors").codes,o=n.ERR_INVALID_ARG_TYPE,h=n.ERR_METHOD_NOT_IMPLEMENTED,l=n.ERR_MULTIPLE_CALLBACK,e=n.ERR_STREAM_CANNOT_PIPE,p=n.ERR_STREAM_DESTROYED,b=n.ERR_STREAM_NULL_VALUES,y=n.ERR_STREAM_WRITE_AFTER_END,w=n.ERR_UNKNOWN_ENCODING,x=r.errorOrDestroy;function B(){}function J(X,H,ne){d=d||m("./_stream_duplex"),"boolean"!=typeof ne&&(ne=H instanceof d),this.objectMode=!!(X=X||{}).objectMode,ne&&(this.objectMode=this.objectMode||!!X.writableObjectMode),this.highWaterMark=t(this,X,"writableHighWaterMark",ne),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===X.decodeStrings),this.defaultEncoding=X.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(te){!function S(X,H){var ne=X._writableState,ce=ne.sync,te=ne.writecb;if("function"!=typeof te)throw new l;if(function T(X){X.writing=!1,X.writecb=null,X.length-=X.writelen,X.writelen=0}(ne),H)!function N(X,H,ne,ce,te){--H.pendingcb,ne?(R.nextTick(te,ce),R.nextTick(ae,X,H),X._writableState.errorEmitted=!0,x(X,ce)):(te(ce),X._writableState.errorEmitted=!0,x(X,ce),ae(X,H))}(X,ne,ce,H,te);else{var P=D(ne)||X.destroyed;!P&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&k(X,ne),ce?R.nextTick(U,X,ne,P,te):U(X,ne,P,te)}}(H,te)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==X.emitClose,this.autoDestroy=!!X.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new _(this)}function M(X){var H=this instanceof(d=d||m("./_stream_duplex"));if(!H&&!z.call(M,this))return new M(X);this._writableState=new J(X,this,H),this.writable=!0,X&&("function"==typeof X.write&&(this._write=X.write),"function"==typeof X.writev&&(this._writev=X.writev),"function"==typeof X.destroy&&(this._destroy=X.destroy),"function"==typeof X.final&&(this._final=X.final)),g.call(this)}function V(X,H,ne,ce,te,P,A){H.writelen=ce,H.writecb=A,H.writing=!0,H.sync=!0,H.destroyed?H.onwrite(new p("write")):ne?X._writev(te,H.onwrite):X._write(te,P,H.onwrite),H.sync=!1}function U(X,H,ne,ce){ne||function W(X,H){0===H.length&&H.needDrain&&(H.needDrain=!1,X.emit("drain"))}(X,H),H.pendingcb--,ce(),ae(X,H)}function k(X,H){H.bufferProcessing=!0;var ne=H.bufferedRequest;if(X._writev&&ne&&ne.next){var te=new Array(H.bufferedRequestCount),P=H.corkedRequestsFree;P.entry=ne;for(var A=0,$=!0;ne;)te[A]=ne,ne.isBuf||($=!1),ne=ne.next,A+=1;te.allBuffers=$,V(X,H,!0,H.length,te,"",P.finish),H.pendingcb++,H.lastBufferedRequest=null,P.next?(H.corkedRequestsFree=P.next,P.next=null):H.corkedRequestsFree=new _(H),H.bufferedRequestCount=0}else{for(;ne;){var G=ne.chunk;if(V(X,H,!1,H.objectMode?1:G.length,G,ne.encoding,ne.callback),ne=ne.next,H.bufferedRequestCount--,H.writing)break}null===ne&&(H.lastBufferedRequest=null)}H.bufferedRequest=ne,H.bufferProcessing=!1}function D(X){return X.ending&&0===X.length&&null===X.bufferedRequest&&!X.finished&&!X.writing}function Q(X,H){X._final(function(ne){H.pendingcb--,ne&&x(X,ne),H.prefinished=!0,X.emit("prefinish"),ae(X,H)})}function ae(X,H){var ne=D(H);if(ne&&(function ee(X,H){!H.prefinished&&!H.finalCalled&&("function"!=typeof X._final||H.destroyed?(H.prefinished=!0,X.emit("prefinish")):(H.pendingcb++,H.finalCalled=!0,R.nextTick(Q,X,H)))}(X,H),0===H.pendingcb&&(H.finished=!0,X.emit("finish"),H.autoDestroy))){var ce=X._readableState;(!ce||ce.autoDestroy&&ce.endEmitted)&&X.destroy()}return ne}m("inherits")(M,g),J.prototype.getBuffer=function(){for(var H=this.bufferedRequest,ne=[];H;)ne.push(H),H=H.next;return ne},function(){try{Object.defineProperty(J.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(z=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(H){return!!z.call(this,H)||this===M&&H&&H._writableState instanceof J}})):z=function(H){return H instanceof this},M.prototype.pipe=function(){x(this,new e)},M.prototype.write=function(X,H,ne){var ce=this._writableState,te=!1,P=!ce.objectMode&&function i(X){return f.isBuffer(X)||X instanceof v}(X);return P&&!f.isBuffer(X)&&(X=function c(X){return f.from(X)}(X)),"function"==typeof H&&(ne=H,H=null),P?H="buffer":H||(H=ce.defaultEncoding),"function"!=typeof ne&&(ne=B),ce.ending?function L(X,H){var ne=new y;x(X,ne),R.nextTick(H,ne)}(this,ne):(P||function j(X,H,ne,ce){var te;return null===ne?te=new b:"string"!=typeof ne&&!H.objectMode&&(te=new o("chunk",["string","Buffer"],ne)),!te||(x(X,te),R.nextTick(ce,te),!1)}(this,ce,X,ne))&&(ce.pendingcb++,te=function F(X,H,ne,ce,te,P){if(!ne){var A=function C(X,H,ne){return!X.objectMode&&!1!==X.decodeStrings&&"string"==typeof H&&(H=f.from(H,ne)),H}(H,ce,te);ce!==A&&(ne=!0,te="buffer",ce=A)}var $=H.objectMode?1:ce.length;H.length+=$;var G=H.length<H.highWaterMark;if(G||(H.needDrain=!0),H.writing||H.corked){var se=H.lastBufferedRequest;H.lastBufferedRequest={chunk:ce,encoding:te,isBuf:ne,callback:P,next:null},se?se.next=H.lastBufferedRequest:H.bufferedRequest=H.lastBufferedRequest,H.bufferedRequestCount+=1}else V(X,H,!1,$,ce,te,P);return G}(this,ce,P,X,H,ne)),te},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var X=this._writableState;X.corked&&(X.corked--,!X.writing&&!X.corked&&!X.bufferProcessing&&X.bufferedRequest&&k(this,X))},M.prototype.setDefaultEncoding=function(H){if("string"==typeof H&&(H=H.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((H+"").toLowerCase())>-1))throw new w(H);return this._writableState.defaultEncoding=H,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),M.prototype._write=function(X,H,ne){ne(new h("_write()"))},M.prototype._writev=null,M.prototype.end=function(X,H,ne){var ce=this._writableState;return"function"==typeof X?(ne=X,X=null,H=null):"function"==typeof H&&(ne=H,H=null),null!=X&&this.write(X,H),ce.corked&&(ce.corked=1,this.uncork()),ce.ending||function ue(X,H,ne){H.ending=!0,ae(X,H),ne&&(H.finished?R.nextTick(ne):X.once("finish",ne)),H.ended=!0,X.writable=!1}(this,ce,ne),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(H){this._writableState&&(this._writableState.destroyed=H)}}),M.prototype.destroy=r.destroy,M.prototype._undestroy=r.undestroy,M.prototype._destroy=function(X,H){H(X)}}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":50,"./_stream_duplex":51,"./internal/streams/destroy":58,"./internal/streams/state":62,"./internal/streams/stream":63,_process:237,buffer:68,inherits:146,"util-deprecate":282}],56:[function(m,ie,a){(function(R){(function(){"use strict";var I;function E(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}var _=m("./end-of-stream"),d=Symbol("lastResolve"),u=Symbol("lastReject"),g=Symbol("error"),f=Symbol("ended"),v=Symbol("lastPromise"),c=Symbol("handlePromise"),i=Symbol("stream");function r(e,p){return{value:e,done:p}}function s(e){var p=e[d];if(null!==p){var b=e[i].read();null!==b&&(e[v]=null,e[d]=null,e[u]=null,p(r(b,!1)))}}function t(e){R.nextTick(s,e)}var o=Object.getPrototypeOf(function(){}),h=Object.setPrototypeOf((E(I={get stream(){return this[i]},next:function(){var p=this,b=this[g];if(null!==b)return Promise.reject(b);if(this[f])return Promise.resolve(r(void 0,!0));if(this[i].destroyed)return new Promise(function(B,J){R.nextTick(function(){p[g]?J(p[g]):B(r(void 0,!0))})});var w,y=this[v];if(y)w=new Promise(function n(e,p){return function(b,y){e.then(function(){p[f]?b(r(void 0,!0)):p[c](b,y)},y)}}(y,this));else{var x=this[i].read();if(null!==x)return Promise.resolve(r(x,!1));w=new Promise(this[c])}return this[v]=w,w}},Symbol.asyncIterator,function(){return this}),E(I,"return",function(){var p=this;return new Promise(function(b,y){p[i].destroy(null,function(w){w?y(w):b(r(void 0,!0))})})}),I),o);ie.exports=function(p){var b,y=Object.create(h,(E(b={},i,{value:p,writable:!0}),E(b,d,{value:null,writable:!0}),E(b,u,{value:null,writable:!0}),E(b,g,{value:null,writable:!0}),E(b,f,{value:p._readableState.endEmitted,writable:!0}),E(b,c,{value:function(x,B){var J=y[i].read();J?(y[v]=null,y[d]=null,y[u]=null,x(r(J,!1))):(y[d]=x,y[u]=B)},writable:!0}),b));return y[v]=null,_(p,function(w){if(w&&"ERR_STREAM_PREMATURE_CLOSE"!==w.code){var x=y[u];return null!==x&&(y[v]=null,y[d]=null,y[u]=null,x(w)),void(y[g]=w)}var B=y[d];null!==B&&(y[v]=null,y[d]=null,y[u]=null,B(r(void 0,!0))),y[f]=!0}),p.on("readable",t.bind(null,y)),y}}).call(this)}).call(this,m("_process"))},{"./end-of-stream":59,_process:237}],57:[function(m,ie,a){"use strict";function R(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);t&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(s,h).enumerable})),n.push.apply(n,o)}return n}function E(s,t,n){return t in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function d(s,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,o.key,o)}}var f=m("buffer").Buffer,c=m("util").inspect,i=c&&c.custom||"inspect";function r(s,t,n){f.prototype.copy.call(s,t,n)}ie.exports=function(){function s(){(function _(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")})(this,s),this.head=null,this.tail=null,this.length=0}return function u(s,t,n){t&&d(s.prototype,t),n&&d(s,n)}(s,[{key:"push",value:function(n){var o={data:n,next:null};this.length>0?this.tail.next=o:this.head=o,this.tail=o,++this.length}},{key:"unshift",value:function(n){var o={data:n,next:this.head};0===this.length&&(this.tail=o),this.head=o,++this.length}},{key:"shift",value:function(){if(0!==this.length){var n=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,n}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(n){if(0===this.length)return"";for(var o=this.head,h=""+o.data;o=o.next;)h+=n+o.data;return h}},{key:"concat",value:function(n){if(0===this.length)return f.alloc(0);for(var o=f.allocUnsafe(n>>>0),h=this.head,l=0;h;)r(h.data,o,l),l+=h.data.length,h=h.next;return o}},{key:"consume",value:function(n,o){var h;return n<this.head.data.length?(h=this.head.data.slice(0,n),this.head.data=this.head.data.slice(n)):h=n===this.head.data.length?this.shift():o?this._getString(n):this._getBuffer(n),h}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(n){var o=this.head,h=1,l=o.data;for(n-=l.length;o=o.next;){var e=o.data,p=n>e.length?e.length:n;if(l+=p===e.length?e:e.slice(0,n),0==(n-=p)){p===e.length?(++h,this.head=o.next?o.next:this.tail=null):(this.head=o,o.data=e.slice(p));break}++h}return this.length-=h,l}},{key:"_getBuffer",value:function(n){var o=f.allocUnsafe(n),h=this.head,l=1;for(h.data.copy(o),n-=h.data.length;h=h.next;){var e=h.data,p=n>e.length?e.length:n;if(e.copy(o,o.length-n,0,p),0==(n-=p)){p===e.length?(++l,this.head=h.next?h.next:this.tail=null):(this.head=h,h.data=e.slice(p));break}++l}return this.length-=l,o}},{key:i,value:function(n,o){return c(this,function I(s){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach(function(o){E(s,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(o){Object.defineProperty(s,o,Object.getOwnPropertyDescriptor(n,o))})}return s}({},o,{depth:0,customInspect:!1}))}}]),s}()},{buffer:68,util:20}],58:[function(m,ie,a){(function(R){(function(){"use strict";function E(f,v){u(f,v),_(f)}function _(f){f._writableState&&!f._writableState.emitClose||f._readableState&&!f._readableState.emitClose||f.emit("close")}function u(f,v){f.emit("error",v)}ie.exports={destroy:function I(f,v){var c=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(v?v(f):f&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,R.nextTick(u,this,f)):R.nextTick(u,this,f)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(f||null,function(s){!v&&s?c._writableState?c._writableState.errorEmitted?R.nextTick(_,c):(c._writableState.errorEmitted=!0,R.nextTick(E,c,s)):R.nextTick(E,c,s):v?(R.nextTick(_,c),v(s)):R.nextTick(_,c)}),this)},undestroy:function d(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function g(f,v){var c=f._readableState,i=f._writableState;c&&c.autoDestroy||i&&i.autoDestroy?f.destroy(v):f.emit("error",v)}}}).call(this)}).call(this,m("_process"))},{_process:237}],59:[function(m,ie,a){"use strict";var R=m("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function E(){}ie.exports=function d(u,g,f){if("function"==typeof g)return d(u,null,g);g||(g={}),f=function I(u){var g=!1;return function(){if(!g){g=!0;for(var f=arguments.length,v=new Array(f),c=0;c<f;c++)v[c]=arguments[c];u.apply(this,v)}}}(f||E);var v=g.readable||!1!==g.readable&&u.readable,c=g.writable||!1!==g.writable&&u.writable,i=function(){u.writable||s()},r=u._writableState&&u._writableState.finished,s=function(){c=!1,r=!0,v||f.call(u)},t=u._readableState&&u._readableState.endEmitted,n=function(){v=!1,t=!0,c||f.call(u)},o=function(p){f.call(u,p)},h=function(){var p;return v&&!t?((!u._readableState||!u._readableState.ended)&&(p=new R),f.call(u,p)):c&&!r?((!u._writableState||!u._writableState.ended)&&(p=new R),f.call(u,p)):void 0},l=function(){u.req.on("finish",s)};return function _(u){return u.setHeader&&"function"==typeof u.abort}(u)?(u.on("complete",s),u.on("abort",h),u.req?l():u.on("request",l)):c&&!u._writableState&&(u.on("end",i),u.on("close",i)),u.on("end",n),u.on("finish",s),!1!==g.error&&u.on("error",o),u.on("close",h),function(){u.removeListener("complete",s),u.removeListener("abort",h),u.removeListener("request",l),u.req&&u.req.removeListener("finish",s),u.removeListener("end",i),u.removeListener("close",i),u.removeListener("finish",s),u.removeListener("end",n),u.removeListener("error",o),u.removeListener("close",h)}}},{"../../../errors":50}],60:[function(m,ie,a){ie.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],61:[function(m,ie,a){"use strict";var R,E=m("../../../errors").codes,_=E.ERR_MISSING_ARGS,d=E.ERR_STREAM_DESTROYED;function u(s){if(s)throw s}function v(s){s()}function c(s,t){return s.pipe(t)}ie.exports=function r(){for(var s=arguments.length,t=new Array(s),n=0;n<s;n++)t[n]=arguments[n];var o=function i(s){return s.length&&"function"==typeof s[s.length-1]?s.pop():u}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new _("streams");var h,l=t.map(function(e,p){var b=p<t.length-1;return function f(s,t,n,o){o=function I(s){var t=!1;return function(){t||(t=!0,s.apply(void 0,arguments))}}(o);var h=!1;s.on("close",function(){h=!0}),void 0===R&&(R=m("./end-of-stream")),R(s,{readable:t,writable:n},function(e){if(e)return o(e);h=!0,o()});var l=!1;return function(e){if(!h&&!l){if(l=!0,function g(s){return s.setHeader&&"function"==typeof s.abort}(s))return s.abort();if("function"==typeof s.destroy)return s.destroy();o(e||new d("pipe"))}}}(e,b,p>0,function(w){h||(h=w),w&&l.forEach(v),!b&&(l.forEach(v),o(h))})});return t.reduce(c)}},{"../../../errors":50,"./end-of-stream":59}],62:[function(m,ie,a){"use strict";var R=m("../../../errors").codes.ERR_INVALID_OPT_VALUE;ie.exports={getHighWaterMark:function E(_,d,u,g){var f=function I(_,d,u){return null!=_.highWaterMark?_.highWaterMark:d?_[u]:null}(d,g,u);if(null!=f){if(!isFinite(f)||Math.floor(f)!==f||f<0)throw new R(g?u:"highWaterMark",f);return Math.floor(f)}return _.objectMode?16:16384}}},{"../../../errors":50}],63:[function(m,ie,a){ie.exports=m("events").EventEmitter},{events:105}],64:[function(m,ie,a){(a=ie.exports=m("./lib/_stream_readable.js")).Stream=a,a.Readable=a,a.Writable=m("./lib/_stream_writable.js"),a.Duplex=m("./lib/_stream_duplex.js"),a.Transform=m("./lib/_stream_transform.js"),a.PassThrough=m("./lib/_stream_passthrough.js"),a.finished=m("./lib/internal/streams/end-of-stream.js"),a.pipeline=m("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":51,"./lib/_stream_passthrough.js":52,"./lib/_stream_readable.js":53,"./lib/_stream_transform.js":54,"./lib/_stream_writable.js":55,"./lib/internal/streams/end-of-stream.js":59,"./lib/internal/streams/pipeline.js":61}],65:[function(m,ie,a){const R=m("base-x");ie.exports=R("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},{"base-x":66}],66:[function(m,ie,a){"use strict";ie.exports=function R(I){if(I.length>=255)throw new TypeError("Alphabet too long");for(var E=new Uint8Array(256),_=0;_<E.length;_++)E[_]=255;for(var d=0;d<I.length;d++){var u=I.charAt(d),g=u.charCodeAt(0);if(255!==E[g])throw new TypeError(u+" is ambiguous");E[g]=d}var f=I.length,v=I.charAt(0),c=Math.log(f)/Math.log(256),i=Math.log(256)/Math.log(f);function s(n){if("string"!=typeof n)throw new TypeError("Expected String");if(0===n.length)return new Uint8Array;for(var o=0,h=0,l=0;n[o]===v;)h++,o++;for(var e=(n.length-o)*c+1>>>0,p=new Uint8Array(e);n[o];){var b=E[n.charCodeAt(o)];if(255===b)return;for(var y=0,w=e-1;(0!==b||y<l)&&-1!==w;w--,y++)p[w]=(b+=f*p[w]>>>0)%256>>>0,b=b/256>>>0;if(0!==b)throw new Error("Non-zero carry");l=y,o++}for(var x=e-l;x!==e&&0===p[x];)x++;for(var B=new Uint8Array(h+(e-x)),J=h;x!==e;)B[J++]=p[x++];return B}return{encode:function r(n){if(n instanceof Uint8Array||(ArrayBuffer.isView(n)?n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength):Array.isArray(n)&&(n=Uint8Array.from(n))),!(n instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===n.length)return"";for(var o=0,h=0,l=0,e=n.length;l!==e&&0===n[l];)l++,o++;for(var p=(e-l)*i+1>>>0,b=new Uint8Array(p);l!==e;){for(var y=n[l],w=0,x=p-1;(0!==y||w<h)&&-1!==x;x--,w++)b[x]=(y+=256*b[x]>>>0)%f>>>0,y=y/f>>>0;if(0!==y)throw new Error("Non-zero carry");h=w,l++}for(var B=p-h;B!==p&&0===b[B];)B++;for(var J=v.repeat(o);B<p;++B)J+=I.charAt(b[B]);return J},decodeUnsafe:s,decode:function t(n){var o=s(n);if(o)return o;throw new Error("Non-base"+f+" character")}}}},{}],67:[function(m,ie,a){(function(R){(function(){ie.exports=function(E,_){for(var d=Math.min(E.length,_.length),u=new R(d),g=0;g<d;++g)u[g]=E[g]^_[g];return u}}).call(this)}).call(this,m("buffer").Buffer)},{buffer:68}],68:[function(m,ie,a){(function(R){(function(){"use strict";var I=m("base64-js"),E=m("ieee754");a.Buffer=g,a.SlowBuffer=function h(A){return+A!=A&&(A=0),g.alloc(+A)},a.INSPECT_MAX_BYTES=50;var _=2147483647;function u(A){if(A>_)throw new RangeError('The value "'+A+'" is invalid for option "size"');var $=new Uint8Array(A);return $.__proto__=g.prototype,$}function g(A,$,G){if("number"==typeof A){if("string"==typeof $)throw new TypeError('The "string" argument must be of type string. Received type number');return i(A)}return f(A,$,G)}function f(A,$,G){if("string"==typeof A)return function r(A,$){if(("string"!=typeof $||""===$)&&($="utf8"),!g.isEncoding($))throw new TypeError("Unknown encoding: "+$);var G=0|l(A,$),se=u(G),he=se.write(A,$);return he!==G&&(se=se.slice(0,he)),se}(A,$);if(ArrayBuffer.isView(A))return s(A);if(null==A)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(te(A,ArrayBuffer)||A&&te(A.buffer,ArrayBuffer))return function t(A,$,G){if($<0||A.byteLength<$)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<$+(G||0))throw new RangeError('"length" is outside of buffer bounds');var se;return(se=void 0===$&&void 0===G?new Uint8Array(A):void 0===G?new Uint8Array(A,$):new Uint8Array(A,$,G)).__proto__=g.prototype,se}(A,$,G);if("number"==typeof A)throw new TypeError('The "value" argument must not be of type number. Received type number');var se=A.valueOf&&A.valueOf();if(null!=se&&se!==A)return g.from(se,$,G);var he=function n(A){if(g.isBuffer(A)){var $=0|o(A.length),G=u($);return 0===G.length||A.copy(G,0,0,$),G}return void 0!==A.length?"number"!=typeof A.length||P(A.length)?u(0):s(A):"Buffer"===A.type&&Array.isArray(A.data)?s(A.data):void 0}(A);if(he)return he;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof A[Symbol.toPrimitive])return g.from(A[Symbol.toPrimitive]("string"),$,G);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}function v(A){if("number"!=typeof A)throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function i(A){return v(A),u(A<0?0:0|o(A))}function s(A){for(var $=A.length<0?0:0|o(A.length),G=u($),se=0;se<$;se+=1)G[se]=255&A[se];return G}function o(A){if(A>=_)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_.toString(16)+" bytes");return 0|A}function l(A,$){if(g.isBuffer(A))return A.length;if(ArrayBuffer.isView(A)||te(A,ArrayBuffer))return A.byteLength;if("string"!=typeof A)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);var G=A.length,se=arguments.length>2&&!0===arguments[2];if(!se&&0===G)return 0;for(var he=!1;;)switch($){case"ascii":case"latin1":case"binary":return G;case"utf8":case"utf-8":return be(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*G;case"hex":return G>>>1;case"base64":return ne(A).length;default:if(he)return se?-1:be(A).length;$=(""+$).toLowerCase(),he=!0}}function e(A,$,G){var se=!1;if((void 0===$||$<0)&&($=0),$>this.length||((void 0===G||G>this.length)&&(G=this.length),G<=0)||(G>>>=0)<=($>>>=0))return"";for(A||(A="utf8");;)switch(A){case"hex":return T(this,$,G);case"utf8":case"utf-8":return j(this,$,G);case"ascii":return V(this,$,G);case"latin1":case"binary":return N(this,$,G);case"base64":return L(this,$,G);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,$,G);default:if(se)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),se=!0}}function p(A,$,G){var se=A[$];A[$]=A[G],A[G]=se}function b(A,$,G,se,he){if(0===A.length)return-1;if("string"==typeof G?(se=G,G=0):G>2147483647?G=2147483647:G<-2147483648&&(G=-2147483648),P(G=+G)&&(G=he?0:A.length-1),G<0&&(G=A.length+G),G>=A.length){if(he)return-1;G=A.length-1}else if(G<0){if(!he)return-1;G=0}if("string"==typeof $&&($=g.from($,se)),g.isBuffer($))return 0===$.length?-1:y(A,$,G,se,he);if("number"==typeof $)return $&=255,"function"==typeof Uint8Array.prototype.indexOf?he?Uint8Array.prototype.indexOf.call(A,$,G):Uint8Array.prototype.lastIndexOf.call(A,$,G):y(A,[$],G,se,he);throw new TypeError("val must be string, number or Buffer")}function y(A,$,G,se,he){var Se,pe=1,me=A.length,Ee=$.length;if(void 0!==se&&("ucs2"===(se=String(se).toLowerCase())||"ucs-2"===se||"utf16le"===se||"utf-16le"===se)){if(A.length<2||$.length<2)return-1;pe=2,me/=2,Ee/=2,G/=2}function _e(qe,Be){return 1===pe?qe[Be]:qe.readUInt16BE(Be*pe)}if(he){var De=-1;for(Se=G;Se<me;Se++)if(_e(A,Se)===_e($,-1===De?0:Se-De)){if(-1===De&&(De=Se),Se-De+1===Ee)return De*pe}else-1!==De&&(Se-=Se-De),De=-1}else for(G+Ee>me&&(G=me-Ee),Se=G;Se>=0;Se--){for(var Ae=!0,Ne=0;Ne<Ee;Ne++)if(_e(A,Se+Ne)!==_e($,Ne)){Ae=!1;break}if(Ae)return Se}return-1}function w(A,$,G,se){G=Number(G)||0;var he=A.length-G;se?(se=Number(se))>he&&(se=he):se=he;var pe=$.length;se>pe/2&&(se=pe/2);for(var me=0;me<se;++me){var Ee=parseInt($.substr(2*me,2),16);if(P(Ee))return me;A[G+me]=Ee}return me}function x(A,$,G,se){return ce(be($,A.length-G),A,G,se)}function B(A,$,G,se){return ce(function X(A){for(var $=[],G=0;G<A.length;++G)$.push(255&A.charCodeAt(G));return $}($),A,G,se)}function J(A,$,G,se){return B(A,$,G,se)}function z(A,$,G,se){return ce(ne($),A,G,se)}function M(A,$,G,se){return ce(function H(A,$){for(var G,se,pe=[],me=0;me<A.length&&!(($-=2)<0);++me)se=(G=A.charCodeAt(me))>>8,pe.push(G%256),pe.push(se);return pe}($,A.length-G),A,G,se)}function L(A,$,G){return I.fromByteArray(0===$&&G===A.length?A:A.slice($,G))}function j(A,$,G){G=Math.min(A.length,G);for(var se=[],he=$;he<G;){var _e,Se,De,Ae,pe=A[he],me=null,Ee=pe>239?4:pe>223?3:pe>191?2:1;if(he+Ee<=G)switch(Ee){case 1:pe<128&&(me=pe);break;case 2:128==(192&(_e=A[he+1]))&&(Ae=(31&pe)<<6|63&_e)>127&&(me=Ae);break;case 3:Se=A[he+2],128==(192&(_e=A[he+1]))&&128==(192&Se)&&(Ae=(15&pe)<<12|(63&_e)<<6|63&Se)>2047&&(Ae<55296||Ae>57343)&&(me=Ae);break;case 4:Se=A[he+2],De=A[he+3],128==(192&(_e=A[he+1]))&&128==(192&Se)&&128==(192&De)&&(Ae=(15&pe)<<18|(63&_e)<<12|(63&Se)<<6|63&De)>65535&&Ae<1114112&&(me=Ae)}null===me?(me=65533,Ee=1):me>65535&&(se.push((me-=65536)>>>10&1023|55296),me=56320|1023&me),se.push(me),he+=Ee}return function F(A){var $=A.length;if($<=C)return String.fromCharCode.apply(String,A);for(var G="",se=0;se<$;)G+=String.fromCharCode.apply(String,A.slice(se,se+=C));return G}(se)}a.kMaxLength=_,!(g.TYPED_ARRAY_SUPPORT=function d(){try{var A=new Uint8Array(1);return A.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===A.foo()}catch{return!1}}())&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(g.prototype,"parent",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.buffer}}),Object.defineProperty(g.prototype,"offset",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&null!=Symbol.species&&g[Symbol.species]===g&&Object.defineProperty(g,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),g.poolSize=8192,g.from=function(A,$,G){return f(A,$,G)},g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array,g.alloc=function(A,$,G){return function c(A,$,G){return v(A),A<=0?u(A):void 0!==$?"string"==typeof G?u(A).fill($,G):u(A).fill($):u(A)}(A,$,G)},g.allocUnsafe=function(A){return i(A)},g.allocUnsafeSlow=function(A){return i(A)},g.isBuffer=function($){return null!=$&&!0===$._isBuffer&&$!==g.prototype},g.compare=function($,G){if(te($,Uint8Array)&&($=g.from($,$.offset,$.byteLength)),te(G,Uint8Array)&&(G=g.from(G,G.offset,G.byteLength)),!g.isBuffer($)||!g.isBuffer(G))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if($===G)return 0;for(var se=$.length,he=G.length,pe=0,me=Math.min(se,he);pe<me;++pe)if($[pe]!==G[pe]){se=$[pe],he=G[pe];break}return se<he?-1:he<se?1:0},g.isEncoding=function($){switch(String($).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function($,G){if(!Array.isArray($))throw new TypeError('"list" argument must be an Array of Buffers');if(0===$.length)return g.alloc(0);var se;if(void 0===G)for(G=0,se=0;se<$.length;++se)G+=$[se].length;var he=g.allocUnsafe(G),pe=0;for(se=0;se<$.length;++se){var me=$[se];if(te(me,Uint8Array)&&(me=g.from(me)),!g.isBuffer(me))throw new TypeError('"list" argument must be an Array of Buffers');me.copy(he,pe),pe+=me.length}return he},g.byteLength=l,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var $=this.length;if($%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var G=0;G<$;G+=2)p(this,G,G+1);return this},g.prototype.swap32=function(){var $=this.length;if($%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var G=0;G<$;G+=4)p(this,G,G+3),p(this,G+1,G+2);return this},g.prototype.swap64=function(){var $=this.length;if($%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var G=0;G<$;G+=8)p(this,G,G+7),p(this,G+1,G+6),p(this,G+2,G+5),p(this,G+3,G+4);return this},g.prototype.toString=function(){var $=this.length;return 0===$?"":0===arguments.length?j(this,0,$):e.apply(this,arguments)},g.prototype.toLocaleString=g.prototype.toString,g.prototype.equals=function($){if(!g.isBuffer($))throw new TypeError("Argument must be a Buffer");return this===$||0===g.compare(this,$)},g.prototype.inspect=function(){var $="",G=a.INSPECT_MAX_BYTES;return $=this.toString("hex",0,G).replace(/(.{2})/g,"$1 ").trim(),this.length>G&&($+=" ... "),"<Buffer "+$+">"},g.prototype.compare=function($,G,se,he,pe){if(te($,Uint8Array)&&($=g.from($,$.offset,$.byteLength)),!g.isBuffer($))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof $);if(void 0===G&&(G=0),void 0===se&&(se=$?$.length:0),void 0===he&&(he=0),void 0===pe&&(pe=this.length),G<0||se>$.length||he<0||pe>this.length)throw new RangeError("out of range index");if(he>=pe&&G>=se)return 0;if(he>=pe)return-1;if(G>=se)return 1;if(this===$)return 0;for(var me=(pe>>>=0)-(he>>>=0),Ee=(se>>>=0)-(G>>>=0),_e=Math.min(me,Ee),Se=this.slice(he,pe),De=$.slice(G,se),Ae=0;Ae<_e;++Ae)if(Se[Ae]!==De[Ae]){me=Se[Ae],Ee=De[Ae];break}return me<Ee?-1:Ee<me?1:0},g.prototype.includes=function($,G,se){return-1!==this.indexOf($,G,se)},g.prototype.indexOf=function($,G,se){return b(this,$,G,se,!0)},g.prototype.lastIndexOf=function($,G,se){return b(this,$,G,se,!1)},g.prototype.write=function($,G,se,he){if(void 0===G)he="utf8",se=this.length,G=0;else if(void 0===se&&"string"==typeof G)he=G,se=this.length,G=0;else{if(!isFinite(G))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");G>>>=0,isFinite(se)?(se>>>=0,void 0===he&&(he="utf8")):(he=se,se=void 0)}var pe=this.length-G;if((void 0===se||se>pe)&&(se=pe),$.length>0&&(se<0||G<0)||G>this.length)throw new RangeError("Attempt to write outside buffer bounds");he||(he="utf8");for(var me=!1;;)switch(he){case"hex":return w(this,$,G,se);case"utf8":case"utf-8":return x(this,$,G,se);case"ascii":return B(this,$,G,se);case"latin1":case"binary":return J(this,$,G,se);case"base64":return z(this,$,G,se);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,$,G,se);default:if(me)throw new TypeError("Unknown encoding: "+he);he=(""+he).toLowerCase(),me=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function V(A,$,G){var se="";G=Math.min(A.length,G);for(var he=$;he<G;++he)se+=String.fromCharCode(127&A[he]);return se}function N(A,$,G){var se="";G=Math.min(A.length,G);for(var he=$;he<G;++he)se+=String.fromCharCode(A[he]);return se}function T(A,$,G){var se=A.length;(!$||$<0)&&($=0),(!G||G<0||G>se)&&(G=se);for(var he="",pe=$;pe<G;++pe)he+=ue(A[pe]);return he}function S(A,$,G){for(var se=A.slice($,G),he="",pe=0;pe<se.length;pe+=2)he+=String.fromCharCode(se[pe]+256*se[pe+1]);return he}function U(A,$,G){if(A%1!=0||A<0)throw new RangeError("offset is not uint");if(A+$>G)throw new RangeError("Trying to access beyond buffer length")}function W(A,$,G,se,he,pe){if(!g.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if($>he||$<pe)throw new RangeError('"value" argument is out of bounds');if(G+se>A.length)throw new RangeError("Index out of range")}function k(A,$,G,se,he,pe){if(G+se>A.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("Index out of range")}function D(A,$,G,se,he){return $=+$,G>>>=0,he||k(A,0,G,4),E.write(A,$,G,se,23,4),G+4}function Q(A,$,G,se,he){return $=+$,G>>>=0,he||k(A,0,G,8),E.write(A,$,G,se,52,8),G+8}g.prototype.slice=function($,G){var se=this.length;($=~~$)<0?($+=se)<0&&($=0):$>se&&($=se),(G=void 0===G?se:~~G)<0?(G+=se)<0&&(G=0):G>se&&(G=se),G<$&&(G=$);var he=this.subarray($,G);return he.__proto__=g.prototype,he},g.prototype.readUIntLE=function($,G,se){$>>>=0,G>>>=0,se||U($,G,this.length);for(var he=this[$],pe=1,me=0;++me<G&&(pe*=256);)he+=this[$+me]*pe;return he},g.prototype.readUIntBE=function($,G,se){$>>>=0,G>>>=0,se||U($,G,this.length);for(var he=this[$+--G],pe=1;G>0&&(pe*=256);)he+=this[$+--G]*pe;return he},g.prototype.readUInt8=function($,G){return $>>>=0,G||U($,1,this.length),this[$]},g.prototype.readUInt16LE=function($,G){return $>>>=0,G||U($,2,this.length),this[$]|this[$+1]<<8},g.prototype.readUInt16BE=function($,G){return $>>>=0,G||U($,2,this.length),this[$]<<8|this[$+1]},g.prototype.readUInt32LE=function($,G){return $>>>=0,G||U($,4,this.length),(this[$]|this[$+1]<<8|this[$+2]<<16)+16777216*this[$+3]},g.prototype.readUInt32BE=function($,G){return $>>>=0,G||U($,4,this.length),16777216*this[$]+(this[$+1]<<16|this[$+2]<<8|this[$+3])},g.prototype.readIntLE=function($,G,se){$>>>=0,G>>>=0,se||U($,G,this.length);for(var he=this[$],pe=1,me=0;++me<G&&(pe*=256);)he+=this[$+me]*pe;return he>=(pe*=128)&&(he-=Math.pow(2,8*G)),he},g.prototype.readIntBE=function($,G,se){$>>>=0,G>>>=0,se||U($,G,this.length);for(var he=G,pe=1,me=this[$+--he];he>0&&(pe*=256);)me+=this[$+--he]*pe;return me>=(pe*=128)&&(me-=Math.pow(2,8*G)),me},g.prototype.readInt8=function($,G){return $>>>=0,G||U($,1,this.length),128&this[$]?-1*(255-this[$]+1):this[$]},g.prototype.readInt16LE=function($,G){$>>>=0,G||U($,2,this.length);var se=this[$]|this[$+1]<<8;return 32768&se?4294901760|se:se},g.prototype.readInt16BE=function($,G){$>>>=0,G||U($,2,this.length);var se=this[$+1]|this[$]<<8;return 32768&se?4294901760|se:se},g.prototype.readInt32LE=function($,G){return $>>>=0,G||U($,4,this.length),this[$]|this[$+1]<<8|this[$+2]<<16|this[$+3]<<24},g.prototype.readInt32BE=function($,G){return $>>>=0,G||U($,4,this.length),this[$]<<24|this[$+1]<<16|this[$+2]<<8|this[$+3]},g.prototype.readFloatLE=function($,G){return $>>>=0,G||U($,4,this.length),E.read(this,$,!0,23,4)},g.prototype.readFloatBE=function($,G){return $>>>=0,G||U($,4,this.length),E.read(this,$,!1,23,4)},g.prototype.readDoubleLE=function($,G){return $>>>=0,G||U($,8,this.length),E.read(this,$,!0,52,8)},g.prototype.readDoubleBE=function($,G){return $>>>=0,G||U($,8,this.length),E.read(this,$,!1,52,8)},g.prototype.writeUIntLE=function($,G,se,he){$=+$,G>>>=0,se>>>=0,he||W(this,$,G,se,Math.pow(2,8*se)-1,0);var me=1,Ee=0;for(this[G]=255&$;++Ee<se&&(me*=256);)this[G+Ee]=$/me&255;return G+se},g.prototype.writeUIntBE=function($,G,se,he){$=+$,G>>>=0,se>>>=0,he||W(this,$,G,se,Math.pow(2,8*se)-1,0);var me=se-1,Ee=1;for(this[G+me]=255&$;--me>=0&&(Ee*=256);)this[G+me]=$/Ee&255;return G+se},g.prototype.writeUInt8=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,1,255,0),this[G]=255&$,G+1},g.prototype.writeUInt16LE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,2,65535,0),this[G]=255&$,this[G+1]=$>>>8,G+2},g.prototype.writeUInt16BE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,2,65535,0),this[G]=$>>>8,this[G+1]=255&$,G+2},g.prototype.writeUInt32LE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,4,4294967295,0),this[G+3]=$>>>24,this[G+2]=$>>>16,this[G+1]=$>>>8,this[G]=255&$,G+4},g.prototype.writeUInt32BE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,4,4294967295,0),this[G]=$>>>24,this[G+1]=$>>>16,this[G+2]=$>>>8,this[G+3]=255&$,G+4},g.prototype.writeIntLE=function($,G,se,he){if($=+$,G>>>=0,!he){var pe=Math.pow(2,8*se-1);W(this,$,G,se,pe-1,-pe)}var me=0,Ee=1,_e=0;for(this[G]=255&$;++me<se&&(Ee*=256);)$<0&&0===_e&&0!==this[G+me-1]&&(_e=1),this[G+me]=($/Ee>>0)-_e&255;return G+se},g.prototype.writeIntBE=function($,G,se,he){if($=+$,G>>>=0,!he){var pe=Math.pow(2,8*se-1);W(this,$,G,se,pe-1,-pe)}var me=se-1,Ee=1,_e=0;for(this[G+me]=255&$;--me>=0&&(Ee*=256);)$<0&&0===_e&&0!==this[G+me+1]&&(_e=1),this[G+me]=($/Ee>>0)-_e&255;return G+se},g.prototype.writeInt8=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,1,127,-128),$<0&&($=255+$+1),this[G]=255&$,G+1},g.prototype.writeInt16LE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,2,32767,-32768),this[G]=255&$,this[G+1]=$>>>8,G+2},g.prototype.writeInt16BE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,2,32767,-32768),this[G]=$>>>8,this[G+1]=255&$,G+2},g.prototype.writeInt32LE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,4,2147483647,-2147483648),this[G]=255&$,this[G+1]=$>>>8,this[G+2]=$>>>16,this[G+3]=$>>>24,G+4},g.prototype.writeInt32BE=function($,G,se){return $=+$,G>>>=0,se||W(this,$,G,4,2147483647,-2147483648),$<0&&($=4294967295+$+1),this[G]=$>>>24,this[G+1]=$>>>16,this[G+2]=$>>>8,this[G+3]=255&$,G+4},g.prototype.writeFloatLE=function($,G,se){return D(this,$,G,!0,se)},g.prototype.writeFloatBE=function($,G,se){return D(this,$,G,!1,se)},g.prototype.writeDoubleLE=function($,G,se){return Q(this,$,G,!0,se)},g.prototype.writeDoubleBE=function($,G,se){return Q(this,$,G,!1,se)},g.prototype.copy=function($,G,se,he){if(!g.isBuffer($))throw new TypeError("argument should be a Buffer");if(se||(se=0),!he&&0!==he&&(he=this.length),G>=$.length&&(G=$.length),G||(G=0),he>0&&he<se&&(he=se),he===se||0===$.length||0===this.length)return 0;if(G<0)throw new RangeError("targetStart out of bounds");if(se<0||se>=this.length)throw new RangeError("Index out of range");if(he<0)throw new RangeError("sourceEnd out of bounds");he>this.length&&(he=this.length),$.length-G<he-se&&(he=$.length-G+se);var pe=he-se;if(this===$&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(G,se,he);else if(this===$&&se<G&&G<he)for(var me=pe-1;me>=0;--me)$[me+G]=this[me+se];else Uint8Array.prototype.set.call($,this.subarray(se,he),G);return pe},g.prototype.fill=function($,G,se,he){if("string"==typeof $){if("string"==typeof G?(he=G,G=0,se=this.length):"string"==typeof se&&(he=se,se=this.length),void 0!==he&&"string"!=typeof he)throw new TypeError("encoding must be a string");if("string"==typeof he&&!g.isEncoding(he))throw new TypeError("Unknown encoding: "+he);if(1===$.length){var pe=$.charCodeAt(0);("utf8"===he&&pe<128||"latin1"===he)&&($=pe)}}else"number"==typeof $&&($&=255);if(G<0||this.length<G||this.length<se)throw new RangeError("Out of range index");if(se<=G)return this;var me;if(G>>>=0,se=void 0===se?this.length:se>>>0,$||($=0),"number"==typeof $)for(me=G;me<se;++me)this[me]=$;else{var Ee=g.isBuffer($)?$:g.from($,he),_e=Ee.length;if(0===_e)throw new TypeError('The value "'+$+'" is invalid for argument "value"');for(me=0;me<se-G;++me)this[me+G]=Ee[me%_e]}return this};var ee=/[^+/0-9A-Za-z-_]/g;function ue(A){return A<16?"0"+A.toString(16):A.toString(16)}function be(A,$){$=$||1/0;for(var G,se=A.length,he=null,pe=[],me=0;me<se;++me){if((G=A.charCodeAt(me))>55295&&G<57344){if(!he){if(G>56319){($-=3)>-1&&pe.push(239,191,189);continue}if(me+1===se){($-=3)>-1&&pe.push(239,191,189);continue}he=G;continue}if(G<56320){($-=3)>-1&&pe.push(239,191,189),he=G;continue}G=65536+(he-55296<<10|G-56320)}else he&&($-=3)>-1&&pe.push(239,191,189);if(he=null,G<128){if(($-=1)<0)break;pe.push(G)}else if(G<2048){if(($-=2)<0)break;pe.push(G>>6|192,63&G|128)}else if(G<65536){if(($-=3)<0)break;pe.push(G>>12|224,G>>6&63|128,63&G|128)}else{if(!(G<1114112))throw new Error("Invalid code point");if(($-=4)<0)break;pe.push(G>>18|240,G>>12&63|128,G>>6&63|128,63&G|128)}}return pe}function ne(A){return I.toByteArray(function ae(A){if((A=(A=A.split("=")[0]).trim().replace(ee,"")).length<2)return"";for(;A.length%4!=0;)A+="=";return A}(A))}function ce(A,$,G,se){for(var he=0;he<se&&!(he+G>=$.length||he>=A.length);++he)$[he+G]=A[he];return he}function te(A,$){return A instanceof $||null!=A&&null!=A.constructor&&null!=A.constructor.name&&A.constructor.name===$.name}function P(A){return A!=A}}).call(this)}).call(this,m("buffer").Buffer)},{"base64-js":17,buffer:68,ieee754:145}],69:[function(m,ie,a){"use strict";var R=m("get-intrinsic"),I=m("./"),E=I(R("String.prototype.indexOf"));ie.exports=function(d,u){var g=R(d,!!u);return"function"==typeof g&&E(d,".prototype.")>-1?I(g):g}},{"./":70,"get-intrinsic":110}],70:[function(m,ie,a){"use strict";var R=m("function-bind"),I=m("get-intrinsic"),E=I("%Function.prototype.apply%"),_=I("%Function.prototype.call%"),d=I("%Reflect.apply%",!0)||R.call(_,E),u=I("%Object.getOwnPropertyDescriptor%",!0),g=I("%Object.defineProperty%",!0),f=I("%Math.max%");if(g)try{g({},"a",{value:1})}catch{g=null}ie.exports=function(i){var r=d(R,_,arguments);return u&&g&&u(r,"length").configurable&&g(r,"length",{value:1+f(0,i.length-(arguments.length-1))}),r};var v=function(){return d(R,E,arguments)};g?g(ie.exports,"apply",{value:v}):ie.exports.apply=v},{"function-bind":109,"get-intrinsic":110}],71:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("stream").Transform,E=m("string_decoder").StringDecoder;function d(u){I.call(this),this.hashMode="string"==typeof u,this.hashMode?this[u]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}m("inherits")(d,I),d.prototype.update=function(u,g,f){"string"==typeof u&&(u=R.from(u,g));var v=this._update(u);return this.hashMode?this:(f&&(v=this._toString(v,f)),v)},d.prototype.setAutoPadding=function(){},d.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},d.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},d.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},d.prototype._transform=function(u,g,f){var v;try{this.hashMode?this._update(u):this.push(this._update(u))}catch(c){v=c}finally{f(v)}},d.prototype._flush=function(u){var g;try{this.push(this.__final())}catch(f){g=f}u(g)},d.prototype._finalOrDigest=function(u){var g=this.__final()||R.alloc(0);return u&&(g=this._toString(g,u,!0)),g},d.prototype._toString=function(u,g,f){if(this._decoder||(this._decoder=new E(g),this._encoding=g),this._encoding!==g)throw new Error("can't switch encodings");var v=this._decoder.write(u);return f&&(v+=this._decoder.end()),v},ie.exports=d},{inherits:146,"safe-buffer":250,stream:264,string_decoder:279}],72:[function(m,ie,a){"use strict";var R=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,I=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,E=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,_=/\\([\u000b\u0020-\u00ff])/g,d=/([\\"])/g,u=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(r){var s=String(r);if(E.test(s))return s;if(s.length>0&&!I.test(s))throw new TypeError("invalid parameter value");return'"'+s.replace(d,"\\$1")+'"'}function i(r){this.parameters=Object.create(null),this.type=r}a.format=function g(r){if(!r||"object"!=typeof r)throw new TypeError("argument obj is required");var s=r.parameters,t=r.type;if(!t||!u.test(t))throw new TypeError("invalid type");var n=t;if(s&&"object"==typeof s)for(var o,h=Object.keys(s).sort(),l=0;l<h.length;l++){if(!E.test(o=h[l]))throw new TypeError("invalid parameter name");n+="; "+o+"="+c(s[o])}return n},a.parse=function f(r){if(!r)throw new TypeError("argument string is required");var s="object"==typeof r?function v(r){var s;if("function"==typeof r.getHeader?s=r.getHeader("content-type"):"object"==typeof r.headers&&(s=r.headers&&r.headers["content-type"]),"string"!=typeof s)throw new TypeError("content-type header is missing from object");return s}(r):r;if("string"!=typeof s)throw new TypeError("argument string is required to be a string");var t=s.indexOf(";"),n=-1!==t?s.substr(0,t).trim():s.trim();if(!u.test(n))throw new TypeError("invalid media type");var o=new i(n.toLowerCase());if(-1!==t){var h,l,e;for(R.lastIndex=t;l=R.exec(s);){if(l.index!==t)throw new TypeError("invalid parameter format");t+=l[0].length,h=l[1].toLowerCase(),'"'===(e=l[2])[0]&&(e=e.substr(1,e.length-2).replace(_,"$1")),o.parameters[h]=e}if(t!==s.length)throw new TypeError("invalid parameter format")}return o}},{}],73:[function(m,ie,a){(function(R){(function(){var I=m("elliptic"),E=m("bn.js");ie.exports=function(f){return new d(f)};var _={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function d(g){this.curveType=_[g],this.curveType||(this.curveType={name:g}),this.curve=new I.ec(this.curveType.name),this.keys=void 0}function u(g,f,v){Array.isArray(g)||(g=g.toArray());var c=new R(g);if(v&&c.length<v){var i=new R(v-c.length);i.fill(0),c=R.concat([i,c])}return f?c.toString(f):c}_.p224=_.secp224r1,_.p256=_.secp256r1=_.prime256v1,_.p192=_.secp192r1=_.prime192v1,_.p384=_.secp384r1,_.p521=_.secp521r1,d.prototype.generateKeys=function(g,f){return this.keys=this.curve.genKeyPair(),this.getPublicKey(g,f)},d.prototype.computeSecret=function(g,f,v){return f=f||"utf8",R.isBuffer(g)||(g=new R(g,f)),u(this.curve.keyFromPublic(g).getPublic().mul(this.keys.getPrivate()).getX(),v,this.curveType.byteLength)},d.prototype.getPublicKey=function(g,f){var v=this.keys.getPublic("compressed"===f,!0);return"hybrid"===f&&(v[0]=v[v.length-1]%2?7:6),u(v,g)},d.prototype.getPrivateKey=function(g){return u(this.keys.getPrivate(),g)},d.prototype.setPublicKey=function(g,f){return f=f||"utf8",R.isBuffer(g)||(g=new R(g,f)),this.keys._importPublic(g),this},d.prototype.setPrivateKey=function(g,f){f=f||"utf8",R.isBuffer(g)||(g=new R(g,f));var v=new E(g);return v=v.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(v),this}}).call(this)}).call(this,m("buffer").Buffer)},{"bn.js":18,buffer:68,elliptic:89}],74:[function(m,ie,a){"use strict";var R=m("inherits"),I=m("md5.js"),E=m("ripemd160"),_=m("sha.js"),d=m("cipher-base");function u(g){d.call(this,"digest"),this._hash=g}R(u,d),u.prototype._update=function(g){this._hash.update(g)},u.prototype._final=function(){return this._hash.digest()},ie.exports=function(f){return"md5"===(f=f.toLowerCase())?new I:"rmd160"===f||"ripemd160"===f?new E:new u(_(f))}},{"cipher-base":71,inherits:146,"md5.js":221,ripemd160:249,"sha.js":257}],75:[function(m,ie,a){var R=m("md5.js");ie.exports=function(I){return(new R).update(I).digest()}},{"md5.js":221}],76:[function(m,ie,a){"use strict";var R=m("inherits"),I=m("./legacy"),E=m("cipher-base"),_=m("safe-buffer").Buffer,d=m("create-hash/md5"),u=m("ripemd160"),g=m("sha.js"),f=_.alloc(128);function v(c,i){E.call(this,"digest"),"string"==typeof i&&(i=_.from(i));var r="sha512"===c||"sha384"===c?128:64;this._alg=c,this._key=i,i.length>r?i=("rmd160"===c?new u:g(c)).update(i).digest():i.length<r&&(i=_.concat([i,f],r));for(var t=this._ipad=_.allocUnsafe(r),n=this._opad=_.allocUnsafe(r),o=0;o<r;o++)t[o]=54^i[o],n[o]=92^i[o];this._hash="rmd160"===c?new u:g(c),this._hash.update(t)}R(v,E),v.prototype._update=function(c){this._hash.update(c)},v.prototype._final=function(){var c=this._hash.digest();return("rmd160"===this._alg?new u:g(this._alg)).update(this._opad).update(c).digest()},ie.exports=function(i,r){return"rmd160"===(i=i.toLowerCase())||"ripemd160"===i?new v("rmd160",r):"md5"===i?new I(d,r):new v(i,r)}},{"./legacy":77,"cipher-base":71,"create-hash/md5":75,inherits:146,ripemd160:249,"safe-buffer":250,"sha.js":257}],77:[function(m,ie,a){"use strict";var R=m("inherits"),I=m("safe-buffer").Buffer,E=m("cipher-base"),_=I.alloc(128),d=64;function u(g,f){E.call(this,"digest"),"string"==typeof f&&(f=I.from(f)),this._alg=g,this._key=f,f.length>d?f=g(f):f.length<d&&(f=I.concat([f,_],d));for(var v=this._ipad=I.allocUnsafe(d),c=this._opad=I.allocUnsafe(d),i=0;i<d;i++)v[i]=54^f[i],c[i]=92^f[i];this._hash=[v]}R(u,E),u.prototype._update=function(g){this._hash.push(g)},u.prototype._final=function(){var g=this._alg(I.concat(this._hash));return this._alg(I.concat([this._opad,g]))},ie.exports=u},{"cipher-base":71,inherits:146,"safe-buffer":250}],78:[function(m,ie,a){"use strict";a.randomBytes=a.rng=a.pseudoRandomBytes=a.prng=m("randombytes"),a.createHash=a.Hash=m("create-hash"),a.createHmac=a.Hmac=m("create-hmac");var R=m("browserify-sign/algos"),I=Object.keys(R),E=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(I);a.getHashes=function(){return E};var _=m("pbkdf2");a.pbkdf2=_.pbkdf2,a.pbkdf2Sync=_.pbkdf2Sync;var d=m("browserify-cipher");a.Cipher=d.Cipher,a.createCipher=d.createCipher,a.Cipheriv=d.Cipheriv,a.createCipheriv=d.createCipheriv,a.Decipher=d.Decipher,a.createDecipher=d.createDecipher,a.Decipheriv=d.Decipheriv,a.createDecipheriv=d.createDecipheriv,a.getCiphers=d.getCiphers,a.listCiphers=d.listCiphers;var u=m("diffie-hellman");a.DiffieHellmanGroup=u.DiffieHellmanGroup,a.createDiffieHellmanGroup=u.createDiffieHellmanGroup,a.getDiffieHellman=u.getDiffieHellman,a.createDiffieHellman=u.createDiffieHellman,a.DiffieHellman=u.DiffieHellman;var g=m("browserify-sign");a.createSign=g.createSign,a.Sign=g.Sign,a.createVerify=g.createVerify,a.Verify=g.Verify,a.createECDH=m("create-ecdh");var f=m("public-encrypt");a.publicEncrypt=f.publicEncrypt,a.privateEncrypt=f.privateEncrypt,a.publicDecrypt=f.publicDecrypt,a.privateDecrypt=f.privateDecrypt;var v=m("randomfill");a.randomFill=v.randomFill,a.randomFillSync=v.randomFillSync,a.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},a.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},{"browserify-cipher":38,"browserify-sign":46,"browserify-sign/algos":43,"create-ecdh":73,"create-hash":74,"create-hmac":76,"diffie-hellman":85,pbkdf2:231,"public-encrypt":238,randombytes:244,randomfill:245}],79:[function(m,ie,a){"use strict";a.utils=m("./des/utils"),a.Cipher=m("./des/cipher"),a.DES=m("./des/des"),a.CBC=m("./des/cbc"),a.EDE=m("./des/ede")},{"./des/cbc":80,"./des/cipher":81,"./des/des":82,"./des/ede":83,"./des/utils":84}],80:[function(m,ie,a){"use strict";var R=m("minimalistic-assert"),I=m("inherits"),E={};function _(u){R.equal(u.length,8,"Invalid IV length"),this.iv=new Array(8);for(var g=0;g<this.iv.length;g++)this.iv[g]=u[g]}a.instantiate=function d(u){function g(i){u.call(this,i),this._cbcInit()}I(g,u);for(var f=Object.keys(E),v=0;v<f.length;v++){var c=f[v];g.prototype[c]=E[c]}return g.create=function(r){return new g(r)},g},E._cbcInit=function(){var g=new _(this.options.iv);this._cbcState=g},E._update=function(g,f,v,c){var r=this.constructor.super_.prototype,s=this._cbcState.iv;if("encrypt"===this.type){for(var t=0;t<this.blockSize;t++)s[t]^=g[f+t];for(r._update.call(this,s,0,v,c),t=0;t<this.blockSize;t++)s[t]=v[c+t]}else{for(r._update.call(this,g,f,v,c),t=0;t<this.blockSize;t++)v[c+t]^=s[t];for(t=0;t<this.blockSize;t++)s[t]=g[f+t]}}},{inherits:146,"minimalistic-assert":223}],81:[function(m,ie,a){"use strict";var R=m("minimalistic-assert");function I(E){this.options=E,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}ie.exports=I,I.prototype._init=function(){},I.prototype.update=function(_){return 0===_.length?[]:"decrypt"===this.type?this._updateDecrypt(_):this._updateEncrypt(_)},I.prototype._buffer=function(_,d){for(var u=Math.min(this.buffer.length-this.bufferOff,_.length-d),g=0;g<u;g++)this.buffer[this.bufferOff+g]=_[d+g];return this.bufferOff+=u,u},I.prototype._flushBuffer=function(_,d){return this._update(this.buffer,0,_,d),this.bufferOff=0,this.blockSize},I.prototype._updateEncrypt=function(_){var d=0,u=0,f=new Array(((this.bufferOff+_.length)/this.blockSize|0)*this.blockSize);0!==this.bufferOff&&(d+=this._buffer(_,d),this.bufferOff===this.buffer.length&&(u+=this._flushBuffer(f,u)));for(var v=_.length-(_.length-d)%this.blockSize;d<v;d+=this.blockSize)this._update(_,d,f,u),u+=this.blockSize;for(;d<_.length;d++,this.bufferOff++)this.buffer[this.bufferOff]=_[d];return f},I.prototype._updateDecrypt=function(_){for(var d=0,u=0,g=Math.ceil((this.bufferOff+_.length)/this.blockSize)-1,f=new Array(g*this.blockSize);g>0;g--)d+=this._buffer(_,d),u+=this._flushBuffer(f,u);return d+=this._buffer(_,d),f},I.prototype.final=function(_){var d,u;return _&&(d=this.update(_)),u="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),d?d.concat(u):u},I.prototype._pad=function(_,d){if(0===d)return!1;for(;d<_.length;)_[d++]=0;return!0},I.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var _=new Array(this.blockSize);return this._update(this.buffer,0,_,0),_},I.prototype._unpad=function(_){return _},I.prototype._finalDecrypt=function(){R.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var _=new Array(this.blockSize);return this._flushBuffer(_,0),this._unpad(_)}},{"minimalistic-assert":223}],82:[function(m,ie,a){"use strict";var R=m("minimalistic-assert"),I=m("inherits"),E=m("./utils"),_=m("./cipher");function d(){this.tmp=new Array(2),this.keys=null}function u(f){_.call(this,f);var v=new d;this._desState=v,this.deriveKeys(v,f.key)}I(u,_),ie.exports=u,u.create=function(v){return new u(v)};var g=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];u.prototype.deriveKeys=function(v,c){v.keys=new Array(32),R.equal(c.length,this.blockSize,"Invalid key length");var i=E.readUInt32BE(c,0),r=E.readUInt32BE(c,4);E.pc1(i,r,v.tmp,0),i=v.tmp[0],r=v.tmp[1];for(var s=0;s<v.keys.length;s+=2){var t=g[s>>>1];i=E.r28shl(i,t),r=E.r28shl(r,t),E.pc2(i,r,v.keys,s)}},u.prototype._update=function(v,c,i,r){var s=this._desState,t=E.readUInt32BE(v,c),n=E.readUInt32BE(v,c+4);E.ip(t,n,s.tmp,0),t=s.tmp[0],n=s.tmp[1],"encrypt"===this.type?this._encrypt(s,t,n,s.tmp,0):this._decrypt(s,t,n,s.tmp,0),n=s.tmp[1],E.writeUInt32BE(i,t=s.tmp[0],r),E.writeUInt32BE(i,n,r+4)},u.prototype._pad=function(v,c){for(var i=v.length-c,r=c;r<v.length;r++)v[r]=i;return!0},u.prototype._unpad=function(v){for(var c=v[v.length-1],i=v.length-c;i<v.length;i++)R.equal(v[i],c);return v.slice(0,v.length-c)},u.prototype._encrypt=function(v,c,i,r,s){for(var t=c,n=i,o=0;o<v.keys.length;o+=2){var h=v.keys[o],l=v.keys[o+1];E.expand(n,v.tmp,0);var e=E.substitute(h^=v.tmp[0],l^=v.tmp[1]),b=n;n=(t^E.permute(e))>>>0,t=b}E.rip(n,t,r,s)},u.prototype._decrypt=function(v,c,i,r,s){for(var t=i,n=c,o=v.keys.length-2;o>=0;o-=2){var h=v.keys[o],l=v.keys[o+1];E.expand(t,v.tmp,0);var e=E.substitute(h^=v.tmp[0],l^=v.tmp[1]),b=t;t=(n^E.permute(e))>>>0,n=b}E.rip(t,n,r,s)}},{"./cipher":81,"./utils":84,inherits:146,"minimalistic-assert":223}],83:[function(m,ie,a){"use strict";var R=m("minimalistic-assert"),I=m("inherits"),E=m("./cipher"),_=m("./des");function d(g,f){R.equal(f.length,24,"Invalid key length");var v=f.slice(0,8),c=f.slice(8,16),i=f.slice(16,24);this.ciphers="encrypt"===g?[_.create({type:"encrypt",key:v}),_.create({type:"decrypt",key:c}),_.create({type:"encrypt",key:i})]:[_.create({type:"decrypt",key:i}),_.create({type:"encrypt",key:c}),_.create({type:"decrypt",key:v})]}function u(g){E.call(this,g);var f=new d(this.type,this.options.key);this._edeState=f}I(u,E),ie.exports=u,u.create=function(f){return new u(f)},u.prototype._update=function(f,v,c,i){var r=this._edeState;r.ciphers[0]._update(f,v,c,i),r.ciphers[1]._update(c,i,c,i),r.ciphers[2]._update(c,i,c,i)},u.prototype._pad=_.prototype._pad,u.prototype._unpad=_.prototype._unpad},{"./cipher":81,"./des":82,inherits:146,"minimalistic-assert":223}],84:[function(m,ie,a){"use strict";a.readUInt32BE=function(d,u){return(d[0+u]<<24|d[1+u]<<16|d[2+u]<<8|d[3+u])>>>0},a.writeUInt32BE=function(d,u,g){d[0+g]=u>>>24,d[1+g]=u>>>16&255,d[2+g]=u>>>8&255,d[3+g]=255&u},a.ip=function(d,u,g,f){for(var v=0,c=0,i=6;i>=0;i-=2){for(var r=0;r<=24;r+=8)v<<=1,v|=u>>>r+i&1;for(r=0;r<=24;r+=8)v<<=1,v|=d>>>r+i&1}for(i=6;i>=0;i-=2){for(r=1;r<=25;r+=8)c<<=1,c|=u>>>r+i&1;for(r=1;r<=25;r+=8)c<<=1,c|=d>>>r+i&1}g[f+0]=v>>>0,g[f+1]=c>>>0},a.rip=function(d,u,g,f){for(var v=0,c=0,i=0;i<4;i++)for(var r=24;r>=0;r-=8)v<<=1,v|=u>>>r+i&1,v<<=1,v|=d>>>r+i&1;for(i=4;i<8;i++)for(r=24;r>=0;r-=8)c<<=1,c|=u>>>r+i&1,c<<=1,c|=d>>>r+i&1;g[f+0]=v>>>0,g[f+1]=c>>>0},a.pc1=function(d,u,g,f){for(var v=0,c=0,i=7;i>=5;i--){for(var r=0;r<=24;r+=8)v<<=1,v|=u>>r+i&1;for(r=0;r<=24;r+=8)v<<=1,v|=d>>r+i&1}for(r=0;r<=24;r+=8)v<<=1,v|=u>>r+i&1;for(i=1;i<=3;i++){for(r=0;r<=24;r+=8)c<<=1,c|=u>>r+i&1;for(r=0;r<=24;r+=8)c<<=1,c|=d>>r+i&1}for(r=0;r<=24;r+=8)c<<=1,c|=d>>r+i&1;g[f+0]=v>>>0,g[f+1]=c>>>0},a.r28shl=function(d,u){return d<<u&268435455|d>>>28-u};var R=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];a.pc2=function(d,u,g,f){for(var v=0,c=0,i=R.length>>>1,r=0;r<i;r++)v<<=1,v|=d>>>R[r]&1;for(r=i;r<R.length;r++)c<<=1,c|=u>>>R[r]&1;g[f+0]=v>>>0,g[f+1]=c>>>0},a.expand=function(d,u,g){var f=0,v=0;f=(1&d)<<5|d>>>27;for(var c=23;c>=15;c-=4)f<<=6,f|=d>>>c&63;for(c=11;c>=3;c-=4)v|=d>>>c&63,v<<=6;v|=(31&d)<<1|d>>>31,u[g+0]=f>>>0,u[g+1]=v>>>0};var I=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];a.substitute=function(d,u){for(var g=0,f=0;f<4;f++)g<<=4,g|=I[64*f+(d>>>18-6*f&63)];for(f=0;f<4;f++)g<<=4,g|=I[256+64*f+(u>>>18-6*f&63)];return g>>>0};var E=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];a.permute=function(d){for(var u=0,g=0;g<E.length;g++)u<<=1,u|=d>>>E[g]&1;return u>>>0},a.padSplit=function(d,u,g){for(var f=d.toString(2);f.length<u;)f="0"+f;for(var v=[],c=0;c<u;c+=g)v.push(f.slice(c,c+g));return v.join(" ")}},{}],85:[function(m,ie,a){(function(R){(function(){var I=m("./lib/generatePrime"),E=m("./lib/primes.json"),_=m("./lib/dh"),u={binary:!0,hex:!0,base64:!0};a.DiffieHellmanGroup=a.createDiffieHellmanGroup=a.getDiffieHellman=function d(f){var v=new R(E[f].prime,"hex"),c=new R(E[f].gen,"hex");return new _(v,c)},a.createDiffieHellman=a.DiffieHellman=function g(f,v,c,i){return R.isBuffer(v)||void 0===u[v]?g(f,"binary",v,c):(v=v||"binary",i=i||"binary",c=c||new R([2]),R.isBuffer(c)||(c=new R(c,i)),"number"==typeof f?new _(I(f,c),c,!0):(R.isBuffer(f)||(f=new R(f,v)),new _(f,c,!0)))}}).call(this)}).call(this,m("buffer").Buffer)},{"./lib/dh":86,"./lib/generatePrime":87,"./lib/primes.json":88,buffer:68}],86:[function(m,ie,a){(function(R){(function(){var I=m("bn.js"),_=new(m("miller-rabin")),d=new I(24),u=new I(11),g=new I(10),f=new I(3),v=new I(7),c=m("./generatePrime"),i=m("randombytes");function r(l,e){return e=e||"utf8",R.isBuffer(l)||(l=new R(l,e)),this._pub=new I(l),this}function s(l,e){return e=e||"utf8",R.isBuffer(l)||(l=new R(l,e)),this._priv=new I(l),this}ie.exports=o;var t={};function o(l,e,p){this.setGenerator(e),this.__prime=new I(l),this._prime=I.mont(this.__prime),this._primeLen=l.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,p?(this.setPublicKey=r,this.setPrivateKey=s):this._primeCode=8}function h(l,e){var p=new R(l.toArray());return e?p.toString(e):p}Object.defineProperty(o.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function n(l,e){var p=e.toString("hex"),b=[p,l.toString(16)].join("_");if(b in t)return t[b];var w,y=0;if(l.isEven()||!c.simpleSieve||!c.fermatTest(l)||!_.test(l))return y+=1,t[b]=y+="02"===p||"05"===p?8:4,y;switch(_.test(l.shrn(1))||(y+=2),p){case"02":l.mod(d).cmp(u)&&(y+=8);break;case"05":(w=l.mod(g)).cmp(f)&&w.cmp(v)&&(y+=8);break;default:y+=4}return t[b]=y,y}(this.__prime,this.__gen)),this._primeCode}}),o.prototype.generateKeys=function(){return this._priv||(this._priv=new I(i(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},o.prototype.computeSecret=function(l){var e=(l=(l=new I(l)).toRed(this._prime)).redPow(this._priv).fromRed(),p=new R(e.toArray()),b=this.getPrime();if(p.length<b.length){var y=new R(b.length-p.length);y.fill(0),p=R.concat([y,p])}return p},o.prototype.getPublicKey=function(e){return h(this._pub,e)},o.prototype.getPrivateKey=function(e){return h(this._priv,e)},o.prototype.getPrime=function(l){return h(this.__prime,l)},o.prototype.getGenerator=function(l){return h(this._gen,l)},o.prototype.setGenerator=function(l,e){return e=e||"utf8",R.isBuffer(l)||(l=new R(l,e)),this.__gen=l,this._gen=new I(l),this}}).call(this)}).call(this,m("buffer").Buffer)},{"./generatePrime":87,"bn.js":18,buffer:68,"miller-rabin":222,randombytes:244}],87:[function(m,ie,a){var R=m("randombytes");ie.exports=b,b.simpleSieve=e,b.fermatTest=p;var I=m("bn.js"),E=new I(24),d=new(m("miller-rabin")),u=new I(1),g=new I(2),f=new I(5),i=(new I(16),new I(8),new I(10)),r=new I(3),t=(new I(7),new I(11)),n=new I(4),h=(new I(12),null);function e(y){for(var w=function l(){if(null!==h)return h;var w=[];w[0]=2;for(var x=1,B=3;B<1048576;B+=2){for(var J=Math.ceil(Math.sqrt(B)),z=0;z<x&&w[z]<=J&&B%w[z]!=0;z++);x!==z&&w[z]<=J||(w[x++]=B)}return h=w,w}(),x=0;x<w.length;x++)if(0===y.modn(w[x]))return 0===y.cmpn(w[x]);return!0}function p(y){var w=I.mont(y);return 0===g.toRed(w).redPow(y.subn(1)).fromRed().cmpn(1)}function b(y,w){if(y<16)return new I(2===w||5===w?[140,123]:[140,39]);w=new I(w);for(var x,B;;){for(x=new I(R(Math.ceil(y/8)));x.bitLength()>y;)x.ishrn(1);if(x.isEven()&&x.iadd(u),x.testn(1)||x.iadd(g),w.cmp(g)){if(!w.cmp(f))for(;x.mod(i).cmp(r);)x.iadd(n)}else for(;x.mod(E).cmp(t);)x.iadd(n);if(e(B=x.shrn(1))&&e(x)&&p(B)&&p(x)&&d.test(B)&&d.test(x))return x}}},{"bn.js":18,"miller-rabin":222,randombytes:244}],88:[function(m,ie,a){ie.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},{}],89:[function(m,ie,a){"use strict";var R=a;R.version=m("../package.json").version,R.utils=m("./elliptic/utils"),R.rand=m("brorand"),R.curve=m("./elliptic/curve"),R.curves=m("./elliptic/curves"),R.ec=m("./elliptic/ec"),R.eddsa=m("./elliptic/eddsa")},{"../package.json":104,"./elliptic/curve":92,"./elliptic/curves":95,"./elliptic/ec":96,"./elliptic/eddsa":99,"./elliptic/utils":103,brorand:19}],90:[function(m,ie,a){"use strict";var R=m("bn.js"),I=m("../utils"),E=I.getNAF,_=I.getJSF,d=I.assert;function u(f,v){this.type=f,this.p=new R(v.p,16),this.red=v.prime?R.red(v.prime):R.mont(this.p),this.zero=new R(0).toRed(this.red),this.one=new R(1).toRed(this.red),this.two=new R(2).toRed(this.red),this.n=v.n&&new R(v.n,16),this.g=v.g&&this.pointFromJSON(v.g,v.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var c=this.n&&this.p.div(this.n);!c||c.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function g(f,v){this.curve=f,this.type=v,this.precomputed=null}ie.exports=u,u.prototype.point=function(){throw new Error("Not implemented")},u.prototype.validate=function(){throw new Error("Not implemented")},u.prototype._fixedNafMul=function(v,c){d(v.precomputed);var i=v._getDoubles(),r=E(c,1,this._bitLength),s=(1<<i.step+1)-(i.step%2==0?2:1);s/=3;var n,o,t=[];for(n=0;n<r.length;n+=i.step){o=0;for(var h=n+i.step-1;h>=n;h--)o=(o<<1)+r[h];t.push(o)}for(var l=this.jpoint(null,null,null),e=this.jpoint(null,null,null),p=s;p>0;p--){for(n=0;n<t.length;n++)(o=t[n])===p?e=e.mixedAdd(i.points[n]):o===-p&&(e=e.mixedAdd(i.points[n].neg()));l=l.add(e)}return l.toP()},u.prototype._wnafMul=function(v,c){for(var i=4,r=v._getNAFPoints(i),s=r.points,t=E(c,i=r.wnd,this._bitLength),n=this.jpoint(null,null,null),o=t.length-1;o>=0;o--){for(var h=0;o>=0&&0===t[o];o--)h++;if(o>=0&&h++,n=n.dblp(h),o<0)break;var l=t[o];d(0!==l),n="affine"===v.type?n.mixedAdd(l>0?s[l-1>>1]:s[-l-1>>1].neg()):n.add(l>0?s[l-1>>1]:s[-l-1>>1].neg())}return"affine"===v.type?n.toP():n},u.prototype._wnafMulAdd=function(v,c,i,r,s){var l,e,p,t=this._wnafT1,n=this._wnafT2,o=this._wnafT3,h=0;for(l=0;l<r;l++){var b=(p=c[l])._getNAFPoints(v);t[l]=b.wnd,n[l]=b.points}for(l=r-1;l>=1;l-=2){var y=l-1,w=l;if(1===t[y]&&1===t[w]){var x=[c[y],null,null,c[w]];0===c[y].y.cmp(c[w].y)?(x[1]=c[y].add(c[w]),x[2]=c[y].toJ().mixedAdd(c[w].neg())):0===c[y].y.cmp(c[w].y.redNeg())?(x[1]=c[y].toJ().mixedAdd(c[w]),x[2]=c[y].add(c[w].neg())):(x[1]=c[y].toJ().mixedAdd(c[w]),x[2]=c[y].toJ().mixedAdd(c[w].neg()));var B=[-3,-1,-5,-7,0,7,5,1,3],J=_(i[y],i[w]);for(h=Math.max(J[0].length,h),o[y]=new Array(h),o[w]=new Array(h),e=0;e<h;e++)o[y][e]=B[3*(1+(0|J[0][e]))+(1+(0|J[1][e]))],o[w][e]=0,n[y]=x}else o[y]=E(i[y],t[y],this._bitLength),o[w]=E(i[w],t[w],this._bitLength),h=Math.max(o[y].length,h),h=Math.max(o[w].length,h)}var L=this.jpoint(null,null,null),j=this._wnafT4;for(l=h;l>=0;l--){for(var C=0;l>=0;){var F=!0;for(e=0;e<r;e++)j[e]=0|o[e][l],0!==j[e]&&(F=!1);if(!F)break;C++,l--}if(l>=0&&C++,L=L.dblp(C),l<0)break;for(e=0;e<r;e++){var V=j[e];0!==V&&(V>0?p=n[e][V-1>>1]:V<0&&(p=n[e][-V-1>>1].neg()),L="affine"===p.type?L.mixedAdd(p):L.add(p))}}for(l=0;l<r;l++)n[l]=null;return s?L:L.toP()},u.BasePoint=g,g.prototype.eq=function(){throw new Error("Not implemented")},g.prototype.validate=function(){return this.curve.validate(this)},u.prototype.decodePoint=function(v,c){v=I.toArray(v,c);var i=this.p.byteLength();if((4===v[0]||6===v[0]||7===v[0])&&v.length-1==2*i)return 6===v[0]?d(v[v.length-1]%2==0):7===v[0]&&d(v[v.length-1]%2==1),this.point(v.slice(1,1+i),v.slice(1+i,1+2*i));if((2===v[0]||3===v[0])&&v.length-1===i)return this.pointFromX(v.slice(1,1+i),3===v[0]);throw new Error("Unknown point format")},g.prototype.encodeCompressed=function(v){return this.encode(v,!0)},g.prototype._encode=function(v){var c=this.curve.p.byteLength(),i=this.getX().toArray("be",c);return v?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",c))},g.prototype.encode=function(v,c){return I.encode(this._encode(c),v)},g.prototype.precompute=function(v){if(this.precomputed)return this;var c={doubles:null,naf:null,beta:null};return c.naf=this._getNAFPoints(8),c.doubles=this._getDoubles(4,v),c.beta=this._getBeta(),this.precomputed=c,this},g.prototype._hasDoubles=function(v){if(!this.precomputed)return!1;var c=this.precomputed.doubles;return!!c&&c.points.length>=Math.ceil((v.bitLength()+1)/c.step)},g.prototype._getDoubles=function(v,c){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],r=this,s=0;s<c;s+=v){for(var t=0;t<v;t++)r=r.dbl();i.push(r)}return{step:v,points:i}},g.prototype._getNAFPoints=function(v){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var c=[this],i=(1<<v)-1,r=1===i?null:this.dbl(),s=1;s<i;s++)c[s]=c[s-1].add(r);return{wnd:v,points:c}},g.prototype._getBeta=function(){return null},g.prototype.dblp=function(v){for(var c=this,i=0;i<v;i++)c=c.dbl();return c}},{"../utils":103,"bn.js":18}],91:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("bn.js"),E=m("inherits"),_=m("./base"),d=R.assert;function u(f){this.twisted=1!=(0|f.a),this.mOneA=this.twisted&&-1==(0|f.a),this.extended=this.mOneA,_.call(this,"edwards",f),this.a=new I(f.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new I(f.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new I(f.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),d(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|f.c)}function g(f,v,c,i,r){_.BasePoint.call(this,f,"projective"),null===v&&null===c&&null===i?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new I(v,16),this.y=new I(c,16),this.z=i?new I(i,16):this.curve.one,this.t=r&&new I(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}E(u,_),ie.exports=u,u.prototype._mulA=function(v){return this.mOneA?v.redNeg():this.a.redMul(v)},u.prototype._mulC=function(v){return this.oneC?v:this.c.redMul(v)},u.prototype.jpoint=function(v,c,i,r){return this.point(v,c,i,r)},u.prototype.pointFromX=function(v,c){(v=new I(v,16)).red||(v=v.toRed(this.red));var i=v.redSqr(),r=this.c2.redSub(this.a.redMul(i)),s=this.one.redSub(this.c2.redMul(this.d).redMul(i)),t=r.redMul(s.redInvm()),n=t.redSqrt();if(0!==n.redSqr().redSub(t).cmp(this.zero))throw new Error("invalid point");var o=n.fromRed().isOdd();return(c&&!o||!c&&o)&&(n=n.redNeg()),this.point(v,n)},u.prototype.pointFromY=function(v,c){(v=new I(v,16)).red||(v=v.toRed(this.red));var i=v.redSqr(),r=i.redSub(this.c2),s=i.redMul(this.d).redMul(this.c2).redSub(this.a),t=r.redMul(s.redInvm());if(0===t.cmp(this.zero)){if(c)throw new Error("invalid point");return this.point(this.zero,v)}var n=t.redSqrt();if(0!==n.redSqr().redSub(t).cmp(this.zero))throw new Error("invalid point");return n.fromRed().isOdd()!==c&&(n=n.redNeg()),this.point(n,v)},u.prototype.validate=function(v){if(v.isInfinity())return!0;v.normalize();var c=v.x.redSqr(),i=v.y.redSqr(),r=c.redMul(this.a).redAdd(i),s=this.c2.redMul(this.one.redAdd(this.d.redMul(c).redMul(i)));return 0===r.cmp(s)},E(g,_.BasePoint),u.prototype.pointFromJSON=function(v){return g.fromJSON(this,v)},u.prototype.point=function(v,c,i,r){return new g(this,v,c,i,r)},g.fromJSON=function(v,c){return new g(v,c[0],c[1],c[2])},g.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},g.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},g.prototype._extDbl=function(){var v=this.x.redSqr(),c=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var r=this.curve._mulA(v),s=this.x.redAdd(this.y).redSqr().redISub(v).redISub(c),t=r.redAdd(c),n=t.redSub(i),o=r.redSub(c),h=s.redMul(n),l=t.redMul(o),e=s.redMul(o),p=n.redMul(t);return this.curve.point(h,l,p,e)},g.prototype._projDbl=function(){var r,s,t,n,o,h,v=this.x.redAdd(this.y).redSqr(),c=this.x.redSqr(),i=this.y.redSqr();if(this.curve.twisted){var l=(n=this.curve._mulA(c)).redAdd(i);this.zOne?(r=v.redSub(c).redSub(i).redMul(l.redSub(this.curve.two)),s=l.redMul(n.redSub(i)),t=l.redSqr().redSub(l).redSub(l)):(o=this.z.redSqr(),h=l.redSub(o).redISub(o),r=v.redSub(c).redISub(i).redMul(h),s=l.redMul(n.redSub(i)),t=l.redMul(h))}else n=c.redAdd(i),o=this.curve._mulC(this.z).redSqr(),h=n.redSub(o).redSub(o),r=this.curve._mulC(v.redISub(n)).redMul(h),s=this.curve._mulC(n).redMul(c.redISub(i)),t=n.redMul(h);return this.curve.point(r,s,t)},g.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},g.prototype._extAdd=function(v){var c=this.y.redSub(this.x).redMul(v.y.redSub(v.x)),i=this.y.redAdd(this.x).redMul(v.y.redAdd(v.x)),r=this.t.redMul(this.curve.dd).redMul(v.t),s=this.z.redMul(v.z.redAdd(v.z)),t=i.redSub(c),n=s.redSub(r),o=s.redAdd(r),h=i.redAdd(c),l=t.redMul(n),e=o.redMul(h),p=t.redMul(h),b=n.redMul(o);return this.curve.point(l,e,b,p)},g.prototype._projAdd=function(v){var e,p,c=this.z.redMul(v.z),i=c.redSqr(),r=this.x.redMul(v.x),s=this.y.redMul(v.y),t=this.curve.d.redMul(r).redMul(s),n=i.redSub(t),o=i.redAdd(t),h=this.x.redAdd(this.y).redMul(v.x.redAdd(v.y)).redISub(r).redISub(s),l=c.redMul(n).redMul(h);return this.curve.twisted?(e=c.redMul(o).redMul(s.redSub(this.curve._mulA(r))),p=n.redMul(o)):(e=c.redMul(o).redMul(s.redSub(r)),p=this.curve._mulC(n).redMul(o)),this.curve.point(l,e,p)},g.prototype.add=function(v){return this.isInfinity()?v:v.isInfinity()?this:this.curve.extended?this._extAdd(v):this._projAdd(v)},g.prototype.mul=function(v){return this._hasDoubles(v)?this.curve._fixedNafMul(this,v):this.curve._wnafMul(this,v)},g.prototype.mulAdd=function(v,c,i){return this.curve._wnafMulAdd(1,[this,c],[v,i],2,!1)},g.prototype.jmulAdd=function(v,c,i){return this.curve._wnafMulAdd(1,[this,c],[v,i],2,!0)},g.prototype.normalize=function(){if(this.zOne)return this;var v=this.z.redInvm();return this.x=this.x.redMul(v),this.y=this.y.redMul(v),this.t&&(this.t=this.t.redMul(v)),this.z=this.curve.one,this.zOne=!0,this},g.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},g.prototype.getX=function(){return this.normalize(),this.x.fromRed()},g.prototype.getY=function(){return this.normalize(),this.y.fromRed()},g.prototype.eq=function(v){return this===v||0===this.getX().cmp(v.getX())&&0===this.getY().cmp(v.getY())},g.prototype.eqXToP=function(v){var c=v.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(c))return!0;for(var i=v.clone(),r=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(c.redIAdd(r),0===this.x.cmp(c))return!0}},g.prototype.toP=g.prototype.normalize,g.prototype.mixedAdd=g.prototype.add},{"../utils":103,"./base":90,"bn.js":18,inherits:146}],92:[function(m,ie,a){"use strict";var R=a;R.base=m("./base"),R.short=m("./short"),R.mont=m("./mont"),R.edwards=m("./edwards")},{"./base":90,"./edwards":91,"./mont":93,"./short":94}],93:[function(m,ie,a){"use strict";var R=m("bn.js"),I=m("inherits"),E=m("./base"),_=m("../utils");function d(g){E.call(this,"mont",g),this.a=new R(g.a,16).toRed(this.red),this.b=new R(g.b,16).toRed(this.red),this.i4=new R(4).toRed(this.red).redInvm(),this.two=new R(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function u(g,f,v){E.BasePoint.call(this,g,"projective"),null===f&&null===v?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new R(f,16),this.z=new R(v,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}I(d,E),ie.exports=d,d.prototype.validate=function(f){var v=f.normalize().x,c=v.redSqr(),i=c.redMul(v).redAdd(c.redMul(this.a)).redAdd(v);return 0===i.redSqrt().redSqr().cmp(i)},I(u,E.BasePoint),d.prototype.decodePoint=function(f,v){return this.point(_.toArray(f,v),1)},d.prototype.point=function(f,v){return new u(this,f,v)},d.prototype.pointFromJSON=function(f){return u.fromJSON(this,f)},u.prototype.precompute=function(){},u.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},u.fromJSON=function(f,v){return new u(f,v[0],v[1]||f.one)},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},u.prototype.dbl=function(){var v=this.x.redAdd(this.z).redSqr(),i=this.x.redSub(this.z).redSqr(),r=v.redSub(i),s=v.redMul(i),t=r.redMul(i.redAdd(this.curve.a24.redMul(r)));return this.curve.point(s,t)},u.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.diffAdd=function(f,v){var c=this.x.redAdd(this.z),i=this.x.redSub(this.z),r=f.x.redAdd(f.z),t=f.x.redSub(f.z).redMul(c),n=r.redMul(i),o=v.z.redMul(t.redAdd(n).redSqr()),h=v.x.redMul(t.redISub(n).redSqr());return this.curve.point(o,h)},u.prototype.mul=function(f){for(var v=f.clone(),c=this,i=this.curve.point(null,null),s=[];0!==v.cmpn(0);v.iushrn(1))s.push(v.andln(1));for(var t=s.length-1;t>=0;t--)0===s[t]?(c=c.diffAdd(i,this),i=i.dbl()):(i=c.diffAdd(i,this),c=c.dbl());return i},u.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.eq=function(f){return 0===this.getX().cmp(f.getX())},u.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},u.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},{"../utils":103,"./base":90,"bn.js":18,inherits:146}],94:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("bn.js"),E=m("inherits"),_=m("./base"),d=R.assert;function u(v){_.call(this,"short",v),this.a=new I(v.a,16).toRed(this.red),this.b=new I(v.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(v),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function g(v,c,i,r){_.BasePoint.call(this,v,"affine"),null===c&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new I(c,16),this.y=new I(i,16),r&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function f(v,c,i,r){_.BasePoint.call(this,v,"jacobian"),null===c&&null===i&&null===r?(this.x=this.curve.one,this.y=this.curve.one,this.z=new I(0)):(this.x=new I(c,16),this.y=new I(i,16),this.z=new I(r,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}E(u,_),ie.exports=u,u.prototype._getEndomorphism=function(c){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var i,r;if(c.beta)i=new I(c.beta,16).toRed(this.red);else{var s=this._getEndoRoots(this.p);i=(i=s[0].cmp(s[1])<0?s[0]:s[1]).toRed(this.red)}if(c.lambda)r=new I(c.lambda,16);else{var t=this._getEndoRoots(this.n);0===this.g.mul(t[0]).x.cmp(this.g.x.redMul(i))?r=t[0]:d(0===this.g.mul(r=t[1]).x.cmp(this.g.x.redMul(i)))}return{beta:i,lambda:r,basis:c.basis?c.basis.map(function(o){return{a:new I(o.a,16),b:new I(o.b,16)}}):this._getEndoBasis(r)}}},u.prototype._getEndoRoots=function(c){var i=c===this.p?this.red:I.mont(c),r=new I(2).toRed(i).redInvm(),s=r.redNeg(),t=new I(3).toRed(i).redNeg().redSqrt().redMul(r);return[s.redAdd(t).fromRed(),s.redSub(t).fromRed()]},u.prototype._getEndoBasis=function(c){for(var l,e,p,b,y,w,x,J,z,i=this.n.ushrn(Math.floor(this.n.bitLength()/2)),r=c,s=this.n.clone(),t=new I(1),n=new I(0),o=new I(0),h=new I(1),B=0;0!==r.cmpn(0);){var M=s.div(r);J=s.sub(M.mul(r)),z=o.sub(M.mul(t));var L=h.sub(M.mul(n));if(!p&&J.cmp(i)<0)l=x.neg(),e=t,p=J.neg(),b=z;else if(p&&2==++B)break;x=J,s=r,r=J,o=t,t=z,h=n,n=L}y=J.neg(),w=z;var j=p.sqr().add(b.sqr());return y.sqr().add(w.sqr()).cmp(j)>=0&&(y=l,w=e),p.negative&&(p=p.neg(),b=b.neg()),y.negative&&(y=y.neg(),w=w.neg()),[{a:p,b},{a:y,b:w}]},u.prototype._endoSplit=function(c){var i=this.endo.basis,r=i[0],s=i[1],t=s.b.mul(c).divRound(this.n),n=r.b.neg().mul(c).divRound(this.n),o=t.mul(r.a),h=n.mul(s.a),l=t.mul(r.b),e=n.mul(s.b);return{k1:c.sub(o).sub(h),k2:l.add(e).neg()}},u.prototype.pointFromX=function(c,i){(c=new I(c,16)).red||(c=c.toRed(this.red));var r=c.redSqr().redMul(c).redIAdd(c.redMul(this.a)).redIAdd(this.b),s=r.redSqrt();if(0!==s.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var t=s.fromRed().isOdd();return(i&&!t||!i&&t)&&(s=s.redNeg()),this.point(c,s)},u.prototype.validate=function(c){if(c.inf)return!0;var i=c.x,r=c.y,s=this.a.redMul(i),t=i.redSqr().redMul(i).redIAdd(s).redIAdd(this.b);return 0===r.redSqr().redISub(t).cmpn(0)},u.prototype._endoWnafMulAdd=function(c,i,r){for(var s=this._endoWnafT1,t=this._endoWnafT2,n=0;n<c.length;n++){var o=this._endoSplit(i[n]),h=c[n],l=h._getBeta();o.k1.negative&&(o.k1.ineg(),h=h.neg(!0)),o.k2.negative&&(o.k2.ineg(),l=l.neg(!0)),s[2*n]=h,s[2*n+1]=l,t[2*n]=o.k1,t[2*n+1]=o.k2}for(var e=this._wnafMulAdd(1,s,t,2*n,r),p=0;p<2*n;p++)s[p]=null,t[p]=null;return e},E(g,_.BasePoint),u.prototype.point=function(c,i,r){return new g(this,c,i,r)},u.prototype.pointFromJSON=function(c,i){return g.fromJSON(this,c,i)},g.prototype._getBeta=function(){if(this.curve.endo){var c=this.precomputed;if(c&&c.beta)return c.beta;var i=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(c){var r=this.curve,s=function(t){return r.point(t.x.redMul(r.endo.beta),t.y)};c.beta=i,i.precomputed={beta:null,naf:c.naf&&{wnd:c.naf.wnd,points:c.naf.points.map(s)},doubles:c.doubles&&{step:c.doubles.step,points:c.doubles.points.map(s)}}}return i}},g.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},g.fromJSON=function(c,i,r){"string"==typeof i&&(i=JSON.parse(i));var s=c.point(i[0],i[1],r);if(!i[2])return s;function t(o){return c.point(o[0],o[1],r)}var n=i[2];return s.precomputed={beta:null,doubles:n.doubles&&{step:n.doubles.step,points:[s].concat(n.doubles.points.map(t))},naf:n.naf&&{wnd:n.naf.wnd,points:[s].concat(n.naf.points.map(t))}},s},g.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},g.prototype.isInfinity=function(){return this.inf},g.prototype.add=function(c){if(this.inf)return c;if(c.inf)return this;if(this.eq(c))return this.dbl();if(this.neg().eq(c))return this.curve.point(null,null);if(0===this.x.cmp(c.x))return this.curve.point(null,null);var i=this.y.redSub(c.y);0!==i.cmpn(0)&&(i=i.redMul(this.x.redSub(c.x).redInvm()));var r=i.redSqr().redISub(this.x).redISub(c.x),s=i.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,s)},g.prototype.dbl=function(){if(this.inf)return this;var c=this.y.redAdd(this.y);if(0===c.cmpn(0))return this.curve.point(null,null);var i=this.curve.a,r=this.x.redSqr(),s=c.redInvm(),t=r.redAdd(r).redIAdd(r).redIAdd(i).redMul(s),n=t.redSqr().redISub(this.x.redAdd(this.x)),o=t.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,o)},g.prototype.getX=function(){return this.x.fromRed()},g.prototype.getY=function(){return this.y.fromRed()},g.prototype.mul=function(c){return c=new I(c,16),this.isInfinity()?this:this._hasDoubles(c)?this.curve._fixedNafMul(this,c):this.curve.endo?this.curve._endoWnafMulAdd([this],[c]):this.curve._wnafMul(this,c)},g.prototype.mulAdd=function(c,i,r){var s=[this,i],t=[c,r];return this.curve.endo?this.curve._endoWnafMulAdd(s,t):this.curve._wnafMulAdd(1,s,t,2)},g.prototype.jmulAdd=function(c,i,r){var s=[this,i],t=[c,r];return this.curve.endo?this.curve._endoWnafMulAdd(s,t,!0):this.curve._wnafMulAdd(1,s,t,2,!0)},g.prototype.eq=function(c){return this===c||this.inf===c.inf&&(this.inf||0===this.x.cmp(c.x)&&0===this.y.cmp(c.y))},g.prototype.neg=function(c){if(this.inf)return this;var i=this.curve.point(this.x,this.y.redNeg());if(c&&this.precomputed){var r=this.precomputed,s=function(t){return t.neg()};i.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(s)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(s)}}}return i},g.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},E(f,_.BasePoint),u.prototype.jpoint=function(c,i,r){return new f(this,c,i,r)},f.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var c=this.z.redInvm(),i=c.redSqr(),r=this.x.redMul(i),s=this.y.redMul(i).redMul(c);return this.curve.point(r,s)},f.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},f.prototype.add=function(c){if(this.isInfinity())return c;if(c.isInfinity())return this;var i=c.z.redSqr(),r=this.z.redSqr(),s=this.x.redMul(i),t=c.x.redMul(r),n=this.y.redMul(i.redMul(c.z)),o=c.y.redMul(r.redMul(this.z)),h=s.redSub(t),l=n.redSub(o);if(0===h.cmpn(0))return 0!==l.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var e=h.redSqr(),p=e.redMul(h),b=s.redMul(e),y=l.redSqr().redIAdd(p).redISub(b).redISub(b),w=l.redMul(b.redISub(y)).redISub(n.redMul(p)),x=this.z.redMul(c.z).redMul(h);return this.curve.jpoint(y,w,x)},f.prototype.mixedAdd=function(c){if(this.isInfinity())return c.toJ();if(c.isInfinity())return this;var i=this.z.redSqr(),r=this.x,s=c.x.redMul(i),t=this.y,n=c.y.redMul(i).redMul(this.z),o=r.redSub(s),h=t.redSub(n);if(0===o.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var l=o.redSqr(),e=l.redMul(o),p=r.redMul(l),b=h.redSqr().redIAdd(e).redISub(p).redISub(p),y=h.redMul(p.redISub(b)).redISub(t.redMul(e)),w=this.z.redMul(o);return this.curve.jpoint(b,y,w)},f.prototype.dblp=function(c){if(0===c)return this;if(this.isInfinity())return this;if(!c)return this.dbl();var i;if(this.curve.zeroA||this.curve.threeA){var r=this;for(i=0;i<c;i++)r=r.dbl();return r}var s=this.curve.a,t=this.curve.tinv,n=this.x,o=this.y,h=this.z,l=h.redSqr().redSqr(),e=o.redAdd(o);for(i=0;i<c;i++){var p=n.redSqr(),b=e.redSqr(),y=b.redSqr(),w=p.redAdd(p).redIAdd(p).redIAdd(s.redMul(l)),x=n.redMul(b),B=w.redSqr().redISub(x.redAdd(x)),J=x.redISub(B),z=w.redMul(J);z=z.redIAdd(z).redISub(y);var M=e.redMul(h);i+1<c&&(l=l.redMul(y)),n=B,h=M,e=z}return this.curve.jpoint(n,e.redMul(t),h)},f.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},f.prototype._zeroDbl=function(){var c,i,r;if(this.zOne){var s=this.x.redSqr(),t=this.y.redSqr(),n=t.redSqr(),o=this.x.redAdd(t).redSqr().redISub(s).redISub(n);o=o.redIAdd(o);var h=s.redAdd(s).redIAdd(s),l=h.redSqr().redISub(o).redISub(o),e=n.redIAdd(n);e=(e=e.redIAdd(e)).redIAdd(e),c=l,i=h.redMul(o.redISub(l)).redISub(e),r=this.y.redAdd(this.y)}else{var p=this.x.redSqr(),b=this.y.redSqr(),y=b.redSqr(),w=this.x.redAdd(b).redSqr().redISub(p).redISub(y);w=w.redIAdd(w);var x=p.redAdd(p).redIAdd(p),B=x.redSqr(),J=y.redIAdd(y);J=(J=J.redIAdd(J)).redIAdd(J),c=B.redISub(w).redISub(w),i=x.redMul(w.redISub(c)).redISub(J),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(c,i,r)},f.prototype._threeDbl=function(){var c,i,r;if(this.zOne){var s=this.x.redSqr(),t=this.y.redSqr(),n=t.redSqr(),o=this.x.redAdd(t).redSqr().redISub(s).redISub(n);o=o.redIAdd(o);var h=s.redAdd(s).redIAdd(s).redIAdd(this.curve.a),l=h.redSqr().redISub(o).redISub(o);c=l;var e=n.redIAdd(n);e=(e=e.redIAdd(e)).redIAdd(e),i=h.redMul(o.redISub(l)).redISub(e),r=this.y.redAdd(this.y)}else{var p=this.z.redSqr(),b=this.y.redSqr(),y=this.x.redMul(b),w=this.x.redSub(p).redMul(this.x.redAdd(p));w=w.redAdd(w).redIAdd(w);var x=y.redIAdd(y),B=(x=x.redIAdd(x)).redAdd(x);c=w.redSqr().redISub(B),r=this.y.redAdd(this.z).redSqr().redISub(b).redISub(p);var J=b.redSqr();J=(J=(J=J.redIAdd(J)).redIAdd(J)).redIAdd(J),i=w.redMul(x.redISub(c)).redISub(J)}return this.curve.jpoint(c,i,r)},f.prototype._dbl=function(){var c=this.curve.a,i=this.x,r=this.y,s=this.z,t=s.redSqr().redSqr(),n=i.redSqr(),o=r.redSqr(),h=n.redAdd(n).redIAdd(n).redIAdd(c.redMul(t)),l=i.redAdd(i),e=(l=l.redIAdd(l)).redMul(o),p=h.redSqr().redISub(e.redAdd(e)),b=e.redISub(p),y=o.redSqr();y=(y=(y=y.redIAdd(y)).redIAdd(y)).redIAdd(y);var w=h.redMul(b).redISub(y),x=r.redAdd(r).redMul(s);return this.curve.jpoint(p,w,x)},f.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var c=this.x.redSqr(),i=this.y.redSqr(),r=this.z.redSqr(),s=i.redSqr(),t=c.redAdd(c).redIAdd(c),n=t.redSqr(),o=this.x.redAdd(i).redSqr().redISub(c).redISub(s),h=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(n)).redSqr(),l=s.redIAdd(s);l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var e=t.redIAdd(o).redSqr().redISub(n).redISub(h).redISub(l),p=i.redMul(e);p=(p=p.redIAdd(p)).redIAdd(p);var b=this.x.redMul(h).redISub(p);b=(b=b.redIAdd(b)).redIAdd(b);var y=this.y.redMul(e.redMul(l.redISub(e)).redISub(o.redMul(h)));y=(y=(y=y.redIAdd(y)).redIAdd(y)).redIAdd(y);var w=this.z.redAdd(o).redSqr().redISub(r).redISub(h);return this.curve.jpoint(b,y,w)},f.prototype.mul=function(c,i){return c=new I(c,i),this.curve._wnafMul(this,c)},f.prototype.eq=function(c){if("affine"===c.type)return this.eq(c.toJ());if(this===c)return!0;var i=this.z.redSqr(),r=c.z.redSqr();if(0!==this.x.redMul(r).redISub(c.x.redMul(i)).cmpn(0))return!1;var s=i.redMul(this.z),t=r.redMul(c.z);return 0===this.y.redMul(t).redISub(c.y.redMul(s)).cmpn(0)},f.prototype.eqXToP=function(c){var i=this.z.redSqr(),r=c.toRed(this.curve.red).redMul(i);if(0===this.x.cmp(r))return!0;for(var s=c.clone(),t=this.curve.redN.redMul(i);;){if(s.iadd(this.curve.n),s.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(t),0===this.x.cmp(r))return!0}},f.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},f.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},{"../utils":103,"./base":90,"bn.js":18,inherits:146}],95:[function(m,ie,a){"use strict";var f,R=a,I=m("hash.js"),E=m("./curve"),d=m("./utils").assert;function u(v){this.curve="short"===v.type?new E.short(v):"edwards"===v.type?new E.edwards(v):new E.mont(v),this.g=this.curve.g,this.n=this.curve.n,this.hash=v.hash,d(this.g.validate(),"Invalid curve"),d(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function g(v,c){Object.defineProperty(R,v,{configurable:!0,enumerable:!0,get:function(){var i=new u(c);return Object.defineProperty(R,v,{configurable:!0,enumerable:!0,value:i}),i}})}R.PresetCurve=u,g("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:I.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),g("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:I.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),g("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:I.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),g("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:I.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),g("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:I.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),g("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:I.sha256,gRed:!1,g:["9"]}),g("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:I.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{f=m("./precomputed/secp256k1")}catch{f=void 0}g("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:I.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",f]})},{"./curve":92,"./precomputed/secp256k1":102,"./utils":103,"hash.js":132}],96:[function(m,ie,a){"use strict";var R=m("bn.js"),I=m("hmac-drbg"),E=m("../utils"),_=m("../curves"),d=m("brorand"),u=E.assert,g=m("./key"),f=m("./signature");function v(c){if(!(this instanceof v))return new v(c);"string"==typeof c&&(u(Object.prototype.hasOwnProperty.call(_,c),"Unknown curve "+c),c=_[c]),c instanceof _.PresetCurve&&(c={curve:c}),this.curve=c.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=c.curve.g,this.g.precompute(c.curve.n.bitLength()+1),this.hash=c.hash||c.curve.hash}ie.exports=v,v.prototype.keyPair=function(i){return new g(this,i)},v.prototype.keyFromPrivate=function(i,r){return g.fromPrivate(this,i,r)},v.prototype.keyFromPublic=function(i,r){return g.fromPublic(this,i,r)},v.prototype.genKeyPair=function(i){i||(i={});for(var r=new I({hash:this.hash,pers:i.pers,persEnc:i.persEnc||"utf8",entropy:i.entropy||d(this.hash.hmacStrength),entropyEnc:i.entropy&&i.entropyEnc||"utf8",nonce:this.n.toArray()}),s=this.n.byteLength(),t=this.n.sub(new R(2));;){var n=new R(r.generate(s));if(!(n.cmp(t)>0))return n.iaddn(1),this.keyFromPrivate(n)}},v.prototype._truncateToN=function(i,r){var s=8*i.byteLength()-this.n.bitLength();return s>0&&(i=i.ushrn(s)),!r&&i.cmp(this.n)>=0?i.sub(this.n):i},v.prototype.sign=function(i,r,s,t){"object"==typeof s&&(t=s,s=null),t||(t={}),r=this.keyFromPrivate(r,s),i=this._truncateToN(new R(i,16));for(var n=this.n.byteLength(),o=r.getPrivate().toArray("be",n),h=i.toArray("be",n),l=new I({hash:this.hash,entropy:o,nonce:h,pers:t.pers,persEnc:t.persEnc||"utf8"}),e=this.n.sub(new R(1)),p=0;;p++){var b=t.k?t.k(p):new R(l.generate(this.n.byteLength()));if(!((b=this._truncateToN(b,!0)).cmpn(1)<=0||b.cmp(e)>=0)){var y=this.g.mul(b);if(!y.isInfinity()){var w=y.getX(),x=w.umod(this.n);if(0!==x.cmpn(0)){var B=b.invm(this.n).mul(x.mul(r.getPrivate()).iadd(i));if(0!==(B=B.umod(this.n)).cmpn(0)){var J=(y.getY().isOdd()?1:0)|(0!==w.cmp(x)?2:0);return t.canonical&&B.cmp(this.nh)>0&&(B=this.n.sub(B),J^=1),new f({r:x,s:B,recoveryParam:J})}}}}}},v.prototype.verify=function(i,r,s,t){i=this._truncateToN(new R(i,16)),s=this.keyFromPublic(s,t);var n=(r=new f(r,"hex")).r,o=r.s;if(n.cmpn(1)<0||n.cmp(this.n)>=0||o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var p,h=o.invm(this.n),l=h.mul(i).umod(this.n),e=h.mul(n).umod(this.n);return this.curve._maxwellTrick?!(p=this.g.jmulAdd(l,s.getPublic(),e)).isInfinity()&&p.eqXToP(n):!(p=this.g.mulAdd(l,s.getPublic(),e)).isInfinity()&&0===p.getX().umod(this.n).cmp(n)},v.prototype.recoverPubKey=function(c,i,r,s){u((3&r)===r,"The recovery param is more than two bits"),i=new f(i,s);var t=this.n,n=new R(c),o=i.r,h=i.s,l=1&r,e=r>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&e)throw new Error("Unable to find sencond key candinate");o=this.curve.pointFromX(e?o.add(this.curve.n):o,l);var p=i.r.invm(t),b=t.sub(n).mul(p).umod(t),y=h.mul(p).umod(t);return this.g.mulAdd(b,o,y)},v.prototype.getKeyRecoveryParam=function(c,i,r,s){if(null!==(i=new f(i,s)).recoveryParam)return i.recoveryParam;for(var t=0;t<4;t++){var n;try{n=this.recoverPubKey(c,i,t)}catch{continue}if(n.eq(r))return t}throw new Error("Unable to find valid recovery factor")}},{"../curves":95,"../utils":103,"./key":97,"./signature":98,"bn.js":18,brorand:19,"hmac-drbg":144}],97:[function(m,ie,a){"use strict";var R=m("bn.js"),E=m("../utils").assert;function _(d,u){this.ec=d,this.priv=null,this.pub=null,u.priv&&this._importPrivate(u.priv,u.privEnc),u.pub&&this._importPublic(u.pub,u.pubEnc)}ie.exports=_,_.fromPublic=function(u,g,f){return g instanceof _?g:new _(u,{pub:g,pubEnc:f})},_.fromPrivate=function(u,g,f){return g instanceof _?g:new _(u,{priv:g,privEnc:f})},_.prototype.validate=function(){var u=this.getPublic();return u.isInfinity()?{result:!1,reason:"Invalid public key"}:u.validate()?u.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},_.prototype.getPublic=function(u,g){return"string"==typeof u&&(g=u,u=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),g?this.pub.encode(g,u):this.pub},_.prototype.getPrivate=function(u){return"hex"===u?this.priv.toString(16,2):this.priv},_.prototype._importPrivate=function(u,g){this.priv=new R(u,g||16),this.priv=this.priv.umod(this.ec.curve.n)},_.prototype._importPublic=function(u,g){if(u.x||u.y)return"mont"===this.ec.curve.type?E(u.x,"Need x coordinate"):("short"===this.ec.curve.type||"edwards"===this.ec.curve.type)&&E(u.x&&u.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(u.x,u.y));this.pub=this.ec.curve.decodePoint(u,g)},_.prototype.derive=function(u){return u.validate()||E(u.validate(),"public point not validated"),u.mul(this.priv).getX()},_.prototype.sign=function(u,g,f){return this.ec.sign(u,this,g,f)},_.prototype.verify=function(u,g){return this.ec.verify(u,g,this)},_.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},{"../utils":103,"bn.js":18}],98:[function(m,ie,a){"use strict";var R=m("bn.js"),I=m("../utils"),E=I.assert;function _(v,c){if(v instanceof _)return v;this._importDER(v,c)||(E(v.r&&v.s,"Signature without r or s"),this.r=new R(v.r,16),this.s=new R(v.s,16),this.recoveryParam=void 0===v.recoveryParam?null:v.recoveryParam)}function d(){this.place=0}function u(v,c){var i=v[c.place++];if(!(128&i))return i;var r=15&i;if(0===r||r>4)return!1;for(var s=0,t=0,n=c.place;t<r;t++,n++)s<<=8,s|=v[n],s>>>=0;return!(s<=127)&&(c.place=n,s)}function g(v){for(var c=0,i=v.length-1;!v[c]&&!(128&v[c+1])&&c<i;)c++;return 0===c?v:v.slice(c)}function f(v,c){if(c<128)v.push(c);else{var i=1+(Math.log(c)/Math.LN2>>>3);for(v.push(128|i);--i;)v.push(c>>>(i<<3)&255);v.push(c)}}ie.exports=_,_.prototype._importDER=function(c,i){c=I.toArray(c,i);var r=new d;if(48!==c[r.place++])return!1;var s=u(c,r);if(!1===s||s+r.place!==c.length||2!==c[r.place++])return!1;var t=u(c,r);if(!1===t)return!1;var n=c.slice(r.place,t+r.place);if(r.place+=t,2!==c[r.place++])return!1;var o=u(c,r);if(!1===o||c.length!==o+r.place)return!1;var h=c.slice(r.place,o+r.place);if(0===n[0]){if(!(128&n[1]))return!1;n=n.slice(1)}if(0===h[0]){if(!(128&h[1]))return!1;h=h.slice(1)}return this.r=new R(n),this.s=new R(h),this.recoveryParam=null,!0},_.prototype.toDER=function(c){var i=this.r.toArray(),r=this.s.toArray();for(128&i[0]&&(i=[0].concat(i)),128&r[0]&&(r=[0].concat(r)),i=g(i),r=g(r);!(r[0]||128&r[1]);)r=r.slice(1);var s=[2];f(s,i.length),(s=s.concat(i)).push(2),f(s,r.length);var t=s.concat(r),n=[48];return f(n,t.length),n=n.concat(t),I.encode(n,c)}},{"../utils":103,"bn.js":18}],99:[function(m,ie,a){"use strict";var R=m("hash.js"),I=m("../curves"),E=m("../utils"),_=E.assert,d=E.parseBytes,u=m("./key"),g=m("./signature");function f(v){if(_("ed25519"===v,"only tested with ed25519 so far"),!(this instanceof f))return new f(v);this.curve=v=I[v].curve,this.g=v.g,this.g.precompute(v.n.bitLength()+1),this.pointClass=v.point().constructor,this.encodingLength=Math.ceil(v.n.bitLength()/8),this.hash=R.sha512}ie.exports=f,f.prototype.sign=function(c,i){c=d(c);var r=this.keyFromSecret(i),s=this.hashInt(r.messagePrefix(),c),t=this.g.mul(s),n=this.encodePoint(t),o=this.hashInt(n,r.pubBytes(),c).mul(r.priv()),h=s.add(o).umod(this.curve.n);return this.makeSignature({R:t,S:h,Rencoded:n})},f.prototype.verify=function(c,i,r){c=d(c),i=this.makeSignature(i);var s=this.keyFromPublic(r),t=this.hashInt(i.Rencoded(),s.pubBytes(),c),n=this.g.mul(i.S());return i.R().add(s.pub().mul(t)).eq(n)},f.prototype.hashInt=function(){for(var c=this.hash(),i=0;i<arguments.length;i++)c.update(arguments[i]);return E.intFromLE(c.digest()).umod(this.curve.n)},f.prototype.keyFromPublic=function(c){return u.fromPublic(this,c)},f.prototype.keyFromSecret=function(c){return u.fromSecret(this,c)},f.prototype.makeSignature=function(c){return c instanceof g?c:new g(this,c)},f.prototype.encodePoint=function(c){var i=c.getY().toArray("le",this.encodingLength);return i[this.encodingLength-1]|=c.getX().isOdd()?128:0,i},f.prototype.decodePoint=function(c){var i=(c=E.parseBytes(c)).length-1,r=c.slice(0,i).concat(-129&c[i]),s=0!=(128&c[i]),t=E.intFromLE(r);return this.curve.pointFromY(t,s)},f.prototype.encodeInt=function(c){return c.toArray("le",this.encodingLength)},f.prototype.decodeInt=function(c){return E.intFromLE(c)},f.prototype.isPoint=function(c){return c instanceof this.pointClass}},{"../curves":95,"../utils":103,"./key":100,"./signature":101,"hash.js":132}],100:[function(m,ie,a){"use strict";var R=m("../utils"),I=R.assert,E=R.parseBytes,_=R.cachedProperty;function d(u,g){this.eddsa=u,this._secret=E(g.secret),u.isPoint(g.pub)?this._pub=g.pub:this._pubBytes=E(g.pub)}d.fromPublic=function(g,f){return f instanceof d?f:new d(g,{pub:f})},d.fromSecret=function(g,f){return f instanceof d?f:new d(g,{secret:f})},d.prototype.secret=function(){return this._secret},_(d,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),_(d,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),_(d,"privBytes",function(){var g=this.eddsa,f=this.hash(),v=g.encodingLength-1,c=f.slice(0,g.encodingLength);return c[0]&=248,c[v]&=127,c[v]|=64,c}),_(d,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),_(d,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),_(d,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),d.prototype.sign=function(g){return I(this._secret,"KeyPair can only verify"),this.eddsa.sign(g,this)},d.prototype.verify=function(g,f){return this.eddsa.verify(g,f,this)},d.prototype.getSecret=function(g){return I(this._secret,"KeyPair is public only"),R.encode(this.secret(),g)},d.prototype.getPublic=function(g){return R.encode(this.pubBytes(),g)},ie.exports=d},{"../utils":103}],101:[function(m,ie,a){"use strict";var R=m("bn.js"),I=m("../utils"),E=I.assert,_=I.cachedProperty,d=I.parseBytes;function u(g,f){this.eddsa=g,"object"!=typeof f&&(f=d(f)),Array.isArray(f)&&(f={R:f.slice(0,g.encodingLength),S:f.slice(g.encodingLength)}),E(f.R&&f.S,"Signature without R or S"),g.isPoint(f.R)&&(this._R=f.R),f.S instanceof R&&(this._S=f.S),this._Rencoded=Array.isArray(f.R)?f.R:f.Rencoded,this._Sencoded=Array.isArray(f.S)?f.S:f.Sencoded}_(u,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),_(u,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),_(u,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),_(u,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),u.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},u.prototype.toHex=function(){return I.encode(this.toBytes(),"hex").toUpperCase()},ie.exports=u},{"../utils":103,"bn.js":18}],102:[function(m,ie,a){ie.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},{}],103:[function(m,ie,a){"use strict";var R=a,I=m("bn.js"),E=m("minimalistic-assert"),_=m("minimalistic-crypto-utils");R.assert=E,R.toArray=_.toArray,R.zero2=_.zero2,R.toHex=_.toHex,R.encode=_.encode,R.getNAF=function d(c,i,r){var s=new Array(Math.max(c.bitLength(),r)+1);s.fill(0);for(var t=1<<i+1,n=c.clone(),o=0;o<s.length;o++){var h,l=n.andln(t-1);n.isOdd()?n.isubn(h=l>(t>>1)-1?(t>>1)-l:l):h=0,s[o]=h,n.iushrn(1)}return s},R.getJSF=function u(c,i){var r=[[],[]];c=c.clone(),i=i.clone();for(var n,s=0,t=0;c.cmpn(-s)>0||i.cmpn(-t)>0;){var l,e,o=c.andln(3)+s&3,h=i.andln(3)+t&3;3===o&&(o=-1),3===h&&(h=-1),l=1&o?3!=(n=c.andln(7)+s&7)&&5!==n||2!==h?o:-o:0,r[0].push(l),e=1&h?3!=(n=i.andln(7)+t&7)&&5!==n||2!==o?h:-h:0,r[1].push(e),2*s===l+1&&(s=1-s),2*t===e+1&&(t=1-t),c.iushrn(1),i.iushrn(1)}return r},R.cachedProperty=function g(c,i,r){var s="_"+i;c.prototype[i]=function(){return void 0!==this[s]?this[s]:this[s]=r.call(this)}},R.parseBytes=function f(c){return"string"==typeof c?R.toArray(c,"hex"):c},R.intFromLE=function v(c){return new I(c,"hex","le")}},{"bn.js":18,"minimalistic-assert":223,"minimalistic-crypto-utils":224}],104:[function(m,ie,a){ie.exports={name:"elliptic",version:"6.5.4",description:"EC cryptography",main:"lib/elliptic.js",files:["lib"],scripts:{lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository:{type:"git",url:"git@github.com:indutny/elliptic"},keywords:["EC","Elliptic","curve","Cryptography"],author:"Fedor Indutny <fedor@indutny.com>",license:"MIT",bugs:{url:"https://github.com/indutny/elliptic/issues"},homepage:"https://github.com/indutny/elliptic",devDependencies:{brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies:{"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"}}},{}],105:[function(m,ie,a){"use strict";var E,R="object"==typeof Reflect?Reflect:null,I=R&&"function"==typeof R.apply?R.apply:function(y,w,x){return Function.prototype.apply.call(y,w,x)};E=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var d=Number.isNaN||function(y){return y!=y};function u(){u.init.call(this)}ie.exports=u,ie.exports.once=function l(b,y){return new Promise(function(w,x){function B(z){b.removeListener(y,J),x(z)}function J(){"function"==typeof b.removeListener&&b.removeListener("error",B),w([].slice.call(arguments))}p(b,y,J,{once:!0}),"error"!==y&&function e(b,y,w){"function"==typeof b.on&&p(b,"error",y,w)}(b,B,{once:!0})})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var g=10;function f(b){if("function"!=typeof b)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}function v(b){return void 0===b._maxListeners?u.defaultMaxListeners:b._maxListeners}function c(b,y,w,x){var B,J,z;if(f(w),void 0===(J=b._events)?(J=b._events=Object.create(null),b._eventsCount=0):(void 0!==J.newListener&&(b.emit("newListener",y,w.listener?w.listener:w),J=b._events),z=J[y]),void 0===z)z=J[y]=w,++b._eventsCount;else if("function"==typeof z?z=J[y]=x?[w,z]:[z,w]:x?z.unshift(w):z.push(w),(B=v(b))>0&&z.length>B&&!z.warned){z.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=b,M.type=y,M.count=z.length,function _(b){console&&console.warn&&console.warn(b)}(M)}return b}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function r(b,y,w){var x={fired:!1,wrapFn:void 0,target:b,type:y,listener:w},B=i.bind(x);return B.listener=w,x.wrapFn=B,B}function s(b,y,w){var x=b._events;if(void 0===x)return[];var B=x[y];return void 0===B?[]:"function"==typeof B?w?[B.listener||B]:[B]:w?function h(b){for(var y=new Array(b.length),w=0;w<y.length;++w)y[w]=b[w].listener||b[w];return y}(B):n(B,B.length)}function t(b){var y=this._events;if(void 0!==y){var w=y[b];if("function"==typeof w)return 1;if(void 0!==w)return w.length}return 0}function n(b,y){for(var w=new Array(y),x=0;x<y;++x)w[x]=b[x];return w}function p(b,y,w,x){if("function"==typeof b.on)x.once?b.once(y,w):b.on(y,w);else{if("function"!=typeof b.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b);b.addEventListener(y,function B(J){x.once&&b.removeEventListener(y,B),w(J)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(b){if("number"!=typeof b||b<0||d(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");g=b}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(y){if("number"!=typeof y||y<0||d(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},u.prototype.getMaxListeners=function(){return v(this)},u.prototype.emit=function(y){for(var w=[],x=1;x<arguments.length;x++)w.push(arguments[x]);var B="error"===y,J=this._events;if(void 0!==J)B=B&&void 0===J.error;else if(!B)return!1;if(B){var z;if(w.length>0&&(z=w[0]),z instanceof Error)throw z;var M=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw M.context=z,M}var L=J[y];if(void 0===L)return!1;if("function"==typeof L)I(L,this,w);else{var j=L.length,C=n(L,j);for(x=0;x<j;++x)I(C[x],this,w)}return!0},u.prototype.on=u.prototype.addListener=function(y,w){return c(this,y,w,!1)},u.prototype.prependListener=function(y,w){return c(this,y,w,!0)},u.prototype.once=function(y,w){return f(w),this.on(y,r(this,y,w)),this},u.prototype.prependOnceListener=function(y,w){return f(w),this.prependListener(y,r(this,y,w)),this},u.prototype.off=u.prototype.removeListener=function(y,w){var x,B,J,z,M;if(f(w),void 0===(B=this._events))return this;if(void 0===(x=B[y]))return this;if(x===w||x.listener===w)0==--this._eventsCount?this._events=Object.create(null):(delete B[y],B.removeListener&&this.emit("removeListener",y,x.listener||w));else if("function"!=typeof x){for(J=-1,z=x.length-1;z>=0;z--)if(x[z]===w||x[z].listener===w){M=x[z].listener,J=z;break}if(J<0)return this;0===J?x.shift():function o(b,y){for(;y+1<b.length;y++)b[y]=b[y+1];b.pop()}(x,J),1===x.length&&(B[y]=x[0]),void 0!==B.removeListener&&this.emit("removeListener",y,M||w)}return this},u.prototype.removeAllListeners=function(y){var w,x,B;if(void 0===(x=this._events))return this;if(void 0===x.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==x[y]&&(0==--this._eventsCount?this._events=Object.create(null):delete x[y]),this;if(0===arguments.length){var z,J=Object.keys(x);for(B=0;B<J.length;++B)"removeListener"!==(z=J[B])&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(w=x[y]))this.removeListener(y,w);else if(void 0!==w)for(B=w.length-1;B>=0;B--)this.removeListener(y,w[B]);return this},u.prototype.listeners=function(y){return s(this,y,!0)},u.prototype.rawListeners=function(y){return s(this,y,!1)},u.listenerCount=function(b,y){return"function"==typeof b.listenerCount?b.listenerCount(y):t.call(b,y)},u.prototype.listenerCount=t,u.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},{}],106:[function(m,ie,a){var R=m("safe-buffer").Buffer,I=m("md5.js");ie.exports=function E(_,d,u,g){if(R.isBuffer(_)||(_=R.from(_,"binary")),d&&(R.isBuffer(d)||(d=R.from(d,"binary")),8!==d.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var f=u/8,v=R.alloc(f),c=R.alloc(g||0),i=R.alloc(0);f>0||g>0;){var r=new I;r.update(i),r.update(_),d&&r.update(d),i=r.digest();var s=0;if(f>0){var t=v.length-f;s=Math.min(f,i.length),i.copy(v,t,0,s),f-=s}if(s<i.length&&g>0){var n=c.length-g,o=Math.min(g,i.length-s);i.copy(c,n,s,s+o),g-=o}}return i.fill(0),{key:v,iv:c}}},{"md5.js":221,"safe-buffer":250}],107:[function(m,ie,a){"use strict";var R=m("is-callable"),I=Object.prototype.toString,E=Object.prototype.hasOwnProperty,_=function(v,c,i){for(var r=0,s=v.length;r<s;r++)E.call(v,r)&&(null==i?c(v[r],r,v):c.call(i,v[r],r,v))},d=function(v,c,i){for(var r=0,s=v.length;r<s;r++)null==i?c(v.charAt(r),r,v):c.call(i,v.charAt(r),r,v)},u=function(v,c,i){for(var r in v)E.call(v,r)&&(null==i?c(v[r],r,v):c.call(i,v[r],r,v))};ie.exports=function(v,c,i){if(!R(c))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),"[object Array]"===I.call(v)?_(v,c,r):"string"==typeof v?d(v,c,r):u(v,c,r)}},{"is-callable":148}],108:[function(m,ie,a){"use strict";var R="Function.prototype.bind called on incompatible ",I=Array.prototype.slice,E=Object.prototype.toString,_="[object Function]";ie.exports=function(u){var g=this;if("function"!=typeof g||E.call(g)!==_)throw new TypeError(R+g);for(var v,f=I.call(arguments,1),i=Math.max(0,g.length-f.length),r=[],s=0;s<i;s++)r.push("$"+s);if(v=Function("binder","return function ("+r.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof v){var n=g.apply(this,f.concat(I.call(arguments)));return Object(n)===n?n:this}return g.apply(u,f.concat(I.call(arguments)))}),g.prototype){var t=function(){};t.prototype=g.prototype,v.prototype=new t,t.prototype=null}return v}},{}],109:[function(m,ie,a){"use strict";var R=m("./implementation");ie.exports=Function.prototype.bind||R},{"./implementation":108}],110:[function(m,ie,a){"use strict";var R,I=SyntaxError,E=Function,_=TypeError,d=function(z){try{return E('"use strict"; return ('+z+").constructor;")()}catch{}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch{u=null}var g=function(){throw new _},f=u?function(){try{return g}catch{try{return u(arguments,"callee").get}catch{return g}}}():g,v=m("has-symbols")(),c=Object.getPrototypeOf||function(z){return z.__proto__},i={},r=typeof Uint8Array>"u"?R:c(Uint8Array),s={"%AggregateError%":typeof AggregateError>"u"?R:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?R:ArrayBuffer,"%ArrayIteratorPrototype%":v?c([][Symbol.iterator]()):R,"%AsyncFromSyncIteratorPrototype%":R,"%AsyncFunction%":i,"%AsyncGenerator%":i,"%AsyncGeneratorFunction%":i,"%AsyncIteratorPrototype%":i,"%Atomics%":typeof Atomics>"u"?R:Atomics,"%BigInt%":typeof BigInt>"u"?R:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?R:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?R:Float32Array,"%Float64Array%":typeof Float64Array>"u"?R:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?R:FinalizationRegistry,"%Function%":E,"%GeneratorFunction%":i,"%Int8Array%":typeof Int8Array>"u"?R:Int8Array,"%Int16Array%":typeof Int16Array>"u"?R:Int16Array,"%Int32Array%":typeof Int32Array>"u"?R:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":v?c(c([][Symbol.iterator]())):R,"%JSON%":"object"==typeof JSON?JSON:R,"%Map%":typeof Map>"u"?R:Map,"%MapIteratorPrototype%":typeof Map>"u"||!v?R:c((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?R:Promise,"%Proxy%":typeof Proxy>"u"?R:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?R:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?R:Set,"%SetIteratorPrototype%":typeof Set>"u"||!v?R:c((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?R:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":v?c(""[Symbol.iterator]()):R,"%Symbol%":v?Symbol:R,"%SyntaxError%":I,"%ThrowTypeError%":f,"%TypedArray%":r,"%TypeError%":_,"%Uint8Array%":typeof Uint8Array>"u"?R:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?R:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?R:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?R:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?R:WeakMap,"%WeakRef%":typeof WeakRef>"u"?R:WeakRef,"%WeakSet%":typeof WeakSet>"u"?R:WeakSet},t=function z(M){var L;if("%AsyncFunction%"===M)L=d("async function () {}");else if("%GeneratorFunction%"===M)L=d("function* () {}");else if("%AsyncGeneratorFunction%"===M)L=d("async function* () {}");else if("%AsyncGenerator%"===M){var j=z("%AsyncGeneratorFunction%");j&&(L=j.prototype)}else if("%AsyncIteratorPrototype%"===M){var C=z("%AsyncGenerator%");C&&(L=c(C.prototype))}return s[M]=L,L},n={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},o=m("function-bind"),h=m("has"),l=o.call(Function.call,Array.prototype.concat),e=o.call(Function.apply,Array.prototype.splice),p=o.call(Function.call,String.prototype.replace),b=o.call(Function.call,String.prototype.slice),y=o.call(Function.call,RegExp.prototype.exec),w=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,x=/\\(\\)?/g,B=function(M){var L=b(M,0,1),j=b(M,-1);if("%"===L&&"%"!==j)throw new I("invalid intrinsic syntax, expected closing `%`");if("%"===j&&"%"!==L)throw new I("invalid intrinsic syntax, expected opening `%`");var C=[];return p(M,w,function(F,V,N,T){C[C.length]=N?p(T,x,"$1"):V||F}),C},J=function(M,L){var C,j=M;if(h(n,j)&&(j="%"+(C=n[j])[0]+"%"),h(s,j)){var F=s[j];if(F===i&&(F=t(j)),typeof F>"u"&&!L)throw new _("intrinsic "+M+" exists, but is not available. Please file an issue!");return{alias:C,name:j,value:F}}throw new I("intrinsic "+M+" does not exist!")};ie.exports=function(M,L){if("string"!=typeof M||0===M.length)throw new _("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof L)throw new _('"allowMissing" argument must be a boolean');if(null===y(/^%?[^%]*%?$/,M))throw new I("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var j=B(M),C=j.length>0?j[0]:"",F=J("%"+C+"%",L),V=F.name,N=F.value,T=!1,S=F.alias;S&&(C=S[0],e(j,l([0,1],S)));for(var U=1,W=!0;U<j.length;U+=1){var k=j[U],D=b(k,0,1),Q=b(k,-1);if(('"'===D||"'"===D||"`"===D||'"'===Q||"'"===Q||"`"===Q)&&D!==Q)throw new I("property names with quotes must have matching quotes");if(("constructor"===k||!W)&&(T=!0),h(s,V="%"+(C+="."+k)+"%"))N=s[V];else if(null!=N){if(!(k in N)){if(!L)throw new _("base intrinsic for "+M+" exists, but the property is not available.");return}if(u&&U+1>=j.length){var ee=u(N,k);N=(W=!!ee)&&"get"in ee&&!("originalValue"in ee.get)?ee.get:N[k]}else W=h(N,k),N=N[k];W&&!T&&(s[V]=N)}}return N}},{"function-bind":109,has:115,"has-symbols":112}],111:[function(m,ie,a){"use strict";var I=m("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(I)try{I([],"length")}catch{I=null}ie.exports=I},{"get-intrinsic":110}],112:[function(m,ie,a){"use strict";var R=typeof Symbol<"u"&&Symbol,I=m("./shams");ie.exports=function(){return"function"==typeof R&&"function"==typeof Symbol&&"symbol"==typeof R("foo")&&"symbol"==typeof Symbol("bar")&&I()}},{"./shams":113}],113:[function(m,ie,a){"use strict";ie.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var I={},E=Symbol("test"),_=Object(E);if("string"==typeof E||"[object Symbol]"!==Object.prototype.toString.call(E)||"[object Symbol]"!==Object.prototype.toString.call(_))return!1;for(E in I[E]=42,I)return!1;if("function"==typeof Object.keys&&0!==Object.keys(I).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(I).length)return!1;var u=Object.getOwnPropertySymbols(I);if(1!==u.length||u[0]!==E||!Object.prototype.propertyIsEnumerable.call(I,E))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var g=Object.getOwnPropertyDescriptor(I,E);if(42!==g.value||!0!==g.enumerable)return!1}return!0}},{}],114:[function(m,ie,a){"use strict";var R=m("has-symbols/shams");ie.exports=function(){return R()&&!!Symbol.toStringTag}},{"has-symbols/shams":113}],115:[function(m,ie,a){"use strict";var R=m("function-bind");ie.exports=R.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":109}],116:[function(m,ie,a){"use strict";var R=m("safe-buffer").Buffer,I=m("readable-stream").Transform;function d(u){I.call(this),this._block=R.allocUnsafe(u),this._blockSize=u,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}m("inherits")(d,I),d.prototype._transform=function(u,g,f){var v=null;try{this.update(u,g)}catch(c){v=c}f(v)},d.prototype._flush=function(u){var g=null;try{this.push(this.digest())}catch(f){g=f}u(g)},d.prototype.update=function(u,g){if(function _(u,g){if(!R.isBuffer(u)&&"string"!=typeof u)throw new TypeError(g+" must be a string or a buffer")}(u,"Data"),this._finalized)throw new Error("Digest already called");R.isBuffer(u)||(u=R.from(u,g));for(var f=this._block,v=0;this._blockOffset+u.length-v>=this._blockSize;){for(var c=this._blockOffset;c<this._blockSize;)f[c++]=u[v++];this._update(),this._blockOffset=0}for(;v<u.length;)f[this._blockOffset++]=u[v++];for(var i=0,r=8*u.length;r>0;++i)this._length[i]+=r,(r=this._length[i]/4294967296|0)>0&&(this._length[i]-=4294967296*r);return this},d.prototype._update=function(){throw new Error("_update is not implemented")},d.prototype.digest=function(u){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var g=this._digest();void 0!==u&&(g=g.toString(u)),this._block.fill(0),this._blockOffset=0;for(var f=0;f<4;++f)this._length[f]=0;return g},d.prototype._digest=function(){throw new Error("_digest is not implemented")},ie.exports=d},{inherits:146,"readable-stream":131,"safe-buffer":250}],117:[function(m,ie,a){arguments[4][50][0].apply(a,arguments)},{dup:50}],118:[function(m,ie,a){(function(R){(function(){"use strict";var I=Object.keys||function(i){var r=[];for(var s in i)r.push(s);return r};ie.exports=f;var E=m("./_stream_readable"),_=m("./_stream_writable");m("inherits")(f,E);for(var d=I(_.prototype),u=0;u<d.length;u++){var g=d[u];f.prototype[g]||(f.prototype[g]=_.prototype[g])}function f(i){if(!(this instanceof f))return new f(i);E.call(this,i),_.call(this,i),this.allowHalfOpen=!0,i&&(!1===i.readable&&(this.readable=!1),!1===i.writable&&(this.writable=!1),!1===i.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",v)))}function v(){this._writableState.ended||R.nextTick(c,this)}function c(i){i.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(r){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=r,this._writableState.destroyed=r)}})}).call(this)}).call(this,m("_process"))},{"./_stream_readable":120,"./_stream_writable":122,_process:237,inherits:146}],119:[function(m,ie,a){arguments[4][52][0].apply(a,arguments)},{"./_stream_transform":121,dup:52,inherits:146}],120:[function(m,ie,a){(function(R,I){(function(){"use strict";var E;ie.exports=L,L.ReadableState=M,m("events");var r,d=function(A,$){return A.listeners($).length},u=m("./internal/streams/stream"),g=m("buffer").Buffer,f=I.Uint8Array||function(){},i=m("util");r=i&&i.debuglog?i.debuglog("stream"):function(){};var y,w,x,s=m("./internal/streams/buffer_list"),t=m("./internal/streams/destroy"),o=m("./internal/streams/state").getHighWaterMark,h=m("../errors").codes,l=h.ERR_INVALID_ARG_TYPE,e=h.ERR_STREAM_PUSH_AFTER_EOF,p=h.ERR_METHOD_NOT_IMPLEMENTED,b=h.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;m("inherits")(L,u);var B=t.errorOrDestroy,J=["error","close","destroy","pause","resume"];function M(P,A,$){E=E||m("./_stream_duplex"),"boolean"!=typeof $&&($=A instanceof E),this.objectMode=!!(P=P||{}).objectMode,$&&(this.objectMode=this.objectMode||!!P.readableObjectMode),this.highWaterMark=o(this,P,"readableHighWaterMark",$),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==P.emitClose,this.autoDestroy=!!P.autoDestroy,this.destroyed=!1,this.defaultEncoding=P.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,P.encoding&&(y||(y=m("string_decoder/").StringDecoder),this.decoder=new y(P.encoding),this.encoding=P.encoding)}function L(P){if(E=E||m("./_stream_duplex"),!(this instanceof L))return new L(P);this._readableState=new M(P,this,this instanceof E),this.readable=!0,P&&("function"==typeof P.read&&(this._read=P.read),"function"==typeof P.destroy&&(this._destroy=P.destroy)),u.call(this)}function j(P,A,$,G,se){r("readableAddChunk",A);var pe,he=P._readableState;if(null===A)he.reading=!1,function S(P,A){if(r("onEofChunk"),!A.ended){if(A.decoder){var $=A.decoder.end();$&&$.length&&(A.buffer.push($),A.length+=A.objectMode?1:$.length)}A.ended=!0,A.sync?U(P):(A.needReadable=!1,A.emittedReadable||(A.emittedReadable=!0,W(P)))}}(P,he);else if(se||(pe=function F(P,A){var $;return!function c(P){return g.isBuffer(P)||P instanceof f}(A)&&"string"!=typeof A&&void 0!==A&&!P.objectMode&&($=new l("chunk",["string","Buffer","Uint8Array"],A)),$}(he,A)),pe)B(P,pe);else if(he.objectMode||A&&A.length>0)if("string"!=typeof A&&!he.objectMode&&Object.getPrototypeOf(A)!==g.prototype&&(A=function v(P){return g.from(P)}(A)),G)he.endEmitted?B(P,new b):C(P,he,A,!0);else if(he.ended)B(P,new e);else{if(he.destroyed)return!1;he.reading=!1,he.decoder&&!$?(A=he.decoder.write(A),he.objectMode||0!==A.length?C(P,he,A,!1):k(P,he)):C(P,he,A,!1)}else G||(he.reading=!1,k(P,he));return!he.ended&&(he.length<he.highWaterMark||0===he.length)}function C(P,A,$,G){A.flowing&&0===A.length&&!A.sync?(A.awaitDrain=0,P.emit("data",$)):(A.length+=A.objectMode?1:$.length,G?A.buffer.unshift($):A.buffer.push($),A.needReadable&&U(P)),k(P,A)}Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(A){this._readableState&&(this._readableState.destroyed=A)}}),L.prototype.destroy=t.destroy,L.prototype._undestroy=t.undestroy,L.prototype._destroy=function(P,A){A(P)},L.prototype.push=function(P,A){var G,$=this._readableState;return $.objectMode?G=!0:"string"==typeof P&&((A=A||$.defaultEncoding)!==$.encoding&&(P=g.from(P,A),A=""),G=!0),j(this,P,A,!1,G)},L.prototype.unshift=function(P){return j(this,P,null,!0,!1)},L.prototype.isPaused=function(){return!1===this._readableState.flowing},L.prototype.setEncoding=function(P){y||(y=m("string_decoder/").StringDecoder);var A=new y(P);this._readableState.decoder=A,this._readableState.encoding=this._readableState.decoder.encoding;for(var $=this._readableState.buffer.head,G="";null!==$;)G+=A.write($.data),$=$.next;return this._readableState.buffer.clear(),""!==G&&this._readableState.buffer.push(G),this._readableState.length=G.length,this};var V=1073741824;function T(P,A){return P<=0||0===A.length&&A.ended?0:A.objectMode?1:P!=P?A.flowing&&A.length?A.buffer.head.data.length:A.length:(P>A.highWaterMark&&(A.highWaterMark=function N(P){return P>=V?P=V:(P--,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,P|=P>>>16,P++),P}(P)),P<=A.length?P:A.ended?A.length:(A.needReadable=!0,0))}function U(P){var A=P._readableState;r("emitReadable",A.needReadable,A.emittedReadable),A.needReadable=!1,A.emittedReadable||(r("emitReadable",A.flowing),A.emittedReadable=!0,R.nextTick(W,P))}function W(P){var A=P._readableState;r("emitReadable_",A.destroyed,A.length,A.ended),!A.destroyed&&(A.length||A.ended)&&(P.emit("readable"),A.emittedReadable=!1),A.needReadable=!A.flowing&&!A.ended&&A.length<=A.highWaterMark,X(P)}function k(P,A){A.readingMore||(A.readingMore=!0,R.nextTick(D,P,A))}function D(P,A){for(;!A.reading&&!A.ended&&(A.length<A.highWaterMark||A.flowing&&0===A.length);){var $=A.length;if(r("maybeReadMore read 0"),P.read(0),$===A.length)break}A.readingMore=!1}function ee(P){var A=P._readableState;A.readableListening=P.listenerCount("readable")>0,A.resumeScheduled&&!A.paused?A.flowing=!0:P.listenerCount("data")>0&&P.resume()}function ae(P){r("readable nexttick read 0"),P.read(0)}function be(P,A){r("resume",A.reading),A.reading||P.read(0),A.resumeScheduled=!1,P.emit("resume"),X(P),A.flowing&&!A.reading&&P.read(0)}function X(P){var A=P._readableState;for(r("flow",A.flowing);A.flowing&&null!==P.read(););}function H(P,A){return 0===A.length?null:(A.objectMode?$=A.buffer.shift():!P||P>=A.length?($=A.decoder?A.buffer.join(""):1===A.buffer.length?A.buffer.first():A.buffer.concat(A.length),A.buffer.clear()):$=A.buffer.consume(P,A.decoder),$);var $}function ne(P){var A=P._readableState;r("endReadable",A.endEmitted),A.endEmitted||(A.ended=!0,R.nextTick(ce,A,P))}function ce(P,A){if(r("endReadableNT",P.endEmitted,P.length),!P.endEmitted&&0===P.length&&(P.endEmitted=!0,A.readable=!1,A.emit("end"),P.autoDestroy)){var $=A._writableState;(!$||$.autoDestroy&&$.finished)&&A.destroy()}}function te(P,A){for(var $=0,G=P.length;$<G;$++)if(P[$]===A)return $;return-1}L.prototype.read=function(P){r("read",P),P=parseInt(P,10);var A=this._readableState,$=P;if(0!==P&&(A.emittedReadable=!1),0===P&&A.needReadable&&((0!==A.highWaterMark?A.length>=A.highWaterMark:A.length>0)||A.ended))return r("read: emitReadable",A.length,A.ended),0===A.length&&A.ended?ne(this):U(this),null;if(0===(P=T(P,A))&&A.ended)return 0===A.length&&ne(this),null;var se,G=A.needReadable;return r("need readable",G),(0===A.length||A.length-P<A.highWaterMark)&&r("length less than watermark",G=!0),A.ended||A.reading?r("reading or ended",G=!1):G&&(r("do read"),A.reading=!0,A.sync=!0,0===A.length&&(A.needReadable=!0),this._read(A.highWaterMark),A.sync=!1,A.reading||(P=T($,A))),null===(se=P>0?H(P,A):null)?(A.needReadable=A.length<=A.highWaterMark,P=0):(A.length-=P,A.awaitDrain=0),0===A.length&&(A.ended||(A.needReadable=!0),$!==P&&A.ended&&ne(this)),null!==se&&this.emit("data",se),se},L.prototype._read=function(P){B(this,new p("_read()"))},L.prototype.pipe=function(P,A){var $=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=P;break;case 1:G.pipes=[G.pipes,P];break;default:G.pipes.push(P)}G.pipesCount+=1,r("pipe count=%d opts=%j",G.pipesCount,A);var he=A&&!1===A.end||P===R.stdout||P===R.stderr?Be:me;function me(){r("onend"),P.end()}G.endEmitted?R.nextTick(he):$.once("end",he),P.on("unpipe",function pe(Ge,Ue){r("onunpipe"),Ge===$&&Ue&&!1===Ue.hasUnpiped&&(Ue.hasUnpiped=!0,function Se(){r("cleanup"),P.removeListener("close",Ne),P.removeListener("finish",qe),P.removeListener("drain",Ee),P.removeListener("error",Ae),P.removeListener("unpipe",pe),$.removeListener("end",me),$.removeListener("end",Be),$.removeListener("data",De),_e=!0,G.awaitDrain&&(!P._writableState||P._writableState.needDrain)&&Ee()}())});var Ee=function Q(P){return function(){var $=P._readableState;r("pipeOnDrain",$.awaitDrain),$.awaitDrain&&$.awaitDrain--,0===$.awaitDrain&&d(P,"data")&&($.flowing=!0,X(P))}}($);P.on("drain",Ee);var _e=!1;function De(Ge){r("ondata");var Ue=P.write(Ge);r("dest.write",Ue),!1===Ue&&((1===G.pipesCount&&G.pipes===P||G.pipesCount>1&&-1!==te(G.pipes,P))&&!_e&&(r("false write response, pause",G.awaitDrain),G.awaitDrain++),$.pause())}function Ae(Ge){r("onerror",Ge),Be(),P.removeListener("error",Ae),0===d(P,"error")&&B(P,Ge)}function Ne(){P.removeListener("finish",qe),Be()}function qe(){r("onfinish"),P.removeListener("close",Ne),Be()}function Be(){r("unpipe"),$.unpipe(P)}return $.on("data",De),function z(P,A,$){if("function"==typeof P.prependListener)return P.prependListener(A,$);P._events&&P._events[A]?Array.isArray(P._events[A])?P._events[A].unshift($):P._events[A]=[$,P._events[A]]:P.on(A,$)}(P,"error",Ae),P.once("close",Ne),P.once("finish",qe),P.emit("pipe",$),G.flowing||(r("pipe resume"),$.resume()),P},L.prototype.unpipe=function(P){var A=this._readableState,$={hasUnpiped:!1};if(0===A.pipesCount)return this;if(1===A.pipesCount)return P&&P!==A.pipes||(P||(P=A.pipes),A.pipes=null,A.pipesCount=0,A.flowing=!1,P&&P.emit("unpipe",this,$)),this;if(!P){var G=A.pipes,se=A.pipesCount;A.pipes=null,A.pipesCount=0,A.flowing=!1;for(var he=0;he<se;he++)G[he].emit("unpipe",this,{hasUnpiped:!1});return this}var pe=te(A.pipes,P);return-1===pe||(A.pipes.splice(pe,1),A.pipesCount-=1,1===A.pipesCount&&(A.pipes=A.pipes[0]),P.emit("unpipe",this,$)),this},L.prototype.addListener=L.prototype.on=function(P,A){var $=u.prototype.on.call(this,P,A),G=this._readableState;return"data"===P?(G.readableListening=this.listenerCount("readable")>0,!1!==G.flowing&&this.resume()):"readable"===P&&!G.endEmitted&&!G.readableListening&&(G.readableListening=G.needReadable=!0,G.flowing=!1,G.emittedReadable=!1,r("on readable",G.length,G.reading),G.length?U(this):G.reading||R.nextTick(ae,this)),$},L.prototype.removeListener=function(P,A){var $=u.prototype.removeListener.call(this,P,A);return"readable"===P&&R.nextTick(ee,this),$},L.prototype.removeAllListeners=function(P){var A=u.prototype.removeAllListeners.apply(this,arguments);return("readable"===P||void 0===P)&&R.nextTick(ee,this),A},L.prototype.resume=function(){var P=this._readableState;return P.flowing||(r("resume"),P.flowing=!P.readableListening,function ue(P,A){A.resumeScheduled||(A.resumeScheduled=!0,R.nextTick(be,P,A))}(this,P)),P.paused=!1,this},L.prototype.pause=function(){return r("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(r("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},L.prototype.wrap=function(P){var A=this,$=this._readableState,G=!1;for(var se in P.on("end",function(){if(r("wrapped end"),$.decoder&&!$.ended){var pe=$.decoder.end();pe&&pe.length&&A.push(pe)}A.push(null)}),P.on("data",function(pe){r("wrapped data"),$.decoder&&(pe=$.decoder.write(pe)),$.objectMode&&null==pe||!($.objectMode||pe&&pe.length)||A.push(pe)||(G=!0,P.pause())}),P)void 0===this[se]&&"function"==typeof P[se]&&(this[se]=function(me){return function(){return P[me].apply(P,arguments)}}(se));for(var he=0;he<J.length;he++)P.on(J[he],this.emit.bind(this,J[he]));return this._read=function(pe){r("wrapped _read",pe),G&&(G=!1,P.resume())},this},"function"==typeof Symbol&&(L.prototype[Symbol.asyncIterator]=function(){return void 0===w&&(w=m("./internal/streams/async_iterator")),w(this)}),Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(A){this._readableState&&(this._readableState.flowing=A)}}),L._fromList=H,Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(L.from=function(P,A){return void 0===x&&(x=m("./internal/streams/from")),x(L,P,A)})}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":117,"./_stream_duplex":118,"./internal/streams/async_iterator":123,"./internal/streams/buffer_list":124,"./internal/streams/destroy":125,"./internal/streams/from":127,"./internal/streams/state":129,"./internal/streams/stream":130,_process:237,buffer:68,events:105,inherits:146,"string_decoder/":279,util:20}],121:[function(m,ie,a){arguments[4][54][0].apply(a,arguments)},{"../errors":117,"./_stream_duplex":118,dup:54,inherits:146}],122:[function(m,ie,a){(function(R,I){(function(){"use strict";function _(X){var H=this;this.next=null,this.entry=null,this.finish=function(){!function be(X,H,ne){var ce=X.entry;for(X.entry=null;ce;){var te=ce.callback;H.pendingcb--,te(ne),ce=ce.next}H.corkedRequestsFree.next=X}(H,X)}}var d;ie.exports=M,M.WritableState=J;var z,u={deprecate:m("util-deprecate")},g=m("./internal/streams/stream"),f=m("buffer").Buffer,v=I.Uint8Array||function(){},r=m("./internal/streams/destroy"),t=m("./internal/streams/state").getHighWaterMark,n=m("../errors").codes,o=n.ERR_INVALID_ARG_TYPE,h=n.ERR_METHOD_NOT_IMPLEMENTED,l=n.ERR_MULTIPLE_CALLBACK,e=n.ERR_STREAM_CANNOT_PIPE,p=n.ERR_STREAM_DESTROYED,b=n.ERR_STREAM_NULL_VALUES,y=n.ERR_STREAM_WRITE_AFTER_END,w=n.ERR_UNKNOWN_ENCODING,x=r.errorOrDestroy;function B(){}function J(X,H,ne){d=d||m("./_stream_duplex"),"boolean"!=typeof ne&&(ne=H instanceof d),this.objectMode=!!(X=X||{}).objectMode,ne&&(this.objectMode=this.objectMode||!!X.writableObjectMode),this.highWaterMark=t(this,X,"writableHighWaterMark",ne),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===X.decodeStrings),this.defaultEncoding=X.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(te){!function S(X,H){var ne=X._writableState,ce=ne.sync,te=ne.writecb;if("function"!=typeof te)throw new l;if(function T(X){X.writing=!1,X.writecb=null,X.length-=X.writelen,X.writelen=0}(ne),H)!function N(X,H,ne,ce,te){--H.pendingcb,ne?(R.nextTick(te,ce),R.nextTick(ae,X,H),X._writableState.errorEmitted=!0,x(X,ce)):(te(ce),X._writableState.errorEmitted=!0,x(X,ce),ae(X,H))}(X,ne,ce,H,te);else{var P=D(ne)||X.destroyed;!P&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&k(X,ne),ce?R.nextTick(U,X,ne,P,te):U(X,ne,P,te)}}(H,te)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==X.emitClose,this.autoDestroy=!!X.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new _(this)}function M(X){var H=this instanceof(d=d||m("./_stream_duplex"));if(!H&&!z.call(M,this))return new M(X);this._writableState=new J(X,this,H),this.writable=!0,X&&("function"==typeof X.write&&(this._write=X.write),"function"==typeof X.writev&&(this._writev=X.writev),"function"==typeof X.destroy&&(this._destroy=X.destroy),"function"==typeof X.final&&(this._final=X.final)),g.call(this)}function V(X,H,ne,ce,te,P,A){H.writelen=ce,H.writecb=A,H.writing=!0,H.sync=!0,H.destroyed?H.onwrite(new p("write")):ne?X._writev(te,H.onwrite):X._write(te,P,H.onwrite),H.sync=!1}function U(X,H,ne,ce){ne||function W(X,H){0===H.length&&H.needDrain&&(H.needDrain=!1,X.emit("drain"))}(X,H),H.pendingcb--,ce(),ae(X,H)}function k(X,H){H.bufferProcessing=!0;var ne=H.bufferedRequest;if(X._writev&&ne&&ne.next){var te=new Array(H.bufferedRequestCount),P=H.corkedRequestsFree;P.entry=ne;for(var A=0,$=!0;ne;)te[A]=ne,ne.isBuf||($=!1),ne=ne.next,A+=1;te.allBuffers=$,V(X,H,!0,H.length,te,"",P.finish),H.pendingcb++,H.lastBufferedRequest=null,P.next?(H.corkedRequestsFree=P.next,P.next=null):H.corkedRequestsFree=new _(H),H.bufferedRequestCount=0}else{for(;ne;){var G=ne.chunk;if(V(X,H,!1,H.objectMode?1:G.length,G,ne.encoding,ne.callback),ne=ne.next,H.bufferedRequestCount--,H.writing)break}null===ne&&(H.lastBufferedRequest=null)}H.bufferedRequest=ne,H.bufferProcessing=!1}function D(X){return X.ending&&0===X.length&&null===X.bufferedRequest&&!X.finished&&!X.writing}function Q(X,H){X._final(function(ne){H.pendingcb--,ne&&x(X,ne),H.prefinished=!0,X.emit("prefinish"),ae(X,H)})}function ae(X,H){var ne=D(H);if(ne&&(function ee(X,H){!H.prefinished&&!H.finalCalled&&("function"!=typeof X._final||H.destroyed?(H.prefinished=!0,X.emit("prefinish")):(H.pendingcb++,H.finalCalled=!0,R.nextTick(Q,X,H)))}(X,H),0===H.pendingcb&&(H.finished=!0,X.emit("finish"),H.autoDestroy))){var ce=X._readableState;(!ce||ce.autoDestroy&&ce.endEmitted)&&X.destroy()}return ne}m("inherits")(M,g),J.prototype.getBuffer=function(){for(var H=this.bufferedRequest,ne=[];H;)ne.push(H),H=H.next;return ne},function(){try{Object.defineProperty(J.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(z=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(H){return!!z.call(this,H)||this===M&&H&&H._writableState instanceof J}})):z=function(H){return H instanceof this},M.prototype.pipe=function(){x(this,new e)},M.prototype.write=function(X,H,ne){var ce=this._writableState,te=!1,P=!ce.objectMode&&function i(X){return f.isBuffer(X)||X instanceof v}(X);return P&&!f.isBuffer(X)&&(X=function c(X){return f.from(X)}(X)),"function"==typeof H&&(ne=H,H=null),P?H="buffer":H||(H=ce.defaultEncoding),"function"!=typeof ne&&(ne=B),ce.ending?function L(X,H){var ne=new y;x(X,ne),R.nextTick(H,ne)}(this,ne):(P||function j(X,H,ne,ce){var te;return null===ne?te=new b:"string"!=typeof ne&&!H.objectMode&&(te=new o("chunk",["string","Buffer"],ne)),!te||(x(X,te),R.nextTick(ce,te),!1)}(this,ce,X,ne))&&(ce.pendingcb++,te=function F(X,H,ne,ce,te,P){if(!ne){var A=function C(X,H,ne){return!X.objectMode&&!1!==X.decodeStrings&&"string"==typeof H&&(H=f.from(H,ne)),H}(H,ce,te);ce!==A&&(ne=!0,te="buffer",ce=A)}var $=H.objectMode?1:ce.length;H.length+=$;var G=H.length<H.highWaterMark;if(G||(H.needDrain=!0),H.writing||H.corked){var se=H.lastBufferedRequest;H.lastBufferedRequest={chunk:ce,encoding:te,isBuf:ne,callback:P,next:null},se?se.next=H.lastBufferedRequest:H.bufferedRequest=H.lastBufferedRequest,H.bufferedRequestCount+=1}else V(X,H,!1,$,ce,te,P);return G}(this,ce,P,X,H,ne)),te},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var X=this._writableState;X.corked&&(X.corked--,!X.writing&&!X.corked&&!X.bufferProcessing&&X.bufferedRequest&&k(this,X))},M.prototype.setDefaultEncoding=function(H){if("string"==typeof H&&(H=H.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((H+"").toLowerCase())>-1))throw new w(H);return this._writableState.defaultEncoding=H,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),M.prototype._write=function(X,H,ne){ne(new h("_write()"))},M.prototype._writev=null,M.prototype.end=function(X,H,ne){var ce=this._writableState;return"function"==typeof X?(ne=X,X=null,H=null):"function"==typeof H&&(ne=H,H=null),null!=X&&this.write(X,H),ce.corked&&(ce.corked=1,this.uncork()),ce.ending||function ue(X,H,ne){H.ending=!0,ae(X,H),ne&&(H.finished?R.nextTick(ne):X.once("finish",ne)),H.ended=!0,X.writable=!1}(this,ce,ne),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(H){this._writableState&&(this._writableState.destroyed=H)}}),M.prototype.destroy=r.destroy,M.prototype._undestroy=r.undestroy,M.prototype._destroy=function(X,H){H(X)}}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":117,"./_stream_duplex":118,"./internal/streams/destroy":125,"./internal/streams/state":129,"./internal/streams/stream":130,_process:237,buffer:68,inherits:146,"util-deprecate":282}],123:[function(m,ie,a){(function(R){(function(){"use strict";var I;function E(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}var _=m("./end-of-stream"),d=Symbol("lastResolve"),u=Symbol("lastReject"),g=Symbol("error"),f=Symbol("ended"),v=Symbol("lastPromise"),c=Symbol("handlePromise"),i=Symbol("stream");function r(e,p){return{value:e,done:p}}function s(e){var p=e[d];if(null!==p){var b=e[i].read();null!==b&&(e[v]=null,e[d]=null,e[u]=null,p(r(b,!1)))}}function t(e){R.nextTick(s,e)}var o=Object.getPrototypeOf(function(){}),h=Object.setPrototypeOf((E(I={get stream(){return this[i]},next:function(){var p=this,b=this[g];if(null!==b)return Promise.reject(b);if(this[f])return Promise.resolve(r(void 0,!0));if(this[i].destroyed)return new Promise(function(B,J){R.nextTick(function(){p[g]?J(p[g]):B(r(void 0,!0))})});var w,y=this[v];if(y)w=new Promise(function n(e,p){return function(b,y){e.then(function(){p[f]?b(r(void 0,!0)):p[c](b,y)},y)}}(y,this));else{var x=this[i].read();if(null!==x)return Promise.resolve(r(x,!1));w=new Promise(this[c])}return this[v]=w,w}},Symbol.asyncIterator,function(){return this}),E(I,"return",function(){var p=this;return new Promise(function(b,y){p[i].destroy(null,function(w){w?y(w):b(r(void 0,!0))})})}),I),o);ie.exports=function(p){var b,y=Object.create(h,(E(b={},i,{value:p,writable:!0}),E(b,d,{value:null,writable:!0}),E(b,u,{value:null,writable:!0}),E(b,g,{value:null,writable:!0}),E(b,f,{value:p._readableState.endEmitted,writable:!0}),E(b,c,{value:function(x,B){var J=y[i].read();J?(y[v]=null,y[d]=null,y[u]=null,x(r(J,!1))):(y[d]=x,y[u]=B)},writable:!0}),b));return y[v]=null,_(p,function(w){if(w&&"ERR_STREAM_PREMATURE_CLOSE"!==w.code){var x=y[u];return null!==x&&(y[v]=null,y[d]=null,y[u]=null,x(w)),void(y[g]=w)}var B=y[d];null!==B&&(y[v]=null,y[d]=null,y[u]=null,B(r(void 0,!0))),y[f]=!0}),p.on("readable",t.bind(null,y)),y}}).call(this)}).call(this,m("_process"))},{"./end-of-stream":126,_process:237}],124:[function(m,ie,a){arguments[4][57][0].apply(a,arguments)},{buffer:68,dup:57,util:20}],125:[function(m,ie,a){(function(R){(function(){"use strict";function E(f,v){u(f,v),_(f)}function _(f){f._writableState&&!f._writableState.emitClose||f._readableState&&!f._readableState.emitClose||f.emit("close")}function u(f,v){f.emit("error",v)}ie.exports={destroy:function I(f,v){var c=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(v?v(f):f&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,R.nextTick(u,this,f)):R.nextTick(u,this,f)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(f||null,function(s){!v&&s?c._writableState?c._writableState.errorEmitted?R.nextTick(_,c):(c._writableState.errorEmitted=!0,R.nextTick(E,c,s)):R.nextTick(E,c,s):v?(R.nextTick(_,c),v(s)):R.nextTick(_,c)}),this)},undestroy:function d(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function g(f,v){var c=f._readableState,i=f._writableState;c&&c.autoDestroy||i&&i.autoDestroy?f.destroy(v):f.emit("error",v)}}}).call(this)}).call(this,m("_process"))},{_process:237}],126:[function(m,ie,a){arguments[4][59][0].apply(a,arguments)},{"../../../errors":117,dup:59}],127:[function(m,ie,a){arguments[4][60][0].apply(a,arguments)},{dup:60}],128:[function(m,ie,a){arguments[4][61][0].apply(a,arguments)},{"../../../errors":117,"./end-of-stream":126,dup:61}],129:[function(m,ie,a){arguments[4][62][0].apply(a,arguments)},{"../../../errors":117,dup:62}],130:[function(m,ie,a){arguments[4][63][0].apply(a,arguments)},{dup:63,events:105}],131:[function(m,ie,a){arguments[4][64][0].apply(a,arguments)},{"./lib/_stream_duplex.js":118,"./lib/_stream_passthrough.js":119,"./lib/_stream_readable.js":120,"./lib/_stream_transform.js":121,"./lib/_stream_writable.js":122,"./lib/internal/streams/end-of-stream.js":126,"./lib/internal/streams/pipeline.js":128,dup:64}],132:[function(m,ie,a){var R=a;R.utils=m("./hash/utils"),R.common=m("./hash/common"),R.sha=m("./hash/sha"),R.ripemd=m("./hash/ripemd"),R.hmac=m("./hash/hmac"),R.sha1=R.sha.sha1,R.sha256=R.sha.sha256,R.sha224=R.sha.sha224,R.sha384=R.sha.sha384,R.sha512=R.sha.sha512,R.ripemd160=R.ripemd.ripemd160},{"./hash/common":133,"./hash/hmac":134,"./hash/ripemd":135,"./hash/sha":136,"./hash/utils":143}],133:[function(m,ie,a){"use strict";var R=m("./utils"),I=m("minimalistic-assert");function E(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}a.BlockHash=E,E.prototype.update=function(d,u){if(d=R.toArray(d,u),this.pending=this.pending?this.pending.concat(d):d,this.pendingTotal+=d.length,this.pending.length>=this._delta8){var g=(d=this.pending).length%this._delta8;this.pending=d.slice(d.length-g,d.length),0===this.pending.length&&(this.pending=null),d=R.join32(d,0,d.length-g,this.endian);for(var f=0;f<d.length;f+=this._delta32)this._update(d,f,f+this._delta32)}return this},E.prototype.digest=function(d){return this.update(this._pad()),I(null===this.pending),this._digest(d)},E.prototype._pad=function(){var d=this.pendingTotal,u=this._delta8,g=u-(d+this.padLength)%u,f=new Array(g+this.padLength);f[0]=128;for(var v=1;v<g;v++)f[v]=0;if(d<<=3,"big"===this.endian){for(var c=8;c<this.padLength;c++)f[v++]=0;f[v++]=0,f[v++]=0,f[v++]=0,f[v++]=0,f[v++]=d>>>24&255,f[v++]=d>>>16&255,f[v++]=d>>>8&255,f[v++]=255&d}else for(f[v++]=255&d,f[v++]=d>>>8&255,f[v++]=d>>>16&255,f[v++]=d>>>24&255,f[v++]=0,f[v++]=0,f[v++]=0,f[v++]=0,c=8;c<this.padLength;c++)f[v++]=0;return f}},{"./utils":143,"minimalistic-assert":223}],134:[function(m,ie,a){"use strict";var R=m("./utils"),I=m("minimalistic-assert");function E(_,d,u){if(!(this instanceof E))return new E(_,d,u);this.Hash=_,this.blockSize=_.blockSize/8,this.outSize=_.outSize/8,this.inner=null,this.outer=null,this._init(R.toArray(d,u))}ie.exports=E,E.prototype._init=function(d){d.length>this.blockSize&&(d=(new this.Hash).update(d).digest()),I(d.length<=this.blockSize);for(var u=d.length;u<this.blockSize;u++)d.push(0);for(u=0;u<d.length;u++)d[u]^=54;for(this.inner=(new this.Hash).update(d),u=0;u<d.length;u++)d[u]^=106;this.outer=(new this.Hash).update(d)},E.prototype.update=function(d,u){return this.inner.update(d,u),this},E.prototype.digest=function(d){return this.outer.update(this.inner.digest()),this.outer.digest(d)}},{"./utils":143,"minimalistic-assert":223}],135:[function(m,ie,a){"use strict";var R=m("./utils"),I=m("./common"),E=R.rotl32,_=R.sum32,d=R.sum32_3,u=R.sum32_4,g=I.BlockHash;function f(){if(!(this instanceof f))return new f;g.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function v(o,h,l,e){return o<=15?h^l^e:o<=31?h&l|~h&e:o<=47?(h|~l)^e:o<=63?h&e|l&~e:h^(l|~e)}function i(o){return o<=15?1352829926:o<=31?1548603684:o<=47?1836072691:o<=63?2053994217:0}R.inherits(f,g),a.ripemd160=f,f.blockSize=512,f.outSize=160,f.hmacStrength=192,f.padLength=64,f.prototype._update=function(h,l){for(var e=this.h[0],p=this.h[1],b=this.h[2],y=this.h[3],w=this.h[4],x=e,B=p,J=b,z=y,M=w,L=0;L<80;L++){var j=_(E(u(e,v(L,p,b,y),h[r[L]+l],(o=L)<=15?0:o<=31?1518500249:o<=47?1859775393:o<=63?2400959708:2840853838),t[L]),w);e=w,w=y,y=E(b,10),b=p,p=j,j=_(E(u(x,v(79-L,B,J,z),h[s[L]+l],i(L)),n[L]),M),x=M,M=z,z=E(J,10),J=B,B=j}var o;j=d(this.h[1],b,z),this.h[1]=d(this.h[2],y,M),this.h[2]=d(this.h[3],w,x),this.h[3]=d(this.h[4],e,B),this.h[4]=d(this.h[0],p,J),this.h[0]=j},f.prototype._digest=function(h){return"hex"===h?R.toHex32(this.h,"little"):R.split32(this.h,"little")};var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],s=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],t=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],n=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"./common":133,"./utils":143}],136:[function(m,ie,a){"use strict";a.sha1=m("./sha/1"),a.sha224=m("./sha/224"),a.sha256=m("./sha/256"),a.sha384=m("./sha/384"),a.sha512=m("./sha/512")},{"./sha/1":137,"./sha/224":138,"./sha/256":139,"./sha/384":140,"./sha/512":141}],137:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("../common"),E=m("./common"),_=R.rotl32,d=R.sum32,u=R.sum32_5,g=E.ft_1,f=I.BlockHash,v=[1518500249,1859775393,2400959708,3395469782];function c(){if(!(this instanceof c))return new c;f.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}R.inherits(c,f),ie.exports=c,c.blockSize=512,c.outSize=160,c.hmacStrength=80,c.padLength=64,c.prototype._update=function(r,s){for(var t=this.W,n=0;n<16;n++)t[n]=r[s+n];for(;n<t.length;n++)t[n]=_(t[n-3]^t[n-8]^t[n-14]^t[n-16],1);var o=this.h[0],h=this.h[1],l=this.h[2],e=this.h[3],p=this.h[4];for(n=0;n<t.length;n++){var b=~~(n/20),y=u(_(o,5),g(b,h,l,e),p,t[n],v[b]);p=e,e=l,l=_(h,30),h=o,o=y}this.h[0]=d(this.h[0],o),this.h[1]=d(this.h[1],h),this.h[2]=d(this.h[2],l),this.h[3]=d(this.h[3],e),this.h[4]=d(this.h[4],p)},c.prototype._digest=function(r){return"hex"===r?R.toHex32(this.h,"big"):R.split32(this.h,"big")}},{"../common":133,"../utils":143,"./common":142}],138:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("./256");function E(){if(!(this instanceof E))return new E;I.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}R.inherits(E,I),ie.exports=E,E.blockSize=512,E.outSize=224,E.hmacStrength=192,E.padLength=64,E.prototype._digest=function(d){return"hex"===d?R.toHex32(this.h.slice(0,7),"big"):R.split32(this.h.slice(0,7),"big")}},{"../utils":143,"./256":139}],139:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("../common"),E=m("./common"),_=m("minimalistic-assert"),d=R.sum32,u=R.sum32_4,g=R.sum32_5,f=E.ch32,v=E.maj32,c=E.s0_256,i=E.s1_256,r=E.g0_256,s=E.g1_256,t=I.BlockHash,n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function o(){if(!(this instanceof o))return new o;t.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=n,this.W=new Array(64)}R.inherits(o,t),ie.exports=o,o.blockSize=512,o.outSize=256,o.hmacStrength=192,o.padLength=64,o.prototype._update=function(l,e){for(var p=this.W,b=0;b<16;b++)p[b]=l[e+b];for(;b<p.length;b++)p[b]=u(s(p[b-2]),p[b-7],r(p[b-15]),p[b-16]);var y=this.h[0],w=this.h[1],x=this.h[2],B=this.h[3],J=this.h[4],z=this.h[5],M=this.h[6],L=this.h[7];for(_(this.k.length===p.length),b=0;b<p.length;b++){var j=g(L,i(J),f(J,z,M),this.k[b],p[b]),C=d(c(y),v(y,w,x));L=M,M=z,z=J,J=d(B,j),B=x,x=w,w=y,y=d(j,C)}this.h[0]=d(this.h[0],y),this.h[1]=d(this.h[1],w),this.h[2]=d(this.h[2],x),this.h[3]=d(this.h[3],B),this.h[4]=d(this.h[4],J),this.h[5]=d(this.h[5],z),this.h[6]=d(this.h[6],M),this.h[7]=d(this.h[7],L)},o.prototype._digest=function(l){return"hex"===l?R.toHex32(this.h,"big"):R.split32(this.h,"big")}},{"../common":133,"../utils":143,"./common":142,"minimalistic-assert":223}],140:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("./512");function E(){if(!(this instanceof E))return new E;I.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}R.inherits(E,I),ie.exports=E,E.blockSize=1024,E.outSize=384,E.hmacStrength=192,E.padLength=128,E.prototype._digest=function(d){return"hex"===d?R.toHex32(this.h.slice(0,12),"big"):R.split32(this.h.slice(0,12),"big")}},{"../utils":143,"./512":141}],141:[function(m,ie,a){"use strict";var R=m("../utils"),I=m("../common"),E=m("minimalistic-assert"),_=R.rotr64_hi,d=R.rotr64_lo,u=R.shr64_hi,g=R.shr64_lo,f=R.sum64,v=R.sum64_hi,c=R.sum64_lo,i=R.sum64_4_hi,r=R.sum64_4_lo,s=R.sum64_5_hi,t=R.sum64_5_lo,n=I.BlockHash,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function h(){if(!(this instanceof h))return new h;n.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=o,this.W=new Array(160)}function l(j,C,F,V,N){var T=j&F^~j&N;return T<0&&(T+=4294967296),T}function e(j,C,F,V,N,T){var S=C&V^~C&T;return S<0&&(S+=4294967296),S}function p(j,C,F,V,N){var T=j&F^j&N^F&N;return T<0&&(T+=4294967296),T}function b(j,C,F,V,N,T){var S=C&V^C&T^V&T;return S<0&&(S+=4294967296),S}function y(j,C){var T=_(j,C,28)^_(C,j,2)^_(C,j,7);return T<0&&(T+=4294967296),T}function w(j,C){var T=d(j,C,28)^d(C,j,2)^d(C,j,7);return T<0&&(T+=4294967296),T}function x(j,C){var T=_(j,C,14)^_(j,C,18)^_(C,j,9);return T<0&&(T+=4294967296),T}function B(j,C){var T=d(j,C,14)^d(j,C,18)^d(C,j,9);return T<0&&(T+=4294967296),T}function J(j,C){var T=_(j,C,1)^_(j,C,8)^u(j,C,7);return T<0&&(T+=4294967296),T}function z(j,C){var T=d(j,C,1)^d(j,C,8)^g(j,C,7);return T<0&&(T+=4294967296),T}function M(j,C){var T=_(j,C,19)^_(C,j,29)^u(j,C,6);return T<0&&(T+=4294967296),T}function L(j,C){var T=d(j,C,19)^d(C,j,29)^g(j,C,6);return T<0&&(T+=4294967296),T}R.inherits(h,n),ie.exports=h,h.blockSize=1024,h.outSize=512,h.hmacStrength=192,h.padLength=128,h.prototype._prepareBlock=function(C,F){for(var V=this.W,N=0;N<32;N++)V[N]=C[F+N];for(;N<V.length;N+=2){var T=M(V[N-4],V[N-3]),S=L(V[N-4],V[N-3]),U=V[N-14],W=V[N-13],k=J(V[N-30],V[N-29]),D=z(V[N-30],V[N-29]),Q=V[N-32],ee=V[N-31];V[N]=i(T,S,U,W,k,D,Q,ee),V[N+1]=r(T,S,U,W,k,D,Q,ee)}},h.prototype._update=function(C,F){this._prepareBlock(C,F);var V=this.W,N=this.h[0],T=this.h[1],S=this.h[2],U=this.h[3],W=this.h[4],k=this.h[5],D=this.h[6],Q=this.h[7],ee=this.h[8],ae=this.h[9],ue=this.h[10],be=this.h[11],X=this.h[12],H=this.h[13],ne=this.h[14],ce=this.h[15];E(this.k.length===V.length);for(var te=0;te<V.length;te+=2){var P=ne,A=ce,$=x(ee,ae),G=B(ee,ae),se=l(ee,0,ue,0,X),he=e(0,ae,0,be,0,H),pe=this.k[te],me=this.k[te+1],Ee=V[te],_e=V[te+1],Se=s(P,A,$,G,se,he,pe,me,Ee,_e),De=t(P,A,$,G,se,he,pe,me,Ee,_e);P=y(N,T),A=w(N,T),$=p(N,0,S,0,W),G=b(0,T,0,U,0,k);var Ae=v(P,A,$,G),Ne=c(P,A,$,G);ne=X,ce=H,X=ue,H=be,ue=ee,be=ae,ee=v(D,Q,Se,De),ae=c(Q,Q,Se,De),D=W,Q=k,W=S,k=U,S=N,U=T,N=v(Se,De,Ae,Ne),T=c(Se,De,Ae,Ne)}f(this.h,0,N,T),f(this.h,2,S,U),f(this.h,4,W,k),f(this.h,6,D,Q),f(this.h,8,ee,ae),f(this.h,10,ue,be),f(this.h,12,X,H),f(this.h,14,ne,ce)},h.prototype._digest=function(C){return"hex"===C?R.toHex32(this.h,"big"):R.split32(this.h,"big")}},{"../common":133,"../utils":143,"minimalistic-assert":223}],142:[function(m,ie,a){"use strict";var I=m("../utils").rotr32;function _(i,r,s){return i&r^~i&s}function d(i,r,s){return i&r^i&s^r&s}function u(i,r,s){return i^r^s}a.ft_1=function E(i,r,s,t){return 0===i?_(r,s,t):1===i||3===i?u(r,s,t):2===i?d(r,s,t):void 0},a.ch32=_,a.maj32=d,a.p32=u,a.s0_256=function g(i){return I(i,2)^I(i,13)^I(i,22)},a.s1_256=function f(i){return I(i,6)^I(i,11)^I(i,25)},a.g0_256=function v(i){return I(i,7)^I(i,18)^i>>>3},a.g1_256=function c(i){return I(i,17)^I(i,19)^i>>>10}},{"../utils":143}],143:[function(m,ie,a){"use strict";var R=m("minimalistic-assert"),I=m("inherits");function E(L,j){return!(55296!=(64512&L.charCodeAt(j))||j<0||j+1>=L.length)&&56320==(64512&L.charCodeAt(j+1))}function u(L){return(L>>>24|L>>>8&65280|L<<8&16711680|(255&L)<<24)>>>0}function f(L){return 1===L.length?"0"+L:L}function v(L){return 7===L.length?"0"+L:6===L.length?"00"+L:5===L.length?"000"+L:4===L.length?"0000"+L:3===L.length?"00000"+L:2===L.length?"000000"+L:1===L.length?"0000000"+L:L}a.inherits=I,a.toArray=function _(L,j){if(Array.isArray(L))return L.slice();if(!L)return[];var C=[];if("string"==typeof L)if(j){if("hex"===j)for((L=L.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(L="0"+L),V=0;V<L.length;V+=2)C.push(parseInt(L[V]+L[V+1],16))}else for(var F=0,V=0;V<L.length;V++){var N=L.charCodeAt(V);N<128?C[F++]=N:N<2048?(C[F++]=N>>6|192,C[F++]=63&N|128):E(L,V)?(N=65536+((1023&N)<<10)+(1023&L.charCodeAt(++V)),C[F++]=N>>18|240,C[F++]=N>>12&63|128,C[F++]=N>>6&63|128,C[F++]=63&N|128):(C[F++]=N>>12|224,C[F++]=N>>6&63|128,C[F++]=63&N|128)}else for(V=0;V<L.length;V++)C[V]=0|L[V];return C},a.toHex=function d(L){for(var j="",C=0;C<L.length;C++)j+=f(L[C].toString(16));return j},a.htonl=u,a.toHex32=function g(L,j){for(var C="",F=0;F<L.length;F++){var V=L[F];"little"===j&&(V=u(V)),C+=v(V.toString(16))}return C},a.zero2=f,a.zero8=v,a.join32=function c(L,j,C,F){var V=C-j;R(V%4==0);for(var N=new Array(V/4),T=0,S=j;T<N.length;T++,S+=4)N[T]=("big"===F?L[S]<<24|L[S+1]<<16|L[S+2]<<8|L[S+3]:L[S+3]<<24|L[S+2]<<16|L[S+1]<<8|L[S])>>>0;return N},a.split32=function i(L,j){for(var C=new Array(4*L.length),F=0,V=0;F<L.length;F++,V+=4){var N=L[F];"big"===j?(C[V]=N>>>24,C[V+1]=N>>>16&255,C[V+2]=N>>>8&255,C[V+3]=255&N):(C[V+3]=N>>>24,C[V+2]=N>>>16&255,C[V+1]=N>>>8&255,C[V]=255&N)}return C},a.rotr32=function r(L,j){return L>>>j|L<<32-j},a.rotl32=function s(L,j){return L<<j|L>>>32-j},a.sum32=function t(L,j){return L+j>>>0},a.sum32_3=function n(L,j,C){return L+j+C>>>0},a.sum32_4=function o(L,j,C,F){return L+j+C+F>>>0},a.sum32_5=function h(L,j,C,F,V){return L+j+C+F+V>>>0},a.sum64=function l(L,j,C,F){var T=F+L[j+1]>>>0;L[j]=(T<F?1:0)+C+L[j]>>>0,L[j+1]=T},a.sum64_hi=function e(L,j,C,F){return(j+F>>>0<j?1:0)+L+C>>>0},a.sum64_lo=function p(L,j,C,F){return j+F>>>0},a.sum64_4_hi=function b(L,j,C,F,V,N,T,S){var U=0,W=j;return U+=(W=W+F>>>0)<j?1:0,U+=(W=W+N>>>0)<N?1:0,L+C+V+T+(U+=(W=W+S>>>0)<S?1:0)>>>0},a.sum64_4_lo=function y(L,j,C,F,V,N,T,S){return j+F+N+S>>>0},a.sum64_5_hi=function w(L,j,C,F,V,N,T,S,U,W){var k=0,D=j;return k+=(D=D+F>>>0)<j?1:0,k+=(D=D+N>>>0)<N?1:0,k+=(D=D+S>>>0)<S?1:0,L+C+V+T+U+(k+=(D=D+W>>>0)<W?1:0)>>>0},a.sum64_5_lo=function x(L,j,C,F,V,N,T,S,U,W){return j+F+N+S+W>>>0},a.rotr64_hi=function B(L,j,C){return(j<<32-C|L>>>C)>>>0},a.rotr64_lo=function J(L,j,C){return(L<<32-C|j>>>C)>>>0},a.shr64_hi=function z(L,j,C){return L>>>C},a.shr64_lo=function M(L,j,C){return(L<<32-C|j>>>C)>>>0}},{inherits:146,"minimalistic-assert":223}],144:[function(m,ie,a){"use strict";var R=m("hash.js"),I=m("minimalistic-crypto-utils"),E=m("minimalistic-assert");function _(d){if(!(this instanceof _))return new _(d);this.hash=d.hash,this.predResist=!!d.predResist,this.outLen=this.hash.outSize,this.minEntropy=d.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var u=I.toArray(d.entropy,d.entropyEnc||"hex"),g=I.toArray(d.nonce,d.nonceEnc||"hex"),f=I.toArray(d.pers,d.persEnc||"hex");E(u.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(u,g,f)}ie.exports=_,_.prototype._init=function(u,g,f){var v=u.concat(g).concat(f);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var c=0;c<this.V.length;c++)this.K[c]=0,this.V[c]=1;this._update(v),this._reseed=1,this.reseedInterval=281474976710656},_.prototype._hmac=function(){return new R.hmac(this.hash,this.K)},_.prototype._update=function(u){var g=this._hmac().update(this.V).update([0]);u&&(g=g.update(u)),this.K=g.digest(),this.V=this._hmac().update(this.V).digest(),u&&(this.K=this._hmac().update(this.V).update([1]).update(u).digest(),this.V=this._hmac().update(this.V).digest())},_.prototype.reseed=function(u,g,f,v){"string"!=typeof g&&(v=f,f=g,g=null),u=I.toArray(u,g),f=I.toArray(f,v),E(u.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(u.concat(f||[])),this._reseed=1},_.prototype.generate=function(u,g,f,v){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof g&&(v=f,f=g,g=null),f&&(f=I.toArray(f,v||"hex"),this._update(f));for(var c=[];c.length<u;)this.V=this._hmac().update(this.V).digest(),c=c.concat(this.V);var i=c.slice(0,u);return this._update(f),this._reseed++,I.encode(i,g)}},{"hash.js":132,"minimalistic-assert":223,"minimalistic-crypto-utils":224}],145:[function(m,ie,a){a.read=function(R,I,E,_,d){var u,g,f=8*d-_-1,v=(1<<f)-1,c=v>>1,i=-7,r=E?d-1:0,s=E?-1:1,t=R[I+r];for(r+=s,u=t&(1<<-i)-1,t>>=-i,i+=f;i>0;u=256*u+R[I+r],r+=s,i-=8);for(g=u&(1<<-i)-1,u>>=-i,i+=_;i>0;g=256*g+R[I+r],r+=s,i-=8);if(0===u)u=1-c;else{if(u===v)return g?NaN:1/0*(t?-1:1);g+=Math.pow(2,_),u-=c}return(t?-1:1)*g*Math.pow(2,u-_)},a.write=function(R,I,E,_,d,u){var g,f,v,c=8*u-d-1,i=(1<<c)-1,r=i>>1,s=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,t=_?0:u-1,n=_?1:-1,o=I<0||0===I&&1/I<0?1:0;for(I=Math.abs(I),isNaN(I)||I===1/0?(f=isNaN(I)?1:0,g=i):(g=Math.floor(Math.log(I)/Math.LN2),I*(v=Math.pow(2,-g))<1&&(g--,v*=2),(I+=g+r>=1?s/v:s*Math.pow(2,1-r))*v>=2&&(g++,v/=2),g+r>=i?(f=0,g=i):g+r>=1?(f=(I*v-1)*Math.pow(2,d),g+=r):(f=I*Math.pow(2,r-1)*Math.pow(2,d),g=0));d>=8;R[E+t]=255&f,t+=n,f/=256,d-=8);for(g=g<<d|f,c+=d;c>0;R[E+t]=255&g,t+=n,g/=256,c-=8);R[E+t-n]|=128*o}},{}],146:[function(m,ie,a){ie.exports="function"==typeof Object.create?function(I,E){E&&(I.super_=E,I.prototype=Object.create(E.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}))}:function(I,E){if(E){I.super_=E;var _=function(){};_.prototype=E.prototype,I.prototype=new _,I.prototype.constructor=I}}},{}],147:[function(m,ie,a){"use strict";var R=m("has-tostringtag/shams")(),E=m("call-bind/callBound")("Object.prototype.toString"),_=function(f){return!(R&&f&&"object"==typeof f&&Symbol.toStringTag in f)&&"[object Arguments]"===E(f)},d=function(f){return!!_(f)||null!==f&&"object"==typeof f&&"number"==typeof f.length&&f.length>=0&&"[object Array]"!==E(f)&&"[object Function]"===E(f.callee)},u=function(){return _(arguments)}();_.isLegacyArguments=d,ie.exports=u?_:d},{"call-bind/callBound":69,"has-tostringtag/shams":114}],148:[function(m,ie,a){"use strict";var E,_,R=Function.prototype.toString,I="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof I&&"function"==typeof Object.defineProperty)try{E=Object.defineProperty({},"length",{get:function(){throw _}}),_={},I(function(){throw 42},null,E)}catch(e){e!==_&&(I=null)}else I=null;var d=/^\s*class\b/,u=function(p){try{var b=R.call(p);return d.test(b)}catch{return!1}},g=function(p){try{return!u(p)&&(R.call(p),!0)}catch{return!1}},f=Object.prototype.toString,n="function"==typeof Symbol&&!!Symbol.toStringTag,o=!(0 in[,]),h=function(){return!1};if("object"==typeof document){var l=document.all;f.call(l)===f.call(document.all)&&(h=function(p){if((o||!p)&&(typeof p>"u"||"object"==typeof p))try{var b=f.call(p);return("[object HTMLAllCollection]"===b||"[object HTML document.all class]"===b||"[object HTMLCollection]"===b||"[object Object]"===b)&&null==p("")}catch{}return!1})}ie.exports=I?function(p){if(h(p))return!0;if(!p||"function"!=typeof p&&"object"!=typeof p)return!1;try{I(p,null,E)}catch(b){if(b!==_)return!1}return!u(p)&&g(p)}:function(p){if(h(p))return!0;if(!p||"function"!=typeof p&&"object"!=typeof p)return!1;if(n)return g(p);if(u(p))return!1;var b=f.call(p);return!("[object Function]"!==b&&"[object GeneratorFunction]"!==b&&!/^\[object HTML/.test(b))&&g(p)}},{}],149:[function(m,ie,a){"use strict";var g,R=Object.prototype.toString,I=Function.prototype.toString,E=/^\s*(?:function)?\*/,_=m("has-tostringtag/shams")(),d=Object.getPrototypeOf;ie.exports=function(v){if("function"!=typeof v)return!1;if(E.test(I.call(v)))return!0;if(!_)return"[object GeneratorFunction]"===R.call(v);if(!d)return!1;if(typeof g>"u"){var i=function(){if(!_)return!1;try{return Function("return function*() {}")()}catch{}}();g=!!i&&d(i)}return d(v)===g}},{"has-tostringtag/shams":114}],150:[function(m,ie,a){(function(R){(function(){"use strict";var I=m("for-each"),E=m("available-typed-arrays"),_=m("call-bind/callBound"),d=_("Object.prototype.toString"),u=m("has-tostringtag/shams")(),g=m("gopd"),f=typeof globalThis>"u"?R:globalThis,v=E(),c=_("Array.prototype.indexOf",!0)||function(o,h){for(var l=0;l<o.length;l+=1)if(o[l]===h)return l;return-1},i=_("String.prototype.slice"),r={},s=Object.getPrototypeOf;u&&g&&s&&I(v,function(n){var o=new f[n];if(Symbol.toStringTag in o){var h=s(o),l=g(h,Symbol.toStringTag);if(!l){var e=s(h);l=g(e,Symbol.toStringTag)}r[n]=l.get}}),ie.exports=function(o){if(!o||"object"!=typeof o)return!1;if(!u||!(Symbol.toStringTag in o)){var h=i(d(o),8,-1);return c(v,h)>-1}return!!g&&function(o){var h=!1;return I(r,function(l,e){if(!h)try{h=l.call(o)===e}catch{}}),h}(o)}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":16,"call-bind/callBound":69,"for-each":107,gopd:111,"has-tostringtag/shams":114}],151:[function(m,ie,a){!function(R,I){"use strict";"function"==typeof define&&define.amd?define(I):"object"==typeof ie&&ie.exports?ie.exports=I():R.log=I()}(this,function(){"use strict";var R=function(){},I="undefined",E=typeof window!==I&&typeof window.navigator!==I&&/Trident\/|MSIE /.test(window.navigator.userAgent),_=["trace","debug","info","warn","error"];function d(n,o){var h=n[o];if("function"==typeof h.bind)return h.bind(n);try{return Function.prototype.bind.call(h,n)}catch{return function(){return Function.prototype.apply.apply(h,[n,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(n,o){for(var h=0;h<_.length;h++){var l=_[h];this[l]=h<n?R:this.methodFactory(l,n,o)}this.log=this.debug}function v(n,o,h){return function(){typeof console!==I&&(f.call(this,o,h),this[n].apply(this,arguments))}}function c(n,o,h){return function g(n){return"debug"===n&&(n="log"),typeof console!==I&&("trace"===n&&E?u:void 0!==console[n]?d(console,n):void 0!==console.log?d(console,"log"):R)}(n)||v.apply(this,arguments)}function i(n,o,h){var e,l=this;o=o??"WARN";var p="loglevel";function y(){var B;if(typeof window!==I&&p){try{B=window.localStorage[p]}catch{}if(typeof B===I)try{var J=window.document.cookie,z=J.indexOf(encodeURIComponent(p)+"=");-1!==z&&(B=/^([^;]+)/.exec(J.slice(z))[1])}catch{}return void 0===l.levels[B]&&(B=void 0),B}}"string"==typeof n?p+=":"+n:"symbol"==typeof n&&(p=void 0),l.name=n,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=h||c,l.getLevel=function(){return e},l.setLevel=function(B,J){if("string"==typeof B&&void 0!==l.levels[B.toUpperCase()]&&(B=l.levels[B.toUpperCase()]),!("number"==typeof B&&B>=0&&B<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+B;if(e=B,!1!==J&&function b(B){var J=(_[B]||"silent").toUpperCase();if(typeof window!==I&&p){try{return void(window.localStorage[p]=J)}catch{}try{window.document.cookie=encodeURIComponent(p)+"="+J+";"}catch{}}}(B),f.call(l,B,n),typeof console===I&&B<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(B){o=B,y()||l.setLevel(B,!1)},l.resetLevel=function(){l.setLevel(o,!1),function w(){if(typeof window!==I&&p){try{return void window.localStorage.removeItem(p)}catch{}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}()},l.enableAll=function(B){l.setLevel(l.levels.TRACE,B)},l.disableAll=function(B){l.setLevel(l.levels.SILENT,B)};var x=y();null==x&&(x=o),l.setLevel(x,!1)}var r=new i,s={};r.getLogger=function(o){if("symbol"!=typeof o&&"string"!=typeof o||""===o)throw new TypeError("You must supply a name when creating a logger.");var h=s[o];return h||(h=s[o]=new i(o,r.getLevel(),r.methodFactory)),h};var t=typeof window!==I?window.log:void 0;return r.noConflict=function(){return typeof window!==I&&window.log===r&&(window.log=t),r},r.getLoggers=function(){return s},r.default=r,r})},{}],152:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ExtensibleEvents=void 0;var R=m("./NamespacedMap"),I=m("./InvalidEventError"),E=m("./interpreters/legacy/MRoomMessage"),_=m("./interpreters/modern/MMessage"),d=m("./events/message_types"),u=m("./events/poll_types"),g=m("./interpreters/modern/MPoll");function c(o,h){(null==h||h>o.length)&&(h=o.length);for(var l=0,e=new Array(h);l<h;l++)e[l]=o[l];return e}function r(o,h){for(var l=0;l<h.length;l++){var e=h[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}function t(o,h,l){return h in o?Object.defineProperty(o,h,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[h]=l,o}var n=function(){function o(){(function i(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")})(this,o),t(this,"interpreters",new R.NamespacedMap([[E.LEGACY_M_ROOM_MESSAGE,E.parseMRoomMessage],[d.M_MESSAGE,_.parseMMessage],[d.M_EMOTE,_.parseMMessage],[d.M_NOTICE,_.parseMMessage],[u.M_POLL_START,g.parseMPoll],[u.M_POLL_RESPONSE,g.parseMPoll],[u.M_POLL_END,g.parseMPoll]])),t(this,"_unknownInterpretOrder",[d.M_MESSAGE])}return function s(o,h,l){h&&r(o.prototype,h),l&&r(o,l),Object.defineProperty(o,"prototype",{writable:!1})}(o,[{key:"unknownInterpretOrder",get:function(){var l;return null!==(l=this._unknownInterpretOrder)&&void 0!==l?l:[]},set:function(l){this._unknownInterpretOrder=l}},{key:"registerInterpreter",value:function(l,e){this.interpreters.set(l,e)}},{key:"parse",value:function(l){try{if(this.interpreters.hasNamespaced(l.type))return this.interpreters.getNamespaced(l.type)(l);var p,e=function f(o,h){var l=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!l){if(Array.isArray(o)||(l=function v(o,h){if(o){if("string"==typeof o)return c(o,h);var l=Object.prototype.toString.call(o).slice(8,-1);if("Object"===l&&o.constructor&&(l=o.constructor.name),"Map"===l||"Set"===l)return Array.from(o);if("Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return c(o,h)}}(o))||h&&o&&"number"==typeof o.length){l&&(o=l);var e=0,p=function(){};return{s:p,n:function(){return e>=o.length?{done:!0}:{done:!1,value:o[e++]}},e:function(B){throw B},f:p}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var w,b=!0,y=!1;return{s:function(){l=l.call(o)},n:function(){var B=l.next();return b=B.done,B},e:function(B){y=!0,w=B},f:function(){try{!b&&null!=l.return&&l.return()}finally{if(y)throw w}}}}(this.unknownInterpretOrder);try{for(e.s();!(p=e.n()).done;){var b=p.value;if(this.interpreters.has(b)){var y=this.interpreters.get(b)(l);if(y)return y}}}catch(w){e.e(w)}finally{e.f()}return null}catch(w){if(w instanceof I.InvalidEventError)return null;throw w}}}],[{key:"defaultInstance",get:function(){return o._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return o.defaultInstance.unknownInterpretOrder},set:function(l){o.defaultInstance.unknownInterpretOrder=l}},{key:"registerInterpreter",value:function(l,e){o.defaultInstance.registerInterpreter(l,e)}},{key:"parse",value:function(l){return o.defaultInstance.parse(l)}}]),o}();a.ExtensibleEvents=n,t(n,"_defaultInstance",new n)},{"./InvalidEventError":154,"./NamespacedMap":155,"./events/message_types":164,"./events/poll_types":165,"./interpreters/legacy/MRoomMessage":168,"./interpreters/modern/MMessage":169,"./interpreters/modern/MPoll":170}],153:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},{}],154:[function(m,ie,a){"use strict";function R(o){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(h){return typeof h}:function(h){return h&&"function"==typeof Symbol&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h})(o)}function I(o,h){for(var l=0;l<h.length;l++){var e=h[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}function v(o){var h="function"==typeof Map?new Map:void 0;return v=function(e){if(null===e||!function r(o){return-1!==Function.toString.call(o).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(e))return h.get(e);h.set(e,p)}function p(){return c(e,arguments,t(this).constructor)}return p.prototype=Object.create(e.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),s(p,e)},v(o)}function c(o,h,l){return(c=i()?Reflect.construct:function(p,b,y){var w=[null];w.push.apply(w,b);var B=new(Function.bind.apply(p,w));return y&&s(B,y.prototype),B}).apply(null,arguments)}function i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function s(o,h){return(s=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e})(o,h)}function t(o){return(t=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)})(o)}Object.defineProperty(a,"__esModule",{value:!0}),a.InvalidEventError=void 0;var n=function(o){!function d(o,h){if("function"!=typeof h&&null!==h)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(h&&h.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),h&&s(o,h)}(l,o);var h=function u(o){var h=i();return function(){var p,e=t(o);if(h){var b=t(this).constructor;p=Reflect.construct(e,arguments,b)}else p=e.apply(this,arguments);return function g(o,h){if(h&&("object"===R(h)||"function"==typeof h))return h;if(void 0!==h)throw new TypeError("Derived constructors may only return object or undefined");return function f(o){if(void 0===o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}(o)}(this,p)}}(l);function l(e){return function _(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}(this,l),h.call(this,e)}return function E(o,h,l){return h&&I(o.prototype,h),l&&I(o,l),Object.defineProperty(o,"prototype",{writable:!1}),o}(l)}(v(Error));a.InvalidEventError=n},{}],155:[function(m,ie,a){"use strict";function E(v,c){(null==c||c>v.length)&&(c=v.length);for(var i=0,r=new Array(c);i<c;i++)r[i]=v[i];return r}function d(v,c){for(var i=0;i<c.length;i++){var r=c[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(v,r.key,r)}}Object.defineProperty(a,"__esModule",{value:!0}),a.NamespacedMap=void 0,a.NamespacedMap=function(){function v(c){if(function _(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")}(this,v),function g(v,c,i){c in v?Object.defineProperty(v,c,{value:i,enumerable:!0,configurable:!0,writable:!0}):v[c]=i}(this,"internalMap",new Map),c){var r,i=function R(v,c){var i=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!i){if(Array.isArray(v)||(i=function I(v,c){if(v){if("string"==typeof v)return E(v,c);var i=Object.prototype.toString.call(v).slice(8,-1);if("Object"===i&&v.constructor&&(i=v.constructor.name),"Map"===i||"Set"===i)return Array.from(v);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return E(v,c)}}(v))||c&&v&&"number"==typeof v.length){i&&(v=i);var r=0,s=function(){};return{s,n:function(){return r>=v.length?{done:!0}:{done:!1,value:v[r++]}},e:function(l){throw l},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,t=!0,n=!1;return{s:function(){i=i.call(v)},n:function(){var l=i.next();return t=l.done,l},e:function(l){n=!0,o=l},f:function(){try{!t&&null!=i.return&&i.return()}finally{if(n)throw o}}}}(c);try{for(i.s();!(r=i.n()).done;){var s=r.value;this.set(s[0],s[1])}}catch(t){i.e(t)}finally{i.f()}}}return function u(v,c,i){c&&d(v.prototype,c),i&&d(v,i),Object.defineProperty(v,"prototype",{writable:!1})}(v,[{key:"get",value:function(i){return i.name&&this.internalMap.has(i.name)?this.internalMap.get(i.name):i.altName&&this.internalMap.has(i.altName)?this.internalMap.get(i.altName):null}},{key:"set",value:function(i,r){i.name&&this.internalMap.set(i.name,r),i.altName&&this.internalMap.set(i.altName,r)}},{key:"has",value:function(i){return!!this.get(i)}},{key:"delete",value:function(i){i.name&&this.internalMap.delete(i.name),i.altName&&this.internalMap.delete(i.altName)}},{key:"hasNamespaced",value:function(i){return this.internalMap.has(i)}},{key:"getNamespaced",value:function(i){return this.internalMap.get(i)}}]),v}()},{}],156:[function(m,ie,a){"use strict";function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(t)}function E(t,n){return(E=Object.setPrototypeOf||function(h,l){return h.__proto__=l,h})(t,n)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(t)}function v(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function c(t,n){for(var o=0;o<n.length;o++){var h=n[o];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function i(t,n,o){return n&&c(t.prototype,n),o&&c(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}Object.defineProperty(a,"__esModule",{value:!0}),a.UnstableValue=a.NamespacedValue=void 0;var r=function(){function t(n,o){if(v(this,t),this.stable=n,this.unstable=o,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return i(t,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(o){return!!this.name&&this.name===o||!!this.altName&&this.altName===o}},{key:"findIn",value:function(o){var h;return this.name&&(h=o?.[this.name]),!h&&this.altName&&(h=o?.[this.altName]),h}},{key:"includedIn",value:function(o){var h=!1;return this.name&&(h=o.includes(this.name)),!h&&this.altName&&(h=o.includes(this.altName)),h}}]),t}();a.NamespacedValue=r,a.UnstableValue=function(t){!function I(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&E(t,n)}(o,t);var n=function _(t){var n=function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var l,h=f(t);if(n){var e=f(this).constructor;l=Reflect.construct(h,arguments,e)}else l=h.apply(this,arguments);return function d(t,n){if(n&&("object"===R(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,l)}}(o);function o(h,l){var e;if(v(this,o),!(e=n.call(this,h,l)).unstable)throw new Error("Unstable value must be supplied");return e}return i(o,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),o}(r)},{}],157:[function(m,ie,a){"use strict";function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(e)}Object.defineProperty(a,"__esModule",{value:!0}),a.EmoteEvent=void 0;var I=m("./MessageEvent"),E=m("./message_types"),_=m("../utility/events");function d(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}function g(e,p){for(var b=0;b<p.length;b++){var y=p[b];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(e,y.key,y)}}function v(){return v=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,y){var w=function c(e,p){for(;!Object.prototype.hasOwnProperty.call(e,p)&&null!==(e=h(e)););return e}(p,b);if(w){var x=Object.getOwnPropertyDescriptor(w,b);return x.get?x.get.call(arguments.length<3?p:y):x.value}},v.apply(this,arguments)}function r(e,p){return(r=Object.setPrototypeOf||function(y,w){return y.__proto__=w,y})(e,p)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)})(e)}a.EmoteEvent=function(e){!function i(e,p){if("function"!=typeof p&&null!==p)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(p&&p.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),p&&r(e,p)}(b,e);var p=function s(e){var p=function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,y=h(e);if(p){var x=h(this).constructor;w=Reflect.construct(y,arguments,x)}else w=y.apply(this,arguments);return function t(e,p){if(p&&("object"===R(p)||"function"==typeof p))return p;if(void 0!==p)throw new TypeError("Derived constructors may only return object or undefined");return function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,w)}}(b);function b(y){return function u(e,p){if(!(e instanceof p))throw new TypeError("Cannot call a class as a function")}(this,b),p.call(this,y)}return function f(e,p,b){p&&g(e.prototype,p),b&&g(e,b),Object.defineProperty(e,"prototype",{writable:!1})}(b,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(w){return(0,_.isEventTypeSame)(w,E.M_EMOTE)||v(h(b.prototype),"isEquivalentTo",this).call(this,w)}},{key:"serialize",value:function(){var w=v(h(b.prototype),"serialize",this).call(this);return w.content.msgtype="m.emote",w}}],[{key:"from",value:function(w,x){var B;return new b({type:E.M_EMOTE.name,content:(B={},d(B,E.M_TEXT.name,w),d(B,E.M_HTML.name,x),B)})}}]),b}(I.MessageEvent)},{"../utility/events":173,"./MessageEvent":159,"./message_types":164}],158:[function(m,ie,a){"use strict";function I(d,u){for(var g=0;g<u.length;g++){var f=u[g];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(d,f.key,f)}}Object.defineProperty(a,"__esModule",{value:!0}),a.ExtensibleEvent=void 0,a.ExtensibleEvent=function(){function d(u){(function R(d,u){if(!(d instanceof u))throw new TypeError("Cannot call a class as a function")})(this,d),this.wireFormat=u}return function E(d,u,g){u&&I(d.prototype,u),g&&I(d,g),Object.defineProperty(d,"prototype",{writable:!1})}(d,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),d}()},{}],159:[function(m,ie,a){"use strict";function R(b){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(b)}Object.defineProperty(a,"__esModule",{value:!0}),a.MessageEvent=void 0;var I=m("./ExtensibleEvent"),E=m("../types"),_=m("../InvalidEventError"),d=m("./message_types"),u=m("../utility/events");function g(b,y){var w=Object.keys(b);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(b);y&&(x=x.filter(function(B){return Object.getOwnPropertyDescriptor(b,B).enumerable})),w.push.apply(w,x)}return w}function f(b){for(var y=1;y<arguments.length;y++){var w=null!=arguments[y]?arguments[y]:{};y%2?g(Object(w),!0).forEach(function(x){e(b,x,w[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(w)):g(Object(w)).forEach(function(x){Object.defineProperty(b,x,Object.getOwnPropertyDescriptor(w,x))})}return b}function c(b,y){for(var w=0;w<y.length;w++){var x=y[w];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(b,x.key,x)}}function s(b,y){return(s=Object.setPrototypeOf||function(x,B){return x.__proto__=B,x})(b,y)}function o(b){if(void 0===b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function l(b){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(w){return w.__proto__||Object.getPrototypeOf(w)})(b)}function e(b,y,w){return y in b?Object.defineProperty(b,y,{value:w,enumerable:!0,configurable:!0,writable:!0}):b[y]=w,b}a.MessageEvent=function(b){!function r(b,y){if("function"!=typeof y&&null!==y)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(y&&y.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),Object.defineProperty(b,"prototype",{writable:!1}),y&&s(b,y)}(w,b);var y=function t(b){var y=function h(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var B,x=l(b);if(y){var J=l(this).constructor;B=Reflect.construct(x,arguments,J)}else B=x.apply(this,arguments);return function n(b,y){if(y&&("object"===R(y)||"function"==typeof y))return y;if(void 0!==y)throw new TypeError("Derived constructors may only return object or undefined");return o(b)}(this,B)}}(w);function w(x){var B;(function v(b,y){if(!(b instanceof y))throw new TypeError("Cannot call a class as a function")})(this,w),e(o(B=y.call(this,x)),"text",void 0),e(o(B),"html",void 0),e(o(B),"renderings",void 0);var J=d.M_MESSAGE.findIn(B.wireContent),z=d.M_TEXT.findIn(B.wireContent),M=d.M_HTML.findIn(B.wireContent);if((0,E.isProvided)(J)){if(!Array.isArray(J))throw new _.InvalidEventError("m.message contents must be an array");var L=J.find(function(C){return!(0,E.isProvided)(C.mimetype)||"text/plain"===C.mimetype}),j=J.find(function(C){return"text/html"===C.mimetype});if(!L)throw new _.InvalidEventError("m.message is missing a plain text representation");B.text=L.body,B.html=j?.body,B.renderings=J}else{if(!(0,E.isOptionalAString)(z))throw new _.InvalidEventError("Missing textual representation for event");B.text=z,B.html=M,B.renderings=[{body:z,mimetype:"text/plain"}],B.html&&B.renderings.push({body:B.html,mimetype:"text/html"})}return B}return function i(b,y,w){y&&c(b.prototype,y),w&&c(b,w),Object.defineProperty(b,"prototype",{writable:!1})}(w,[{key:"isEmote",get:function(){return d.M_EMOTE.matches(this.wireFormat.type)||(0,E.isProvided)(d.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return d.M_NOTICE.matches(this.wireFormat.type)||(0,E.isProvided)(d.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(B){return(0,u.isEventTypeSame)(B,d.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var B=e({},d.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var J=this.renderings[0].mimetype;(void 0===J||"text/plain"===J)&&(B=e({},d.M_TEXT.name,this.renderings[0].body))}return B}},{key:"serialize",value:function(){var B;return{type:"m.room.message",content:f(f({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(B=this.html)&&void 0!==B?B:void 0})}}}],[{key:"from",value:function(B,J){var z;return new w({type:d.M_MESSAGE.name,content:(z={},e(z,d.M_TEXT.name,B),e(z,d.M_HTML.name,J),z)})}}]),w}(I.ExtensibleEvent)},{"../InvalidEventError":154,"../types":171,"../utility/events":173,"./ExtensibleEvent":158,"./message_types":164}],160:[function(m,ie,a){"use strict";function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(e)}Object.defineProperty(a,"__esModule",{value:!0}),a.NoticeEvent=void 0;var I=m("./MessageEvent"),E=m("./message_types"),_=m("../utility/events");function d(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}function g(e,p){for(var b=0;b<p.length;b++){var y=p[b];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(e,y.key,y)}}function v(){return v=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,y){var w=function c(e,p){for(;!Object.prototype.hasOwnProperty.call(e,p)&&null!==(e=h(e)););return e}(p,b);if(w){var x=Object.getOwnPropertyDescriptor(w,b);return x.get?x.get.call(arguments.length<3?p:y):x.value}},v.apply(this,arguments)}function r(e,p){return(r=Object.setPrototypeOf||function(y,w){return y.__proto__=w,y})(e,p)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)})(e)}a.NoticeEvent=function(e){!function i(e,p){if("function"!=typeof p&&null!==p)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(p&&p.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),p&&r(e,p)}(b,e);var p=function s(e){var p=function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,y=h(e);if(p){var x=h(this).constructor;w=Reflect.construct(y,arguments,x)}else w=y.apply(this,arguments);return function t(e,p){if(p&&("object"===R(p)||"function"==typeof p))return p;if(void 0!==p)throw new TypeError("Derived constructors may only return object or undefined");return function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,w)}}(b);function b(y){return function u(e,p){if(!(e instanceof p))throw new TypeError("Cannot call a class as a function")}(this,b),p.call(this,y)}return function f(e,p,b){p&&g(e.prototype,p),b&&g(e,b),Object.defineProperty(e,"prototype",{writable:!1})}(b,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(w){return(0,_.isEventTypeSame)(w,E.M_NOTICE)||v(h(b.prototype),"isEquivalentTo",this).call(this,w)}},{key:"serialize",value:function(){var w=v(h(b.prototype),"serialize",this).call(this);return w.content.msgtype="m.notice",w}}],[{key:"from",value:function(w,x){var B;return new b({type:E.M_NOTICE.name,content:(B={},d(B,E.M_TEXT.name,w),d(B,E.M_HTML.name,x),B)})}}]),b}(I.MessageEvent)},{"../utility/events":173,"./MessageEvent":159,"./message_types":164}],161:[function(m,ie,a){"use strict";function R(w){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(w)}Object.defineProperty(a,"__esModule",{value:!0}),a.PollEndEvent=void 0;var I=m("./poll_types"),E=m("../InvalidEventError"),_=m("./relationship_types"),d=m("./MessageEvent"),u=m("./message_types"),g=m("../utility/events"),f=m("./ExtensibleEvent");function v(w,x){var B=Object.keys(w);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(w);x&&(J=J.filter(function(z){return Object.getOwnPropertyDescriptor(w,z).enumerable})),B.push.apply(B,J)}return B}function c(w){for(var x=1;x<arguments.length;x++){var B=null!=arguments[x]?arguments[x]:{};x%2?v(Object(B),!0).forEach(function(J){b(w,J,B[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(B)):v(Object(B)).forEach(function(J){Object.defineProperty(w,J,Object.getOwnPropertyDescriptor(B,J))})}return w}function r(w,x){for(var B=0;B<x.length;B++){var J=x[B];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(w,J.key,J)}}function n(w,x){return(n=Object.setPrototypeOf||function(J,z){return J.__proto__=z,J})(w,x)}function l(w){if(void 0===w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function p(w){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)})(w)}function b(w,x,B){return x in w?Object.defineProperty(w,x,{value:B,enumerable:!0,configurable:!0,writable:!0}):w[x]=B,w}a.PollEndEvent=function(w){!function t(w,x){if("function"!=typeof x&&null!==x)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(x&&x.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),x&&n(w,x)}(B,w);var x=function o(w){var x=function e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var z,J=p(w);if(x){var M=p(this).constructor;z=Reflect.construct(J,arguments,M)}else z=J.apply(this,arguments);return function h(w,x){if(x&&("object"===R(x)||"function"==typeof x))return x;if(void 0!==x)throw new TypeError("Derived constructors may only return object or undefined");return l(w)}(this,z)}}(B);function B(J){var z;(function i(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")})(this,B),b(l(z=x.call(this,J)),"pollEventId",void 0),b(l(z),"closingMessage",void 0);var M=z.wireContent["m.relates_to"];if(!_.REFERENCE_RELATION.matches(M?.rel_type)||"string"!=typeof M?.event_id)throw new E.InvalidEventError("Relationship must be a reference to an event");return z.pollEventId=M.event_id,z.closingMessage=new d.MessageEvent(z.wireFormat),z}return function s(w,x,B){x&&r(w.prototype,x),B&&r(w,B),Object.defineProperty(w,"prototype",{writable:!1})}(B,[{key:"isEquivalentTo",value:function(z){return(0,g.isEventTypeSame)(z,I.M_POLL_END)}},{key:"serialize",value:function(){return{type:I.M_POLL_END.name,content:c(b({"m.relates_to":{rel_type:_.REFERENCE_RELATION.name,event_id:this.pollEventId}},I.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(z,M){var L;return new B({type:I.M_POLL_END.name,content:(L={"m.relates_to":{rel_type:_.REFERENCE_RELATION.name,event_id:z}},b(L,I.M_POLL_END.name,{}),b(L,u.M_TEXT.name,M),L)})}}]),B}(f.ExtensibleEvent)},{"../InvalidEventError":154,"../utility/events":173,"./ExtensibleEvent":158,"./MessageEvent":159,"./message_types":164,"./poll_types":165,"./relationship_types":166}],162:[function(m,ie,a){"use strict";function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(e)}Object.defineProperty(a,"__esModule",{value:!0}),a.PollResponseEvent=void 0;var I=m("./ExtensibleEvent"),E=m("./poll_types"),_=m("../InvalidEventError"),d=m("./relationship_types"),u=m("../utility/events");function f(e,p){for(var b=0;b<p.length;b++){var y=p[b];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(e,y.key,y)}}function i(e,p){return(i=Object.setPrototypeOf||function(y,w){return y.__proto__=w,y})(e,p)}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)})(e)}function h(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}a.PollResponseEvent=function(e){!function c(e,p){if("function"!=typeof p&&null!==p)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(p&&p.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),p&&i(e,p)}(b,e);var p=function r(e){var p=function n(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,y=o(e);if(p){var x=o(this).constructor;w=Reflect.construct(y,arguments,x)}else w=y.apply(this,arguments);return function s(e,p){if(p&&("object"===R(p)||"function"==typeof p))return p;if(void 0!==p)throw new TypeError("Derived constructors may only return object or undefined");return t(e)}(this,w)}}(b);function b(y){var w;(function g(e,p){if(!(e instanceof p))throw new TypeError("Cannot call a class as a function")})(this,b),h(t(w=p.call(this,y)),"internalAnswerIds",void 0),h(t(w),"internalSpoiled",void 0),h(t(w),"pollEventId",void 0);var x=w.wireContent["m.relates_to"];if(!d.REFERENCE_RELATION.matches(x?.rel_type)||"string"!=typeof x?.event_id)throw new _.InvalidEventError("Relationship must be a reference to an event");return w.pollEventId=x.event_id,w.validateAgainst(null),w}return function v(e,p,b){p&&f(e.prototype,p),b&&f(e,b),Object.defineProperty(e,"prototype",{writable:!1})}(b,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(w){var x=E.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(x?.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var B=x.answers;if(B.some(function(J){return"string"!=typeof J})||0===B.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(w){if(B.some(function(J){return!w.answers.some(function(z){return z.id===J})}))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);B=B.slice(0,w.maxSelections)}this.internalAnswerIds=B,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(w){return(0,u.isEventTypeSame)(w,E.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:E.M_POLL_RESPONSE.name,content:h({"m.relates_to":{rel_type:d.REFERENCE_RELATION.name,event_id:this.pollEventId}},E.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(w,x){return new b({type:E.M_POLL_RESPONSE.name,content:h({"m.relates_to":{rel_type:d.REFERENCE_RELATION.name,event_id:x}},E.M_POLL_RESPONSE.name,{answers:w})})}}]),b}(I.ExtensibleEvent)},{"../InvalidEventError":154,"../utility/events":173,"./ExtensibleEvent":158,"./poll_types":165,"./relationship_types":166}],163:[function(m,ie,a){"use strict";function R(F){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(V){return typeof V}:function(V){return V&&"function"==typeof Symbol&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V})(F)}Object.defineProperty(a,"__esModule",{value:!0}),a.PollStartEvent=a.PollAnswerSubevent=void 0;var I=m("./poll_types"),E=m("./MessageEvent"),_=m("./message_types"),d=m("../InvalidEventError"),u=m("../NamespacedValue"),g=m("../utility/events"),f=m("./ExtensibleEvent");function v(F){return function s(F){if(Array.isArray(F))return t(F)}(F)||function r(F){if(typeof Symbol<"u"&&null!=F[Symbol.iterator]||null!=F["@@iterator"])return Array.from(F)}(F)||function i(F,V){if(F){if("string"==typeof F)return t(F,V);var N=Object.prototype.toString.call(F).slice(8,-1);if("Object"===N&&F.constructor&&(N=F.constructor.name),"Map"===N||"Set"===N)return Array.from(F);if("Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N))return t(F,V)}}(F)||function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(F,V){(null==V||V>F.length)&&(V=F.length);for(var N=0,T=new Array(V);N<V;N++)T[N]=F[N];return T}function n(F,V){var N=Object.keys(F);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(F);V&&(T=T.filter(function(S){return Object.getOwnPropertyDescriptor(F,S).enumerable})),N.push.apply(N,T)}return N}function o(F){for(var V=1;V<arguments.length;V++){var N=null!=arguments[V]?arguments[V]:{};V%2?n(Object(N),!0).forEach(function(T){z(F,T,N[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(N)):n(Object(N)).forEach(function(T){Object.defineProperty(F,T,Object.getOwnPropertyDescriptor(N,T))})}return F}function h(F,V){if(!(F instanceof V))throw new TypeError("Cannot call a class as a function")}function l(F,V){for(var N=0;N<V.length;N++){var T=V[N];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(F,T.key,T)}}function e(F,V,N){return V&&l(F.prototype,V),N&&l(F,N),Object.defineProperty(F,"prototype",{writable:!1}),F}function p(F,V){if("function"!=typeof V&&null!==V)throw new TypeError("Super expression must either be null or a function");F.prototype=Object.create(V&&V.prototype,{constructor:{value:F,writable:!0,configurable:!0}}),Object.defineProperty(F,"prototype",{writable:!1}),V&&b(F,V)}function b(F,V){return(b=Object.setPrototypeOf||function(T,S){return T.__proto__=S,T})(F,V)}function y(F){var V=function B(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var S,T=J(F);if(V){var U=J(this).constructor;S=Reflect.construct(T,arguments,U)}else S=T.apply(this,arguments);return function w(F,V){if(V&&("object"===R(V)||"function"==typeof V))return V;if(void 0!==V)throw new TypeError("Derived constructors may only return object or undefined");return x(F)}(this,S)}}function x(F){if(void 0===F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}function J(F){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)})(F)}function z(F,V,N){return V in F?Object.defineProperty(F,V,{value:N,enumerable:!0,configurable:!0,writable:!0}):F[V]=N,F}var M=function(F){p(N,F);var V=y(N);function N(T){var S;h(this,N),z(x(S=V.call(this,T)),"id",void 0);var U=T.content.id;if(!U||"string"!=typeof U)throw new d.InvalidEventError("Answer ID must be a non-empty string");return S.id=U,S}return e(N,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:o({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(S,U){return new N({type:"org.matrix.sdk.poll.answer",content:z({id:S},_.M_TEXT.name,U)})}}]),N}(E.MessageEvent);a.PollAnswerSubevent=M;var L=function(F){p(N,F);var V=y(N);function N(T){var S;h(this,N),z(x(S=V.call(this,T)),"question",void 0),z(x(S),"kind",void 0),z(x(S),"rawKind",void 0),z(x(S),"maxSelections",void 0),z(x(S),"answers",void 0);var U=I.M_POLL_START.findIn(S.wireContent);if(!U.question)throw new d.InvalidEventError("A question is required");if(S.question=new E.MessageEvent({type:"org.matrix.sdk.poll.question",content:U.question}),S.rawKind=U.kind,S.kind=I.M_POLL_KIND_DISCLOSED.matches(S.rawKind)?I.M_POLL_KIND_DISCLOSED:I.M_POLL_KIND_UNDISCLOSED,S.maxSelections=Number.isFinite(U.max_selections)&&U.max_selections>0?U.max_selections:1,!Array.isArray(U.answers))throw new d.InvalidEventError("Poll answers must be an array");var W=U.answers.slice(0,20).map(function(k){return new M({type:"org.matrix.sdk.poll.answer",content:k})});if(W.length<=0)throw new d.InvalidEventError("No answers available");return S.answers=W,S}return e(N,[{key:"isEquivalentTo",value:function(S){return(0,g.isEventTypeSame)(S,I.M_POLL_START)}},{key:"serialize",value:function(){var S;return{type:I.M_POLL_START.name,content:(S={},z(S,I.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(U){return U.serialize().content})}),z(S,_.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map(function(U,W){return"".concat(W+1,". ").concat(U.text)}).join("\n"))),S)}}}],[{key:"from",value:function(S,U,W){var k,D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new N({type:I.M_POLL_START.name,content:(k={},z(k,_.M_TEXT.name,S),z(k,I.M_POLL_START.name,{question:z({},_.M_TEXT.name,S),kind:W instanceof u.NamespacedValue?W.name:W,max_selections:D,answers:U.map(function(Q){return z({id:v(Array(16)).map(function(){return j.charAt(Math.floor(Math.random()*j.length))}).join("")},_.M_TEXT.name,Q)})}),k)})}}]),N}(f.ExtensibleEvent);a.PollStartEvent=L;var j="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"},{"../InvalidEventError":154,"../NamespacedValue":156,"../utility/events":173,"./ExtensibleEvent":158,"./MessageEvent":159,"./message_types":164,"./poll_types":165}],164:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.M_TEXT=a.M_NOTICE=a.M_MESSAGE=a.M_HTML=a.M_EMOTE=void 0;var R=m("../NamespacedValue"),I=new R.UnstableValue("m.message","org.matrix.msc1767.message");a.M_MESSAGE=I;var E=new R.UnstableValue("m.text","org.matrix.msc1767.text");a.M_TEXT=E;var _=new R.UnstableValue("m.html","org.matrix.msc1767.html");a.M_HTML=_;var d=new R.UnstableValue("m.emote","org.matrix.msc1767.emote");a.M_EMOTE=d;var u=new R.UnstableValue("m.notice","org.matrix.msc1767.notice");a.M_NOTICE=u},{"../NamespacedValue":156}],165:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.M_POLL_START=a.M_POLL_RESPONSE=a.M_POLL_KIND_UNDISCLOSED=a.M_POLL_KIND_DISCLOSED=a.M_POLL_END=void 0;var R=m("../NamespacedValue"),I=new R.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");a.M_POLL_KIND_DISCLOSED=I;var E=new R.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");a.M_POLL_KIND_UNDISCLOSED=E;var _=new R.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");a.M_POLL_START=_;var d=new R.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");a.M_POLL_RESPONSE=d;var u=new R.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");a.M_POLL_END=u},{"../NamespacedValue":156}],166:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.REFERENCE_RELATION=void 0;var I=new(m("../NamespacedValue").NamespacedValue)("m.reference");a.REFERENCE_RELATION=I},{"../NamespacedValue":156}],167:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var R=m("./ExtensibleEvents");Object.keys(R).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===R[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return R[y]}})});var I=m("./IPartialEvent");Object.keys(I).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===I[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return I[y]}})});var E=m("./InvalidEventError");Object.keys(E).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===E[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return E[y]}})});var _=m("./NamespacedValue");Object.keys(_).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===_[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return _[y]}})});var d=m("./NamespacedMap");Object.keys(d).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===d[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return d[y]}})});var u=m("./types");Object.keys(u).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===u[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return u[y]}})});var g=m("./utility/MessageMatchers");Object.keys(g).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===g[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return g[y]}})});var f=m("./utility/events");Object.keys(f).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===f[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return f[y]}})});var v=m("./interpreters/legacy/MRoomMessage");Object.keys(v).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===v[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return v[y]}})});var c=m("./interpreters/modern/MMessage");Object.keys(c).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===c[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return c[y]}})});var i=m("./interpreters/modern/MPoll");Object.keys(i).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===i[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return i[y]}})});var r=m("./events/relationship_types");Object.keys(r).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===r[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return r[y]}})});var s=m("./events/ExtensibleEvent");Object.keys(s).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===s[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return s[y]}})});var t=m("./events/message_types");Object.keys(t).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===t[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return t[y]}})});var n=m("./events/MessageEvent");Object.keys(n).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===n[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return n[y]}})});var o=m("./events/EmoteEvent");Object.keys(o).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===o[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return o[y]}})});var h=m("./events/NoticeEvent");Object.keys(h).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===h[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return h[y]}})});var l=m("./events/poll_types");Object.keys(l).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===l[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return l[y]}})});var e=m("./events/PollStartEvent");Object.keys(e).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===e[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return e[y]}})});var p=m("./events/PollResponseEvent");Object.keys(p).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===p[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return p[y]}})});var b=m("./events/PollEndEvent");Object.keys(b).forEach(function(y){"default"===y||"__esModule"===y||y in a&&a[y]===b[y]||Object.defineProperty(a,y,{enumerable:!0,get:function(){return b[y]}})})},{"./ExtensibleEvents":152,"./IPartialEvent":153,"./InvalidEventError":154,"./NamespacedMap":155,"./NamespacedValue":156,"./events/EmoteEvent":157,"./events/ExtensibleEvent":158,"./events/MessageEvent":159,"./events/NoticeEvent":160,"./events/PollEndEvent":161,"./events/PollResponseEvent":162,"./events/PollStartEvent":163,"./events/message_types":164,"./events/poll_types":165,"./events/relationship_types":166,"./interpreters/legacy/MRoomMessage":168,"./interpreters/modern/MMessage":169,"./interpreters/modern/MPoll":170,"./types":171,"./utility/MessageMatchers":172,"./utility/events":173}],168:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.LEGACY_M_ROOM_MESSAGE=void 0,a.parseMRoomMessage=function c(i){var r,s,t;if(d.M_MESSAGE.findIn(i.content)||d.M_TEXT.findIn(i.content))return new R.MessageEvent(i);var l,e,p,n=null===(r=i.content)||void 0===r?void 0:r.msgtype,o=null===(s=i.content)||void 0===s?void 0:s.body,h="org.matrix.custom.html"===(null===(t=i.content)||void 0===t?void 0:t.format)?i.content.formatted_body:null;return"m.text"===n?new R.MessageEvent(g(g({},i),{},{content:g(g({},i.content),{},(l={},f(l,d.M_TEXT.name,o),f(l,d.M_HTML.name,h),l))})):"m.notice"===n?new I.NoticeEvent(g(g({},i),{},{content:g(g({},i.content),{},(e={},f(e,d.M_TEXT.name,o),f(e,d.M_HTML.name,h),e))})):"m.emote"===n?new E.EmoteEvent(g(g({},i),{},{content:g(g({},i.content),{},(p={},f(p,d.M_TEXT.name,o),f(p,d.M_HTML.name,h),p))})):null};var R=m("../../events/MessageEvent"),I=m("../../events/NoticeEvent"),E=m("../../events/EmoteEvent"),_=m("../../NamespacedValue"),d=m("../../events/message_types");function u(i,r){var s=Object.keys(i);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(i);r&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),s.push.apply(s,t)}return s}function g(i){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?u(Object(s),!0).forEach(function(t){f(i,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(s,t))})}return i}function f(i,r,s){return r in i?Object.defineProperty(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,i}var v=new _.NamespacedValue("m.room.message");a.LEGACY_M_ROOM_MESSAGE=v},{"../../NamespacedValue":156,"../../events/EmoteEvent":157,"../../events/MessageEvent":159,"../../events/NoticeEvent":160,"../../events/message_types":164}],169:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.parseMMessage=function d(u){return I.M_EMOTE.matches(u.type)?new E.EmoteEvent(u):I.M_NOTICE.matches(u.type)?new _.NoticeEvent(u):new R.MessageEvent(u)};var R=m("../../events/MessageEvent"),I=m("../../events/message_types"),E=m("../../events/EmoteEvent"),_=m("../../events/NoticeEvent")},{"../../events/EmoteEvent":157,"../../events/MessageEvent":159,"../../events/NoticeEvent":160,"../../events/message_types":164}],170:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.parseMPoll=function d(u){return R.M_POLL_START.matches(u.type)?new I.PollStartEvent(u):R.M_POLL_RESPONSE.matches(u.type)?new E.PollResponseEvent(u):R.M_POLL_END.matches(u.type)?new _.PollEndEvent(u):null};var R=m("../../events/poll_types"),I=m("../../events/PollStartEvent"),E=m("../../events/PollResponseEvent"),_=m("../../events/PollEndEvent")},{"../../events/PollEndEvent":161,"../../events/PollResponseEvent":162,"../../events/PollStartEvent":163,"../../events/poll_types":165}],171:[function(m,ie,a){"use strict";function I(E){return null!=E}Object.defineProperty(a,"__esModule",{value:!0}),a.isOptionalAString=function R(E){return I(E)&&"string"==typeof E},a.isProvided=I},{}],172:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.LegacyMsgType=void 0,a.isEventLike=function E(_,d){var u=_.content;return d===I.Text?R.M_MESSAGE.matches(_.type)||"m.room.message"===_.type&&"m.text"===u?.msgtype:d===I.Emote?R.M_EMOTE.matches(_.type)||"m.room.message"===_.type&&"m.emote"===u?.msgtype:d===I.Notice&&(R.M_NOTICE.matches(_.type)||"m.room.message"===_.type&&"m.notice"===u?.msgtype)};var I,_,R=m("../events/message_types");a.LegacyMsgType=I,(_=I||(a.LegacyMsgType=I={})).Text="m.text",_.Notice="m.notice",_.Emote="m.emote"},{"../events/message_types":164}],173:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isEventTypeSame=function R(I,E){if("string"==typeof I)return"string"==typeof E?E===I:E.matches(I);if("string"==typeof E)return I.matches(E);var _=E,d=I;return _.matches(d.name)||_.matches(d.altName)}},{}],174:[function(m,ie,a){"use strict";function R(N){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&"function"==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(N)}Object.defineProperty(a,"__esModule",{value:!0}),a.ClientWidgetApi=void 0;var I=m("events"),E=m("./transport/PostmessageTransport"),_=m("./interfaces/WidgetApiDirection"),d=m("./interfaces/WidgetApiAction"),u=m("./interfaces/Capabilities"),g=m("./interfaces/ApiVersion"),f=m("./models/WidgetEventCapability"),v=m("./interfaces/GetOpenIDAction"),c=m("./util/SimpleObservable"),i=m("./Symbols");function r(){r=function(){return N};var N={},T=Object.prototype,S=T.hasOwnProperty,U="function"==typeof Symbol?Symbol:{},W=U.iterator||"@@iterator",k=U.asyncIterator||"@@asyncIterator",D=U.toStringTag||"@@toStringTag";function Q(_e,Se,De){return Object.defineProperty(_e,Se,{value:De,enumerable:!0,configurable:!0,writable:!0}),_e[Se]}try{Q({},"")}catch{Q=function(De,Ae,Ne){return De[Ae]=Ne}}function ee(_e,Se,De,Ae){var Ge,Ue,K,Y,qe=Object.create((Se&&Se.prototype instanceof be?Se:be).prototype),Be=new pe(Ae||[]);return qe._invoke=(Ge=_e,Ue=De,K=Be,Y="suspendedStart",function(oe,le){if("executing"===Y)throw new Error("Generator is already running");if("completed"===Y){if("throw"===oe)throw le;return{value:void 0,done:!0}}for(K.method=oe,K.arg=le;;){var ge=K.delegate;if(ge){var Ie=G(ge,K);if(Ie){if(Ie===ue)continue;return Ie}}if("next"===K.method)K.sent=K._sent=K.arg;else if("throw"===K.method){if("suspendedStart"===Y)throw Y="completed",K.arg;K.dispatchException(K.arg)}else"return"===K.method&&K.abrupt("return",K.arg);Y="executing";var Ce=ae(Ge,Ue,K);if("normal"===Ce.type){if(Y=K.done?"completed":"suspendedYield",Ce.arg===ue)continue;return{value:Ce.arg,done:K.done}}"throw"===Ce.type&&(Y="completed",K.method="throw",K.arg=Ce.arg)}}),qe}function ae(_e,Se,De){try{return{type:"normal",arg:_e.call(Se,De)}}catch(Ae){return{type:"throw",arg:Ae}}}N.wrap=ee;var ue={};function be(){}function X(){}function H(){}var ne={};Q(ne,W,function(){return this});var ce=Object.getPrototypeOf,te=ce&&ce(ce(me([])));te&&te!==T&&S.call(te,W)&&(ne=te);var P=H.prototype=be.prototype=Object.create(ne);function A(_e){["next","throw","return"].forEach(function(Se){Q(_e,Se,function(De){return this._invoke(Se,De)})})}function $(_e,Se){function De(Ne,qe,Be,Ge){var Ue=ae(_e[Ne],_e,qe);if("throw"!==Ue.type){var K=Ue.arg,Y=K.value;return Y&&"object"==R(Y)&&S.call(Y,"__await")?Se.resolve(Y.__await).then(function(oe){De("next",oe,Be,Ge)},function(oe){De("throw",oe,Be,Ge)}):Se.resolve(Y).then(function(oe){K.value=oe,Be(K)},function(oe){return De("throw",oe,Be,Ge)})}Ge(Ue.arg)}var Ae;this._invoke=function(Ne,qe){function Be(){return new Se(function(Ge,Ue){De(Ne,qe,Ge,Ue)})}return Ae=Ae?Ae.then(Be,Be):Be()}}function G(_e,Se){var De=_e.iterator[Se.method];if(void 0===De){if(Se.delegate=null,"throw"===Se.method){if(_e.iterator.return&&(Se.method="return",Se.arg=void 0,G(_e,Se),"throw"===Se.method))return ue;Se.method="throw",Se.arg=new TypeError("The iterator does not provide a 'throw' method")}return ue}var Ae=ae(De,_e.iterator,Se.arg);if("throw"===Ae.type)return Se.method="throw",Se.arg=Ae.arg,Se.delegate=null,ue;var Ne=Ae.arg;return Ne?Ne.done?(Se[_e.resultName]=Ne.value,Se.next=_e.nextLoc,"return"!==Se.method&&(Se.method="next",Se.arg=void 0),Se.delegate=null,ue):Ne:(Se.method="throw",Se.arg=new TypeError("iterator result is not an object"),Se.delegate=null,ue)}function se(_e){var Se={tryLoc:_e[0]};1 in _e&&(Se.catchLoc=_e[1]),2 in _e&&(Se.finallyLoc=_e[2],Se.afterLoc=_e[3]),this.tryEntries.push(Se)}function he(_e){var Se=_e.completion||{};Se.type="normal",delete Se.arg,_e.completion=Se}function pe(_e){this.tryEntries=[{tryLoc:"root"}],_e.forEach(se,this),this.reset(!0)}function me(_e){if(_e){var Se=_e[W];if(Se)return Se.call(_e);if("function"==typeof _e.next)return _e;if(!isNaN(_e.length)){var De=-1,Ae=function Ne(){for(;++De<_e.length;)if(S.call(_e,De))return Ne.value=_e[De],Ne.done=!1,Ne;return Ne.value=void 0,Ne.done=!0,Ne};return Ae.next=Ae}}return{next:Ee}}function Ee(){return{value:void 0,done:!0}}return X.prototype=H,Q(P,"constructor",H),Q(H,"constructor",X),X.displayName=Q(H,D,"GeneratorFunction"),N.isGeneratorFunction=function(_e){var Se="function"==typeof _e&&_e.constructor;return!!Se&&(Se===X||"GeneratorFunction"===(Se.displayName||Se.name))},N.mark=function(_e){return Object.setPrototypeOf?Object.setPrototypeOf(_e,H):(_e.__proto__=H,Q(_e,D,"GeneratorFunction")),_e.prototype=Object.create(P),_e},N.awrap=function(_e){return{__await:_e}},A($.prototype),Q($.prototype,k,function(){return this}),N.AsyncIterator=$,N.async=function(_e,Se,De,Ae,Ne){void 0===Ne&&(Ne=Promise);var qe=new $(ee(_e,Se,De,Ae),Ne);return N.isGeneratorFunction(Se)?qe:qe.next().then(function(Be){return Be.done?Be.value:qe.next()})},A(P),Q(P,D,"Generator"),Q(P,W,function(){return this}),Q(P,"toString",function(){return"[object Generator]"}),N.keys=function(_e){var Se=[];for(var De in _e)Se.push(De);return Se.reverse(),function Ae(){for(;Se.length;){var Ne=Se.pop();if(Ne in _e)return Ae.value=Ne,Ae.done=!1,Ae}return Ae.done=!0,Ae}},N.values=me,pe.prototype={constructor:pe,reset:function(Se){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(he),!Se)for(var De in this)"t"===De.charAt(0)&&S.call(this,De)&&!isNaN(+De.slice(1))&&(this[De]=void 0)},stop:function(){this.done=!0;var Se=this.tryEntries[0].completion;if("throw"===Se.type)throw Se.arg;return this.rval},dispatchException:function(Se){if(this.done)throw Se;var De=this;function Ae(K,Y){return Be.type="throw",Be.arg=Se,De.next=K,Y&&(De.method="next",De.arg=void 0),!!Y}for(var Ne=this.tryEntries.length-1;Ne>=0;--Ne){var qe=this.tryEntries[Ne],Be=qe.completion;if("root"===qe.tryLoc)return Ae("end");if(qe.tryLoc<=this.prev){var Ge=S.call(qe,"catchLoc"),Ue=S.call(qe,"finallyLoc");if(Ge&&Ue){if(this.prev<qe.catchLoc)return Ae(qe.catchLoc,!0);if(this.prev<qe.finallyLoc)return Ae(qe.finallyLoc)}else if(Ge){if(this.prev<qe.catchLoc)return Ae(qe.catchLoc,!0)}else{if(!Ue)throw new Error("try statement without catch or finally");if(this.prev<qe.finallyLoc)return Ae(qe.finallyLoc)}}}},abrupt:function(Se,De){for(var Ae=this.tryEntries.length-1;Ae>=0;--Ae){var Ne=this.tryEntries[Ae];if(Ne.tryLoc<=this.prev&&S.call(Ne,"finallyLoc")&&this.prev<Ne.finallyLoc){var qe=Ne;break}}qe&&("break"===Se||"continue"===Se)&&qe.tryLoc<=De&&De<=qe.finallyLoc&&(qe=null);var Be=qe?qe.completion:{};return Be.type=Se,Be.arg=De,qe?(this.method="next",this.next=qe.finallyLoc,ue):this.complete(Be)},complete:function(Se,De){if("throw"===Se.type)throw Se.arg;return"break"===Se.type||"continue"===Se.type?this.next=Se.arg:"return"===Se.type?(this.rval=this.arg=Se.arg,this.method="return",this.next="end"):"normal"===Se.type&&De&&(this.next=De),ue},finish:function(Se){for(var De=this.tryEntries.length-1;De>=0;--De){var Ae=this.tryEntries[De];if(Ae.finallyLoc===Se)return this.complete(Ae.completion,Ae.afterLoc),he(Ae),ue}},catch:function(Se){for(var De=this.tryEntries.length-1;De>=0;--De){var Ae=this.tryEntries[De];if(Ae.tryLoc===Se){var Ne=Ae.completion;if("throw"===Ne.type){var qe=Ne.arg;he(Ae)}return qe}}throw new Error("illegal catch attempt")},delegateYield:function(Se,De,Ae){return this.delegate={iterator:me(Se),resultName:De,nextLoc:Ae},"next"===this.method&&(this.arg=void 0),ue}},N}function s(N,T,S,U,W,k,D){try{var Q=N[k](D),ee=Q.value}catch(ae){return void S(ae)}Q.done?T(ee):Promise.resolve(ee).then(U,W)}function t(N){return function(){var T=this,S=arguments;return new Promise(function(U,W){var k=N.apply(T,S);function D(ee){s(k,U,W,D,Q,"next",ee)}function Q(ee){s(k,U,W,D,Q,"throw",ee)}D(void 0)})}}function h(N,T){(null==T||T>N.length)&&(T=N.length);for(var S=0,U=new Array(T);S<T;S++)U[S]=N[S];return U}function l(N,T){var S=Object.keys(N);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(N);T&&(U=U.filter(function(W){return Object.getOwnPropertyDescriptor(N,W).enumerable})),S.push.apply(S,U)}return S}function e(N){for(var T=1;T<arguments.length;T++){var S=null!=arguments[T]?arguments[T]:{};T%2?l(Object(S),!0).forEach(function(U){j(N,U,S[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(S)):l(Object(S)).forEach(function(U){Object.defineProperty(N,U,Object.getOwnPropertyDescriptor(S,U))})}return N}function b(N,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(N,U.key,U)}}function x(N,T){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(U,W){return U.__proto__=W,U})(N,T)}function z(N){if(void 0===N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N}function L(N){return(L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(S){return S.__proto__||Object.getPrototypeOf(S)})(N)}function j(N,T,S){return T in N?Object.defineProperty(N,T,{value:S,enumerable:!0,configurable:!0,writable:!0}):N[T]=S,N}function C(N){var T,S,U,W=2;for(typeof Symbol<"u"&&(S=Symbol.asyncIterator,U=Symbol.iterator);W--;){if(S&&null!=(T=N[S]))return T.call(N);if(U&&null!=(T=N[U]))return new F(T.call(N));S="@@asyncIterator",U="@@iterator"}throw new TypeError("Object is not async iterable")}function F(N){function T(S){if(Object(S)!==S)return Promise.reject(new TypeError(S+" is not an object."));var U=S.done;return Promise.resolve(S.value).then(function(W){return{value:W,done:U}})}return(F=function(U){this.s=U,this.n=U.next}).prototype={s:null,n:null,next:function(){return T(this.n.apply(this.s,arguments))},return:function(U){var W=this.s.return;return void 0===W?Promise.resolve({value:U,done:!0}):T(W.apply(this.s,arguments))},throw:function(U){var W=this.s.return;return void 0===W?Promise.reject(U):T(W.apply(this.s,arguments))}},new F(N)}var V=function(N){!function w(N,T){if("function"!=typeof T&&null!==T)throw new TypeError("Super expression must either be null or a function");N.prototype=Object.create(T&&T.prototype,{constructor:{value:N,writable:!0,configurable:!0}}),Object.defineProperty(N,"prototype",{writable:!1}),T&&x(N,T)}(S,N);var U,T=function B(N){var T=function M(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var W,U=L(N);if(T){var k=L(this).constructor;W=Reflect.construct(U,arguments,k)}else W=U.apply(this,arguments);return function J(N,T){if(T&&("object"===R(T)||"function"==typeof T))return T;if(void 0!==T)throw new TypeError("Derived constructors may only return object or undefined");return z(N)}(this,W)}}(S);function S(U,W,k){var D;if(function p(N,T){if(!(N instanceof T))throw new TypeError("Cannot call a class as a function")}(this,S),(D=T.call(this)).widget=U,D.iframe=W,D.driver=k,j(z(D),"transport",void 0),j(z(D),"contentLoadedActionSent",!1),j(z(D),"allowedCapabilities",new Set),j(z(D),"allowedEvents",[]),j(z(D),"isStopped",!1),j(z(D),"turnServers",null),null==W||!W.contentWindow)throw new Error("No iframe supplied");if(!U)throw new Error("Invalid widget");if(!k)throw new Error("Invalid driver");return D.transport=new E.PostmessageTransport(_.WidgetApiDirection.ToWidget,U.id,W.contentWindow,window),D.transport.targetOrigin=U.origin,D.transport.on("message",D.handleMessage.bind(z(D))),W.addEventListener("load",D.onIframeLoad.bind(z(D))),D.transport.start(),D}return function y(N,T,S){T&&b(N.prototype,T),S&&b(N,S),Object.defineProperty(N,"prototype",{writable:!1})}(S,[{key:"hasCapability",value:function(W){return this.allowedCapabilities.has(W)}},{key:"canUseRoomTimeline",value:function(W){return this.hasCapability("org.matrix.msc2762.timeline:".concat(i.Symbols.AnyRoom))||this.hasCapability("org.matrix.msc2762.timeline:".concat(W))}},{key:"canSendRoomEvent",value:function(W){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some(function(D){return D.matchesAsRoomEvent(f.EventDirection.Send,W,k)})}},{key:"canSendStateEvent",value:function(W,k){return this.allowedEvents.some(function(D){return D.matchesAsStateEvent(f.EventDirection.Send,W,k)})}},{key:"canSendToDeviceEvent",value:function(W){return this.allowedEvents.some(function(k){return k.matchesAsToDeviceEvent(f.EventDirection.Send,W)})}},{key:"canReceiveRoomEvent",value:function(W){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some(function(D){return D.matchesAsRoomEvent(f.EventDirection.Receive,W,k)})}},{key:"canReceiveStateEvent",value:function(W,k){return this.allowedEvents.some(function(D){return D.matchesAsStateEvent(f.EventDirection.Receive,W,k)})}},{key:"canReceiveToDeviceEvent",value:function(W){return this.allowedEvents.some(function(k){return k.matchesAsToDeviceEvent(f.EventDirection.Receive,W)})}},{key:"stop",value:function(){this.isStopped=!0,this.transport.stop()}},{key:"beginCapabilities",value:function(){var k,W=this;this.emit("preparing"),this.transport.send(d.WidgetApiToWidgetAction.Capabilities,{}).then(function(D){return k=D.capabilities,W.driver.validateCapabilities(new Set(D.capabilities))}).then(function(D){console.log("Widget ".concat(W.widget.id," is allowed capabilities:"),Array.from(D)),W.allowedCapabilities=D,W.allowedEvents=f.WidgetEventCapability.findEventCapabilities(D),W.notifyCapabilities(k),W.emit("ready")})}},{key:"notifyCapabilities",value:function(W){var k=this;this.transport.send(d.WidgetApiToWidgetAction.NotifyCapabilities,{requested:W,approved:Array.from(this.allowedCapabilities)}).catch(function(D){console.warn("non-fatal error notifying widget of approved capabilities:",D)}).then(function(){k.emit("capabilitiesNotified")})}},{key:"onIframeLoad",value:function(W){this.widget.waitForIframeLoad?this.beginCapabilities():this.contentLoadedActionSent=!1}},{key:"handleContentLoadedAction",value:function(W){if(this.contentLoadedActionSent)throw new Error("Improper sequence: ContentLoaded Action can only be send once after the widget loaded and should only be used if waitForIframeLoad is false (default=true)");this.widget.waitForIframeLoad?this.transport.reply(W,{error:{message:"Improper sequence: not expecting ContentLoaded event if waitForIframLoad is true (default=true)"}}):(this.transport.reply(W,{}),this.beginCapabilities()),this.contentLoadedActionSent=!0}},{key:"replyVersions",value:function(W){this.transport.reply(W,{supported_versions:g.CurrentApiVersions})}},{key:"handleCapabilitiesRenegotiate",value:function(W){var k,D=this;this.transport.reply(W,{});var Q=(null===(k=W.data)||void 0===k?void 0:k.capabilities)||[],ee=new Set(Q.filter(function(ae){return!D.hasCapability(ae)}));if(0===ee.size)return this.notifyCapabilities([]);this.driver.validateCapabilities(ee).then(function(ae){return ae.forEach(function(be){return D.allowedCapabilities.add(be)}),f.WidgetEventCapability.findEventCapabilities(ae).forEach(function(be){return D.allowedEvents.push(be)}),D.notifyCapabilities(Array.from(ee))})}},{key:"handleNavigate",value:function(W){var k,D,Q=this;if(!this.hasCapability(u.MatrixCapabilities.MSC2931Navigate))return this.transport.reply(W,{error:{message:"Missing capability"}});if(null===(k=W.data)||void 0===k||!k.uri||null===(D=W.data)||void 0===D||!D.uri.toString().startsWith("https://matrix.to/#"))return this.transport.reply(W,{error:{message:"Invalid matrix.to URI"}});var ee=function(ue){return console.error("[ClientWidgetApi] Failed to handle navigation: ",ue),Q.transport.reply(W,{error:{message:"Error handling navigation"}})};try{this.driver.navigate(W.data.uri.toString()).catch(function(ae){return ee(ae)}).then(function(){return Q.transport.reply(W,{})})}catch(ae){return ee(ae)}}},{key:"handleOIDC",value:function(W){var k=this,D=1,Q=function(be,X){return X=X||{},D>1?k.transport.send(d.WidgetApiToWidgetAction.OpenIDCredentials,e({state:be,original_request_id:W.requestId},X)):k.transport.reply(W,e({state:be},X))},ee=function(be){return console.error("[ClientWidgetApi] Failed to handle OIDC: ",be),D>1?Q(v.OpenIDRequestState.Blocked):k.transport.reply(W,{error:{message:be}})},ae=new c.SimpleObservable(function(ue){return ue.state===v.OpenIDRequestState.PendingUserConfirmation&&D>1?(ae.close(),ee("client provided out-of-phase response to OIDC flow")):ue.state===v.OpenIDRequestState.PendingUserConfirmation?(Q(ue.state),void D++):ue.state!==v.OpenIDRequestState.Allowed||ue.token?(ue.state===v.OpenIDRequestState.Blocked&&(ue.token=null),ae.close(),Q(ue.state,ue.token)):ee("client provided invalid OIDC token for an allowed request")});this.driver.askOpenID(ae)}},{key:"handleReadEvents",value:function(W){var k=this;if(!W.data.type)return this.transport.reply(W,{error:{message:"Invalid request - missing event type"}});if(void 0!==W.data.limit&&(!W.data.limit||W.data.limit<0))return this.transport.reply(W,{error:{message:"Invalid request - limit out of range"}});var D=null;if(W.data.room_ids){D=W.data.room_ids,Array.isArray(D)||(D=[D]);var ee,Q=function n(N,T){var S=typeof Symbol<"u"&&N[Symbol.iterator]||N["@@iterator"];if(!S){if(Array.isArray(N)||(S=function o(N,T){if(N){if("string"==typeof N)return h(N,T);var S=Object.prototype.toString.call(N).slice(8,-1);if("Object"===S&&N.constructor&&(S=N.constructor.name),"Map"===S||"Set"===S)return Array.from(N);if("Arguments"===S||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return h(N,T)}}(N))||T&&N&&"number"==typeof N.length){S&&(N=S);var U=0,W=function(){};return{s:W,n:function(){return U>=N.length?{done:!0}:{done:!1,value:N[U++]}},e:function(ae){throw ae},f:W}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Q,k=!0,D=!1;return{s:function(){S=S.call(N)},n:function(){var ae=S.next();return k=ae.done,ae},e:function(ae){D=!0,Q=ae},f:function(){try{!k&&null!=S.return&&S.return()}finally{if(D)throw Q}}}}(D);try{for(Q.s();!(ee=Q.n()).done;){var ae=ee.value;if(!this.canUseRoomTimeline(ae))return this.transport.reply(W,{error:{message:"Unable to access room timeline: ".concat(ae)}})}}catch(H){Q.e(H)}finally{Q.f()}}var ue=W.data.limit||0,be=Promise.resolve([]);if(void 0!==W.data.state_key){var X=!0===W.data.state_key?void 0:W.data.state_key.toString();if(!this.canReceiveStateEvent(W.data.type,X))return this.transport.reply(W,{error:{message:"Cannot read state events of this type"}});be=this.driver.readStateEvents(W.data.type,X,ue,D)}else{if(!this.canReceiveRoomEvent(W.data.type,W.data.msgtype))return this.transport.reply(W,{error:{message:"Cannot read room events of this type"}});be=this.driver.readRoomEvents(W.data.type,W.data.msgtype,ue,D)}return be.then(function(H){return k.transport.reply(W,{events:H})})}},{key:"handleSendEvent",value:function(W){var Q,k=this;if(!W.data.type)return this.transport.reply(W,{error:{message:"Invalid request - missing event type"}});if(W.data.room_id&&!this.canUseRoomTimeline(W.data.room_id))return this.transport.reply(W,{error:{message:"Unable to access room timeline: ".concat(W.data.room_id)}});if(null!=W.data.state_key){if(!this.canSendStateEvent(W.data.type,W.data.state_key))return this.transport.reply(W,{error:{message:"Cannot send state events of this type"}});Q=this.driver.sendEvent(W.data.type,W.data.content||{},W.data.state_key,W.data.room_id)}else{var ee=W.data.content||{};if(!this.canSendRoomEvent(W.data.type,ee.msgtype))return this.transport.reply(W,{error:{message:"Cannot send room events of this type"}});Q=this.driver.sendEvent(W.data.type,ee,null,W.data.room_id)}Q.then(function(ue){return k.transport.reply(W,{room_id:ue.roomId,event_id:ue.eventId})}).catch(function(ue){return console.error("error sending event: ",ue),k.transport.reply(W,{error:{message:"Error sending event"}})})}},{key:"handleSendToDevice",value:(U=t(r().mark(function k(D){return r().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(D.data.type){ee.next=5;break}return ee.next=3,this.transport.reply(D,{error:{message:"Invalid request - missing event type"}});case 3:case 8:case 13:case 18:case 25:ee.next=32;break;case 5:if(D.data.messages){ee.next=10;break}return ee.next=8,this.transport.reply(D,{error:{message:"Invalid request - missing event contents"}});case 10:if("boolean"==typeof D.data.encrypted){ee.next=15;break}return ee.next=13,this.transport.reply(D,{error:{message:"Invalid request - missing encryption flag"}});case 15:if(this.canSendToDeviceEvent(D.data.type)){ee.next=20;break}return ee.next=18,this.transport.reply(D,{error:{message:"Cannot send to-device events of this type"}});case 20:return ee.prev=20,ee.next=23,this.driver.sendToDevice(D.data.type,D.data.encrypted,D.data.messages);case 23:return ee.next=25,this.transport.reply(D,{});case 27:return ee.prev=27,ee.t0=ee.catch(20),console.error("error sending to-device event",ee.t0),ee.next=32,this.transport.reply(D,{error:{message:"Error sending event"}});case 32:case"end":return ee.stop()}},k,this,[[20,27]])})),function W(k){return U.apply(this,arguments)})},{key:"pollTurnServers",value:function(){var U=t(r().mark(function k(D,Q){var ee,ae,ue,be,X,H;return r().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.prev=0,ce.next=3,this.transport.send(d.WidgetApiToWidgetAction.UpdateTurnServers,Q);case 3:ee=!1,ae=!1,ce.prev=5,be=C(D);case 7:return ce.next=9,be.next();case 9:if(!(ee=!(X=ce.sent).done)){ce.next=16;break}return H=X.value,ce.next=13,this.transport.send(d.WidgetApiToWidgetAction.UpdateTurnServers,H);case 13:ee=!1,ce.next=7;break;case 16:ce.next=22;break;case 18:ce.prev=18,ce.t0=ce.catch(5),ae=!0,ue=ce.t0;case 22:if(ce.prev=22,ce.prev=23,!ee||null==be.return){ce.next=27;break}return ce.next=27,be.return();case 27:if(ce.prev=27,!ae){ce.next=30;break}throw ue;case 30:return ce.finish(27);case 31:return ce.finish(22);case 32:ce.next=37;break;case 34:ce.prev=34,ce.t1=ce.catch(0),console.error("error polling for TURN servers",ce.t1);case 37:case"end":return ce.stop()}},k,this,[[0,34],[5,18,22,32],[23,,27,31]])}));return function W(k,D){return U.apply(this,arguments)}}()},{key:"handleWatchTurnServers",value:function(){var U=t(r().mark(function k(D){var Q,ee,ue;return r().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(this.hasCapability(u.MatrixCapabilities.MSC3846TurnServers)){X.next=5;break}return X.next=3,this.transport.reply(D,{error:{message:"Missing capability"}});case 3:case 8:X.next=30;break;case 5:if(!this.turnServers){X.next=10;break}return X.next=8,this.transport.reply(D,{});case 10:return X.prev=10,Q=this.driver.getTurnServers(),X.next=14,Q.next();case 14:if(ue=(ee=X.sent).value,!ee.done){X.next=19;break}throw new Error("Client refuses to provide any TURN servers");case 19:return X.next=21,this.transport.reply(D,{});case 21:this.pollTurnServers(Q,ue),this.turnServers=Q,X.next=30;break;case 25:return X.prev=25,X.t0=X.catch(10),console.error("error getting first TURN server results",X.t0),X.next=30,this.transport.reply(D,{error:{message:"TURN servers not available"}});case 30:case"end":return X.stop()}},k,this,[[10,25]])}));return function W(k){return U.apply(this,arguments)}}()},{key:"handleUnwatchTurnServers",value:function(){var U=t(r().mark(function k(D){return r().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(this.hasCapability(u.MatrixCapabilities.MSC3846TurnServers)){ee.next=5;break}return ee.next=3,this.transport.reply(D,{error:{message:"Missing capability"}});case 3:case 8:ee.next=15;break;case 5:if(this.turnServers){ee.next=10;break}return ee.next=8,this.transport.reply(D,{});case 10:return ee.next=12,this.turnServers.return(void 0);case 12:return this.turnServers=null,ee.next=15,this.transport.reply(D,{});case 15:case"end":return ee.stop()}},k,this)}));return function W(k){return U.apply(this,arguments)}}()},{key:"handleReadRelations",value:function(){var U=t(r().mark(function k(D){var ee,ae,Q=this;return r().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(D.data.event_id){be.next=2;break}return be.abrupt("return",this.transport.reply(D,{error:{message:"Invalid request - missing event ID"}}));case 2:if(!(void 0!==D.data.limit&&D.data.limit<0)){be.next=4;break}return be.abrupt("return",this.transport.reply(D,{error:{message:"Invalid request - limit out of range"}}));case 4:if(void 0===D.data.room_id||this.canUseRoomTimeline(D.data.room_id)){be.next=6;break}return be.abrupt("return",this.transport.reply(D,{error:{message:"Unable to access room timeline: ".concat(D.data.room_id)}}));case 6:return be.prev=6,be.next=9,this.driver.readEventRelations(D.data.event_id,D.data.room_id,D.data.rel_type,D.data.event_type,D.data.from,D.data.to,D.data.limit,D.data.direction);case 9:if(!(ee=be.sent).originalEvent){be.next=18;break}if(void 0===ee.originalEvent.state_key){be.next=16;break}if(this.canReceiveStateEvent(ee.originalEvent.type,ee.originalEvent.state_key)){be.next=14;break}return be.abrupt("return",this.transport.reply(D,{error:{message:"Cannot read state events of this type"}}));case 14:be.next=18;break;case 16:if(this.canReceiveRoomEvent(ee.originalEvent.type,ee.originalEvent.content.msgtype)){be.next=18;break}return be.abrupt("return",this.transport.reply(D,{error:{message:"Cannot read room events of this type"}}));case 18:return ae=ee.chunk.filter(function(X){return void 0!==X.state_key?Q.canReceiveStateEvent(X.type,X.state_key):Q.canReceiveRoomEvent(X.type,X.content.msgtype)}),be.abrupt("return",this.transport.reply(D,{original_event:ee.originalEvent,chunk:ae,prev_batch:ee.prevBatch,next_batch:ee.nextBatch}));case 22:return be.prev=22,be.t0=be.catch(6),console.error("error getting the relations",be.t0),be.next=27,this.transport.reply(D,{error:{message:"Unexpected error while reading relations"}});case 27:case"end":return be.stop()}},k,this,[[6,22]])}));return function W(k){return U.apply(this,arguments)}}()},{key:"handleMessage",value:function(W){if(!this.isStopped){var k=new CustomEvent("action:".concat(W.detail.action),{detail:W.detail,cancelable:!0});if(this.emit("action:".concat(W.detail.action),k),!k.defaultPrevented)switch(W.detail.action){case d.WidgetApiFromWidgetAction.ContentLoaded:return this.handleContentLoadedAction(W.detail);case d.WidgetApiFromWidgetAction.SupportedApiVersions:return this.replyVersions(W.detail);case d.WidgetApiFromWidgetAction.SendEvent:return this.handleSendEvent(W.detail);case d.WidgetApiFromWidgetAction.SendToDevice:return this.handleSendToDevice(W.detail);case d.WidgetApiFromWidgetAction.GetOpenIDCredentials:return this.handleOIDC(W.detail);case d.WidgetApiFromWidgetAction.MSC2931Navigate:return this.handleNavigate(W.detail);case d.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities:return this.handleCapabilitiesRenegotiate(W.detail);case d.WidgetApiFromWidgetAction.MSC2876ReadEvents:return this.handleReadEvents(W.detail);case d.WidgetApiFromWidgetAction.WatchTurnServers:return this.handleWatchTurnServers(W.detail);case d.WidgetApiFromWidgetAction.UnwatchTurnServers:return this.handleUnwatchTurnServers(W.detail);case d.WidgetApiFromWidgetAction.MSC3869ReadRelations:return this.handleReadRelations(W.detail);default:return this.transport.reply(W.detail,{error:{message:"Unknown or unsupported action: "+W.detail.action}})}}}},{key:"takeScreenshot",value:function(){return this.transport.send(d.WidgetApiToWidgetAction.TakeScreenshot,{})}},{key:"updateVisibility",value:function(W){return this.transport.send(d.WidgetApiToWidgetAction.UpdateVisibility,{visible:W})}},{key:"sendWidgetConfig",value:function(W){return this.transport.send(d.WidgetApiToWidgetAction.WidgetConfig,W).then()}},{key:"notifyModalWidgetButtonClicked",value:function(W){return this.transport.send(d.WidgetApiToWidgetAction.ButtonClicked,{id:W}).then()}},{key:"notifyModalWidgetClose",value:function(W){return this.transport.send(d.WidgetApiToWidgetAction.CloseModalWidget,W).then()}},{key:"feedEvent",value:function(){var U=t(r().mark(function k(D,Q){var ee;return r().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(D.room_id===Q||this.canUseRoomTimeline(D.room_id)){ue.next=2;break}return ue.abrupt("return");case 2:if(null==D.state_key){ue.next=7;break}if(this.canReceiveStateEvent(D.type,D.state_key)){ue.next=5;break}return ue.abrupt("return");case 5:ue.next=9;break;case 7:if(this.canReceiveRoomEvent(D.type,null===(ee=D.content)||void 0===ee?void 0:ee.msgtype)){ue.next=9;break}return ue.abrupt("return");case 9:return ue.next=11,this.transport.send(d.WidgetApiToWidgetAction.SendEvent,D);case 11:case"end":return ue.stop()}},k,this)}));return function W(k,D){return U.apply(this,arguments)}}()},{key:"feedToDevice",value:function(){var U=t(r().mark(function k(D,Q){return r().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(!this.canReceiveToDeviceEvent(D.type)){ae.next=3;break}return ae.next=3,this.transport.send(d.WidgetApiToWidgetAction.SendToDevice,e(e({},D),{},{encrypted:Q}));case 3:case"end":return ae.stop()}},k,this)}));return function W(k,D){return U.apply(this,arguments)}}()}]),S}(I.EventEmitter);a.ClientWidgetApi=V},{"./Symbols":175,"./interfaces/ApiVersion":179,"./interfaces/Capabilities":180,"./interfaces/GetOpenIDAction":183,"./interfaces/WidgetApiAction":207,"./interfaces/WidgetApiDirection":208,"./models/WidgetEventCapability":213,"./transport/PostmessageTransport":219,"./util/SimpleObservable":220,events:105}],175:[function(m,ie,a){"use strict";var R;Object.defineProperty(a,"__esModule",{value:!0}),a.Symbols=void 0,a.Symbols=R,(R||(a.Symbols=R={})).AnyRoom="*"},{}],176:[function(m,ie,a){"use strict";function R(C){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(F){return typeof F}:function(F){return F&&"function"==typeof Symbol&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F})(C)}Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetApi=void 0;var I=m("events"),E=m("./interfaces/WidgetApiDirection"),_=m("./interfaces/ApiVersion"),d=m("./transport/PostmessageTransport"),u=m("./interfaces/WidgetApiAction"),g=m("./interfaces/GetOpenIDAction"),f=m("./interfaces/WidgetType"),v=m("./interfaces/ModalWidgetActions"),c=m("./models/WidgetEventCapability"),i=m("./Symbols");function r(){r=function(){return C};var C={},F=Object.prototype,V=F.hasOwnProperty,N="function"==typeof Symbol?Symbol:{},T=N.iterator||"@@iterator",S=N.asyncIterator||"@@asyncIterator",U=N.toStringTag||"@@toStringTag";function W(pe,me,Ee){return Object.defineProperty(pe,me,{value:Ee,enumerable:!0,configurable:!0,writable:!0}),pe[me]}try{W({},"")}catch{W=function(Ee,_e,Se){return Ee[_e]=Se}}function k(pe,me,Ee,_e){var Ne,qe,Be,Ge,De=Object.create((me&&me.prototype instanceof ee?me:ee).prototype),Ae=new G(_e||[]);return De._invoke=(Ne=pe,qe=Ee,Be=Ae,Ge="suspendedStart",function(Ue,K){if("executing"===Ge)throw new Error("Generator is already running");if("completed"===Ge){if("throw"===Ue)throw K;return{value:void 0,done:!0}}for(Be.method=Ue,Be.arg=K;;){var Y=Be.delegate;if(Y){var oe=P(Y,Be);if(oe){if(oe===Q)continue;return oe}}if("next"===Be.method)Be.sent=Be._sent=Be.arg;else if("throw"===Be.method){if("suspendedStart"===Ge)throw Ge="completed",Be.arg;Be.dispatchException(Be.arg)}else"return"===Be.method&&Be.abrupt("return",Be.arg);Ge="executing";var le=D(Ne,qe,Be);if("normal"===le.type){if(Ge=Be.done?"completed":"suspendedYield",le.arg===Q)continue;return{value:le.arg,done:Be.done}}"throw"===le.type&&(Ge="completed",Be.method="throw",Be.arg=le.arg)}}),De}function D(pe,me,Ee){try{return{type:"normal",arg:pe.call(me,Ee)}}catch(_e){return{type:"throw",arg:_e}}}C.wrap=k;var Q={};function ee(){}function ae(){}function ue(){}var be={};W(be,T,function(){return this});var X=Object.getPrototypeOf,H=X&&X(X(se([])));H&&H!==F&&V.call(H,T)&&(be=H);var ne=ue.prototype=ee.prototype=Object.create(be);function ce(pe){["next","throw","return"].forEach(function(me){W(pe,me,function(Ee){return this._invoke(me,Ee)})})}function te(pe,me){function Ee(Se,De,Ae,Ne){var qe=D(pe[Se],pe,De);if("throw"!==qe.type){var Be=qe.arg,Ge=Be.value;return Ge&&"object"==R(Ge)&&V.call(Ge,"__await")?me.resolve(Ge.__await).then(function(Ue){Ee("next",Ue,Ae,Ne)},function(Ue){Ee("throw",Ue,Ae,Ne)}):me.resolve(Ge).then(function(Ue){Be.value=Ue,Ae(Be)},function(Ue){return Ee("throw",Ue,Ae,Ne)})}Ne(qe.arg)}var _e;this._invoke=function(Se,De){function Ae(){return new me(function(Ne,qe){Ee(Se,De,Ne,qe)})}return _e=_e?_e.then(Ae,Ae):Ae()}}function P(pe,me){var Ee=pe.iterator[me.method];if(void 0===Ee){if(me.delegate=null,"throw"===me.method){if(pe.iterator.return&&(me.method="return",me.arg=void 0,P(pe,me),"throw"===me.method))return Q;me.method="throw",me.arg=new TypeError("The iterator does not provide a 'throw' method")}return Q}var _e=D(Ee,pe.iterator,me.arg);if("throw"===_e.type)return me.method="throw",me.arg=_e.arg,me.delegate=null,Q;var Se=_e.arg;return Se?Se.done?(me[pe.resultName]=Se.value,me.next=pe.nextLoc,"return"!==me.method&&(me.method="next",me.arg=void 0),me.delegate=null,Q):Se:(me.method="throw",me.arg=new TypeError("iterator result is not an object"),me.delegate=null,Q)}function A(pe){var me={tryLoc:pe[0]};1 in pe&&(me.catchLoc=pe[1]),2 in pe&&(me.finallyLoc=pe[2],me.afterLoc=pe[3]),this.tryEntries.push(me)}function $(pe){var me=pe.completion||{};me.type="normal",delete me.arg,pe.completion=me}function G(pe){this.tryEntries=[{tryLoc:"root"}],pe.forEach(A,this),this.reset(!0)}function se(pe){if(pe){var me=pe[T];if(me)return me.call(pe);if("function"==typeof pe.next)return pe;if(!isNaN(pe.length)){var Ee=-1,_e=function Se(){for(;++Ee<pe.length;)if(V.call(pe,Ee))return Se.value=pe[Ee],Se.done=!1,Se;return Se.value=void 0,Se.done=!0,Se};return _e.next=_e}}return{next:he}}function he(){return{value:void 0,done:!0}}return ae.prototype=ue,W(ne,"constructor",ue),W(ue,"constructor",ae),ae.displayName=W(ue,U,"GeneratorFunction"),C.isGeneratorFunction=function(pe){var me="function"==typeof pe&&pe.constructor;return!!me&&(me===ae||"GeneratorFunction"===(me.displayName||me.name))},C.mark=function(pe){return Object.setPrototypeOf?Object.setPrototypeOf(pe,ue):(pe.__proto__=ue,W(pe,U,"GeneratorFunction")),pe.prototype=Object.create(ne),pe},C.awrap=function(pe){return{__await:pe}},ce(te.prototype),W(te.prototype,S,function(){return this}),C.AsyncIterator=te,C.async=function(pe,me,Ee,_e,Se){void 0===Se&&(Se=Promise);var De=new te(k(pe,me,Ee,_e),Se);return C.isGeneratorFunction(me)?De:De.next().then(function(Ae){return Ae.done?Ae.value:De.next()})},ce(ne),W(ne,U,"Generator"),W(ne,T,function(){return this}),W(ne,"toString",function(){return"[object Generator]"}),C.keys=function(pe){var me=[];for(var Ee in pe)me.push(Ee);return me.reverse(),function _e(){for(;me.length;){var Se=me.pop();if(Se in pe)return _e.value=Se,_e.done=!1,_e}return _e.done=!0,_e}},C.values=se,G.prototype={constructor:G,reset:function(me){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!me)for(var Ee in this)"t"===Ee.charAt(0)&&V.call(this,Ee)&&!isNaN(+Ee.slice(1))&&(this[Ee]=void 0)},stop:function(){this.done=!0;var me=this.tryEntries[0].completion;if("throw"===me.type)throw me.arg;return this.rval},dispatchException:function(me){if(this.done)throw me;var Ee=this;function _e(Be,Ge){return Ae.type="throw",Ae.arg=me,Ee.next=Be,Ge&&(Ee.method="next",Ee.arg=void 0),!!Ge}for(var Se=this.tryEntries.length-1;Se>=0;--Se){var De=this.tryEntries[Se],Ae=De.completion;if("root"===De.tryLoc)return _e("end");if(De.tryLoc<=this.prev){var Ne=V.call(De,"catchLoc"),qe=V.call(De,"finallyLoc");if(Ne&&qe){if(this.prev<De.catchLoc)return _e(De.catchLoc,!0);if(this.prev<De.finallyLoc)return _e(De.finallyLoc)}else if(Ne){if(this.prev<De.catchLoc)return _e(De.catchLoc,!0)}else{if(!qe)throw new Error("try statement without catch or finally");if(this.prev<De.finallyLoc)return _e(De.finallyLoc)}}}},abrupt:function(me,Ee){for(var _e=this.tryEntries.length-1;_e>=0;--_e){var Se=this.tryEntries[_e];if(Se.tryLoc<=this.prev&&V.call(Se,"finallyLoc")&&this.prev<Se.finallyLoc){var De=Se;break}}De&&("break"===me||"continue"===me)&&De.tryLoc<=Ee&&Ee<=De.finallyLoc&&(De=null);var Ae=De?De.completion:{};return Ae.type=me,Ae.arg=Ee,De?(this.method="next",this.next=De.finallyLoc,Q):this.complete(Ae)},complete:function(me,Ee){if("throw"===me.type)throw me.arg;return"break"===me.type||"continue"===me.type?this.next=me.arg:"return"===me.type?(this.rval=this.arg=me.arg,this.method="return",this.next="end"):"normal"===me.type&&Ee&&(this.next=Ee),Q},finish:function(me){for(var Ee=this.tryEntries.length-1;Ee>=0;--Ee){var _e=this.tryEntries[Ee];if(_e.finallyLoc===me)return this.complete(_e.completion,_e.afterLoc),$(_e),Q}},catch:function(me){for(var Ee=this.tryEntries.length-1;Ee>=0;--Ee){var _e=this.tryEntries[Ee];if(_e.tryLoc===me){var Se=_e.completion;if("throw"===Se.type){var De=Se.arg;$(_e)}return De}}throw new Error("illegal catch attempt")},delegateYield:function(me,Ee,_e){return this.delegate={iterator:se(me),resultName:Ee,nextLoc:_e},"next"===this.method&&(this.arg=void 0),Q}},C}function s(C,F,V,N,T,S,U){try{var W=C[S](U),k=W.value}catch(D){return void V(D)}W.done?F(k):Promise.resolve(k).then(N,T)}function t(C){return function(){var F=this,V=arguments;return new Promise(function(N,T){var S=C.apply(F,V);function U(k){s(S,N,T,U,W,"next",k)}function W(k){s(S,N,T,U,W,"throw",k)}U(void 0)})}}function o(C,F){for(var V=0;V<F.length;V++){var N=F[V];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(C,N.key,N)}}function e(C,F){return(e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,T){return N.__proto__=T,N})(C,F)}function y(C){if(void 0===C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function x(C){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(V){return V.__proto__||Object.getPrototypeOf(V)})(C)}function B(C,F,V){return F in C?Object.defineProperty(C,F,{value:V,enumerable:!0,configurable:!0,writable:!0}):C[F]=V,C}function J(C){return new L(C)}function M(C){var F,V;function T(U,W){try{var k=C[U](W),D=k.value,Q=D instanceof L;Promise.resolve(Q?D.wrapped:D).then(function(ee){Q?T("return"===U?"return":"next",ee):S(k.done?"return":"normal",ee)},function(ee){T("throw",ee)})}catch(ee){S("throw",ee)}}function S(U,W){switch(U){case"return":F.resolve({value:W,done:!0});break;case"throw":F.reject(W);break;default:F.resolve({value:W,done:!1})}(F=F.next)?T(F.key,F.arg):V=null}this._invoke=function N(U,W){return new Promise(function(k,D){var Q={key:U,arg:W,resolve:k,reject:D,next:null};V?V=V.next=Q:(F=V=Q,T(U,W))})},"function"!=typeof C.return&&(this.return=void 0)}function L(C){this.wrapped=C}M.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},M.prototype.next=function(C){return this._invoke("next",C)},M.prototype.throw=function(C){return this._invoke("throw",C)},M.prototype.return=function(C){return this._invoke("return",C)};var j=function(C){!function l(C,F){if("function"!=typeof F&&null!==F)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(F&&F.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),F&&e(C,F)}(V,C);var N,F=function p(C){var F=function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,N=x(C);if(F){var S=x(this).constructor;T=Reflect.construct(N,arguments,S)}else T=N.apply(this,arguments);return function b(C,F){if(F&&("object"===R(F)||"function"==typeof F))return F;if(void 0!==F)throw new TypeError("Derived constructors may only return object or undefined");return y(C)}(this,T)}}(V);function V(){var N,T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(function n(C,F){if(!(C instanceof F))throw new TypeError("Cannot call a class as a function")}(this,V),(N=F.call(this)).clientOrigin=S,B(y(N),"transport",void 0),B(y(N),"capabilitiesFinished",!1),B(y(N),"supportsMSC2974Renegotiate",!1),B(y(N),"requestedCapabilities",[]),B(y(N),"approvedCapabilities",void 0),B(y(N),"cachedClientVersions",void 0),B(y(N),"turnServerWatchers",0),!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");return N.transport=new d.PostmessageTransport(E.WidgetApiDirection.FromWidget,T,window.parent,window),N.transport.targetOrigin=S,N.transport.on("message",N.handleMessage.bind(y(N))),N}return function h(C,F,V){F&&o(C.prototype,F),V&&o(C,V),Object.defineProperty(C,"prototype",{writable:!1})}(V,[{key:"hasCapability",value:function(T){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(T):this.requestedCapabilities.includes(T)}},{key:"requestCapability",value:function(T){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(T)}},{key:"requestCapabilities",value:function(T){var S=this;T.forEach(function(U){return S.requestCapability(U)})}},{key:"requestCapabilityForRoomTimeline",value:function(T){this.requestCapability("org.matrix.msc2762.timeline:".concat(T))}},{key:"requestCapabilityToSendState",value:function(T,S){this.requestCapability(c.WidgetEventCapability.forStateEvent(c.EventDirection.Send,T,S).raw)}},{key:"requestCapabilityToReceiveState",value:function(T,S){this.requestCapability(c.WidgetEventCapability.forStateEvent(c.EventDirection.Receive,T,S).raw)}},{key:"requestCapabilityToSendToDevice",value:function(T){this.requestCapability(c.WidgetEventCapability.forToDeviceEvent(c.EventDirection.Send,T).raw)}},{key:"requestCapabilityToReceiveToDevice",value:function(T){this.requestCapability(c.WidgetEventCapability.forToDeviceEvent(c.EventDirection.Receive,T).raw)}},{key:"requestCapabilityToSendEvent",value:function(T){this.requestCapability(c.WidgetEventCapability.forRoomEvent(c.EventDirection.Send,T).raw)}},{key:"requestCapabilityToReceiveEvent",value:function(T){this.requestCapability(c.WidgetEventCapability.forRoomEvent(c.EventDirection.Receive,T).raw)}},{key:"requestCapabilityToSendMessage",value:function(T){this.requestCapability(c.WidgetEventCapability.forRoomMessageEvent(c.EventDirection.Send,T).raw)}},{key:"requestCapabilityToReceiveMessage",value:function(T){this.requestCapability(c.WidgetEventCapability.forRoomMessageEvent(c.EventDirection.Receive,T).raw)}},{key:"requestOpenIDConnectToken",value:function(){var T=this;return new Promise(function(S,U){T.transport.sendComplete(u.WidgetApiFromWidgetAction.GetOpenIDCredentials,{}).then(function(W){var k=W.response;k.state===g.OpenIDRequestState.Allowed?S(k):k.state===g.OpenIDRequestState.Blocked?U(new Error("User declined to verify their identity")):k.state===g.OpenIDRequestState.PendingUserConfirmation?T.on("action:".concat(u.WidgetApiToWidgetAction.OpenIDCredentials),function Q(ee){ee.preventDefault();var ae=ee.detail;ae.data.original_request_id===W.requestId&&(ae.data.state===g.OpenIDRequestState.Allowed?(S(ae.data),T.transport.reply(ae,{})):ae.data.state===g.OpenIDRequestState.Blocked?(U(new Error("User declined to verify their identity")),T.transport.reply(ae,{})):(U(new Error("Invalid state on reply: "+k.state)),T.transport.reply(ae,{error:{message:"Invalid state"}})),T.off("action:".concat(u.WidgetApiToWidgetAction.OpenIDCredentials),Q))}):U(new Error("Invalid state: "+k.state))}).catch(U)})}},{key:"updateRequestedCapabilities",value:function(){return this.transport.send(u.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}},{key:"sendContentLoaded",value:function(){return this.transport.send(u.WidgetApiFromWidgetAction.ContentLoaded,{}).then()}},{key:"sendSticker",value:function(T){return this.transport.send(u.WidgetApiFromWidgetAction.SendSticker,T).then()}},{key:"setAlwaysOnScreen",value:function(T){return this.transport.send(u.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,{value:T}).then(function(S){return S.success})}},{key:"openModalWidget",value:function(T,S){return this.transport.send(u.WidgetApiFromWidgetAction.OpenModalWidget,{type:arguments.length>4&&void 0!==arguments[4]?arguments[4]:f.MatrixWidgetType.Custom,url:T,name:S,buttons:arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],data:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}}).then()}},{key:"closeModalWidget",value:function(){return this.transport.send(u.WidgetApiFromWidgetAction.CloseModalWidget,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).then()}},{key:"sendRoomEvent",value:function(T,S,U){return this.transport.send(u.WidgetApiFromWidgetAction.SendEvent,{type:T,content:S,room_id:U})}},{key:"sendStateEvent",value:function(T,S,U,W){return this.transport.send(u.WidgetApiFromWidgetAction.SendEvent,{type:T,content:U,state_key:S,room_id:W})}},{key:"sendToDevice",value:function(T,S,U){return this.transport.send(u.WidgetApiFromWidgetAction.SendToDevice,{type:T,encrypted:S,messages:U})}},{key:"readRoomEvents",value:function(T,S,U,W){var k={type:T,msgtype:U};return void 0!==S&&(k.limit=S),W&&(k.room_ids=W.includes(i.Symbols.AnyRoom)?i.Symbols.AnyRoom:W),this.transport.send(u.WidgetApiFromWidgetAction.MSC2876ReadEvents,k).then(function(D){return D.events})}},{key:"readEventRelations",value:(N=t(r().mark(function S(U,W,k,D,Q,ee,ae,ue){return r().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,this.getClientVersions();case 2:if(ne.sent.includes(_.UnstableApiVersion.MSC3869)){ne.next=5;break}throw new Error("The read_relations action is not supported by the client.");case 5:return ne.abrupt("return",this.transport.send(u.WidgetApiFromWidgetAction.MSC3869ReadRelations,{event_id:U,rel_type:k,event_type:D,room_id:W,to:ae,from:ee,limit:Q,direction:ue}));case 7:case"end":return ne.stop()}},S,this)})),function T(S,U,W,k,D,Q,ee,ae){return N.apply(this,arguments)})},{key:"readStateEvents",value:function(T,S,U,W){var k={type:T,state_key:void 0===U||U};return void 0!==S&&(k.limit=S),W&&(k.room_ids=W.includes(i.Symbols.AnyRoom)?i.Symbols.AnyRoom:W),this.transport.send(u.WidgetApiFromWidgetAction.MSC2876ReadEvents,k).then(function(D){return D.events})}},{key:"setModalButtonEnabled",value:function(T,S){if(T===v.BuiltInModalButtonID.Close)throw new Error("The close button cannot be disabled");return this.transport.send(u.WidgetApiFromWidgetAction.SetModalButtonEnabled,{button:T,enabled:S}).then()}},{key:"navigateTo",value:function(T){if(!T||!T.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(u.WidgetApiFromWidgetAction.MSC2931Navigate,{uri:T}).then()}},{key:"getTurnServers",value:function(){var T=this;return function z(C){return function(){return new M(C.apply(this,arguments))}}(r().mark(function S(){var U,W;return r().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(W=function(){var Q=t(r().mark(function ee(ae){return r().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return ae.preventDefault(),U(ae.detail.data),be.next=4,T.transport.reply(ae.detail,{});case 4:case"end":return be.stop()}},ee)}));return function(ae){return Q.apply(this,arguments)}}(),T.on("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),W),0!==T.turnServerWatchers){D.next=12;break}return D.prev=3,D.next=6,J(T.transport.send(u.WidgetApiFromWidgetAction.WatchTurnServers,{}));case 6:D.next=12;break;case 8:throw D.prev=8,D.t0=D.catch(3),T.off("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),W),D.t0;case 12:T.turnServerWatchers++,D.prev=13;case 14:return D.next=17,J(new Promise(function(Q){return U=Q}));case 17:return D.next=19,D.sent;case 19:D.next=14;break;case 21:if(D.prev=21,T.off("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),W),T.turnServerWatchers--,0!==T.turnServerWatchers){D.next=27;break}return D.next=27,J(T.transport.send(u.WidgetApiFromWidgetAction.UnwatchTurnServers,{}));case 27:return D.finish(21);case 28:case"end":return D.stop()}},S,null,[[3,8],[13,,21,28]])}))()}},{key:"start",value:function(){var T=this;this.transport.start(),this.getClientVersions().then(function(S){S.includes(_.UnstableApiVersion.MSC2974)&&(T.supportsMSC2974Renegotiate=!0)})}},{key:"handleMessage",value:function(T){var S=new CustomEvent("action:".concat(T.detail.action),{detail:T.detail,cancelable:!0});if(this.emit("action:".concat(T.detail.action),S),!S.defaultPrevented)switch(T.detail.action){case u.WidgetApiToWidgetAction.SupportedApiVersions:return this.replyVersions(T.detail);case u.WidgetApiToWidgetAction.Capabilities:return this.handleCapabilities(T.detail);case u.WidgetApiToWidgetAction.UpdateVisibility:case u.WidgetApiToWidgetAction.NotifyCapabilities:return this.transport.reply(T.detail,{});default:return this.transport.reply(T.detail,{error:{message:"Unknown or unsupported action: "+T.detail.action}})}}},{key:"replyVersions",value:function(T){this.transport.reply(T,{supported_versions:_.CurrentApiVersions})}},{key:"getClientVersions",value:function(){var T=this;return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(u.WidgetApiFromWidgetAction.SupportedApiVersions,{}).then(function(S){return T.cachedClientVersions=S.supported_versions,S.supported_versions}).catch(function(S){return console.warn("non-fatal error getting supported client versions: ",S),[]})}},{key:"handleCapabilities",value:function(T){var S=this;return this.capabilitiesFinished?this.transport.reply(T,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(function(U){return U.includes(_.UnstableApiVersion.MSC2871)?S.once("action:".concat(u.WidgetApiToWidgetAction.NotifyCapabilities),function(W){S.approvedCapabilities=W.detail.data.approved,S.emit("ready")}):S.emit("ready"),S.capabilitiesFinished=!0,S.transport.reply(T,{capabilities:S.requestedCapabilities})})}}]),V}(I.EventEmitter);a.WidgetApi=j},{"./Symbols":175,"./interfaces/ApiVersion":179,"./interfaces/GetOpenIDAction":183,"./interfaces/ModalWidgetActions":193,"./interfaces/WidgetApiAction":207,"./interfaces/WidgetApiDirection":208,"./interfaces/WidgetType":211,"./models/WidgetEventCapability":213,"./transport/PostmessageTransport":219,events:105}],177:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetDriver=void 0;var R=m("..");function E(u,g){for(var f=0;f<g.length;f++){var v=g[f];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(u,v.key,v)}}a.WidgetDriver=function(){function u(){!function I(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")}(this,u)}return function _(u,g,f){g&&E(u.prototype,g),f&&E(u,f),Object.defineProperty(u,"prototype",{writable:!1})}(u,[{key:"validateCapabilities",value:function(f){return Promise.resolve(new Set)}},{key:"sendEvent",value:function(f,v){return Promise.reject(new Error("Failed to override function"))}},{key:"sendToDevice",value:function(f,v,c){return Promise.reject(new Error("Failed to override function"))}},{key:"readRoomEvents",value:function(f,v,c){return Promise.resolve([])}},{key:"readStateEvents",value:function(f,v,c){return Promise.resolve([])}},{key:"readEventRelations",value:function(f,v,c,i,r,s,t,n){return Promise.resolve({chunk:[]})}},{key:"askOpenID",value:function(f){f.update({state:R.OpenIDRequestState.Blocked})}},{key:"navigate",value:function(f){throw new Error("Navigation is not implemented")}},{key:"getTurnServers",value:function(){throw new Error("TURN server support is not implemented")}}]),u}()},{"..":178}],178:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var R=m("./WidgetApi");Object.keys(R).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===R[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return R[H]}})});var I=m("./ClientWidgetApi");Object.keys(I).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===I[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return I[H]}})});var E=m("./Symbols");Object.keys(E).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===E[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return E[H]}})});var _=m("./transport/ITransport");Object.keys(_).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===_[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return _[H]}})});var d=m("./transport/PostmessageTransport");Object.keys(d).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===d[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return d[H]}})});var u=m("./interfaces/ICustomWidgetData");Object.keys(u).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===u[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return u[H]}})});var g=m("./interfaces/IJitsiWidgetData");Object.keys(g).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===g[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return g[H]}})});var f=m("./interfaces/IStickerpickerWidgetData");Object.keys(f).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===f[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return f[H]}})});var v=m("./interfaces/IWidget");Object.keys(v).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===v[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return v[H]}})});var c=m("./interfaces/WidgetType");Object.keys(c).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===c[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return c[H]}})});var i=m("./interfaces/IWidgetApiErrorResponse");Object.keys(i).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===i[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return i[H]}})});var r=m("./interfaces/IWidgetApiRequest");Object.keys(r).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===r[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return r[H]}})});var s=m("./interfaces/IWidgetApiResponse");Object.keys(s).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===s[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return s[H]}})});var t=m("./interfaces/WidgetApiAction");Object.keys(t).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===t[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return t[H]}})});var n=m("./interfaces/WidgetApiDirection");Object.keys(n).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===n[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return n[H]}})});var o=m("./interfaces/ApiVersion");Object.keys(o).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===o[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return o[H]}})});var h=m("./interfaces/Capabilities");Object.keys(h).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===h[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return h[H]}})});var l=m("./interfaces/CapabilitiesAction");Object.keys(l).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===l[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return l[H]}})});var e=m("./interfaces/ContentLoadedAction");Object.keys(e).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===e[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return e[H]}})});var p=m("./interfaces/ScreenshotAction");Object.keys(p).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===p[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return p[H]}})});var b=m("./interfaces/StickerAction");Object.keys(b).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===b[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return b[H]}})});var y=m("./interfaces/StickyAction");Object.keys(y).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===y[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return y[H]}})});var w=m("./interfaces/SupportedVersionsAction");Object.keys(w).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===w[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return w[H]}})});var x=m("./interfaces/VisibilityAction");Object.keys(x).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===x[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return x[H]}})});var B=m("./interfaces/GetOpenIDAction");Object.keys(B).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===B[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return B[H]}})});var J=m("./interfaces/OpenIDCredentialsAction");Object.keys(J).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===J[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return J[H]}})});var z=m("./interfaces/WidgetKind");Object.keys(z).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===z[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return z[H]}})});var M=m("./interfaces/ModalButtonKind");Object.keys(M).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===M[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return M[H]}})});var L=m("./interfaces/ModalWidgetActions");Object.keys(L).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===L[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return L[H]}})});var j=m("./interfaces/SetModalButtonEnabledAction");Object.keys(j).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===j[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return j[H]}})});var C=m("./interfaces/WidgetConfigAction");Object.keys(C).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===C[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return C[H]}})});var F=m("./interfaces/SendEventAction");Object.keys(F).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===F[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return F[H]}})});var V=m("./interfaces/SendToDeviceAction");Object.keys(V).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===V[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return V[H]}})});var N=m("./interfaces/ReadEventAction");Object.keys(N).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===N[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return N[H]}})});var T=m("./interfaces/IRoomEvent");Object.keys(T).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===T[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return T[H]}})});var S=m("./interfaces/NavigateAction");Object.keys(S).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===S[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return S[H]}})});var U=m("./interfaces/TurnServerActions");Object.keys(U).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===U[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return U[H]}})});var W=m("./interfaces/ReadRelationsAction");Object.keys(W).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===W[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return W[H]}})});var k=m("./models/WidgetEventCapability");Object.keys(k).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===k[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return k[H]}})});var D=m("./models/validation/url");Object.keys(D).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===D[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return D[H]}})});var Q=m("./models/validation/utils");Object.keys(Q).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===Q[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return Q[H]}})});var ee=m("./models/Widget");Object.keys(ee).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===ee[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return ee[H]}})});var ae=m("./models/WidgetParser");Object.keys(ae).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===ae[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return ae[H]}})});var ue=m("./templating/url-template");Object.keys(ue).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===ue[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return ue[H]}})});var be=m("./util/SimpleObservable");Object.keys(be).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===be[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return be[H]}})});var X=m("./driver/WidgetDriver");Object.keys(X).forEach(function(H){"default"===H||"__esModule"===H||H in a&&a[H]===X[H]||Object.defineProperty(a,H,{enumerable:!0,get:function(){return X[H]}})})},{"./ClientWidgetApi":174,"./Symbols":175,"./WidgetApi":176,"./driver/WidgetDriver":177,"./interfaces/ApiVersion":179,"./interfaces/Capabilities":180,"./interfaces/CapabilitiesAction":181,"./interfaces/ContentLoadedAction":182,"./interfaces/GetOpenIDAction":183,"./interfaces/ICustomWidgetData":184,"./interfaces/IJitsiWidgetData":185,"./interfaces/IRoomEvent":186,"./interfaces/IStickerpickerWidgetData":187,"./interfaces/IWidget":188,"./interfaces/IWidgetApiErrorResponse":189,"./interfaces/IWidgetApiRequest":190,"./interfaces/IWidgetApiResponse":191,"./interfaces/ModalButtonKind":192,"./interfaces/ModalWidgetActions":193,"./interfaces/NavigateAction":194,"./interfaces/OpenIDCredentialsAction":195,"./interfaces/ReadEventAction":196,"./interfaces/ReadRelationsAction":197,"./interfaces/ScreenshotAction":198,"./interfaces/SendEventAction":199,"./interfaces/SendToDeviceAction":200,"./interfaces/SetModalButtonEnabledAction":201,"./interfaces/StickerAction":202,"./interfaces/StickyAction":203,"./interfaces/SupportedVersionsAction":204,"./interfaces/TurnServerActions":205,"./interfaces/VisibilityAction":206,"./interfaces/WidgetApiAction":207,"./interfaces/WidgetApiDirection":208,"./interfaces/WidgetConfigAction":209,"./interfaces/WidgetKind":210,"./interfaces/WidgetType":211,"./models/Widget":212,"./models/WidgetEventCapability":213,"./models/WidgetParser":214,"./models/validation/url":215,"./models/validation/utils":216,"./templating/url-template":217,"./transport/ITransport":218,"./transport/PostmessageTransport":219,"./util/SimpleObservable":220}],179:[function(m,ie,a){"use strict";var R,_,I;Object.defineProperty(a,"__esModule",{value:!0}),a.UnstableApiVersion=a.MatrixApiVersion=a.CurrentApiVersions=void 0,a.MatrixApiVersion=R,(_=R||(a.MatrixApiVersion=R={})).Prerelease1="0.0.1",_.Prerelease2="0.0.2",a.UnstableApiVersion=I,function(_){_.MSC2762="org.matrix.msc2762",_.MSC2871="org.matrix.msc2871",_.MSC2931="org.matrix.msc2931",_.MSC2974="org.matrix.msc2974",_.MSC2876="org.matrix.msc2876",_.MSC3819="org.matrix.msc3819",_.MSC3846="town.robin.msc3846",_.MSC3869="org.matrix.msc3869"}(I||(a.UnstableApiVersion=I={})),a.CurrentApiVersions=[R.Prerelease1,R.Prerelease2,I.MSC2762,I.MSC2871,I.MSC2931,I.MSC2974,I.MSC2876,I.MSC3819,I.MSC3846,I.MSC3869]},{}],180:[function(m,ie,a){"use strict";var R,g;Object.defineProperty(a,"__esModule",{value:!0}),a.VideoConferenceCapabilities=a.StickerpickerCapabilities=a.MatrixCapabilities=void 0,a.getTimelineRoomIDFromCapability=function u(g){return g.substring(g.indexOf(":")+1)},a.isTimelineCapability=function _(g){return g?.startsWith("org.matrix.msc2762.timeline:")},a.isTimelineCapabilityFor=function d(g,f){return g==="org.matrix.msc2762.timeline:".concat(f)},a.MatrixCapabilities=R,(g=R||(a.MatrixCapabilities=R={})).Screenshots="m.capability.screenshot",g.StickerSending="m.sticker",g.AlwaysOnScreen="m.always_on_screen",g.RequiresClient="io.element.requires_client",g.MSC2931Navigate="org.matrix.msc2931.navigate",g.MSC3846TurnServers="town.robin.msc3846.turn_servers",a.StickerpickerCapabilities=[R.StickerSending],a.VideoConferenceCapabilities=[R.AlwaysOnScreen]},{}],181:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],182:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],183:[function(m,ie,a){"use strict";var R,I;Object.defineProperty(a,"__esModule",{value:!0}),a.OpenIDRequestState=void 0,a.OpenIDRequestState=R,(I=R||(a.OpenIDRequestState=R={})).Allowed="allowed",I.Blocked="blocked",I.PendingUserConfirmation="request"},{}],184:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],185:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],186:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],187:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],188:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],189:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isErrorResponse=function R(I){return"error"in I&&!!I.error.message}},{}],190:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],191:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],192:[function(m,ie,a){"use strict";var R,I;Object.defineProperty(a,"__esModule",{value:!0}),a.ModalButtonKind=void 0,a.ModalButtonKind=R,(I=R||(a.ModalButtonKind=R={})).Primary="m.primary",I.Secondary="m.secondary",I.Warning="m.warning",I.Danger="m.danger",I.Link="m.link"},{}],193:[function(m,ie,a){"use strict";var R;Object.defineProperty(a,"__esModule",{value:!0}),a.BuiltInModalButtonID=void 0,a.BuiltInModalButtonID=R,(R||(a.BuiltInModalButtonID=R={})).Close="m.close"},{}],194:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],195:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],196:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],197:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],198:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],199:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],200:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],201:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],202:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],203:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],204:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],205:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],206:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],207:[function(m,ie,a){"use strict";var R,E,I;Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetApiToWidgetAction=a.WidgetApiFromWidgetAction=void 0,a.WidgetApiToWidgetAction=R,(E=R||(a.WidgetApiToWidgetAction=R={})).SupportedApiVersions="supported_api_versions",E.Capabilities="capabilities",E.NotifyCapabilities="notify_capabilities",E.TakeScreenshot="screenshot",E.UpdateVisibility="visibility",E.OpenIDCredentials="openid_credentials",E.WidgetConfig="widget_config",E.CloseModalWidget="close_modal",E.ButtonClicked="button_clicked",E.SendEvent="send_event",E.SendToDevice="send_to_device",E.UpdateTurnServers="update_turn_servers",a.WidgetApiFromWidgetAction=I,function(E){E.SupportedApiVersions="supported_api_versions",E.ContentLoaded="content_loaded",E.SendSticker="m.sticker",E.UpdateAlwaysOnScreen="set_always_on_screen",E.GetOpenIDCredentials="get_openid",E.CloseModalWidget="close_modal",E.OpenModalWidget="open_modal",E.SetModalButtonEnabled="set_button_enabled",E.SendEvent="send_event",E.SendToDevice="send_to_device",E.WatchTurnServers="watch_turn_servers",E.UnwatchTurnServers="unwatch_turn_servers",E.MSC2876ReadEvents="org.matrix.msc2876.read_events",E.MSC2931Navigate="org.matrix.msc2931.navigate",E.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",E.MSC3869ReadRelations="org.matrix.msc3869.read_relations"}(I||(a.WidgetApiFromWidgetAction=I={}))},{}],208:[function(m,ie,a){"use strict";var R,E;Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetApiDirection=void 0,a.invertedDirection=function I(E){if(E===R.ToWidget)return R.FromWidget;if(E===R.FromWidget)return R.ToWidget;throw new Error("Invalid direction")},a.WidgetApiDirection=R,(E=R||(a.WidgetApiDirection=R={})).ToWidget="toWidget",E.FromWidget="fromWidget"},{}],209:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],210:[function(m,ie,a){"use strict";var R,I;Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetKind=void 0,a.WidgetKind=R,(I=R||(a.WidgetKind=R={})).Room="room",I.Account="account",I.Modal="modal"},{}],211:[function(m,ie,a){"use strict";var R,I;Object.defineProperty(a,"__esModule",{value:!0}),a.MatrixWidgetType=void 0,a.MatrixWidgetType=R,(I=R||(a.MatrixWidgetType=R={})).Custom="m.custom",I.JitsiMeet="m.jitsi",I.Stickerpicker="m.stickerpicker"},{}],212:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Widget=void 0;var R=m("./validation/utils"),I=m("..");function _(g,f){for(var v=0;v<f.length;v++){var c=f[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(g,c.key,c)}}a.Widget=function(){function g(f){if(function E(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}(this,g),this.definition=f,!this.definition)throw new Error("Definition is required");(0,R.assertPresent)(f,"id"),(0,R.assertPresent)(f,"creatorUserId"),(0,R.assertPresent)(f,"type"),(0,R.assertPresent)(f,"url")}return function d(g,f,v){f&&_(g.prototype,f),v&&_(g,v),Object.defineProperty(g,"prototype",{writable:!1})}(g,[{key:"creatorUserId",get:function(){return this.definition.creatorUserId}},{key:"type",get:function(){return this.definition.type}},{key:"id",get:function(){return this.definition.id}},{key:"name",get:function(){return this.definition.name||null}},{key:"title",get:function(){return this.rawData.title||null}},{key:"templateUrl",get:function(){return this.definition.url}},{key:"origin",get:function(){return new URL(this.templateUrl).origin}},{key:"waitForIframeLoad",get:function(){return!1!==this.definition.waitForIframeLoad}},{key:"rawData",get:function(){return this.definition.data||{}}},{key:"getCompleteUrl",value:function(v){return(0,I.runTemplate)(this.templateUrl,this.definition,v)}}]),g}()},{"..":178,"./validation/utils":216}],213:[function(m,ie,a){"use strict";function E(c,i){(null==i||i>c.length)&&(i=c.length);for(var r=0,s=new Array(i);r<i;r++)s[r]=c[r];return s}function d(c,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(c,s.key,s)}}var g,c,f;Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetEventCapability=a.EventKind=a.EventDirection=void 0,a.EventKind=g,(c=g||(a.EventKind=g={})).Event="event",c.State="state_event",c.ToDevice="to_device",a.EventDirection=f,function(c){c.Send="send",c.Receive="receive"}(f||(a.EventDirection=f={}));var v=function(){function c(i,r,s,t,n){(function _(c,i){if(!(c instanceof i))throw new TypeError("Cannot call a class as a function")})(this,c),this.direction=i,this.eventType=r,this.kind=s,this.keyStr=t,this.raw=n}return function u(c,i,r){i&&d(c.prototype,i),r&&d(c,r),Object.defineProperty(c,"prototype",{writable:!1})}(c,[{key:"matchesAsStateEvent",value:function(r,s,t){return this.kind===g.State&&this.direction===r&&this.eventType===s&&(null===this.keyStr||this.keyStr===t)}},{key:"matchesAsToDeviceEvent",value:function(r,s){return!(this.kind!==g.ToDevice||this.direction!==r||this.eventType!==s)}},{key:"matchesAsRoomEvent",value:function(r,s){return this.kind===g.Event&&this.direction===r&&this.eventType===s&&("m.room.message"!==this.eventType||null===this.keyStr||this.keyStr===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null))}}],[{key:"forStateEvent",value:function(r,s,t){s=s.replace(/#/g,"\\#"),t=null!=t?"#".concat(t):"";var n="org.matrix.msc2762.".concat(r,".state_event:").concat(s).concat(t);return c.findEventCapabilities([n])[0]}},{key:"forToDeviceEvent",value:function(r,s){var t="org.matrix.msc3819.".concat(r,".to_device:").concat(s);return c.findEventCapabilities([t])[0]}},{key:"forRoomEvent",value:function(r,s){var t="org.matrix.msc2762.".concat(r,".event:").concat(s);return c.findEventCapabilities([t])[0]}},{key:"forRoomMessageEvent",value:function(r,s){s=s??"";var t="org.matrix.msc2762.".concat(r,".event:m.room.message#").concat(s);return c.findEventCapabilities([t])[0]}},{key:"findEventCapabilities",value:function(r){var n,s=[],t=function R(c,i){var r=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!r){if(Array.isArray(c)||(r=function I(c,i){if(c){if("string"==typeof c)return E(c,i);var r=Object.prototype.toString.call(c).slice(8,-1);if("Object"===r&&c.constructor&&(r=c.constructor.name),"Map"===r||"Set"===r)return Array.from(c);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(c,i)}}(c))||i&&c&&"number"==typeof c.length){r&&(c=r);var s=0,t=function(){};return{s:t,n:function(){return s>=c.length?{done:!0}:{done:!1,value:c[s++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,n=!0,o=!1;return{s:function(){r=r.call(c)},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,h=e},f:function(){try{!n&&null!=r.return&&r.return()}finally{if(o)throw h}}}}(r);try{for(t.s();!(n=t.n()).done;){var o=n.value,h=null,l=void 0,e=null;if(o.startsWith("org.matrix.msc2762.send.event:")?(h=f.Send,e=g.Event,l=o.substring(30)):o.startsWith("org.matrix.msc2762.send.state_event:")?(h=f.Send,e=g.State,l=o.substring(36)):o.startsWith("org.matrix.msc3819.send.to_device:")?(h=f.Send,e=g.ToDevice,l=o.substring(34)):o.startsWith("org.matrix.msc2762.receive.event:")?(h=f.Receive,e=g.Event,l=o.substring(33)):o.startsWith("org.matrix.msc2762.receive.state_event:")?(h=f.Receive,e=g.State,l=o.substring(39)):o.startsWith("org.matrix.msc3819.receive.to_device:")&&(h=f.Receive,e=g.ToDevice,l=o.substring(37)),null!==h&&null!==e){var p=l.startsWith("m.room.message#")||e===g.State,b=null;if(l.includes("#")&&p){var y=l.split("#"),w=y.findIndex(function(x){return!x.endsWith("\\")});l=y.slice(0,w+1).map(function(x){return x.endsWith("\\")?x.substring(0,x.length-1):x}).join("#"),b=y.slice(w+1).join("#")}s.push(new c(h,l,e,b,o))}}}catch(x){t.e(x)}finally{t.f()}return s}}]),c}();a.WidgetEventCapability=v},{}],214:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.WidgetParser=void 0;var R=m("./Widget"),I=m("./validation/url");function d(c,i){(null==i||i>c.length)&&(i=c.length);for(var r=0,s=new Array(i);r<i;r++)s[r]=c[r];return s}function g(c,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(c,s.key,s)}}a.WidgetParser=function(){function c(){!function u(c,i){if(!(c instanceof i))throw new TypeError("Cannot call a class as a function")}(this,c)}return function f(c,i,r){i&&g(c.prototype,i),r&&g(c,r),Object.defineProperty(c,"prototype",{writable:!1})}(c,null,[{key:"parseAccountData",value:function(r){if(!r)return[];for(var s=[],t=0,n=Object.keys(r);t<n.length;t++){var o=n[t],h=r[o];if(h&&("m.widget"===h.type||"im.vector.modular.widgets"===h.type)&&h.sender&&(h.state_key||h.id)===o){var p=c.parseRoomWidget({content:h.content,sender:h.sender,type:"m.widget",state_key:o,event_id:"$example",room_id:"!example",origin_server_ts:1});p&&s.push(p)}}return s}},{key:"parseWidgetsFromRoomState",value:function(r){if(!r)return[];var n,s=[],t=function E(c,i){var r=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!r){if(Array.isArray(c)||(r=function _(c,i){if(c){if("string"==typeof c)return d(c,i);var r=Object.prototype.toString.call(c).slice(8,-1);if("Object"===r&&c.constructor&&(r=c.constructor.name),"Map"===r||"Set"===r)return Array.from(c);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(c,i)}}(c))||i&&c&&"number"==typeof c.length){r&&(c=r);var s=0,t=function(){};return{s:t,n:function(){return s>=c.length?{done:!0}:{done:!1,value:c[s++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,n=!0,o=!1;return{s:function(){r=r.call(c)},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,h=e},f:function(){try{!n&&null!=r.return&&r.return()}finally{if(o)throw h}}}}(r);try{for(t.s();!(n=t.n()).done;){var h=c.parseRoomWidget(n.value);h&&s.push(h)}}catch(l){t.e(l)}finally{t.f()}return s}},{key:"parseRoomWidget",value:function(r){if(!r||"m.widget"!==r.type&&"im.vector.modular.widgets"!==r.type)return null;var s=r.content||{};return c.processEstimatedWidget({id:r.state_key,creatorUserId:s.creatorUserId||r.sender,name:s.name,type:s.type,url:s.url,waitForIframeLoad:s.waitForIframeLoad,data:s.data})}},{key:"processEstimatedWidget",value:function(r){return r.id&&r.creatorUserId&&r.type&&(0,I.isValidUrl)(r.url)?new R.Widget(r):null}}]),c}()},{"./Widget":212,"./validation/url":215}],215:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isValidUrl=function R(I){if(!I)return!1;try{var E=new URL(I);return!("http"!==E.protocol&&"https"!==E.protocol)}catch(_){if(_ instanceof TypeError)return!1;throw _}}},{}],216:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.assertPresent=function R(I,E){if(!I[E])throw new Error("".concat(E," is required"))}},{}],217:[function(m,ie,a){"use strict";function I(E){return null==E?"".concat(E):E.toString()}Object.defineProperty(a,"__esModule",{value:!0}),a.runTemplate=function R(E,_,d){for(var u=Object.assign({},_.data,{matrix_room_id:d.widgetRoomId||"",matrix_user_id:d.currentUserId,matrix_display_name:d.userDisplayName||d.currentUserId,matrix_avatar_url:d.userHttpAvatarUrl||"",matrix_widget_id:_.id,"org.matrix.msc2873.client_id":d.clientId||"","org.matrix.msc2873.client_theme":d.clientTheme||"","org.matrix.msc2873.client_language":d.clientLanguage||""}),g=E,f=0,v=Object.keys(u);f<v.length;f++){var c=v[f],i="$".concat(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(i,"g");g=g.replace(r,encodeURIComponent(I(u[c])))}return g},a.toString=I},{}],218:[function(m,ie,a){arguments[4][153][0].apply(a,arguments)},{dup:153}],219:[function(m,ie,a){"use strict";function R(l){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(l)}Object.defineProperty(a,"__esModule",{value:!0}),a.PostmessageTransport=void 0;var I=m("events"),E=m("..");function _(l,e){var p=Object.keys(l);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(l);e&&(b=b.filter(function(y){return Object.getOwnPropertyDescriptor(l,y).enumerable})),p.push.apply(p,b)}return p}function d(l){for(var e=1;e<arguments.length;e++){var p=null!=arguments[e]?arguments[e]:{};e%2?_(Object(p),!0).forEach(function(b){o(l,b,p[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(p)):_(Object(p)).forEach(function(b){Object.defineProperty(l,b,Object.getOwnPropertyDescriptor(p,b))})}return l}function g(l,e){for(var p=0;p<e.length;p++){var b=e[p];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(l,b.key,b)}}function c(l,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,y){return b.__proto__=y,b})(l,e)}function s(l){if(void 0===l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function n(l){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)})(l)}function o(l,e,p){return e in l?Object.defineProperty(l,e,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[e]=p,l}a.PostmessageTransport=function(l){!function v(l,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(e&&e.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),e&&c(l,e)}(p,l);var e=function i(l){var e=function t(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var y,b=n(l);if(e){var w=n(this).constructor;y=Reflect.construct(b,arguments,w)}else y=b.apply(this,arguments);return function r(l,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return s(l)}(this,y)}}(p);function p(b,y,w,x){var B;return function u(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),(B=e.call(this)).sendDirection=b,B.initialWidgetId=y,B.transportWindow=w,B.inboundWindow=x,o(s(B),"strictOriginCheck",void 0),o(s(B),"targetOrigin",void 0),o(s(B),"timeoutSeconds",10),o(s(B),"_ready",!1),o(s(B),"_widgetId",null),o(s(B),"outboundRequests",new Map),o(s(B),"stopController",new AbortController),B._widgetId=y,B}return function f(l,e,p){e&&g(l.prototype,e),p&&g(l,p),Object.defineProperty(l,"prototype",{writable:!1})}(p,[{key:"ready",get:function(){return this._ready}},{key:"widgetId",get:function(){return this._widgetId||null}},{key:"nextRequestId",get:function(){for(var y="widgetapi-".concat(Date.now()),w=0,x=y;this.outboundRequests.has(x);)x="".concat(y,"-").concat(w++);return this.outboundRequests.set(x,null),x}},{key:"sendInternal",value:function(y){var w=this.targetOrigin||"*";console.log("[PostmessageTransport] Sending object to ".concat(w,": "),y),this.transportWindow.postMessage(y,w)}},{key:"reply",value:function(y,w){return this.sendInternal(d(d({},y),{},{response:w}))}},{key:"send",value:function(y,w){return this.sendComplete(y,w).then(function(x){return x.response})}},{key:"sendComplete",value:function(y,w){var x=this;if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));var B={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:y,data:w};return y===E.WidgetApiToWidgetAction.UpdateVisibility&&(B.visible=w.visible),new Promise(function(J,z){var L=function(N){F(),z(N)},j=setTimeout(function(){return L(new Error("Request timed out"))},1e3*(x.timeoutSeconds||1)),C=function(){return L(new Error("Transport stopped"))};x.stopController.signal.addEventListener("abort",C);var F=function(){x.outboundRequests.delete(B.requestId),clearTimeout(j),x.stopController.signal.removeEventListener("abort",C)};x.outboundRequests.set(B.requestId,{request:B,resolve:function(N){F(),J(N)},reject:L}),x.sendInternal(B)})}},{key:"start",value:function(){var y=this;this.inboundWindow.addEventListener("message",function(w){y.handleMessage(w)}),this._ready=!0}},{key:"stop",value:function(){this._ready=!1,this.stopController.abort()}},{key:"handleMessage",value:function(y){if(!this.stopController.signal.aborted&&y.data&&(!this.strictOriginCheck||y.origin===window.origin)){var w=y.data;if(w.action&&w.requestId&&w.widgetId)if(w.response){if(w.api!==this.sendDirection)return;this.handleResponse(w)}else{var x=w;if(x.api!==(0,E.invertedDirection)(this.sendDirection))return;this.handleRequest(x)}}}},{key:"handleRequest",value:function(y){if(this.widgetId){if(this.widgetId!==y.widgetId)return}else this._widgetId=y.widgetId;this.emit("message",new CustomEvent("message",{detail:y}))}},{key:"handleResponse",value:function(y){if(y.widgetId===this.widgetId){var w=this.outboundRequests.get(y.requestId);w&&((0,E.isErrorResponse)(y.response)?w.reject(new Error(y.response.error.message)):w.resolve(y))}}}]),p}(I.EventEmitter)},{"..":178,events:105}],220:[function(m,ie,a){"use strict";function E(v,c){(null==c||c>v.length)&&(c=v.length);for(var i=0,r=new Array(c);i<c;i++)r[i]=v[i];return r}function d(v,c){for(var i=0;i<c.length;i++){var r=c[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(v,r.key,r)}}Object.defineProperty(a,"__esModule",{value:!0}),a.SimpleObservable=void 0,a.SimpleObservable=function(){function v(c){(function _(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")})(this,v),function g(v,c,i){c in v?Object.defineProperty(v,c,{value:i,enumerable:!0,configurable:!0,writable:!0}):v[c]=i}(this,"listeners",[]),c&&this.listeners.push(c)}return function u(v,c,i){c&&d(v.prototype,c),i&&d(v,i),Object.defineProperty(v,"prototype",{writable:!1})}(v,[{key:"onUpdate",value:function(i){this.listeners.push(i)}},{key:"update",value:function(i){var s,r=function R(v,c){var i=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!i){if(Array.isArray(v)||(i=function I(v,c){if(v){if("string"==typeof v)return E(v,c);var i=Object.prototype.toString.call(v).slice(8,-1);if("Object"===i&&v.constructor&&(i=v.constructor.name),"Map"===i||"Set"===i)return Array.from(v);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return E(v,c)}}(v))||c&&v&&"number"==typeof v.length){i&&(v=i);var r=0,s=function(){};return{s,n:function(){return r>=v.length?{done:!0}:{done:!1,value:v[r++]}},e:function(l){throw l},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,t=!0,n=!1;return{s:function(){i=i.call(v)},n:function(){var l=i.next();return t=l.done,l},e:function(l){n=!0,o=l},f:function(){try{!t&&null!=i.return&&i.return()}finally{if(n)throw o}}}}(this.listeners);try{for(r.s();!(s=r.n()).done;)(0,s.value)(i)}catch(n){r.e(n)}finally{r.f()}}},{key:"close",value:function(){this.listeners=[]}}]),v}()},{}],221:[function(m,ie,a){"use strict";var R=m("inherits"),I=m("hash-base"),E=m("safe-buffer").Buffer,_=new Array(16);function d(){I.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function u(i,r){return i<<r|i>>>32-r}function g(i,r,s,t,n,o,h){return u(i+(r&s|~r&t)+n+o|0,h)+r|0}function f(i,r,s,t,n,o,h){return u(i+(r&t|s&~t)+n+o|0,h)+r|0}function v(i,r,s,t,n,o,h){return u(i+(r^s^t)+n+o|0,h)+r|0}function c(i,r,s,t,n,o,h){return u(i+(s^(r|~t))+n+o|0,h)+r|0}R(d,I),d.prototype._update=function(){for(var i=_,r=0;r<16;++r)i[r]=this._block.readInt32LE(4*r);var s=this._a,t=this._b,n=this._c,o=this._d;s=g(s,t,n,o,i[0],3614090360,7),o=g(o,s,t,n,i[1],3905402710,12),n=g(n,o,s,t,i[2],606105819,17),t=g(t,n,o,s,i[3],3250441966,22),s=g(s,t,n,o,i[4],4118548399,7),o=g(o,s,t,n,i[5],1200080426,12),n=g(n,o,s,t,i[6],2821735955,17),t=g(t,n,o,s,i[7],4249261313,22),s=g(s,t,n,o,i[8],1770035416,7),o=g(o,s,t,n,i[9],2336552879,12),n=g(n,o,s,t,i[10],4294925233,17),t=g(t,n,o,s,i[11],2304563134,22),s=g(s,t,n,o,i[12],1804603682,7),o=g(o,s,t,n,i[13],4254626195,12),n=g(n,o,s,t,i[14],2792965006,17),s=f(s,t=g(t,n,o,s,i[15],1236535329,22),n,o,i[1],4129170786,5),o=f(o,s,t,n,i[6],3225465664,9),n=f(n,o,s,t,i[11],643717713,14),t=f(t,n,o,s,i[0],3921069994,20),s=f(s,t,n,o,i[5],3593408605,5),o=f(o,s,t,n,i[10],38016083,9),n=f(n,o,s,t,i[15],3634488961,14),t=f(t,n,o,s,i[4],3889429448,20),s=f(s,t,n,o,i[9],568446438,5),o=f(o,s,t,n,i[14],3275163606,9),n=f(n,o,s,t,i[3],4107603335,14),t=f(t,n,o,s,i[8],1163531501,20),s=f(s,t,n,o,i[13],2850285829,5),o=f(o,s,t,n,i[2],4243563512,9),n=f(n,o,s,t,i[7],1735328473,14),s=v(s,t=f(t,n,o,s,i[12],2368359562,20),n,o,i[5],4294588738,4),o=v(o,s,t,n,i[8],2272392833,11),n=v(n,o,s,t,i[11],1839030562,16),t=v(t,n,o,s,i[14],4259657740,23),s=v(s,t,n,o,i[1],2763975236,4),o=v(o,s,t,n,i[4],1272893353,11),n=v(n,o,s,t,i[7],4139469664,16),t=v(t,n,o,s,i[10],3200236656,23),s=v(s,t,n,o,i[13],681279174,4),o=v(o,s,t,n,i[0],3936430074,11),n=v(n,o,s,t,i[3],3572445317,16),t=v(t,n,o,s,i[6],76029189,23),s=v(s,t,n,o,i[9],3654602809,4),o=v(o,s,t,n,i[12],3873151461,11),n=v(n,o,s,t,i[15],530742520,16),s=c(s,t=v(t,n,o,s,i[2],3299628645,23),n,o,i[0],4096336452,6),o=c(o,s,t,n,i[7],1126891415,10),n=c(n,o,s,t,i[14],2878612391,15),t=c(t,n,o,s,i[5],4237533241,21),s=c(s,t,n,o,i[12],1700485571,6),o=c(o,s,t,n,i[3],2399980690,10),n=c(n,o,s,t,i[10],4293915773,15),t=c(t,n,o,s,i[1],2240044497,21),s=c(s,t,n,o,i[8],1873313359,6),o=c(o,s,t,n,i[15],4264355552,10),n=c(n,o,s,t,i[6],2734768916,15),t=c(t,n,o,s,i[13],1309151649,21),s=c(s,t,n,o,i[4],4149444226,6),o=c(o,s,t,n,i[11],3174756917,10),n=c(n,o,s,t,i[2],718787259,15),t=c(t,n,o,s,i[9],3951481745,21),this._a=this._a+s|0,this._b=this._b+t|0,this._c=this._c+n|0,this._d=this._d+o|0},d.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var i=E.allocUnsafe(16);return i.writeInt32LE(this._a,0),i.writeInt32LE(this._b,4),i.writeInt32LE(this._c,8),i.writeInt32LE(this._d,12),i},ie.exports=d},{"hash-base":116,inherits:146,"safe-buffer":250}],222:[function(m,ie,a){var R=m("bn.js"),I=m("brorand");function E(_){this.rand=_||new I.Rand}ie.exports=E,E.create=function(d){return new E(d)},E.prototype._randbelow=function(d){var u=d.bitLength(),g=Math.ceil(u/8);do{var f=new R(this.rand.generate(g))}while(f.cmp(d)>=0);return f},E.prototype._randrange=function(d,u){var g=u.sub(d);return d.add(this._randbelow(g))},E.prototype.test=function(d,u,g){var f=d.bitLength(),v=R.mont(d),c=new R(1).toRed(v);u||(u=Math.max(1,f/48|0));for(var i=d.subn(1),r=0;!i.testn(r);r++);for(var s=d.shrn(r),t=i.toRed(v);u>0;u--){var o=this._randrange(new R(2),i);g&&g(o);var h=o.toRed(v).redPow(s);if(0!==h.cmp(c)&&0!==h.cmp(t)){for(var l=1;l<r;l++){if(0===(h=h.redSqr()).cmp(c))return!1;if(0===h.cmp(t))break}if(l===r)return!1}}return!0},E.prototype.getDivisor=function(d,u){var g=d.bitLength(),f=R.mont(d),v=new R(1).toRed(f);u||(u=Math.max(1,g/48|0));for(var c=d.subn(1),i=0;!c.testn(i);i++);for(var r=d.shrn(i),s=c.toRed(f);u>0;u--){var t=this._randrange(new R(2),c),n=d.gcd(t);if(0!==n.cmpn(1))return n;var o=t.toRed(f).redPow(r);if(0!==o.cmp(v)&&0!==o.cmp(s)){for(var h=1;h<i;h++){if(0===(o=o.redSqr()).cmp(v))return o.fromRed().subn(1).gcd(d);if(0===o.cmp(s))break}if(h===i)return(o=o.redSqr()).fromRed().subn(1).gcd(d)}}return!1}},{"bn.js":18,brorand:19}],223:[function(m,ie,a){function R(I,E){if(!I)throw new Error(E||"Assertion failed")}ie.exports=R,R.equal=function(E,_,d){if(E!=_)throw new Error(d||"Assertion failed: "+E+" != "+_)}},{}],224:[function(m,ie,a){"use strict";var R=a;function E(d){return 1===d.length?"0"+d:d}function _(d){for(var u="",g=0;g<d.length;g++)u+=E(d[g].toString(16));return u}R.toArray=function I(d,u){if(Array.isArray(d))return d.slice();if(!d)return[];var g=[];if("string"!=typeof d){for(var f=0;f<d.length;f++)g[f]=0|d[f];return g}if("hex"===u)for((d=d.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(d="0"+d),f=0;f<d.length;f+=2)g.push(parseInt(d[f]+d[f+1],16));else for(f=0;f<d.length;f++){var v=d.charCodeAt(f),c=v>>8,i=255&v;c?g.push(c,i):g.push(i)}return g},R.zero2=E,R.toHex=_,R.encode=function(u,g){return"hex"===g?_(u):u}},{}],225:[function(m,ie,a){"use strict";const R=m("retry"),I=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class E extends Error{constructor(f){super(),f instanceof Error?(this.originalError=f,({message:f}=f)):(this.originalError=new Error(f),this.originalError.stack=this.stack),this.name="AbortError",this.message=f}}const u=(g,f)=>new Promise((v,c)=>{f={onFailedAttempt:()=>{},retries:10,...f};const i=R.operation(f);i.attempt(async r=>{try{v(await g(r))}catch(s){if(!(s instanceof Error))return void c(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));if(s instanceof E)i.stop(),c(s.originalError);else if(s instanceof TypeError&&!(g=>I.includes(g))(s.message))i.stop(),c(s);else{((g,f,v)=>{const c=v.retries-(f-1);g.attemptNumber=f,g.retriesLeft=c})(s,r,f);try{await f.onFailedAttempt(s)}catch(t){return void c(t)}i.retry(s)||c(i.mainError())}}})});ie.exports=u,ie.exports.default=u,ie.exports.AbortError=E},{retry:246}],226:[function(m,ie,a){ie.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],227:[function(m,ie,a){"use strict";var R=m("asn1.js");a.certificate=m("./certificate");var I=R.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});a.RSAPrivateKey=I;var E=R.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});a.RSAPublicKey=E;var _=R.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(d),this.key("subjectPublicKey").bitstr())});a.PublicKey=_;var d=R.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),u=R.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(d),this.key("subjectPrivateKey").octstr())});a.PrivateKey=u;var g=R.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});a.EncryptedPrivateKey=g;var f=R.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});a.DSAPrivateKey=f,a.DSAparam=R.define("DSAparam",function(){this.int()});var v=R.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(c),this.key("publicKey").optional().explicit(1).bitstr())});a.ECPrivateKey=v;var c=R.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});a.signature=R.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},{"./certificate":228,"asn1.js":2}],228:[function(m,ie,a){"use strict";var R=m("asn1.js"),I=R.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),E=R.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),_=R.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),d=R.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(_),this.key("subjectPublicKey").bitstr())}),u=R.define("RelativeDistinguishedName",function(){this.setof(E)}),g=R.define("RDNSequence",function(){this.seqof(u)}),f=R.define("Name",function(){this.choice({rdnSequence:this.use(g)})}),v=R.define("Validity",function(){this.seq().obj(this.key("notBefore").use(I),this.key("notAfter").use(I))}),c=R.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),i=R.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(_),this.key("issuer").use(f),this.key("validity").use(v),this.key("subject").use(f),this.key("subjectPublicKeyInfo").use(d),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(c).optional())}),r=R.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(i),this.key("signatureAlgorithm").use(_),this.key("signatureValue").bitstr())});ie.exports=r},{"asn1.js":2}],229:[function(m,ie,a){var R=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,I=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,E=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,_=m("evp_bytestokey"),d=m("browserify-aes"),u=m("safe-buffer").Buffer;ie.exports=function(g,f){var i,v=g.toString(),c=v.match(R);if(c){var s="aes"+c[1],t=u.from(c[2],"hex"),n=u.from(c[3].replace(/[\r\n]/g,""),"base64"),o=_(f,t.slice(0,8),parseInt(c[1],10)).key,h=[],l=d.createDecipheriv(s,o,t);h.push(l.update(n)),h.push(l.final()),i=u.concat(h)}else{var r=v.match(E);i=u.from(r[2].replace(/[\r\n]/g,""),"base64")}return{tag:v.match(I)[1],data:i}}},{"browserify-aes":23,evp_bytestokey:106,"safe-buffer":250}],230:[function(m,ie,a){var R=m("./asn1"),I=m("./aesid.json"),E=m("./fixProc"),_=m("browserify-aes"),d=m("pbkdf2"),u=m("safe-buffer").Buffer;function g(v){var c;"object"==typeof v&&!u.isBuffer(v)&&(c=v.passphrase,v=v.key),"string"==typeof v&&(v=u.from(v));var t,n,i=E(v,c),r=i.tag,s=i.data;switch(r){case"CERTIFICATE":n=R.certificate.decode(s,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(n||(n=R.PublicKey.decode(s,"der")),t=n.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return R.RSAPublicKey.decode(n.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return n.subjectPrivateKey=n.subjectPublicKey,{type:"ec",data:n};case"1.2.840.10040.4.1":return n.algorithm.params.pub_key=R.DSAparam.decode(n.subjectPublicKey.data,"der"),{type:"dsa",data:n.algorithm.params};default:throw new Error("unknown key id "+t)}case"ENCRYPTED PRIVATE KEY":s=function f(v,c){var i=v.algorithm.decrypt.kde.kdeparams.salt,r=parseInt(v.algorithm.decrypt.kde.kdeparams.iters.toString(),10),s=I[v.algorithm.decrypt.cipher.algo.join(".")],t=v.algorithm.decrypt.cipher.iv,n=v.subjectPrivateKey,o=parseInt(s.split("-")[1],10)/8,h=d.pbkdf2Sync(c,i,r,o,"sha1"),l=_.createDecipheriv(s,h,t),e=[];return e.push(l.update(n)),e.push(l.final()),u.concat(e)}(s=R.EncryptedPrivateKey.decode(s,"der"),c);case"PRIVATE KEY":switch(t=(n=R.PrivateKey.decode(s,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return R.RSAPrivateKey.decode(n.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:n.algorithm.curve,privateKey:R.ECPrivateKey.decode(n.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return n.algorithm.params.priv_key=R.DSAparam.decode(n.subjectPrivateKey,"der"),{type:"dsa",params:n.algorithm.params};default:throw new Error("unknown key id "+t)}case"RSA PUBLIC KEY":return R.RSAPublicKey.decode(s,"der");case"RSA PRIVATE KEY":return R.RSAPrivateKey.decode(s,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:R.DSAPrivateKey.decode(s,"der")};case"EC PRIVATE KEY":return{curve:(s=R.ECPrivateKey.decode(s,"der")).parameters.value,privateKey:s.privateKey};default:throw new Error("unknown key type "+r)}}ie.exports=g,g.signature=R.signature},{"./aesid.json":226,"./asn1":227,"./fixProc":229,"browserify-aes":23,pbkdf2:231,"safe-buffer":250}],231:[function(m,ie,a){a.pbkdf2=m("./lib/async"),a.pbkdf2Sync=m("./lib/sync")},{"./lib/async":232,"./lib/sync":235}],232:[function(m,ie,a){(function(R){(function(){var g,r,I=m("safe-buffer").Buffer,E=m("./precondition"),_=m("./default-encoding"),d=m("./sync"),u=m("./to-buffer"),f=R.crypto&&R.crypto.subtle,v={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},c=[];function s(){return r||(r=R.process&&R.process.nextTick?R.process.nextTick:R.queueMicrotask?R.queueMicrotask:R.setImmediate?R.setImmediate:R.setTimeout)}function t(o,h,l,e,p){return f.importKey("raw",o,{name:"PBKDF2"},!1,["deriveBits"]).then(function(b){return f.deriveBits({name:"PBKDF2",salt:h,iterations:l,hash:{name:p}},b,e<<3)}).then(function(b){return I.from(b)})}ie.exports=function(o,h,l,e,p,b){"function"==typeof p&&(b=p,p=void 0);var y=v[(p=p||"sha1").toLowerCase()];if(y&&"function"==typeof R.Promise){if(E(l,e),o=u(o,_,"Password"),h=u(h,_,"Salt"),"function"!=typeof b)throw new Error("No callback provided to pbkdf2");!function n(o,h){o.then(function(l){s()(function(){h(null,l)})},function(l){s()(function(){h(l)})})}(function i(o){if(R.process&&!R.process.browser||!f||!f.importKey||!f.deriveBits)return Promise.resolve(!1);if(void 0!==c[o])return c[o];var h=t(g=g||I.alloc(8),g,10,128,o).then(function(){return!0}).catch(function(){return!1});return c[o]=h,h}(y).then(function(w){return w?t(o,h,l,e,y):d(o,h,l,e,p)}),b)}else s()(function(){var w;try{w=d(o,h,l,e,p)}catch(x){return b(x)}b(null,w)})}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./default-encoding":233,"./precondition":234,"./sync":235,"./to-buffer":236,"safe-buffer":250}],233:[function(m,ie,a){(function(R,I){(function(){var E;E=I.process&&I.process.browser?"utf-8":I.process&&I.process.version?parseInt(R.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary":"utf-8",ie.exports=E}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{_process:237}],234:[function(m,ie,a){var R=Math.pow(2,30)-1;ie.exports=function(I,E){if("number"!=typeof I)throw new TypeError("Iterations not a number");if(I<0)throw new TypeError("Bad iterations");if("number"!=typeof E)throw new TypeError("Key length not a number");if(E<0||E>R||E!=E)throw new TypeError("Bad key length")}},{}],235:[function(m,ie,a){var R=m("create-hash/md5"),I=m("ripemd160"),E=m("sha.js"),_=m("safe-buffer").Buffer,d=m("./precondition"),u=m("./default-encoding"),g=m("./to-buffer"),f=_.alloc(128),v={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function c(s,t,n){var o=function i(s){return"rmd160"===s||"ripemd160"===s?function n(o){return(new I).update(o).digest()}:"md5"===s?R:function t(o){return E(s).update(o).digest()}}(s),h="sha512"===s||"sha384"===s?128:64;t.length>h?t=o(t):t.length<h&&(t=_.concat([t,f],h));for(var l=_.allocUnsafe(h+v[s]),e=_.allocUnsafe(h+v[s]),p=0;p<h;p++)l[p]=54^t[p],e[p]=92^t[p];var b=_.allocUnsafe(h+n+4);l.copy(b,0,0,h),this.ipad1=b,this.ipad2=l,this.opad=e,this.alg=s,this.blocksize=h,this.hash=o,this.size=v[s]}c.prototype.run=function(s,t){return s.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},ie.exports=function r(s,t,n,o,h){d(n,o);var l=new c(h=h||"sha1",s=g(s,u,"Password"),(t=g(t,u,"Salt")).length),e=_.allocUnsafe(o),p=_.allocUnsafe(t.length+4);t.copy(p,0,0,t.length);for(var b=0,y=v[h],w=Math.ceil(o/y),x=1;x<=w;x++){p.writeUInt32BE(x,t.length);for(var B=l.run(p,l.ipad1),J=B,z=1;z<n;z++){J=l.run(J,l.ipad2);for(var M=0;M<y;M++)B[M]^=J[M]}B.copy(e,b),b+=y}return e}},{"./default-encoding":233,"./precondition":234,"./to-buffer":236,"create-hash/md5":75,ripemd160:249,"safe-buffer":250,"sha.js":257}],236:[function(m,ie,a){var R=m("safe-buffer").Buffer;ie.exports=function(I,E,_){if(R.isBuffer(I))return I;if("string"==typeof I)return R.from(I,E);if(ArrayBuffer.isView(I))return R.from(I.buffer);throw new TypeError(_+" must be a string, a Buffer, a typed array or a DataView")}},{"safe-buffer":250}],237:[function(m,ie,a){var I,E,R=ie.exports={};function _(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function u(o){if(I===setTimeout)return setTimeout(o,0);if((I===_||!I)&&setTimeout)return I=setTimeout,setTimeout(o,0);try{return I(o,0)}catch{try{return I.call(null,o,0)}catch{return I.call(this,o,0)}}}!function(){try{I="function"==typeof setTimeout?setTimeout:_}catch{I=_}try{E="function"==typeof clearTimeout?clearTimeout:d}catch{E=d}}();var c,f=[],v=!1,i=-1;function r(){!v||!c||(v=!1,c.length?f=c.concat(f):i=-1,f.length&&s())}function s(){if(!v){var o=u(r);v=!0;for(var h=f.length;h;){for(c=f,f=[];++i<h;)c&&c[i].run();i=-1,h=f.length}c=null,v=!1,function g(o){if(E===clearTimeout)return clearTimeout(o);if((E===d||!E)&&clearTimeout)return E=clearTimeout,clearTimeout(o);try{E(o)}catch{try{return E.call(null,o)}catch{return E.call(this,o)}}}(o)}}function t(o,h){this.fun=o,this.array=h}function n(){}R.nextTick=function(o){var h=new Array(arguments.length-1);if(arguments.length>1)for(var l=1;l<arguments.length;l++)h[l-1]=arguments[l];f.push(new t(o,h)),1===f.length&&!v&&u(s)},t.prototype.run=function(){this.fun.apply(null,this.array)},R.title="browser",R.browser=!0,R.env={},R.argv=[],R.version="",R.versions={},R.on=n,R.addListener=n,R.once=n,R.off=n,R.removeListener=n,R.removeAllListeners=n,R.emit=n,R.prependListener=n,R.prependOnceListener=n,R.listeners=function(o){return[]},R.binding=function(o){throw new Error("process.binding is not supported")},R.cwd=function(){return"/"},R.chdir=function(o){throw new Error("process.chdir is not supported")},R.umask=function(){return 0}},{}],238:[function(m,ie,a){a.publicEncrypt=m("./publicEncrypt"),a.privateDecrypt=m("./privateDecrypt"),a.privateEncrypt=function(I,E){return a.publicEncrypt(I,E,!0)},a.publicDecrypt=function(I,E){return a.privateDecrypt(I,E,!0)}},{"./privateDecrypt":240,"./publicEncrypt":241}],239:[function(m,ie,a){var R=m("create-hash"),I=m("safe-buffer").Buffer;function E(_){var d=I.allocUnsafe(4);return d.writeUInt32BE(_,0),d}ie.exports=function(_,d){for(var f,u=I.alloc(0),g=0;u.length<d;)f=E(g++),u=I.concat([u,R("sha1").update(_).update(f).digest()]);return u.slice(0,d)}},{"create-hash":74,"safe-buffer":250}],240:[function(m,ie,a){var R=m("parse-asn1"),I=m("./mgf"),E=m("./xor"),_=m("bn.js"),d=m("browserify-rsa"),u=m("create-hash"),g=m("./withPublic"),f=m("safe-buffer").Buffer;ie.exports=function(s,t,n){var o;o=s.padding?s.padding:n?1:4;var e,h=R(s),l=h.modulus.byteLength();if(t.length>l||new _(t).cmp(h.modulus)>=0)throw new Error("decryption error");e=n?g(new _(t),h):d(t,h);var p=f.alloc(l-e.length);if(e=f.concat([p,e],l),4===o)return function v(r,s){var t=r.modulus.byteLength(),n=u("sha1").update(f.alloc(0)).digest(),o=n.length;if(0!==s[0])throw new Error("decryption error");var h=s.slice(1,o+1),l=s.slice(o+1),e=E(h,I(l,o)),p=E(l,I(e,t-o-1));if(function i(r,s){r=f.from(r),s=f.from(s);var t=0,n=r.length;r.length!==s.length&&(t++,n=Math.min(r.length,s.length));for(var o=-1;++o<n;)t+=r[o]^s[o];return t}(n,p.slice(0,o)))throw new Error("decryption error");for(var b=o;0===p[b];)b++;if(1!==p[b++])throw new Error("decryption error");return p.slice(b)}(h,e);if(1===o)return function c(r,s,t){for(var n=s.slice(0,2),o=2,h=0;0!==s[o++];)if(o>=s.length){h++;break}var l=s.slice(2,o-1);if(("0002"!==n.toString("hex")&&!t||"0001"!==n.toString("hex")&&t)&&h++,l.length<8&&h++,h)throw new Error("decryption error");return s.slice(o)}(0,e,n);if(3===o)return e;throw new Error("unknown padding")}},{"./mgf":239,"./withPublic":242,"./xor":243,"bn.js":18,"browserify-rsa":41,"create-hash":74,"parse-asn1":230,"safe-buffer":250}],241:[function(m,ie,a){var R=m("parse-asn1"),I=m("randombytes"),E=m("create-hash"),_=m("./mgf"),d=m("./xor"),u=m("bn.js"),g=m("./withPublic"),f=m("browserify-rsa"),v=m("safe-buffer").Buffer;ie.exports=function(t,n,o){var h;h=t.padding?t.padding:o?1:4;var e,l=R(t);if(4===h)e=function c(s,t){var n=s.modulus.byteLength(),o=t.length,h=E("sha1").update(v.alloc(0)).digest(),l=h.length,e=2*l;if(o>n-e-2)throw new Error("message too long");var p=v.alloc(n-o-e-2),b=n-l-1,y=I(l),w=d(v.concat([h,p,v.alloc(1,1),t],b),_(y,b)),x=d(y,_(w,l));return new u(v.concat([v.alloc(1),x,w],n))}(l,n);else if(1===h)e=function i(s,t,n){var l,o=t.length,h=s.modulus.byteLength();if(o>h-11)throw new Error("message too long");return l=n?v.alloc(h-o-3,255):function r(s){for(var l,t=v.allocUnsafe(s),n=0,o=I(2*s),h=0;n<s;)h===o.length&&(o=I(2*s),h=0),(l=o[h++])&&(t[n++]=l);return t}(h-o-3),new u(v.concat([v.from([0,n?1:2]),l,v.alloc(1),t],h))}(l,n,o);else{if(3!==h)throw new Error("unknown padding");if((e=new u(n)).cmp(l.modulus)>=0)throw new Error("data too long for modulus")}return o?f(e,l):g(e,l)}},{"./mgf":239,"./withPublic":242,"./xor":243,"bn.js":18,"browserify-rsa":41,"create-hash":74,"parse-asn1":230,randombytes:244,"safe-buffer":250}],242:[function(m,ie,a){var R=m("bn.js"),I=m("safe-buffer").Buffer;ie.exports=function E(_,d){return I.from(_.toRed(R.mont(d.modulus)).redPow(new R(d.publicExponent)).fromRed().toArray())}},{"bn.js":18,"safe-buffer":250}],243:[function(m,ie,a){ie.exports=function(I,E){for(var _=I.length,d=-1;++d<_;)I[d]^=E[d];return I}},{}],244:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=65536,u=m("safe-buffer").Buffer,g=I.crypto||I.msCrypto;ie.exports=g&&g.getRandomValues?function f(v,c){if(v>4294967295)throw new RangeError("requested too many random bytes");var i=u.allocUnsafe(v);if(v>0)if(v>E)for(var r=0;r<v;r+=E)g.getRandomValues(i.slice(r,r+E));else g.getRandomValues(i);return"function"==typeof c?R.nextTick(function(){c(null,i)}):i}:function d(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{_process:237,"safe-buffer":250}],245:[function(m,ie,a){(function(R,I){(function(){"use strict";function E(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var _=m("safe-buffer"),d=m("randombytes"),u=_.Buffer,g=_.kMaxLength,f=I.crypto||I.msCrypto,v=Math.pow(2,32)-1;function c(n,o){if("number"!=typeof n||n!=n)throw new TypeError("offset must be a number");if(n>v||n<0)throw new TypeError("offset must be a uint32");if(n>g||n>o)throw new RangeError("offset out of range")}function i(n,o,h){if("number"!=typeof n||n!=n)throw new TypeError("size must be a number");if(n>v||n<0)throw new TypeError("size must be a uint32");if(n+o>h||n>g)throw new RangeError("buffer too small")}function s(n,o,h,l){if(R.browser){var p=new Uint8Array(n.buffer,o,h);return f.getRandomValues(p),l?void R.nextTick(function(){l(null,n)}):n}if(!l)return d(h).copy(n,o),n;d(h,function(y,w){if(y)return l(y);w.copy(n,o),l(null,n)})}f&&f.getRandomValues||!R.browser?(a.randomFill=function r(n,o,h,l){if(!(u.isBuffer(n)||n instanceof I.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof o)l=o,o=0,h=n.length;else if("function"==typeof h)l=h,h=n.length-o;else if("function"!=typeof l)throw new TypeError('"cb" argument must be a function');return c(o,n.length),i(h,o,n.length),s(n,o,h,l)},a.randomFillSync=function t(n,o,h){if(typeof o>"u"&&(o=0),!(u.isBuffer(n)||n instanceof I.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return c(o,n.length),void 0===h&&(h=n.length-o),i(h,o,n.length),s(n,o,h)}):(a.randomFill=E,a.randomFillSync=E)}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{_process:237,randombytes:244,"safe-buffer":250}],246:[function(m,ie,a){ie.exports=m("./lib/retry")},{"./lib/retry":247}],247:[function(m,ie,a){var R=m("./retry_operation");a.operation=function(I){var E=a.timeouts(I);return new R(E,{forever:I&&(I.forever||I.retries===1/0),unref:I&&I.unref,maxRetryTime:I&&I.maxRetryTime})},a.timeouts=function(I){if(I instanceof Array)return[].concat(I);var E={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var _ in I)E[_]=I[_];if(E.minTimeout>E.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var d=[],u=0;u<E.retries;u++)d.push(this.createTimeout(u,E));return I&&I.forever&&!d.length&&d.push(this.createTimeout(u,E)),d.sort(function(g,f){return g-f}),d},a.createTimeout=function(I,E){var _=E.randomize?Math.random()+1:1,d=Math.round(_*Math.max(E.minTimeout,1)*Math.pow(E.factor,I));return Math.min(d,E.maxTimeout)},a.wrap=function(I,E,_){if(E instanceof Array&&(_=E,E=null),!_)for(var d in _=[],I)"function"==typeof I[d]&&_.push(d);for(var u=0;u<_.length;u++){var g=_[u];I[g]=function(c){var i=a.operation(E),r=Array.prototype.slice.call(arguments,1),s=r.pop();r.push(function(t){i.retry(t)||(t&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){c.apply(I,r)})}.bind(I,I[g]),I[g].options=E}}},{"./retry_operation":248}],248:[function(m,ie,a){function R(I,E){"boolean"==typeof E&&(E={forever:E}),this._originalTimeouts=JSON.parse(JSON.stringify(I)),this._timeouts=I,this._options=E||{},this._maxRetryTime=E&&E.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}ie.exports=R,R.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},R.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},R.prototype.retry=function(I){if(this._timeout&&clearTimeout(this._timeout),!I)return!1;var E=(new Date).getTime();if(I&&E-this._operationStart>=this._maxRetryTime)return this._errors.push(I),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(I);var _=this._timeouts.shift();if(void 0===_){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),_=this._cachedTimeouts.slice(-1)}var d=this;return this._timer=setTimeout(function(){d._attempts++,d._operationTimeoutCb&&(d._timeout=setTimeout(function(){d._operationTimeoutCb(d._attempts)},d._operationTimeout),d._options.unref&&d._timeout.unref()),d._fn(d._attempts)},_),this._options.unref&&this._timer.unref(),!0},R.prototype.attempt=function(I,E){this._fn=I,E&&(E.timeout&&(this._operationTimeout=E.timeout),E.cb&&(this._operationTimeoutCb=E.cb));var _=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){_._operationTimeoutCb()},_._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},R.prototype.try=function(I){console.log("Using RetryOperation.try() is deprecated"),this.attempt(I)},R.prototype.start=function(I){console.log("Using RetryOperation.start() is deprecated"),this.attempt(I)},R.prototype.start=R.prototype.try,R.prototype.errors=function(){return this._errors},R.prototype.attempts=function(){return this._attempts},R.prototype.mainError=function(){if(0===this._errors.length)return null;for(var I={},E=null,_=0,d=0;d<this._errors.length;d++){var u=this._errors[d],g=u.message,f=(I[g]||0)+1;I[g]=f,f>=_&&(E=u,_=f)}return E}},{}],249:[function(m,ie,a){"use strict";var R=m("buffer").Buffer,I=m("inherits"),E=m("hash-base"),_=new Array(16),d=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],u=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],g=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],f=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],v=[0,1518500249,1859775393,2400959708,2840853838],c=[1352829926,1548603684,1836072691,2053994217,0];function i(){E.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function r(l,e){return l<<e|l>>>32-e}function s(l,e,p,b,y,w,x,B){return r(l+(e^p^b)+w+x|0,B)+y|0}function t(l,e,p,b,y,w,x,B){return r(l+(e&p|~e&b)+w+x|0,B)+y|0}function n(l,e,p,b,y,w,x,B){return r(l+((e|~p)^b)+w+x|0,B)+y|0}function o(l,e,p,b,y,w,x,B){return r(l+(e&b|p&~b)+w+x|0,B)+y|0}function h(l,e,p,b,y,w,x,B){return r(l+(e^(p|~b))+w+x|0,B)+y|0}I(i,E),i.prototype._update=function(){for(var l=_,e=0;e<16;++e)l[e]=this._block.readInt32LE(4*e);for(var p=0|this._a,b=0|this._b,y=0|this._c,w=0|this._d,x=0|this._e,B=0|this._a,J=0|this._b,z=0|this._c,M=0|this._d,L=0|this._e,j=0;j<80;j+=1){var C,F;j<16?(C=s(p,b,y,w,x,l[d[j]],v[0],g[j]),F=h(B,J,z,M,L,l[u[j]],c[0],f[j])):j<32?(C=t(p,b,y,w,x,l[d[j]],v[1],g[j]),F=o(B,J,z,M,L,l[u[j]],c[1],f[j])):j<48?(C=n(p,b,y,w,x,l[d[j]],v[2],g[j]),F=n(B,J,z,M,L,l[u[j]],c[2],f[j])):j<64?(C=o(p,b,y,w,x,l[d[j]],v[3],g[j]),F=t(B,J,z,M,L,l[u[j]],c[3],f[j])):(C=h(p,b,y,w,x,l[d[j]],v[4],g[j]),F=s(B,J,z,M,L,l[u[j]],c[4],f[j])),p=x,x=w,w=r(y,10),y=b,b=C,B=L,L=M,M=r(z,10),z=J,J=F}var V=this._b+y+M|0;this._b=this._c+w+L|0,this._c=this._d+x+B|0,this._d=this._e+p+J|0,this._e=this._a+b+z|0,this._a=V},i.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var l=R.alloc?R.alloc(20):new R(20);return l.writeInt32LE(this._a,0),l.writeInt32LE(this._b,4),l.writeInt32LE(this._c,8),l.writeInt32LE(this._d,12),l.writeInt32LE(this._e,16),l},ie.exports=i},{buffer:68,"hash-base":116,inherits:146}],250:[function(m,ie,a){var R=m("buffer"),I=R.Buffer;function E(d,u){for(var g in d)u[g]=d[g]}function _(d,u,g){return I(d,u,g)}I.from&&I.alloc&&I.allocUnsafe&&I.allocUnsafeSlow?ie.exports=R:(E(R,a),a.Buffer=_),_.prototype=Object.create(I.prototype),E(I,_),_.from=function(d,u,g){if("number"==typeof d)throw new TypeError("Argument must not be a number");return I(d,u,g)},_.alloc=function(d,u,g){if("number"!=typeof d)throw new TypeError("Argument must be a number");var f=I(d);return void 0!==u?"string"==typeof g?f.fill(u,g):f.fill(u):f.fill(0),f},_.allocUnsafe=function(d){if("number"!=typeof d)throw new TypeError("Argument must be a number");return I(d)},_.allocUnsafeSlow=function(d){if("number"!=typeof d)throw new TypeError("Argument must be a number");return R.SlowBuffer(d)}},{buffer:68}],251:[function(m,ie,a){(function(R){(function(){"use strict";var d,I=m("buffer"),E=I.Buffer,_={};for(d in I)I.hasOwnProperty(d)&&("SlowBuffer"===d||"Buffer"===d||(_[d]=I[d]));var u=_.Buffer={};for(d in E)E.hasOwnProperty(d)&&("allocUnsafe"===d||"allocUnsafeSlow"===d||(u[d]=E[d]));if(_.Buffer.prototype=E.prototype,(!u.from||u.from===Uint8Array.from)&&(u.from=function(g,f,v){if("number"==typeof g)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof g);if(g&&typeof g.length>"u")throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof g);return E(g,f,v)}),u.alloc||(u.alloc=function(g,f,v){if("number"!=typeof g)throw new TypeError('The "size" argument must be of type number. Received type '+typeof g);if(g<0||g>=2*(1<<30))throw new RangeError('The value "'+g+'" is invalid for option "size"');var c=E(g);return f&&0!==f.length?"string"==typeof v?c.fill(f,v):c.fill(f):c.fill(0),c}),!_.kStringMaxLength)try{_.kStringMaxLength=R.binding("buffer").kStringMaxLength}catch{}_.constants||(_.constants={MAX_LENGTH:_.kMaxLength},_.kStringMaxLength&&(_.constants.MAX_STRING_LENGTH=_.kStringMaxLength)),ie.exports=_}).call(this)}).call(this,m("_process"))},{_process:237,buffer:68}],252:[function(m,ie,a){var R=ie.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(I){return I.encoding?"rtpmap:%d %s/%s/%s":I.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(I){return null!=I.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(I){return null!=I.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(I){return"extmap:%d"+(I.direction?"/%s":"%v")+(I["encrypt-uri"]?" %s":"%v")+" %s"+(I.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(I){return null!=I.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(I){var E="candidate:%s %d %s %d %s %d typ %s";return E+=null!=I.raddr?" raddr %s rport %d":"%v%v",E+=null!=I.tcptype?" tcptype %s":"%v",null!=I.generation&&(E+=" generation %d"),(E+=null!=I["network-id"]?" network-id %d":"%v")+(null!=I["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(I){var E="ssrc:%d";return null!=I.attribute&&(E+=" %s",null!=I.value&&(E+=":%s")),E}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(I){return null!=I.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(I){return I.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(I){return"imageattr:%s %s %s"+(I.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(I){return"simulcast:%s %s"+(I.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(I){return"ts-refclk:%s"+(null!=I.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(I){var E="mediaclk:";return E+=null!=I.id?"id=%s %s":"%v%s",E+=null!=I.mediaClockValue?"=%s":"",(E+=null!=I.rateNumerator?" rate=%s":"")+(null!=I.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(R).forEach(function(I){R[I].forEach(function(_){_.reg||(_.reg=/(.*)/),_.format||(_.format="%s")})})},{}],253:[function(m,ie,a){var R=m("./parser"),I=m("./writer");a.write=I,a.parse=R.parse,a.parseParams=R.parseParams,a.parseFmtpConfig=R.parseFmtpConfig,a.parsePayloads=R.parsePayloads,a.parseRemoteCandidates=R.parseRemoteCandidates,a.parseImageAttributes=R.parseImageAttributes,a.parseSimulcastStreamList=R.parseSimulcastStreamList},{"./parser":254,"./writer":255}],254:[function(m,ie,a){var R=function(g){return String(Number(g))===g?Number(g):g},E=function(g,f,v){var c=g.name&&g.names;g.push&&!f[g.push]?f[g.push]=[]:c&&!f[g.name]&&(f[g.name]={});var i=g.push?{}:c?f[g.name]:f;(function(g,f,v,c){if(c&&!v)f[c]=R(g[1]);else for(var i=0;i<v.length;i+=1)null!=g[i+1]&&(f[v[i]]=R(g[i+1]))})(v.match(g.reg),i,g.names,g.name),g.push&&f[g.push].push(i)},_=m("./grammar"),d=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(g){var f={},v=[],c=f;return g.split(/(\r\n|\r|\n)/).filter(d).forEach(function(i){var r=i[0],s=i.slice(2);"m"===r&&(v.push({rtp:[],fmtp:[]}),c=v[v.length-1]);for(var t=0;t<(_[r]||[]).length;t+=1){var n=_[r][t];if(n.reg.test(s))return E(n,c,s)}}),f.media=v,f};var u=function(g,f){var v=f.split(/=(.+)/,2);return 2===v.length?g[v[0]]=R(v[1]):1===v.length&&f.length>1&&(g[v[0]]=void 0),g};a.parseParams=function(g){return g.split(/;\s?/).reduce(u,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(g){return g.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(g){for(var f=[],v=g.split(" ").map(R),c=0;c<v.length;c+=3)f.push({component:v[c],ip:v[c+1],port:v[c+2]});return f},a.parseImageAttributes=function(g){return g.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(u,{})})},a.parseSimulcastStreamList=function(g){return g.split(";").map(function(f){return f.split(",").map(function(v){var c,i=!1;return"~"!==v[0]?c=R(v):(c=R(v.substring(1,v.length)),i=!0),{scid:c,paused:i}})})}},{"./grammar":252}],255:[function(m,ie,a){var R=m("./grammar"),I=/%[sdv%]/g,E=function(g){var f=1,v=arguments,c=v.length;return g.replace(I,function(i){if(f>=c)return i;var r=v[f];switch(f+=1,i){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},_=function(g,f,v){var i=[g+"="+(f.format instanceof Function?f.format(f.push?v:v[f.name]):f.format)];if(f.names)for(var r=0;r<f.names.length;r+=1)i.push(f.name?v[f.name][f.names[r]]:v[f.names[r]]);else i.push(v[f.name]);return E.apply(null,i)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];ie.exports=function(g,f){f=f||{},null==g.version&&(g.version=0),null==g.name&&(g.name=" "),g.media.forEach(function(r){null==r.payloads&&(r.payloads="")});var c=f.innerOrder||u,i=[];return(f.outerOrder||d).forEach(function(r){R[r].forEach(function(s){s.name in g&&null!=g[s.name]?i.push(_(r,s,g)):s.push in g&&null!=g[s.push]&&g[s.push].forEach(function(t){i.push(_(r,s,t))})})}),g.media.forEach(function(r){i.push(_("m",R.m[0],r)),c.forEach(function(s){R[s].forEach(function(t){t.name in r&&null!=r[t.name]?i.push(_(s,t,r)):t.push in r&&null!=r[t.push]&&r[t.push].forEach(function(n){i.push(_(s,t,n))})})})}),i.join("\r\n")+"\r\n"}},{"./grammar":252}],256:[function(m,ie,a){var R=m("safe-buffer").Buffer;function I(E,_){this._block=R.alloc(E),this._finalSize=_,this._blockSize=E,this._len=0}I.prototype.update=function(E,_){"string"==typeof E&&(E=R.from(E,_=_||"utf8"));for(var d=this._block,u=this._blockSize,g=E.length,f=this._len,v=0;v<g;){for(var c=f%u,i=Math.min(g-v,u-c),r=0;r<i;r++)d[c+r]=E[v+r];v+=i,(f+=i)%u==0&&this._update(d)}return this._len+=g,this},I.prototype.digest=function(E){var _=this._len%this._blockSize;this._block[_]=128,this._block.fill(0,_+1),_>=this._finalSize&&(this._update(this._block),this._block.fill(0));var d=8*this._len;if(d<=4294967295)this._block.writeUInt32BE(d,this._blockSize-4);else{var u=(4294967295&d)>>>0;this._block.writeUInt32BE((d-u)/4294967296,this._blockSize-8),this._block.writeUInt32BE(u,this._blockSize-4)}this._update(this._block);var f=this._hash();return E?f.toString(E):f},I.prototype._update=function(){throw new Error("_update must be implemented by subclass")},ie.exports=I},{"safe-buffer":250}],257:[function(m,ie,R){(R=ie.exports=function(E){E=E.toLowerCase();var _=R[E];if(!_)throw new Error(E+" is not supported (we accept pull requests)");return new _}).sha=m("./sha"),R.sha1=m("./sha1"),R.sha224=m("./sha224"),R.sha256=m("./sha256"),R.sha384=m("./sha384"),R.sha512=m("./sha512")},{"./sha":258,"./sha1":259,"./sha224":260,"./sha256":261,"./sha384":262,"./sha512":263}],258:[function(m,ie,a){var R=m("inherits"),I=m("./hash"),E=m("safe-buffer").Buffer,_=[1518500249,1859775393,-1894007588,-899497514],d=new Array(80);function u(){this.init(),this._w=d,I.call(this,64,56)}function g(c){return c<<5|c>>>27}function f(c){return c<<30|c>>>2}function v(c,i,r,s){return 0===c?i&r|~i&s:2===c?i&r|i&s|r&s:i^r^s}R(u,I),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(c){for(var i=this._w,r=0|this._a,s=0|this._b,t=0|this._c,n=0|this._d,o=0|this._e,h=0;h<16;++h)i[h]=c.readInt32BE(4*h);for(;h<80;++h)i[h]=i[h-3]^i[h-8]^i[h-14]^i[h-16];for(var l=0;l<80;++l){var e=~~(l/20),p=g(r)+v(e,s,t,n)+o+i[l]+_[e]|0;o=n,n=t,t=f(s),s=r,r=p}this._a=r+this._a|0,this._b=s+this._b|0,this._c=t+this._c|0,this._d=n+this._d|0,this._e=o+this._e|0},u.prototype._hash=function(){var c=E.allocUnsafe(20);return c.writeInt32BE(0|this._a,0),c.writeInt32BE(0|this._b,4),c.writeInt32BE(0|this._c,8),c.writeInt32BE(0|this._d,12),c.writeInt32BE(0|this._e,16),c},ie.exports=u},{"./hash":256,inherits:146,"safe-buffer":250}],259:[function(m,ie,a){var R=m("inherits"),I=m("./hash"),E=m("safe-buffer").Buffer,_=[1518500249,1859775393,-1894007588,-899497514],d=new Array(80);function u(){this.init(),this._w=d,I.call(this,64,56)}function g(i){return i<<1|i>>>31}function f(i){return i<<5|i>>>27}function v(i){return i<<30|i>>>2}function c(i,r,s,t){return 0===i?r&s|~r&t:2===i?r&s|r&t|s&t:r^s^t}R(u,I),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(i){for(var r=this._w,s=0|this._a,t=0|this._b,n=0|this._c,o=0|this._d,h=0|this._e,l=0;l<16;++l)r[l]=i.readInt32BE(4*l);for(;l<80;++l)r[l]=g(r[l-3]^r[l-8]^r[l-14]^r[l-16]);for(var e=0;e<80;++e){var p=~~(e/20),b=f(s)+c(p,t,n,o)+h+r[e]+_[p]|0;h=o,o=n,n=v(t),t=s,s=b}this._a=s+this._a|0,this._b=t+this._b|0,this._c=n+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0},u.prototype._hash=function(){var i=E.allocUnsafe(20);return i.writeInt32BE(0|this._a,0),i.writeInt32BE(0|this._b,4),i.writeInt32BE(0|this._c,8),i.writeInt32BE(0|this._d,12),i.writeInt32BE(0|this._e,16),i},ie.exports=u},{"./hash":256,inherits:146,"safe-buffer":250}],260:[function(m,ie,a){var R=m("inherits"),I=m("./sha256"),E=m("./hash"),_=m("safe-buffer").Buffer,d=new Array(64);function u(){this.init(),this._w=d,E.call(this,64,56)}R(u,I),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var g=_.allocUnsafe(28);return g.writeInt32BE(this._a,0),g.writeInt32BE(this._b,4),g.writeInt32BE(this._c,8),g.writeInt32BE(this._d,12),g.writeInt32BE(this._e,16),g.writeInt32BE(this._f,20),g.writeInt32BE(this._g,24),g},ie.exports=u},{"./hash":256,"./sha256":261,inherits:146,"safe-buffer":250}],261:[function(m,ie,a){var R=m("inherits"),I=m("./hash"),E=m("safe-buffer").Buffer,_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],d=new Array(64);function u(){this.init(),this._w=d,I.call(this,64,56)}function g(s,t,n){return n^s&(t^n)}function f(s,t,n){return s&t|n&(s|t)}function v(s){return(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10)}function c(s){return(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7)}function i(s){return(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3}function r(s){return(s>>>17|s<<15)^(s>>>19|s<<13)^s>>>10}R(u,I),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(s){for(var t=this._w,n=0|this._a,o=0|this._b,h=0|this._c,l=0|this._d,e=0|this._e,p=0|this._f,b=0|this._g,y=0|this._h,w=0;w<16;++w)t[w]=s.readInt32BE(4*w);for(;w<64;++w)t[w]=r(t[w-2])+t[w-7]+i(t[w-15])+t[w-16]|0;for(var x=0;x<64;++x){var B=y+c(e)+g(e,p,b)+_[x]+t[x]|0,J=v(n)+f(n,o,h)|0;y=b,b=p,p=e,e=l+B|0,l=h,h=o,o=n,n=B+J|0}this._a=n+this._a|0,this._b=o+this._b|0,this._c=h+this._c|0,this._d=l+this._d|0,this._e=e+this._e|0,this._f=p+this._f|0,this._g=b+this._g|0,this._h=y+this._h|0},u.prototype._hash=function(){var s=E.allocUnsafe(32);return s.writeInt32BE(this._a,0),s.writeInt32BE(this._b,4),s.writeInt32BE(this._c,8),s.writeInt32BE(this._d,12),s.writeInt32BE(this._e,16),s.writeInt32BE(this._f,20),s.writeInt32BE(this._g,24),s.writeInt32BE(this._h,28),s},ie.exports=u},{"./hash":256,inherits:146,"safe-buffer":250}],262:[function(m,ie,a){var R=m("inherits"),I=m("./sha512"),E=m("./hash"),_=m("safe-buffer").Buffer,d=new Array(160);function u(){this.init(),this._w=d,E.call(this,128,112)}R(u,I),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var g=_.allocUnsafe(48);function f(v,c,i){g.writeInt32BE(v,i),g.writeInt32BE(c,i+4)}return f(this._ah,this._al,0),f(this._bh,this._bl,8),f(this._ch,this._cl,16),f(this._dh,this._dl,24),f(this._eh,this._el,32),f(this._fh,this._fl,40),g},ie.exports=u},{"./hash":256,"./sha512":263,inherits:146,"safe-buffer":250}],263:[function(m,ie,a){var R=m("inherits"),I=m("./hash"),E=m("safe-buffer").Buffer,_=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],d=new Array(160);function u(){this.init(),this._w=d,I.call(this,128,112)}function g(o,h,l){return l^o&(h^l)}function f(o,h,l){return o&h|l&(o|h)}function v(o,h){return(o>>>28|h<<4)^(h>>>2|o<<30)^(h>>>7|o<<25)}function c(o,h){return(o>>>14|h<<18)^(o>>>18|h<<14)^(h>>>9|o<<23)}function i(o,h){return(o>>>1|h<<31)^(o>>>8|h<<24)^o>>>7}function r(o,h){return(o>>>1|h<<31)^(o>>>8|h<<24)^(o>>>7|h<<25)}function s(o,h){return(o>>>19|h<<13)^(h>>>29|o<<3)^o>>>6}function t(o,h){return(o>>>19|h<<13)^(h>>>29|o<<3)^(o>>>6|h<<26)}function n(o,h){return o>>>0<h>>>0?1:0}R(u,I),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(o){for(var h=this._w,l=0|this._ah,e=0|this._bh,p=0|this._ch,b=0|this._dh,y=0|this._eh,w=0|this._fh,x=0|this._gh,B=0|this._hh,J=0|this._al,z=0|this._bl,M=0|this._cl,L=0|this._dl,j=0|this._el,C=0|this._fl,F=0|this._gl,V=0|this._hl,N=0;N<32;N+=2)h[N]=o.readInt32BE(4*N),h[N+1]=o.readInt32BE(4*N+4);for(;N<160;N+=2){var T=h[N-30],S=h[N-30+1],U=i(T,S),W=r(S,T),k=s(T=h[N-4],S=h[N-4+1]),D=t(S,T),ae=h[N-32],ue=h[N-32+1],be=W+h[N-14+1]|0,X=U+h[N-14]+n(be,W)|0;X=(X=X+k+n(be=be+D|0,D)|0)+ae+n(be=be+ue|0,ue)|0,h[N]=X,h[N+1]=be}for(var H=0;H<160;H+=2){X=h[H],be=h[H+1];var ne=f(l,e,p),ce=f(J,z,M),te=v(l,J),P=v(J,l),A=c(y,j),$=c(j,y),G=_[H],se=_[H+1],he=g(y,w,x),pe=g(j,C,F),me=V+$|0,Ee=B+A+n(me,V)|0;Ee=(Ee=(Ee=Ee+he+n(me=me+pe|0,pe)|0)+G+n(me=me+se|0,se)|0)+X+n(me=me+be|0,be)|0;var _e=P+ce|0,Se=te+ne+n(_e,P)|0;B=x,V=F,x=w,F=C,w=y,C=j,y=b+Ee+n(j=L+me|0,L)|0,b=p,L=M,p=e,M=z,e=l,z=J,l=Ee+Se+n(J=me+_e|0,me)|0}this._al=this._al+J|0,this._bl=this._bl+z|0,this._cl=this._cl+M|0,this._dl=this._dl+L|0,this._el=this._el+j|0,this._fl=this._fl+C|0,this._gl=this._gl+F|0,this._hl=this._hl+V|0,this._ah=this._ah+l+n(this._al,J)|0,this._bh=this._bh+e+n(this._bl,z)|0,this._ch=this._ch+p+n(this._cl,M)|0,this._dh=this._dh+b+n(this._dl,L)|0,this._eh=this._eh+y+n(this._el,j)|0,this._fh=this._fh+w+n(this._fl,C)|0,this._gh=this._gh+x+n(this._gl,F)|0,this._hh=this._hh+B+n(this._hl,V)|0},u.prototype._hash=function(){var o=E.allocUnsafe(64);function h(l,e,p){o.writeInt32BE(l,p),o.writeInt32BE(e,p+4)}return h(this._ah,this._al,0),h(this._bh,this._bl,8),h(this._ch,this._cl,16),h(this._dh,this._dl,24),h(this._eh,this._el,32),h(this._fh,this._fl,40),h(this._gh,this._gl,48),h(this._hh,this._hl,56),o},ie.exports=u},{"./hash":256,inherits:146,"safe-buffer":250}],264:[function(m,ie,a){ie.exports=E;var R=m("events").EventEmitter;function E(){R.call(this)}m("inherits")(E,R),E.Readable=m("readable-stream/lib/_stream_readable.js"),E.Writable=m("readable-stream/lib/_stream_writable.js"),E.Duplex=m("readable-stream/lib/_stream_duplex.js"),E.Transform=m("readable-stream/lib/_stream_transform.js"),E.PassThrough=m("readable-stream/lib/_stream_passthrough.js"),E.finished=m("readable-stream/lib/internal/streams/end-of-stream.js"),E.pipeline=m("readable-stream/lib/internal/streams/pipeline.js"),E.Stream=E,E.prototype.pipe=function(_,d){var u=this;function g(t){_.writable&&!1===_.write(t)&&u.pause&&u.pause()}function f(){u.readable&&u.resume&&u.resume()}u.on("data",g),_.on("drain",f),!_._isStdio&&(!d||!1!==d.end)&&(u.on("end",c),u.on("close",i));var v=!1;function c(){v||(v=!0,_.end())}function i(){v||(v=!0,"function"==typeof _.destroy&&_.destroy())}function r(t){if(s(),0===R.listenerCount(this,"error"))throw t}function s(){u.removeListener("data",g),_.removeListener("drain",f),u.removeListener("end",c),u.removeListener("close",i),u.removeListener("error",r),_.removeListener("error",r),u.removeListener("end",s),u.removeListener("close",s),_.removeListener("close",s)}return u.on("error",r),_.on("error",r),u.on("end",s),u.on("close",s),_.on("close",s),_.emit("pipe",u),_}},{events:105,inherits:146,"readable-stream/lib/_stream_duplex.js":266,"readable-stream/lib/_stream_passthrough.js":267,"readable-stream/lib/_stream_readable.js":268,"readable-stream/lib/_stream_transform.js":269,"readable-stream/lib/_stream_writable.js":270,"readable-stream/lib/internal/streams/end-of-stream.js":274,"readable-stream/lib/internal/streams/pipeline.js":276}],265:[function(m,ie,a){arguments[4][50][0].apply(a,arguments)},{dup:50}],266:[function(m,ie,a){(function(R){(function(){"use strict";var I=Object.keys||function(i){var r=[];for(var s in i)r.push(s);return r};ie.exports=f;var E=m("./_stream_readable"),_=m("./_stream_writable");m("inherits")(f,E);for(var d=I(_.prototype),u=0;u<d.length;u++){var g=d[u];f.prototype[g]||(f.prototype[g]=_.prototype[g])}function f(i){if(!(this instanceof f))return new f(i);E.call(this,i),_.call(this,i),this.allowHalfOpen=!0,i&&(!1===i.readable&&(this.readable=!1),!1===i.writable&&(this.writable=!1),!1===i.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",v)))}function v(){this._writableState.ended||R.nextTick(c,this)}function c(i){i.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(r){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=r,this._writableState.destroyed=r)}})}).call(this)}).call(this,m("_process"))},{"./_stream_readable":268,"./_stream_writable":270,_process:237,inherits:146}],267:[function(m,ie,a){arguments[4][52][0].apply(a,arguments)},{"./_stream_transform":269,dup:52,inherits:146}],268:[function(m,ie,a){(function(R,I){(function(){"use strict";var E;ie.exports=L,L.ReadableState=M,m("events");var r,d=function(A,$){return A.listeners($).length},u=m("./internal/streams/stream"),g=m("buffer").Buffer,f=I.Uint8Array||function(){},i=m("util");r=i&&i.debuglog?i.debuglog("stream"):function(){};var y,w,x,s=m("./internal/streams/buffer_list"),t=m("./internal/streams/destroy"),o=m("./internal/streams/state").getHighWaterMark,h=m("../errors").codes,l=h.ERR_INVALID_ARG_TYPE,e=h.ERR_STREAM_PUSH_AFTER_EOF,p=h.ERR_METHOD_NOT_IMPLEMENTED,b=h.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;m("inherits")(L,u);var B=t.errorOrDestroy,J=["error","close","destroy","pause","resume"];function M(P,A,$){E=E||m("./_stream_duplex"),"boolean"!=typeof $&&($=A instanceof E),this.objectMode=!!(P=P||{}).objectMode,$&&(this.objectMode=this.objectMode||!!P.readableObjectMode),this.highWaterMark=o(this,P,"readableHighWaterMark",$),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==P.emitClose,this.autoDestroy=!!P.autoDestroy,this.destroyed=!1,this.defaultEncoding=P.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,P.encoding&&(y||(y=m("string_decoder/").StringDecoder),this.decoder=new y(P.encoding),this.encoding=P.encoding)}function L(P){if(E=E||m("./_stream_duplex"),!(this instanceof L))return new L(P);this._readableState=new M(P,this,this instanceof E),this.readable=!0,P&&("function"==typeof P.read&&(this._read=P.read),"function"==typeof P.destroy&&(this._destroy=P.destroy)),u.call(this)}function j(P,A,$,G,se){r("readableAddChunk",A);var pe,he=P._readableState;if(null===A)he.reading=!1,function S(P,A){if(r("onEofChunk"),!A.ended){if(A.decoder){var $=A.decoder.end();$&&$.length&&(A.buffer.push($),A.length+=A.objectMode?1:$.length)}A.ended=!0,A.sync?U(P):(A.needReadable=!1,A.emittedReadable||(A.emittedReadable=!0,W(P)))}}(P,he);else if(se||(pe=function F(P,A){var $;return!function c(P){return g.isBuffer(P)||P instanceof f}(A)&&"string"!=typeof A&&void 0!==A&&!P.objectMode&&($=new l("chunk",["string","Buffer","Uint8Array"],A)),$}(he,A)),pe)B(P,pe);else if(he.objectMode||A&&A.length>0)if("string"!=typeof A&&!he.objectMode&&Object.getPrototypeOf(A)!==g.prototype&&(A=function v(P){return g.from(P)}(A)),G)he.endEmitted?B(P,new b):C(P,he,A,!0);else if(he.ended)B(P,new e);else{if(he.destroyed)return!1;he.reading=!1,he.decoder&&!$?(A=he.decoder.write(A),he.objectMode||0!==A.length?C(P,he,A,!1):k(P,he)):C(P,he,A,!1)}else G||(he.reading=!1,k(P,he));return!he.ended&&(he.length<he.highWaterMark||0===he.length)}function C(P,A,$,G){A.flowing&&0===A.length&&!A.sync?(A.awaitDrain=0,P.emit("data",$)):(A.length+=A.objectMode?1:$.length,G?A.buffer.unshift($):A.buffer.push($),A.needReadable&&U(P)),k(P,A)}Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(A){this._readableState&&(this._readableState.destroyed=A)}}),L.prototype.destroy=t.destroy,L.prototype._undestroy=t.undestroy,L.prototype._destroy=function(P,A){A(P)},L.prototype.push=function(P,A){var G,$=this._readableState;return $.objectMode?G=!0:"string"==typeof P&&((A=A||$.defaultEncoding)!==$.encoding&&(P=g.from(P,A),A=""),G=!0),j(this,P,A,!1,G)},L.prototype.unshift=function(P){return j(this,P,null,!0,!1)},L.prototype.isPaused=function(){return!1===this._readableState.flowing},L.prototype.setEncoding=function(P){y||(y=m("string_decoder/").StringDecoder);var A=new y(P);this._readableState.decoder=A,this._readableState.encoding=this._readableState.decoder.encoding;for(var $=this._readableState.buffer.head,G="";null!==$;)G+=A.write($.data),$=$.next;return this._readableState.buffer.clear(),""!==G&&this._readableState.buffer.push(G),this._readableState.length=G.length,this};var V=1073741824;function T(P,A){return P<=0||0===A.length&&A.ended?0:A.objectMode?1:P!=P?A.flowing&&A.length?A.buffer.head.data.length:A.length:(P>A.highWaterMark&&(A.highWaterMark=function N(P){return P>=V?P=V:(P--,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,P|=P>>>16,P++),P}(P)),P<=A.length?P:A.ended?A.length:(A.needReadable=!0,0))}function U(P){var A=P._readableState;r("emitReadable",A.needReadable,A.emittedReadable),A.needReadable=!1,A.emittedReadable||(r("emitReadable",A.flowing),A.emittedReadable=!0,R.nextTick(W,P))}function W(P){var A=P._readableState;r("emitReadable_",A.destroyed,A.length,A.ended),!A.destroyed&&(A.length||A.ended)&&(P.emit("readable"),A.emittedReadable=!1),A.needReadable=!A.flowing&&!A.ended&&A.length<=A.highWaterMark,X(P)}function k(P,A){A.readingMore||(A.readingMore=!0,R.nextTick(D,P,A))}function D(P,A){for(;!A.reading&&!A.ended&&(A.length<A.highWaterMark||A.flowing&&0===A.length);){var $=A.length;if(r("maybeReadMore read 0"),P.read(0),$===A.length)break}A.readingMore=!1}function ee(P){var A=P._readableState;A.readableListening=P.listenerCount("readable")>0,A.resumeScheduled&&!A.paused?A.flowing=!0:P.listenerCount("data")>0&&P.resume()}function ae(P){r("readable nexttick read 0"),P.read(0)}function be(P,A){r("resume",A.reading),A.reading||P.read(0),A.resumeScheduled=!1,P.emit("resume"),X(P),A.flowing&&!A.reading&&P.read(0)}function X(P){var A=P._readableState;for(r("flow",A.flowing);A.flowing&&null!==P.read(););}function H(P,A){return 0===A.length?null:(A.objectMode?$=A.buffer.shift():!P||P>=A.length?($=A.decoder?A.buffer.join(""):1===A.buffer.length?A.buffer.first():A.buffer.concat(A.length),A.buffer.clear()):$=A.buffer.consume(P,A.decoder),$);var $}function ne(P){var A=P._readableState;r("endReadable",A.endEmitted),A.endEmitted||(A.ended=!0,R.nextTick(ce,A,P))}function ce(P,A){if(r("endReadableNT",P.endEmitted,P.length),!P.endEmitted&&0===P.length&&(P.endEmitted=!0,A.readable=!1,A.emit("end"),P.autoDestroy)){var $=A._writableState;(!$||$.autoDestroy&&$.finished)&&A.destroy()}}function te(P,A){for(var $=0,G=P.length;$<G;$++)if(P[$]===A)return $;return-1}L.prototype.read=function(P){r("read",P),P=parseInt(P,10);var A=this._readableState,$=P;if(0!==P&&(A.emittedReadable=!1),0===P&&A.needReadable&&((0!==A.highWaterMark?A.length>=A.highWaterMark:A.length>0)||A.ended))return r("read: emitReadable",A.length,A.ended),0===A.length&&A.ended?ne(this):U(this),null;if(0===(P=T(P,A))&&A.ended)return 0===A.length&&ne(this),null;var se,G=A.needReadable;return r("need readable",G),(0===A.length||A.length-P<A.highWaterMark)&&r("length less than watermark",G=!0),A.ended||A.reading?r("reading or ended",G=!1):G&&(r("do read"),A.reading=!0,A.sync=!0,0===A.length&&(A.needReadable=!0),this._read(A.highWaterMark),A.sync=!1,A.reading||(P=T($,A))),null===(se=P>0?H(P,A):null)?(A.needReadable=A.length<=A.highWaterMark,P=0):(A.length-=P,A.awaitDrain=0),0===A.length&&(A.ended||(A.needReadable=!0),$!==P&&A.ended&&ne(this)),null!==se&&this.emit("data",se),se},L.prototype._read=function(P){B(this,new p("_read()"))},L.prototype.pipe=function(P,A){var $=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=P;break;case 1:G.pipes=[G.pipes,P];break;default:G.pipes.push(P)}G.pipesCount+=1,r("pipe count=%d opts=%j",G.pipesCount,A);var he=A&&!1===A.end||P===R.stdout||P===R.stderr?Be:me;function me(){r("onend"),P.end()}G.endEmitted?R.nextTick(he):$.once("end",he),P.on("unpipe",function pe(Ge,Ue){r("onunpipe"),Ge===$&&Ue&&!1===Ue.hasUnpiped&&(Ue.hasUnpiped=!0,function Se(){r("cleanup"),P.removeListener("close",Ne),P.removeListener("finish",qe),P.removeListener("drain",Ee),P.removeListener("error",Ae),P.removeListener("unpipe",pe),$.removeListener("end",me),$.removeListener("end",Be),$.removeListener("data",De),_e=!0,G.awaitDrain&&(!P._writableState||P._writableState.needDrain)&&Ee()}())});var Ee=function Q(P){return function(){var $=P._readableState;r("pipeOnDrain",$.awaitDrain),$.awaitDrain&&$.awaitDrain--,0===$.awaitDrain&&d(P,"data")&&($.flowing=!0,X(P))}}($);P.on("drain",Ee);var _e=!1;function De(Ge){r("ondata");var Ue=P.write(Ge);r("dest.write",Ue),!1===Ue&&((1===G.pipesCount&&G.pipes===P||G.pipesCount>1&&-1!==te(G.pipes,P))&&!_e&&(r("false write response, pause",G.awaitDrain),G.awaitDrain++),$.pause())}function Ae(Ge){r("onerror",Ge),Be(),P.removeListener("error",Ae),0===d(P,"error")&&B(P,Ge)}function Ne(){P.removeListener("finish",qe),Be()}function qe(){r("onfinish"),P.removeListener("close",Ne),Be()}function Be(){r("unpipe"),$.unpipe(P)}return $.on("data",De),function z(P,A,$){if("function"==typeof P.prependListener)return P.prependListener(A,$);P._events&&P._events[A]?Array.isArray(P._events[A])?P._events[A].unshift($):P._events[A]=[$,P._events[A]]:P.on(A,$)}(P,"error",Ae),P.once("close",Ne),P.once("finish",qe),P.emit("pipe",$),G.flowing||(r("pipe resume"),$.resume()),P},L.prototype.unpipe=function(P){var A=this._readableState,$={hasUnpiped:!1};if(0===A.pipesCount)return this;if(1===A.pipesCount)return P&&P!==A.pipes||(P||(P=A.pipes),A.pipes=null,A.pipesCount=0,A.flowing=!1,P&&P.emit("unpipe",this,$)),this;if(!P){var G=A.pipes,se=A.pipesCount;A.pipes=null,A.pipesCount=0,A.flowing=!1;for(var he=0;he<se;he++)G[he].emit("unpipe",this,{hasUnpiped:!1});return this}var pe=te(A.pipes,P);return-1===pe||(A.pipes.splice(pe,1),A.pipesCount-=1,1===A.pipesCount&&(A.pipes=A.pipes[0]),P.emit("unpipe",this,$)),this},L.prototype.addListener=L.prototype.on=function(P,A){var $=u.prototype.on.call(this,P,A),G=this._readableState;return"data"===P?(G.readableListening=this.listenerCount("readable")>0,!1!==G.flowing&&this.resume()):"readable"===P&&!G.endEmitted&&!G.readableListening&&(G.readableListening=G.needReadable=!0,G.flowing=!1,G.emittedReadable=!1,r("on readable",G.length,G.reading),G.length?U(this):G.reading||R.nextTick(ae,this)),$},L.prototype.removeListener=function(P,A){var $=u.prototype.removeListener.call(this,P,A);return"readable"===P&&R.nextTick(ee,this),$},L.prototype.removeAllListeners=function(P){var A=u.prototype.removeAllListeners.apply(this,arguments);return("readable"===P||void 0===P)&&R.nextTick(ee,this),A},L.prototype.resume=function(){var P=this._readableState;return P.flowing||(r("resume"),P.flowing=!P.readableListening,function ue(P,A){A.resumeScheduled||(A.resumeScheduled=!0,R.nextTick(be,P,A))}(this,P)),P.paused=!1,this},L.prototype.pause=function(){return r("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(r("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},L.prototype.wrap=function(P){var A=this,$=this._readableState,G=!1;for(var se in P.on("end",function(){if(r("wrapped end"),$.decoder&&!$.ended){var pe=$.decoder.end();pe&&pe.length&&A.push(pe)}A.push(null)}),P.on("data",function(pe){r("wrapped data"),$.decoder&&(pe=$.decoder.write(pe)),$.objectMode&&null==pe||!($.objectMode||pe&&pe.length)||A.push(pe)||(G=!0,P.pause())}),P)void 0===this[se]&&"function"==typeof P[se]&&(this[se]=function(me){return function(){return P[me].apply(P,arguments)}}(se));for(var he=0;he<J.length;he++)P.on(J[he],this.emit.bind(this,J[he]));return this._read=function(pe){r("wrapped _read",pe),G&&(G=!1,P.resume())},this},"function"==typeof Symbol&&(L.prototype[Symbol.asyncIterator]=function(){return void 0===w&&(w=m("./internal/streams/async_iterator")),w(this)}),Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(A){this._readableState&&(this._readableState.flowing=A)}}),L._fromList=H,Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(L.from=function(P,A){return void 0===x&&(x=m("./internal/streams/from")),x(L,P,A)})}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":265,"./_stream_duplex":266,"./internal/streams/async_iterator":271,"./internal/streams/buffer_list":272,"./internal/streams/destroy":273,"./internal/streams/from":275,"./internal/streams/state":277,"./internal/streams/stream":278,_process:237,buffer:68,events:105,inherits:146,"string_decoder/":279,util:20}],269:[function(m,ie,a){arguments[4][54][0].apply(a,arguments)},{"../errors":265,"./_stream_duplex":266,dup:54,inherits:146}],270:[function(m,ie,a){(function(R,I){(function(){"use strict";function _(X){var H=this;this.next=null,this.entry=null,this.finish=function(){!function be(X,H,ne){var ce=X.entry;for(X.entry=null;ce;){var te=ce.callback;H.pendingcb--,te(ne),ce=ce.next}H.corkedRequestsFree.next=X}(H,X)}}var d;ie.exports=M,M.WritableState=J;var z,u={deprecate:m("util-deprecate")},g=m("./internal/streams/stream"),f=m("buffer").Buffer,v=I.Uint8Array||function(){},r=m("./internal/streams/destroy"),t=m("./internal/streams/state").getHighWaterMark,n=m("../errors").codes,o=n.ERR_INVALID_ARG_TYPE,h=n.ERR_METHOD_NOT_IMPLEMENTED,l=n.ERR_MULTIPLE_CALLBACK,e=n.ERR_STREAM_CANNOT_PIPE,p=n.ERR_STREAM_DESTROYED,b=n.ERR_STREAM_NULL_VALUES,y=n.ERR_STREAM_WRITE_AFTER_END,w=n.ERR_UNKNOWN_ENCODING,x=r.errorOrDestroy;function B(){}function J(X,H,ne){d=d||m("./_stream_duplex"),"boolean"!=typeof ne&&(ne=H instanceof d),this.objectMode=!!(X=X||{}).objectMode,ne&&(this.objectMode=this.objectMode||!!X.writableObjectMode),this.highWaterMark=t(this,X,"writableHighWaterMark",ne),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===X.decodeStrings),this.defaultEncoding=X.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(te){!function S(X,H){var ne=X._writableState,ce=ne.sync,te=ne.writecb;if("function"!=typeof te)throw new l;if(function T(X){X.writing=!1,X.writecb=null,X.length-=X.writelen,X.writelen=0}(ne),H)!function N(X,H,ne,ce,te){--H.pendingcb,ne?(R.nextTick(te,ce),R.nextTick(ae,X,H),X._writableState.errorEmitted=!0,x(X,ce)):(te(ce),X._writableState.errorEmitted=!0,x(X,ce),ae(X,H))}(X,ne,ce,H,te);else{var P=D(ne)||X.destroyed;!P&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&k(X,ne),ce?R.nextTick(U,X,ne,P,te):U(X,ne,P,te)}}(H,te)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==X.emitClose,this.autoDestroy=!!X.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new _(this)}function M(X){var H=this instanceof(d=d||m("./_stream_duplex"));if(!H&&!z.call(M,this))return new M(X);this._writableState=new J(X,this,H),this.writable=!0,X&&("function"==typeof X.write&&(this._write=X.write),"function"==typeof X.writev&&(this._writev=X.writev),"function"==typeof X.destroy&&(this._destroy=X.destroy),"function"==typeof X.final&&(this._final=X.final)),g.call(this)}function V(X,H,ne,ce,te,P,A){H.writelen=ce,H.writecb=A,H.writing=!0,H.sync=!0,H.destroyed?H.onwrite(new p("write")):ne?X._writev(te,H.onwrite):X._write(te,P,H.onwrite),H.sync=!1}function U(X,H,ne,ce){ne||function W(X,H){0===H.length&&H.needDrain&&(H.needDrain=!1,X.emit("drain"))}(X,H),H.pendingcb--,ce(),ae(X,H)}function k(X,H){H.bufferProcessing=!0;var ne=H.bufferedRequest;if(X._writev&&ne&&ne.next){var te=new Array(H.bufferedRequestCount),P=H.corkedRequestsFree;P.entry=ne;for(var A=0,$=!0;ne;)te[A]=ne,ne.isBuf||($=!1),ne=ne.next,A+=1;te.allBuffers=$,V(X,H,!0,H.length,te,"",P.finish),H.pendingcb++,H.lastBufferedRequest=null,P.next?(H.corkedRequestsFree=P.next,P.next=null):H.corkedRequestsFree=new _(H),H.bufferedRequestCount=0}else{for(;ne;){var G=ne.chunk;if(V(X,H,!1,H.objectMode?1:G.length,G,ne.encoding,ne.callback),ne=ne.next,H.bufferedRequestCount--,H.writing)break}null===ne&&(H.lastBufferedRequest=null)}H.bufferedRequest=ne,H.bufferProcessing=!1}function D(X){return X.ending&&0===X.length&&null===X.bufferedRequest&&!X.finished&&!X.writing}function Q(X,H){X._final(function(ne){H.pendingcb--,ne&&x(X,ne),H.prefinished=!0,X.emit("prefinish"),ae(X,H)})}function ae(X,H){var ne=D(H);if(ne&&(function ee(X,H){!H.prefinished&&!H.finalCalled&&("function"!=typeof X._final||H.destroyed?(H.prefinished=!0,X.emit("prefinish")):(H.pendingcb++,H.finalCalled=!0,R.nextTick(Q,X,H)))}(X,H),0===H.pendingcb&&(H.finished=!0,X.emit("finish"),H.autoDestroy))){var ce=X._readableState;(!ce||ce.autoDestroy&&ce.endEmitted)&&X.destroy()}return ne}m("inherits")(M,g),J.prototype.getBuffer=function(){for(var H=this.bufferedRequest,ne=[];H;)ne.push(H),H=H.next;return ne},function(){try{Object.defineProperty(J.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(z=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(H){return!!z.call(this,H)||this===M&&H&&H._writableState instanceof J}})):z=function(H){return H instanceof this},M.prototype.pipe=function(){x(this,new e)},M.prototype.write=function(X,H,ne){var ce=this._writableState,te=!1,P=!ce.objectMode&&function i(X){return f.isBuffer(X)||X instanceof v}(X);return P&&!f.isBuffer(X)&&(X=function c(X){return f.from(X)}(X)),"function"==typeof H&&(ne=H,H=null),P?H="buffer":H||(H=ce.defaultEncoding),"function"!=typeof ne&&(ne=B),ce.ending?function L(X,H){var ne=new y;x(X,ne),R.nextTick(H,ne)}(this,ne):(P||function j(X,H,ne,ce){var te;return null===ne?te=new b:"string"!=typeof ne&&!H.objectMode&&(te=new o("chunk",["string","Buffer"],ne)),!te||(x(X,te),R.nextTick(ce,te),!1)}(this,ce,X,ne))&&(ce.pendingcb++,te=function F(X,H,ne,ce,te,P){if(!ne){var A=function C(X,H,ne){return!X.objectMode&&!1!==X.decodeStrings&&"string"==typeof H&&(H=f.from(H,ne)),H}(H,ce,te);ce!==A&&(ne=!0,te="buffer",ce=A)}var $=H.objectMode?1:ce.length;H.length+=$;var G=H.length<H.highWaterMark;if(G||(H.needDrain=!0),H.writing||H.corked){var se=H.lastBufferedRequest;H.lastBufferedRequest={chunk:ce,encoding:te,isBuf:ne,callback:P,next:null},se?se.next=H.lastBufferedRequest:H.bufferedRequest=H.lastBufferedRequest,H.bufferedRequestCount+=1}else V(X,H,!1,$,ce,te,P);return G}(this,ce,P,X,H,ne)),te},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var X=this._writableState;X.corked&&(X.corked--,!X.writing&&!X.corked&&!X.bufferProcessing&&X.bufferedRequest&&k(this,X))},M.prototype.setDefaultEncoding=function(H){if("string"==typeof H&&(H=H.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((H+"").toLowerCase())>-1))throw new w(H);return this._writableState.defaultEncoding=H,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),M.prototype._write=function(X,H,ne){ne(new h("_write()"))},M.prototype._writev=null,M.prototype.end=function(X,H,ne){var ce=this._writableState;return"function"==typeof X?(ne=X,X=null,H=null):"function"==typeof H&&(ne=H,H=null),null!=X&&this.write(X,H),ce.corked&&(ce.corked=1,this.uncork()),ce.ending||function ue(X,H,ne){H.ending=!0,ae(X,H),ne&&(H.finished?R.nextTick(ne):X.once("finish",ne)),H.ended=!0,X.writable=!1}(this,ce,ne),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(H){this._writableState&&(this._writableState.destroyed=H)}}),M.prototype.destroy=r.destroy,M.prototype._undestroy=r.undestroy,M.prototype._destroy=function(X,H){H(X)}}).call(this)}).call(this,m("_process"),typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":265,"./_stream_duplex":266,"./internal/streams/destroy":273,"./internal/streams/state":277,"./internal/streams/stream":278,_process:237,buffer:68,inherits:146,"util-deprecate":282}],271:[function(m,ie,a){(function(R){(function(){"use strict";var I;function E(e,p,b){return p in e?Object.defineProperty(e,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[p]=b,e}var _=m("./end-of-stream"),d=Symbol("lastResolve"),u=Symbol("lastReject"),g=Symbol("error"),f=Symbol("ended"),v=Symbol("lastPromise"),c=Symbol("handlePromise"),i=Symbol("stream");function r(e,p){return{value:e,done:p}}function s(e){var p=e[d];if(null!==p){var b=e[i].read();null!==b&&(e[v]=null,e[d]=null,e[u]=null,p(r(b,!1)))}}function t(e){R.nextTick(s,e)}var o=Object.getPrototypeOf(function(){}),h=Object.setPrototypeOf((E(I={get stream(){return this[i]},next:function(){var p=this,b=this[g];if(null!==b)return Promise.reject(b);if(this[f])return Promise.resolve(r(void 0,!0));if(this[i].destroyed)return new Promise(function(B,J){R.nextTick(function(){p[g]?J(p[g]):B(r(void 0,!0))})});var w,y=this[v];if(y)w=new Promise(function n(e,p){return function(b,y){e.then(function(){p[f]?b(r(void 0,!0)):p[c](b,y)},y)}}(y,this));else{var x=this[i].read();if(null!==x)return Promise.resolve(r(x,!1));w=new Promise(this[c])}return this[v]=w,w}},Symbol.asyncIterator,function(){return this}),E(I,"return",function(){var p=this;return new Promise(function(b,y){p[i].destroy(null,function(w){w?y(w):b(r(void 0,!0))})})}),I),o);ie.exports=function(p){var b,y=Object.create(h,(E(b={},i,{value:p,writable:!0}),E(b,d,{value:null,writable:!0}),E(b,u,{value:null,writable:!0}),E(b,g,{value:null,writable:!0}),E(b,f,{value:p._readableState.endEmitted,writable:!0}),E(b,c,{value:function(x,B){var J=y[i].read();J?(y[v]=null,y[d]=null,y[u]=null,x(r(J,!1))):(y[d]=x,y[u]=B)},writable:!0}),b));return y[v]=null,_(p,function(w){if(w&&"ERR_STREAM_PREMATURE_CLOSE"!==w.code){var x=y[u];return null!==x&&(y[v]=null,y[d]=null,y[u]=null,x(w)),void(y[g]=w)}var B=y[d];null!==B&&(y[v]=null,y[d]=null,y[u]=null,B(r(void 0,!0))),y[f]=!0}),p.on("readable",t.bind(null,y)),y}}).call(this)}).call(this,m("_process"))},{"./end-of-stream":274,_process:237}],272:[function(m,ie,a){arguments[4][57][0].apply(a,arguments)},{buffer:68,dup:57,util:20}],273:[function(m,ie,a){(function(R){(function(){"use strict";function E(f,v){u(f,v),_(f)}function _(f){f._writableState&&!f._writableState.emitClose||f._readableState&&!f._readableState.emitClose||f.emit("close")}function u(f,v){f.emit("error",v)}ie.exports={destroy:function I(f,v){var c=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(v?v(f):f&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,R.nextTick(u,this,f)):R.nextTick(u,this,f)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(f||null,function(s){!v&&s?c._writableState?c._writableState.errorEmitted?R.nextTick(_,c):(c._writableState.errorEmitted=!0,R.nextTick(E,c,s)):R.nextTick(E,c,s):v?(R.nextTick(_,c),v(s)):R.nextTick(_,c)}),this)},undestroy:function d(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function g(f,v){var c=f._readableState,i=f._writableState;c&&c.autoDestroy||i&&i.autoDestroy?f.destroy(v):f.emit("error",v)}}}).call(this)}).call(this,m("_process"))},{_process:237}],274:[function(m,ie,a){arguments[4][59][0].apply(a,arguments)},{"../../../errors":265,dup:59}],275:[function(m,ie,a){arguments[4][60][0].apply(a,arguments)},{dup:60}],276:[function(m,ie,a){arguments[4][61][0].apply(a,arguments)},{"../../../errors":265,"./end-of-stream":274,dup:61}],277:[function(m,ie,a){arguments[4][62][0].apply(a,arguments)},{"../../../errors":265,dup:62}],278:[function(m,ie,a){arguments[4][63][0].apply(a,arguments)},{dup:63,events:105}],279:[function(m,ie,a){"use strict";var R=m("safe-buffer").Buffer,I=R.isEncoding||function(l){switch((l=""+l)&&l.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function d(l){var e;switch(this.encoding=function _(l){var e=function E(l){if(!l)return"utf8";for(var e;;)switch(l){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return l;default:if(e)return;l=(""+l).toLowerCase(),e=!0}}(l);if("string"!=typeof e&&(R.isEncoding===I||!I(l)))throw new Error("Unknown encoding: "+l);return e||l}(l),this.encoding){case"utf16le":this.text=r,this.end=s,e=4;break;case"utf8":this.fillLast=v,e=4;break;case"base64":this.text=t,this.end=n,e=3;break;default:return this.write=o,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=R.allocUnsafe(e)}function u(l){return l<=127?0:l>>5==6?2:l>>4==14?3:l>>3==30?4:l>>6==2?-1:-2}function v(l){var e=this.lastTotal-this.lastNeed,p=function f(l,e,p){if(128!=(192&e[0]))return l.lastNeed=0,"\ufffd";if(l.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return l.lastNeed=1,"\ufffd";if(l.lastNeed>2&&e.length>2&&128!=(192&e[2]))return l.lastNeed=2,"\ufffd"}}(this,l);return void 0!==p?p:this.lastNeed<=l.length?(l.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(l.copy(this.lastChar,e,0,l.length),void(this.lastNeed-=l.length))}function r(l,e){if((l.length-e)%2==0){var p=l.toString("utf16le",e);if(p){var b=p.charCodeAt(p.length-1);if(b>=55296&&b<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=l[l.length-2],this.lastChar[1]=l[l.length-1],p.slice(0,-1)}return p}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=l[l.length-1],l.toString("utf16le",e,l.length-1)}function s(l){var e=l&&l.length?this.write(l):"";return this.lastNeed?e+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):e}function t(l,e){var p=(l.length-e)%3;return 0===p?l.toString("base64",e):(this.lastNeed=3-p,this.lastTotal=3,1===p?this.lastChar[0]=l[l.length-1]:(this.lastChar[0]=l[l.length-2],this.lastChar[1]=l[l.length-1]),l.toString("base64",e,l.length-p))}function n(l){var e=l&&l.length?this.write(l):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function o(l){return l.toString(this.encoding)}function h(l){return l&&l.length?this.write(l):""}a.StringDecoder=d,d.prototype.write=function(l){if(0===l.length)return"";var e,p;if(this.lastNeed){if(void 0===(e=this.fillLast(l)))return"";p=this.lastNeed,this.lastNeed=0}else p=0;return p<l.length?e?e+this.text(l,p):this.text(l,p):e||""},d.prototype.end=function i(l){var e=l&&l.length?this.write(l):"";return this.lastNeed?e+"\ufffd":e},d.prototype.text=function c(l,e){var p=function g(l,e,p){var b=e.length-1;if(b<p)return 0;var y=u(e[b]);return y>=0?(y>0&&(l.lastNeed=y-1),y):--b<p||-2===y?0:(y=u(e[b]))>=0?(y>0&&(l.lastNeed=y-2),y):--b<p||-2===y?0:(y=u(e[b]))>=0?(y>0&&(2===y?y=0:l.lastNeed=y-3),y):0}(this,l,e);if(!this.lastNeed)return l.toString("utf8",e);this.lastTotal=p;var b=l.length-(p-this.lastNeed);return l.copy(this.lastChar,0,b),l.toString("utf8",e,b)},d.prototype.fillLast=function(l){if(this.lastNeed<=l.length)return l.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);l.copy(this.lastChar,this.lastTotal-this.lastNeed,0,l.length),this.lastNeed-=l.length}},{"safe-buffer":250}],280:[function(m,ie,a){ie.exports={0:"O",1:"l","\u05ad":"\u0596","\u05ae":"\u0598","\u05a8":"\u0599","\u05a4":"\u059a","\u1ab4":"\u06db","\u20db":"\u06db","\u0619":"\u0313","\u08f3":"\u0313","\u0343":"\u0313","\u0315":"\u0313","\u064f":"\u0313","\u065d":"\u0314","\u059c":"\u0301","\u059d":"\u0301","\u0618":"\u0301","\u0747":"\u0301","\u0341":"\u0301","\u0954":"\u0301","\u064e":"\u0301","\u0340":"\u0300","\u0953":"\u0300","\u030c":"\u0306","\ua67c":"\u0306","\u0658":"\u0306","\u065a":"\u0306","\u036e":"\u0306","\u06e8":"\u0306\u0307","\u0310":"\u0306\u0307","\u0901":"\u0306\u0307","\u0981":"\u0306\u0307","\u0a81":"\u0306\u0307","\u0b01":"\u0306\u0307","\u0c00":"\u0306\u0307","\u0c81":"\u0306\u0307","\u0d01":"\u0306\u0307","\u{114bf}":"\u0306\u0307","\u1cd0":"\u0302","\u0311":"\u0302","\u065b":"\u0302","\u07ee":"\u0302","\ua6f0":"\u0302","\u05af":"\u030a","\u06df":"\u030a","\u17d3":"\u030a","\u309a":"\u030a","\u0652":"\u030a","\u0b82":"\u030a","\u1036":"\u030a","\u17c6":"\u030a","\u{11300}":"\u030a","\u0e4d":"\u030a","\u0ecd":"\u030a","\u0366":"\u030a","\u2dea":"\u030a","\u08eb":"\u0308","\u07f3":"\u0308","\u064b":"\u030b","\u08f0":"\u030b","\u0342":"\u0303","\u0653":"\u0303","\u05c4":"\u0307","\u06ec":"\u0307","\u0740":"\u0307","\u08ea":"\u0307","\u0741":"\u0307","\u0358":"\u0307","\u05b9":"\u0307","\u05ba":"\u0307","\u05c2":"\u0307","\u05c1":"\u0307","\u07ed":"\u0307","\u0902":"\u0307","\u0a02":"\u0307","\u0a82":"\u0307","\u0bcd":"\u0307","\u0337":"\u0338","\u1ab7":"\u0328","\u0322":"\u0328","\u0345":"\u0328","\u1cd2":"\u0304","\u0305":"\u0304","\u0659":"\u0304","\u07eb":"\u0304","\ua6f1":"\u0304","\u1cda":"\u030e","\u0657":"\u0312","\u0357":"\u0350","\u08ff":"\u0350","\u08f8":"\u0350","\u0900":"\u0352","\u1ced":"\u0316","\u1cdc":"\u0329","\u0656":"\u0329","\u1cd5":"\u032b","\u0347":"\u0333","\u08f9":"\u0354","\u08fa":"\u0355",\u309b:"\uff9e",\u309c:"\uff9f","\u0336":"\u0335","\u302c":"\u0309","\u05c5":"\u0323","\u08ed":"\u0323","\u1cdd":"\u0323","\u05b4":"\u0323","\u065c":"\u0323","\u093c":"\u0323","\u09bc":"\u0323","\u0a3c":"\u0323","\u0abc":"\u0323","\u0b3c":"\u0323","\u{111ca}":"\u0323","\u{114c3}":"\u0323","\u{10a3a}":"\u0323","\u08ee":"\u0324","\u1cde":"\u0324","\u0f37":"\u0325","\u302d":"\u0325","\u0327":"\u0326","\u0321":"\u0326","\u0339":"\u0326","\u1cd9":"\u032d","\u1cd8":"\u032e","\u0952":"\u0331","\u0320":"\u0331","\u08f1":"\u064c","\u08e8":"\u064c","\u08e5":"\u064c",\ufc5e:"\ufe72\u0651","\u08f2":"\u064d",\ufc5f:"\ufe74\u0651",\ufcf2:"\ufe77\u0651",\ufc60:"\ufe76\u0651",\ufcf3:"\ufe79\u0651",\ufc61:"\ufe78\u0651","\u061a":"\u0650","\u0317":"\u0650",\ufcf4:"\ufe7b\u0651",\ufc62:"\ufe7a\u0651",\ufc63:"\ufe7c\u0670","\u065f":"\u0655","\u030d":"\u0670","\u0742":"\u073c","\u0a03":"\u0983","\u0c03":"\u0983","\u0c83":"\u0983","\u0d03":"\u0983","\u0d83":"\u0983","\u1038":"\u0983","\u{114c1}":"\u0983","\u17cb":"\u0e48","\u0ec8":"\u0e48","\u0ec9":"\u0e49","\u0eca":"\u0e4a","\u0ecb":"\u0e4b","\ua66f":"\u20e9","\u2028":" ","\u2029":" ","\u1680":" ","\u2000":" ","\u2001":" ","\u2002":" ","\u2003":" ","\u2004":" ","\u2005":" ","\u2006":" ","\u2008":" ","\u2009":" ","\u200a":" ","\u205f":" ","\xa0":" ","\u2007":" ","\u202f":" ",\u07fa:"_","\ufe4d":"_","\ufe4e":"_","\ufe4f":"_","\u2010":"-","\u2011":"-","\u2012":"-","\u2013":"-","\ufe58":"-","\u06d4":"-","\u2043":"-","\u02d7":"-","\u2212":"-","\u2796":"-",\u2cba:"-","\u2a29":"-\u0313","\u2e1a":"-\u0308","\ufb29":"-\u0307","\u2238":"-\u0307","\u2a2a":"-\u0323","\ua4fe":"-.","\uff5e":"\u301c","\u060d":",","\u066b":",","\u201a":",","\xb8":",",\ua4f9:",","\u2e32":"\u060c","\u066c":"\u060c","\u037e":";","\u2e35":"\u061b","\u0903":":","\u0a83":":","\uff1a":":","\u0589":":","\u0703":":","\u0704":":","\u16ec":":","\ufe30":":","\u1803":":","\u1809":":","\u205a":":","\u05c3":":","\u02f8":":","\ua789":":","\u2236":":",\u02d0:":",\ua4fd:":","\u2a74":"::=","\u29f4":":\u2192","\uff01":"!",\u01c3:"!",\u2d51:"!","\u203c":"!!","\u2049":"!?",\u0294:"?",\u0241:"?",\u097d:"?",\u13ae:"?",\ua6eb:"?","\u2048":"?!","\u2047":"??","\u2e2e":"\u061f","\u{1d16d}":".","\u2024":".","\u0701":".","\u0702":".","\ua60e":".","\u{10a50}":".","\u0660":".","\u06f0":".",\ua4f8:".",\ua4fb:".,","\u2025":"..",\ua4fa:"..","\u2026":"...","\ua6f4":"\ua6f3\ua6f3","\u30fb":"\xb7","\uff65":"\xb7","\u16eb":"\xb7","\u0387":"\xb7","\u2e31":"\xb7","\u{10101}":"\xb7","\u2022":"\xb7","\u2027":"\xb7","\u2219":"\xb7","\u22c5":"\xb7",\ua78f:"\xb7",\u1427:"\xb7","\u22ef":"\xb7\xb7\xb7",\u2d48:"\xb7\xb7\xb7",\u1444:"\xb7<","\u22d7":"\xb7>",\u1437:"\xb7>",\u1440:"\xb7>",\u152f:"\xb74",\u147e:"\xb7b",\u1480:"\xb7b\u0307",\u147a:"\xb7d",\u1498:"\xb7J",\u14b6:"\xb7L",\u1476:"\xb7P",\u1457:"\xb7U",\u143a:"\xb7V",\u143c:"\xb7\u0245",\u14ae:"\xb7\u0393",\u140e:"\xb7\u0394",\u1459:"\xb7\u0548",\u140c:"\xb7\u1401",\u1410:"\xb7\u1404",\u1412:"\xb7\u1405",\u1414:"\xb7\u1406",\u1417:"\xb7\u140a",\u1419:"\xb7\u140b",\u143e:"\xb7\u1432",\u1442:"\xb7\u1434",\u1446:"\xb7\u1439",\u145b:"\xb7\u144f",\u1454:"\xb7\u1450",\u145d:"\xb7\u1450",\u145f:"\xb7\u1451",\u1461:"\xb7\u1455",\u1463:"\xb7\u1456",\u1474:"\xb7\u146b",\u1478:"\xb7\u146e",\u147c:"\xb7\u1470",\u1492:"\xb7\u1489",\u1494:"\xb7\u148b",\u1496:"\xb7\u148c",\u149a:"\xb7\u148e",\u149c:"\xb7\u1490",\u149e:"\xb7\u1491",\u14ac:"\xb7\u14a3",\u14b0:"\xb7\u14a6",\u14b2:"\xb7\u14a7",\u14b4:"\xb7\u14a8",\u14b8:"\xb7\u14ab",\u14c9:"\xb7\u14c0",\u18c6:"\xb7\u14c2",\u18c8:"\xb7\u14c3",\u18ca:"\xb7\u14c4",\u18cc:"\xb7\u14c5",\u14cb:"\xb7\u14c7",\u14cd:"\xb7\u14c8",\u14dc:"\xb7\u14d3",\u14de:"\xb7\u14d5",\u14e0:"\xb7\u14d6",\u14e2:"\xb7\u14d7",\u14e4:"\xb7\u14d8",\u14e6:"\xb7\u14da",\u14e8:"\xb7\u14db",\u14f6:"\xb7\u14ed",\u14f8:"\xb7\u14ef",\u14fa:"\xb7\u14f0",\u14fc:"\xb7\u14f1",\u14fe:"\xb7\u14f2",\u1500:"\xb7\u14f4",\u1502:"\xb7\u14f5",\u1517:"\xb7\u1510",\u1519:"\xb7\u1511",\u151b:"\xb7\u1512",\u151d:"\xb7\u1513",\u151f:"\xb7\u1514",\u1521:"\xb7\u1515",\u1523:"\xb7\u1516",\u1531:"\xb7\u1528",\u1533:"\xb7\u1529",\u1535:"\xb7\u152a",\u1537:"\xb7\u152b",\u1539:"\xb7\u152d",\u153b:"\xb7\u152e",\u18ce:"\xb7\u1543",\u18cf:"\xb7\u1546",\u18d0:"\xb7\u1547",\u18d1:"\xb7\u1548",\u18d2:"\xb7\u1549",\u18d3:"\xb7\u154b",\u154e:"\xb7\u154c",\u155b:"\xb7\u155a",\u1568:"\xb7\u1567",\u18b3:"\xb7\u18b1",\u18b6:"\xb7\u18b4",\u18b9:"\xb7\u18b8",\u18c2:"\xb7\u18c0","\ua830":"\u0964","\u0965":"\u0964\u0964","\u1c3c":"\u1c3b\u1c3b","\u104b":"\u104a\u104a","\u1aa9":"\u1aa8\u1aa8","\u1aab":"\u1aaa\u1aa8","\u1b5f":"\u1b5e\u1b5e","\u{10a57}":"\u{10a56}\u{10a56}","\u{1144c}":"\u{1144b}\u{1144b}","\u{11642}":"\u{11641}\u{11641}","\u{11c42}":"\u{11c41}\u{11c41}","\u1c7f":"\u1c7e\u1c7e","\u055d":"'","\uff07":"'","\u2018":"'","\u2019":"'","\u201b":"'","\u2032":"'","\u2035":"'","\u055a":"'","\u05f3":"'","`":"'","\u1fef":"'","\uff40":"'","\xb4":"'","\u0384":"'","\u1ffd":"'","\u1fbd":"'","\u1fbf":"'","\u1ffe":"'",\u02b9:"'",\u0374:"'",\u02c8:"'",\u02ca:"'",\u02cb:"'","\u02f4":"'",\u02bb:"'",\u02bd:"'",\u02bc:"'",\u02be:"'",\ua78c:"'",\u05d9:"'",\u07f4:"'",\u07f5:"'",\u144a:"'",\u16cc:"'","\u{16f51}":"'","\u{16f52}":"'","\u1cd3":"''",'"':"''","\uff02":"''","\u201c":"''","\u201d":"''","\u201f":"''","\u2033":"''","\u2036":"''","\u3003":"''","\u05f4":"''","\u02dd":"''",\u02ba:"''","\u02f6":"''",\u02ee:"''",\u05f2:"''","\u2034":"'''","\u2037":"'''","\u2057":"''''",\u0181:"'B",\u018a:"'D",\u0149:"'n",\u01a4:"'P",\u01ac:"'T",\u01b3:"'Y","\uff3b":"(","\u2768":"(","\u2772":"(","\u3014":"(","\ufd3e":"(","\u2e28":"((","\u3220":"(\u30fc)","\u2475":"(2)","\u2487":"(2O)","\u2476":"(3)","\u2477":"(4)","\u2478":"(5)","\u2479":"(6)","\u247a":"(7)","\u247b":"(8)","\u247c":"(9)","\u249c":"(a)","\u{1f110}":"(A)","\u249d":"(b)","\u{1f111}":"(B)","\u249e":"(c)","\u{1f112}":"(C)","\u249f":"(d)","\u{1f113}":"(D)","\u24a0":"(e)","\u{1f114}":"(E)","\u24a1":"(f)","\u{1f115}":"(F)","\u24a2":"(g)","\u{1f116}":"(G)","\u24a3":"(h)","\u{1f117}":"(H)","\u24a4":"(i)","\u24a5":"(j)","\u{1f119}":"(J)","\u24a6":"(k)","\u{1f11a}":"(K)","\u2474":"(l)","\u{1f118}":"(l)","\u24a7":"(l)","\u{1f11b}":"(L)","\u247f":"(l2)","\u2480":"(l3)","\u2481":"(l4)","\u2482":"(l5)","\u2483":"(l6)","\u2484":"(l7)","\u2485":"(l8)","\u2486":"(l9)","\u247e":"(ll)","\u247d":"(lO)","\u{1f11c}":"(M)","\u24a9":"(n)","\u{1f11d}":"(N)","\u24aa":"(o)","\u{1f11e}":"(O)","\u24ab":"(p)","\u{1f11f}":"(P)","\u24ac":"(q)","\u{1f120}":"(Q)","\u24ad":"(r)","\u{1f121}":"(R)","\u24a8":"(rn)","\u24ae":"(s)","\u{1f122}":"(S)","\u{1f12a}":"(S)","\u24af":"(t)","\u{1f123}":"(T)","\u24b0":"(u)","\u{1f124}":"(U)","\u24b1":"(v)","\u{1f125}":"(V)","\u24b2":"(w)","\u{1f126}":"(W)","\u24b3":"(x)","\u{1f127}":"(X)","\u24b4":"(y)","\u{1f128}":"(Y)","\u24b5":"(z)","\u{1f129}":"(Z)","\u3200":"(\u1100)","\u320e":"(\uac00)","\u3201":"(\u1102)","\u320f":"(\ub098)","\u3202":"(\u1103)","\u3210":"(\ub2e4)","\u3203":"(\u1105)","\u3211":"(\ub77c)","\u3204":"(\u1106)","\u3212":"(\ub9c8)","\u3205":"(\u1107)","\u3213":"(\ubc14)","\u3206":"(\u1109)","\u3214":"(\uc0ac)","\u3207":"(\u110b)","\u3215":"(\uc544)","\u321d":"(\uc624\uc804)","\u321e":"(\uc624\ud6c4)","\u3208":"(\u110c)","\u3216":"(\uc790)","\u321c":"(\uc8fc)","\u3209":"(\u110e)","\u3217":"(\ucc28)","\u320a":"(\u110f)","\u3218":"(\uce74)","\u320b":"(\u1110)","\u3219":"(\ud0c0)","\u320c":"(\u1111)","\u321a":"(\ud30c)","\u320d":"(\u1112)","\u321b":"(\ud558)","\u3226":"(\u4e03)","\u3222":"(\u4e09)","\u{1f241}":"(\u4e09)","\u3228":"(\u4e5d)","\u3221":"(\u4e8c)","\u{1f242}":"(\u4e8c)","\u3224":"(\u4e94)","\u3239":"(\u4ee3)","\u323d":"(\u4f01)","\u3241":"(\u4f11)","\u3227":"(\u516b)","\u3225":"(\u516d)","\u3238":"(\u52b4)","\u{1f247}":"(\u52dd)","\u3229":"(\u5341)","\u323f":"(\u5354)","\u3234":"(\u540d)","\u323a":"(\u547c)","\u3223":"(\u56db)","\u322f":"(\u571f)","\u323b":"(\u5b66)","\u{1f243}":"(\u5b89)","\u{1f245}":"(\u6253)","\u{1f248}":"(\u6557)","\u3230":"(\u65e5)","\u322a":"(\u6708)","\u3232":"(\u6709)","\u322d":"(\u6728)","\u{1f240}":"(\u672c)","\u3231":"(\u682a)","\u322c":"(\u6c34)","\u322b":"(\u706b)","\u{1f244}":"(\u70b9)","\u3235":"(\u7279)","\u{1f246}":"(\u76d7)","\u323c":"(\u76e3)","\u3233":"(\u793e)","\u3237":"(\u795d)","\u3240":"(\u796d)","\u3242":"(\u81ea)","\u3243":"(\u81f3)","\u3236":"(\u8ca1)","\u323e":"(\u8cc7)","\u322e":"(\u91d1)","\uff3d":")","\u2769":")","\u2773":")","\u3015":")","\ufd3f":")","\u2e29":"))","\u2774":"{","\u{1d114}":"{","\u2775":"}","\u301a":"\u27e6","\u301b":"\u27e7","\u27e8":"\u276c","\u2329":"\u276c","\u3008":"\u276c","\u31db":"\u276c",\u304f:"\u276c",\u{21fe8}:"\u276c","\u27e9":"\u276d","\u232a":"\u276d","\u3009":"\u276d","\uff3e":"\ufe3f","\u2e3f":"\xb6","\u204e":"*","\u066d":"*","\u2217":"*",\u{1031f}:"*","\u1735":"/","\u2041":"/","\u2215":"/","\u2044":"/","\u2571":"/","\u27cb":"/","\u29f8":"/","\u{1d23a}":"/","\u31d3":"/",\u3033:"/",\u2cc6:"/",\u30ce:"/",\u4e3f:"/","\u2f03":"/","\u29f6":"/\u0304","\u2afd":"//","\u2afb":"///","\uff3c":"\\","\ufe68":"\\","\u2216":"\\","\u27cd":"\\","\u29f5":"\\","\u29f9":"\\","\u{1d20f}":"\\","\u{1d23b}":"\\","\u31d4":"\\",\u4e36:"\\","\u2f02":"\\","\u2cf9":"\\\\","\u244a":"\\\\","\u27c8":"\\\u1455",\ua778:"&","\u0af0":"\u0970","\u{110bb}":"\u0970","\u{111c7}":"\u0970","\u26ac":"\u0970","\u{111db}":"\ua8fc","\u17d9":"\u0e4f","\u17d5":"\u0e5a","\u17da":"\u0e5b","\u0f0c":"\u0f0b","\u0f0e":"\u0f0d\u0f0d","\u02c4":"^",\u02c6:"^","\ua67e":"\u02c7","\u02d8":"\u02c7","\u203e":"\u02c9","\ufe49":"\u02c9","\ufe4a":"\u02c9","\ufe4b":"\u02c9","\ufe4c":"\u02c9","\xaf":"\u02c9","\uffe3":"\u02c9","\u2594":"\u02c9",\u044a:"\u02c9b",\ua651:"\u02c9bi","\u0375":"\u02cf","\u02fb":"\u02ea","\ua716":"\u02ea","\ua714":"\u02eb","\u3002":"\u02f3","\u2e30":"\xb0","\u02da":"\xb0","\u2218":"\xb0","\u25cb":"\xb0","\u25e6":"\xb0","\u235c":"\xb0\u0332","\u2364":"\xb0\u0308","\u2103":"\xb0C","\u2109":"\xb0F","\u0bf5":"\u0bf3","\u0f1b":"\u0f1a\u0f1a","\u0f1f":"\u0f1a\u0f1d","\u0fce":"\u0f1d\u0f1a","\u0f1e":"\u0f1d\u0f1d","\u24b8":"\xa9","\u24c7":"\xae","\u24c5":"\u2117","\u{1d21b}":"\u2144","\u2bec":"\u219e","\u2bed":"\u219f","\u2bee":"\u21a0","\u2bef":"\u21a1","\u21b5":"\u21b2","\u2965":"\u21c3\u21c2","\u296f":"\u21c3\u16da","\u{1d6db}":"\u2202","\u{1d715}":"\u2202","\u{1d74f}":"\u2202","\u{1d789}":"\u2202","\u{1d7c3}":"\u2202","\u{1e8cc}":"\u2202","\u{1e8cd}":"\u2202\u0335",\u00f0:"\u2202\u0335","\u2300":"\u2205","\u{1d6c1}":"\u2207","\u{1d6fb}":"\u2207","\u{1d735}":"\u2207","\u{1d76f}":"\u2207","\u{1d7a9}":"\u2207",\u{118a8}:"\u2207","\u2362":"\u2207\u0308","\u236b":"\u2207\u0334","\u2588":"\u220e","\u25a0":"\u220e","\u2a3f":"\u2210","\u16ed":"+","\u2795":"+",\u{1029b}:"+","\u2a23":"+\u0302","\u2a22":"+\u030a","\u2a24":"+\u0303","\u2214":"+\u0307","\u2a25":"+\u0323","\u2a26":"+\u0330","\u2a27":"+\u2082","\u2797":"\xf7","\u2039":"<","\u276e":"<","\u02c2":"<","\u{1d236}":"<",\u1438:"<",\u16b2:"<","\u22d6":"<\xb7",\u2cb4:"<\xb7",\u1445:"<\xb7","\u226a":"<<","\u22d8":"<<<","\u1400":"=","\u2e40":"=","\u30a0":"=","\ua4ff":"=","\u225a":"=\u0306","\u2259":"=\u0302","\u2257":"=\u030a","\u2250":"=\u0307","\u2251":"=\u0307\u0323","\u2a6e":"=\u20f0","\u2a75":"==","\u2a76":"===","\u225e":"=\u036b","\u203a":">","\u276f":">","\u02c3":">","\u{1d237}":">",\u1433:">",\u{16f3f}:">",\u1441:">\xb7","\u2aa5":"><","\u226b":">>","\u2a20":">>","\u22d9":">>>","\u2053":"~","\u02dc":"~","\u1fc0":"~","\u223c":"~","\u2368":"~\u0308","\u2e1e":"~\u0307","\u2a6a":"~\u0307","\u2e1f":"~\u0323","\u{1e8c8}":"\u2220","\u22c0":"\u2227","\u222f":"\u222e\u222e","\u2230":"\u222e\u222e\u222e","\u2e2b":"\u2234","\u2e2a":"\u2235","\u2e2c":"\u2237","\u{111de}":"\u2248","\u264e":"\u224f","\u{1f75e}":"\u224f","\u2263":"\u2261","\u2a03":"\u228d","\u2a04":"\u228e","\u{1d238}":"\u228f","\u{1d239}":"\u2290","\u2a05":"\u2293","\u2a06":"\u2294","\u2a02":"\u2297","\u235f":"\u229b","\u{1f771}":"\u22a0","\u{1f755}":"\u22a1","\u25c1":"\u22b2","\u25b7":"\u22b3","\u2363":"\u22c6\u0308","\ufe34":"\u2307","\u25e0":"\u2312","\u2a3d":"\u2319","\u2325":"\u2324","\u29c7":"\u233b","\u25ce":"\u233e","\u29be":"\u233e","\u29c5":"\u2342","\u29b0":"\u2349","\u23c3":"\u234b","\u23c2":"\u234e","\u23c1":"\u2355","\u23c6":"\u236d","\u2638":"\u2388","\ufe35":"\u23dc","\ufe36":"\u23dd","\ufe37":"\u23de","\ufe38":"\u23df","\ufe39":"\u23e0","\ufe3a":"\u23e1","\u25b1":"\u23e5","\u23fc":"\u23fb","\ufe31":"\u2502","\uff5c":"\u2502","\u2503":"\u2502","\u250f":"\u250c","\u2523":"\u251c","\u2590":"\u258c","\u2597":"\u2596","\u259d":"\u2598","\u2610":"\u25a1","\uffed":"\u25aa","\u25b8":"\u25b6","\u25ba":"\u25b6","\u2ce9":"\u2627","\u{1f70a}":"\u2629","\u{1f312}":"\u263d","\u{1f319}":"\u263d","\u23fe":"\u263e","\u{1f318}":"\u263e","\u29d9":"\u299a","\u{1f73a}":"\u29df","\u2a3e":"\u2a1f","\u{101a0}":"\u2ce8","\u2669":"\u{1d158}\u{1d165}","\u266a":"\u{1d158}\u{1d165}\u{1d16e}","\u24ea":"\u{1f10d}","\u21ba":"\u{1f10e}","\u02d9":"\u0971",\u0d4e:"\u0971","\uff0d":"\u30fc","\u2014":"\u30fc","\u2015":"\u30fc","\u2500":"\u30fc","\u2501":"\u30fc","\u31d0":"\u30fc",\ua7f7:"\u30fc",\u1173:"\u30fc",\u3161:"\u30fc",\u4e00:"\u30fc","\u2f00":"\u30fc",\u1196:"\u30fc\u30fc",\ud7b9:"\u30fc\u1161",\ud7ba:"\u30fc\u1165",\ud7bb:"\u30fc\u1165\u4e28",\ud7bc:"\u30fc\u1169",\u1195:"\u30fc\u116e",\u1174:"\u30fc\u4e28",\u3162:"\u30fc\u4e28",\u1197:"\u30fc\u4e28\u116e","\u{1f10f}":"$\u20e0","\u20a4":"\xa3","\u3012":"\u20b8","\u3036":"\u20b8","\u1b5c":"\u1b50","\ua9c6":"\ua9d0","\u{114d1}":"\u09e7","\u0ce7":"\u0c67",\u1065:"\u1041","\u2460":"\u2780","\u2469":"\u2789","\u23e8":"\u2081\u2080","\u{1d7d0}":"2","\u{1d7da}":"2","\u{1d7e4}":"2","\u{1d7ee}":"2","\u{1d7f8}":"2","\u{1fbf2}":"2",\ua75a:"2",\u01a7:"2",\u03e8:"2",\ua644:"2",\u14bf:"2",\ua6ef:"2",\ua9cf:"\u0662","\u06f2":"\u0662","\u0ae8":"\u0968","\u{114d2}":"\u09e8","\u0ce8":"\u0c68","\u2461":"\u2781",\u01bb:"2\u0335","\u{1f103}":"2,","\u2489":"2.","\u33f5":"22\u65e5","\u336e":"22\u70b9","\u33f6":"23\u65e5","\u336f":"23\u70b9","\u33f7":"24\u65e5","\u3370":"24\u70b9","\u33f8":"25\u65e5","\u33f9":"26\u65e5","\u33fa":"27\u65e5","\u33fb":"28\u65e5","\u33fc":"29\u65e5","\u33f4":"2l\u65e5","\u336d":"2l\u70b9","\u249b":"2O.","\u33f3":"2O\u65e5","\u336c":"2O\u70b9","\u0de9":"\u0de8\u0dcf","\u0def":"\u0de8\u0dd3","\u33e1":"2\u65e5","\u32c1":"2\u6708","\u335a":"2\u70b9","\u{1d206}":"3","\u{1d7d1}":"3","\u{1d7db}":"3","\u{1d7e5}":"3","\u{1d7ef}":"3","\u{1d7f9}":"3","\u{1fbf3}":"3",\ua7ab:"3",\u021c:"3",\u01b7:"3",\ua76a:"3",\u2ccc:"3",\u0417:"3",\u04e0:"3",\u{16f3b}:"3",\u{118ca}:"3","\u06f3":"\u0663","\u{1e8c9}":"\u0663","\u0ae9":"\u0969","\u2462":"\u2782",\u0498:"3\u0326","\u{1f104}":"3,","\u248a":"3.","\u33fe":"3l\u65e5","\u33fd":"3O\u65e5","\u33e2":"3\u65e5","\u32c2":"3\u6708","\u335b":"3\u70b9","\u{1d7d2}":"4","\u{1d7dc}":"4","\u{1d7e6}":"4","\u{1d7f0}":"4","\u{1d7fa}":"4","\u{1fbf4}":"4",\u13ce:"4",\u{118af}:"4","\u06f4":"\u0664","\u0aea":"\u096a","\u2463":"\u2783","\u{1f105}":"4,","\u248b":"4.",\u1530:"4\xb7","\u33e3":"4\u65e5","\u32c3":"4\u6708","\u335c":"4\u70b9","\u{1d7d3}":"5","\u{1d7dd}":"5","\u{1d7e7}":"5","\u{1d7f1}":"5","\u{1d7fb}":"5","\u{1fbf5}":"5",\u01bc:"5",\u{118bb}:"5","\u2464":"\u2784","\u{1f106}":"5,","\u248c":"5.","\u33e4":"5\u65e5","\u32c4":"5\u6708","\u335d":"5\u70b9","\u{1d7d4}":"6","\u{1d7de}":"6","\u{1d7e8}":"6","\u{1d7f2}":"6","\u{1d7fc}":"6","\u{1fbf6}":"6",\u2cd2:"6",\u0431:"6",\u13ee:"6",\u{118d5}:"6","\u06f6":"\u0666","\u{114d6}":"\u09ec","\u2465":"\u2785","\u{1f107}":"6,","\u248d":"6.","\u33e5":"6\u65e5","\u32c5":"6\u6708","\u335e":"6\u70b9","\u{1d212}":"7","\u{1d7d5}":"7","\u{1d7df}":"7","\u{1d7e9}":"7","\u{1d7f3}":"7","\u{1d7fd}":"7","\u{1fbf7}":"7","\u{104d2}":"7",\u{118c6}:"7","\u2466":"\u2786","\u{1f108}":"7,","\u248e":"7.","\u33e6":"7\u65e5","\u32c6":"7\u6708","\u335f":"7\u70b9","\u0b03":"8","\u09ea":"8","\u0a6a":"8","\u{1e8cb}":"8","\u{1d7d6}":"8","\u{1d7e0}":"8","\u{1d7ea}":"8","\u{1d7f4}":"8","\u{1d7fe}":"8","\u{1fbf8}":"8",\u0223:"8",\u0222:"8",\u{1031a}:"8","\u0aee":"\u096e","\u2467":"\u2787","\u{1f109}":"8,","\u248f":"8.","\u33e7":"8\u65e5","\u32c7":"8\u6708","\u3360":"8\u70b9","\u0a67":"9","\u0b68":"9","\u09ed":"9","\u0d6d":"9","\u{1d7d7}":"9","\u{1d7e1}":"9","\u{1d7eb}":"9","\u{1d7f5}":"9","\u{1d7ff}":"9","\u{1fbf9}":"9",\ua76e:"9",\u2cca:"9",\u{118cc}:"9",\u{118ac}:"9",\u{118d6}:"9","\u0967":"\u0669","\u{118e4}":"\u0669","\u06f9":"\u0669","\u0cef":"\u0c6f","\u2468":"\u2788","\u{1f10a}":"9,","\u2490":"9.","\u33e8":"9\u65e5","\u32c8":"9\u6708","\u3361":"9\u70b9","\u237a":"a",\uff41:"a",\u{1d41a}:"a",\u{1d44e}:"a",\u{1d482}:"a",\u{1d4b6}:"a",\u{1d4ea}:"a",\u{1d51e}:"a",\u{1d552}:"a",\u{1d586}:"a",\u{1d5ba}:"a",\u{1d5ee}:"a",\u{1d622}:"a",\u{1d656}:"a",\u{1d68a}:"a",\u0251:"a",\u03b1:"a",\u{1d6c2}:"a",\u{1d6fc}:"a",\u{1d736}:"a",\u{1d770}:"a",\u{1d7aa}:"a",\u0430:"a","\u2df6":"\u0363",\uff21:"A",\u{1d400}:"A",\u{1d434}:"A",\u{1d468}:"A",\u{1d49c}:"A",\u{1d4d0}:"A",\u{1d504}:"A",\u{1d538}:"A",\u{1d56c}:"A",\u{1d5a0}:"A",\u{1d5d4}:"A",\u{1d608}:"A",\u{1d63c}:"A",\u{1d670}:"A",\u0391:"A",\u{1d6a8}:"A",\u{1d6e2}:"A",\u{1d71c}:"A",\u{1d756}:"A",\u{1d790}:"A",\u0410:"A",\u13aa:"A",\u15c5:"A",\ua4ee:"A",\u{16f40}:"A",\u{102a0}:"A","\u2376":"a\u0332",\u01ce:"\u0103",\u01cd:"\u0102",\u0227:"\xe5",\u0226:"\xc5",\u1e9a:"\u1ea3","\u2100":"a/c","\u2101":"a/s",\ua733:"aa",\ua732:"AA",\u00e6:"ae",\u04d5:"ae",\u00c6:"AE",\u04d4:"AE",\ua735:"ao",\ua734:"AO","\u{1f707}":"AR",\ua737:"au",\ua736:"AU",\ua739:"av",\ua73b:"av",\ua738:"AV",\ua73a:"AV",\ua73d:"ay",\ua73c:"AY",\uab7a:"\u1d00","\u2200":"\u2c6f","\u{1d217}":"\u2c6f",\u15c4:"\u2c6f",\ua4ef:"\u2c6f",\u{1041f}:"\u2c70",\u{1d41b}:"b",\u{1d44f}:"b",\u{1d483}:"b",\u{1d4b7}:"b",\u{1d4eb}:"b",\u{1d51f}:"b",\u{1d553}:"b",\u{1d587}:"b",\u{1d5bb}:"b",\u{1d5ef}:"b",\u{1d623}:"b",\u{1d657}:"b",\u{1d68b}:"b",\u0184:"b",\u042c:"b",\u13cf:"b",\u1472:"b",\u15af:"b",\uff22:"B",\u212c:"B",\u{1d401}:"B",\u{1d435}:"B",\u{1d469}:"B",\u{1d4d1}:"B",\u{1d505}:"B",\u{1d539}:"B",\u{1d56d}:"B",\u{1d5a1}:"B",\u{1d5d5}:"B",\u{1d609}:"B",\u{1d63d}:"B",\u{1d671}:"B",\ua7b4:"B",\u0392:"B",\u{1d6a9}:"B",\u{1d6e3}:"B",\u{1d71d}:"B",\u{1d757}:"B",\u{1d791}:"B",\u0412:"B",\u13f4:"B",\u15f7:"B",\ua4d0:"B",\u{10282}:"B",\u{102a1}:"B",\u{10301}:"B",\u0253:"b\u0314",\u1473:"b\u0307",\u0183:"b\u0304",\u0182:"b\u0304",\u0411:"b\u0304",\u0180:"b\u0335",\u048d:"b\u0335",\u048c:"b\u0335",\u0463:"b\u0335",\u0462:"b\u0335",\u147f:"b\xb7",\u1481:"b\u0307\xb7",\u1488:"b'",\u042b:"bl",\u0432:"\u0299",\u13fc:"\u0299",\uff43:"c",\u217d:"c",\u{1d41c}:"c",\u{1d450}:"c",\u{1d484}:"c",\u{1d4b8}:"c",\u{1d4ec}:"c",\u{1d520}:"c",\u{1d554}:"c",\u{1d588}:"c",\u{1d5bc}:"c",\u{1d5f0}:"c",\u{1d624}:"c",\u{1d658}:"c",\u{1d68c}:"c",\u1d04:"c",\u03f2:"c",\u2ca5:"c",\u0441:"c",\uabaf:"c",\u{1043d}:"c","\u2ded":"\u0368","\u{1f74c}":"C","\u{118f2}":"C","\u{118e9}":"C",\uff23:"C",\u216d:"C",\u2102:"C",\u212d:"C",\u{1d402}:"C",\u{1d436}:"C",\u{1d46a}:"C",\u{1d49e}:"C",\u{1d4d2}:"C",\u{1d56e}:"C",\u{1d5a2}:"C",\u{1d5d6}:"C",\u{1d60a}:"C",\u{1d63e}:"C",\u{1d672}:"C",\u03f9:"C",\u2ca4:"C",\u0421:"C",\u13df:"C",\ua4da:"C",\u{102a2}:"C",\u{10302}:"C",\u{10415}:"C",\u{1051c}:"C","\xa2":"c\u0338",\u023c:"c\u0338","\u20a1":"C\u20eb","\u{1f16e}":"C\u20e0",\u00e7:"c\u0326",\u04ab:"c\u0326",\u00c7:"C\u0326",\u04aa:"C\u0326",\u0187:"C'","\u2105":"c/o","\u2106":"c/u","\u{1f16d}":"\u33c4\t\u20dd","\u22f4":"\ua793",\u025b:"\ua793",\u03b5:"\ua793",\u03f5:"\ua793",\u{1d6c6}:"\ua793",\u{1d6dc}:"\ua793",\u{1d700}:"\ua793",\u{1d716}:"\ua793",\u{1d73a}:"\ua793",\u{1d750}:"\ua793",\u{1d774}:"\ua793",\u{1d78a}:"\ua793",\u{1d7ae}:"\ua793",\u{1d7c4}:"\ua793",\u2c89:"\ua793",\u0454:"\ua793",\u0511:"\ua793",\uab9b:"\ua793",\u{118ce}:"\ua793",\u{10429}:"\ua793","\u20ac":"\ua792",\u2c88:"\ua792",\u0404:"\ua792","\u2377":"\ua793\u0332",\u037d:"\ua73f",\u03ff:"\ua73e",\u217e:"d",\u2146:"d",\u{1d41d}:"d",\u{1d451}:"d",\u{1d485}:"d",\u{1d4b9}:"d",\u{1d4ed}:"d",\u{1d521}:"d",\u{1d555}:"d",\u{1d589}:"d",\u{1d5bd}:"d",\u{1d5f1}:"d",\u{1d625}:"d",\u{1d659}:"d",\u{1d68d}:"d",\u0501:"d",\u13e7:"d",\u146f:"d",\ua4d2:"d",\u216e:"D",\u2145:"D",\u{1d403}:"D",\u{1d437}:"D",\u{1d46b}:"D",\u{1d49f}:"D",\u{1d4d3}:"D",\u{1d507}:"D",\u{1d53b}:"D",\u{1d56f}:"D",\u{1d5a3}:"D",\u{1d5d7}:"D",\u{1d60b}:"D",\u{1d63f}:"D",\u{1d673}:"D",\u13a0:"D",\u15de:"D",\u15ea:"D",\ua4d3:"D",\u0257:"d\u0314",\u0256:"d\u0328",\u018c:"d\u0304",\u0111:"d\u0335",\u0110:"D\u0335",\u00d0:"D\u0335",\u0189:"D\u0335","\u20ab":"d\u0335\u0331",\ua77a:"\ua779",\u147b:"d\xb7",\u1487:"d'",\u02a4:"d\u021d",\u01f3:"dz",\u02a3:"dz",\u01f2:"Dz",\u01f1:"DZ",\u01c6:"d\u017e",\u01c5:"D\u017e",\u01c4:"D\u017d",\u02a5:"d\u0291",\uab70:"\u1d05","\u2e39":"\u1e9f",\u03b4:"\u1e9f",\u{1d6c5}:"\u1e9f",\u{1d6ff}:"\u1e9f",\u{1d739}:"\u1e9f",\u{1d773}:"\u1e9f",\u{1d7ad}:"\u1e9f",\u056e:"\u1e9f",\u1577:"\u1e9f",\u212e:"e",\uff45:"e",\u212f:"e",\u2147:"e",\u{1d41e}:"e",\u{1d452}:"e",\u{1d486}:"e",\u{1d4ee}:"e",\u{1d522}:"e",\u{1d556}:"e",\u{1d58a}:"e",\u{1d5be}:"e",\u{1d5f2}:"e",\u{1d626}:"e",\u{1d65a}:"e",\u{1d68e}:"e",\uab32:"e",\u0435:"e",\u04bd:"e","\u2df7":"\u0364","\u22ff":"E",\uff25:"E",\u2130:"E",\u{1d404}:"E",\u{1d438}:"E",\u{1d46c}:"E",\u{1d4d4}:"E",\u{1d508}:"E",\u{1d53c}:"E",\u{1d570}:"E",\u{1d5a4}:"E",\u{1d5d8}:"E",\u{1d60c}:"E",\u{1d640}:"E",\u{1d674}:"E",\u0395:"E",\u{1d6ac}:"E",\u{1d6e6}:"E",\u{1d720}:"E",\u{1d75a}:"E",\u{1d794}:"E",\u0415:"E",\u2d39:"E",\u13ac:"E",\ua4f0:"E",\u{118a6}:"E",\u{118ae}:"E",\u{10286}:"E",\u011b:"\u0115",\u011a:"\u0114",\u0247:"e\u0338",\u0246:"E\u0338",\u04bf:"e\u0328",\uab7c:"\u1d07",\u0259:"\u01dd",\u04d9:"\u01dd","\u2203":"\u018e",\u2d3a:"\u018e",\ua4f1:"\u018e",\u025a:"\u01dd\u02de",\u1d14:"\u01ddo",\uab41:"\u01ddo\u0338",\uab42:"\u01ddo\u0335",\u04d8:"\u018f","\u{1d221}":"\u0190",\u2107:"\u0190",\u0510:"\u0190",\u13cb:"\u0190",\u{16f2d}:"\u0190",\u{10401}:"\u0190",\u1d9f:"\u1d4b",\u1d08:"\u025c",\u0437:"\u025c",\u0499:"\u025c\u0326",\u{10442}:"\u025e",\ua79d:"\u029a",\u{1042a}:"\u029a",\u{1d41f}:"f",\u{1d453}:"f",\u{1d487}:"f",\u{1d4bb}:"f",\u{1d4ef}:"f",\u{1d523}:"f",\u{1d557}:"f",\u{1d58b}:"f",\u{1d5bf}:"f",\u{1d5f3}:"f",\u{1d627}:"f",\u{1d65b}:"f",\u{1d68f}:"f",\uab35:"f",\ua799:"f",\u017f:"f",\u1e9d:"f",\u0584:"f","\u{1d213}":"F",\u2131:"F",\u{1d405}:"F",\u{1d439}:"F",\u{1d46d}:"F",\u{1d4d5}:"F",\u{1d509}:"F",\u{1d53d}:"F",\u{1d571}:"F",\u{1d5a5}:"F",\u{1d5d9}:"F",\u{1d60d}:"F",\u{1d641}:"F",\u{1d675}:"F",\ua798:"F",\u03dc:"F",\u{1d7ca}:"F",\u15b4:"F",\ua4dd:"F",\u{118c2}:"F",\u{118a2}:"F",\u{10287}:"F",\u{102a5}:"F",\u{10525}:"F",\u0192:"f\u0326",\u0191:"F\u0326",\u1d6e:"f\u0334","\u213b":"FAX",\ufb00:"ff",\ufb03:"ffi",\ufb04:"ffl",\ufb01:"fi",\ufb02:"fl",\u02a9:"f\u014b",\u15b5:"\u2132",\ua4de:"\u2132","\u{1d230}":"\ua7fb",\u15b7:"\ua7fb",\uff47:"g",\u210a:"g",\u{1d420}:"g",\u{1d454}:"g",\u{1d488}:"g",\u{1d4f0}:"g",\u{1d524}:"g",\u{1d558}:"g",\u{1d58c}:"g",\u{1d5c0}:"g",\u{1d5f4}:"g",\u{1d628}:"g",\u{1d65c}:"g",\u{1d690}:"g",\u0261:"g",\u1d83:"g",\u018d:"g",\u0581:"g",\u{1d406}:"G",\u{1d43a}:"G",\u{1d46e}:"G",\u{1d4a2}:"G",\u{1d4d6}:"G",\u{1d50a}:"G",\u{1d53e}:"G",\u{1d572}:"G",\u{1d5a6}:"G",\u{1d5da}:"G",\u{1d60e}:"G",\u{1d642}:"G",\u{1d676}:"G",\u050c:"G",\u13c0:"G",\u13f3:"G",\ua4d6:"G",\u1da2:"\u1d4d",\u0260:"g\u0314",\u01e7:"\u011f",\u01e6:"\u011e",\u01f5:"\u0123",\u01e5:"g\u0335",\u01e4:"G\u0335",\u0193:"G'",\u050d:"\u0262",\uab90:"\u0262",\u13fb:"\u0262",\uff48:"h",\u210e:"h",\u{1d421}:"h",\u{1d489}:"h",\u{1d4bd}:"h",\u{1d4f1}:"h",\u{1d525}:"h",\u{1d559}:"h",\u{1d58d}:"h",\u{1d5c1}:"h",\u{1d5f5}:"h",\u{1d629}:"h",\u{1d65d}:"h",\u{1d691}:"h",\u04bb:"h",\u0570:"h",\u13c2:"h",\uff28:"H",\u210b:"H",\u210c:"H",\u210d:"H",\u{1d407}:"H",\u{1d43b}:"H",\u{1d46f}:"H",\u{1d4d7}:"H",\u{1d573}:"H",\u{1d5a7}:"H",\u{1d5db}:"H",\u{1d60f}:"H",\u{1d643}:"H",\u{1d677}:"H",\u0397:"H",\u{1d6ae}:"H",\u{1d6e8}:"H",\u{1d722}:"H",\u{1d75c}:"H",\u{1d796}:"H",\u2c8e:"H",\u041d:"H",\u13bb:"H",\u157c:"H",\ua4e7:"H",\u{102cf}:"H",\u1d78:"\u1d34",\u0266:"h\u0314",\ua695:"h\u0314",\u13f2:"h\u0314",\u2c67:"H\u0329",\u04a2:"H\u0329",\u0127:"h\u0335",\u210f:"h\u0335",\u045b:"h\u0335",\u0126:"H\u0335",\u04c9:"H\u0326",\u04c7:"H\u0326",\u043d:"\u029c",\uab8b:"\u029c",\u04a3:"\u029c\u0329",\u04ca:"\u029c\u0326",\u04c8:"\u029c\u0326",\u050a:"\u01f6",\uab80:"\u2c76",\u0370:"\u2c75",\u13a8:"\u2c75",\u13b0:"\u2c75",\ua6b1:"\u2c75",\ua795:"\ua727","\u02db":"i","\u2373":"i",\uff49:"i",\u2170:"i",\u2139:"i",\u2148:"i",\u{1d422}:"i",\u{1d456}:"i",\u{1d48a}:"i",\u{1d4be}:"i",\u{1d4f2}:"i",\u{1d526}:"i",\u{1d55a}:"i",\u{1d58e}:"i",\u{1d5c2}:"i",\u{1d5f6}:"i",\u{1d62a}:"i",\u{1d65e}:"i",\u{1d692}:"i",\u0131:"i",\u{1d6a4}:"i",\u026a:"i",\u0269:"i",\u03b9:"i",\u1fbe:"i",\u037a:"i",\u{1d6ca}:"i",\u{1d704}:"i",\u{1d73e}:"i",\u{1d778}:"i",\u{1d7b2}:"i",\u0456:"i",\ua647:"i",\u04cf:"i",\uab75:"i",\u13a5:"i",\u{118c3}:"i","\u24db":"\u24be","\u2378":"i\u0332",\u01d0:"\u012d",\u01cf:"\u012c",\u0268:"i\u0335",\u1d7b:"i\u0335",\u1d7c:"i\u0335",\u2171:"ii",\u2172:"iii",\u0133:"ij",\u2173:"iv",\u2178:"ix",\uff4a:"j",\u2149:"j",\u{1d423}:"j",\u{1d457}:"j",\u{1d48b}:"j",\u{1d4bf}:"j",\u{1d4f3}:"j",\u{1d527}:"j",\u{1d55b}:"j",\u{1d58f}:"j",\u{1d5c3}:"j",\u{1d5f7}:"j",\u{1d62b}:"j",\u{1d65f}:"j",\u{1d693}:"j",\u03f3:"j",\u0458:"j",\uff2a:"J",\u{1d409}:"J",\u{1d43d}:"J",\u{1d471}:"J",\u{1d4a5}:"J",\u{1d4d9}:"J",\u{1d50d}:"J",\u{1d541}:"J",\u{1d575}:"J",\u{1d5a9}:"J",\u{1d5dd}:"J",\u{1d611}:"J",\u{1d645}:"J",\u{1d679}:"J",\ua7b2:"J",\u037f:"J",\u0408:"J",\u13ab:"J",\u148d:"J",\ua4d9:"J",\u0249:"j\u0335",\u0248:"J\u0335",\u1499:"J\xb7",\u{1d6a5}:"\u0237",\u0575:"\u0237",\uab7b:"\u1d0a",\u{1d424}:"k",\u{1d458}:"k",\u{1d48c}:"k",\u{1d4c0}:"k",\u{1d4f4}:"k",\u{1d528}:"k",\u{1d55c}:"k",\u{1d590}:"k",\u{1d5c4}:"k",\u{1d5f8}:"k",\u{1d62c}:"k",\u{1d660}:"k",\u{1d694}:"k",\u212a:"K",\uff2b:"K",\u{1d40a}:"K",\u{1d43e}:"K",\u{1d472}:"K",\u{1d4a6}:"K",\u{1d4da}:"K",\u{1d50e}:"K",\u{1d542}:"K",\u{1d576}:"K",\u{1d5aa}:"K",\u{1d5de}:"K",\u{1d612}:"K",\u{1d646}:"K",\u{1d67a}:"K",\u039a:"K",\u{1d6b1}:"K",\u{1d6eb}:"K",\u{1d725}:"K",\u{1d75f}:"K",\u{1d799}:"K",\u2c94:"K",\u041a:"K",\u13e6:"K",\u16d5:"K",\ua4d7:"K",\u{10518}:"K",\u0199:"k\u0314",\u2c69:"K\u0329",\u049a:"K\u0329","\u20ad":"K\u0335",\ua740:"K\u0335",\u049e:"K\u0335",\u0198:"K'","\u05c0":"l","|":"l","\u2223":"l","\u23fd":"l","\uffe8":"l","\u0661":"l","\u06f1":"l","\u{10320}":"l","\u{1e8c7}":"l","\u{1d7cf}":"l","\u{1d7d9}":"l","\u{1d7e3}":"l","\u{1d7ed}":"l","\u{1d7f7}":"l","\u{1fbf1}":"l",I:"l",\uff29:"l",\u2160:"l",\u2110:"l",\u2111:"l",\u{1d408}:"l",\u{1d43c}:"l",\u{1d470}:"l",\u{1d4d8}:"l",\u{1d540}:"l",\u{1d574}:"l",\u{1d5a8}:"l",\u{1d5dc}:"l",\u{1d610}:"l",\u{1d644}:"l",\u{1d678}:"l",\u0196:"l",\uff4c:"l",\u217c:"l",\u2113:"l",\u{1d425}:"l",\u{1d459}:"l",\u{1d48d}:"l",\u{1d4c1}:"l",\u{1d4f5}:"l",\u{1d529}:"l",\u{1d55d}:"l",\u{1d591}:"l",\u{1d5c5}:"l",\u{1d5f9}:"l",\u{1d62d}:"l",\u{1d661}:"l",\u{1d695}:"l",\u01c0:"l",\u0399:"l",\u{1d6b0}:"l",\u{1d6ea}:"l",\u{1d724}:"l",\u{1d75e}:"l",\u{1d798}:"l",\u2c92:"l",\u0406:"l",\u04c0:"l",\u05d5:"l",\u05df:"l",\u0627:"l",\u{1ee00}:"l",\u{1ee80}:"l",\ufe8e:"l",\ufe8d:"l",\u07ca:"l",\u2d4f:"l",\u16c1:"l",\ua4f2:"l",\u{16f28}:"l",\u{1028a}:"l",\u{10309}:"l","\u{1d22a}":"L",\u216c:"L",\u2112:"L",\u{1d40b}:"L",\u{1d43f}:"L",\u{1d473}:"L",\u{1d4db}:"L",\u{1d50f}:"L",\u{1d543}:"L",\u{1d577}:"L",\u{1d5ab}:"L",\u{1d5df}:"L",\u{1d613}:"L",\u{1d647}:"L",\u{1d67b}:"L",\u2cd0:"L",\u13de:"L",\u14aa:"L",\ua4e1:"L",\u{16f16}:"L",\u{118a3}:"L",\u{118b2}:"L",\u{1041b}:"L",\u{10526}:"L",\ufd3c:"l\u030b",\ufd3d:"l\u030b",\u0142:"l\u0338",\u0141:"L\u0338",\u026d:"l\u0328",\u0197:"l\u0335",\u019a:"l\u0335",\u026b:"l\u0334",\u0625:"l\u0655",\ufe88:"l\u0655",\ufe87:"l\u0655",\u0673:"l\u0655",\u0140:"l\xb7",\u013f:"l\xb7",\u14b7:"l\xb7","\u{1f102}":"l,","\u2488":"l.",\u05f1:"l'","\u2493":"l2.","\u33eb":"l2\u65e5","\u32cb":"l2\u6708","\u3364":"l2\u70b9","\u2494":"l3.","\u33ec":"l3\u65e5","\u3365":"l3\u70b9","\u2495":"l4.","\u33ed":"l4\u65e5","\u3366":"l4\u70b9","\u2496":"l5.","\u33ee":"l5\u65e5","\u3367":"l5\u70b9","\u2497":"l6.","\u33ef":"l6\u65e5","\u3368":"l6\u70b9","\u2498":"l7.","\u33f0":"l7\u65e5","\u3369":"l7\u70b9","\u2499":"l8.","\u33f1":"l8\u65e5","\u336a":"l8\u70b9","\u249a":"l9.","\u33f2":"l9\u65e5","\u336b":"l9\u70b9",\u01c9:"lj",\u0132:"lJ",\u01c8:"Lj",\u01c7:"LJ","\u2016":"ll","\u2225":"ll",\u2161:"ll",\u01c1:"ll",\u05f0:"ll","\u{10199}":"l\u0335l\u0335","\u2492":"ll.",\u2162:"lll","\u{10198}":"l\u0335l\u0335S\u0335","\u33ea":"ll\u65e5","\u32ca":"ll\u6708","\u3363":"ll\u70b9",\u042e:"lO","\u2491":"lO.","\u33e9":"lO\u65e5","\u32c9":"lO\u6708","\u3362":"lO\u70b9",\u02aa:"ls","\u20b6":"lt",\u2163:"lV",\u2168:"lX",\u026e:"l\u021d",\u02ab:"lz",\u0623:"l\u0674",\ufe84:"l\u0674",\ufe83:"l\u0674",\u0672:"l\u0674",\u0675:"l\u0674",\ufdf3:"l\u0643\u0628\u0631",\ufdf2:"l\u0644\u0644\u0651\u0670o","\u33e0":"l\u65e5","\u32c0":"l\u6708","\u3359":"l\u70b9",\u2cd1:"\u029f",\uabae:"\u029f",\u{10443}:"\u029f",\uff2d:"M",\u216f:"M",\u2133:"M",\u{1d40c}:"M",\u{1d440}:"M",\u{1d474}:"M",\u{1d4dc}:"M",\u{1d510}:"M",\u{1d544}:"M",\u{1d578}:"M",\u{1d5ac}:"M",\u{1d5e0}:"M",\u{1d614}:"M",\u{1d648}:"M",\u{1d67c}:"M",\u039c:"M",\u{1d6b3}:"M",\u{1d6ed}:"M",\u{1d727}:"M",\u{1d761}:"M",\u{1d79b}:"M",\u03fa:"M",\u2c98:"M",\u041c:"M",\u13b7:"M",\u15f0:"M",\u16d6:"M",\ua4df:"M",\u{102b0}:"M",\u{10311}:"M",\u04cd:"M\u0326","\u{1f76b}":"MB","\u2de8":"\u1ddf",\u{1d427}:"n",\u{1d45b}:"n",\u{1d48f}:"n",\u{1d4c3}:"n",\u{1d4f7}:"n",\u{1d52b}:"n",\u{1d55f}:"n",\u{1d593}:"n",\u{1d5c7}:"n",\u{1d5fb}:"n",\u{1d62f}:"n",\u{1d663}:"n",\u{1d697}:"n",\u0578:"n",\u057c:"n",\uff2e:"N",\u2115:"N",\u{1d40d}:"N",\u{1d441}:"N",\u{1d475}:"N",\u{1d4a9}:"N",\u{1d4dd}:"N",\u{1d511}:"N",\u{1d579}:"N",\u{1d5ad}:"N",\u{1d5e1}:"N",\u{1d615}:"N",\u{1d649}:"N",\u{1d67d}:"N",\u039d:"N",\u{1d6b4}:"N",\u{1d6ee}:"N",\u{1d728}:"N",\u{1d762}:"N",\u{1d79c}:"N",\u2c9a:"N",\ua4e0:"N",\u{10513}:"N","\u{1018e}":"N\u030a",\u0273:"n\u0328",\u019e:"n\u0329",\u03b7:"n\u0329",\u{1d6c8}:"n\u0329",\u{1d702}:"n\u0329",\u{1d73c}:"n\u0329",\u{1d776}:"n\u0329",\u{1d7b0}:"n\u0329",\u019d:"N\u0326",\u1d70:"n\u0334",\u01cc:"nj",\u01cb:"Nj",\u01ca:"NJ","\u2116":"No",\u0377:"\u1d0e",\u0438:"\u1d0e",\u{1044d}:"\u1d0e",\u0146:"\u0272","\u0c02":"o","\u0c82":"o","\u0d02":"o","\u0d82":"o","\u0966":"o","\u0a66":"o","\u0ae6":"o","\u0be6":"o","\u0c66":"o","\u0ce6":"o","\u0d66":"o","\u0e50":"o","\u0ed0":"o","\u1040":"o","\u0665":"o","\u06f5":"o",\uff4f:"o",\u2134:"o",\u{1d428}:"o",\u{1d45c}:"o",\u{1d490}:"o",\u{1d4f8}:"o",\u{1d52c}:"o",\u{1d560}:"o",\u{1d594}:"o",\u{1d5c8}:"o",\u{1d5fc}:"o",\u{1d630}:"o",\u{1d664}:"o",\u{1d698}:"o",\u1d0f:"o",\u1d11:"o",\uab3d:"o",\u03bf:"o",\u{1d6d0}:"o",\u{1d70a}:"o",\u{1d744}:"o",\u{1d77e}:"o",\u{1d7b8}:"o",\u03c3:"o",\u{1d6d4}:"o",\u{1d70e}:"o",\u{1d748}:"o",\u{1d782}:"o",\u{1d7bc}:"o",\u2c9f:"o",\u043e:"o",\u10ff:"o",\u0585:"o",\u05e1:"o",\u0647:"o",\u{1ee24}:"o",\u{1ee64}:"o",\u{1ee84}:"o",\ufeeb:"o",\ufeec:"o",\ufeea:"o",\ufee9:"o",\u06be:"o",\ufbac:"o",\ufbad:"o",\ufbab:"o",\ufbaa:"o",\u06c1:"o",\ufba8:"o",\ufba9:"o",\ufba7:"o",\ufba6:"o",\u06d5:"o",\u0d20:"o",\u101d:"o","\u{104ea}":"o",\u{118c8}:"o",\u{118d7}:"o",\u{1042c}:"o","\u07c0":"O","\u09e6":"O","\u0b66":"O",\u3007:"O","\u{114d0}":"O","\u{118e0}":"O","\u{1d7ce}":"O","\u{1d7d8}":"O","\u{1d7e2}":"O","\u{1d7ec}":"O","\u{1d7f6}":"O","\u{1fbf0}":"O",\uff2f:"O",\u{1d40e}:"O",\u{1d442}:"O",\u{1d476}:"O",\u{1d4aa}:"O",\u{1d4de}:"O",\u{1d512}:"O",\u{1d546}:"O",\u{1d57a}:"O",\u{1d5ae}:"O",\u{1d5e2}:"O",\u{1d616}:"O",\u{1d64a}:"O",\u{1d67e}:"O",\u039f:"O",\u{1d6b6}:"O",\u{1d6f0}:"O",\u{1d72a}:"O",\u{1d764}:"O",\u{1d79e}:"O",\u2c9e:"O",\u041e:"O",\u0555:"O",\u2d54:"O",\u12d0:"O",\u0b20:"O","\u{104c2}":"O",\ua4f3:"O",\u{118b5}:"O",\u{10292}:"O",\u{102ab}:"O",\u{10404}:"O",\u{10516}:"O","\u2070":"\xba",\u1d52:"\xba",\u01d2:"\u014f",\u01d1:"\u014e",\u06ff:"o\u0302",\u0150:"\xd6",\u00f8:"o\u0338",\uab3e:"o\u0338",\u00d8:"O\u0338",\u2d41:"O\u0338",\u01fe:"O\u0338\u0301",\u0275:"o\u0335",\ua74b:"o\u0335",\u04e9:"o\u0335",\u0473:"o\u0335",\uab8e:"o\u0335",\uabbb:"o\u0335","\u2296":"O\u0335","\u229d":"O\u0335","\u236c":"O\u0335","\u{1d21a}":"O\u0335","\u{1f714}":"O\u0335",\u019f:"O\u0335",\ua74a:"O\u0335",\u03b8:"O\u0335",\u03d1:"O\u0335",\u{1d6c9}:"O\u0335",\u{1d6dd}:"O\u0335",\u{1d703}:"O\u0335",\u{1d717}:"O\u0335",\u{1d73d}:"O\u0335",\u{1d751}:"O\u0335",\u{1d777}:"O\u0335",\u{1d78b}:"O\u0335",\u{1d7b1}:"O\u0335",\u{1d7c5}:"O\u0335",\u0398:"O\u0335",\u03f4:"O\u0335",\u{1d6af}:"O\u0335",\u{1d6b9}:"O\u0335",\u{1d6e9}:"O\u0335",\u{1d6f3}:"O\u0335",\u{1d723}:"O\u0335",\u{1d72d}:"O\u0335",\u{1d75d}:"O\u0335",\u{1d767}:"O\u0335",\u{1d797}:"O\u0335",\u{1d7a1}:"O\u0335",\u04e8:"O\u0335",\u0472:"O\u0335",\u2d31:"O\u0335",\u13be:"O\u0335",\u13eb:"O\u0335",\uab74:"o\u031b",\ufcd9:"o\u0670","\u{1f101}":"O,","\u{1f100}":"O.",\u01a1:"o'",\u01a0:"O'",\u13a4:"O'","%":"\xba/\u2080","\u066a":"\xba/\u2080","\u2052":"\xba/\u2080","\u2030":"\xba/\u2080\u2080","\u0609":"\xba/\u2080\u2080","\u2031":"\xba/\u2080\u2080\u2080","\u060a":"\xba/\u2080\u2080\u2080",\u0153:"oe",\u0152:"OE",\u0276:"o\u1d07","\u221e":"oo",\ua74f:"oo",\ua699:"oo",\ua74e:"OO",\ua698:"OO",\ufcd7:"o\u062c",\ufc51:"o\u062c",\ufcd8:"o\u0645",\ufc52:"o\u0645",\ufd93:"o\u0645\u062c",\ufd94:"o\u0645\u0645",\ufc53:"o\u0649",\ufc54:"o\u0649",\u0d5f:"o\u0d30o",\u1010:"o\u102c","\u3358":"O\u70b9",\u2184:"\u0254",\u1d10:"\u0254",\u037b:"\u0254",\u{1044b}:"\u0254",\u2183:"\u0186",\u03fd:"\u0186",\ua4db:"\u0186",\u{10423}:"\u0186",\uab3f:"\u0254\u0338",\uab62:"\u0254e",\u{1043f}:"\u0277","\u2374":"p",\uff50:"p",\u{1d429}:"p",\u{1d45d}:"p",\u{1d491}:"p",\u{1d4c5}:"p",\u{1d4f9}:"p",\u{1d52d}:"p",\u{1d561}:"p",\u{1d595}:"p",\u{1d5c9}:"p",\u{1d5fd}:"p",\u{1d631}:"p",\u{1d665}:"p",\u{1d699}:"p",\u03c1:"p",\u03f1:"p",\u{1d6d2}:"p",\u{1d6e0}:"p",\u{1d70c}:"p",\u{1d71a}:"p",\u{1d746}:"p",\u{1d754}:"p",\u{1d780}:"p",\u{1d78e}:"p",\u{1d7ba}:"p",\u{1d7c8}:"p",\u2ca3:"p",\u0440:"p",\uff30:"P",\u2119:"P",\u{1d40f}:"P",\u{1d443}:"P",\u{1d477}:"P",\u{1d4ab}:"P",\u{1d4df}:"P",\u{1d513}:"P",\u{1d57b}:"P",\u{1d5af}:"P",\u{1d5e3}:"P",\u{1d617}:"P",\u{1d64b}:"P",\u{1d67f}:"P",\u03a1:"P",\u{1d6b8}:"P",\u{1d6f2}:"P",\u{1d72c}:"P",\u{1d766}:"P",\u{1d7a0}:"P",\u2ca2:"P",\u0420:"P",\u13e2:"P",\u146d:"P",\ua4d1:"P",\u{10295}:"P",\u01a5:"p\u0314",\u1d7d:"p\u0335",\u1477:"p\xb7",\u1486:"P'",\u1d29:"\u1d18",\uabb2:"\u1d18",\u03c6:"\u0278",\u03d5:"\u0278",\u{1d6d7}:"\u0278",\u{1d6df}:"\u0278",\u{1d711}:"\u0278",\u{1d719}:"\u0278",\u{1d74b}:"\u0278",\u{1d753}:"\u0278",\u{1d785}:"\u0278",\u{1d78d}:"\u0278",\u{1d7bf}:"\u0278",\u{1d7c7}:"\u0278",\u2cab:"\u0278",\u0444:"\u0278",\u{1d42a}:"q",\u{1d45e}:"q",\u{1d492}:"q",\u{1d4c6}:"q",\u{1d4fa}:"q",\u{1d52e}:"q",\u{1d562}:"q",\u{1d596}:"q",\u{1d5ca}:"q",\u{1d5fe}:"q",\u{1d632}:"q",\u{1d666}:"q",\u{1d69a}:"q",\u051b:"q",\u0563:"q",\u0566:"q",\u211a:"Q",\u{1d410}:"Q",\u{1d444}:"Q",\u{1d478}:"Q",\u{1d4ac}:"Q",\u{1d4e0}:"Q",\u{1d514}:"Q",\u{1d57c}:"Q",\u{1d5b0}:"Q",\u{1d5e4}:"Q",\u{1d618}:"Q",\u{1d64c}:"Q",\u{1d680}:"Q",\u2d55:"Q",\u02a0:"q\u0314","\u{1f700}":"QE",\u1d90:"\u024b",\u1d0b:"\u0138",\u03ba:"\u0138",\u03f0:"\u0138",\u{1d6cb}:"\u0138",\u{1d6de}:"\u0138",\u{1d705}:"\u0138",\u{1d718}:"\u0138",\u{1d73f}:"\u0138",\u{1d752}:"\u0138",\u{1d779}:"\u0138",\u{1d78c}:"\u0138",\u{1d7b3}:"\u0138",\u{1d7c6}:"\u0138",\u2c95:"\u0138",\u043a:"\u0138",\uabb6:"\u0138",\u049b:"\u0138\u0329",\u049f:"\u0138\u0335",\u{1d42b}:"r",\u{1d45f}:"r",\u{1d493}:"r",\u{1d4c7}:"r",\u{1d4fb}:"r",\u{1d52f}:"r",\u{1d563}:"r",\u{1d597}:"r",\u{1d5cb}:"r",\u{1d5ff}:"r",\u{1d633}:"r",\u{1d667}:"r",\u{1d69b}:"r",\uab47:"r",\uab48:"r",\u1d26:"r",\u2c85:"r",\u0433:"r",\uab81:"r","\u{1d216}":"R",\u211b:"R",\u211c:"R",\u211d:"R",\u{1d411}:"R",\u{1d445}:"R",\u{1d479}:"R",\u{1d4e1}:"R",\u{1d57d}:"R",\u{1d5b1}:"R",\u{1d5e5}:"R",\u{1d619}:"R",\u{1d64d}:"R",\u{1d681}:"R",\u01a6:"R",\u13a1:"R",\u13d2:"R","\u{104b4}":"R",\u1587:"R",\ua4e3:"R",\u{16f35}:"R",\u027d:"r\u0328",\u027c:"r\u0329",\u024d:"r\u0335",\u0493:"r\u0335",\u1d72:"r\u0334",\u0491:"r'","\u{118e3}":"rn",m:"rn",\u217f:"rn",\u{1d426}:"rn",\u{1d45a}:"rn",\u{1d48e}:"rn",\u{1d4c2}:"rn",\u{1d4f6}:"rn",\u{1d52a}:"rn",\u{1d55e}:"rn",\u{1d592}:"rn",\u{1d5c6}:"rn",\u{1d5fa}:"rn",\u{1d62e}:"rn",\u{1d662}:"rn",\u{1d696}:"rn",\u{11700}:"rn","\u20a5":"rn\u0338",\u0271:"rn\u0326",\u1d6f:"rn\u0334","\u20a8":"Rs",\uab71:"\u0280",\uaba2:"\u0280",\u044f:"\u1d19",\u1d73:"\u027e\u0334","\u2129":"\u027f",\uff53:"s",\u{1d42c}:"s",\u{1d460}:"s",\u{1d494}:"s",\u{1d4c8}:"s",\u{1d4fc}:"s",\u{1d530}:"s",\u{1d564}:"s",\u{1d598}:"s",\u{1d5cc}:"s",\u{1d600}:"s",\u{1d634}:"s",\u{1d668}:"s",\u{1d69c}:"s",\ua731:"s",\u01bd:"s",\u0455:"s",\uabaa:"s",\u{118c1}:"s",\u{10448}:"s",\uff33:"S",\u{1d412}:"S",\u{1d446}:"S",\u{1d47a}:"S",\u{1d4ae}:"S",\u{1d4e2}:"S",\u{1d516}:"S",\u{1d54a}:"S",\u{1d57e}:"S",\u{1d5b2}:"S",\u{1d5e6}:"S",\u{1d61a}:"S",\u{1d64e}:"S",\u{1d682}:"S",\u0405:"S",\u054f:"S",\u13d5:"S",\u13da:"S",\ua4e2:"S",\u{16f3a}:"S",\u{10296}:"S",\u{10420}:"S",\u0282:"s\u0328",\u1d74:"s\u0334",\ua7b5:"\xdf",\u03b2:"\xdf",\u03d0:"\xdf",\u{1d6c3}:"\xdf",\u{1d6fd}:"\xdf",\u{1d737}:"\xdf",\u{1d771}:"\xdf",\u{1d7ab}:"\xdf",\u13f0:"\xdf","\u{1f75c}":"sss",\ufb06:"st","\u222b":"\u0283",\uab4d:"\u0283","\u2211":"\u01a9","\u2140":"\u01a9",\u03a3:"\u01a9",\u{1d6ba}:"\u01a9",\u{1d6f4}:"\u01a9",\u{1d72e}:"\u01a9",\u{1d768}:"\u01a9",\u{1d7a2}:"\u01a9",\u2d49:"\u01a9","\u222c":"\u0283\u0283","\u222d":"\u0283\u0283\u0283","\u2a0c":"\u0283\u0283\u0283\u0283",\u{1d42d}:"t",\u{1d461}:"t",\u{1d495}:"t",\u{1d4c9}:"t",\u{1d4fd}:"t",\u{1d531}:"t",\u{1d565}:"t",\u{1d599}:"t",\u{1d5cd}:"t",\u{1d601}:"t",\u{1d635}:"t",\u{1d669}:"t",\u{1d69d}:"t","\u22a4":"T","\u27d9":"T","\u{1f768}":"T",\uff34:"T",\u{1d413}:"T",\u{1d447}:"T",\u{1d47b}:"T",\u{1d4af}:"T",\u{1d4e3}:"T",\u{1d517}:"T",\u{1d54b}:"T",\u{1d57f}:"T",\u{1d5b3}:"T",\u{1d5e7}:"T",\u{1d61b}:"T",\u{1d64f}:"T",\u{1d683}:"T",\u03a4:"T",\u{1d6bb}:"T",\u{1d6f5}:"T",\u{1d72f}:"T",\u{1d769}:"T",\u{1d7a3}:"T",\u2ca6:"T",\u0422:"T",\u13a2:"T",\ua4d4:"T",\u{16f0a}:"T",\u{118bc}:"T",\u{10297}:"T",\u{102b1}:"T",\u{10315}:"T",\u01ad:"t\u0314","\u2361":"T\u0308",\u023e:"T\u0338",\u021a:"\u0162",\u01ae:"T\u0328",\u04ac:"T\u0329","\u20ae":"T\u20eb",\u0167:"t\u0335",\u0166:"T\u0335",\u1d75:"t\u0334",\u10a0:"\ua786",\ua728:"T3",\u02a8:"t\u0255","\u2121":"TEL",\ua777:"tf",\u02a6:"ts",\u02a7:"t\u0283",\ua729:"t\u021d",\u03c4:"\u1d1b",\u{1d6d5}:"\u1d1b",\u{1d70f}:"\u1d1b",\u{1d749}:"\u1d1b",\u{1d783}:"\u1d1b",\u{1d7bd}:"\u1d1b",\u0442:"\u1d1b",\uab72:"\u1d1b",\u04ad:"\u1d1b\u0329",\u0163:"\u01ab",\u021b:"\u01ab",\u13bf:"\u01ab",\u{1d42e}:"u",\u{1d462}:"u",\u{1d496}:"u",\u{1d4ca}:"u",\u{1d4fe}:"u",\u{1d532}:"u",\u{1d566}:"u",\u{1d59a}:"u",\u{1d5ce}:"u",\u{1d602}:"u",\u{1d636}:"u",\u{1d66a}:"u",\u{1d69e}:"u",\ua79f:"u",\u1d1c:"u",\uab4e:"u",\uab52:"u",\u028b:"u",\u03c5:"u",\u{1d6d6}:"u",\u{1d710}:"u",\u{1d74a}:"u",\u{1d784}:"u",\u{1d7be}:"u",\u057d:"u","\u{104f6}":"u",\u{118d8}:"u","\u222a":"U","\u22c3":"U",\u{1d414}:"U",\u{1d448}:"U",\u{1d47c}:"U",\u{1d4b0}:"U",\u{1d4e4}:"U",\u{1d518}:"U",\u{1d54c}:"U",\u{1d580}:"U",\u{1d5b4}:"U",\u{1d5e8}:"U",\u{1d61c}:"U",\u{1d650}:"U",\u{1d684}:"U",\u054d:"U",\u1200:"U","\u{104ce}":"U",\u144c:"U",\ua4f4:"U",\u{16f42}:"U",\u{118b8}:"U",\u01d4:"\u016d",\u01d3:"\u016c",\u1d7e:"u\u0335",\uab9c:"u\u0335",\u0244:"U\u0335",\u13cc:"U\u0335",\u1458:"U\xb7",\u1467:"U'",\u1d6b:"ue",\uab63:"uo",\u1e43:"\uab51",\u057a:"\u0270",\u1223:"\u0270","\u2127":"\u01b1",\u162e:"\u01b1",\u1634:"\u01b1",\u1d7f:"\u028a\u0335","\u2228":"v","\u22c1":"v",\uff56:"v",\u2174:"v",\u{1d42f}:"v",\u{1d463}:"v",\u{1d497}:"v",\u{1d4cb}:"v",\u{1d4ff}:"v",\u{1d533}:"v",\u{1d567}:"v",\u{1d59b}:"v",\u{1d5cf}:"v",\u{1d603}:"v",\u{1d637}:"v",\u{1d66b}:"v",\u{1d69f}:"v",\u1d20:"v",\u03bd:"v",\u{1d6ce}:"v",\u{1d708}:"v",\u{1d742}:"v",\u{1d77c}:"v",\u{1d7b6}:"v",\u0475:"v",\u05d8:"v",\u{11706}:"v",\uaba9:"v",\u{118c0}:"v","\u{1d20d}":"V","\u0667":"V","\u06f7":"V",\u2164:"V",\u{1d415}:"V",\u{1d449}:"V",\u{1d47d}:"V",\u{1d4b1}:"V",\u{1d4e5}:"V",\u{1d519}:"V",\u{1d54d}:"V",\u{1d581}:"V",\u{1d5b5}:"V",\u{1d5e9}:"V",\u{1d61d}:"V",\u{1d651}:"V",\u{1d685}:"V",\u0474:"V",\u2d38:"V",\u13d9:"V",\u142f:"V",\ua6df:"V",\ua4e6:"V",\u{16f08}:"V",\u{118a0}:"V",\u{1051d}:"V","\u{10197}":"V\u0335",\u143b:"V\xb7","\u{1f76c}":"VB",\u2175:"vi",\u2176:"vii",\u2177:"viii",\u2165:"Vl",\u2166:"Vll",\u2167:"Vlll","\u{1f708}":"V\u1de4",\u1d27:"\u028c","\u{104d8}":"\u028c","\u0668":"\u0245","\u06f8":"\u0245",\u039b:"\u0245",\u{1d6b2}:"\u0245",\u{1d6ec}:"\u0245",\u{1d726}:"\u0245",\u{1d760}:"\u0245",\u{1d79a}:"\u0245",\u041b:"\u0245",\u2d37:"\u0245","\u{104b0}":"\u0245",\u1431:"\u0245",\ua6ce:"\u0245",\ua4e5:"\u0245",\u{16f3d}:"\u0245",\u{1028d}:"\u0245",\u04c5:"\u0245\u0326",\u143d:"\u0245\xb7",\u026f:"w",\u{1d430}:"w",\u{1d464}:"w",\u{1d498}:"w",\u{1d4cc}:"w",\u{1d500}:"w",\u{1d534}:"w",\u{1d568}:"w",\u{1d59c}:"w",\u{1d5d0}:"w",\u{1d604}:"w",\u{1d638}:"w",\u{1d66c}:"w",\u{1d6a0}:"w",\u1d21:"w",\u0461:"w",\u051d:"w",\u0561:"w",\u{1170a}:"w",\u{1170e}:"w",\u{1170f}:"w",\uab83:"w","\u{118ef}":"W","\u{118e6}":"W",\u{1d416}:"W",\u{1d44a}:"W",\u{1d47e}:"W",\u{1d4b2}:"W",\u{1d4e6}:"W",\u{1d51a}:"W",\u{1d54e}:"W",\u{1d582}:"W",\u{1d5b6}:"W",\u{1d5ea}:"W",\u{1d61e}:"W",\u{1d652}:"W",\u{1d686}:"W",\u051c:"W",\u13b3:"W",\u13d4:"W",\ua4ea:"W",\u047d:"w\u0486\u0487",\u{114c5}:"w\u0307","\u20a9":"W\u0335",\ua761:"w\u0326",\u1d0d:"\u028d",\u043c:"\u028d",\uab87:"\u028d",\u04ce:"\u028d\u0326","\u166e":"x","\xd7":"x","\u292b":"x","\u292c":"x","\u2a2f":"x",\uff58:"x",\u2179:"x",\u{1d431}:"x",\u{1d465}:"x",\u{1d499}:"x",\u{1d4cd}:"x",\u{1d501}:"x",\u{1d535}:"x",\u{1d569}:"x",\u{1d59d}:"x",\u{1d5d1}:"x",\u{1d605}:"x",\u{1d639}:"x",\u{1d66d}:"x",\u{1d6a1}:"x",\u0445:"x",\u1541:"x",\u157d:"x","\u2def":"\u036f","\u166d":"X","\u2573":"X","\u{10322}":"X","\u{118ec}":"X",\uff38:"X",\u2169:"X",\u{1d417}:"X",\u{1d44b}:"X",\u{1d47f}:"X",\u{1d4b3}:"X",\u{1d4e7}:"X",\u{1d51b}:"X",\u{1d54f}:"X",\u{1d583}:"X",\u{1d5b7}:"X",\u{1d5eb}:"X",\u{1d61f}:"X",\u{1d653}:"X",\u{1d687}:"X",\ua7b3:"X",\u03a7:"X",\u{1d6be}:"X",\u{1d6f8}:"X",\u{1d732}:"X",\u{1d76c}:"X",\u{1d7a6}:"X",\u2cac:"X",\u0425:"X",\u2d5d:"X",\u16b7:"X",\ua4eb:"X",\u{10290}:"X",\u{102b4}:"X",\u{10317}:"X",\u{10527}:"X","\u2a30":"x\u0307",\u04b2:"X\u0329","\u{10196}":"X\u0335",\u217a:"xi",\u217b:"xii",\u216a:"Xl",\u216b:"Xll",\u0263:"y",\u1d8c:"y",\uff59:"y",\u{1d432}:"y",\u{1d466}:"y",\u{1d49a}:"y",\u{1d4ce}:"y",\u{1d502}:"y",\u{1d536}:"y",\u{1d56a}:"y",\u{1d59e}:"y",\u{1d5d2}:"y",\u{1d606}:"y",\u{1d63a}:"y",\u{1d66e}:"y",\u{1d6a2}:"y",\u028f:"y",\u1eff:"y",\uab5a:"y",\u03b3:"y",\u213d:"y",\u{1d6c4}:"y",\u{1d6fe}:"y",\u{1d738}:"y",\u{1d772}:"y",\u{1d7ac}:"y",\u0443:"y",\u04af:"y",\u10e7:"y",\u{118dc}:"y",\uff39:"Y",\u{1d418}:"Y",\u{1d44c}:"Y",\u{1d480}:"Y",\u{1d4b4}:"Y",\u{1d4e8}:"Y",\u{1d51c}:"Y",\u{1d550}:"Y",\u{1d584}:"Y",\u{1d5b8}:"Y",\u{1d5ec}:"Y",\u{1d620}:"Y",\u{1d654}:"Y",\u{1d688}:"Y",\u03a5:"Y",\u03d2:"Y",\u{1d6bc}:"Y",\u{1d6f6}:"Y",\u{1d730}:"Y",\u{1d76a}:"Y",\u{1d7a4}:"Y",\u2ca8:"Y",\u0423:"Y",\u04ae:"Y",\u13a9:"Y",\u13bd:"Y",\ua4ec:"Y",\u{16f43}:"Y",\u{118a4}:"Y",\u{102b2}:"Y",\u01b4:"y\u0314",\u024f:"y\u0335",\u04b1:"y\u0335","\xa5":"Y\u0335",\u024e:"Y\u0335",\u04b0:"Y\u0335",\u0292:"\u021d",\ua76b:"\u021d",\u2ccd:"\u021d",\u04e1:"\u021d",\u10f3:"\u021d",\u{1d433}:"z",\u{1d467}:"z",\u{1d49b}:"z",\u{1d4cf}:"z",\u{1d503}:"z",\u{1d537}:"z",\u{1d56b}:"z",\u{1d59f}:"z",\u{1d5d3}:"z",\u{1d607}:"z",\u{1d63b}:"z",\u{1d66f}:"z",\u{1d6a3}:"z",\u1d22:"z",\uab93:"z",\u{118c4}:"z","\u{102f5}":"Z","\u{118e5}":"Z",\uff3a:"Z",\u2124:"Z",\u2128:"Z",\u{1d419}:"Z",\u{1d44d}:"Z",\u{1d481}:"Z",\u{1d4b5}:"Z",\u{1d4e9}:"Z",\u{1d585}:"Z",\u{1d5b9}:"Z",\u{1d5ed}:"Z",\u{1d621}:"Z",\u{1d655}:"Z",\u{1d689}:"Z",\u0396:"Z",\u{1d6ad}:"Z",\u{1d6e7}:"Z",\u{1d721}:"Z",\u{1d75b}:"Z",\u{1d795}:"Z",\u13c3:"Z",\ua4dc:"Z",\u{118a9}:"Z",\u0290:"z\u0328",\u01b6:"z\u0335",\u01b5:"Z\u0335",\u0225:"z\u0326",\u0224:"Z\u0326",\u1d76:"z\u0334",\u01bf:"\xfe",\u03f8:"\xfe",\u03f7:"\xde","\u{104c4}":"\xde","\u2079":"\ua770",\u1d24:"\u01a8",\u03e9:"\u01a8",\ua645:"\u01a8",\u044c:"\u0185",\uab9f:"\u0185",\u044b:"\u0185i",\uab7e:"\u0242",\u02e4:"\u02c1",\ua6cd:"\u02a1","\u2299":"\u0298","\u2609":"\u0298","\u2a00":"\u0298",\ua668:"\u0298",\u2d59:"\u0298","\u{104c3}":"\u0298",\u213e:"\u0393",\u{1d6aa}:"\u0393",\u{1d6e4}:"\u0393",\u{1d71e}:"\u0393",\u{1d758}:"\u0393",\u{1d792}:"\u0393",\u2c84:"\u0393",\u0413:"\u0393",\u13b1:"\u0393",\u14a5:"\u0393",\u{16f07}:"\u0393",\u0492:"\u0393\u0335",\u14af:"\u0393\xb7",\u0490:"\u0393'","\u2206":"\u0394","\u25b3":"\u0394","\u{1f702}":"\u0394",\u{1d6ab}:"\u0394",\u{1d6e5}:"\u0394",\u{1d71f}:"\u0394",\u{1d759}:"\u0394",\u{1d793}:"\u0394",\u2c86:"\u0394",\u2d60:"\u0394",\u1403:"\u0394",\u{16f1a}:"\u0394",\u{10285}:"\u0394",\u{102a3}:"\u0394","\u2359":"\u0394\u0332",\u140f:"\u0394\xb7",\u142c:"\u0394\u1420",\u{1d7cb}:"\u03dd",\u{1d6c7}:"\u03b6",\u{1d701}:"\u03b6",\u{1d73b}:"\u03b6",\u{1d775}:"\u03b6",\u{1d7af}:"\u03b6",\u2ce4:"\u03d7",\u{1d6cc}:"\u03bb",\u{1d706}:"\u03bb",\u{1d740}:"\u03bb",\u{1d77a}:"\u03bb",\u{1d7b4}:"\u03bb",\u2c96:"\u03bb","\u{104db}":"\u03bb",\u00b5:"\u03bc",\u{1d6cd}:"\u03bc",\u{1d707}:"\u03bc",\u{1d741}:"\u03bc",\u{1d77b}:"\u03bc",\u{1d7b5}:"\u03bc",\u{1d6cf}:"\u03be",\u{1d709}:"\u03be",\u{1d743}:"\u03be",\u{1d77d}:"\u03be",\u{1d7b7}:"\u03be",\u{1d6b5}:"\u039e",\u{1d6ef}:"\u039e",\u{1d729}:"\u039e",\u{1d763}:"\u039e",\u{1d79d}:"\u039e",\u03d6:"\u03c0",\u213c:"\u03c0",\u{1d6d1}:"\u03c0",\u{1d6e1}:"\u03c0",\u{1d70b}:"\u03c0",\u{1d71b}:"\u03c0",\u{1d745}:"\u03c0",\u{1d755}:"\u03c0",\u{1d77f}:"\u03c0",\u{1d78f}:"\u03c0",\u{1d7b9}:"\u03c0",\u{1d7c9}:"\u03c0",\u1d28:"\u03c0",\u043f:"\u03c0","\u220f":"\u03a0",\u213f:"\u03a0",\u{1d6b7}:"\u03a0",\u{1d6f1}:"\u03a0",\u{1d72b}:"\u03a0",\u{1d765}:"\u03a0",\u{1d79f}:"\u03a0",\u2ca0:"\u03a0",\u041f:"\u03a0",\ua6db:"\u03a0",\u{102ad}:"\u03d8",\u{10312}:"\u03d8",\u03db:"\u03c2",\u{1d6d3}:"\u03c2",\u{1d70d}:"\u03c2",\u{1d747}:"\u03c2",\u{1d781}:"\u03c2",\u{1d7bb}:"\u03c2",\u{1d6bd}:"\u03a6",\u{1d6f7}:"\u03a6",\u{1d731}:"\u03a6",\u{1d76b}:"\u03a6",\u{1d7a5}:"\u03a6",\u2caa:"\u03a6",\u0424:"\u03a6",\u0553:"\u03a6",\u1240:"\u03a6",\u16f0:"\u03a6",\u{102b3}:"\u03a6",\uab53:"\u03c7",\uab55:"\u03c7",\u{1d6d8}:"\u03c7",\u{1d712}:"\u03c7",\u{1d74c}:"\u03c7",\u{1d786}:"\u03c7",\u{1d7c0}:"\u03c7",\u2cad:"\u03c7",\u{1d6d9}:"\u03c8",\u{1d713}:"\u03c8",\u{1d74d}:"\u03c8",\u{1d787}:"\u03c8",\u{1d7c1}:"\u03c8",\u0471:"\u03c8","\u{104f9}":"\u03c8",\u{1d6bf}:"\u03a8",\u{1d6f9}:"\u03a8",\u{1d733}:"\u03a8",\u{1d76d}:"\u03a8",\u{1d7a7}:"\u03a8",\u2cae:"\u03a8",\u0470:"\u03a8","\u{104d1}":"\u03a8",\u16d8:"\u03a8",\u{102b5}:"\u03a8","\u2375":"\u03c9",\ua7b7:"\u03c9",\u{1d6da}:"\u03c9",\u{1d714}:"\u03c9",\u{1d74e}:"\u03c9",\u{1d788}:"\u03c9",\u{1d7c2}:"\u03c9",\u2cb1:"\u03c9",\ua64d:"\u03c9",\u2126:"\u03a9",\u{1d6c0}:"\u03a9",\u{1d6fa}:"\u03a9",\u{1d734}:"\u03a9",\u{1d76e}:"\u03a9",\u{1d7a8}:"\u03a9",\u162f:"\u03a9",\u1635:"\u03a9",\u{102b6}:"\u03a9","\u2379":"\u03c9\u0332",\u1f7d:"\u1ff4","\u2630":"\u2cb6",\u2cdc:"\u03ec",\u0497:"\u0436\u0329",\u0496:"\u0416\u0329","\u{1d20b}":"\u0418",\u0376:"\u0418",\ua6a1:"\u0418",\u{10425}:"\u0418",\u0419:"\u040d",\u048a:"\u040d\u0326",\u045d:"\u0439",\u048b:"\u0439\u0326","\u{104bc}":"\u04c3",\u1d2b:"\u043b",\u04c6:"\u043b\u0326",\uab60:"\u0459","\u{104eb}":"\ua669","\u1dee":"\u2dec","\u{104cd}":"\u040b","\u{1d202}":"\u04fe","\u{1d222}":"\u0460",\u13c7:"\u0460",\u15ef:"\u0460",\u047c:"\u0460\u0486\u0487",\u18ed:"\u0460\xb7",\ua7b6:"\ua64c",\u04cc:"\u04b7",\u04cb:"\u04b6",\u04be:"\u04bc\u0328",\u2cbd:"\u0448",\u2cbc:"\u0428",\ua650:"\u042al","\u2108":"\u042d","\u{1f701}":"\ua658",\u{16f1c}:"\ua658",\ua992:"\u2c3f",\u0587:"\u0565\u0582",\u1294:"\u0571",\ufb14:"\u0574\u0565",\ufb15:"\u0574\u056b",\ufb17:"\u0574\u056d",\ufb13:"\u0574\u0576","\u2229":"\u0548","\u22c2":"\u0548","\u{1d245}":"\u0548",\u1260:"\u0548",\u144e:"\u0548",\ua4f5:"\u0548",\u145a:"\u0548\xb7",\u1468:"\u0548'",\ufb16:"\u057e\u0576","\u20bd":"\u0554","\u02d3":"\u0559",\u02bf:"\u0559",\u2135:"\u05d0",\ufb21:"\u05d0",\ufb2f:"\ufb2e",\ufb30:"\ufb2e",\ufb4f:"\u05d0\u05dc",\u2136:"\u05d1",\u2137:"\u05d2",\u2138:"\u05d3",\ufb22:"\u05d3",\ufb23:"\u05d4",\ufb39:"\ufb1d",\ufb24:"\u05db",\ufb25:"\u05dc",\ufb26:"\u05dd",\ufb20:"\u05e2",\ufb27:"\u05e8",\ufb2b:"\ufb2a",\ufb49:"\ufb2a",\ufb2d:"\ufb2c",\ufb28:"\u05ea",\ufe80:"\u0621","\u06fd":"\u0621\u0348",\ufe82:"\u0622",\ufe81:"\u0622",\ufb51:"\u0671",\ufb50:"\u0671",\u{1ee01}:"\u0628",\u{1ee21}:"\u0628",\u{1ee61}:"\u0628",\u{1ee81}:"\u0628",\u{1eea1}:"\u0628",\ufe91:"\u0628",\ufe92:"\u0628",\ufe90:"\u0628",\ufe8f:"\u0628",\u0751:"\u0628\u06db","\u08b6":"\u0628\u06e2",\u08a1:"\u0628\u0654",\ufca0:"\u0628o",\ufce2:"\u0628o",\ufc9c:"\u0628\u062c",\ufc05:"\u0628\u062c",\ufc9d:"\u0628\u062d",\ufc06:"\u0628\u062d",\ufdc2:"\u0628\u062d\u0649",\ufc9e:"\u0628\u062e",\ufc07:"\u0628\u062e",\ufcd2:"\u0628\u062e",\ufc4b:"\u0628\u062e",\ufd9e:"\u0628\u062e\u0649",\ufc6a:"\u0628\u0631",\ufc6b:"\u0628\u0632",\ufc9f:"\u0628\u0645",\ufce1:"\u0628\u0645",\ufc6c:"\u0628\u0645",\ufc08:"\u0628\u0645",\ufc6d:"\u0628\u0646",\ufc6e:"\u0628\u0649",\ufc09:"\u0628\u0649",\ufc6f:"\u0628\u0649",\ufc0a:"\u0628\u0649",\ufb54:"\u067b",\ufb55:"\u067b",\ufb53:"\u067b",\ufb52:"\u067b",\u06d0:"\u067b",\ufbe6:"\u067b",\ufbe7:"\u067b",\ufbe5:"\u067b",\ufbe4:"\u067b",\ufb5c:"\u0680",\ufb5d:"\u0680",\ufb5b:"\u0680",\ufb5a:"\u0680",\u08a9:"\u0754",\u0767:"\u0754","\u2365":"\u0629",\u00f6:"\u0629",\ufe94:"\u0629",\ufe93:"\u0629",\u06c3:"\u0629",\u{1ee15}:"\u062a",\u{1ee35}:"\u062a",\u{1ee75}:"\u062a",\u{1ee95}:"\u062a",\u{1eeb5}:"\u062a",\ufe97:"\u062a",\ufe98:"\u062a",\ufe96:"\u062a",\ufe95:"\u062a",\ufca5:"\u062ao",\ufce4:"\u062ao",\ufca1:"\u062a\u062c",\ufc0b:"\u062a\u062c",\ufd50:"\u062a\u062c\u0645",\ufda0:"\u062a\u062c\u0649",\ufd9f:"\u062a\u062c\u0649",\ufca2:"\u062a\u062d",\ufc0c:"\u062a\u062d",\ufd52:"\u062a\u062d\u062c",\ufd51:"\u062a\u062d\u062c",\ufd53:"\u062a\u062d\u0645",\ufca3:"\u062a\u062e",\ufc0d:"\u062a\u062e",\ufd54:"\u062a\u062e\u0645",\ufda2:"\u062a\u062e\u0649",\ufda1:"\u062a\u062e\u0649",\ufc70:"\u062a\u0631",\ufc71:"\u062a\u0632",\ufca4:"\u062a\u0645",\ufce3:"\u062a\u0645",\ufc72:"\u062a\u0645",\ufc0e:"\u062a\u0645",\ufd55:"\u062a\u0645\u062c",\ufd56:"\u062a\u0645\u062d",\ufd57:"\u062a\u0645\u062e",\ufda4:"\u062a\u0645\u0649",\ufda3:"\u062a\u0645\u0649",\ufc73:"\u062a\u0646",\ufc74:"\u062a\u0649",\ufc0f:"\u062a\u0649",\ufc75:"\u062a\u0649",\ufc10:"\u062a\u0649",\ufb60:"\u067a",\ufb61:"\u067a",\ufb5f:"\u067a",\ufb5e:"\u067a",\ufb64:"\u067f",\ufb65:"\u067f",\ufb63:"\u067f",\ufb62:"\u067f",\u{1ee02}:"\u062c",\u{1ee22}:"\u062c",\u{1ee42}:"\u062c",\u{1ee62}:"\u062c",\u{1ee82}:"\u062c",\u{1eea2}:"\u062c",\ufe9f:"\u062c",\ufea0:"\u062c",\ufe9e:"\u062c",\ufe9d:"\u062c",\ufca7:"\u062c\u062d",\ufc15:"\u062c\u062d",\ufda6:"\u062c\u062d\u0649",\ufdbe:"\u062c\u062d\u0649",\ufdfb:"\u062c\u0644 \u062c\u0644l\u0644o",\ufca8:"\u062c\u0645",\ufc16:"\u062c\u0645",\ufd59:"\u062c\u0645\u062d",\ufd58:"\u062c\u0645\u062d",\ufda7:"\u062c\u0645\u0649",\ufda5:"\u062c\u0645\u0649",\ufd1d:"\u062c\u0649",\ufd01:"\u062c\u0649",\ufd1e:"\u062c\u0649",\ufd02:"\u062c\u0649",\ufb78:"\u0683",\ufb79:"\u0683",\ufb77:"\u0683",\ufb76:"\u0683",\ufb74:"\u0684",\ufb75:"\u0684",\ufb73:"\u0684",\ufb72:"\u0684",\ufb7c:"\u0686",\ufb7d:"\u0686",\ufb7b:"\u0686",\ufb7a:"\u0686",\ufb80:"\u0687",\ufb81:"\u0687",\ufb7f:"\u0687",\ufb7e:"\u0687",\u{1ee07}:"\u062d",\u{1ee27}:"\u062d",\u{1ee47}:"\u062d",\u{1ee67}:"\u062d",\u{1ee87}:"\u062d",\u{1eea7}:"\u062d",\ufea3:"\u062d",\ufea4:"\u062d",\ufea2:"\u062d",\ufea1:"\u062d",\u0685:"\u062d\u06db",\u0681:"\u062d\u0654",\u0772:"\u062d\u0654",\ufca9:"\u062d\u062c",\ufc17:"\u062d\u062c",\ufdbf:"\u062d\u062c\u0649",\ufcaa:"\u062d\u0645",\ufc18:"\u062d\u0645",\ufd5b:"\u062d\u0645\u0649",\ufd5a:"\u062d\u0645\u0649",\ufd1b:"\u062d\u0649",\ufcff:"\u062d\u0649",\ufd1c:"\u062d\u0649",\ufd00:"\u062d\u0649",\u{1ee17}:"\u062e",\u{1ee37}:"\u062e",\u{1ee57}:"\u062e",\u{1ee77}:"\u062e",\u{1ee97}:"\u062e",\u{1eeb7}:"\u062e",\ufea7:"\u062e",\ufea8:"\u062e",\ufea6:"\u062e",\ufea5:"\u062e",\ufcab:"\u062e\u062c",\ufc19:"\u062e\u062c",\ufc1a:"\u062e\u062d",\ufcac:"\u062e\u0645",\ufc1b:"\u062e\u0645",\ufd1f:"\u062e\u0649",\ufd03:"\u062e\u0649",\ufd20:"\u062e\u0649",\ufd04:"\u062e\u0649","\u{102e1}":"\u062f",\u{1ee03}:"\u062f",\u{1ee83}:"\u062f",\u{1eea3}:"\u062f",\ufeaa:"\u062f",\ufea9:"\u062f",\u0688:"\u062f\u0615",\ufb89:"\u062f\u0615",\ufb88:"\u062f\u0615",\u068e:"\u062f\u06db",\ufb87:"\u062f\u06db",\ufb86:"\u062f\u06db",\u06ee:"\u062f\u0302",\u08ae:"\u062f\u0324\u0323",\u{1ee18}:"\u0630",\u{1ee98}:"\u0630",\u{1eeb8}:"\u0630",\ufeac:"\u0630",\ufeab:"\u0630",\ufc5b:"\u0630\u0670",\u068b:"\u068a\u0615",\ufb85:"\u068c",\ufb84:"\u068c",\ufb83:"\u068d",\ufb82:"\u068d",\u{1ee13}:"\u0631",\u{1ee93}:"\u0631",\u{1eeb3}:"\u0631",\ufeae:"\u0631",\ufead:"\u0631",\u0691:"\u0631\u0615",\ufb8d:"\u0631\u0615",\ufb8c:"\u0631\u0615",\u0698:"\u0631\u06db",\ufb8b:"\u0631\u06db",\ufb8a:"\u0631\u06db",\u0692:"\u0631\u0306","\u08b9":"\u0631\u0306\u0307",\u06ef:"\u0631\u0302",\u076c:"\u0631\u0654",\ufc5c:"\u0631\u0670",\ufdf6:"\u0631\u0633\u0648\u0644","\ufdfc":"\u0631\u0649l\u0644",\u{1ee06}:"\u0632",\u{1ee86}:"\u0632",\u{1eea6}:"\u0632",\ufeb0:"\u0632",\ufeaf:"\u0632",\u08b2:"\u0632\u0302",\u0771:"\u0697\u0615",\u{1ee0e}:"\u0633",\u{1ee2e}:"\u0633",\u{1ee4e}:"\u0633",\u{1ee6e}:"\u0633",\u{1ee8e}:"\u0633",\u{1eeae}:"\u0633",\ufeb3:"\u0633",\ufeb4:"\u0633",\ufeb2:"\u0633",\ufeb1:"\u0633",\u0634:"\u0633\u06db",\u{1ee14}:"\u0633\u06db",\u{1ee34}:"\u0633\u06db",\u{1ee54}:"\u0633\u06db",\u{1ee74}:"\u0633\u06db",\u{1ee94}:"\u0633\u06db",\u{1eeb4}:"\u0633\u06db",\ufeb7:"\u0633\u06db",\ufeb8:"\u0633\u06db",\ufeb6:"\u0633\u06db",\ufeb5:"\u0633\u06db",\u077e:"\u0633\u0302",\ufd31:"\u0633o",\ufce8:"\u0633o",\ufd32:"\u0633\u06dbo",\ufcea:"\u0633\u06dbo",\ufcad:"\u0633\u062c",\ufd34:"\u0633\u062c",\ufc1c:"\u0633\u062c",\ufd2d:"\u0633\u06db\u062c",\ufd37:"\u0633\u06db\u062c",\ufd25:"\u0633\u06db\u062c",\ufd09:"\u0633\u06db\u062c",\ufd5d:"\u0633\u062c\u062d",\ufd5e:"\u0633\u062c\u0649",\ufd69:"\u0633\u06db\u062c\u0649",\ufcae:"\u0633\u062d",\ufd35:"\u0633\u062d",\ufc1d:"\u0633\u062d",\ufd2e:"\u0633\u06db\u062d",\ufd38:"\u0633\u06db\u062d",\ufd26:"\u0633\u06db\u062d",\ufd0a:"\u0633\u06db\u062d",\ufd5c:"\u0633\u062d\u062c",\ufd68:"\u0633\u06db\u062d\u0645",\ufd67:"\u0633\u06db\u062d\u0645",\ufdaa:"\u0633\u06db\u062d\u0649",\ufcaf:"\u0633\u062e",\ufd36:"\u0633\u062e",\ufc1e:"\u0633\u062e",\ufd2f:"\u0633\u06db\u062e",\ufd39:"\u0633\u06db\u062e",\ufd27:"\u0633\u06db\u062e",\ufd0b:"\u0633\u06db\u062e",\ufda8:"\u0633\u062e\u0649",\ufdc6:"\u0633\u062e\u0649",\ufd2a:"\u0633\u0631",\ufd0e:"\u0633\u0631",\ufd29:"\u0633\u06db\u0631",\ufd0d:"\u0633\u06db\u0631",\ufcb0:"\u0633\u0645",\ufce7:"\u0633\u0645",\ufc1f:"\u0633\u0645",\ufd30:"\u0633\u06db\u0645",\ufce9:"\u0633\u06db\u0645",\ufd28:"\u0633\u06db\u0645",\ufd0c:"\u0633\u06db\u0645",\ufd61:"\u0633\u0645\u062c",\ufd60:"\u0633\u0645\u062d",\ufd5f:"\u0633\u0645\u062d",\ufd6b:"\u0633\u06db\u0645\u062e",\ufd6a:"\u0633\u06db\u0645\u062e",\ufd63:"\u0633\u0645\u0645",\ufd62:"\u0633\u0645\u0645",\ufd6d:"\u0633\u06db\u0645\u0645",\ufd6c:"\u0633\u06db\u0645\u0645",\ufd17:"\u0633\u0649",\ufcfb:"\u0633\u0649",\ufd18:"\u0633\u0649",\ufcfc:"\u0633\u0649",\ufd19:"\u0633\u06db\u0649",\ufcfd:"\u0633\u06db\u0649",\ufd1a:"\u0633\u06db\u0649",\ufcfe:"\u0633\u06db\u0649","\u{102f2}":"\u0635",\u{1ee11}:"\u0635",\u{1ee31}:"\u0635",\u{1ee51}:"\u0635",\u{1ee71}:"\u0635",\u{1ee91}:"\u0635",\u{1eeb1}:"\u0635",\ufebb:"\u0635",\ufebc:"\u0635",\ufeba:"\u0635",\ufeb9:"\u0635",\u069e:"\u0635\u06db",\u08af:"\u0635\u0324\u0323",\ufcb1:"\u0635\u062d",\ufc20:"\u0635\u062d",\ufd65:"\u0635\u062d\u062d",\ufd64:"\u0635\u062d\u062d",\ufda9:"\u0635\u062d\u0649",\ufcb2:"\u0635\u062e",\ufd2b:"\u0635\u0631",\ufd0f:"\u0635\u0631",\ufdf5:"\u0635\u0644\u0639\u0645",\ufdf9:"\u0635\u0644\u0649",\ufdf0:"\u0635\u0644\u0649",\ufdfa:"\u0635\u0644\u0649 l\u0644\u0644o \u0639\u0644\u0649o \u0648\u0633\u0644\u0645",\ufcb3:"\u0635\u0645",\ufc21:"\u0635\u0645",\ufdc5:"\u0635\u0645\u0645",\ufd66:"\u0635\u0645\u0645",\ufd21:"\u0635\u0649",\ufd05:"\u0635\u0649",\ufd22:"\u0635\u0649",\ufd06:"\u0635\u0649",\u{1ee19}:"\u0636",\u{1ee39}:"\u0636",\u{1ee59}:"\u0636",\u{1ee79}:"\u0636",\u{1ee99}:"\u0636",\u{1eeb9}:"\u0636",\ufebf:"\u0636",\ufec0:"\u0636",\ufebe:"\u0636",\ufebd:"\u0636",\ufcb4:"\u0636\u062c",\ufc22:"\u0636\u062c",\ufcb5:"\u0636\u062d",\ufc23:"\u0636\u062d",\ufd6e:"\u0636\u062d\u0649",\ufdab:"\u0636\u062d\u0649",\ufcb6:"\u0636\u062e",\ufc24:"\u0636\u062e",\ufd70:"\u0636\u062e\u0645",\ufd6f:"\u0636\u062e\u0645",\ufd2c:"\u0636\u0631",\ufd10:"\u0636\u0631",\ufcb7:"\u0636\u0645",\ufc25:"\u0636\u0645",\ufd23:"\u0636\u0649",\ufd07:"\u0636\u0649",\ufd24:"\u0636\u0649",\ufd08:"\u0636\u0649","\u{102e8}":"\u0637",\u{1ee08}:"\u0637",\u{1ee68}:"\u0637",\u{1ee88}:"\u0637",\u{1eea8}:"\u0637",\ufec3:"\ufffd\ufffd",\ufec4:"\u0637",\ufec2:"\u0637",\ufec1:"\u0637",\u069f:"\u0637\u06db",\ufcb8:"\u0637\u062d",\ufc26:"\u0637\u062d",\ufd33:"\u0637\u0645",\ufd3a:"\u0637\u0645",\ufc27:"\u0637\u0645",\ufd72:"\u0637\u0645\u062d",\ufd71:"\u0637\u0645\u062d",\ufd73:"\u0637\u0645\u0645",\ufd74:"\u0637\u0645\u0649",\ufd11:"\u0637\u0649",\ufcf5:"\u0637\u0649",\ufd12:"\u0637\u0649",\ufcf6:"\u0637\u0649",\u{1ee1a}:"\u0638",\u{1ee7a}:"\u0638",\u{1ee9a}:"\u0638",\u{1eeba}:"\u0638",\ufec7:"\u0638",\ufec8:"\u0638",\ufec6:"\u0638",\ufec5:"\u0638",\ufcb9:"\u0638\u0645",\ufd3b:"\u0638\u0645",\ufc28:"\u0638\u0645","\u060f":"\u0639",\u{1ee0f}:"\u0639",\u{1ee2f}:"\u0639",\u{1ee4f}:"\u0639",\u{1ee6f}:"\u0639",\u{1ee8f}:"\u0639",\u{1eeaf}:"\u0639",\ufecb:"\u0639",\ufecc:"\u0639",\ufeca:"\u0639",\ufec9:"\u0639",\ufcba:"\u0639\u062c",\ufc29:"\u0639\u062c",\ufdc4:"\u0639\u062c\u0645",\ufd75:"\u0639\u062c\u0645",\ufdf7:"\u0639\u0644\u0649o",\ufcbb:"\u0639\u0645",\ufc2a:"\u0639\u0645",\ufd77:"\u0639\u0645\u0645",\ufd76:"\u0639\u0645\u0645",\ufd78:"\u0639\u0645\u0649",\ufdb6:"\u0639\u0645\u0649",\ufd13:"\u0639\u0649",\ufcf7:"\u0639\u0649",\ufd14:"\u0639\u0649",\ufcf8:"\u0639\u0649",\u{1ee1b}:"\u063a",\u{1ee3b}:"\u063a",\u{1ee5b}:"\u063a",\u{1ee7b}:"\u063a",\u{1ee9b}:"\u063a",\u{1eebb}:"\u063a",\ufecf:"\u063a",\ufed0:"\u063a",\ufece:"\u063a",\ufecd:"\u063a",\ufcbc:"\u063a\u062c",\ufc2b:"\u063a\u062c",\ufcbd:"\u063a\u0645",\ufc2c:"\u063a\u0645",\ufd79:"\u063a\u0645\u0645",\ufd7b:"\u063a\u0645\u0649",\ufd7a:"\u063a\u0645\u0649",\ufd15:"\u063a\u0649",\ufcf9:"\u063a\u0649",\ufd16:"\u063a\u0649",\ufcfa:"\u063a\u0649",\u{1ee10}:"\u0641",\u{1ee30}:"\u0641",\u{1ee70}:"\u0641",\u{1ee90}:"\u0641",\u{1eeb0}:"\u0641",\ufed3:"\u0641",\ufed4:"\u0641",\ufed2:"\u0641",\ufed1:"\u0641",\u06a7:"\u0641",\ufcbe:"\u0641\u062c",\ufc2d:"\u0641\u062c",\ufcbf:"\u0641\u062d",\ufc2e:"\u0641\u062d",\ufcc0:"\u0641\u062e",\ufc2f:"\u0641\u062e",\ufd7d:"\u0641\u062e\u0645",\ufd7c:"\u0641\u062e\u0645",\ufcc1:"\u0641\u0645",\ufc30:"\u0641\u0645",\ufdc1:"\u0641\u0645\u0649",\ufc7c:"\u0641\u0649",\ufc31:"\u0641\u0649",\ufc7d:"\u0641\u0649",\ufc32:"\u0641\u0649",\u{1ee1e}:"\u06a1",\u{1ee7e}:"\u06a1","\u08bb":"\u06a1",\u066f:"\u06a1",\u{1ee1f}:"\u06a1",\u{1ee5f}:"\u06a1","\u08bc":"\u06a1",\u06a4:"\u06a1\u06db",\ufb6c:"\u06a1\u06db",\ufb6d:"\u06a1\u06db",\ufb6b:"\u06a1\u06db",\ufb6a:"\u06a1\u06db",\u06a8:"\u06a1\u06db",\u08a4:"\u06a2\u06db",\ufb70:"\u06a6",\ufb71:"\u06a6",\ufb6f:"\u06a6",\ufb6e:"\u06a6",\u{1ee12}:"\u0642",\u{1ee32}:"\u0642",\u{1ee52}:"\u0642",\u{1ee72}:"\u0642",\u{1ee92}:"\u0642",\u{1eeb2}:"\u0642",\ufed7:"\u0642",\ufed8:"\u0642",\ufed6:"\u0642",\ufed5:"\u0642",\ufcc2:"\u0642\u062d",\ufc33:"\u0642\u062d",\ufdf1:"\u0642\u0644\u0649",\ufcc3:"\u0642\u0645",\ufc34:"\u0642\u0645",\ufdb4:"\u0642\u0645\u062d",\ufd7e:"\u0642\u0645\u062d",\ufd7f:"\u0642\u0645\u0645",\ufdb2:"\u0642\u0645\u0649",\ufc7e:"\u0642\u0649",\ufc35:"\u0642\u0649",\ufc7f:"\u0642\u0649",\ufc36:"\u0642\u0649",\u{1ee0a}:"\u0643",\u{1ee2a}:"\u0643",\u{1ee6a}:"\u0643",\ufedb:"\u0643",\ufedc:"\u0643",\ufeda:"\u0643",\ufed9:"\u0643",\u06a9:"\u0643",\ufb90:"\u0643",\ufb91:"\u0643",\ufb8f:"\u0643",\ufb8e:"\u0643",\u06aa:"\u0643",\u06ad:"\u0643\u06db",\ufbd5:"\u0643\u06db",\ufbd6:"\u0643\u06db",\ufbd4:"\u0643\u06db",\ufbd3:"\u0643\u06db",\u0763:"\u0643\u06db",\ufc80:"\u0643l",\ufc37:"\u0643l",\ufcc4:"\u0643\u062c",\ufc38:"\u0643\u062c",\ufcc5:"\u0643\u062d",\ufc39:"\u0643\u062d",\ufcc6:"\u0643\u062e",\ufc3a:"\u0643\u062e",\ufcc7:"\u0643\u0644",\ufceb:"\u0643\u0644",\ufc81:"\u0643\u0644",\ufc3b:"\u0643\u0644",\ufcc8:"\u0643\u0645",\ufcec:"\u0643\u0645",\ufc82:"\u0643\u0645",\ufc3c:"\u0643\u0645",\ufdc3:"\u0643\u0645\u0645",\ufdbb:"\u0643\u0645\u0645",\ufdb7:"\u0643\u0645\u0649",\ufc83:"\u0643\u0649",\ufc3d:"\u0643\u0649",\ufc84:"\u0643\u0649",\ufc3e:"\u0643\u0649",\u0762:"\u06ac",\ufb94:"\u06af",\ufb95:"\u06af",\ufb93:"\u06af",\ufb92:"\u06af",\u08b0:"\u06af",\u06b4:"\u06af\u06db",\ufb9c:"\u06b1",\ufb9d:"\u06b1",\ufb9b:"\u06b1",\ufb9a:"\u06b1",\ufb98:"\u06b3",\ufb99:"\u06b3",\ufb97:"\u06b3",\ufb96:"\u06b3",\u{1ee0b}:"\u0644",\u{1ee2b}:"\u0644",\u{1ee4b}:"\u0644",\u{1ee8b}:"\u0644",\u{1eeab}:"\u0644",\ufedf:"\u0644",\ufee0:"\u0644",\ufede:"\u0644",\ufedd:"\u0644",\u06b7:"\u0644\u06db",\u06b5:"\u0644\u0306",\ufefc:"\u0644l",\ufefb:"\u0644l",\ufefa:"\u0644l\u0655",\ufef9:"\u0644l\u0655",\ufef8:"\u0644l\u0674",\ufef7:"\u0644l\u0674",\ufccd:"\u0644o",\ufef6:"\u0644\u0622",\ufef5:"\u0644\u0622",\ufcc9:"\u0644\u062c",\ufc3f:"\u0644\u062c",\ufd83:"\u0644\u062c\u062c",\ufd84:"\u0644\u062c\u062c",\ufdba:"\u0644\u062c\u0645",\ufdbc:"\u0644\u062c\u0645",\ufdac:"\u0644\u062c\u0649",\ufcca:"\u0644\u062d",\ufc40:"\u0644\u062d",\ufdb5:"\u0644\u062d\u0645",\ufd80:"\u0644\u062d\u0645",\ufd82:"\u0644\u062d\u0649",\ufd81:"\u0644\u062d\u0649",\ufccb:"\u0644\u062e",\ufc41:"\u0644\u062e",\ufd86:"\u0644\u062e\u0645",\ufd85:"\u0644\u062e\u0645",\ufccc:"\u0644\u0645",\ufced:"\u0644\u0645",\ufc85:"\u0644\u0645",\ufc42:"\u0644\u0645",\ufd88:"\u0644\u0645\u062d",\ufd87:"\u0644\u0645\u062d",\ufdad:"\u0644\u0645\u0649",\ufc86:"\u0644\u0649",\ufc43:"\u0644\u0649",\ufc87:"\u0644\u0649",\ufc44:"\u0644\u0649",\u{1ee0c}:"\u0645",\u{1ee2c}:"\u0645",\u{1ee6c}:"\u0645",\u{1ee8c}:"\u0645",\u{1eeac}:"\u0645",\ufee3:"\u0645",\ufee4:"\u0645",\ufee2:"\u0645",\ufee1:"\u0645",\u08a7:"\u0645\u06db","\u06fe":"\u0645\u0348",\ufc88:"\u0645l",\ufcce:"\u0645\u062c",\ufc45:"\u0645\u062c",\ufd8c:"\u0645\u062c\u062d",\ufd92:"\u0645\u062c\u062e",\ufd8d:"\u0645\u062c\u0645",\ufdc0:"\u0645\u062c\u0649",\ufccf:"\u0645\u062d",\ufc46:"\u0645\u062d",\ufd89:"\u0645\u062d\u062c",\ufd8a:"\u0645\u062d\u0645",\ufdf4:"\u0645\u062d\u0645\u062f",\ufd8b:"\u0645\u062d\u0649",\ufcd0:"\u0645\u062e",\ufc47:"\u0645\u062e",\ufd8e:"\u0645\u062e\u062c",\ufd8f:"\u0645\u062e\u0645",\ufdb9:"\u0645\u062e\u0649",\ufcd1:"\u0645\u0645",\ufc89:"\u0645\u0645",\ufc48:"\u0645\u0645",\ufdb1:"\u0645\u0645\u0649",\ufc49:"\u0645\u0649",\ufc4a:"\u0645\u0649",\u{1ee0d}:"\u0646",\u{1ee2d}:"\u0646",\u{1ee4d}:"\u0646",\u{1ee6d}:"\u0646",\u{1ee8d}:"\u0646",\u{1eead}:"\u0646",\ufee7:"\u0646",\ufee8:"\u0646",\ufee6:"\u0646",\ufee5:"\u0646",\u0768:"\u0646\u0615",\u0769:"\u0646\u0306",\ufcd6:"\u0646o",\ufcef:"\u0646o",\ufdb8:"\u0646\u062c\u062d",\ufdbd:"\u0646\u062c\u062d",\ufd98:"\u0646\u062c\u0645",\ufd97:"\u0646\u062c\u0645",\ufd99:"\u0646\u062c\u0649",\ufdc7:"\u0646\u062c\u0649",\ufcd3:"\u0646\u062d",\ufc4c:"\u0646\u062d",\ufd95:"\u0646\u062d\u0645",\ufd96:"\u0646\u062d\u0649",\ufdb3:"\u0646\u062d\u0649",\ufcd4:"\u0646\u062e",\ufc4d:"\u0646\u062e",\ufc8a:"\u0646\u0631",\ufc8b:"\u0646\u0632",\ufcd5:"\u0646\u0645",\ufcee:"\u0646\u0645",\ufc8c:"\u0646\u0645",\ufc4e:"\u0646\u0645",\ufd9b:"\u0646\u0645\u0649",\ufd9a:"\u0646\u0645\u0649",\ufc8d:"\u0646\u0646",\ufc8e:"\u0646\u0649",\ufc4f:"\u0646\u0649",\ufc8f:"\u0646\u0649",\ufc50:"\u0646\u0649",\u06c2:"\u06c0",\ufba5:"\u06c0",\ufba4:"\u06c0","\u{102e4}":"\u0648",\u{1ee05}:"\u0648",\u{1ee85}:"\u0648",\u{1eea5}:"\u0648",\ufeee:"\u0648",\ufeed:"\u0648",\u08b1:"\u0648",\u06cb:"\u0648\u06db",\ufbdf:"\u0648\u06db",\ufbde:"\u0648\u06db",\u06c7:"\u0648\u0313",\ufbd8:"\u0648\u0313",\ufbd7:"\u0648\u0313",\u06c6:"\u0648\u0306",\ufbda:"\u0648\u0306",\ufbd9:"\u0648\u0306",\u06c9:"\u0648\u0302",\ufbe3:"\u0648\u0302",\ufbe2:"\u0648\u0302",\u06c8:"\u0648\u0670",\ufbdc:"\u0648\u0670",\ufbdb:"\u0648\u0670",\u0624:"\u0648\u0674",\ufe86:"\u0648\u0674",\ufe85:"\u0648\u0674",\u0676:"\u0648\u0674",\u0677:"\u0648\u0313\u0674",\ufbdd:"\u0648\u0313\u0674",\ufdf8:"\u0648\u0633\u0644\u0645",\ufbe1:"\u06c5",\ufbe0:"\u06c5",\u066e:"\u0649",\u{1ee1c}:"\u0649",\u{1ee7c}:"\u0649",\u06ba:"\u0649",\u{1ee1d}:"\u0649",\u{1ee5d}:"\u0649",\ufb9f:"\u0649",\ufb9e:"\u0649","\u08bd":"\u0649",\ufbe8:"\u0649",\ufbe9:"\u0649",\ufef0:"\u0649",\ufeef:"\u0649",\u064a:"\u0649",\u{1ee09}:"\u0649",\u{1ee29}:"\u0649",\u{1ee49}:"\u0649",\u{1ee69}:"\u0649",\u{1ee89}:"\u0649",\u{1eea9}:"\u0649",\ufef3:"\u0649",\ufef4:"\u0649",\ufef2:"\u0649",\ufef1:"\u0649",\u06cc:"\u0649",\ufbfe:"\u0649",\ufbff:"\u0649",\ufbfd:"\u0649",\ufbfc:"\u0649",\u06d2:"\u0649",\ufbaf:"\u0649",\ufbae:"\u0649",\u0679:"\u0649\u0615",\ufb68:"\u0649\u0615",\ufb69:"\u0649\u0615",\ufb67:"\u0649\u0615",\ufb66:"\u0649\u0615",\u06bb:"\u0649\u0615",\ufba2:"\u0649\u0615",\ufba3:"\u0649\u0615",\ufba1:"\u0649\u0615",\ufba0:"\u0649\u0615",\u067e:"\u0649\u06db",\ufb58:"\u0649\u06db",\ufb59:"\u0649\u06db",\ufb57:"\u0649\u06db",\ufb56:"\u0649\u06db",\u062b:"\u0649\u06db",\u{1ee16}:"\u0649\u06db",\u{1ee36}:"\u0649\u06db",\u{1ee76}:"\u0649\u06db",\u{1ee96}:"\u0649\u06db",\u{1eeb6}:"\u0649\u06db",\ufe9b:"\u0649\u06db",\ufe9c:"\u0649\u06db",\ufe9a:"\u0649\u06db",\ufe99:"\u0649\u06db",\u06bd:"\u0649\u06db",\u06d1:"\u0649\u06db",\u063f:"\u0649\u06db","\u08b7":"\u0649\u06db\u06e2",\u0756:"\u0649\u0306",\u06ce:"\u0649\u0306","\u08ba":"\u0649\u0306\u0307",\u063d:"\u0649\u0302",\u08a8:"\u0649\u0654",\ufc90:"\u0649\u0670",\ufc5d:"\u0649\u0670",\ufcde:"\u0649o",\ufcf1:"\u0649o",\ufce6:"\u0649\u06dbo",\u0626:"\u0649\u0674",\ufe8b:"\u0649\u0674",\ufe8c:"\u0649\u0674",\ufe8a:"\u0649\u0674",\ufe89:"\u0649\u0674",\u0678:"\u0649\u0674",\ufbeb:"\u0649\u0674l",\ufbea:"\u0649\u0674l",\ufc9b:"\u0649\u0674o",\ufce0:"\u0649\u0674o",\ufbed:"\u0649\u0674o",\ufbec:"\u0649\u0674o",\ufbf8:"\u0649\u0674\u067b",\ufbf7:"\u0649\u0674\u067b",\ufbf6:"\u0649\u0674\u067b",\ufc97:"\u0649\u0674\u062c",\ufc00:"\u0649\u0674\u062c",\ufc98:"\u0649\u0674\u062d",\ufc01:"\u0649\u0674\u062d",\ufc99:"\u0649\u0674\u062e",\ufc64:"\u0649\u0674\u0631",\ufc65:"\u0649\u0674\u0632",\ufc9a:"\u0649\u0674\u0645",\ufcdf:"\u0649\u0674\u0645",\ufc66:"\u0649\u0674\u0645",\ufc02:"\u0649\u0674\u0645",\ufc67:"\u0649\u0674\u0646",\ufbef:"\u0649\u0674\u0648",\ufbee:"\u0649\u0674\u0648",\ufbf1:"\u0649\u0674\u0648\u0313",\ufbf0:"\u0649\u0674\u0648\u0313",\ufbf3:"\u0649\u0674\u0648\u0306",\ufbf2:"\u0649\u0674\u0648\u0306",\ufbf5:"\u0649\u0674\u0648\u0670",\ufbf4:"\u0649\u0674\u0648\u0670",\ufbfb:"\u0649\u0674\u0649",\ufbfa:"\u0649\u0674\u0649",\ufc68:"\u0649\u0674\u0649",\ufbf9:"\u0649\u0674\u0649",\ufc03:"\u0649\u0674\u0649",\ufc69:"\u0649\u0674\u0649",\ufc04:"\u0649\u0674\u0649",\ufcda:"\u0649\u062c",\ufc55:"\u0649\u062c",\ufc11:"\u0649\u06db\u062c",\ufdaf:"\u0649\u062c\u0649",\ufcdb:"\u0649\u062d",\ufc56:"\u0649\u062d",\ufdae:"\u0649\u062d\u0649",\ufcdc:"\u0649\u062e",\ufc57:"\u0649\u062e",\ufc91:"\u0649\u0631",\ufc76:"\u0649\u06db\u0631",\ufc92:"\u0649\u0632",\ufc77:"\u0649\u06db\u0632",\ufcdd:"\u0649\u0645",\ufcf0:"\u0649\u0645",\ufc93:"\u0649\u0645",\ufc58:"\u0649\u0645",\ufca6:"\u0649\u06db\u0645",\ufce5:"\u0649\u06db\u0645",\ufc78:"\u0649\u06db\u0645",\ufc12:"\u0649\u06db\u0645",\ufd9d:"\u0649\u0645\u0645",\ufd9c:"\u0649\u0645\u0645",\ufdb0:"\u0649\u0645\u0649",\ufc94:"\u0649\u0646",\ufc79:"\u0649\u06db\u0646",\ufc95:"\u0649\u0649",\ufc59:"\u0649\u0649",\ufc96:"\u0649\u0649",\ufc5a:"\u0649\u0649",\ufc7a:"\u0649\u06db\u0649",\ufc13:"\u0649\u06db\u0649",\ufc7b:"\u0649\u06db\u0649",\ufc14:"\u0649\u06db\u0649",\ufbb1:"\u06d3",\ufbb0:"\u06d3",\u{102b8}:"\u2d40","\u205e":"\u2d42","\u2e3d":"\u2d42","\u2999":"\u2d42","\ufe19":"\u2d57","\u205d":"\u2d57","\u22ee":"\u2d57",\u0544:"\u1206",\u054c:"\u1261",\u053b:"\u12ae",\u054a:"\u1323",\u0906:"\u0905\u093e",\u0912:"\u0905\u093e\u0946",\u0913:"\u0905\u093e\u0947",\u0914:"\u0905\u093e\u0948",\u0904:"\u0905\u0946",\u0911:"\u0905\u0949",\u090d:"\u090f\u0945",\u090e:"\u090f\u0946",\u0910:"\u090f\u0947",\u0908:"\u0930\u094d\u0907",\u0abd:"\u093d",\u{111dc}:"\ua8fb","\u{111cb}":"\u093a","\u0ac1":"\u0941","\u0ac2":"\u0942","\u0a4b":"\u0946","\u0a4d":"\u094d","\u0acd":"\u094d",\u0986:"\u0985\u09be",\u09e0:"\u098b\u09c3",\u09e1:"\u098b\u09c3",\u{11492}:"\u0998",\u{11494}:"\u099a",\u{11496}:"\u099c",\u{11498}:"\u099e",\u{11499}:"\u099f",\u{1149b}:"\u09a1",\u{114aa}:"\u09a3",\u{1149e}:"\u09a4",\u{1149f}:"\u09a5",\u{114a0}:"\u09a6",\u{114a1}:"\u09a7",\u{114a2}:"\u09a8",\u{114a3}:"\u09aa",\u{114a9}:"\u09ac",\u{114a7}:"\u09ae",\u{114a8}:"\u09af",\u{114ab}:"\u09b0",\u{1149d}:"\u09b2",\u{114ad}:"\u09b7",\u{114ae}:"\u09b8",\u{114c4}:"\u09bd","\u{114b0}":"\u09be","\u{114b1}":"\u09bf","\u{114b9}":"\u09c7","\u{114bc}":"\u09cb","\u{114be}":"\u09cc","\u{114c2}":"\u09cd","\u{114bd}":"\u09d7",\u0a09:"\u0a73\u0a41",\u0a0a:"\u0a73\u0a42",\u0a06:"\u0a05\u0a3e",\u0a10:"\u0a05\u0a48",\u0a14:"\u0a05\u0a4c",\u0a07:"\u0a72\u0a3f",\u0a08:"\u0a72\u0a40",\u0a0f:"\u0a72\u0a47",\u0a86:"\u0a85\u0abe",\u0a91:"\u0a85\u0abe\u0ac5",\u0a93:"\u0a85\u0abe\u0ac7",\u0a94:"\u0a85\u0abe\u0ac8",\u0a8d:"\u0a85\u0ac5",\u0a8f:"\u0a85\u0ac7",\u0a90:"\u0a85\u0ac8",\u0b06:"\u0b05\u0b3e","\u0bee":"\u0b85",\u0bb0:"\u0b88","\u0bbe":"\u0b88","\u0beb":"\u0b88\u0bc1","\u0be8":"\u0b89",\u0d09:"\u0b89",\u0b8a:"\u0b89\u0bb3",\u0d0a:"\u0b89\u0d57","\u0bed":"\u0b8e","\u0bf7":"\u0b8e\u0bb5",\u0b9c:"\u0b90",\u0d1c:"\u0b90","\u0be7":"\u0b95","\u0bea":"\u0b9a","\u0bec":"\u0b9a\u0bc1","\u0bf2":"\u0b9a\u0bc2",\u0d3a:"\u0b9f\u0bbf",\u0d23:"\u0ba3","\u0bfa":"\u0ba8\u0bc0","\u0bf4":"\u0bae\u0bc0","\u0bf0":"\u0baf",\u0d34:"\u0bb4","\u0bd7":"\u0bb3","\u0bc8":"\u0ba9",\u0d36:"\u0bb6","\u0bf8":"\u0bb7","\u0d3f":"\u0bbf","\u0d40":"\u0bbf","\u0bca":"\u0bc6\u0b88","\u0bcc":"\u0bc6\u0bb3","\u0bcb":"\u0bc7\u0b88",\u0c85:"\u0c05",\u0c86:"\u0c06",\u0c87:"\u0c07",\u0c60:"\u0c0b\u0c3e",\u0c61:"\u0c0c\u0c3e",\u0c92:"\u0c12",\u0c14:"\u0c12\u0c4c",\u0c94:"\u0c12\u0c4c",\u0c13:"\u0c12\u0c55",\u0c93:"\u0c12\u0c55",\u0c9c:"\u0c1c",\u0c9e:"\u0c1e",\u0c22:"\u0c21\u0323",\u0ca3:"\u0c23",\u0c25:"\u0c27\u05bc",\u0c2d:"\u0c2c\u0323",\u0caf:"\u0c2f",\u0c20:"\u0c30\u05bc",\u0cb1:"\u0c31",\u0cb2:"\u0c32",\u0c37:"\u0c35\u0323",\u0c39:"\u0c35\u0c3e",\u0c2e:"\u0c35\u0c41","\u0c42":"\u0c41\u0c3e","\u0c44":"\u0c43\u0c3e",\u0ce1:"\u0c8c\u0cbe",\u0d08:"\u0d07\u0d57",\u0d10:"\u0d0e\u0d46",\u0d13:"\u0d12\u0d3e",\u0d14:"\u0d12\u0d57",\u0d61:"\u0d1e","\u0d6b":"\u0d26\u0d4d\u0d30","\u0d79":"\u0d28\u0d41",\u0d0c:"\u0d28\u0d41",\u0d19:"\u0d28\u0d41","\u0d6f":"\u0d28\u0d4d",\u0d7b:"\u0d28\u0d4d","\u0d6c":"\u0d28\u0d4d\u0d28","\u0d5a":"\u0d28\u0d4d\u0d2e",\u0d31:"\u0d30","\u0d6a":"\u0d30\u0d4d",\u0d7c:"\u0d30\u0d4d","\u0d6e":"\u0d35\u0d4d\u0d30","\u0d76":"\u0d39\u0d4d\u0d2e","\u0d42":"\u0d41","\u0d43":"\u0d41","\u0d48":"\u0d46\u0d46","\u0dea":"\u0da2","\u0deb":"\u0daf","\u{11413}":"\u{11434}\u{11442}\u{11412}","\u{11419}":"\u{11434}\u{11442}\u{11418}","\u{11424}":"\u{11434}\u{11442}\u{11423}","\u{1142a}":"\u{11434}\u{11442}\u{11429}","\u{1142d}":"\u{11434}\u{11442}\u{1142c}","\u{1142f}":"\u{11434}\u{11442}\u{1142e}",\u{115d8}:"\u{11582}",\u{115d9}:"\u{11582}",\u{115da}:"\u{11583}",\u{115db}:"\u{11584}","\u{115dc}":"\u{115b2}","\u{115dd}":"\u{115b3}",\u0e03:"\u0e02",\u0e14:"\u0e04",\u0e15:"\u0e04",\u0e21:"\u0e06",\u0e88:"\u0e08",\u0e0b:"\u0e0a",\u0e0f:"\u0e0e",\u0e17:"\u0e11",\u0e9a:"\u0e1a",\u0e9b:"\u0e1b",\u0e9d:"\u0e1d",\u0e9e:"\u0e1e",\u0e9f:"\u0e1f",\u0e26:"\u0e20",\u0e8d:"\u0e22","\u17d4":"\u0e2f",\u0e45:"\u0e32",\u0e33:"\u030a\u0e32","\u17b7":"\u0e34","\u17b8":"\u0e35","\u17b9":"\u0e36","\u17ba":"\u0e37","\u0eb8":"\u0e38","\u0eb9":"\u0e39",\u0e41:"\u0e40\u0e40",\u0edc:"\u0eab\u0e99",\u0edd:"\u0eab\u0ea1",\u0eb3:"\u030a\u0eb2","\u0f02":"\u0f60\u0f74\u0f82\u0f7f","\u0f03":"\u0f60\u0f74\u0f82\u0f14",\u0f6a:"\u0f62",\u0f00:"\u0f68\u0f7c\u0f7e","\u0f77":"\u0fb2\u0f71\u0f80","\u0f79":"\u0fb3\u0f71\u0f80","\u{11cb2}":"\u{11caa}",\u1081:"\u1002\u103e",\u1000:"\u1002\u102c",\u1070:"\u1003\u103e",\u1066:"\u1015\u103e",\u101f:"\u1015\u102c",\u106f:"\u1015\u102c\u103e",\u107e:"\u107d\u103e",\u1029:"\u101e\u103c",\u102a:"\u101e\u103c\u1031\u102c\u103a","\u109e":"\u1083\u030a",\u17a3:"\u17a2","\u19d0":"\u199e","\u19d1":"\u19b1","\u1a80":"\u1a45","\u1a90":"\u1a45","\uaa53":"\uaa01","\uaa56":"\uaa23","\u1b52":"\u1b0d","\u1b53":"\u1b11","\u1b58":"\u1b28",\ua9a3:"\ua99d",\u1896:"\u185c",\u1855:"\u1835",\u1ff6:"\u13ef",\u140d:"\u1401\xb7",\u142b:"\u1401\u1420",\u1411:"\u1404\xb7",\u1413:"\u1405\xb7",\u142d:"\u1405\u1420",\u1415:"\u1406\xb7",\u1418:"\u140a\xb7",\u142e:"\u140a\u1420",\u141a:"\u140b\xb7",\u18dd:"\u141e\u18df",\u14d1:"\u1421",\u1540:"\u1429",\u143f:"\u1432\xb7",\u1443:"\u1434\xb7","\u2369":"\u1435",\u1447:"\u1439\xb7",\u145c:"\u144f\xb7","\u2e27":"\u1450","\u2283":"\u1450",\u145e:"\u1450\xb7",\u1469:"\u1450'","\u27c9":"\u1450/","\u2ad7":"\u1450\u1455",\u1460:"\u1451\xb7","\u2e26":"\u1455","\u2282":"\u1455",\u1462:"\u1455\xb7",\u146a:"\u1455'",\u1464:"\u1456\xb7",\u1475:"\u146b\xb7",\u1485:"\u146b'",\u1479:"\u146e\xb7",\u147d:"\u1470\xb7",\u1603:"\u1489",\u1493:"\u1489\xb7",\u1495:"\u148b\xb7",\u1497:"\u148c\xb7",\u149b:"\u148e\xb7",\u1602:"\u1490",\u149d:"\u1490\xb7",\u149f:"\u1491\xb7",\u14ad:"\u14a3\xb7",\u14b1:"\u14a6\xb7",\u14b3:"\u14a7\xb7",\u14b5:"\u14a8\xb7",\u14b9:"\u14ab\xb7",\u14ca:"\u14c0\xb7",\u18c7:"\u14c2\xb7",\u18c9:"\u14c3\xb7",\u18cb:"\u14c4\xb7",\u18cd:"\u14c5\xb7",\u14cc:"\u14c7\xb7",\u14ce:"\u14c8\xb7",\u1604:"\u14d3",\u14dd:"\u14d3\xb7",\u14df:"\u14d5\xb7",\u14e1:"\u14d6\xb7",\u14e3:"\u14d7\xb7",\u14e5:"\u14d8\xb7",\u1607:"\u14da",\u14e7:"\u14da\xb7",\u14e9:"\u14db\xb7",\u14f7:"\u14ed\xb7",\u14f9:"\u14ef\xb7",\u14fb:"\u14f0\xb7",\u14fd:"\u14f1\xb7",\u14ff:"\u14f2\xb7",\u1501:"\u14f4\xb7",\u1503:"\u14f5\xb7",\u150c:"\u150b<",\u150e:"\u150bb",\u150d:"\u150b\u1455",\u150f:"\u150b\u1490",\u1518:"\u1510\xb7",\u151a:"\u1511\xb7",\u151c:"\u1512\xb7",\u151e:"\u1513\xb7",\u1520:"\u1514\xb7",\u1522:"\u1515\xb7",\u1524:"\u1516\xb7",\u1532:"\u1528\xb7",\u1534:"\u1529\xb7",\u1536:"\u152a\xb7",\u1538:"\u152b\xb7",\u153a:"\u152d\xb7",\u153c:"\u152e\xb7",\u1622:"\u1543",\u18e0:"\u1543\xb7",\u1623:"\u1546",\u1624:"\u154a",\u154f:"\u154c\xb7",\u1583:"\u1550b",\u1584:"\u1550b\u0307",\u1581:"\u1550d",\u157f:"\u1550P",\u166f:"\u1550\u146b",\u157e:"\u1550\u146c",\u1580:"\u1550\u146e",\u1582:"\u1550\u1470",\u1585:"\u1550\u1483",\u155c:"\u155a\xb7",\u18e3:"\u155e\xb7",\u18e4:"\u1566\xb7",\u1569:"\u1567\xb7",\u18e5:"\u156b\xb7",\u18e8:"\u1586\xb7",\u1591:"\u1595J",\u1670:"\u1595\u1489",\u158e:"\u1595\u148a",\u158f:"\u1595\u148b",\u1590:"\u1595\u148c",\u1592:"\u1595\u148e",\u1593:"\u1595\u1490",\u1594:"\u1595\u1491",\u1673:"\u1596J",\u1671:"\u1596\u148b",\u1672:"\u1596\u148c",\u1674:"\u1596\u148e",\u1675:"\u1596\u1490",\u1676:"\u1596\u1491",\u18ea:"\u1597\xb7",\u1677:"\u15a7\xb7",\u1678:"\u15a8\xb7",\u1679:"\u15a9\xb7",\u167a:"\u15aa\xb7",\u167b:"\u15ab\xb7",\u167c:"\u15ac\xb7",\u167d:"\u15ad\xb7","\u2aab":"\u15d2","\u2aaa":"\u15d5",\ua4f7:"\u15e1",\u18f0:"\u15f4\xb7",\u18f2:"\u161b\xb7",\u1dbb:"\u1646",\ua4ed:"\u1660",\u1dba:"\u18d4",\u1d3e:"\u18d6",\u18dc:"\u18df\u141e",\u02e1:"\u18f3",\u02b3:"\u18f4",\u02e2:"\u18f5",\u18db:"\u18f5",\ua6b0:"\u16b9",\u16e1:"\u16bc","\u237f":"\u16bd",\u16c2:"\u16bd","\u{1d23f}":"\u16cb","\u2191":"\u16cf","\u21bf":"\u16d0","\u296e":"\u16d0\u21c2","\u2963":"\u16d0\u16da",\u2d63:"\u16ef","\u21be":"\u16da","\u2a21":"\u16da","\u22c4":"\u16dc","\u25c7":"\u16dc","\u25ca":"\u16dc","\u2662":"\u16dc","\u{1f754}":"\u16dc",\u{118b7}:"\u16dc",\u{10294}:"\u16dc","\u235a":"\u16dc\u0332","\u22c8":"\u16de","\u2a1d":"\u16de","\u{104d0}":"\u16e6","\u2195":"\u16e8","\u{10cfc}":"\u{10c82}","\u{10cfa}":"\u{10ca5}",\u3131:"\u1100",\u11a8:"\u1100",\u1101:"\u1100\u1100",\u3132:"\u1100\u1100",\u11a9:"\u1100\u1100",\u11fa:"\u1100\u1102",\u115a:"\u1100\u1103",\u11c3:"\u1100\u1105",\u11fb:"\u1100\u1107",\u11aa:"\u1100\u1109",\u3133:"\u1100\u1109",\u11c4:"\u1100\u1109\u1100",\u11fc:"\u1100\u110e",\u11fd:"\u1100\u110f",\u11fe:"\u1100\u1112",\u3134:"\u1102",\u11ab:"\u1102",\u1113:"\u1102\u1100",\u11c5:"\u1102\u1100",\u1114:"\u1102\u1102",\u3165:"\u1102\u1102",\u11ff:"\u1102\u1102",\u1115:"\u1102\u1103",\u3166:"\u1102\u1103",\u11c6:"\u1102\u1103",\ud7cb:"\u1102\u1105",\u1116:"\u1102\u1107",\u115b:"\u1102\u1109",\u11c7:"\u1102\u1109",\u3167:"\u1102\u1109",\u115c:"\u1102\u110c",\u11ac:"\u1102\u110c",\u3135:"\u1102\u110c",\ud7cc:"\u1102\u110e",\u11c9:"\u1102\u1110",\u115d:"\u1102\u1112",\u11ad:"\u1102\u1112",\u3136:"\u1102\u1112",\u11c8:"\u1102\u1140",\u3168:"\u1102\u1140",\u3137:"\u1103",\u11ae:"\u1103",\u1117:"\u1103\u1100",\u11ca:"\u1103\u1100",\u1104:"\u1103\u1103",\u3138:"\u1103\u1103",\ud7cd:"\u1103\u1103",\ud7ce:"\u1103\u1103\u1107",\u115e:"\u1103\u1105",\u11cb:"\u1103\u1105",\ua960:"\u1103\u1106",\ua961:"\u1103\u1107",\ud7cf:"\u1103\u1107",\ua962:"\u1103\u1109",\ud7d0:"\u1103\u1109",\ud7d1:"\u1103\u1109\u1100",\ua963:"\u1103\u110c",\ud7d2:"\u1103\u110c",\ud7d3:"\u1103\u110e",\ud7d4:"\u1103\u1110",\u3139:"\u1105",\u11af:"\u1105",\ua964:"\u1105\u1100",\u11b0:"\u1105\u1100",\u313a:"\u1105\u1100",\ua965:"\u1105\u1100\u1100",\ud7d5:"\u1105\u1100\u1100",\u11cc:"\u1105\u1100\u1109",\u3169:"\u1105\u1100\u1109",\ud7d6:"\u1105\u1100\u1112",\u1118:"\u1105\u1102",\u11cd:"\u1105\u1102",\ua966:"\u1105\u1103",\u11ce:"\u1105\u1103",\u316a:"\u1105\u1103",\ua967:"\u1105\u1103\u1103",\u11cf:"\u1105\u1103\u1112",\u1119:"\u1105\u1105",\u11d0:"\u1105\u1105",\ud7d7:"\u1105\u1105\u110f",\ua968:"\u1105\u1106",\u11b1:"\u1105\u1106",\u313b:"\u1105\u1106",\u11d1:"\u1105\u1106\u1100",\u11d2:"\u1105\u1106\u1109",\ud7d8:"\u1105\u1106\u1112",\ua969:"\u1105\u1107",\u11b2:"\u1105\u1107",\u313c:"\u1105\u1107",\ud7d9:"\u1105\u1107\u1103",\ua96a:"\u1105\u1107\u1107",\u11d3:"\u1105\u1107\u1109",\u316b:"\u1105\u1107\u1109",\ua96b:"\u1105\u1107\u110b",\u11d5:"\u1105\u1107\u110b",\ud7da:"\u1105\u1107\u1111",\u11d4:"\u1105\u1107\u1112",\ua96c:"\u1105\u1109",\u11b3:"\u1105\u1109",\u313d:"\u1105\u1109",\u11d6:"\u1105\u1109\u1109",\u111b:"\u1105\u110b",\ud7dd:"\u1105\u110b",\ua96d:"\u1105\u110c",\ua96e:"\u1105\u110f",\u11d8:"\u1105\u110f",\u11b4:"\u1105\u1110",\u313e:"\u1105\u1110",\u11b5:"\u1105\u1111",\u313f:"\u1105\u1111",\u111a:"\u1105\u1112",\u3140:"\u1105\u1112",\u113b:"\u1105\u1112",\u11b6:"\u1105\u1112",\ud7f2:"\u1105\u1112",\u11d7:"\u1105\u1140",\u316c:"\u1105\u1140",\ud7db:"\u1105\u114c",\u11d9:"\u1105\u1159",\u316d:"\u1105\u1159",\ud7dc:"\u1105\u1159\u1112",\u3141:"\u1106",\u11b7:"\u1106",\ua96f:"\u1106\u1100",\u11da:"\u1106\u1100",\ud7de:"\u1106\u1102",\ud7df:"\u1106\u1102\u1102",\ua970:"\u1106\u1103",\u11db:"\u1106\u1105",\ud7e0:"\u1106\u1106",\u111c:"\u1106\u1107",\u316e:"\u1106\u1107",\u11dc:"\u1106\u1107",\ud7e1:"\u1106\u1107\u1109",\ua971:"\u1106\u1109",\u11dd:"\u1106\u1109",\u316f:"\u1106\u1109",\u11de:"\u1106\u1109\u1109",\u111d:"\u1106\u110b",\u3171:"\u1106\u110b",\u11e2:"\u1106\u110b",\ud7e2:"\u1106\u110c",\u11e0:"\u1106\u110e",\u11e1:"\u1106\u1112",\u11df:"\u1106\u1140",\u3170:"\u1106\u1140",\u3142:"\u1107",\u11b8:"\u1107",\u111e:"\u1107\u1100",\u3172:"\u1107\u1100",\u111f:"\u1107\u1102",\u1120:"\u1107\u1103",\u3173:"\u1107\u1103",\ud7e3:"\u1107\u1103",\u11e3:"\u1107\u1105",\ud7e4:"\u1107\u1105\u1111",\ud7e5:"\u1107\u1106",\u1108:"\u1107\u1107",\u3143:"\u1107\u1107",\ud7e6:"\u1107\u1107",\u112c:"\u1107\u1107\u110b",\u3179:"\u1107\u1107\u110b",\u1121:"\u1107\u1109",\u3144:"\u1107\u1109",\u11b9:"\u1107\u1109",\u1122:"\u1107\u1109\u1100",\u3174:"\u1107\u1109\u1100",\u1123:"\u1107\u1109\u1103",\u3175:"\u1107\u1109\u1103",\ud7e7:"\u1107\u1109\u1103",\u1124:"\u1107\u1109\u1107",\u1125:"\u1107\u1109\u1109",\u1126:"\u1107\u1109\u110c",\ua972:"\u1107\u1109\u1110",\u112b:"\u1107\u110b",\u3178:"\u1107\u110b",\u11e6:"\u1107\u110b",\u1127:"\u1107\u110c",\u3176:"\u1107\u110c",\ud7e8:"\u1107\u110c",\u1128:"\u1107\u110e",\ud7e9:"\u1107\u110e",\ua973:"\u1107\u110f",\u1129:"\u1107\u1110",\u3177:"\u1107\u1110",\u112a:"\u1107\u1111",\u11e4:"\u1107\u1111",\ua974:"\u1107\u1112",\u11e5:"\u1107\u1112",\u3145:"\u1109",\u11ba:"\u1109",\u112d:"\u1109\u1100",\u317a:"\u1109\u1100",\u11e7:"\u1109\u1100",\u112e:"\u1109\u1102",\u317b:"\u1109\u1102",\u112f:"\u1109\u1103",\u317c:"\u1109\u1103",\u11e8:"\u1109\u1103",\u1130:"\u1109\u1105",\u11e9:"\u1109\u1105",\u1131:"\u1109\u1106",\ud7ea:"\u1109\u1106",\u1132:"\u1109\u1107",\u317d:"\u1109\u1107",\u11ea:"\u1109\u1107",\u1133:"\u1109\u1107\u1100",\ud7eb:"\u1109\u1107\u110b",\u110a:"\u1109\u1109",\u3146:"\u1109\u1109",\u11bb:"\u1109\u1109",\ud7ec:"\u1109\u1109\u1100",\ud7ed:"\u1109\u1109\u1103",\ua975:"\u1109\u1109\u1107",\u1134:"\u1109\u1109\u1109",\u1135:"\u1109\u110b",\u1136:"\u1109\u110c",\u317e:"\u1109\u110c",\ud7ef:"\u1109\u110c",\u1137:"\u1109\u110e",\ud7f0:"\u1109\u110e",\u1138:"\u1109\u110f",\u1139:"\u1109\u1110",\ud7f1:"\u1109\u1110",\u113a:"\u1109\u1111",\ud7ee:"\u1109\u1140",\u3147:"\u110b",\u11bc:"\u110b",\u1141:"\u110b\u1100",\u11ec:"\u110b\u1100",\u11ed:"\u110b\u1100\u1100",\u1142:"\u110b\u1103",\ua976:"\u110b\u1105",\u1143:"\u110b\u1106",\u1144:"\u110b\u1107",\u1145:"\u110b\u1109",\u11f1:"\u110b\u1109",\u3182:"\u110b\u1109",\u1147:"\u110b\u110b",\u3180:"\u110b\u110b",\u11ee:"\u110b\u110b",\u1148:"\u110b\u110c",\u1149:"\u110b\u110e",\u11ef:"\u110b\u110f",\u114a:"\u110b\u1110",\u114b:"\u110b\u1111",\ua977:"\u110b\u1112",\u1146:"\u110b\u1140",\u11f2:"\u110b\u1140",\u3183:"\u110b\u1140",\u3148:"\u110c",\u11bd:"\u110c",\ud7f7:"\u110c\u1107",\ud7f8:"\u110c\u1107\u1107",\u114d:"\u110c\u110b",\u110d:"\u110c\u110c",\u3149:"\u110c\u110c",\ud7f9:"\u110c\u110c",\ua978:"\u110c\u110c\u1112",\u314a:"\u110e",\u11be:"\u110e",\u1152:"\u110e\u110f",\u1153:"\u110e\u1112",\u314b:"\u110f",\u11bf:"\u110f",\u314c:"\u1110",\u11c0:"\u1110",\ua979:"\u1110\u1110",\u314d:"\u1111",\u11c1:"\u1111",\u1156:"\u1111\u1107",\u11f3:"\u1111\u1107",\ud7fa:"\u1111\u1109",\u1157:"\u1111\u110b",\u3184:"\u1111\u110b",\u11f4:"\u1111\u110b",\ud7fb:"\u1111\u1110",\ua97a:"\u1111\u1112",\u314e:"\u1112",\u11c2:"\u1112",\u11f5:"\u1112\u1102",\u11f6:"\u1112\u1105",\u11f7:"\u1112\u1106",\u11f8:"\u1112\u1107",\ua97b:"\u1112\u1109",\u1158:"\u1112\u1112",\u3185:"\u1112\u1112",\u113d:"\u113c\u113c",\u113f:"\u113e\u113e",\u317f:"\u1140",\u11eb:"\u1140",\ud7f3:"\u1140\u1107",\ud7f4:"\u1140\u1107\u110b",\u3181:"\u114c",\u11f0:"\u114c",\ud7f5:"\u114c\u1106",\ud7f6:"\u114c\u1112",\u114f:"\u114e\u114e",\u1151:"\u1150\u1150",\u3186:"\u1159",\u11f9:"\u1159",\ua97c:"\u1159\u1159",\u3164:"\u1160",\u314f:"\u1161",\u11a3:"\u1161\u30fc",\u1176:"\u1161\u1169",\u1177:"\u1161\u116e",\u1162:"\u1161\u4e28",\u3150:"\u1161\u4e28",\u3151:"\u1163",\u1178:"\u1163\u1169",\u1179:"\u1163\u116d",\u11a4:"\u1163\u116e",\u1164:"\u1163\u4e28",\u3152:"\u1163\u4e28",\u3153:"\u1165",\u117c:"\u1165\u30fc",\u117a:"\u1165\u1169",\u117b:"\u1165\u116e",\u1166:"\u1165\u4e28",\u3154:"\u1165\u4e28",\u3155:"\u1167",\u11a5:"\u1167\u1163",\u117d:"\u1167\u1169",\u117e:"\u1167\u116e",\u1168:"\u1167\u4e28",\u3156:"\u1167\u4e28",\u3157:"\u1169",\u116a:"\u1169\u1161",\u3158:"\u1169\u1161",\u116b:"\u1169\u1161\u4e28",\u3159:"\u1169\u1161\u4e28",\u11a6:"\u1169\u1163",\u11a7:"\u1169\u1163\u4e28",\u117f:"\u1169\u1165",\u1180:"\u1169\u1165\u4e28",\ud7b0:"\u1169\u1167",\u1181:"\u1169\u1167\u4e28",\u1182:"\u1169\u1169",\ud7b1:"\u1169\u1169\u4e28",\u1183:"\u1169\u116e",\u116c:"\u1169\u4e28",\u315a:"\u1169\u4e28",\u315b:"\u116d",\ud7b2:"\u116d\u1161",\ud7b3:"\u116d\u1161\u4e28",\u1184:"\u116d\u1163",\u3187:"\u116d\u1163",\u1186:"\u116d\u1163",\u1185:"\u116d\u1163\u4e28",\u3188:"\u116d\u1163\u4e28",\ud7b4:"\u116d\u1165",\u1187:"\u116d\u1169",\u1188:"\u116d\u4e28",\u3189:"\u116d\u4e28",\u315c:"\u116e",\u1189:"\u116e\u1161",\u118a:"\u116e\u1161\u4e28",\u116f:"\u116e\u1165",\u315d:"\u116e\u1165",\u118b:"\u116e\u1165\u30fc",\u1170:"\u116e\u1165\u4e28",\u315e:"\u116e\u1165\u4e28",\ud7b5:"\u116e\u1167",\u118c:"\u116e\u1167\u4e28",\u118d:"\u116e\u116e",\u1171:"\u116e\u4e28",\u315f:"\u116e\u4e28",\ud7b6:"\u116e\u4e28\u4e28",\u3160:"\u1172",\u118e:"\u1172\u1161",\ud7b7:"\u1172\u1161\u4e28",\u118f:"\u1172\u1165",\u1190:"\u1172\u1165\u4e28",\u1191:"\u1172\u1167",\u318a:"\u1172\u1167",\u1192:"\u1172\u1167\u4e28",\u318b:"\u1172\u1167\u4e28",\ud7b8:"\u1172\u1169",\u1193:"\u1172\u116e",\u1194:"\u1172\u4e28",\u318c:"\u1172\u4e28",\u318d:"\u119e",\ud7c5:"\u119e\u1161",\u119f:"\u119e\u1165",\ud7c6:"\u119e\u1165\u4e28",\u11a0:"\u119e\u116e",\u11a2:"\u119e\u119e",\u11a1:"\u119e\u4e28",\u318e:"\u119e\u4e28",\u30d8:"\u3078","\u2341":"\u303c","\u29c4":"\u303c","\ua49e":"\ua04a","\ua4ac":"\ua050","\ua49c":"\ua0c0","\ua4a8":"\ua132","\ua4bf":"\ua259","\ua4be":"\ua2b1","\ua494":"\ua2cd","\ua4c0":"\ua3ab","\ua4c2":"\ua3b5","\ua4ba":"\ua3bf","\ua4b0":"\ua3c2","\ua4a7":"\ua458","\u22a5":"\ua4d5","\u27c2":"\ua4d5","\u{1d21c}":"\ua4d5",\ua7b1:"\ua4d5",\ua79e:"\ua4e4","\u2141":"\ua4e8","\u2142":"\ua4f6","\u{1d215}":"\ua4f6","\u{1d22b}":"\ua4f6",\u{16f26}:"\ua4f6",\u{10411}:"\ua4f6","\u2143":"\u{16f00}",\u{11ae6}:"\u{11ae5}\u{11aef}",\u{11ae8}:"\u{11ae5}\u{11ae5}",\u{11ae9}:"\u{11ae5}\u{11ae5}\u{11aef}",\u{11aea}:"\u{11ae5}\u{11ae5}\u{11af0}",\u{11ae7}:"\u{11ae5}\u{11af0}",\u{11af4}:"\u{11af3}\u{11aef}",\u{11af6}:"\u{11af3}\u{11af3}",\u{11af7}:"\u{11af3}\u{11af3}\u{11aef}",\u{11af8}:"\u{11af3}\u{11af3}\u{11af0}",\u{11af5}:"\u{11af3}\u{11af0}",\u{11aec}:"\u{11aeb}\u{11aef}",\u{11aed}:"\u{11aeb}\u{11aeb}",\u{11aee}:"\u{11aeb}\u{11aeb}\u{11aef}","\u2295":"\u{102a8}","\u2a01":"\u{102a8}","\u{1f728}":"\u{102a8}",\ua69a:"\u{102a8}","\u25bd":"\u{102bc}","\u{1d214}":"\u{102bc}","\u{1f704}":"\u{102bc}","\u29d6":"\u{102c0}",\ua79b:"\u{1043a}",\ua79a:"\u{10412}","\u{104a0}":"\u{10486}",\u{103d1}:"\u{10382}",\u{103d3}:"\u{10393}",\u{12038}:"\u{1039a}","\u2625":"\u{1099e}",\u{132f9}:"\u{1099e}",\u3039:"\u5344",\uf967:"\u4e0d",\u{2f800}:"\u4e3d",\ufa70:"\u4e26","\u239c":"\u4e28","\u239f":"\u4e28","\u23a2":"\u4e28","\u23a5":"\u4e28","\u23aa":"\u4e28","\u23ae":"\u4e28","\u31d1":"\u4e28",\u1175:"\u4e28",\u3163:"\u4e28","\u2f01":"\u4e28",\u119c:"\u4e28\u30fc",\u1198:"\u4e28\u1161",\u1199:"\u4e28\u1163",\ud7bd:"\u4e28\u1163\u1169",\ud7be:"\u4e28\u1163\u4e28",\ud7bf:"\u4e28\u1167",\ud7c0:"\u4e28\u1167\u4e28",\u119a:"\u4e28\u1169",\ud7c1:"\u4e28\u1169\u4e28",\ud7c2:"\u4e28\u116d",\u119b:"\u4e28\u116e",\ud7c3:"\u4e28\u1172",\u119d:"\u4e28\u119e",\ud7c4:"\u4e28\u4e28",\uf905:"\u4e32",\u{2f801}:"\u4e38",\uf95e:"\u4e39",\u{2f802}:"\u4e41","\u31e0":"\u4e59","\u2f04":"\u4e59","\u31df":"\u4e5a","\u2e83":"\u4e5a","\u31d6":"\u4e5b","\u2e82":"\u4e5b","\u2ef2":"\u4e80",\uf91b:"\u4e82","\u31da":"\u4e85","\u2f05":"\u4e85",\uf9ba:"\u4e86",\u30cb:"\u4e8c","\u2f06":"\u4e8c",\u{2f803}:"\u{20122}","\u2f07":"\u4ea0",\uf977:"\u4eae","\u2f08":"\u4eba",\u30a4:"\u4ebb","\u2e85":"\u4ebb",\uf9fd:"\u4ec0",\u{2f819}:"\u4ecc",\uf9a8:"\u4ee4",\u{2f804}:"\u4f60",\u5002:"\u4f75",\u{2f807}:"\u4f75",\ufa73:"\u4f80",\uf92d:"\u4f86",\uf9b5:"\u4f8b",\ufa30:"\u4fae",\u{2f805}:"\u4fae",\u{2f806}:"\u4fbb",\uf965:"\u4fbf",\u503c:"\u5024",\uf9d4:"\u502b",\u{2f808}:"\u507a",\u{2f809}:"\u5099",\u{2f80b}:"\u50cf",\uf9bb:"\u50da",\ufa31:"\u50e7",\u{2f80a}:"\u50e7",\u{2f80c}:"\u349e","\u2f09":"\u513f",\ufa0c:"\u5140","\u2e8e":"\u5140",\ufa74:"\u5145",\ufa32:"\u514d",\u{2f80e}:"\u514d",\u{2f80f}:"\u5154",\u{2f810}:"\u5164","\u2f0a":"\u5165",\u{2f814}:"\u5167",\ufa72:"\u5168",\uf978:"\u5169",\u30cf:"\u516b","\u2f0b":"\u516b",\uf9d1:"\u516d",\u{2f811}:"\u5177",\u{2f812}:"\u{2051c}",\u{2f91b}:"\u{20525}",\ufa75:"\u5180",\u{2f813}:"\u34b9","\u2f0c":"\u5182",\u{2f815}:"\u518d",\u{2f816}:"\u{2054b}",\u{2f8d2}:"\u5192",\u{2f8d3}:"\u5195",\u{2f9ca}:"\u34bb",\u{2f8d4}:"\u6700","\u2f0d":"\u5196",\u{2f817}:"\u5197",\u{2f818}:"\u51a4","\u2f0e":"\u51ab",\u{2f81a}:"\u51ac",\ufa71:"\u51b5",\u{2f81b}:"\u51b5",\uf92e:"\u51b7",\uf979:"\u51c9",\uf955:"\u51cc",\uf954:"\u51dc",\ufa15:"\u51de","\u2f0f":"\u51e0",\u{2f80d}:"\u{2063a}",\u{2f81d}:"\u51f5","\u2f10":"\u51f5","\u2f11":"\u5200","\u2e89":"\u5202",\u{2f81e}:"\u5203",\ufa00:"\u5207",\u{2f850}:"\u5207",\uf99c:"\u5217",\uf9dd:"\u5229",\u{2f81f}:"\u34df",\uf9ff:"\u523a",\u{2f820}:"\u523b",\u{2f821}:"\u5246",\u{2f822}:"\u5272",\u{2f823}:"\u5277",\uf9c7:"\u5289",\u{2f9d9}:"\u{20804}",\u30ab:"\u529b",\uf98a:"\u529b","\u2f12":"\u529b",\uf99d:"\u52a3",\u{2f824}:"\u3515",\u{2f992}:"\u52b3",\ufa76:"\u52c7",\u{2f825}:"\u52c7",\ufa33:"\u52c9",\u{2f826}:"\u52c9",\uf952:"\u52d2",\uf92f:"\u52de",\ufa34:"\u52e4",\u{2f827}:"\u52e4",\uf97f:"\u52f5","\u2f13":"\u52f9",\ufa77:"\u52fa",\u{2f828}:"\u52fa",\u{2f829}:"\u5305",\u{2f82a}:"\u5306",\u{2f9dd}:"\u{208de}","\u2f14":"\u5315",\uf963:"\u5317",\u{2f82b}:"\u5317","\u2f15":"\u531a","\u2f16":"\u5338",\uf9eb:"\u533f","\u2f17":"\u5341",\u3038:"\u5341",\u303a:"\u5345",\u{2f82c}:"\u5349","\u0fd6":"\u534d","\u0fd5":"\u5350",\ufa35:"\u5351",\u{2f82d}:"\u5351",\u{2f82e}:"\u535a",\u30c8:"\u535c","\u2f18":"\u535c","\u2f19":"\u5369","\u2e8b":"\u353e",\u{2f82f}:"\u5373",\uf91c:"\u5375",\u{2f830}:"\u537d",\u{2f831}:"\u537f",\u{2f832}:"\u537f",\u{2f833}:"\u537f","\u2f1a":"\u5382",\u{2f834}:"\u{20a2c}","\u2f1b":"\u53b6",\uf96b:"\u53c3","\u2f1c":"\u53c8",\u{2f836}:"\u53ca",\u{2f837}:"\u53df",\u{2f838}:"\u{20b63}",\u30ed:"\u53e3","\u2f1d":"\u53e3",\u56d7:"\u53e3","\u2f1e":"\u53e3",\uf906:"\u53e5",\u{2f839}:"\u53eb",\u{2f83a}:"\u53f1",\u{2f83b}:"\u5406",\uf9de:"\u540f",\uf9ed:"\u541d",\u{2f83d}:"\u5438",\uf980:"\u5442",\u{2f83e}:"\u5448",\u{2f83f}:"\u5468",\u{2f83c}:"\u549e",\u{2f840}:"\u54a2",\uf99e:"\u54bd",\u439b:"\u3588",\u{2f841}:"\u54f6",\u{2f842}:"\u5510",\u{2f843}:"\u5553",\u555f:"\u5553",\ufa79:"\u5555",\u{2f844}:"\u5563",\u{2f845}:"\u5584",\u{2f846}:"\u5584",\uf90b:"\u5587",\ufa7a:"\u5599",\u{2f847}:"\u5599",\ufa36:"\u559d",\ufa78:"\u559d",\u{2f848}:"\u55ab",\u{2f849}:"\u55b3",\ufa0d:"\u55c0",\u{2f84a}:"\u55c2",\ufa7b:"\u55e2",\ufa37:"\u5606",\u{2f84c}:"\u5606",\u{2f84e}:"\u5651",\u{2f84f}:"\u5674",\ufa38:"\u5668",\uf9a9:"\u56f9",\u{2f84b}:"\u5716",\u{2f84d}:"\u5717","\u2f1f":"\u571f",\u58eb:"\u571f","\u2f20":"\u571f",\u{2f855}:"\u578b",\u{2f852}:"\u57ce",\u39b3:"\u363d",\u{2f853}:"\u57f4",\u{2f854}:"\u580d",\u{2f857}:"\u5831",\u{2f856}:"\u5832",\ufa39:"\u5840",\ufa10:"\u585a",\ufa7c:"\u585a",\uf96c:"\u585e",\u586b:"\u5861",\u58ff:"\u58ab",\u{2f858}:"\u58ac",\ufa7d:"\u58b3",\uf94a:"\u58d8",\uf942:"\u58df",\u{2f859}:"\u{214e4}",\u{2f851}:"\u58ee",\u{2f85a}:"\u58f2",\u{2f85b}:"\u58f7","\u2f21":"\u5902",\u{2f85c}:"\u5906","\u2f22":"\u590a",\u30bf:"\u5915","\u2f23":"\u5915",\u{2f85d}:"\u591a",\u{2f85e}:"\u5922","\u2f24":"\u5927",\ufa7e:"\u5944",\uf90c:"\u5948",\uf909:"\u5951",\ufa7f:"\u5954",\u{2f85f}:"\u5962",\uf981:"\u5973","\u2f25":"\u5973",\u{2f860}:"\u{216a8}",\u{2f861}:"\u{216ea}",\u{2f865}:"\u59d8",\u{2f862}:"\u59ec",\u{2f863}:"\u5a1b",\u{2f864}:"\u5a27",\ufa80:"\u5a62",\u{2f866}:"\u5a66",\u5b00:"\u5aaf",\u{2f867}:"\u36ee",\u{2f868}:"\u36fc",\u{2f986}:"\u5ab5",\u{2f869}:"\u5b08",\ufa81:"\u5b28",\u{2f86a}:"\u5b3e",\u{2f86b}:"\u5b3e","\u2f26":"\u5b50","\u2f27":"\u5b80",\ufa04:"\u5b85",\u{2f86c}:"\u{219c8}",\u{2f86d}:"\u5bc3",\u{2f86e}:"\u5bd8",\uf95f:"\u5be7",\uf9aa:"\u5be7",\u{2f86f}:"\u5be7",\uf9bc:"\u5bee",\u{2f870}:"\u5bf3",\u{2f871}:"\u{21b18}","\u2f28":"\u5bf8",\u{2f872}:"\u5bff",\u{2f873}:"\u5c06","\u2f29":"\u5c0f",\u{2f875}:"\u5c22","\u2e90":"\u5c22","\u2f2a":"\u5c22","\u2e8f":"\u5c23",\u{2f876}:"\u3781","\u2f2b":"\u5c38",\uf9bd:"\u5c3f",\u{2f877}:"\u5c60",\uf94b:"\u5c62",\ufa3b:"\u5c64",\uf9df:"\u5c65",\ufa3c:"\u5c6e",\u{2f878}:"\u5c6e","\u2f2c":"\u5c6e",\u{2f8f8}:"\u{21d0b}","\u2f2d":"\u5c71",\u{2f879}:"\u5cc0",\u{2f87a}:"\u5c8d",\u{2f87b}:"\u{21de4}",\u{2f87d}:"\u{21de6}",\uf9d5:"\u5d19",\u{2f87c}:"\u5d43",\uf921:"\u5d50",\u{2f87f}:"\u5d6b",\u{2f87e}:"\u5d6e",\u{2f880}:"\u5d7c",\u{2f9f4}:"\u5db2",\uf9ab:"\u5dba","\u2f2e":"\u5ddb",\u{2f882}:"\u5de2",\u30a8:"\u5de5","\u2f2f":"\u5de5","\u2f30":"\u5df1","\u2e92":"\u5df3",\u{2f883}:"\u382f",\u{2f884}:"\u5dfd","\u2f31":"\u5dfe",\u5e32:"\u5e21",\u{2f885}:"\u5e28",\u{2f886}:"\u5e3d",\u{2f887}:"\u5e69",\u{2f888}:"\u3862",\u{2f889}:"\u{22183}","\u2f32":"\u5e72",\uf98e:"\u5e74",\u{2f939}:"\u{2219f}","\u2e93":"\u5e7a","\u2f33":"\u5e7a","\u2f34":"\u5e7f",\ufa01:"\u5ea6",\u{2f88a}:"\u387c",\u{2f88b}:"\u5eb0",\u{2f88c}:"\u5eb3",\u{2f88d}:"\u5eb6",\uf928:"\u5eca",\u{2f88e}:"\u5eca",\uf9a2:"\u5ec9",\ufa82:"\u5ed2",\ufa0b:"\u5ed3",\ufa83:"\u5ed9",\uf982:"\u5eec","\u2f35":"\u5ef4",\u{2f890}:"\u5efe","\u2f36":"\u5efe",\u{2f891}:"\u{22331}",\u{2f892}:"\u{22331}",\uf943:"\u5f04","\u2f37":"\u5f0b","\u2f38":"\u5f13",\u{2f894}:"\u5f22",\u{2f895}:"\u5f22","\u2f39":"\u5f50","\u2e94":"\u5f51",\u{2f874}:"\u5f53",\u{2f896}:"\u38c7","\u2f3a":"\u5f61",\u{2f899}:"\u5f62",\ufa84:"\u5f69",\u{2f89a}:"\u5f6b","\u2f3b":"\u5f73",\uf9d8:"\u5f8b",\u{2f89b}:"\u38e3",\u{2f89c}:"\u5f9a",\uf966:"\u5fa9",\ufa85:"\u5fad","\u2f3c":"\u5fc3","\u2e96":"\u5fc4","\u2e97":"\u38fa",\u{2f89d}:"\u5fcd",\u{2f89e}:"\u5fd7",\uf9a3:"\u5ff5",\u{2f89f}:"\u5ff9",\uf960:"\u6012",\uf9ac:"\u601c",\ufa6b:"\u6075",\u{2f8a2}:"\u391c",\u{2f8a1}:"\u393a",\u{2f8a0}:"\u6081",\ufa3d:"\u6094",\u{2f8a3}:"\u6094",\u{2f8a5}:"\u60c7",\ufa86:"\u60d8",\uf9b9:"\u60e1",\u{2f8a4}:"\u{226d4}",\ufa88:"\u6108",\ufa3e:"\u6168",\uf9d9:"\u6144",\u{2f8a6}:"\u6148",\u{2f8a7}:"\u614c",\u{2f8a9}:"\u614c",\ufa87:"\u614e",\u{2f8a8}:"\u614e",\ufa8a:"\u6160",\u{2f8aa}:"\u617a",\ufa3f:"\u618e",\ufa89:"\u618e",\u{2f8ab}:"\u618e",\uf98f:"\u6190",\u{2f8ad}:"\u61a4",\u{2f8ae}:"\u61af",\u{2f8ac}:"\u61b2",\ufad0:"\u{22844}",\ufacf:"\u{2284a}",\u{2f8af}:"\u61de",\ufa40:"\u61f2",\ufa8b:"\u61f2",\u{2f8b0}:"\u61f2",\uf90d:"\u61f6",\u{2f8b1}:"\u61f6",\uf990:"\u6200","\u2f3d":"\u6208",\u{2f8b2}:"\u6210",\u{2f8b3}:"\u621b",\uf9d2:"\u622e",\ufa8c:"\u6234","\u2f3e":"\u6236",\u6238:"\u6236","\u2f3f":"\u624b","\u2e98":"\u624c",\u{2f8b4}:"\u625d",\u{2f8b5}:"\u62b1",\uf925:"\u62c9",\uf95b:"\u62cf",\ufa02:"\u62d3",\u{2f8b6}:"\u62d4",\u{2f8ba}:"\u62fc",\uf973:"\u62fe",\u{2f8b8}:"\u{22b0c}",\u{2f8b9}:"\u633d",\u{2f8b7}:"\u6350",\u{2f8bb}:"\u6368",\uf9a4:"\u637b",\u{2f8bc}:"\u6383",\uf975:"\u63a0",\u{2f8c1}:"\u63a9",\ufa8d:"\u63c4",\u{2f8bd}:"\u63e4",\ufa8f:"\u6452",\u{2f8be}:"\u{22bf1}",\ufa8e:"\u641c",\u{2f8bf}:"\u6422",\u{2f8c0}:"\u63c5",\u{2f8c3}:"\u6469",\u{2f8c6}:"\u6477",\u{2f8c4}:"\u647e",\u{2f8c2}:"\u3a2e",\u6409:"\u3a41",\uf991:"\u649a",\u{2f8c5}:"\u649d",\uf930:"\u64c4",\u{2f8c7}:"\u3a6c","\u2f40":"\u652f","\u2f41":"\u6534","\u2e99":"\u6535",\ufa41:"\u654f",\u{2f8c8}:"\u654f",\ufa90:"\u6556",\u{2f8c9}:"\u656c",\uf969:"\u6578",\u{2f8ca}:"\u{2300a}","\u2f42":"\u6587","\u2eeb":"\u6589","\u2f43":"\u6597",\uf9be:"\u6599","\u2f44":"\u65a4","\u2f45":"\u65b9",\uf983:"\u65c5","\u2f46":"\u65e0","\u2e9b":"\u65e1",\ufa42:"\u65e2",\u{2f8cb}:"\u65e3","\u2f47":"\u65e5",\uf9e0:"\u6613",\u66f6:"\u3ada",\u{2f8d1}:"\u3ae4",\u{2f8cd}:"\u6649",\u6669:"\u665a",\ufa12:"\u6674",\ufa91:"\u6674",\ufa43:"\u6691",\u{2f8cf}:"\u6691",\uf9c5:"\u6688",\u{2f8d0}:"\u3b08",\u{2f8d5}:"\u669c",\ufa06:"\u66b4",\uf98b:"\u66c6",\u{2f8ce}:"\u3b19",\u{2f897}:"\u{232b8}","\u2f48":"\u66f0",\uf901:"\u66f4",\u{2f8cc}:"\u66f8","\u2f49":"\u6708",\u{2f980}:"\u{2335f}",\u80a6:"\u670c",\u80d0:"\u670f",\u80ca:"\u6710",\u8101:"\u6713",\u80f6:"\u3b35",\uf929:"\u6717",\ufa92:"\u6717",\u{2f8d8}:"\u6717",\u8127:"\u6718",\ufa93:"\u671b",\u{2f8d9}:"\u671b",\u5e50:"\u3b3a",\u4420:"\u3b3b",\u{2f989}:"\u{23393}",\u81a7:"\u6723",\u{2f98a}:"\u{2339c}","\u2f4a":"\u6728",\uf9e1:"\u674e",\u{2f8dc}:"\u6753",\ufa94:"\u6756",\u{2f8db}:"\u675e",\u{2f8dd}:"\u{233c3}",\u67ff:"\u676e",\uf9c8:"\u677b",\u{2f8e0}:"\u6785",\uf9f4:"\u6797",\u{2f8de}:"\u3b49",\ufad1:"\u{233d5}",\uf9c9:"\u67f3",\u{2f8df}:"\u67fa",\uf9da:"\u6817",\u{2f8e5}:"\u681f",\u{2f8e1}:"\u6852",\u{2f8e3}:"\u{2346d}",\uf97a:"\u6881",\ufa44:"\u6885",\u{2f8e2}:"\u6885",\u{2f8e4}:"\u688e",\uf9e2:"\u68a8",\u{2f8e6}:"\u6914",\u{2f8e8}:"\u6942",\ufad2:"\u3b9d",\u{2f8e7}:"\u3b9d",\u69e9:"\u3ba3",\u6a27:"\u699d",\u{2f8e9}:"\u69a3",\u{2f8ea}:"\u69ea",\uf914:"\u6a02",\uf95c:"\u6a02",\uf9bf:"\u6a02",\uf94c:"\u6a13",\u{2f8ec}:"\u{236a3}",\u{2f8eb}:"\u6aa8",\uf931:"\u6ad3",\u{2f8ed}:"\u6adb",\uf91d:"\u6b04",\u{2f8ee}:"\u3c18","\u2f4b":"\u6b20",\u{2f8ef}:"\u6b21",\u{2f8f0}:"\u{238a7}",\u{2f8f1}:"\u6b54",\u{2f8f2}:"\u3c4e","\u2f4c":"\u6b62","\u2eed":"\u6b6f",\u{2f8f3}:"\u6b72",\uf98c:"\u6b77",\ufa95:"\u6b79","\u2f4d":"\u6b79","\u2e9e":"\u6b7a",\u{2f8f4}:"\u6b9f",\uf9a5:"\u6bae","\u2f4e":"\u6bb3",\uf970:"\u6bba",\ufa96:"\u6bba",\u{2f8f5}:"\u6bba",\u{2f8f6}:"\u6bbb",\u{2f8f7}:"\u{23a8d}","\u2f4f":"\u6bcb","\u2e9f":"\u6bcd",\u{2f8f9}:"\u{23afa}","\u2f50":"\u6bd4","\u2f51":"\u6bdb","\u2f52":"\u6c0f","\u2ea0":"\u6c11","\u2f53":"\u6c14","\u2f54":"\u6c34","\u2ea1":"\u6c35","\u2ea2":"\u6c3a",\u{2f8fa}:"\u6c4e",\u{2f8fe}:"\u6c67",\uf972:"\u6c88",\u{2f8fc}:"\u6cbf",\uf968:"\u6ccc",\u{2f8fd}:"\u6ccd",\uf9e3:"\u6ce5",\u{2f8fb}:"\u{23cbc}",\uf915:"\u6d1b",\ufa05:"\u6d1e",\u{2f907}:"\u6d34",\u{2f900}:"\u6d3e",\uf9ca:"\u6d41",\ufa97:"\u6d41",\u{2f902}:"\u6d41",\u{2f8ff}:"\u6d16",\u{2f903}:"\u6d69",\uf92a:"\u6d6a",\ufa45:"\u6d77",\u{2f901}:"\u6d77",\u{2f904}:"\u6d78",\u{2f905}:"\u6d85",\u{2f906}:"\u{23d1e}",\uf9f5:"\u6dcb",\uf94d:"\u6dda",\uf9d6:"\u6dea",\u{2f90e}:"\u6df9",\ufa46:"\u6e1a",\u{2f908}:"\u6e2f",\u{2f909}:"\u6e6e",\u6f59:"\u6e88",\ufa99:"\u6ecb",\u{2f90b}:"\u6ecb",\uf9cb:"\u6e9c",\uf9ec:"\u6eba",\u{2f90c}:"\u6ec7",\uf904:"\u6ed1",\ufa98:"\u6edb",\u{2f90a}:"\u3d33",\uf94e:"\u6f0f",\ufa47:"\u6f22",\ufa9a:"\u6f22",\uf992:"\u6f23",\u{2f90d}:"\u{23ed1}",\u{2f90f}:"\u6f6e",\u{2f910}:"\u{23f5e}",\u{2f911}:"\u{23f8e}",\u{2f912}:"\u6fc6",\uf922:"\u6feb",\uf984:"\u6ffe",\u{2f915}:"\u701b",\ufa9b:"\u701e",\u{2f914}:"\u701e",\u{2f913}:"\u7039",\u{2f917}:"\u704a",\u{2f916}:"\u3d96","\u2f55":"\u706b","\u2ea3":"\u706c",\u{2f835}:"\u7070",\u{2f919}:"\u7077",\u{2f918}:"\u707d",\uf9fb:"\u7099",\u{2f91a}:"\u70ad",\uf99f:"\u70c8",\uf916:"\u70d9",\ufa48:"\u716e",\ufa9c:"\u716e",\u{2f91d}:"\u{24263}",\u{2f91c}:"\u7145",\uf993:"\u7149",\ufa6c:"\u{242ee}",\u{2f91e}:"\u719c",\uf9c0:"\u71ce",\uf9ee:"\u71d0",\u{2f91f}:"\u{243ab}",\uf932:"\u7210",\uf91e:"\u721b",\u{2f920}:"\u7228","\u2f56":"\u722a",\ufa49:"\u722b","\u2ea4":"\u722b",\ufa9e:"\u7235",\u{2f921}:"\u7235","\u2f57":"\u7236","\u2f58":"\u723b","\u2ea6":"\u4e2c","\u2f59":"\u723f","\u2f5a":"\u7247",\u{2f922}:"\u7250","\u2f5b":"\u7259",\u{2f923}:"\u{24608}","\u2f5c":"\u725b",\uf946:"\u7262",\u{2f924}:"\u7280",\u{2f925}:"\u7295","\u2f5d":"\u72ac","\u2ea8":"\u72ad",\ufa9f:"\u72af",\uf9fa:"\u72c0",\u{2f926}:"\u{24735}",\uf92b:"\u72fc",\ufa16:"\u732a",\ufaa0:"\u732a",\u{2f927}:"\u{24814}",\uf9a7:"\u7375",\u{2f928}:"\u737a","\u2f5e":"\u7384",\uf961:"\u7387",\uf9db:"\u7387","\u2f5f":"\u7389",\u{2f929}:"\u738b",\u{2f92a}:"\u3eac",\u{2f92b}:"\u73a5",\uf9ad:"\u73b2",\u{2f92c}:"\u3eb8",\u{2f92d}:"\u3eb8",\uf917:"\u73de",\uf9cc:"\u7409",\uf9e4:"\u7406",\ufa4a:"\u7422",\u{2f92e}:"\u7447",\u{2f92f}:"\u745c",\uf9ae:"\u7469",\ufaa1:"\u7471",\u{2f930}:"\u7471",\u{2f931}:"\u7485",\uf994:"\u7489",\uf9ef:"\u7498",\u{2f932}:"\u74ca","\u2f60":"\u74dc","\u2f61":"\u74e6",\u{2f933}:"\u3f1b",\ufaa2:"\u7506","\u2f62":"\u7518","\u2f63":"\u751f",\u{2f934}:"\u7524","\u2f64":"\u7528","\u2f65":"\u7530",\ufaa3:"\u753b",\u{2f936}:"\u753e",\u{2f935}:"\u{24c36}",\uf9cd:"\u7559",\uf976:"\u7565",\uf962:"\u7570",\u{2f938}:"\u7570",\u{2f937}:"\u{24c92}","\u2f66":"\u758b","\u2f67":"\u7592",\uf9e5:"\u75e2",\u{2f93a}:"\u7610",\ufaa5:"\u761f",\ufaa4:"\u761d",\uf9c1:"\u7642",\uf90e:"\u7669","\u2f68":"\u7676","\u2f69":"\u767d",\u{2f93b}:"\u{24fa1}",\u{2f93c}:"\u{24fb8}","\u2f6a":"\u76ae","\u2f6b":"\u76bf",\u{2f93d}:"\u{25044}",\u{2f93e}:"\u3ffc",\ufa17:"\u76ca",\ufaa6:"\u76ca",\ufaa7:"\u76db",\uf933:"\u76e7",\u{2f93f}:"\u4008","\u2f6c":"\u76ee",\ufaa8:"\u76f4",\u{2f940}:"\u76f4",\u{2f942}:"\u{250f2}",\u{2f941}:"\u{250f3}",\uf96d:"\u7701",\ufad3:"\u4018",\u{2f943}:"\u{25119}",\u{2f945}:"\u771e",\u{2f946}:"\u771f",\u{2f947}:"\u771f",\u{2f944}:"\u{25133}",\ufaaa:"\u7740",\ufaa9:"\u774a",\u{2f948}:"\u774a",\u9fc3:"\u4039",\ufad4:"\u4039",\u{2f949}:"\u4039",\u6663:"\u403f",\u{2f94b}:"\u4046",\u{2f94a}:"\u778b",\ufad5:"\u{25249}",\ufa9d:"\u77a7","\u2f6d":"\u77db","\u2f6e":"\u77e2","\u2f6f":"\u77f3",\u{2f94c}:"\u4096",\u{2f94d}:"\u{2541d}",\u784f:"\u7814",\u{2f94e}:"\u784e",\uf9ce:"\u786b",\uf93b:"\u788c",\u{2f94f}:"\u788c",\ufa4b:"\u7891",\uf947:"\u78ca",\ufaab:"\u78cc",\u{2f950}:"\u78cc",\uf964:"\u78fb",\u{2f951}:"\u40e3",\uf985:"\u792a","\u2f70":"\u793a","\u2ead":"\u793b",\ufa18:"\u793c",\ufa4c:"\u793e",\ufa4e:"\u7948",\ufa4d:"\u7949",\u{2f952}:"\u{25626}",\ufa4f:"\u7950",\ufa50:"\u7956",\u{2f953}:"\u7956",\ufa51:"\u795d",\ufa19:"\u795e",\ufa1a:"\u7965",\ufa61:"\u8996",\ufab8:"\u8996",\uf93c:"\u797f",\u{2f954}:"\u{2569a}",\ufa52:"\u798d",\ufa53:"\u798e",\ufa1b:"\u798f",\u{2f956}:"\u798f",\u{2f955}:"\u{256c5}",\uf9b6:"\u79ae","\u2f71":"\u79b8","\u2f72":"\u79be",\uf995:"\u79ca",\u{2f958}:"\u412f",\u{2f957}:"\u79eb",\uf956:"\u7a1c",\u{2f95a}:"\u7a4a",\ufa54:"\u7a40",\u{2f959}:"\u7a40",\u{2f95b}:"\u7a4f","\u2f73":"\u7a74",\ufa55:"\u7a81",\u{2f95c}:"\u{2597c}",\ufaac:"\u7ab1",\uf9f7:"\u7acb","\u2f74":"\u7acb","\u2eef":"\u7adc",\u{2f95d}:"\u{25aa7}",\u{2f95e}:"\u{25aa7}",\u{2f95f}:"\u7aee","\u2f75":"\u7af9",\uf9f8:"\u7b20",\ufa56:"\u7bc0",\ufaad:"\u7bc0",\u{2f960}:"\u4202",\u{2f961}:"\u{25bab}",\u{2f962}:"\u7bc6",\u{2f964}:"\u4227",\u{2f963}:"\u7bc9",\u{2f965}:"\u{25c80}",\ufad6:"\u{25cd0}",\uf9a6:"\u7c3e",\uf944:"\u7c60","\u2f76":"\u7c73",\ufaae:"\u7c7b",\uf9f9:"\u7c92",\ufa1d:"\u7cbe",\u{2f966}:"\u7cd2",\ufa03:"\u7cd6",\u{2f968}:"\u7ce8",\u{2f967}:"\u42a0",\u{2f969}:"\u7ce3",\uf97b:"\u7ce7","\u2f77":"\u7cf8","\u2eaf":"\u7cf9",\u{2f96b}:"\u{25f86}",\u{2f96a}:"\u7d00",\uf9cf:"\u7d10",\uf96a:"\u7d22",\uf94f:"\u7d2f",\u7d76:"\u7d55",\u{2f96c}:"\u7d63",\ufaaf:"\u7d5b",\uf93d:"\u7da0",\uf957:"\u7dbe",\u{2f96e}:"\u7dc7",\uf996:"\u7df4",\ufa57:"\u7df4",\ufab0:"\u7df4",\u{2f96f}:"\u7e02",\u{2f96d}:"\u4301",\ufa58:"\u7e09",\uf950:"\u7e37",\ufa59:"\u7e41",\u{2f970}:"\u7e45",\u{2f898}:"\u{261da}",\u{2f971}:"\u4334","\u2f78":"\u7f36",\u{2f972}:"\u{26228}",\ufab1:"\u7f3e",\u{2f973}:"\u{26247}","\u2f79":"\u7f51","\u2eab":"\u7f52","\u2eb2":"\u7f52","\u2eb1":"\u7f53",\u{2f974}:"\u4359",\ufa5a:"\u7f72",\u{2f975}:"\u{262d9}",\uf9e6:"\u7f79",\u{2f976}:"\u7f7a",\uf90f:"\u7f85",\u{2f977}:"\u{2633e}","\u2f7a":"\u7f8a",\u{2f978}:"\u7f95",\uf9af:"\u7f9a",\ufa1e:"\u7fbd","\u2f7b":"\u7fbd",\u{2f979}:"\u7ffa",\uf934:"\u8001","\u2f7c":"\u8001","\u2eb9":"\u8002",\ufa5b:"\u8005",\ufab2:"\u8005",\u{2f97a}:"\u8005","\u2f7d":"\u800c",\u{2f97b}:"\u{264da}","\u2f7e":"\u8012",\u{2f97c}:"\u{26523}","\u2f7f":"\u8033",\uf9b0:"\u8046",\u{2f97d}:"\u8060",\u{2f97e}:"\u{265a8}",\uf997:"\u806f",\u{2f97f}:"\u8070",\uf945:"\u807e","\u2f80":"\u807f","\u2eba":"\u8080","\u2f81":"\u8089",\uf953:"\u808b",\u{2f8d6}:"\u80ad",\u{2f982}:"\u80b2",\u{2f981}:"\u43d5",\u{2f8d7}:"\u43d9",\u8141:"\u80fc",\u{2f983}:"\u8103",\u{2f985}:"\u813e",\u{2f984}:"\u440b",\u{2f8da}:"\u6721",\u{2f987}:"\u{267a7}",\u{2f988}:"\u{267b5}",\u6726:"\u4443",\uf926:"\u81d8","\u2f82":"\u81e3",\uf9f6:"\u81e8","\u2f83":"\u81ea",\ufa5c:"\u81ed","\u2f84":"\u81f3","\u2f85":"\u81fc",\u{2f893}:"\u8201",\u{2f98b}:"\u8201",\u{2f98c}:"\u8204","\u2f86":"\u820c",\ufa6d:"\u8218","\u2f87":"\u821b","\u2f88":"\u821f",\u{2f98e}:"\u446b","\u2f89":"\u826e",\uf97c:"\u826f","\u2f8a":"\u8272","\u2f8b":"\u8278",\ufa5d:"\u8279",\ufa5e:"\u8279","\u2ebe":"\u8279","\u2ebf":"\u8279","\u2ec0":"\u8279",\u{2f990}:"\u828b",\u{2f98f}:"\u8291",\u{2f991}:"\u829d",\u{2f993}:"\u82b1",\u{2f994}:"\u82b3",\u{2f995}:"\u82bd",\uf974:"\u82e5",\u{2f998}:"\u82e5",\u{2f996}:"\u82e6",\u{2f997}:"\u{26b3c}",\uf9fe:"\u8336",\ufab3:"\u8352",\u{2f99a}:"\u8363",\u{2f999}:"\u831d",\u{2f99c}:"\u8323",\u{2f99d}:"\u83bd",\u{2f9a0}:"\u8353",\uf93e:"\u83c9",\u{2f9a1}:"\u83ca",\u{2f9a2}:"\u83cc",\u{2f9a3}:"\u83dc",\u{2f99e}:"\u83e7",\ufab4:"\u83ef",\uf958:"\u83f1",\ufa5f:"\u8457",\u{2f99f}:"\u8457",\u{2f9a4}:"\u{26c36}",\u{2f99b}:"\u83ad",\uf918:"\u843d",\uf96e:"\u8449",\u853f:"\u848d",\u{2f9a6}:"\u{26cd5}",\u{2f9a5}:"\u{26d6b}",\uf999:"\u84ee",\u{2f9a8}:"\u84f1",\u{2f9a9}:"\u84f3",\uf9c2:"\u84fc",\u{2f9aa}:"\u8516",\u{2f9a7}:"\u452b",\u{2f9ac}:"\u8564",\u{2f9ad}:"\u{26f2c}",\uf923:"\u85cd",\u{2f9ae}:"\u455d",\u{2f9b0}:"\u{26fb1}",\u{2f9af}:"\u4561",\uf9f0:"\u85fa",\uf935:"\u8606",\u{2f9b2}:"\u456b",\ufa20:"\u8612",\uf91f:"\u862d",\u{2f9b1}:"\u{270d2}",\u8641:"\u8637",\uf910:"\u863f","\u2f8c":"\u864d","\u2ec1":"\u864e",\u{2f9b3}:"\u8650",\uf936:"\u865c",\u{2f9b4}:"\u865c",\u{2f9b5}:"\u8667",\u{2f9b6}:"\u8669","\u2f8d":"\u866b",\u{2f9b7}:"\u86a9",\u{2f9b8}:"\u8688",\u{2f9ba}:"\u86e2",\u{2f9b9}:"\u870e",\u{2f9bc}:"\u8728",\u{2f9bd}:"\u876b",\u{2f9c0}:"\u87e1",\ufab5:"\u8779",\u{2f9bb}:"\u8779",\u{2f9be}:"\u8786",\u{2f9bf}:"\u45d7",\u{2f9ab}:"\u{273ca}",\uf911:"\u87ba",\u{2f9c1}:"\u8801",\u{2f9c2}:"\u45f9",\uf927:"\u881f","\u2f8e":"\u8840",\ufa08:"\u884c","\u2f8f":"\u884c",\u{2f9c3}:"\u8860",\u{2f9c4}:"\u8863","\u2f90":"\u8863","\u2ec2":"\u8864",\uf9a0:"\u88c2",\u{2f9c5}:"\u{27667}",\uf9e7:"\u88cf",\u{2f9c6}:"\u88d7",\u{2f9c7}:"\u88de",\uf9e8:"\u88e1",\uf912:"\u88f8",\u{2f9c9}:"\u88fa",\u{2f9c8}:"\u4635",\ufa60:"\u8910",\ufab6:"\u8941",\uf924:"\u8964","\u2f91":"\u897e","\u2ec4":"\u897f","\u2ec3":"\u8980",\ufab7:"\u8986",\ufa0a:"\u898b","\u2f92":"\u898b",\u{2f9cb}:"\u{278ae}","\u2ec5":"\u89c1","\u2f93":"\u89d2","\u2f94":"\u8a00",\u{2f9cc}:"\u{27966}",\u8a7d:"\u8a2e",\u8a1e:"\u46b6",\u{2f9cd}:"\u46be",\u{2f9ce}:"\u46c7",\u{2f9cf}:"\u8aa0",\uf96f:"\u8aaa",\uf9a1:"\u8aaa",\ufab9:"\u8abf",\ufabb:"\u8acb",\uf97d:"\u8ad2",\uf941:"\u8ad6",\ufabe:"\u8aed",\u{2f9d0}:"\u8aed",\ufa22:"\u8af8",\ufaba:"\u8af8",\uf95d:"\u8afe",\ufabd:"\u8afe",\ufa62:"\u8b01",\ufabc:"\u8b01",\ufa63:"\u8b39",\ufabf:"\u8b39",\uf9fc:"\u8b58",\uf95a:"\u8b80",\u8b8f:"\u8b86",\ufac0:"\u8b8a",\u{2f9d1}:"\u8b8a","\u2ec8":"\u8ba0","\u2f95":"\u8c37","\u2f96":"\u8c46",\uf900:"\u8c48",\u{2f9d2}:"\u8c55","\u2f97":"\u8c55",\u8c63:"\u8c5c","\u2f98":"\u8c78",\u{2f9d3}:"\u{27ca8}","\u2f99":"\u8c9d",\u{2f9d4}:"\u8cab",\u{2f9d5}:"\u8cc1",\uf948:"\u8cc2",\uf903:"\u8cc8",\ufa64:"\u8cd3",\ufa65:"\u8d08",\ufac1:"\u8d08",\u{2f9d6}:"\u8d1b","\u2ec9":"\u8d1d","\u2f9a":"\u8d64","\u2f9b":"\u8d70",\u{2f9d7}:"\u8d77",\u8d86:"\u8d7f",\ufad7:"\u{27ed3}",\u{2f9d8}:"\u{27f2f}","\u2f9c":"\u8db3",\u{2f9da}:"\u8dcb",\u{2f9db}:"\u8dbc",\u8dfa:"\u8de5",\uf937:"\u8def",\u{2f9dc}:"\u8df0",\u8e9b:"\u8e97","\u2f9d":"\u8eab",\uf902:"\u8eca","\u2f9e":"\u8eca",\u{2f9de}:"\u8ed4",\u8f27:"\u8eff",\uf998:"\u8f26",\uf9d7:"\u8f2a",\ufac2:"\u8f38",\u{2f9df}:"\u8f38",\ufa07:"\u8f3b",\uf98d:"\u8f62","\u2ecb":"\u8f66","\u2f9f":"\u8f9b",\u{2f98d}:"\u8f9e",\uf971:"\u8fb0","\u2fa0":"\u8fb0","\u2fa1":"\u8fb5",\ufa66:"\u8fb6","\u2ecc":"\u8fb6","\u2ecd":"\u8fb6",\u{2f881}:"\u5de1",\uf99a:"\u9023",\ufa25:"\u9038",\ufa67:"\u9038",\ufac3:"\u9072",\uf9c3:"\u907c",\u{2f9e0}:"\u{285d2}",\u{2f9e1}:"\u{285ed}",\uf913:"\u908f","\u2fa2":"\u9091",\u{2f9e2}:"\u9094",\uf92c:"\u90ce",\u90de:"\u90ce",\ufa2e:"\u90ce",\u{2f9e3}:"\u90f1",\ufa26:"\u90fd",\u{2f9e5}:"\u{2872e}",\u{2f9e4}:"\u9111",\u{2f9e6}:"\u911b","\u2fa3":"\u9149",\uf919:"\u916a",\ufac4:"\u9199",\uf9b7:"\u91b4","\u2fa4":"\u91c6",\uf9e9:"\u91cc","\u2fa5":"\u91cc",\uf97e:"\u91cf",\uf90a:"\u91d1","\u2fa6":"\u91d1",\uf9b1:"\u9234",\u{2f9e7}:"\u9238",\ufac5:"\u9276",\u{2f9e8}:"\u92d7",\u{2f9e9}:"\u92d8",\u{2f9ea}:"\u927c",\uf93f:"\u9304",\uf99b:"\u934a",\u93ae:"\u93ad",\u{2f9eb}:"\u93f9",\u{2f9ec}:"\u9415",\u{2f9ed}:"\u{28bfa}","\u2ed0":"\u9485","\u2ed1":"\u9577","\u2fa7":"\u9577","\u2ed2":"\u9578","\u2ed3":"\u957f","\u2fa8":"\u9580",\u{2f9ee}:"\u958b",\u{2f9ef}:"\u4995",\uf986:"\u95ad",\u{2f9f0}:"\u95b7",\u{2f9f1}:"\u{28d77}","\u2ed4":"\u95e8","\u2fa9":"\u961c","\u2ecf":"\u961d","\u2ed6":"\u961d",\uf9c6:"\u962e",\uf951:"\u964b",\ufa09:"\u964d",\uf959:"\u9675",\uf9d3:"\u9678",\ufac6:"\u967c",\uf9dc:"\u9686",\uf9f1:"\u96a3",\u{2f9f2}:"\u49e6","\u2faa":"\u96b6",\ufa2f:"\u96b7",\u96b8:"\u96b7",\uf9b8:"\u96b7","\u2fab":"\u96b9",\u{2f9f3}:"\u96c3",\uf9ea:"\u96e2",\ufa68:"\u96e3",\ufac7:"\u96e3","\u2fac":"\u96e8",\uf9b2:"\u96f6",\uf949:"\u96f7",\u{2f9f5}:"\u9723",\u{2f9f6}:"\u{29145}",\uf938:"\u9732",\uf9b3:"\u9748","\u2fad":"\u9751","\u2ed8":"\u9752",\ufa1c:"\u9756",\ufac8:"\u9756",\u{2f81c}:"\u{291df}","\u2fae":"\u975e","\u2faf":"\u9762",\u{2f9f7}:"\u{2921a}","\u2fb0":"\u9769",\u{2f9f8}:"\u4a6e",\u{2f9f9}:"\u4a76","\u2fb1":"\u97cb",\ufac9:"\u97db",\u{2f9fa}:"\u97e0","\u2ed9":"\u97e6","\u2fb2":"\u97ed",\u{2f9fb}:"\u{2940a}","\u2fb3":"\u97f3",\ufa69:"\u97ff",\ufaca:"\u97ff","\u2fb4":"\u9801",\u{2f9fc}:"\u4ab2",\ufacb:"\u980b",\u{2f9fe}:"\u980b",\u{2f9ff}:"\u980b",\uf9b4:"\u9818",\u{2fa00}:"\u9829",\u{2f9fd}:"\u{29496}",\ufa6a:"\u983b",\ufacc:"\u983b",\uf9d0:"\u985e","\u2eda":"\u9875","\u2fb5":"\u98a8",\u{2fa01}:"\u{295b6}","\u2edb":"\u98ce","\u2fb6":"\u98db","\u2edc":"\u98de","\u2edd":"\u98df","\u2fb7":"\u98df","\u2edf":"\u98e0",\u{2fa02}:"\u98e2",\ufa2a:"\u98ef",\ufa2b:"\u98fc",\u{2fa03}:"\u4b33",\ufa2c:"\u9928",\u{2fa04}:"\u9929","\u2ee0":"\u9963","\u2fb8":"\u9996","\u2fb9":"\u9999",\u{2fa05}:"\u99a7","\u2fba":"\u99ac",\u{2fa06}:"\u99c2",\uf91a:"\u99f1",\u{2fa07}:"\u99fe",\uf987:"\u9a6a","\u2ee2":"\u9a6c","\u2fbb":"\u9aa8",\u{2fa08}:"\u4bce","\u2fbc":"\u9ad8","\u2fbd":"\u9adf",\u{2fa09}:"\u{29b30}",\ufacd:"\u9b12",\u{2fa0a}:"\u9b12","\u2fbe":"\u9b25","\u2fbf":"\u9b2f","\u2fc0":"\u9b32","\u2fc1":"\u9b3c","\u2ee4":"\u9b3c","\u2fc2":"\u9b5a",\uf939:"\u9b6f",\u{2fa0b}:"\u9c40",\uf9f2:"\u9c57","\u2ee5":"\u9c7c","\u2fc3":"\u9ce5",\u{2fa0c}:"\u9cfd",\u{2fa0d}:"\u4cce",\u{2fa0f}:"\u9d67",\u{2fa0e}:"\u4ced",\u{2fa10}:"\u{2a0ce}",\ufa2d:"\u9db4",\u{2fa12}:"\u{2a105}",\u{2fa11}:"\u4cf8",\uf93a:"\u9dfa",\u{2fa13}:"\u{2a20e}",\uf920:"\u9e1e",\u9e43:"\u9e42","\u2fc4":"\u9e75",\uf940:"\u9e7f","\u2fc5":"\u9e7f",\u{2fa14}:"\u{2a291}",\uf988:"\u9e97",\uf9f3:"\u9e9f","\u2fc6":"\u9ea5","\u2ee8":"\u9ea6",\u{2fa15}:"\u9ebb","\u2fc7":"\u9ebb",\u{2f88f}:"\u{2a392}","\u2fc8":"\u9ec3","\u2ee9":"\u9ec4","\u2fc9":"\u9ecd",\uf989:"\u9ece",\u{2fa16}:"\u4d56","\u2fca":"\u9ed1",\u9ed2:"\u9ed1",\ufa3a:"\u58a8",\u{2fa17}:"\u9ef9","\u2fcb":"\u9ef9","\u2fcc":"\u9efd",\u{2fa19}:"\u9f05",\u{2fa18}:"\u9efe","\u2fcd":"\u9f0e",\u{2fa1a}:"\u9f0f","\u2fce":"\u9f13",\u{2fa1b}:"\u9f16","\u2fcf":"\u9f20",\u{2fa1c}:"\u9f3b","\u2fd0":"\u9f3b",\ufad8:"\u9f43","\u2fd1":"\u9f4a","\u2eec":"\u9f50","\u2fd2":"\u9f52",\u{2fa1d}:"\u{2a600}","\u2eee":"\u9f7f",\uf9c4:"\u9f8d","\u2fd3":"\u9f8d",\ufad9:"\u9f8e","\u2ef0":"\u9f99",\uf907:"\u9f9c",\uf908:"\u9f9c",\uface:"\u9f9c","\u2fd4":"\u9f9c","\u2ef3":"\u9f9f","\u2fd5":"\u9fa0"}},{}],281:[function(m,ie,a){"use strict";var R=m("./data.json"),E=RegExp(Object.keys(R).map(function I(u){return u.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}).join("|"),"g");function _(u){return R[u]}ie.exports=function d(u){return u.replace(E,_)}},{"./data.json":280}],282:[function(m,ie,a){(function(R){(function(){function E(_){try{if(!R.localStorage)return!1}catch{return!1}var d=R.localStorage[_];return null!=d&&"true"===String(d).toLowerCase()}ie.exports=function I(_,d){if(E("noDeprecation"))return _;var u=!1;return function g(){if(!u){if(E("throwDeprecation"))throw new Error(d);E("traceDeprecation")?console.trace(d):console.warn(d),u=!0}return _.apply(this,arguments)}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],283:[function(m,ie,a){ie.exports=function(I){return I&&"object"==typeof I&&"function"==typeof I.copy&&"function"==typeof I.fill&&"function"==typeof I.readUInt8}},{}],284:[function(m,ie,a){"use strict";var R=m("is-arguments"),I=m("is-generator-function"),E=m("which-typed-array"),_=m("is-typed-array");function d(se){return se.call.bind(se)}var u=typeof BigInt<"u",g=typeof Symbol<"u",f=d(Object.prototype.toString),v=d(Number.prototype.valueOf),c=d(String.prototype.valueOf),i=d(Boolean.prototype.valueOf);if(u)var r=d(BigInt.prototype.valueOf);if(g)var s=d(Symbol.prototype.valueOf);function t(se,he){if("object"!=typeof se)return!1;try{return he(se),!0}catch{return!1}}function M(se){return"[object Map]"===f(se)}function j(se){return"[object Set]"===f(se)}function F(se){return"[object WeakMap]"===f(se)}function N(se){return"[object WeakSet]"===f(se)}function S(se){return"[object ArrayBuffer]"===f(se)}function U(se){return!(typeof ArrayBuffer>"u")&&(S.working?S(se):se instanceof ArrayBuffer)}function W(se){return"[object DataView]"===f(se)}function k(se){return!(typeof DataView>"u")&&(W.working?W(se):se instanceof DataView)}a.isArgumentsObject=R,a.isGeneratorFunction=I,a.isTypedArray=_,a.isPromise=function n(se){return typeof Promise<"u"&&se instanceof Promise||null!==se&&"object"==typeof se&&"function"==typeof se.then&&"function"==typeof se.catch},a.isArrayBufferView=function o(se){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(se):_(se)||k(se)},a.isUint8Array=function h(se){return"Uint8Array"===E(se)},a.isUint8ClampedArray=function l(se){return"Uint8ClampedArray"===E(se)},a.isUint16Array=function e(se){return"Uint16Array"===E(se)},a.isUint32Array=function p(se){return"Uint32Array"===E(se)},a.isInt8Array=function b(se){return"Int8Array"===E(se)},a.isInt16Array=function y(se){return"Int16Array"===E(se)},a.isInt32Array=function w(se){return"Int32Array"===E(se)},a.isFloat32Array=function x(se){return"Float32Array"===E(se)},a.isFloat64Array=function B(se){return"Float64Array"===E(se)},a.isBigInt64Array=function J(se){return"BigInt64Array"===E(se)},a.isBigUint64Array=function z(se){return"BigUint64Array"===E(se)},M.working=typeof Map<"u"&&M(new Map),a.isMap=function L(se){return!(typeof Map>"u")&&(M.working?M(se):se instanceof Map)},j.working=typeof Set<"u"&&j(new Set),a.isSet=function C(se){return!(typeof Set>"u")&&(j.working?j(se):se instanceof Set)},F.working=typeof WeakMap<"u"&&F(new WeakMap),a.isWeakMap=function V(se){return!(typeof WeakMap>"u")&&(F.working?F(se):se instanceof WeakMap)},N.working=typeof WeakSet<"u"&&N(new WeakSet),a.isWeakSet=function T(se){return N(se)},S.working=typeof ArrayBuffer<"u"&&S(new ArrayBuffer),a.isArrayBuffer=U,W.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&W(new DataView(new ArrayBuffer(1),0,1)),a.isDataView=k;var D=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Q(se){return"[object SharedArrayBuffer]"===f(se)}function ee(se){return!(typeof D>"u")&&(typeof Q.working>"u"&&(Q.working=Q(new D)),Q.working?Q(se):se instanceof D)}function ne(se){return t(se,v)}function ce(se){return t(se,c)}function te(se){return t(se,i)}function P(se){return u&&t(se,r)}function A(se){return g&&t(se,s)}a.isSharedArrayBuffer=ee,a.isAsyncFunction=function ae(se){return"[object AsyncFunction]"===f(se)},a.isMapIterator=function ue(se){return"[object Map Iterator]"===f(se)},a.isSetIterator=function be(se){return"[object Set Iterator]"===f(se)},a.isGeneratorObject=function X(se){return"[object Generator]"===f(se)},a.isWebAssemblyCompiledModule=function H(se){return"[object WebAssembly.Module]"===f(se)},a.isNumberObject=ne,a.isStringObject=ce,a.isBooleanObject=te,a.isBigIntObject=P,a.isSymbolObject=A,a.isBoxedPrimitive=function $(se){return ne(se)||ce(se)||te(se)||P(se)||A(se)},a.isAnyArrayBuffer=function G(se){return typeof Uint8Array<"u"&&(U(se)||ee(se))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(se){Object.defineProperty(a,se,{enumerable:!1,value:function(){throw new Error(se+" is not supported in userland")}})})},{"is-arguments":147,"is-generator-function":149,"is-typed-array":150,"which-typed-array":296}],285:[function(m,ie,a){(function(R){(function(){var I=Object.getOwnPropertyDescriptors||function(D){for(var Q=Object.keys(D),ee={},ae=0;ae<Q.length;ae++)ee[Q[ae]]=Object.getOwnPropertyDescriptor(D,Q[ae]);return ee},E=/%[sdj%]/g;a.format=function(k){if(!y(k)){for(var D=[],Q=0;Q<arguments.length;Q++)D.push(g(arguments[Q]));return D.join(" ")}Q=1;for(var ee=arguments,ae=ee.length,ue=String(k).replace(E,function(X){if("%%"===X)return"%";if(Q>=ae)return X;switch(X){case"%s":return String(ee[Q++]);case"%d":return Number(ee[Q++]);case"%j":try{return JSON.stringify(ee[Q++])}catch{return"[Circular]"}default:return X}}),be=ee[Q];Q<ae;be=ee[++Q])e(be)||!J(be)?ue+=" "+be:ue+=" "+g(be);return ue},a.deprecate=function(k,D){if(typeof R<"u"&&!0===R.noDeprecation)return k;if(typeof R>"u")return function(){return a.deprecate(k,D).apply(this,arguments)};var Q=!1;return function ee(){if(!Q){if(R.throwDeprecation)throw new Error(D);R.traceDeprecation?console.trace(D):console.error(D),Q=!0}return k.apply(this,arguments)}};var _={},d=/^$/;if(R.env.NODE_DEBUG){var u=R.env.NODE_DEBUG;u=u.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),d=new RegExp("^"+u+"$","i")}function g(k,D){var Q={seen:[],stylize:v};return arguments.length>=3&&(Q.depth=arguments[2]),arguments.length>=4&&(Q.colors=arguments[3]),l(D)?Q.showHidden=D:D&&a._extend(Q,D),x(Q.showHidden)&&(Q.showHidden=!1),x(Q.depth)&&(Q.depth=2),x(Q.colors)&&(Q.colors=!1),x(Q.customInspect)&&(Q.customInspect=!0),Q.colors&&(Q.stylize=f),i(Q,k,Q.depth)}function f(k,D){var Q=g.styles[D];return Q?"\x1b["+g.colors[Q][0]+"m"+k+"\x1b["+g.colors[Q][1]+"m":k}function v(k,D){return k}function i(k,D,Q){if(k.customInspect&&D&&L(D.inspect)&&D.inspect!==a.inspect&&(!D.constructor||D.constructor.prototype!==D)){var ee=D.inspect(Q,k);return y(ee)||(ee=i(k,ee,Q)),ee}var ae=function r(k,D){if(x(D))return k.stylize("undefined","undefined");if(y(D)){var Q="'"+JSON.stringify(D).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return k.stylize(Q,"string")}return b(D)?k.stylize(""+D,"number"):l(D)?k.stylize(""+D,"boolean"):e(D)?k.stylize("null","null"):void 0}(k,D);if(ae)return ae;var ue=Object.keys(D),be=function c(k){var D={};return k.forEach(function(Q,ee){D[Q]=!0}),D}(ue);if(k.showHidden&&(ue=Object.getOwnPropertyNames(D)),M(D)&&(ue.indexOf("message")>=0||ue.indexOf("description")>=0))return s(D);if(0===ue.length){if(L(D))return k.stylize("[Function"+(D.name?": "+D.name:"")+"]","special");if(B(D))return k.stylize(RegExp.prototype.toString.call(D),"regexp");if(z(D))return k.stylize(Date.prototype.toString.call(D),"date");if(M(D))return s(D)}var P,H="",ne=!1,ce=["{","}"];return h(D)&&(ne=!0,ce=["[","]"]),L(D)&&(H=" [Function"+(D.name?": "+D.name:"")+"]"),B(D)&&(H=" "+RegExp.prototype.toString.call(D)),z(D)&&(H=" "+Date.prototype.toUTCString.call(D)),M(D)&&(H=" "+s(D)),0!==ue.length||ne&&0!=D.length?Q<0?B(D)?k.stylize(RegExp.prototype.toString.call(D),"regexp"):k.stylize("[Object]","special"):(k.seen.push(D),P=ne?function t(k,D,Q,ee,ae){for(var ue=[],be=0,X=D.length;be<X;++be)T(D,String(be))?ue.push(n(k,D,Q,ee,String(be),!0)):ue.push("");return ae.forEach(function(H){H.match(/^\d+$/)||ue.push(n(k,D,Q,ee,H,!0))}),ue}(k,D,Q,be,ue):ue.map(function(A){return n(k,D,Q,be,A,ne)}),k.seen.pop(),function o(k,D,Q){var ae=k.reduce(function(ue,be){return be.indexOf("\n"),ue+be.replace(/\u001b\[\d\d?m/g,"").length+1},0);return ae>60?Q[0]+(""===D?"":D+"\n ")+" "+k.join(",\n  ")+" "+Q[1]:Q[0]+D+" "+k.join(", ")+" "+Q[1]}(P,H,ce)):ce[0]+H+ce[1]}function s(k){return"["+Error.prototype.toString.call(k)+"]"}function n(k,D,Q,ee,ae,ue){var be,X,H;if((H=Object.getOwnPropertyDescriptor(D,ae)||{value:D[ae]}).get?X=k.stylize(H.set?"[Getter/Setter]":"[Getter]","special"):H.set&&(X=k.stylize("[Setter]","special")),T(ee,ae)||(be="["+ae+"]"),X||(k.seen.indexOf(H.value)<0?(X=e(Q)?i(k,H.value,null):i(k,H.value,Q-1)).indexOf("\n")>-1&&(X=ue?X.split("\n").map(function(ne){return"  "+ne}).join("\n").slice(2):"\n"+X.split("\n").map(function(ne){return"   "+ne}).join("\n")):X=k.stylize("[Circular]","special")),x(be)){if(ue&&ae.match(/^\d+$/))return X;(be=JSON.stringify(""+ae)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(be=be.slice(1,-1),be=k.stylize(be,"name")):(be=be.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),be=k.stylize(be,"string"))}return be+": "+X}function h(k){return Array.isArray(k)}function l(k){return"boolean"==typeof k}function e(k){return null===k}function b(k){return"number"==typeof k}function y(k){return"string"==typeof k}function x(k){return void 0===k}function B(k){return J(k)&&"[object RegExp]"===C(k)}function J(k){return"object"==typeof k&&null!==k}function z(k){return J(k)&&"[object Date]"===C(k)}function M(k){return J(k)&&("[object Error]"===C(k)||k instanceof Error)}function L(k){return"function"==typeof k}function C(k){return Object.prototype.toString.call(k)}function F(k){return k<10?"0"+k.toString(10):k.toString(10)}a.debuglog=function(k){if(k=k.toUpperCase(),!_[k])if(d.test(k)){var D=R.pid;_[k]=function(){var Q=a.format.apply(a,arguments);console.error("%s %d: %s",k,D,Q)}}else _[k]=function(){};return _[k]},a.inspect=g,g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},g.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},a.types=m("./support/types"),a.isArray=h,a.isBoolean=l,a.isNull=e,a.isNullOrUndefined=function p(k){return null==k},a.isNumber=b,a.isString=y,a.isSymbol=function w(k){return"symbol"==typeof k},a.isUndefined=x,a.isRegExp=B,a.types.isRegExp=B,a.isObject=J,a.isDate=z,a.types.isDate=z,a.isError=M,a.types.isNativeError=M,a.isFunction=L,a.isPrimitive=function j(k){return null===k||"boolean"==typeof k||"number"==typeof k||"string"==typeof k||"symbol"==typeof k||typeof k>"u"},a.isBuffer=m("./support/isBuffer");var V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(k,D){return Object.prototype.hasOwnProperty.call(k,D)}a.log=function(){console.log("%s - %s",function N(){var k=new Date,D=[F(k.getHours()),F(k.getMinutes()),F(k.getSeconds())].join(":");return[k.getDate(),V[k.getMonth()],D].join(" ")}(),a.format.apply(a,arguments))},a.inherits=m("inherits"),a._extend=function(k,D){if(!D||!J(D))return k;for(var Q=Object.keys(D),ee=Q.length;ee--;)k[Q[ee]]=D[Q[ee]];return k};var S=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;function U(k,D){if(!k){var Q=new Error("Promise was rejected with a falsy value");Q.reason=k,k=Q}return D(k)}a.promisify=function(D){if("function"!=typeof D)throw new TypeError('The "original" argument must be of type Function');if(S&&D[S]){var Q;if("function"!=typeof(Q=D[S]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Q,S,{value:Q,enumerable:!1,writable:!1,configurable:!0}),Q}function Q(){for(var ee,ae,ue=new Promise(function(H,ne){ee=H,ae=ne}),be=[],X=0;X<arguments.length;X++)be.push(arguments[X]);be.push(function(H,ne){H?ae(H):ee(ne)});try{D.apply(this,be)}catch(H){ae(H)}return ue}return Object.setPrototypeOf(Q,Object.getPrototypeOf(D)),S&&Object.defineProperty(Q,S,{value:Q,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Q,I(D))},a.promisify.custom=S,a.callbackify=function W(k){if("function"!=typeof k)throw new TypeError('The "original" argument must be of type Function');function D(){for(var Q=[],ee=0;ee<arguments.length;ee++)Q.push(arguments[ee]);var ae=Q.pop();if("function"!=typeof ae)throw new TypeError("The last argument must be of type Function");var ue=this,be=function(){return ae.apply(ue,arguments)};k.apply(this,Q).then(function(X){R.nextTick(be.bind(null,null,X))},function(X){R.nextTick(U.bind(null,X,be))})}return Object.setPrototypeOf(D,Object.getPrototypeOf(k)),Object.defineProperties(D,I(k)),D}}).call(this)}).call(this,m("_process"))},{"./support/isBuffer":283,"./support/types":284,_process:237,inherits:146}],286:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;for(var R=[],I=0;I<256;++I)R[I]=(I+256).toString(16).substr(1);a.default=function E(d,u){var g=u||0;return[R[d[g++]],R[d[g++]],R[d[g++]],R[d[g++]],"-",R[d[g++]],R[d[g++]],"-",R[d[g++]],R[d[g++]],"-",R[d[g++]],R[d[g++]],"-",R[d[g++]],R[d[g++]],R[d[g++]],R[d[g++]],R[d[g++]],R[d[g++]]].join("")},ie.exports=a.default},{}],287:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"v1",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(a,"v3",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(a,"v4",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(a,"v5",{enumerable:!0,get:function(){return _.default}});var R=d(m("./v1.js")),I=d(m("./v3.js")),E=d(m("./v4.js")),_=d(m("./v5.js"));function d(u){return u&&u.__esModule?u:{default:u}}},{"./v1.js":291,"./v3.js":292,"./v4.js":294,"./v5.js":295}],288:[function(m,ie,a){"use strict";function d(s,t){var n=(65535&s)+(65535&t);return(s>>16)+(t>>16)+(n>>16)<<16|65535&n}function g(s,t,n,o,h,l){return d(function u(s,t){return s<<t|s>>>32-t}(d(d(t,s),d(o,l)),h),n)}function f(s,t,n,o,h,l,e){return g(t&n|~t&o,s,t,h,l,e)}function v(s,t,n,o,h,l,e){return g(t&o|n&~o,s,t,h,l,e)}function c(s,t,n,o,h,l,e){return g(t^n^o,s,t,h,l,e)}function i(s,t,n,o,h,l,e){return g(n^(t|~o),s,t,h,l,e)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,a.default=function R(s){if("string"==typeof s){var t=unescape(encodeURIComponent(s));s=new Array(t.length);for(var n=0;n<t.length;n++)s[n]=t.charCodeAt(n)}return function I(s){var t,n,e,o=[],h=32*s.length,l="0123456789abcdef";for(t=0;t<h;t+=8)n=s[t>>5]>>>t%32&255,e=parseInt(l.charAt(n>>>4&15)+l.charAt(15&n),16),o.push(e);return o}(function E(s,t){s[t>>5]|=128<<t%32,s[14+(t+64>>>9<<4)]=t;var n,o,h,l,e,p=1732584193,b=-271733879,y=-1732584194,w=271733878;for(n=0;n<s.length;n+=16)o=p,h=b,l=y,e=w,p=f(p,b,y,w,s[n],7,-680876936),w=f(w,p,b,y,s[n+1],12,-389564586),y=f(y,w,p,b,s[n+2],17,606105819),b=f(b,y,w,p,s[n+3],22,-1044525330),p=f(p,b,y,w,s[n+4],7,-176418897),w=f(w,p,b,y,s[n+5],12,1200080426),y=f(y,w,p,b,s[n+6],17,-1473231341),b=f(b,y,w,p,s[n+7],22,-45705983),p=f(p,b,y,w,s[n+8],7,1770035416),w=f(w,p,b,y,s[n+9],12,-1958414417),y=f(y,w,p,b,s[n+10],17,-42063),b=f(b,y,w,p,s[n+11],22,-1990404162),p=f(p,b,y,w,s[n+12],7,1804603682),w=f(w,p,b,y,s[n+13],12,-40341101),y=f(y,w,p,b,s[n+14],17,-1502002290),p=v(p,b=f(b,y,w,p,s[n+15],22,1236535329),y,w,s[n+1],5,-165796510),w=v(w,p,b,y,s[n+6],9,-1069501632),y=v(y,w,p,b,s[n+11],14,643717713),b=v(b,y,w,p,s[n],20,-373897302),p=v(p,b,y,w,s[n+5],5,-701558691),w=v(w,p,b,y,s[n+10],9,38016083),y=v(y,w,p,b,s[n+15],14,-660478335),b=v(b,y,w,p,s[n+4],20,-405537848),p=v(p,b,y,w,s[n+9],5,568446438),w=v(w,p,b,y,s[n+14],9,-1019803690),y=v(y,w,p,b,s[n+3],14,-187363961),b=v(b,y,w,p,s[n+8],20,1163531501),p=v(p,b,y,w,s[n+13],5,-1444681467),w=v(w,p,b,y,s[n+2],9,-51403784),y=v(y,w,p,b,s[n+7],14,1735328473),p=c(p,b=v(b,y,w,p,s[n+12],20,-1926607734),y,w,s[n+5],4,-378558),w=c(w,p,b,y,s[n+8],11,-2022574463),y=c(y,w,p,b,s[n+11],16,1839030562),b=c(b,y,w,p,s[n+14],23,-35309556),p=c(p,b,y,w,s[n+1],4,-1530992060),w=c(w,p,b,y,s[n+4],11,1272893353),y=c(y,w,p,b,s[n+7],16,-155497632),b=c(b,y,w,p,s[n+10],23,-1094730640),p=c(p,b,y,w,s[n+13],4,681279174),w=c(w,p,b,y,s[n],11,-358537222),y=c(y,w,p,b,s[n+3],16,-722521979),b=c(b,y,w,p,s[n+6],23,76029189),p=c(p,b,y,w,s[n+9],4,-640364487),w=c(w,p,b,y,s[n+12],11,-421815835),y=c(y,w,p,b,s[n+15],16,530742520),p=i(p,b=c(b,y,w,p,s[n+2],23,-995338651),y,w,s[n],6,-198630844),w=i(w,p,b,y,s[n+7],10,1126891415),y=i(y,w,p,b,s[n+14],15,-1416354905),b=i(b,y,w,p,s[n+5],21,-57434055),p=i(p,b,y,w,s[n+12],6,1700485571),w=i(w,p,b,y,s[n+3],10,-1894986606),y=i(y,w,p,b,s[n+10],15,-1051523),b=i(b,y,w,p,s[n+1],21,-2054922799),p=i(p,b,y,w,s[n+8],6,1873313359),w=i(w,p,b,y,s[n+15],10,-30611744),y=i(y,w,p,b,s[n+6],15,-1560198380),b=i(b,y,w,p,s[n+13],21,1309151649),p=i(p,b,y,w,s[n+4],6,-145523070),w=i(w,p,b,y,s[n+11],10,-1120210379),y=i(y,w,p,b,s[n+2],15,718787259),b=i(b,y,w,p,s[n+9],21,-343485551),p=d(p,o),b=d(b,h),y=d(y,l),w=d(w,e);return[p,b,y,w]}(function _(s){var t,n=[];for(n[(s.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var o=8*s.length;for(t=0;t<o;t+=8)n[t>>5]|=(255&s[t/8])<<t%32;return n}(s),8*s.length))},ie.exports=a.default},{}],289:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function E(){if(!R)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return R(I)};var R=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),I=new Uint8Array(16);ie.exports=a.default},{}],290:[function(m,ie,a){"use strict";function R(d,u,g,f){switch(d){case 0:return u&g^~u&f;case 1:case 3:return u^g^f;case 2:return u&g^u&f^g&f}}function I(d,u){return d<<u|d>>>32-u}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,a.default=function E(d){var u=[1518500249,1859775393,2400959708,3395469782],g=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof d){var f=unescape(encodeURIComponent(d));d=new Array(f.length);for(var v=0;v<f.length;v++)d[v]=f.charCodeAt(v)}d.push(128);var i=Math.ceil((d.length/4+2)/16),r=new Array(i);for(v=0;v<i;v++){r[v]=new Array(16);for(var s=0;s<16;s++)r[v][s]=d[64*v+4*s]<<24|d[64*v+4*s+1]<<16|d[64*v+4*s+2]<<8|d[64*v+4*s+3]}for(r[i-1][14]=8*(d.length-1)/Math.pow(2,32),r[i-1][14]=Math.floor(r[i-1][14]),r[i-1][15]=8*(d.length-1)&4294967295,v=0;v<i;v++){for(var t=new Array(80),n=0;n<16;n++)t[n]=r[v][n];for(n=16;n<80;n++)t[n]=I(t[n-3]^t[n-8]^t[n-14]^t[n-16],1);var o=g[0],h=g[1],l=g[2],e=g[3],p=g[4];for(n=0;n<80;n++){var b=Math.floor(n/20),y=I(o,5)+R(b,h,l,e)+p+u[b]+t[n]>>>0;p=e,e=l,l=I(h,30)>>>0,h=o,o=y}g[0]=g[0]+o>>>0,g[1]=g[1]+h>>>0,g[2]=g[2]+l>>>0,g[3]=g[3]+e>>>0,g[4]=g[4]+p>>>0}return[g[0]>>24&255,g[0]>>16&255,g[0]>>8&255,255&g[0],g[1]>>24&255,g[1]>>16&255,g[1]>>8&255,255&g[1],g[2]>>24&255,g[2]>>16&255,g[2]>>8&255,255&g[2],g[3]>>24&255,g[3]>>16&255,g[3]>>8&255,255&g[3],g[4]>>24&255,g[4]>>16&255,g[4]>>8&255,255&g[4]]},ie.exports=a.default},{}],291:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var R=E(m("./rng.js")),I=E(m("./bytesToUuid.js"));function E(c){return c&&c.__esModule?c:{default:c}}var _,d,u=0,g=0;a.default=function f(c,i,r){var s=i&&r||0,t=i||[],n=(c=c||{}).node||_,o=void 0!==c.clockseq?c.clockseq:d;if(null==n||null==o){var h=c.random||(c.rng||R.default)();null==n&&(n=_=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==o&&(o=d=16383&(h[6]<<8|h[7]))}var l=void 0!==c.msecs?c.msecs:(new Date).getTime(),e=void 0!==c.nsecs?c.nsecs:g+1,p=l-u+(e-g)/1e4;if(p<0&&void 0===c.clockseq&&(o=o+1&16383),(p<0||l>u)&&void 0===c.nsecs&&(e=0),e>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=l,g=e,d=o;var b=(1e4*(268435455&(l+=122192928e5))+e)%4294967296;t[s++]=b>>>24&255,t[s++]=b>>>16&255,t[s++]=b>>>8&255,t[s++]=255&b;var y=l/4294967296*1e4&268435455;t[s++]=y>>>8&255,t[s++]=255&y,t[s++]=y>>>24&15|16,t[s++]=y>>>16&255,t[s++]=o>>>8|128,t[s++]=255&o;for(var w=0;w<6;++w)t[s+w]=n[w];return i||(0,I.default)(t)},ie.exports=a.default},{"./bytesToUuid.js":286,"./rng.js":289}],292:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var R=E(m("./v35.js")),I=E(m("./md5.js"));function E(u){return u&&u.__esModule?u:{default:u}}var d=(0,R.default)("v3",48,I.default);a.default=d,ie.exports=a.default},{"./md5.js":288,"./v35.js":293}],293:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function g(f,v,c){var i=function(r,s,t,n){var o=t&&n||0;if("string"==typeof r&&(r=function _(f){f=unescape(encodeURIComponent(f));for(var v=new Array(f.length),c=0;c<f.length;c++)v[c]=f.charCodeAt(c);return v}(r)),"string"==typeof s&&(s=function E(f){var v=[];return f.replace(/[a-fA-F0-9]{2}/g,function(c){v.push(parseInt(c,16))}),v}(s)),!Array.isArray(r))throw TypeError("value must be an array of bytes");if(!Array.isArray(s)||16!==s.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var h=c(s.concat(r));if(h[6]=15&h[6]|v,h[8]=63&h[8]|128,t)for(var l=0;l<16;++l)t[o+l]=h[l];return t||(0,R.default)(h)};try{i.name=f}catch{}return i.DNS=d,i.URL=u,i},a.URL=a.DNS=void 0;var R=function I(f){return f&&f.__esModule?f:{default:f}}(m("./bytesToUuid.js"));const d="6ba7b810-9dad-11d1-80b4-00c04fd430c8";a.DNS=d;const u="6ba7b811-9dad-11d1-80b4-00c04fd430c8";a.URL=u},{"./bytesToUuid.js":286}],294:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var R=E(m("./rng.js")),I=E(m("./bytesToUuid.js"));function E(u){return u&&u.__esModule?u:{default:u}}a.default=function _(u,g,f){var v=g&&f||0;"string"==typeof u&&(g="binary"===u?new Array(16):null,u=null);var c=(u=u||{}).random||(u.rng||R.default)();if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,g)for(var i=0;i<16;++i)g[v+i]=c[i];return g||(0,I.default)(c)},ie.exports=a.default},{"./bytesToUuid.js":286,"./rng.js":289}],295:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var R=E(m("./v35.js")),I=E(m("./sha1.js"));function E(u){return u&&u.__esModule?u:{default:u}}var d=(0,R.default)("v5",80,I.default);a.default=d,ie.exports=a.default},{"./sha1.js":290,"./v35.js":293}],296:[function(m,ie,a){(function(R){(function(){"use strict";var I=m("for-each"),E=m("available-typed-arrays"),_=m("call-bind/callBound"),d=m("gopd"),u=_("Object.prototype.toString"),g=m("has-tostringtag/shams")(),f=typeof globalThis>"u"?R:globalThis,v=E(),c=_("String.prototype.slice"),i={},r=Object.getPrototypeOf;g&&d&&r&&I(v,function(n){if("function"==typeof f[n]){var o=new f[n];if(Symbol.toStringTag in o){var h=r(o),l=d(h,Symbol.toStringTag);if(!l){var e=r(h);l=d(e,Symbol.toStringTag)}i[n]=l.get}}});var t=m("is-typed-array");ie.exports=function(o){return!!t(o)&&(g&&Symbol.toStringTag in o?function(o){var h=!1;return I(i,function(l,e){if(!h)try{var p=l.call(o);p===e&&(h=p)}catch{}}),h}(o):c(u(o),8,-1))}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":16,"call-bind/callBound":69,"for-each":107,gopd:111,"has-tostringtag/shams":114,"is-typed-array":150}],297:[function(m,ie,a){"use strict";var f;Object.defineProperty(a,"__esModule",{value:!0}),a.RuleId=a.PushRuleKind=a.ConditionKind=a.isDmMemberCountCondition=a.DMMemberCountCondition=a.ConditionOperator=a.TweakName=a.PushRuleActionName=void 0,(f=a.PushRuleActionName||(a.PushRuleActionName={})).DontNotify="dont_notify",f.Notify="notify",f.Coalesce="coalesce",function(f){f.Highlight="highlight",f.Sound="sound"}(a.TweakName||(a.TweakName={})),function(f){f.ExactEquals="==",f.LessThan="<",f.GreaterThan=">",f.GreaterThanOrEqual=">=",f.LessThanOrEqual="<="}(a.ConditionOperator||(a.ConditionOperator={})),a.DMMemberCountCondition="2",a.isDmMemberCountCondition=function _(f){return"==2"===f||"2"===f},function(f){f.EventMatch="event_match",f.ContainsDisplayName="contains_display_name",f.RoomMemberCount="room_member_count",f.SenderNotificationPermission="sender_notification_permission",f.CallStarted="call_started",f.CallStartedPrefix="org.matrix.msc3914.call_started"}(a.ConditionKind||(a.ConditionKind={})),function(f){f.Override="override",f.ContentSpecific="content",f.RoomSpecific="room",f.SenderSpecific="sender",f.Underride="underride"}(a.PushRuleKind||(a.PushRuleKind={})),function(f){f.Master=".m.rule.master",f.ContainsDisplayName=".m.rule.contains_display_name",f.ContainsUserName=".m.rule.contains_user_name",f.AtRoomNotification=".m.rule.roomnotif",f.DM=".m.rule.room_one_to_one",f.EncryptedDM=".m.rule.encrypted_room_one_to_one",f.Message=".m.rule.message",f.EncryptedMessage=".m.rule.encrypted",f.InviteToSelf=".m.rule.invite_for_me",f.MemberEvent=".m.rule.member_event",f.IncomingCall=".m.rule.call",f.SuppressNotices=".m.rule.suppress_notices",f.Tombstone=".m.rule.tombstone"}(a.RuleId||(a.RuleId={}))},{}],298:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.M_BEACON=a.M_BEACON_INFO=void 0;const R=m("../NamespacedValue");a.M_BEACON_INFO=new R.UnstableValue("m.beacon_info","org.matrix.msc3672.beacon_info"),a.M_BEACON=new R.UnstableValue("m.beacon","org.matrix.msc3672.beacon")},{"../NamespacedValue":308}],299:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.LOCAL_NOTIFICATION_SETTINGS_PREFIX=a.PUSHER_DEVICE_ID=a.PUSHER_ENABLED=a.EVENT_VISIBILITY_CHANGE_TYPE=a.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=a.UNSTABLE_MSC2716_MARKER=a.UNSTABLE_MSC3089_BRANCH=a.UNSTABLE_MSC3089_LEAF=a.UNSTABLE_MSC3089_TREE_SUBTYPE=a.UNSTABLE_MSC3088_ENABLED=a.UNSTABLE_MSC3088_PURPOSE=a.ToDeviceMessageId=a.RoomType=a.RoomCreateTypeField=a.MsgType=a.RelationType=a.EventType=void 0;const R=m("../NamespacedValue");var u;(u=a.EventType||(a.EventType={})).RoomCanonicalAlias="m.room.canonical_alias",u.RoomCreate="m.room.create",u.RoomJoinRules="m.room.join_rules",u.RoomMember="m.room.member",u.RoomThirdPartyInvite="m.room.third_party_invite",u.RoomPowerLevels="m.room.power_levels",u.RoomName="m.room.name",u.RoomTopic="m.room.topic",u.RoomAvatar="m.room.avatar",u.RoomPinnedEvents="m.room.pinned_events",u.RoomEncryption="m.room.encryption",u.RoomHistoryVisibility="m.room.history_visibility",u.RoomGuestAccess="m.room.guest_access",u.RoomServerAcl="m.room.server_acl",u.RoomTombstone="m.room.tombstone",u.SpaceChild="m.space.child",u.SpaceParent="m.space.parent",u.RoomRedaction="m.room.redaction",u.RoomMessage="m.room.message",u.RoomMessageEncrypted="m.room.encrypted",u.Sticker="m.sticker",u.CallInvite="m.call.invite",u.CallCandidates="m.call.candidates",u.CallAnswer="m.call.answer",u.CallHangup="m.call.hangup",u.CallReject="m.call.reject",u.CallSelectAnswer="m.call.select_answer",u.CallNegotiate="m.call.negotiate",u.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",u.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",u.CallReplaces="m.call.replaces",u.CallAssertedIdentity="m.call.asserted_identity",u.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",u.KeyVerificationRequest="m.key.verification.request",u.KeyVerificationStart="m.key.verification.start",u.KeyVerificationCancel="m.key.verification.cancel",u.KeyVerificationMac="m.key.verification.mac",u.KeyVerificationDone="m.key.verification.done",u.KeyVerificationKey="m.key.verification.key",u.KeyVerificationAccept="m.key.verification.accept",u.KeyVerificationReady="m.key.verification.ready",u.RoomMessageFeedback="m.room.message.feedback",u.Reaction="m.reaction",u.Typing="m.typing",u.Receipt="m.receipt",u.Presence="m.presence",u.FullyRead="m.fully_read",u.Tag="m.tag",u.SpaceOrder="org.matrix.msc3230.space_order",u.PushRules="m.push_rules",u.Direct="m.direct",u.IgnoredUserList="m.ignored_user_list",u.RoomKey="m.room_key",u.RoomKeyRequest="m.room_key_request",u.ForwardedRoomKey="m.forwarded_room_key",u.Dummy="m.dummy",u.GroupCallPrefix="org.matrix.msc3401.call",u.GroupCallMemberPrefix="org.matrix.msc3401.call.member",function(u){u.Annotation="m.annotation",u.Replace="m.replace",u.Reference="m.reference",u.Thread="m.thread"}(a.RelationType||(a.RelationType={})),function(u){u.Text="m.text",u.Emote="m.emote",u.Notice="m.notice",u.Image="m.image",u.File="m.file",u.Audio="m.audio",u.Location="m.location",u.Video="m.video",u.KeyVerificationRequest="m.key.verification.request"}(a.MsgType||(a.MsgType={})),a.RoomCreateTypeField="type",function(u){u.Space="m.space",u.UnstableCall="org.matrix.msc3417.call",u.ElementVideo="io.element.video"}(a.RoomType||(a.RoomType={})),a.ToDeviceMessageId="org.matrix.msgid",a.UNSTABLE_MSC3088_PURPOSE=new R.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose"),a.UNSTABLE_MSC3088_ENABLED=new R.UnstableValue("m.enabled","org.matrix.msc3088.enabled"),a.UNSTABLE_MSC3089_TREE_SUBTYPE=new R.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree"),a.UNSTABLE_MSC3089_LEAF=new R.UnstableValue("m.leaf","org.matrix.msc3089.leaf"),a.UNSTABLE_MSC3089_BRANCH=new R.UnstableValue("m.branch","org.matrix.msc3089.branch"),a.UNSTABLE_MSC2716_MARKER=new R.UnstableValue("m.room.marker","org.matrix.msc2716.marker"),a.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=new R.UnstableValue("io.element.functional_members","io.element.functional_members"),a.EVENT_VISIBILITY_CHANGE_TYPE=new R.UnstableValue("m.visibility","org.matrix.msc3531.visibility"),a.PUSHER_ENABLED=new R.UnstableValue("enabled","org.matrix.msc3881.enabled"),a.PUSHER_DEVICE_ID=new R.UnstableValue("device_id","org.matrix.msc3881.device_id"),a.LOCAL_NOTIFICATION_SETTINGS_PREFIX=new R.UnstableValue("m.local_notification_settings","org.matrix.msc3890.local_notification_settings")},{"../NamespacedValue":308}],300:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.TEXT_NODE_TYPE=void 0;const R=m("../NamespacedValue");a.TEXT_NODE_TYPE=new R.UnstableValue("m.text","org.matrix.msc1767.text")},{"../NamespacedValue":308}],301:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.M_LOCATION=a.M_TIMESTAMP=a.M_ASSET=a.LocationAssetType=void 0;const R=m("../NamespacedValue");var _;m("./extensible_events"),(_=a.LocationAssetType||(a.LocationAssetType={})).Self="m.self",_.Pin="m.pin",a.M_ASSET=new R.UnstableValue("m.asset","org.matrix.msc3488.asset"),a.M_TIMESTAMP=new R.UnstableValue("m.ts","org.matrix.msc3488.ts"),a.M_LOCATION=new R.UnstableValue("m.location","org.matrix.msc3488.location")},{"../NamespacedValue":308,"./extensible_events":300}],302:[function(m,ie,a){"use strict";var g;Object.defineProperty(a,"__esModule",{value:!0}),a.HistoryVisibility=a.GuestAccess=a.RestrictedAllowType=a.JoinRule=a.Preset=a.Visibility=void 0,(g=a.Visibility||(a.Visibility={})).Public="public",g.Private="private",function(g){g.PrivateChat="private_chat",g.TrustedPrivateChat="trusted_private_chat",g.PublicChat="public_chat"}(a.Preset||(a.Preset={})),function(g){g.Public="public",g.Invite="invite",g.Private="private",g.Knock="knock",g.Restricted="restricted"}(a.JoinRule||(a.JoinRule={})),function(g){g.RoomMembership="m.room_membership"}(a.RestrictedAllowType||(a.RestrictedAllowType={})),function(g){g.CanJoin="can_join",g.Forbidden="forbidden"}(a.GuestAccess||(a.GuestAccess={})),function(g){g.Invited="invited",g.Joined="joined",g.Shared="shared",g.WorldReadable="world_readable"}(a.HistoryVisibility||(a.HistoryVisibility={}))},{}],303:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.MAIN_ROOM_TIMELINE=a.ReceiptType=void 0,(I=a.ReceiptType||(a.ReceiptType={})).Read="m.read",I.FullyRead="m.fully_read",I.ReadPrivate="m.read.private",a.MAIN_ROOM_TIMELINE="main"},{}],304:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},{}],305:[function(m,ie,a){"use strict";var R,E;Object.defineProperty(a,"__esModule",{value:!0}),a.SearchOrderBy=void 0,(E=R||(R={})).RoomId="room_id",E.Sender="sender",function(E){E.Recent="recent",E.Rank="rank"}(a.SearchOrderBy||(a.SearchOrderBy={}))},{}],306:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.UNREAD_THREAD_NOTIFICATIONS=void 0;const R=m("../NamespacedValue");a.UNREAD_THREAD_NOTIFICATIONS=new R.ServerControlledNamespacedValue("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications")},{"../NamespacedValue":308}],307:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.M_TOPIC=void 0;const R=m("../NamespacedValue");a.M_TOPIC=new R.UnstableValue("m.topic","org.matrix.msc3765.topic")},{"../NamespacedValue":308}],308:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.UnstableValue=a.ServerControlledNamespacedValue=a.NamespacedValue=void 0;class R{constructor(d,u){if(this.stable=d,this.unstable=u,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){const d=[this.name],u=this.altName;return u&&d.push(u),d}matches(d){return this.name===d||this.altName===d}findIn(d){let u;return this.name&&(u=d?.[this.name]),!u&&this.altName&&(u=d?.[this.altName]),u}includedIn(d){let u=!1;return this.name&&(u=d.includes(this.name)),!u&&this.altName&&(u=d.includes(this.altName)),u}}a.NamespacedValue=R,a.ServerControlledNamespacedValue=class I extends R{constructor(){super(...arguments),this.preferUnstable=!1}setPreferUnstable(d){this.preferUnstable=d}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}},a.UnstableValue=class E extends R{constructor(d,u){if(super(d,u),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}},{}],309:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.TypedReEmitter=a.ReEmitter=void 0;class R{constructor(_){this.target=_,this.reEmitters=new Map}reEmit(_,d){let u=this.reEmitters.get(_);u||(u=new Map,this.reEmitters.set(_,u));for(const g of d){const f=(...v)=>{"error"===g&&0===this.target.listenerCount("error")||this.target.emit(g,...v,_)};_.on(g,f),u.set(g,f)}}stopReEmitting(_,d){const u=this.reEmitters.get(_);if(u){for(const g of d)_.off(g,u.get(g)),u.delete(g);0===u.size&&this.reEmitters.delete(_)}}}a.ReEmitter=R,a.TypedReEmitter=class I extends R{constructor(_){super(_)}reEmit(_,d){super.reEmit(_,d)}stopReEmitting(_,d){super.stopReEmitting(_,d)}}},{}],310:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(g,f,v,c){return new(v||(v=Promise))(function(r,s){function t(h){try{o(c.next(h))}catch(l){s(l)}}function n(h){try{o(c.throw(h))}catch(l){s(l)}}function o(h){h.done?r(h.value):function i(r){return r instanceof v?r:new v(function(s){s(r)})}(h.value).then(t,n)}o((c=c.apply(g,f||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.ToDeviceMessageQueue=void 0;const I=m("./@types/event"),E=m("./logger"),_=m("./scheduler");a.ToDeviceMessageQueue=class u{constructor(f){this.client=f,this.sending=!1,this.running=!0,this.retryTimeout=null,this.retryAttempts=0,this.sendQueue=()=>R(this,void 0,void 0,function*(){if(null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.sending||!this.running)return;let v;E.logger.debug("Attempting to send queued to-device messages"),this.sending=!0;try{for(;this.running&&(v=yield this.client.store.getOldestToDeviceBatch(),null!==v);)yield this.sendBatch(v),yield this.client.store.removeToDeviceBatch(v.id),this.retryAttempts=0;if(!this.running)return;E.logger.debug("All queued to-device messages sent")}catch(c){++this.retryAttempts;const i=_.MatrixScheduler.RETRY_BACKOFF_RATELIMIT(null,this.retryAttempts,c);if(-1===i)return void(4===Math.floor(c.httpStatus/100)?(E.logger.error("Fatal error when sending to-device message - dropping to-device batch!",c),yield this.client.store.removeToDeviceBatch(v.id)):E.logger.info("Automatic retry limit reached for to-device messages."));E.logger.info(`Failed to send batch of to-device messages. Will retry in ${i}ms`,c),this.retryTimeout=setTimeout(this.sendQueue,i)}finally{this.sending=!1}})}start(){this.running=!0,this.sendQueue()}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null}queueBatch(f){return R(this,void 0,void 0,function*(){const v=[];for(let c=0;c<f.batch.length;c+=20){const i={eventType:f.eventType,batch:f.batch.slice(c,c+20),txnId:this.client.makeTxnId()};v.push(i);const r=i.batch.map(s=>`${s.userId}/${s.deviceId} (msgid ${s.payload[I.ToDeviceMessageId]})`);E.logger.info(`Enqueuing batch of to-device messages. type=${f.eventType} txnid=${i.txnId}`,r)}yield this.client.store.saveToDeviceBatches(v),this.sendQueue()})}sendBatch(f){return R(this,void 0,void 0,function*(){const v={};for(const c of f.batch)v[c.userId]||(v[c.userId]={}),v[c.userId][c.deviceId]=c.payload;E.logger.info(`Sending batch of ${f.batch.length} to-device messages with ID ${f.id} and txnId ${f.txnId}`),yield this.client.sendToDevice(f.eventType,v,f.txnId)})}}},{"./@types/event":299,"./logger":365,"./scheduler":390}],311:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__awaiter||function(f,v,c,i){return new(c||(c=Promise))(function(s,t){function n(l){try{h(i.next(l))}catch(e){t(e)}}function o(l){try{h(i.throw(l))}catch(e){t(e)}}function h(l){l.done?s(l.value):function r(s){return s instanceof c?s:new c(function(t){t(s)})}(l.value).then(n,o)}h((i=i.apply(f,v||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.AutoDiscovery=a.AutoDiscoveryAction=void 0;const E=m("./logger"),_=m("./http-api");var d,f,u;(f=d=a.AutoDiscoveryAction||(a.AutoDiscoveryAction={})).SUCCESS="SUCCESS",f.IGNORE="IGNORE",f.PROMPT="PROMPT",f.FAIL_PROMPT="FAIL_PROMPT",f.FAIL_ERROR="FAIL_ERROR",function(f){f.Invalid="Invalid homeserver discovery response",f.GenericFailure="Failed to get autodiscovery configuration from server",f.InvalidHsBaseUrl="Invalid base_url for m.homeserver",f.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",f.InvalidIsBaseUrl="Invalid base_url for m.identity_server",f.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",f.InvalidIs="Invalid identity server discovery response",f.MissingWellknown="No .well-known JSON file found",f.InvalidJson="Invalid JSON"}(u||(u={}));class g{static fromDiscoveryConfig(v){var c;return I(this,void 0,void 0,function*(){const i={"m.homeserver":{state:g.FAIL_ERROR,error:g.ERROR_INVALID,base_url:null},"m.identity_server":{state:g.PROMPT,error:null,base_url:null}};if(!v||!v["m.homeserver"])return E.logger.error("No m.homeserver key in config"),i["m.homeserver"].state=g.FAIL_PROMPT,i["m.homeserver"].error=g.ERROR_INVALID,Promise.resolve(i);if(!v["m.homeserver"].base_url)return E.logger.error("No m.homeserver base_url in config"),i["m.homeserver"].state=g.FAIL_PROMPT,i["m.homeserver"].error=g.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);const r=this.sanitizeWellKnownUrl(v["m.homeserver"].base_url);if(!r)return E.logger.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=g.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);const s=yield this.fetchWellKnownObject(`${r}/_matrix/client/versions`);if(!s||null===(c=s.raw)||void 0===c||!c.versions)return E.logger.error("Invalid /versions response"),i["m.homeserver"].error=g.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=r,Promise.resolve(i);i["m.homeserver"]={state:g.SUCCESS,error:null,base_url:r};let t="";if(v["m.identity_server"]){const n={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:g.FAIL_PROMPT,error:g.ERROR_INVALID_IS,base_url:null}};if(t=this.sanitizeWellKnownUrl(v["m.identity_server"].base_url),!t)return E.logger.error("Invalid base_url for m.identity_server"),n["m.identity_server"].error=g.ERROR_INVALID_IS_BASE_URL,Promise.resolve(n);const o=yield this.fetchWellKnownObject(`${t}/_matrix/identity/api/v1`);if(!o?.raw||o.action!==d.SUCCESS)return E.logger.error("Invalid /api/v1 response"),n["m.identity_server"].error=g.ERROR_INVALID_IDENTITY_SERVER,n["m.identity_server"].base_url=t,Promise.resolve(n)}return t&&t.toString().length>0&&(i["m.identity_server"]={state:g.SUCCESS,error:null,base_url:t}),Object.keys(v).forEach(n=>{if("m.homeserver"===n||"m.identity_server"===n){const o=["error","state","base_url"];for(const h of Object.keys(v[n]))o.includes(h)||(i[n][h]=v[n][h])}else i[n]=v[n]}),Promise.resolve(i)})}static findClientConfig(v){return I(this,void 0,void 0,function*(){if(!v||"string"!=typeof v||0===v.length)throw new Error("'domain' must be a string of non-zero length");const c={"m.homeserver":{state:g.FAIL_ERROR,error:g.ERROR_INVALID,base_url:null},"m.identity_server":{state:g.PROMPT,error:null,base_url:null}},i=yield this.fetchWellKnownObject(`https://${v}/.well-known/matrix/client`);return i&&i.action===d.SUCCESS?g.fromDiscoveryConfig(i.raw):(E.logger.error("No response or error when parsing .well-known"),i.reason&&E.logger.error(i.reason),i.action===d.IGNORE?c["m.homeserver"]={state:g.PROMPT,error:null,base_url:null}:(c["m.homeserver"].state=g.FAIL_PROMPT,c["m.homeserver"].error=g.ERROR_INVALID),Promise.resolve(c))})}static getRawClientConfig(v){return I(this,void 0,void 0,function*(){if(!v||"string"!=typeof v||0===v.length)throw new Error("'domain' must be a string of non-zero length");const c=yield this.fetchWellKnownObject(`https://${v}/.well-known/matrix/client`);return c&&c.raw||{}})}static sanitizeWellKnownUrl(v){if(!v)return!1;try{let c;try{c=new URL(v)}catch(t){E.logger.error("Could not parse url",t)}if(!c?.hostname||"http:"!==c.protocol&&"https:"!==c.protocol)return!1;let s=`${c.protocol}//${c.hostname}${c.port?`:${c.port}`:""}${c.pathname?c.pathname:""}`;return s.endsWith("/")&&(s=s.substring(0,s.length-1)),s}catch(c){return E.logger.error(c),!1}}static fetch(v,c){return this.fetchFn?this.fetchFn(v,c):R.fetch(v,c)}static setFetchFn(v){g.fetchFn=v}static fetchWellKnownObject(v){return I(this,void 0,void 0,function*(){let c;try{if(c=yield g.fetch(v,{method:_.Method.Get,signal:(0,_.timeoutSignal)(5e3)}),404===c.status)return{raw:{},action:d.IGNORE,reason:g.ERROR_MISSING_WELLKNOWN};if(!c.ok)return{raw:{},action:d.FAIL_PROMPT,reason:"General failure"}}catch(i){let s="";return"object"==typeof i&&(s=i?.message),{error:i,raw:{},action:d.FAIL_PROMPT,reason:s||"General failure"}}try{return{raw:yield c.json(),action:d.SUCCESS}}catch(i){return{error:i,raw:{},action:d.FAIL_PROMPT,reason:"SyntaxError"===i?.name?g.ERROR_INVALID_JSON:g.ERROR_INVALID}}})}}a.AutoDiscovery=g,g.ERROR_INVALID=u.Invalid,g.ERROR_GENERIC_FAILURE=u.GenericFailure,g.ERROR_INVALID_HS_BASE_URL=u.InvalidHsBaseUrl,g.ERROR_INVALID_HOMESERVER=u.InvalidHomeserver,g.ERROR_INVALID_IS_BASE_URL=u.InvalidIsBaseUrl,g.ERROR_INVALID_IDENTITY_SERVER=u.InvalidIdentityServer,g.ERROR_INVALID_IS=u.InvalidIs,g.ERROR_MISSING_WELLKNOWN=u.MissingWellknown,g.ERROR_INVALID_JSON=u.InvalidJson,g.ALL_ERRORS=Object.keys(u),g.FAIL_ERROR=d.FAIL_ERROR,g.FAIL_PROMPT=d.FAIL_PROMPT,g.PROMPT=d.PROMPT,g.SUCCESS=d.SUCCESS}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./http-api":358,"./logger":365}],312:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(f,v,c,i){void 0===i&&(i=c);var r=Object.getOwnPropertyDescriptor(v,c);(!r||("get"in r?!v.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return v[c]}}),Object.defineProperty(f,i,r)}:function(f,v,c,i){void 0===i&&(i=c),f[i]=v[c]}),E=this&&this.__setModuleDefault||(Object.create?function(f,v){Object.defineProperty(f,"default",{enumerable:!0,value:v})}:function(f,v){f.default=v}),_=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var v={};if(null!=f)for(var c in f)"default"!==c&&Object.prototype.hasOwnProperty.call(f,c)&&I(v,f,c);return E(v,f),v},d=this&&this.__exportStar||function(f,v){for(var c in f)"default"!==c&&!Object.prototype.hasOwnProperty.call(v,c)&&I(v,f,c)};Object.defineProperty(a,"__esModule",{value:!0});const u=_(m("./matrix"));if(R.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");let g;R.__js_sdk_entrypoint=!0;try{g=R.indexedDB}catch{}g&&u.setCryptoStoreFactory(()=>new u.IndexedDBCryptoStore(g,"matrix-js-sdk:crypto")),d(m("./matrix"),a),a.default=u,R.matrixcs=u}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./matrix":366}],313:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(Ue,K,Y,oe){void 0===oe&&(oe=Y);var le=Object.getOwnPropertyDescriptor(K,Y);(!le||("get"in le?!K.__esModule:le.writable||le.configurable))&&(le={enumerable:!0,get:function(){return K[Y]}}),Object.defineProperty(Ue,oe,le)}:function(Ue,K,Y,oe){void 0===oe&&(oe=Y),Ue[oe]=K[Y]}),E=this&&this.__setModuleDefault||(Object.create?function(Ue,K){Object.defineProperty(Ue,"default",{enumerable:!0,value:K})}:function(Ue,K){Ue.default=K}),_=this&&this.__importStar||function(Ue){if(Ue&&Ue.__esModule)return Ue;var K={};if(null!=Ue)for(var Y in Ue)"default"!==Y&&Object.prototype.hasOwnProperty.call(Ue,Y)&&I(K,Ue,Y);return E(K,Ue),K},d=this&&this.__awaiter||function(Ue,K,Y,oe){return new(Y||(Y=Promise))(function(ge,Ie){function Ce(Fe){try{He(oe.next(Fe))}catch(je){Ie(je)}}function Pe(Fe){try{He(oe.throw(Fe))}catch(je){Ie(je)}}function He(Fe){Fe.done?ge(Fe.value):function le(ge){return ge instanceof Y?ge:new Y(function(Ie){Ie(ge)})}(Fe.value).then(Ce,Pe)}He((oe=oe.apply(Ue,K||[])).next())})},u=this&&this.__rest||function(Ue,K){var Y={};for(var oe in Ue)Object.prototype.hasOwnProperty.call(Ue,oe)&&K.indexOf(oe)<0&&(Y[oe]=Ue[oe]);if(null!=Ue&&"function"==typeof Object.getOwnPropertySymbols){var le=0;for(oe=Object.getOwnPropertySymbols(Ue);le<oe.length;le++)K.indexOf(oe[le])<0&&Object.prototype.propertyIsEnumerable.call(Ue,oe[le])&&(Y[oe[le]]=Ue[oe[le]])}return Y};Object.defineProperty(a,"__esModule",{value:!0}),a.fixNotificationCountOnDecryption=a.MatrixClient=a.ClientEvent=a.M_AUTHENTICATION=a.RoomVersionStability=a.PendingEventOrdering=a.UNSTABLE_MSC3852_LAST_SEEN_UA=a.CRYPTO_ENABLED=void 0;const g=m("matrix-events-sdk"),f=m("./sync"),v=m("./models/event"),c=m("./store/stub"),i=m("./webrtc/call"),r=m("./filter"),s=m("./webrtc/callEventHandler"),t=_(m("./utils")),n=m("./utils"),o=m("./models/event-timeline"),h=m("./pushprocessor"),l=m("./autodiscovery"),e=_(m("./crypto/olmlib")),p=m("./crypto/olmlib"),b=m("./ReEmitter"),y=m("./crypto/RoomList"),w=m("./logger"),x=m("./service-types"),B=m("./http-api"),J=m("./crypto"),z=m("./crypto/recoverykey"),M=m("./crypto/key_passphrase"),L=m("./models/user"),j=m("./content-repo"),C=m("./models/search-result"),F=m("./crypto/dehydration"),V=m("./crypto/api"),N=_(m("./content-helpers")),T=m("./models/room"),S=m("./@types/event"),U=m("./@types/partials"),W=m("./event-mapper"),k=m("./randomstring"),D=m("./crypto/backup"),Q=m("./models/MSC3089TreeSpace"),ee=m("./@types/search"),ae=m("./@types/PushRules"),ue=m("./webrtc/groupCall"),be=m("./webrtc/mediaHandler"),X=m("./webrtc/groupCallEventHandler"),H=m("./models/typed-event-emitter"),ne=m("./@types/read_receipts"),ce=m("./sliding-sync-sdk"),te=m("./models/thread"),P=m("./@types/beacon"),A=m("./NamespacedValue"),$=m("./ToDeviceMessageQueue"),G=m("./models/invites-ignorer"),se=m("./@types/sync"),he=m("./feature");var Ue,De;a.CRYPTO_ENABLED=(0,J.isCryptoAvailable)(),a.UNSTABLE_MSC3852_LAST_SEEN_UA=new A.UnstableValue("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),(Ue=a.PendingEventOrdering||(a.PendingEventOrdering={})).Chronological="chronological",Ue.Detached="detached",function(Ue){Ue.Stable="stable",Ue.Unstable="unstable"}(a.RoomVersionStability||(a.RoomVersionStability={})),function(Ue){Ue.MasterKey="master_key",Ue.SelfSigningKey="self_signing_key",Ue.UserSigningKey="user_signing_key"}(De||(De={})),a.M_AUTHENTICATION=new A.UnstableValue("m.authentication","org.matrix.msc2965.authentication");const Ae="$";var Ne;!function(Ue){Ue.Sync="sync",Ue.Event="event",Ue.ToDeviceEvent="toDeviceEvent",Ue.AccountData="accountData",Ue.Room="Room",Ue.DeleteRoom="deleteRoom",Ue.SyncUnexpectedError="sync.unexpectedError",Ue.ClientWellKnown="WellKnown.client",Ue.ReceivedVoipEvent="received_voip_event",Ue.TurnServers="turnServers",Ue.TurnServersError="turnServers.error"}(Ne=a.ClientEvent||(a.ClientEvent={}));const qe=new A.UnstableValue("action","org.matrix.msc3824.action");class Be extends H.TypedEventEmitter{constructor(K){var Y;super(),this.reEmitter=new b.TypedReEmitter(this),this.olmVersion=null,this.usingExternalCrypto=!1,this.clientRunning=!1,this.timelineSupport=!1,this.urlPreviewCache={},this.supportsCallTransfer=!1,this.forceTURN=!1,this.iceCandidatePoolSize=0,this.canSupportVoip=!1,this.peekSync=null,this.isGuestAccount=!1,this.ongoingScrollbacks={},this.notifTimelineSet=null,this.fallbackICEServerAllowed=!1,this.syncedLeftRooms=!1,this.canSupport=new Map,this.pushProcessor=new h.PushProcessor(this),this.turnServers=[],this.turnServersExpiry=0,this.txnCtr=0,this.mediaHandler=new be.MediaHandler(this),this.pendingEventEncryption=new Map,this.useE2eForGroupCall=!0,this.startCallEventHandler=()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.groupCallEventHandler.start(),this.off(Ne.Sync,this.startCallEventHandler))},K.baseUrl=t.ensureNoTrailingSlash(K.baseUrl),K.idBaseUrl=t.ensureNoTrailingSlash(K.idBaseUrl),this.baseUrl=K.baseUrl,this.idBaseUrl=K.idBaseUrl,this.identityServer=K.identityServer,this.usingExternalCrypto=null!==(Y=K.usingExternalCrypto)&&void 0!==Y&&Y,this.store=K.store||new c.StubStore,this.deviceId=K.deviceId||null,this.sessionId=(0,k.randomString)(10),this.credentials={userId:K.userId||null},this.http=new B.MatrixHttpApi(this,{fetchFn:K.fetchFn,baseUrl:K.baseUrl,idBaseUrl:K.idBaseUrl,accessToken:K.accessToken,prefix:B.ClientPrefix.R0,onlyData:!0,extraParams:K.queryParams,localTimeoutMs:K.localTimeoutMs,useAuthorizationHeader:K.useAuthorizationHeader}),K.deviceToImport?this.deviceId?w.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?w.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):K.deviceToImport.deviceId?(this.deviceId=K.deviceToImport.deviceId,this.credentials.userId=K.deviceToImport.userId,this.exportedOlmDeviceToImport=K.deviceToImport.olmDevice):w.logger.warn("not importing device because no device ID in exported data"):K.pickleKey&&(this.pickleKey=K.pickleKey),this.scheduler=K.scheduler,this.scheduler&&this.scheduler.setProcessFunction(le=>d(this,void 0,void 0,function*(){const ge=this.getRoom(le.getRoomId());le.status!==v.EventStatus.SENDING&&this.updatePendingEventStatus(ge,le,v.EventStatus.SENDING);const Ie=yield this.sendEventHttpRequest(le);return ge&&ge.updatePendingEvent(le,v.EventStatus.SENT,Ie.event_id),Ie})),(0,i.supportsMatrixCall)()&&(this.callEventHandler=new s.CallEventHandler(this),this.groupCallEventHandler=new X.GroupCallEventHandler(this),this.canSupportVoip=!0,this.on(Ne.Sync,this.startCallEventHandler)),this.timelineSupport=Boolean(K.timelineSupport),this.cryptoStore=K.cryptoStore,this.verificationMethods=K.verificationMethods,this.cryptoCallbacks=K.cryptoCallbacks||{},this.forceTURN=K.forceTURN||!1,this.iceCandidatePoolSize=void 0===K.iceCandidatePoolSize?0:K.iceCandidatePoolSize,this.supportsCallTransfer=K.supportsCallTransfer||!1,this.fallbackICEServerAllowed=K.fallbackICEServerAllowed||!1,void 0!==K.useE2eForGroupCall&&(this.useE2eForGroupCall=K.useE2eForGroupCall),this.roomList=new y.RoomList(this.cryptoStore),this.roomNameGenerator=K.roomNameGenerator,this.toDeviceMessageQueue=new $.ToDeviceMessageQueue(this),this.on(v.MatrixEventEvent.Decrypted,le=>{Ge(this,le)}),this.on(T.RoomEvent.Receipt,(le,ge)=>{var Ie;if(ge&&this.isRoomEncrypted(ge.roomId)){const Ce=le.getContent();if(!(Object.keys(Ce).filter(et=>{for(const[Ve,Je]of Object.entries(Ce[et]))if(t.isSupportedReceiptType(Ve)&&Je&&Object.keys(Je).includes(this.getUserId()))return!0;return!1}).length>0))return;const He=20,Fe=ge.getLiveTimeline().getEvents();let je=0;for(let et=Fe.length-1;et>=0;et--){if(et===Fe.length-He)return;const Ve=Fe[et];if(ge.hasUserReadEvent(this.getUserId(),Ve.getId()))break;je+=null!==(Ie=this.getPushActionsForEvent(Ve)?.tweaks)&&void 0!==Ie&&Ie.highlight?1:0}ge.setUnreadNotificationCount(T.NotificationCountType.Highlight,je)}}),this.ignoredInvites=new G.IgnoredInvites(this)}startClient(K){return d(this,void 0,void 0,function*(){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof K&&(K={initialSyncLimit:K});const Y=this.getUserId();Y&&this.store.storeUser(new L.User(Y)),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval(()=>{this.checkTurnServers()},6e5),this.checkTurnServers()),this.syncApi&&(w.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop());try{yield this.getVersions();const{threads:oe,list:le,fwdPagination:ge}=yield this.doesServerSupportThread();te.Thread.setServerSideSupport(oe),te.Thread.setServerSideListSupport(le),te.Thread.setServerSideFwdPaginationSupport(ge)}catch(oe){w.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",oe)}this.clientOpts=Object.assign({},K),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=oe=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(oe),this.syncApi=this.clientOpts.slidingSync?new ce.SlidingSyncSdk(this.clientOpts.slidingSync,this,this.clientOpts):new f.SyncApi(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.toDeviceMessageQueue.start()})}stopClient(){var K,Y,oe,le,ge;null===(K=this.cryptoBackend)||void 0===K||K.stop(),this.clientRunning&&(w.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(Y=this.syncApi)||void 0===Y||Y.stop(),this.syncApi=void 0,null===(oe=this.peekSync)||void 0===oe||oe.stopPeeking(),null===(le=this.callEventHandler)||void 0===le||le.stop(),null===(ge=this.groupCallEventHandler)||void 0===ge||ge.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,R.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&R.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop())}rehydrateDevice(){return d(this,void 0,void 0,function*(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const K=yield this.getDehydratedDevice();if(!K)return;if(!K.device_data||!K.device_id)return void w.logger.info("no dehydrated device found");const Y=new R.Olm.Account;try{const oe=K.device_data;if(oe.algorithm!==F.DEHYDRATION_ALGORITHM)return void w.logger.warn("Wrong algorithm for dehydrated device");w.logger.log("unpickling dehydrated device");const le=yield this.cryptoCallbacks.getDehydrationKey(oe,Ie=>{Y.unpickle(new Uint8Array(Ie),oe.account)});if(Y.unpickle(le,oe.account),w.logger.log("unpickled device"),(yield this.http.authedRequest(B.Method.Post,"/dehydrated_device/claim",void 0,{device_id:K.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=K.device_id,w.logger.info("using dehydrated device");const Ie=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:Y.pickle(Ie),sessions:[],pickleKey:Ie},Y.free(),this.deviceId}return Y.free(),void w.logger.info("not using dehydrated device")}catch(oe){Y.free(),w.logger.warn("could not unpickle",oe)}})}getDehydratedDevice(){return d(this,void 0,void 0,function*(){try{return yield this.http.authedRequest(B.Method.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(K){return void w.logger.info("could not get dehydrated device",K)}})}setDehydrationKey(K,Y,oe){return d(this,void 0,void 0,function*(){if(this.crypto)return this.crypto.dehydrationManager.setKeyAndQueueDehydration(K,Y,oe);w.logger.warn("not dehydrating device if crypto is not enabled")})}createDehydratedDevice(K,Y,oe){return d(this,void 0,void 0,function*(){if(this.crypto)return yield this.crypto.dehydrationManager.setKey(K,Y,oe),this.crypto.dehydrationManager.dehydrateDevice();w.logger.warn("not dehydrating device if crypto is not enabled")})}exportDevice(){return d(this,void 0,void 0,function*(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:yield this.crypto.olmDevice.export()};w.logger.warn("not exporting device if crypto is not enabled")})}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const K=[];return K.push(this.store.deleteAllData()),this.cryptoStore&&K.push(this.cryptoStore.deleteAllData()),Promise.all(K).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(K){this.forceTURN=K}setSupportsCallTransfer(K){this.supportsCallTransfer=K}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(K){return(0,i.createNewMatrixCall)(this,K)}createGroupCall(K,Y,oe,le,ge,Ie){return d(this,void 0,void 0,function*(){if(this.getGroupCallForRoom(K))throw new Error(`${K} already has an existing group call`);const Ce=this.getRoom(K);if(!Ce)throw new Error(`Cannot find room ${K}`);return new ue.GroupCall(this,Ce,Y,oe,le,void 0,ge,Ie).create()})}waitUntilRoomReadyForGroupCalls(K){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(K)}getGroupCallForRoom(K){return this.groupCallEventHandler.groupCalls.get(K)||null}getSyncState(){var K,Y;return null!==(Y=null===(K=this.syncApi)||void 0===K?void 0:K.getSyncState())&&void 0!==Y?Y:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const K=this.getSyncState();return!!K&&(K===f.SyncState.Prepared||K===f.SyncState.Syncing)}isGuest(){return this.isGuestAccount}setGuest(K){this.isGuestAccount=K}getScheduler(){return this.scheduler}retryImmediately(){var K,Y;return this.toDeviceMessageQueue.sendQueue(),null!==(Y=null===(K=this.syncApi)||void 0===K?void 0:K.retryImmediately())&&void 0!==Y&&Y}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(K){this.notifTimelineSet=K}getCapabilities(K=!1){const Y=(new Date).getTime();return this.cachedCapabilities&&!K&&Y<this.cachedCapabilities.expiration?(w.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(B.Method.Get,"/capabilities").catch(oe=>(w.logger.error(oe),{})).then((oe={})=>{const le=oe.capabilities||{},ge=Object.keys(le).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:le,expiration:Y+ge},w.logger.log("Caching capabilities: ",le),le})}initCrypto(){return d(this,void 0,void 0,function*(){if(!(0,J.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.cryptoBackend)return void w.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");w.logger.log("Crypto: Starting up crypto store..."),yield this.cryptoStore.startup(),w.logger.log("Crypto: initialising roomlist..."),yield this.roomList.init();const K=this.getUserId();if(null===K)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const Y=new J.Crypto(this,K,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(Y,[J.CryptoEvent.KeyBackupFailed,J.CryptoEvent.KeyBackupSessionsRemaining,J.CryptoEvent.RoomKeyRequest,J.CryptoEvent.RoomKeyRequestCancellation,J.CryptoEvent.Warning,J.CryptoEvent.DevicesUpdated,J.CryptoEvent.WillUpdateDevices,J.CryptoEvent.DeviceVerificationChanged,J.CryptoEvent.UserTrustStatusChanged,J.CryptoEvent.KeysChanged]),w.logger.log("Crypto: initialising crypto object..."),yield Y.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=J.Crypto.getOlmVersion(),Y.registerEventHandlers(this),this.cryptoBackend=this.crypto=Y,this.crypto.uploadDeviceKeys().catch(oe=>{w.logger.error("Error uploading device keys",oe)})})}isCryptoEnabled(){return!!this.cryptoBackend}getDeviceEd25519Key(){var K,Y;return null!==(Y=null===(K=this.crypto)||void 0===K?void 0:K.getDeviceEd25519Key())&&void 0!==Y?Y:null}getDeviceCurve25519Key(){var K,Y;return null!==(Y=null===(K=this.crypto)||void 0===K?void 0:K.getDeviceCurve25519Key())&&void 0!==Y?Y:null}uploadKeys(){return d(this,void 0,void 0,function*(){w.logger.warn("MatrixClient.uploadKeys is deprecated")})}downloadKeys(K,Y){return this.crypto?this.crypto.downloadKeys(K,Y):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(K)||[]}getStoredDevice(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(K,Y)||null}setDeviceVerified(K,Y,oe=!0){const le=this.setDeviceVerification(K,Y,oe,null,null);return K==this.credentials.userId&&this.checkKeyBackup(),le}setDeviceBlocked(K,Y,oe=!0){return this.setDeviceVerification(K,Y,null,oe,null)}setDeviceKnown(K,Y,oe=!0){return this.setDeviceVerification(K,Y,null,null,oe)}setDeviceVerification(K,Y,oe,le,ge){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");yield this.crypto.setDeviceVerification(K,Y,oe,le,ge)})}requestVerificationDM(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(K,Y)}findVerificationRequestDMInProgress(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(K)}getVerificationRequestsToDeviceInProgress(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(K)}requestVerification(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(K,Y)}beginKeyVerification(K,Y,oe){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(K,Y,oe)}checkSecretStorageKey(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(K,Y)}setGlobalBlacklistUnverifiedDevices(K){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices=K,K}getGlobalBlacklistUnverifiedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(K){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.globalErrorOnUnknownDevices=K}getGlobalErrorOnUnknownDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalErrorOnUnknownDevices}getCrossSigningId(K=V.CrossSigningKey.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(K)}getStoredCrossSigningForUser(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(K)}checkUserTrust(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(K)}checkDeviceTrust(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(K,Y)}checkIfOwnDeviceCrossSigned(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(K)}checkOwnCrossSigningTrust(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(K)}checkCrossSigningPrivateKey(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(K,Y)}legacyDeviceVerification(K,Y,oe){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(K,Y,oe)}prepareToEncrypt(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.prepareToEncrypt(K)}userHasCrossSigningKeys(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.userHasCrossSigningKeys()}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(K)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.setCryptoTrustCrossSignedDevices(K)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(K)}createRecoveryKeyFromPassphrase(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(K)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(K)}addSecretStorageKey(K,Y,oe){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(K,Y,oe)}hasSecretStorageKey(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(K)}storeSecret(K,Y,oe){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(K,Y,oe)}getSecret(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(K)}isSecretStored(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(K)}requestSecret(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(K,Y)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(K)}checkSecretStoragePrivateKey(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(K,Y)}getEventSenderDeviceInfo(K){return d(this,void 0,void 0,function*(){return this.crypto?this.crypto.getEventSenderDeviceInfo(K):null})}isEventSenderVerified(K){return d(this,void 0,void 0,function*(){const Y=yield this.getEventSenderDeviceInfo(K);return!!Y&&Y.isVerified()})}getOutgoingRoomKeyRequest(K){if(!this.crypto)throw new Error("End-to-End encryption disabled");const Y=K.getWireContent(),oe={session_id:Y.session_id,sender_key:Y.sender_key,algorithm:Y.algorithm,room_id:K.getRoomId()};return oe.session_id&&oe.sender_key&&oe.algorithm&&oe.room_id?this.crypto.cryptoStore.getOutgoingRoomKeyRequest(oe):Promise.resolve(null)}cancelAndResendEventRoomKeyRequest(K){if(!this.crypto)throw new Error("End-to-End encryption disabled");return K.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(K,Y){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(K,Y)}isRoomEncrypted(K){const Y=this.getRoom(K);return!!Y&&(!!Y.currentState.getStateEvents(S.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(K))}encryptAndSendToDevices(K,Y){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(K,Y)}forceDiscardSession(K){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(K)}exportRoomKeys(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(K,Y){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(K,Y)}checkKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.checkKeyBackup()}getKeyBackupVersion(){return d(this,void 0,void 0,function*(){let K;try{K=yield this.http.authedRequest(B.Method.Get,"/room_keys/version",void 0,void 0,{prefix:B.ClientPrefix.V3})}catch(Y){if("M_NOT_FOUND"===Y.errcode)return null;throw Y}return D.BackupManager.checkBackupVersion(K),K})}isKeyBackupTrusted(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.isKeyBackupTrusted(K)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(K){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(K)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}prepareKeyBackupVersion(K,Y={secureSecretStorage:!1}){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:oe,auth_data:le,recovery_key:ge,privateKey:Ie}=yield this.crypto.backupManager.prepareKeyBackupVersion(K);return Y.secureSecretStorage&&(yield this.storeSecret("m.megolm_backup.v1",(0,p.encodeBase64)(Ie)),w.logger.info("Key backup private key stored in secret storage")),{algorithm:oe,auth_data:le,recovery_key:ge}})}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1"))}createKeyBackupVersion(K){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");yield this.crypto.backupManager.createKeyBackupVersion(K);const Y={algorithm:K.algorithm,auth_data:K.auth_data};yield this.crypto.signObject(Y.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&(yield this.crypto.crossSigningInfo.signObject(Y.auth_data,"master"));const oe=yield this.http.authedRequest(B.Method.Post,"/room_keys/version",void 0,Y,{prefix:B.ClientPrefix.V3});return yield this.checkKeyBackup(),this.getKeyBackupEnabled()||w.logger.error("Key backup not usable even though we just created it"),oe})}deleteKeyBackupVersion(K){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();const Y=t.encodeUri("/room_keys/version/$version",{$version:K});yield this.http.authedRequest(B.Method.Delete,Y,void 0,void 0,{prefix:B.ClientPrefix.V3})})}makeKeyBackupPath(K,Y,oe){let le;return le=void 0!==Y?t.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:K,$sessionId:Y}):void 0!==K?t.encodeUri("/room_keys/keys/$roomId",{$roomId:K}):"/room_keys/keys",{path:le,queryData:void 0===oe?void 0:{version:oe}}}sendKeyBackup(K,Y,oe,le){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const ge=this.makeKeyBackupPath(K,Y,oe);yield this.http.authedRequest(B.Method.Put,ge.path,ge.queryData,le,{prefix:B.ClientPrefix.V3})})}scheduleAllGroupSessionsForBackup(){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");yield this.crypto.backupManager.scheduleAllGroupSessionsForBackup()})}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(K){try{return(0,z.decodeRecoveryKey)(K),!0}catch{return!1}}keyBackupKeyFromPassword(K,Y){return(0,M.keyFromAuthData)(Y.auth_data,K)}keyBackupKeyFromRecoveryKey(K){return(0,z.decodeRecoveryKey)(K)}restoreKeyBackupWithPassword(K,Y,oe,le,ge){return d(this,void 0,void 0,function*(){const Ie=yield(0,M.keyFromAuthData)(le.auth_data,K);return this.restoreKeyBackup(Ie,Y,oe,le,ge)})}restoreKeyBackupWithSecretStorage(K,Y,oe,le){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const ge=yield this.getSecret("m.megolm_backup.v1"),Ie=(0,J.fixBackupKey)(ge);if(Ie){const Pe=yield this.crypto.getSecretStorageKey();yield this.storeSecret("m.megolm_backup.v1",Ie,[Pe[0]])}const Ce=(0,p.decodeBase64)(Ie||ge);return this.restoreKeyBackup(Ce,Y,oe,K,le)})}restoreKeyBackupWithRecoveryKey(K,Y,oe,le,ge){const Ie=(0,z.decodeRecoveryKey)(K);return this.restoreKeyBackup(Ie,Y,oe,le,ge)}restoreKeyBackupWithCache(K,Y,oe,le){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const ge=yield this.crypto.getSessionBackupPrivateKey();if(!ge)throw new Error("Couldn't get key");return this.restoreKeyBackup(ge,K,Y,oe,le)})}restoreKeyBackup(K,Y,oe,le,ge){return d(this,void 0,void 0,function*(){const Ie=ge?.cacheCompleteCallback,Ce=ge?.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let Pe=0,He=[];const Fe=this.makeKeyBackupPath(Y,oe,le.version),je=yield D.BackupManager.makeAlgorithm(le,()=>d(this,void 0,void 0,function*(){return K})),et=je.untrusted;try{if(!(yield je.keyMatches(K)))return Promise.reject(new B.MatrixError({errcode:Be.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(K).catch(Je=>{w.logger.warn("Error caching session backup key:",Je)}).then(Ie),Ce&&Ce({stage:"fetch"});const Ve=yield this.http.authedRequest(B.Method.Get,Fe.path,Fe.queryData,void 0,{prefix:B.ClientPrefix.V3});if(Ve.rooms){const Je=Ve.rooms;for(const[St,tt]of Object.entries(Je)){if(!tt.sessions)continue;Pe+=Object.keys(tt.sessions).length;const Qe=yield je.decryptSessions(tt.sessions);for(const Ct of Qe)Ct.room_id=St,He.push(Ct)}}else if(Ve.sessions){const Je=Ve.sessions;Pe=Object.keys(Je).length,He=yield je.decryptSessions(Je);for(const St of He)St.room_id=Y}else{Pe=1;try{const[Je]=yield je.decryptSessions({[oe]:Ve});Je.room_id=Y,Je.session_id=oe,He.push(Je)}catch(Je){w.logger.log("Failed to decrypt megolm session from backup",Je)}}}finally{je.free()}return yield this.importRoomKeys(He,{progressCallback:Ce,untrusted:et,source:"backup"}),yield this.checkKeyBackup(),{total:Pe,imported:He.length}})}deleteKeysFromBackup(K,Y,oe){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const le=this.makeKeyBackupPath(K,Y,oe);yield this.http.authedRequest(B.Method.Delete,le.path,le.queryData,void 0,{prefix:B.ClientPrefix.V3})})}sendSharedHistoryKeys(K,Y){return d(this,void 0,void 0,function*(){if(!this.crypto)throw new Error("End-to-end encryption disabled");const oe=this.roomList.getRoomEncryption(K);if(!oe)return void w.logger.error("Unknown room.  Not sharing decryption keys");const le=yield this.crypto.downloadKeys(Y),ge={};for(const[Ce,Pe]of Object.entries(le))ge[Ce]=Object.values(Pe);const Ie=this.crypto.getRoomDecryptor(K,oe.algorithm);Ie.sendSharedHistoryInboundSessions?yield Ie.sendSharedHistoryInboundSessions(ge):w.logger.warn("Algorithm does not support sharing previous keys",oe.algorithm)})}getMediaConfig(){return this.http.authedRequest(B.Method.Get,"/config",void 0,void 0,{prefix:B.MediaPrefix.R0})}getRoom(K){return K?this.store.getRoom(K):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){const K=this.store.getRooms(),Y=new Set;for(const oe of K){const le=oe.currentState.getStateEvents(S.EventType.RoomCreate,"");if(le){const ge=le.getContent().predecessor;ge&&ge.room_id&&Y.add(ge.room_id)}}return K.filter(oe=>!(oe.currentState.getStateEvents(S.EventType.RoomTombstone,"")&&Y.has(oe.roomId)))}getUser(K){return this.store.getUser(K)}getUsers(){return this.store.getUsers()}setAccountData(K,Y){const oe=t.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:K});return(0,B.retryNetworkOperation)(5,()=>this.http.authedRequest(B.Method.Put,oe,void 0,Y))}getAccountData(K){return this.store.getAccountData(K)}getAccountDataFromServer(K){var Y;return d(this,void 0,void 0,function*(){if(this.isInitialSyncComplete()){const le=this.store.getAccountData(K);return le?le.getContent():null}const oe=t.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:K});try{return yield this.http.authedRequest(B.Method.Get,oe)}catch(le){if("M_NOT_FOUND"===(null===(Y=le.data)||void 0===Y?void 0:Y.errcode))return null;throw le}})}getIgnoredUsers(){const K=this.getAccountData("m.ignored_user_list");return K&&K.getContent()&&K.getContent().ignored_users?Object.keys(K.getContent().ignored_users):[]}setIgnoredUsers(K){const Y={ignored_users:{}};return K.forEach(oe=>{Y.ignored_users[oe]={}}),this.setAccountData("m.ignored_user_list",Y)}isUserIgnored(K){return this.getIgnoredUsers().includes(K)}joinRoom(K,Y={}){return d(this,void 0,void 0,function*(){void 0===Y.syncRoom&&(Y.syncRoom=!0);const oe=this.getRoom(K);if(oe?.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(oe);let le=Promise.resolve();if(Y.inviteSignUrl){const Ie=new URL(Y.inviteSignUrl);Ie.searchParams.set("mxid",this.credentials.userId),le=this.http.requestOtherUrl(B.Method.Post,Ie)}const ge={};Y.viaServers&&(ge.server_name=Y.viaServers);try{const Ie={},Ce=yield le;Ce&&(Ie.third_party_signed=Ce);const Pe=t.encodeUri("/join/$roomid",{$roomid:K}),Fe=(yield this.http.authedRequest(B.Method.Post,Pe,ge,Ie)).room_id;return new f.SyncApi(this,this.clientOpts).createRoom(Fe)}catch(Ie){throw Ie}})}resendEvent(K,Y){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(Y,K,v.EventStatus.SENDING),this.encryptAndSendEvent(Y,K)}cancelPendingEvent(K){if(![v.EventStatus.QUEUED,v.EventStatus.NOT_SENT,v.EventStatus.ENCRYPTING].includes(K.status))throw new Error("cannot cancel an event with status "+K.status);K.status===v.EventStatus.ENCRYPTING?this.pendingEventEncryption.delete(K.getId()):this.scheduler&&K.status===v.EventStatus.QUEUED&&this.scheduler.removeEventFromQueue(K);const Y=this.getRoom(K.getRoomId());this.updatePendingEventStatus(Y,K,v.EventStatus.CANCELLED)}setRoomName(K,Y){return this.sendStateEvent(K,S.EventType.RoomName,{name:Y})}setRoomTopic(K,Y,oe){const le=N.makeTopicContent(Y,oe);return this.sendStateEvent(K,S.EventType.RoomTopic,le)}getRoomTags(K){const Y=t.encodeUri("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:K});return this.http.authedRequest(B.Method.Get,Y)}setRoomTag(K,Y,oe){const le=t.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:K,$tag:Y});return this.http.authedRequest(B.Method.Put,le,void 0,oe)}deleteRoomTag(K,Y){const oe=t.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:K,$tag:Y});return this.http.authedRequest(B.Method.Delete,oe)}setRoomAccountData(K,Y,oe){const le=t.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:K,$type:Y});return this.http.authedRequest(B.Method.Put,le,void 0,oe)}setPowerLevel(K,Y,oe,le){let ge={users:{}};if(le.getType()===S.EventType.RoomPowerLevels&&(ge=t.deepCopy(le.getContent())),Array.isArray(Y))for(const Ce of Y)ge.users[Ce]=oe;else ge.users[Y]=oe;const Ie=t.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:K});return this.http.authedRequest(B.Method.Put,Ie,void 0,ge)}unstable_createLiveBeacon(K,Y){return d(this,void 0,void 0,function*(){return this.unstable_setLiveBeacon(K,Y)})}unstable_setLiveBeacon(K,Y){return d(this,void 0,void 0,function*(){return this.sendStateEvent(K,P.M_BEACON_INFO.name,Y,this.getUserId())})}sendEvent(K,Y,oe,le,ge){var Ie,Ce,Pe,He,Fe;let je,et,Ve,Je;if(Y?.startsWith(Ae)||null===Y?(Je=ge,Ve=le,et=oe,je=Y):(Je=le,Ve=oe,et=Y,je=null),je&&(null===(Ie=Ve["m.relates_to"])||void 0===Ie||!Ie.rel_type)){const St=!(null===(Ce=Ve["m.relates_to"])||void 0===Ce||!Ce["m.in_reply_to"]);Ve["m.relates_to"]=Object.assign(Object.assign({},Ve["m.relates_to"]),{rel_type:te.THREAD_RELATION_TYPE.name,event_id:je,is_falling_back:!St});const tt=null===(Pe=this.getRoom(K))||void 0===Pe?void 0:Pe.getThread(je);tt&&!St&&(Ve["m.relates_to"]["m.in_reply_to"]={event_id:null!==(Fe=null===(He=tt.lastReply(Qe=>Qe.isRelation(te.THREAD_RELATION_TYPE.name)&&!Qe.status))||void 0===He?void 0:He.getId())&&void 0!==Fe?Fe:je})}return this.sendCompleteEvent(K,je,{type:et,content:Ve},Je)}sendCompleteEvent(K,Y,oe,le){le||(le=this.makeTxnId());const ge=new v.MatrixEvent(Object.assign(oe,{event_id:"~"+K+":"+le,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:K,origin_server_ts:(new Date).getTime()})),Ie=this.getRoom(K),Ce=Y?Ie?.getThread(Y):void 0;Ce&&ge.setThread(Ce),this.reEmitter.reEmit(ge,[v.MatrixEventEvent.Replaced,v.MatrixEventEvent.VisibilityChange]),Ie?.reEmitter.reEmit(ge,[v.MatrixEventEvent.BeforeRedaction]);const Pe=ge.getAssociatedId();if(Pe?.startsWith("~")){const Fe=Ie?.getPendingEvents().find(je=>je.getId()===Pe);Fe?.once(v.MatrixEventEvent.LocalEventIdReplaced,()=>{ge.updateAssociatedId(Fe.getId())})}const He=ge.getType();return w.logger.log(`sendEvent of type ${He} in ${K} with txnId ${le}`),ge.setTxnId(le),ge.setStatus(v.EventStatus.SENDING),Ie?.addPendingEvent(ge,le),ge.status===v.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(Ie,ge)}encryptAndSendEvent(K,Y){let oe=!1;return Promise.resolve().then(()=>{const le=this.encryptEventIfNeeded(Y,K??void 0);return le?(this.pendingEventEncryption.set(Y.getId(),le),this.updatePendingEventStatus(K,Y,v.EventStatus.ENCRYPTING),le.then(()=>{this.pendingEventEncryption.has(Y.getId())?this.updatePendingEventStatus(K,Y,v.EventStatus.SENDING):oe=!0})):null}).then(()=>{if(oe)return{};let le=null;return this.scheduler&&(le=this.scheduler.queueEvent(Y),le&&this.scheduler.getQueueForEvent(Y).length>1&&this.updatePendingEventStatus(K,Y,v.EventStatus.QUEUED)),le||(le=this.sendEventHttpRequest(Y),K&&(le=le.then(ge=>(K.updatePendingEvent(Y,v.EventStatus.SENT,ge.event_id),ge)))),le}).catch(le=>{w.logger.error("Error sending event",le.stack||le);try{Y.error=le,this.updatePendingEventStatus(K,Y,v.EventStatus.NOT_SENT)}catch(ge){w.logger.error("Exception in error handler!",ge.stack||le)}throw le instanceof B.MatrixError&&(le.event=Y),le})}encryptEventIfNeeded(K,Y){if(K.isEncrypted()||K.isRedaction()||!this.isRoomEncrypted(K.getRoomId())||!this.crypto&&this.usingExternalCrypto||K.getType()===S.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(K,Y)}getEncryptedIfNeededEventType(K,Y){return Y===S.EventType.Reaction?Y:this.isRoomEncrypted(K)?S.EventType.RoomMessageEncrypted:Y}updatePendingEventStatus(K,Y,oe){K?K.updatePendingEvent(Y,oe):Y.setStatus(oe)}sendEventHttpRequest(K){let Y=K.getTxnId();Y||(Y=this.makeTxnId(),K.setTxnId(Y));const oe={$roomId:K.getRoomId(),$eventType:K.getWireType(),$stateKey:K.getStateKey(),$txnId:Y};let le;if(K.isState()){let ge="/rooms/$roomId/state/$eventType";K.getStateKey()&&K.getStateKey().length>0&&(ge="/rooms/$roomId/state/$eventType/$stateKey"),le=t.encodeUri(ge,oe)}else le=K.isRedaction()?t.encodeUri("/rooms/$roomId/redact/$redactsEventId/$txnId",Object.assign({$redactsEventId:K.event.redacts},oe)):t.encodeUri("/rooms/$roomId/send/$eventType/$txnId",oe);return this.http.authedRequest(B.Method.Put,le,void 0,K.getWireContent()).then(ge=>(w.logger.log(`Event sent to ${K.getRoomId()} with event id ${ge.event_id}`),ge))}redactEvent(K,Y,oe,le,ge){oe?.startsWith(Ae)||(ge=le,le=oe,oe=Y,Y=null);const Ie=ge?.reason;return this.sendCompleteEvent(K,Y,{type:S.EventType.RoomRedaction,content:{reason:Ie},redacts:oe},le)}sendMessage(K,Y,oe,le){"string"!=typeof Y&&null!==Y&&(le=oe,oe=Y,Y=null);let ge=S.EventType.RoomMessage,Ie=oe;const Ce=(He={},Fe=!0)=>{let je;if(He.msgtype===S.MsgType.Text?je=g.MessageEvent.from(He.body,He.formatted_body).serialize():He.msgtype===S.MsgType.Emote?je=g.EmoteEvent.from(He.body,He.formatted_body).serialize():He.msgtype===S.MsgType.Notice&&(je=g.NoticeEvent.from(He.body,He.formatted_body).serialize()),je&&He["m.new_content"]&&Fe){const et=Ce(He["m.new_content"],!1);et&&(je.content["m.new_content"]=et.content)}if(je)for(const[et,Ve]of Object.entries(He))je.content.hasOwnProperty(et)||(je.content[et]=Ve);return je},Pe=Ce(Ie);return Pe&&(ge=Pe.type,Ie=Pe.content),this.sendEvent(K,Y,ge,Ie,le)}sendTextMessage(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeTextMessage(oe);return this.sendMessage(K,Y,ge,le)}sendNotice(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeNotice(oe);return this.sendMessage(K,Y,ge,le)}sendEmoteMessage(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeEmoteMessage(oe);return this.sendMessage(K,Y,ge,le)}sendImageMessage(K,Y,oe,le,ge="Image"){return!Y?.startsWith(Ae)&&null!==Y&&(ge=le||"Image",le=oe,oe=Y,Y=null),this.sendMessage(K,Y,{msgtype:S.MsgType.Image,url:oe,info:le,body:ge})}sendStickerMessage(K,Y,oe,le,ge="Sticker"){return!Y?.startsWith(Ae)&&null!==Y&&(ge=le||"Sticker",le=oe,oe=Y,Y=null),this.sendEvent(K,Y,S.EventType.Sticker,{url:oe,info:le,body:ge})}sendHtmlMessage(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeHtmlMessage(oe,le);return this.sendMessage(K,Y,ge)}sendHtmlNotice(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeHtmlNotice(oe,le);return this.sendMessage(K,Y,ge)}sendHtmlEmote(K,Y,oe,le){!Y?.startsWith(Ae)&&null!==Y&&(le=oe,oe=Y,Y=null);const ge=N.makeHtmlEmote(oe,le);return this.sendMessage(K,Y,ge)}sendReceipt(K,Y,oe,le=!1){return d(this,void 0,void 0,function*(){if(this.isGuest())return Promise.resolve({});const ge=t.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:K.getRoomId(),$receiptType:Y,$eventId:K.getId()});if(this.canSupport.get(he.Feature.ThreadUnreadNotifications)!==he.ServerSupport.Unsupported&&!le){const He=!!K.threadRootId;oe=Object.assign(Object.assign({},oe),{thread_id:He?K.threadRootId:ne.MAIN_ROOM_TIMELINE})}const Ce=this.http.authedRequest(B.Method.Post,ge,void 0,oe||{}),Pe=this.getRoom(K.getRoomId());return Pe&&this.credentials.userId&&Pe.addLocalEchoReceipt(this.credentials.userId,K,Y),Ce})}sendReadReceipt(K,Y=ne.ReceiptType.Read,oe=!1){return d(this,void 0,void 0,function*(){if(!K)return;const le=K.getId();if(this.getRoom(K.getRoomId())?.hasPendingEvent(le))throw new Error(`Cannot set read receipt to a pending event (${le})`);return this.sendReceipt(K,Y,{},oe)})}setRoomReadMarkers(K,Y,oe,le){return d(this,void 0,void 0,function*(){const ge=this.getRoom(K);if(ge&&ge.hasPendingEvent(Y))throw new Error(`Cannot set read marker to a pending event (${Y})`);let Ie,Ce;if(oe){if(Ie=oe.getId(),ge?.hasPendingEvent(Ie))throw new Error(`Cannot set read receipt to a pending event (${Ie})`);ge?.addLocalEchoReceipt(this.credentials.userId,oe,ne.ReceiptType.Read)}if(le){if(Ce=le.getId(),ge?.hasPendingEvent(Ce))throw new Error(`Cannot set read receipt to a pending event (${Ce})`);ge?.addLocalEchoReceipt(this.credentials.userId,le,ne.ReceiptType.ReadPrivate)}return yield this.setRoomReadMarkersHttpRequest(K,Y,Ie,Ce)})}getUrlPreview(K,Y){Y=6e4*Math.floor(Y/6e4);const oe=new URL(K);oe.hash="";const le=Y+"_"+(K=oe.toString()),ge=this.urlPreviewCache[le];if(ge)return ge;const Ie=this.http.authedRequest(B.Method.Get,"/preview_url",{url:K,ts:Y.toString()},void 0,{prefix:B.MediaPrefix.R0});return this.urlPreviewCache[le]=Ie,Ie}sendTyping(K,Y,oe){if(this.isGuest())return Promise.resolve({});const le=t.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:K,$userId:this.getUserId()}),ge={typing:Y};return Y&&(ge.timeout=oe||2e4),this.http.authedRequest(B.Method.Put,le,void 0,ge)}getRoomUpgradeHistory(K,Y=!1){let oe=this.getRoom(K);if(!oe)return[];const le=[oe];let ge=oe.currentState.getStateEvents(S.EventType.RoomCreate,"");for(;ge;){const Ce=ge.getContent().predecessor;if(!Ce||!Ce.room_id)break;{const Pe=this.getRoom(Ce.room_id);if(!Pe)break;if(Y){const He=Pe.currentState.getStateEvents(S.EventType.RoomTombstone,"");if(!He||He.getContent().replacement_room!==Pe.roomId)break}le.splice(0,0,Pe),ge=Pe.currentState.getStateEvents(S.EventType.RoomCreate,"")}}let Ie=oe.currentState.getStateEvents(S.EventType.RoomTombstone,"");for(;Ie;){const Ce=this.getRoom(Ie.getContent().replacement_room);if(!Ce||Ce.roomId===oe.roomId||Y&&(ge=Ce.currentState.getStateEvents(S.EventType.RoomCreate,""),!ge||!ge.getContent().predecessor||ge.getContent().predecessor.room_id!==oe.roomId))break;if(le.push(Ce),new Set(le.map(He=>He.roomId)).size<le.length)return le.slice(0,le.length-1);oe=Ce,Ie=oe.currentState.getStateEvents(S.EventType.RoomTombstone,"")}return le}invite(K,Y,oe){return this.membershipChange(K,Y,"invite",oe)}inviteByEmail(K,Y){return this.inviteByThreePid(K,"email",Y)}inviteByThreePid(K,Y,oe){var le;return d(this,void 0,void 0,function*(){const ge=t.encodeUri("/rooms/$roomId/invite",{$roomId:K}),Ie=this.getIdentityServerUrl(!0);if(!Ie)return Promise.reject(new B.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const Ce={id_server:Ie,medium:Y,address:oe};if(null!==(le=this.identityServer)&&void 0!==le&&le.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const Pe=yield this.identityServer.getAccessToken();Pe&&(Ce.id_access_token=Pe)}return this.http.authedRequest(B.Method.Post,ge,void 0,Ce)})}leave(K){return this.membershipChange(K,void 0,"leave")}leaveRoomChain(K,Y=!0){const oe=this.getRoomUpgradeHistory(K);let le=oe;if(!Y){le=[];for(const Pe of oe)if(le.push(Pe),Pe.roomId===K)break}const ge={},Ie=[],Ce=Pe=>this.leave(Pe).then(()=>{delete ge[Pe]}).catch(He=>{ge[Pe]=He});for(const Pe of le)Ie.push(Ce(Pe.roomId));return Promise.all(Ie).then(()=>ge)}ban(K,Y,oe){return this.membershipChange(K,Y,"ban",oe)}forget(K,Y=!0){const oe=this.membershipChange(K,void 0,"forget");return Y?oe.then(le=>(this.store.removeRoom(K),this.emit(Ne.DeleteRoom,K),le)):oe}unban(K,Y){const oe=t.encodeUri("/rooms/$roomId/unban",{$roomId:K});return this.http.authedRequest(B.Method.Post,oe,void 0,{user_id:Y})}kick(K,Y,oe){const le=t.encodeUri("/rooms/$roomId/kick",{$roomId:K});return this.http.authedRequest(B.Method.Post,le,void 0,{user_id:Y,reason:oe})}membershipChange(K,Y,oe,le){const ge=t.encodeUri("/rooms/$room_id/$membership",{$room_id:K,$membership:oe});return this.http.authedRequest(B.Method.Post,ge,void 0,{user_id:Y,reason:le})}getPushActionsForEvent(K,Y=!1){return(!K.getPushActions()||Y)&&K.setPushActions(this.pushProcessor.actionsForEvent(K)),K.getPushActions()}setProfileInfo(K,Y){const oe=t.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:K});return this.http.authedRequest(B.Method.Put,oe,void 0,Y)}setDisplayName(K){return d(this,void 0,void 0,function*(){const Y=yield this.setProfileInfo("displayname",{displayname:K}),oe=this.getUser(this.getUserId());return oe&&(oe.displayName=K,oe.emit(L.UserEvent.DisplayName,oe.events.presence,oe)),Y})}setAvatarUrl(K){return d(this,void 0,void 0,function*(){const Y=yield this.setProfileInfo("avatar_url",{avatar_url:K}),oe=this.getUser(this.getUserId());return oe&&(oe.avatarUrl=K,oe.emit(L.UserEvent.AvatarUrl,oe.events.presence,oe)),Y})}mxcUrlToHttp(K,Y,oe,le,ge){return(0,j.getHttpUriForMxc)(this.baseUrl,K,Y,oe,le,ge)}setPresence(K){return d(this,void 0,void 0,function*(){const Y=t.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if(-1===["offline","online","unavailable"].indexOf(K.presence))throw new Error("Bad presence value: "+K.presence);yield this.http.authedRequest(B.Method.Put,Y,void 0,K)})}getPresence(K){const Y=t.encodeUri("/presence/$userId/status",{$userId:K});return this.http.authedRequest(B.Method.Get,Y)}scrollback(K,Y=30){let oe=0,le=this.ongoingScrollbacks[K.roomId]||{};if(le.promise)return le.promise;if(le.errorTs){const Ce=Date.now()-le.errorTs;oe=Math.max(3e3-Ce,0)}if(null===K.oldState.paginationToken)return Promise.resolve(K);const ge=this.store.scrollback(K,Y).length;if(ge===Y)return Promise.resolve(K);Y-=ge;const Ie=new Promise((Ce,Pe)=>{(0,n.sleep)(oe).then(()=>this.createMessagesRequest(K.roomId,K.oldState.paginationToken,Y,o.Direction.Backward)).then(He=>{var Fe,je;const et=He.chunk.map(this.getEventMapper());if(He.state){const St=He.state.map(this.getEventMapper());K.currentState.setUnknownStateEvents(St)}const[Ve,Je]=K.partitionThreadedEvents(et);this.processBeaconEvents(K,Ve),K.addEventsToTimeline(Ve,!0,K.getLiveTimeline()),this.processThreadEvents(K,Je,!0),K.oldState.paginationToken=null!==(Fe=He.end)&&void 0!==Fe?Fe:null,0===He.chunk.length&&(K.oldState.paginationToken=null),this.store.storeEvents(K,et,null!==(je=He.end)&&void 0!==je?je:null,!0),delete this.ongoingScrollbacks[K.roomId],Ce(K)}).catch(He=>{this.ongoingScrollbacks[K.roomId]={errorTs:Date.now()},Pe(He)})});return le={promise:Ie},this.ongoingScrollbacks[K.roomId]=le,Ie}getEventMapper(K){return(0,W.eventMapperFor)(this,K||{})}getEventTimeline(K,Y){var oe,le,ge,Ie;return d(this,void 0,void 0,function*(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!K?.room)throw new Error("getEventTimeline only supports room timelines");if(K.getTimelineForEvent(Y))return K.getTimelineForEvent(Y);if(K.thread&&this.supportsExperimentalThreads())return this.getThreadTimeline(K,Y);const Ce=t.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:K.room.roomId,$eventId:Y});let Pe;null!==(oe=this.clientOpts)&&void 0!==oe&&oe.lazyLoadMembers&&(Pe={filter:JSON.stringify(r.Filter.LAZY_LOADING_MESSAGES_FILTER)});const He=yield this.http.authedRequest(B.Method.Get,Ce,Pe);if(!He.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(K.getTimelineForEvent(Y))return K.getTimelineForEvent(Y);const Fe=this.getEventMapper(),je=Fe(He.event);if(je.isRelation(te.THREAD_RELATION_TYPE.name))return void w.logger.warn("Tried loading a regular timeline at the position of a thread event");const et=[...He.events_after.reverse().map(Fe),je,...He.events_before.map(Fe)];let Ve=K.getTimelineForEvent(et[0].getId());Ve?Ve.getState(o.EventTimeline.BACKWARDS).setUnknownStateEvents(He.state.map(Fe)):(Ve=K.addTimeline(),Ve.initialiseState(He.state.map(Fe)),Ve.getState(o.EventTimeline.FORWARDS).paginationToken=He.end);const[Je,St]=K.room.partitionThreadedEvents(et);return K.addEventsToTimeline(Je,!0,Ve,He.start),this.processThreadEvents(K.room,St,!0),this.processBeaconEvents(K.room,Je),null!==(Ie=null!==(le=K.getTimelineForEvent(Y))&&void 0!==le?le:null===(ge=K.room.findThreadForEvent(je))||void 0===ge?void 0:ge.liveTimeline)&&void 0!==Ie?Ie:Ve})}getThreadTimeline(K,Y){var oe,le,ge,Ie,Ce,Pe,He,Fe;return d(this,void 0,void 0,function*(){if(!this.supportsExperimentalThreads())throw new Error("could not get thread timeline: no client support");if(!K.room)throw new Error("could not get thread timeline: not a room timeline");if(!K.thread)throw new Error("could not get thread timeline: not a thread timeline");const je=t.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:K.room.roomId,$eventId:Y}),et={limit:"0"};null!==(oe=this.clientOpts)&&void 0!==oe&&oe.lazyLoadMembers&&(et.filter=JSON.stringify(r.Filter.LAZY_LOADING_MESSAGES_FILTER));const Ve=yield this.http.authedRequest(B.Method.Get,je,et),Je=this.getEventMapper(),St=Je(Ve.event);if(K.canContain(St)&&te.Thread.hasServerSideSupport){if(te.Thread.hasServerSideFwdPaginationSupport){if(!K.thread)throw new Error("could not get thread timeline: not a thread timeline");const tt=K.thread,Qe=yield this.fetchRelations(K.room.roomId,tt.id,te.THREAD_RELATION_TYPE.name,null,{dir:o.Direction.Backward,from:Ve.start}),Ct=yield this.fetchRelations(K.room.roomId,tt.id,te.THREAD_RELATION_TYPE.name,null,{dir:o.Direction.Forward,from:Ve.end}),it=[...Ct.chunk.reverse().map(Je),St,...Qe.chunk.map(Je)];for(const yt of it)yield null===(le=K.thread)||void 0===le?void 0:le.processEvent(yt);let rt=K.getTimelineForEvent(St.getId());if(rt?rt.getState(o.EventTimeline.BACKWARDS).setUnknownStateEvents(Ve.state.map(Je)):(rt=K.addTimeline(),rt.initialiseState(Ve.state.map(Je))),K.addEventsToTimeline(it,!0,rt,Ct.next_batch),!Qe.next_batch){const yt=yield this.fetchRoomEvent(K.room.roomId,tt.id);K.addEventsToTimeline([Je(yt)],!0,rt,null)}return rt.setPaginationToken(null!==(ge=Qe.next_batch)&&void 0!==ge?ge:null,o.Direction.Backward),rt.setPaginationToken(null!==(Ie=Ct.next_batch)&&void 0!==Ie?Ie:null,o.Direction.Forward),this.processBeaconEvents(K.room,it),null!==(Ce=K.getTimelineForEvent(Y))&&void 0!==Ce?Ce:rt}{const tt=K.thread,Qe=yield this.fetchRelations(K.room.roomId,tt.id,te.THREAD_RELATION_TYPE.name,null,{dir:o.Direction.Backward,from:Ve.start}),Ct=[];let it=Ve.end;for(;it;){const nt=yield this.fetchRelations(K.room.roomId,tt.id,te.THREAD_RELATION_TYPE.name,null,{dir:o.Direction.Forward,from:it});it=null!==(Pe=nt.next_batch)&&void 0!==Pe?Pe:null,Ct.push(...nt.chunk)}const rt=[...Ct.reverse().map(Je),St,...Qe.chunk.map(Je)];for(const nt of rt)yield null===(He=K.thread)||void 0===He?void 0:He.processEvent(nt);const yt=K.getLiveTimeline();if(yt.getState(o.EventTimeline.BACKWARDS).setUnknownStateEvents(Ve.state.map(Je)),K.addEventsToTimeline(rt,!0,yt,null),!Qe.next_batch){const nt=yield this.fetchRoomEvent(K.room.roomId,tt.id);K.addEventsToTimeline([Je(nt)],!0,yt,null)}return yt.setPaginationToken(null!==(Fe=Qe.next_batch)&&void 0!==Fe?Fe:null,o.Direction.Backward),yt.setPaginationToken(null,o.Direction.Forward),this.processBeaconEvents(K.room,rt),yt}}})}getLatestTimeline(K){var Y,oe,le,ge;return d(this,void 0,void 0,function*(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!K.room)throw new Error("getLatestTimeline only supports room timelines");let Ie;if(null!==K.threadListType)Ie=null===(Y=(yield this.createThreadListMessagesRequest(K.room.roomId,null,1,o.Direction.Backward,K.threadListType,K.getFilter())).chunk)||void 0===Y?void 0:Y[0];else if(K.thread&&te.Thread.hasServerSideSupport)Ie=null===(oe=(yield this.fetchRelations(K.room.roomId,K.thread.id,te.THREAD_RELATION_TYPE.name,null,{dir:o.Direction.Backward,limit:1})).chunk)||void 0===oe?void 0:oe[0];else{const Ce=t.encodeUri("/rooms/$roomId/messages",{$roomId:K.room.roomId}),Pe={dir:"b"};!(null===(le=this.clientOpts)||void 0===le)&&le.lazyLoadMembers&&(Pe.filter=JSON.stringify(r.Filter.LAZY_LOADING_MESSAGES_FILTER)),Ie=null===(ge=(yield this.http.authedRequest(B.Method.Get,Ce,Pe)).chunk)||void 0===ge?void 0:ge[0]}if(!Ie)throw new Error("No message returned when trying to construct getLatestTimeline");return this.getEventTimeline(K,Ie.event_id)})}createMessagesRequest(K,Y,oe=30,le,ge){var Ie,Ce;const Pe=t.encodeUri("/rooms/$roomId/messages",{$roomId:K}),He={limit:oe.toString(),dir:le};Y&&(He.from=Y);let Fe=null;return!(null===(Ie=this.clientOpts)||void 0===Ie)&&Ie.lazyLoadMembers&&(Fe=Object.assign({},r.Filter.LAZY_LOADING_MESSAGES_FILTER)),ge&&(Fe=Fe||{},Object.assign(Fe,null===(Ce=ge.getRoomTimelineFilterComponent())||void 0===Ce?void 0:Ce.toJSON())),Fe&&(He.filter=JSON.stringify(Fe)),this.http.authedRequest(B.Method.Get,Pe,He)}createThreadListMessagesRequest(K,Y,oe=30,le=o.Direction.Backward,ge=te.ThreadFilterType.All,Ie){var Ce,Pe;const He=t.encodeUri("/rooms/$roomId/threads",{$roomId:K}),Fe={limit:oe.toString(),dir:le,include:(0,te.threadFilterTypeToFilter)(ge)};Y&&(Fe.from=Y);let je={};return!(null===(Ce=this.clientOpts)||void 0===Ce)&&Ce.lazyLoadMembers&&(je=Object.assign({},r.Filter.LAZY_LOADING_MESSAGES_FILTER)),Ie&&(je=Object.assign(Object.assign({},je),null===(Pe=Ie.getRoomTimelineFilterComponent())||void 0===Pe?void 0:Pe.toJSON())),Object.keys(je).length&&(Fe.filter=JSON.stringify(je)),this.http.authedRequest(B.Method.Get,He,Fe,void 0,{prefix:te.Thread.hasServerSideListSupport===te.FeatureSupport.Stable?"/_matrix/client/v1":"/_matrix/client/unstable/org.matrix.msc3856"}).then(Ve=>{var Je;return Object.assign(Object.assign({},Ve),{chunk:null===(Je=Ve.chunk)||void 0===Je?void 0:Je.reverse(),start:Ve.prev_batch,end:Ve.next_batch})})}paginateEventTimeline(K,Y){var oe,le,ge;const Ie=K.getTimelineSet()===this.notifTimelineSet,Ce=this.getRoom(K.getRoomId()),Pe=K.getTimelineSet().threadListType,He=K.getTimelineSet().thread,Fe=(Y=Y||{}).backwards||!1;if(Ie&&!Fe)throw new Error("paginateNotifTimeline can only paginate backwards");const je=Fe?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS,et=K.getPaginationToken(je),Ve=K.paginationRequests[je];if(Ve)return Ve;let Je,St,tt;if(Ie)Je="/notifications",St={limit:(null!==(oe=Y.limit)&&void 0!==oe?oe:30).toString(),only:"highlight"},et&&"end"!==et&&(St.from=et),tt=this.http.authedRequest(B.Method.Get,"/notifications",St).then(Qe=>d(this,void 0,void 0,function*(){const Ct=Qe.next_token,it=[];for(let yt=0;yt<Qe.notifications.length;yt++){const nt=Qe.notifications[yt],st=this.getEventMapper()(nt.event);st.setPushActions(h.PushProcessor.actionListToActionsObject(nt.actions)),st.event.room_id=nt.room_id,it[yt]=st}const rt=K.getTimelineSet();return rt.addEventsToTimeline(it,Fe,K,Ct),this.processBeaconEvents(rt.room,it),Fe&&!Qe.next_token&&K.setPaginationToken(null,je),Boolean(Qe.next_token)})).finally(()=>{K.paginationRequests[je]=null}),K.paginationRequests[je]=tt;else if(null!==Pe){if(!Ce)throw new Error("Unknown room "+K.getRoomId());if(!te.Thread.hasServerSideFwdPaginationSupport&&je===o.Direction.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");tt=this.createThreadListMessagesRequest(K.getRoomId(),et,Y.limit,je,Pe,K.getFilter()).then(Qe=>{if(Qe.state){const yt=K.getState(je),nt=Qe.state.map(this.getEventMapper());yt.setUnknownStateEvents(nt)}const Ct=Qe.end,it=Qe.chunk.map(this.getEventMapper());return K.getTimelineSet().addEventsToTimeline(it,Fe,K,Ct),this.processBeaconEvents(Ce,it),this.processThreadRoots(Ce,it,Fe),Fe&&Qe.end==Qe.start&&K.setPaginationToken(null,je),Qe.end!==Qe.start}).finally(()=>{K.paginationRequests[je]=null}),K.paginationRequests[je]=tt}else if(He){const Qe=this.getRoom(null!==(le=K.getRoomId())&&void 0!==le?le:void 0);if(!Qe)throw new Error("Unknown room "+K.getRoomId());tt=this.fetchRelations(null!==(ge=K.getRoomId())&&void 0!==ge?ge:"",He.id,te.THREAD_RELATION_TYPE.name,null,{dir:je,limit:Y.limit,from:et??void 0}).then(Ct=>d(this,void 0,void 0,function*(){var it;const rt=this.getEventMapper(),yt=Ct.chunk.map(rt);for(const Nt of yt.slice().reverse()){yield He?.processEvent(Nt);const ft=Nt.getSender();(!Fe||null===He?.getEventReadUpTo(ft))&&Qe.addLocalEchoReceipt(ft,Nt,ne.ReceiptType.Read)}const nt=Ct.next_batch,st=K.getTimelineSet();if(st.addEventsToTimeline(yt,Fe,K,nt??null),!nt&&Fe){const Nt=yield this.fetchRoomEvent(null!==(it=K.getRoomId())&&void 0!==it?it:"",He.id);st.addEventsToTimeline([rt(Nt)],!0,K,null)}return this.processBeaconEvents(st.room,yt),Fe&&!nt&&K.setPaginationToken(null,je),Boolean(nt)})).finally(()=>{K.paginationRequests[je]=null}),K.paginationRequests[je]=tt}else{if(!Ce)throw new Error("Unknown room "+K.getRoomId());tt=this.createMessagesRequest(K.getRoomId(),et,Y.limit,je,K.getFilter()).then(Qe=>{if(Qe.state){const st=K.getState(je),Nt=Qe.state.map(this.getEventMapper());st.setUnknownStateEvents(Nt)}const Ct=Qe.end,it=Qe.chunk.map(this.getEventMapper()),rt=K.getTimelineSet(),[yt]=Ce.partitionThreadedEvents(it);rt.addEventsToTimeline(yt,Fe,K,Ct),this.processBeaconEvents(Ce,yt),this.processThreadRoots(Ce,yt.filter(st=>st.getServerAggregatedRelation(te.THREAD_RELATION_TYPE.name)),!1);const nt=void 0===Qe.end||Qe.end===Qe.start;return Fe&&nt&&K.setPaginationToken(null,je),!nt}).finally(()=>{K.paginationRequests[je]=null}),K.paginationRequests[je]=tt}return tt}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(K){var Y;return null===(Y=this.peekSync)||void 0===Y||Y.stopPeeking(),this.peekSync=new f.SyncApi(this,this.clientOpts),this.peekSync.peek(K)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(K,Y){const oe=this.sendStateEvent(K,S.EventType.RoomGuestAccess,{guest_access:Y.allowJoin?"can_join":"forbidden"},"");let le=Promise.resolve(void 0);return Y.allowRead&&(le=this.sendStateEvent(K,S.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([le,oe]).then()}requestRegisterEmailToken(K,Y,oe,le){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:K,client_secret:Y,send_attempt:oe,next_link:le})}requestRegisterMsisdnToken(K,Y,oe,le,ge){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:K,phone_number:Y,client_secret:oe,send_attempt:le,next_link:ge})}requestAdd3pidEmailToken(K,Y,oe,le){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:K,client_secret:Y,send_attempt:oe,next_link:le})}requestAdd3pidMsisdnToken(K,Y,oe,le,ge){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:K,phone_number:Y,client_secret:oe,send_attempt:le,next_link:ge})}requestPasswordEmailToken(K,Y,oe,le){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:K,client_secret:Y,send_attempt:oe,next_link:le})}requestPasswordMsisdnToken(K,Y,oe,le,ge){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:K,phone_number:Y,client_secret:oe,send_attempt:le,next_link:ge})}requestTokenFromEndpoint(K,Y){var oe;return d(this,void 0,void 0,function*(){const le=Object.assign({},Y);if(!(yield this.doesServerSupportSeparateAddAndBind())&&this.idBaseUrl){const ge=new URL(this.idBaseUrl);if(le.id_server=ge.host,null!==(oe=this.identityServer)&&void 0!==oe&&oe.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const Ie=yield this.identityServer.getAccessToken();Ie&&(le.id_access_token=Ie)}}return this.http.request(B.Method.Post,K,void 0,le)})}getRoomPushRule(K,Y){var oe,le;if(this.pushRules)return null===(le=null===(oe=this.pushRules[K])||void 0===oe?void 0:oe.room)||void 0===le?void 0:le.find(ge=>ge.rule_id===Y);throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(K,Y,oe){let le,ge=!1;const Ie=this.getRoomPushRule(K,Y);if(Ie?.actions.includes(ae.PushRuleActionName.DontNotify)&&(ge=!0),oe)if(Ie){if(!ge){const Ce=t.defer();this.deletePushRule(K,ae.PushRuleKind.RoomSpecific,Ie.rule_id).then(()=>{this.addPushRule(K,ae.PushRuleKind.RoomSpecific,Y,{actions:[ae.PushRuleActionName.DontNotify]}).then(()=>{Ce.resolve()}).catch(Pe=>{Ce.reject(Pe)})}).catch(Pe=>{Ce.reject(Pe)}),le=Ce.promise}}else le=this.addPushRule(K,ae.PushRuleKind.RoomSpecific,Y,{actions:[ae.PushRuleActionName.DontNotify]});else ge&&(le=this.deletePushRule(K,ae.PushRuleKind.RoomSpecific,Ie.rule_id));if(le)return new Promise((Ce,Pe)=>{le.then(()=>{this.getPushRules().then(He=>{this.pushRules=He,Ce()}).catch(He=>{Pe(He)})}).catch(He=>{this.getPushRules().then(Fe=>{this.pushRules=Fe,Pe(He)}).catch(Fe=>{Pe(He)})})})}searchMessageText(K){const Y={search_term:K.query};return"keys"in K&&(Y.keys=K.keys),this.search({body:{search_categories:{room_events:Y}}})}searchRoomEvents(K){const Y={search_categories:{room_events:{search_term:K.term,filter:K.filter,order_by:ee.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},oe={_query:Y,results:[],highlights:[]};return this.search({body:Y}).then(le=>this.processRoomEventsSearch(oe,le))}backPaginateRoomEventsSearch(K){if(!K.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(K.pendingRequest)return K.pendingRequest;const oe=this.search({body:K._query,next_batch:K.next_batch},K.abortSignal).then(le=>this.processRoomEventsSearch(K,le)).finally(()=>{K.pendingRequest=void 0});return K.pendingRequest=oe,oe}processRoomEventsSearch(K,Y){var oe,le;const ge=Y.search_categories.room_events;K.count=ge.count,K.next_batch=ge.next_batch;const Ie=new Set(ge.highlights);K.highlights.forEach(He=>{Ie.add(He)}),K.highlights=Array.from(Ie);const Ce=this.getEventMapper(),Pe=null!==(le=null===(oe=ge.results)||void 0===oe?void 0:oe.length)&&void 0!==le?le:0;for(let He=0;He<Pe;He++){const Fe=C.SearchResult.fromJson(ge.results[He],Ce),je=this.getRoom(Fe.context.getEvent().getRoomId());if(je)for(const et of Fe.context.getTimeline()){const Ve=je.getMember(et.getSender());!et.sender&&Ve&&(et.sender=Ve)}K.results.push(Fe)}return K}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const K=new f.SyncApi(this,this.clientOpts);return this.syncLeftRoomsPromise=K.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{w.logger.log("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(K){const Y=t.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(B.Method.Post,Y,void 0,K).then(oe=>{const le=r.Filter.fromJson(this.credentials.userId,oe.filter_id,K);return this.store.storeFilter(le),le})}getFilter(K,Y,oe){if(oe){const ge=this.store.getFilter(K,Y);if(ge)return Promise.resolve(ge)}const le=t.encodeUri("/user/$userId/filter/$filterId",{$userId:K,$filterId:Y});return this.http.authedRequest(B.Method.Get,le).then(ge=>{const Ie=r.Filter.fromJson(K,Y,ge);return this.store.storeFilter(Ie),Ie})}getOrCreateFilter(K,Y){return d(this,void 0,void 0,function*(){const oe=this.store.getFilterIdByName(K);let le;if(oe){try{const Ie=yield this.getFilter(this.credentials.userId,oe,!0);if(Ie){const Ce=Ie.getDefinition(),Pe=Y.getDefinition();t.deepCompare(Ce,Pe)&&(le=oe)}}catch(Ie){if("M_UNKNOWN"!==Ie.errcode&&"M_NOT_FOUND"!==Ie.errcode)throw Ie}le||this.store.setFilterIdByName(K,void 0)}if(le)return le;const ge=yield this.createFilter(Y.getDefinition());return this.store.setFilterIdByName(K,ge.filterId),ge.filterId})}getOpenIdToken(){const K=t.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(B.Method.Post,K,void 0,{})}turnServer(){return this.http.authedRequest(B.Method.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return void 0!==this.checkTurnServersIntervalID}checkTurnServers(){return d(this,void 0,void 0,function*(){if(!this.canSupportVoip)return;let K=!1;const Y=this.turnServersExpiry-Date.now();if(Y>6e5)w.logger.debug("TURN creds are valid for another "+Y+" ms: not fetching new ones."),K=!0;else{w.logger.debug("Fetching new TURN credentials");try{const oe=yield this.turnServer();oe.uris&&(w.logger.log("Got TURN URIs: "+oe.uris+" refresh in "+oe.ttl+" secs"),this.turnServers=[{urls:oe.uris,username:oe.username,credential:oe.password}],this.turnServersExpiry=Date.now()+1e3*oe.ttl,K=!0,this.emit(Ne.TurnServers,this.turnServers))}catch(oe){w.logger.error("Failed to get TURN URIs",oe),403===oe.httpStatus?(w.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&R.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.emit(Ne.TurnServersError,oe,!0)):this.emit(Ne.TurnServersError,oe,!1)}}return K})}setFallbackICEServerAllowed(K){this.fallbackICEServerAllowed=K}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const K=t.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(B.Method.Get,K,void 0,void 0,{prefix:""}).then(Y=>Y.admin)}whoisSynapseUser(K){const Y=t.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:K});return this.http.authedRequest(B.Method.Get,Y,void 0,void 0,{prefix:""})}deactivateSynapseUser(K){const Y=t.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:K});return this.http.authedRequest(B.Method.Post,Y,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var K;return d(this,void 0,void 0,function*(){this.clientWellKnownPromise=l.AutoDiscovery.getRawClientConfig(null!==(K=this.getDomain())&&void 0!==K?K:void 0),this.clientWellKnown=yield this.clientWellKnownPromise,this.emit(Ne.ClientWellKnown,this.clientWellKnown)})}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){const K=["boolean","string","number"],Y=Object.entries(this.clientOpts).filter(([oe,le])=>K.includes(typeof le)).reduce((oe,[le,ge])=>(oe[le]=ge,oe),{});return this.store.storeClientOptions(Y)}_unstable_getSharedRooms(K){return d(this,void 0,void 0,function*(){const Y=yield this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"),oe=yield this.doesServerSupportUnstableFeature("uk.half-shot.msc2666.mutual_rooms");if(!Y&&!oe)throw Error("Server does not support mutual_rooms API");const le=t.encodeUri(`/uk.half-shot.msc2666/user/${oe?"mutual_rooms":"shared_rooms"}/$userId`,{$userId:K});return(yield this.http.authedRequest(B.Method.Get,le,void 0,void 0,{prefix:B.ClientPrefix.Unstable})).joined})}getVersions(){return d(this,void 0,void 0,function*(){if(this.serverVersionsPromise)return this.serverVersionsPromise;this.serverVersionsPromise=this.http.request(B.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(oe=>{throw this.serverVersionsPromise=void 0,oe});const K=yield this.serverVersionsPromise;this.canSupport=yield(0,he.buildFeatureSupportMap)(K);const Y=this.canSupport.get(he.Feature.ThreadUnreadNotifications);return se.UNREAD_THREAD_NOTIFICATIONS.setPreferUnstable(Y===he.ServerSupport.Unstable),this.serverVersionsPromise})}isVersionSupported(K){return d(this,void 0,void 0,function*(){const{versions:Y}=yield this.getVersions();return Y&&Y.includes(K)})}doesServerSupportLazyLoading(){return d(this,void 0,void 0,function*(){const K=yield this.getVersions();if(!K)return!1;const Y=K.versions,oe=K.unstable_features;return Y&&Y.includes("r0.5.0")||oe&&oe["m.lazy_load_members"]})}doesServerRequireIdServerParam(){return d(this,void 0,void 0,function*(){const K=yield this.getVersions();if(!K)return!0;const Y=K.versions;if(Y&&Y.includes("r0.6.0"))return!1;const oe=K.unstable_features;return!oe||void 0===oe["m.require_identity_server"]||oe["m.require_identity_server"]})}doesServerAcceptIdentityAccessToken(){return d(this,void 0,void 0,function*(){const K=yield this.getVersions();if(!K)return!1;const Y=K.versions,oe=K.unstable_features;return Y&&Y.includes("r0.6.0")||oe&&oe["m.id_access_token"]})}doesServerSupportSeparateAddAndBind(){return d(this,void 0,void 0,function*(){const K=yield this.getVersions();if(!K)return!1;const oe=K.unstable_features;return K.versions?.includes("r0.6.0")||oe?.["m.separate_add_and_bind"]})}doesServerSupportUnstableFeature(K){return d(this,void 0,void 0,function*(){const Y=yield this.getVersions();if(!Y)return!1;const oe=Y.unstable_features;return oe&&!!oe[K]})}doesServerForceEncryptionForPreset(K){return d(this,void 0,void 0,function*(){const Y=yield this.getVersions();if(!Y)return!1;const oe=Y.unstable_features,le=K.includes("_chat")?K.substring(0,K.indexOf("_chat")):K;return oe&&!!oe[`io.element.e2ee_forced.${le}`]})}doesServerSupportThread(){return d(this,void 0,void 0,function*(){if(yield this.isVersionSupported("v1.4"))return{threads:te.FeatureSupport.Stable,list:te.FeatureSupport.Stable,fwdPagination:te.FeatureSupport.Stable};try{const[K,Y,oe,le,ge,Ie]=yield Promise.all([this.doesServerSupportUnstableFeature("org.matrix.msc3440"),this.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3856"),this.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3715"),this.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:(0,te.determineFeatureSupport)(Y,K),list:(0,te.determineFeatureSupport)(le,oe),fwdPagination:(0,te.determineFeatureSupport)(Ie,ge)}}catch{return{threads:te.FeatureSupport.None,list:te.FeatureSupport.None,fwdPagination:te.FeatureSupport.None}}})}doesServerSupportLogoutDevices(){return this.isVersionSupported("r0.6.1")}hasLazyLoadMembersEnabled(){var K;return!(null===(K=this.clientOpts)||void 0===K||!K.lazyLoadMembers)}setCanResetTimelineCallback(K){this.canResetTimelineCallback=K}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(K,Y,oe,le,ge={dir:o.Direction.Backward}){var Ie,Ce;return d(this,void 0,void 0,function*(){const Pe=le?this.getEncryptedIfNeededEventType(K,le):null,[He,Fe]=yield Promise.all([this.fetchRoomEvent(K,Y),this.fetchRelations(K,Y,oe,Pe,ge)]),je=this.getEventMapper(),et=He?je(He):void 0;let Ve=Fe.chunk.map(je);if(Pe===S.EventType.RoomMessageEncrypted){const Je=et?Ve.concat(et):Ve;yield Promise.all(Je.map(St=>this.decryptEventIfNeeded(St))),null!==le&&(Ve=Ve.filter(St=>St.getType()===le))}return et&&oe===S.RelationType.Replace&&(Ve=Ve.filter(Je=>Je.getSender()===et.getSender())),{originalEvent:et??null,events:Ve,nextBatch:null!==(Ie=Fe.next_batch)&&void 0!==Ie?Ie:null,prevBatch:null!==(Ce=Fe.prev_batch)&&void 0!==Ce?Ce:null}})}getCrossSigningCacheCallbacks(){var K;return null===(K=this.crypto)||void 0===K?void 0:K.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,k.randomString)(32)}decryptEventIfNeeded(K,Y){return K.shouldAttemptDecryption()&&this.isCryptoEnabled()&&K.attemptDecryption(this.cryptoBackend,Y),K.isBeingDecrypted()?K.getDecryptionPromise():Promise.resolve()}termsUrlForService(K,Y){switch(K){case x.SERVICE_TYPES.IS:return this.http.getUrl("/terms",void 0,B.IdentityPrefix.V2,Y);case x.SERVICE_TYPES.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",Y);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(K=!1){var Y,oe;return K&&(null!==(Y=this.idBaseUrl)&&void 0!==Y&&Y.startsWith("http://")||null!==(oe=this.idBaseUrl)&&void 0!==oe&&oe.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(K){this.idBaseUrl=t.ensureNoTrailingSlash(K),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}setAccessToken(K){this.http.opts.accessToken=K}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(K){return this.http.authedRequest(B.Method.Get,"/register/available",{username:K}).then(Y=>Y.available).catch(Y=>"M_USER_IN_USE"!==Y.errcode&&Promise.reject(Y))}register(K,Y,oe,le,ge,Ie,Ce){!0===ge?ge={email:!0}:(null==ge||!1===ge)&&(ge={}),oe&&(le.session=oe);const Pe={auth:le,refresh_token:!0};return null!=K&&(Pe.username=K),null!=Y&&(Pe.password=Y),ge.email&&(Pe.bind_email=!0),ge.msisdn&&(Pe.bind_msisdn=!0),null!=Ie&&(Pe.guest_access_token=Ie),null!=Ce&&(Pe.inhibit_login=Ce),null!=Y&&(Pe.x_show_msisdn=!0),this.registerRequest(Pe)}registerGuest({body:K}={}){return this.registerRequest(K||{},"guest")}registerRequest(K,Y){const oe={};return Y&&(oe.kind=Y),this.http.request(B.Method.Post,"/register",oe,K)}refreshToken(K){return this.http.authedRequest(B.Method.Post,"/refresh",void 0,{refresh_token:K},{prefix:B.ClientPrefix.V1,inhibitLogoutEmit:!0})}loginFlows(){return this.http.request(B.Method.Get,"/login")}login(K,Y){const oe={type:K};return Object.assign(oe,Y),this.http.authedRequest(B.Method.Post,"/login",void 0,oe).then(le=>(le.access_token&&le.user_id&&(this.http.opts.accessToken=le.access_token,this.credentials={userId:le.user_id}),le))}loginWithPassword(K,Y){return this.login("m.login.password",{user:K,password:Y})}loginWithSAML2(K){return this.login("m.login.saml2",{relay_state:K})}getCasLoginUrl(K){return this.getSsoLoginUrl(K,"cas")}getSsoLoginUrl(K,Y="sso",oe,le){let ge="/login/"+Y+"/redirect";return oe&&(ge+="/"+oe),this.http.getUrl(ge,{redirectUrl:K,[qe.unstable]:le},B.ClientPrefix.R0).href}loginWithToken(K){return this.login("m.login.token",{token:K})}logout(K=!1){var Y,oe;return d(this,void 0,void 0,function*(){if(null!==(oe=null===(Y=this.crypto)||void 0===Y?void 0:Y.backupManager)&&void 0!==oe&&oe.getKeyBackupEnabled())try{for(;(yield this.crypto.backupManager.backupPendingKeys(200))>0;);}catch(le){w.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",le)}return K&&(this.stopClient(),this.http.abort()),this.http.authedRequest(B.Method.Post,"/logout")})}deactivateAccount(K,Y){const oe={};return K&&(oe.auth=K),void 0!==Y&&(oe.erase=Y),this.http.authedRequest(B.Method.Post,"/account/deactivate",void 0,oe)}requestLoginToken(K){return this.http.authedRequest(B.Method.Post,"/org.matrix.msc3882/login/token",void 0,{auth:K},{prefix:B.ClientPrefix.Unstable})}getFallbackAuthUrl(K,Y){const oe=t.encodeUri("/auth/$loginType/fallback/web",{$loginType:K});return this.http.getUrl(oe,{session:Y},B.ClientPrefix.R0).href}createRoom(K){var Y;return d(this,void 0,void 0,function*(){const oe=(K.invite_3pid||[]).filter(le=>!le.id_access_token);if(oe.length>0&&null!==(Y=this.identityServer)&&void 0!==Y&&Y.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const le=yield this.identityServer.getAccessToken();if(le)for(const ge of oe)ge.id_access_token=le}return this.http.authedRequest(B.Method.Post,"/createRoom",void 0,K)})}fetchRelations(K,Y,oe,le,ge={dir:o.Direction.Backward}){let Ie=ge;te.Thread.hasServerSideFwdPaginationSupport===te.FeatureSupport.Experimental&&(Ie=(0,n.replaceParam)("dir","org.matrix.msc3715.dir",Ie));const Ce=t.encodeParams(Ie);let Pe="/rooms/$roomId/relations/$eventId";null!==oe?(Pe+="/$relationType",null!==le&&(Pe+="/$eventType")):null!==le&&(w.logger.warn(`eventType: ${le} ignored when fetching\n            relations as relationType is null`),le=null);const He=t.encodeUri(Pe+"?"+Ce,{$roomId:K,$eventId:Y,$relationType:oe,$eventType:le});return this.http.authedRequest(B.Method.Get,He,void 0,void 0,{prefix:B.ClientPrefix.V1})}roomState(K){const Y=t.encodeUri("/rooms/$roomId/state",{$roomId:K});return this.http.authedRequest(B.Method.Get,Y)}fetchRoomEvent(K,Y){const oe=t.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:K,$eventId:Y});return this.http.authedRequest(B.Method.Get,oe)}members(K,Y,oe,le){const ge={};Y&&(ge.membership=Y),oe&&(ge.not_membership=oe),le&&(ge.at=le);const Ie=t.encodeParams(ge),Ce=t.encodeUri("/rooms/$roomId/members?"+Ie,{$roomId:K});return this.http.authedRequest(B.Method.Get,Ce)}upgradeRoom(K,Y){const oe=t.encodeUri("/rooms/$roomId/upgrade",{$roomId:K});return this.http.authedRequest(B.Method.Post,oe,void 0,{new_version:Y})}getStateEvent(K,Y,oe){const le={$roomId:K,$eventType:Y,$stateKey:oe};let ge=t.encodeUri("/rooms/$roomId/state/$eventType",le);return void 0!==oe&&(ge=t.encodeUri(ge+"/$stateKey",le)),this.http.authedRequest(B.Method.Get,ge)}sendStateEvent(K,Y,oe,le="",ge={}){const Ie={$roomId:K,$eventType:Y,$stateKey:le};let Ce=t.encodeUri("/rooms/$roomId/state/$eventType",Ie);return void 0!==le&&(Ce=t.encodeUri(Ce+"/$stateKey",Ie)),this.http.authedRequest(B.Method.Put,Ce,void 0,oe,ge)}roomInitialSync(K,Y){var oe;const le=t.encodeUri("/rooms/$roomId/initialSync",{$roomId:K});return this.http.authedRequest(B.Method.Get,le,{limit:null!==(oe=Y?.toString())&&void 0!==oe?oe:"30"})}setRoomReadMarkersHttpRequest(K,Y,oe,le){return d(this,void 0,void 0,function*(){const ge=t.encodeUri("/rooms/$roomId/read_markers",{$roomId:K}),Ie={[ne.ReceiptType.FullyRead]:Y,[ne.ReceiptType.Read]:oe};return((yield this.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield this.isVersionSupported("v1.4")))&&(Ie[ne.ReceiptType.ReadPrivate]=le),this.http.authedRequest(B.Method.Post,ge,void 0,Ie)})}getJoinedRooms(){const K=t.encodeUri("/joined_rooms",{});return this.http.authedRequest(B.Method.Get,K)}getJoinedRoomMembers(K){const Y=t.encodeUri("/rooms/$roomId/joined_members",{$roomId:K});return this.http.authedRequest(B.Method.Get,Y)}publicRooms(K={}){var{server:Y,limit:oe,since:le}=K,ge=u(K,["server","limit","since"]);const Ie={server:Y,limit:oe,since:le};return 0===Object.keys(ge).length?this.http.authedRequest(B.Method.Get,"/publicRooms",Ie):this.http.authedRequest(B.Method.Post,"/publicRooms",Ie,ge)}createAlias(K,Y){const oe=t.encodeUri("/directory/room/$alias",{$alias:K});return this.http.authedRequest(B.Method.Put,oe,void 0,{room_id:Y})}deleteAlias(K){const Y=t.encodeUri("/directory/room/$alias",{$alias:K});return this.http.authedRequest(B.Method.Delete,Y)}getLocalAliases(K){const Y=t.encodeUri("/rooms/$roomId/aliases",{$roomId:K});return this.http.authedRequest(B.Method.Get,Y,void 0,void 0,{prefix:B.ClientPrefix.V3})}getRoomIdForAlias(K){const Y=t.encodeUri("/directory/room/$alias",{$alias:K});return this.http.authedRequest(B.Method.Get,Y)}resolveRoomAlias(K){const Y=t.encodeUri("/directory/room/$alias",{$alias:K});return this.http.request(B.Method.Get,Y)}getRoomDirectoryVisibility(K){const Y=t.encodeUri("/directory/list/room/$roomId",{$roomId:K});return this.http.authedRequest(B.Method.Get,Y)}setRoomDirectoryVisibility(K,Y){const oe=t.encodeUri("/directory/list/room/$roomId",{$roomId:K});return this.http.authedRequest(B.Method.Put,oe,void 0,{visibility:Y})}setRoomDirectoryVisibilityAppService(K,Y,oe){const le=t.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:K,$roomId:Y});return this.http.authedRequest(B.Method.Put,le,void 0,{visibility:oe})}searchUserDirectory({term:K,limit:Y}){const oe={search_term:K};return void 0!==Y&&(oe.limit=Y),this.http.authedRequest(B.Method.Post,"/user_directory/search",void 0,oe)}uploadContent(K,Y){return this.http.uploadContent(K,Y)}cancelUpload(K){return this.http.cancelUpload(K)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(K,Y){const oe=Y?t.encodeUri("/profile/$userId/$info",{$userId:K,$info:Y}):t.encodeUri("/profile/$userId",{$userId:K});return this.http.authedRequest(B.Method.Get,oe)}getThreePids(){return this.http.authedRequest(B.Method.Get,"/account/3pid")}addThreePid(K,Y){return this.http.authedRequest(B.Method.Post,"/account/3pid",void 0,{threePidCreds:K,bind:Y})}addThreePidOnly(K){return d(this,void 0,void 0,function*(){const oe=(yield this.isVersionSupported("r0.6.0"))?B.ClientPrefix.R0:B.ClientPrefix.Unstable;return this.http.authedRequest(B.Method.Post,"/account/3pid/add",void 0,K,{prefix:oe})})}bindThreePid(K){return d(this,void 0,void 0,function*(){const oe=(yield this.isVersionSupported("r0.6.0"))?B.ClientPrefix.R0:B.ClientPrefix.Unstable;return this.http.authedRequest(B.Method.Post,"/account/3pid/bind",void 0,K,{prefix:oe})})}unbindThreePid(K,Y){return d(this,void 0,void 0,function*(){const le={medium:K,address:Y,id_server:this.getIdentityServerUrl(!0)},ge=(yield this.isVersionSupported("r0.6.0"))?B.ClientPrefix.R0:B.ClientPrefix.Unstable;return this.http.authedRequest(B.Method.Post,"/account/3pid/unbind",void 0,le,{prefix:ge})})}deleteThreePid(K,Y){return this.http.authedRequest(B.Method.Post,"/account/3pid/delete",void 0,{medium:K,address:Y})}setPassword(K,Y,oe){return this.http.authedRequest(B.Method.Post,"/account/password",void 0,{auth:K,new_password:Y,logout_devices:oe})}getDevices(){return this.http.authedRequest(B.Method.Get,"/devices")}getDevice(K){const Y=t.encodeUri("/devices/$device_id",{$device_id:K});return this.http.authedRequest(B.Method.Get,Y)}setDeviceDetails(K,Y){const oe=t.encodeUri("/devices/$device_id",{$device_id:K});return this.http.authedRequest(B.Method.Put,oe,void 0,Y)}deleteDevice(K,Y){const oe=t.encodeUri("/devices/$device_id",{$device_id:K}),le={};return Y&&(le.auth=Y),this.http.authedRequest(B.Method.Delete,oe,void 0,le)}deleteMultipleDevices(K,Y){const oe={devices:K};return Y&&(oe.auth=Y),this.http.authedRequest(B.Method.Post,"/delete_devices",void 0,oe)}getPushers(){return d(this,void 0,void 0,function*(){const K=yield this.http.authedRequest(B.Method.Get,"/pushers");return(yield this.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(K.pushers=K.pushers.map(Y=>(Y.hasOwnProperty(S.PUSHER_ENABLED.name)||(Y[S.PUSHER_ENABLED.name]=!0),Y))),K})}setPusher(K){return this.http.authedRequest(B.Method.Post,"/pushers/set",void 0,K)}setLocalNotificationSettings(K,Y){return this.setAccountData(`${S.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${K}`,Y)}getPushRules(){return this.http.authedRequest(B.Method.Get,"/pushrules/").then(K=>h.PushProcessor.rewriteDefaultRules(K))}addPushRule(K,Y,oe,le){const ge=t.encodeUri("/pushrules/"+K+"/$kind/$ruleId",{$kind:Y,$ruleId:oe});return this.http.authedRequest(B.Method.Put,ge,void 0,le)}deletePushRule(K,Y,oe){const le=t.encodeUri("/pushrules/"+K+"/$kind/$ruleId",{$kind:Y,$ruleId:oe});return this.http.authedRequest(B.Method.Delete,le)}setPushRuleEnabled(K,Y,oe,le){const ge=t.encodeUri("/pushrules/"+K+"/$kind/$ruleId/enabled",{$kind:Y,$ruleId:oe});return this.http.authedRequest(B.Method.Put,ge,void 0,{enabled:le})}setPushRuleActions(K,Y,oe,le){const ge=t.encodeUri("/pushrules/"+K+"/$kind/$ruleId/actions",{$kind:Y,$ruleId:oe});return this.http.authedRequest(B.Method.Put,ge,void 0,{actions:le})}search({body:K,next_batch:Y},oe){const le={};return Y&&(le.next_batch=Y),this.http.authedRequest(B.Method.Post,"/search",le,K,{abortSignal:oe})}uploadKeysRequest(K,Y){return this.http.authedRequest(B.Method.Post,"/keys/upload",void 0,K)}uploadKeySignatures(K){return this.http.authedRequest(B.Method.Post,"/keys/signatures/upload",void 0,K,{prefix:B.ClientPrefix.V3})}downloadKeysForUsers(K,{token:Y}={}){const oe={device_keys:{}};return void 0!==Y&&(oe.token=Y),K.forEach(le=>{oe.device_keys[le]=[]}),this.http.authedRequest(B.Method.Post,"/keys/query",void 0,oe)}claimOneTimeKeys(K,Y="signed_curve25519",oe){const le={};void 0===Y&&(Y="signed_curve25519");for(const[Ce,Pe]of K){const He=le[Ce]||{};le[Ce]=He,He[Pe]=Y}const ge={one_time_keys:le};return oe&&(ge.timeout=oe),this.http.authedRequest(B.Method.Post,"/keys/claim",void 0,ge)}getKeyChanges(K,Y){return this.http.authedRequest(B.Method.Get,"/keys/changes",{from:K,to:Y})}uploadDeviceSigningKeys(K,Y){const oe=Object.assign({},Y);return K&&Object.assign(oe,{auth:K}),this.http.authedRequest(B.Method.Post,"/keys/device_signing/upload",void 0,oe,{prefix:B.ClientPrefix.Unstable})}registerWithIdentityServer(K){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const Y=this.http.getUrl("/account/register",void 0,B.IdentityPrefix.V2,this.idBaseUrl);return this.http.requestOtherUrl(B.Method.Post,Y,K)}requestEmailToken(K,Y,oe,le,ge){const Ie={client_secret:Y,email:K,send_attempt:oe?.toString(),next_link:le};return this.http.idServerRequest(B.Method.Post,"/validate/email/requestToken",Ie,B.IdentityPrefix.V2,ge)}requestMsisdnToken(K,Y,oe,le,ge,Ie){const Ce={client_secret:oe,country:K,phone_number:Y,send_attempt:le?.toString(),next_link:ge};return this.http.idServerRequest(B.Method.Post,"/validate/msisdn/requestToken",Ce,B.IdentityPrefix.V2,Ie)}submitMsisdnToken(K,Y,oe,le){return this.http.idServerRequest(B.Method.Post,"/validate/msisdn/submitToken",{sid:K,client_secret:Y,token:oe},B.IdentityPrefix.V2,le)}submitMsisdnTokenOtherUrl(K,Y,oe,le){return this.http.requestOtherUrl(B.Method.Post,K,{sid:Y,client_secret:oe,token:le})}getIdentityHashDetails(K){return this.http.idServerRequest(B.Method.Get,"/hash_details",void 0,B.IdentityPrefix.V2,K)}identityHashedLookup(K,Y){return d(this,void 0,void 0,function*(){const oe={},le=yield this.getIdentityHashDetails(Y);if(!le||!le.lookup_pepper||!le.algorithms)throw new Error("Unsupported identity server: bad response");oe.pepper=le.lookup_pepper;const ge={};if(le.algorithms.includes("sha256")){const Pe=new R.Olm.Utility;oe.addresses=K.map(He=>{const Fe=He[0].toLowerCase(),je=He[1].toLowerCase(),et=Pe.sha256(`${Fe} ${je} ${oe.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return ge[et]=He[0],et}),oe.algorithm="sha256"}else{if(!le.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");oe.addresses=K.map(Pe=>{const je=`${Pe[0].toLowerCase()} ${Pe[1].toLowerCase()}`;return ge[je]=Pe[0],je}),oe.algorithm="none"}const Ie=yield this.http.idServerRequest(B.Method.Post,"/lookup",oe,B.IdentityPrefix.V2,Y);if(!Ie?.mappings)return[];const Ce=[];for(const Pe of Object.keys(Ie.mappings)){const He=Ie.mappings[Pe],Fe=ge[Pe];if(!Fe)throw new Error("Identity server returned more results than expected");Ce.push({address:Fe,mxid:He})}return Ce})}lookupThreePid(K,Y,oe){return d(this,void 0,void 0,function*(){const ge=(yield this.identityHashedLookup([[Y,K]],oe)).find(Ce=>Ce.address===Y);return ge?{address:Y,medium:K,mxid:ge.mxid}:{}})}bulkLookupThreePids(K,Y){return d(this,void 0,void 0,function*(){const oe=yield this.identityHashedLookup(K.map(ge=>[ge[1],ge[0]]),Y),le=[];for(const ge of oe){const Ie=K.find(Ce=>Ce[1]===ge.address);if(!Ie)throw new Error("Identity sever returned unexpected results");le.push([Ie[0],ge.address,ge.mxid])}return{threepids:le}})}getIdentityAccount(K){return this.http.idServerRequest(B.Method.Get,"/account",void 0,B.IdentityPrefix.V2,K)}sendToDevice(K,Y,oe){const le=t.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:K,$txnId:oe||this.makeTxnId()}),ge={messages:Y},Ie=Object.keys(Y).reduce((Ce,Pe)=>(Ce[Pe]=Object.keys(Y[Pe]),Ce),{});return w.logger.log(`PUT ${le}`,Ie),this.http.authedRequest(B.Method.Put,le,void 0,ge)}queueToDevice(K){return this.toDeviceMessageQueue.queueBatch(K)}getThirdpartyProtocols(){return this.http.authedRequest(B.Method.Get,"/thirdparty/protocols").then(K=>{if(!K||"object"!=typeof K)throw new Error(`/thirdparty/protocols did not return an object: ${K}`);return K})}getThirdpartyLocation(K,Y){const oe=t.encodeUri("/thirdparty/location/$protocol",{$protocol:K});return this.http.authedRequest(B.Method.Get,oe,Y)}getThirdpartyUser(K,Y){const oe=t.encodeUri("/thirdparty/user/$protocol",{$protocol:K});return this.http.authedRequest(B.Method.Get,oe,Y)}getTerms(K,Y){const oe=this.termsUrlForService(K,Y);return this.http.requestOtherUrl(B.Method.Get,oe)}agreeToTerms(K,Y,oe,le){const ge=this.termsUrlForService(K,Y);return this.http.requestOtherUrl(B.Method.Post,ge,{user_accepts:le},{headers:{Authorization:"Bearer "+oe}})}reportEvent(K,Y,oe,le){const ge=t.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:K,$eventId:Y});return this.http.authedRequest(B.Method.Post,ge,void 0,{score:oe,reason:le})}getRoomHierarchy(K,Y,oe,le=!1,ge){const Ie=t.encodeUri("/rooms/$roomId/hierarchy",{$roomId:K}),Ce={suggested_only:String(le),max_depth:oe?.toString(),from:ge,limit:Y?.toString()};return this.http.authedRequest(B.Method.Get,Ie,Ce,void 0,{prefix:B.ClientPrefix.V1}).catch(Pe=>{if("M_UNRECOGNIZED"===Pe.errcode)return this.http.authedRequest(B.Method.Get,Ie,Ce,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw Pe})}unstableCreateFileTree(K){return d(this,void 0,void 0,function*(){const{room_id:Y}=yield this.createRoom({name:K,preset:U.Preset.PrivateChat,power_level_content_override:Object.assign(Object.assign({},Q.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{users:{[this.getUserId()]:100}}),creation_content:{[S.RoomCreateTypeField]:S.RoomType.Space},initial_state:[{type:S.UNSTABLE_MSC3088_PURPOSE.name,state_key:S.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:{[S.UNSTABLE_MSC3088_ENABLED.name]:!0}},{type:S.EventType.RoomEncryption,state_key:"",content:{algorithm:e.MEGOLM_ALGORITHM}}]});return new Q.MSC3089TreeSpace(this,Y)})}unstableGetFileTreeSpace(K){var Y,oe;const le=this.getRoom(K);if("join"!==le?.getMyMembership())return null;const ge=le.currentState.getStateEvents(S.EventType.RoomCreate,""),Ie=le.currentState.getStateEvents(S.UNSTABLE_MSC3088_PURPOSE.name,S.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!ge)throw new Error("Expected single room create event");return null!==(Y=Ie?.getContent())&&void 0!==Y&&Y[S.UNSTABLE_MSC3088_ENABLED.name]&&(null===(oe=ge.getContent())||void 0===oe?void 0:oe[S.RoomCreateTypeField])===S.RoomType.Space?new Q.MSC3089TreeSpace(this,K):null}slidingSync(K,Y,oe){const le={};K.pos&&(le.pos=K.pos,delete K.pos),K.timeout&&(le.timeout=K.timeout,delete K.timeout);const ge=K.clientTimeout;return delete K.clientTimeout,this.http.authedRequest(B.Method.Post,"/sync",le,K,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:Y,localTimeoutMs:ge,abortSignal:oe})}supportsExperimentalThreads(){var K;return(null===(K=this.clientOpts)||void 0===K?void 0:K.experimentalThreadSupport)||!1}getRoomSummary(K,Y){return d(this,void 0,void 0,function*(){const oe=t.encodeUri("/rooms/$roomid/summary",{$roomid:K});return this.http.authedRequest(B.Method.Get,oe,{via:Y},void 0,{prefix:"/_matrix/client/unstable/im.nheko.summary"})})}processThreadEvents(K,Y,oe){K.processThreadedEvents(Y,oe)}processThreadRoots(K,Y,oe){K.processThreadRoots(Y,oe)}processBeaconEvents(K,Y){Y?.length&&K&&K.currentState.processBeaconEvents(Y,this)}whoami(){return d(this,void 0,void 0,function*(){return this.http.authedRequest(B.Method.Get,"/account/whoami")})}timestampToEvent(K,Y,oe){const le=t.encodeUri("/rooms/$roomId/timestamp_to_event",{$roomId:K});return this.http.authedRequest(B.Method.Get,le,{ts:Y.toString(),dir:oe},void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"})}}function Ge(Ue,K){var Y,oe,le;const ge=K.getPushActions(),Ie=Ue.getPushActionsForEvent(K,!0),Ce=Ue.getRoom(K.getRoomId());if(!Ce||!Ue.getUserId())return;const Pe=!!K.threadRootId&&!K.isThreadRoot,He=Ce.getUnreadCountForEventContext(T.NotificationCountType.Highlight,K),Fe=!(null===(Y=ge?.tweaks)||void 0===Y||!Y.highlight),je=!(null===(oe=Ie?.tweaks)||void 0===oe||!oe.highlight);if(Fe!==je||He>0){let et;if(Pe){const Ve=Ce.getThread(K.threadRootId);et=!Ve||Ve.hasUserReadEvent(Ue.getUserId(),K.getId())}else et=Ce.hasUserReadEvent(Ue.getUserId(),K.getId());if(!et){let Ve=He;je&&!Fe&&Ve++,!je&&Fe&&Ve--,Pe?Ce.setThreadUnreadNotificationCount(K.threadRootId,T.NotificationCountType.Highlight,Ve):Ce.setUnreadNotificationCount(T.NotificationCountType.Highlight,Ve),(null!==(le=Pe?Ce.getThreadUnreadNotificationCount(K.threadRootId,T.NotificationCountType.Total):Ce.getRoomUnreadNotificationCount(T.NotificationCountType.Total))&&void 0!==le?le:0)<Ve&&(Pe?Ce.setThreadUnreadNotificationCount(K.threadRootId,T.NotificationCountType.Total,Ve):Ce.setUnreadNotificationCount(T.NotificationCountType.Total,Ve))}}}a.MatrixClient=Be,Be.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY",a.fixNotificationCountOnDecryption=Ge}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./@types/PushRules":297,"./@types/beacon":298,"./@types/event":299,"./@types/partials":302,"./@types/read_receipts":303,"./@types/search":305,"./@types/sync":306,"./NamespacedValue":308,"./ReEmitter":309,"./ToDeviceMessageQueue":310,"./autodiscovery":311,"./content-helpers":314,"./content-repo":315,"./crypto":333,"./crypto/RoomList":321,"./crypto/api":328,"./crypto/backup":329,"./crypto/dehydration":331,"./crypto/key_passphrase":334,"./crypto/olmlib":335,"./crypto/recoverykey":336,"./event-mapper":352,"./feature":353,"./filter":355,"./http-api":358,"./logger":365,"./models/MSC3089TreeSpace":368,"./models/event":374,"./models/event-timeline":373,"./models/invites-ignorer":375,"./models/room":382,"./models/search-result":383,"./models/thread":384,"./models/typed-event-emitter":385,"./models/user":386,"./pushprocessor":387,"./randomstring":388,"./service-types":391,"./sliding-sync-sdk":392,"./store/stub":398,"./sync":400,"./utils":402,"./webrtc/call":404,"./webrtc/callEventHandler":405,"./webrtc/groupCall":408,"./webrtc/groupCallEventHandler":409,"./webrtc/mediaHandler":410,"matrix-events-sdk":167}],314:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.parseBeaconContent=a.makeBeaconContent=a.parseBeaconInfoContent=a.makeBeaconInfoContent=a.parseTopicContent=a.makeTopicContent=a.parseLocationEvent=a.makeLocationContent=a.getTextForLocationEvent=a.makeEmoteMessage=a.makeNotice=a.makeTextMessage=a.makeHtmlEmote=a.makeHtmlNotice=a.makeHtmlMessage=void 0;const R=m("matrix-events-sdk"),I=m("./@types/event"),E=m("./@types/extensible_events"),_=m("./@types/location"),d=m("./@types/topic");a.makeHtmlMessage=function u(b,y){return{msgtype:I.MsgType.Text,format:"org.matrix.custom.html",body:b,formatted_body:y}},a.makeHtmlNotice=function g(b,y){return{msgtype:I.MsgType.Notice,format:"org.matrix.custom.html",body:b,formatted_body:y}},a.makeHtmlEmote=function f(b,y){return{msgtype:I.MsgType.Emote,format:"org.matrix.custom.html",body:b,formatted_body:y}},a.makeTextMessage=function v(b){return{msgtype:I.MsgType.Text,body:b}},a.makeNotice=function c(b){return{msgtype:I.MsgType.Notice,body:b}},a.makeEmoteMessage=function i(b){return{msgtype:I.MsgType.Emote,body:b}},a.getTextForLocationEvent=(b,y,w,x)=>{const B=`at ${new Date(w).toISOString()}`;return[y===_.LocationAssetType.Self?"User":void 0,"Location",x?`"${x}"`:void 0,b,B].filter(Boolean).join(" ")},a.makeLocationContent=(b,y,w,x,B)=>{const J=b??(0,a.getTextForLocationEvent)(y,B||_.LocationAssetType.Self,w,x);return Object.assign({msgtype:I.MsgType.Location,body:J,geo_uri:y,[_.M_LOCATION.name]:{description:x,uri:y},[_.M_ASSET.name]:{type:B||_.LocationAssetType.Self},[E.TEXT_NODE_TYPE.name]:J},w?{[_.M_TIMESTAMP.name]:w}:{})},a.parseLocationEvent=b=>{var y,w;const x=_.M_LOCATION.findIn(b),B=_.M_ASSET.findIn(b),J=_.M_TIMESTAMP.findIn(b),z=E.TEXT_NODE_TYPE.findIn(b),M=null!==(y=x?.uri)&&void 0!==y?y:b?.geo_uri,L=x?.description,j=null!==(w=B?.type)&&void 0!==w?w:_.LocationAssetType.Self;return(0,a.makeLocationContent)(z??b.body,M,J??void 0,L,j)},a.makeTopicContent=(b,y)=>{const w=[{body:b,mimetype:"text/plain"}];return(0,R.isProvided)(y)&&w.push({body:y,mimetype:"text/html"}),{topic:b,[d.M_TOPIC.name]:w}},a.parseTopicContent=b=>{var y,w,x;const B=d.M_TOPIC.findIn(b);return{text:null!==(w=null===(y=B?.find(M=>!(0,R.isProvided)(M.mimetype)||"text/plain"===M.mimetype))||void 0===y?void 0:y.body)&&void 0!==w?w:b.topic,html:null===(x=B?.find(M=>"text/html"===M.mimetype))||void 0===x?void 0:x.body}},a.makeBeaconInfoContent=(b,y,w,x,B)=>({description:w,timeout:b,live:y,[_.M_TIMESTAMP.name]:B||Date.now(),[_.M_ASSET.name]:{type:x??_.LocationAssetType.Self}}),a.parseBeaconInfoContent=b=>{var y;const{description:w,timeout:x,live:B}=b,J=null!==(y=_.M_TIMESTAMP.findIn(b))&&void 0!==y?y:void 0;return{description:w,timeout:x,live:B,assetType:_.M_ASSET.findIn(b)?.type,timestamp:J}},a.makeBeaconContent=(b,y,w,x)=>({[_.M_LOCATION.name]:{description:x,uri:b},[_.M_TIMESTAMP.name]:y,"m.relates_to":{rel_type:R.REFERENCE_RELATION.name,event_id:w}}),a.parseBeaconContent=b=>{var y;const w=_.M_LOCATION.findIn(b),x=null!==(y=_.M_TIMESTAMP.findIn(b))&&void 0!==y?y:void 0;return{description:w?.description,uri:w?.uri,timestamp:x}}},{"./@types/event":299,"./@types/extensible_events":300,"./@types/location":301,"./@types/topic":307,"matrix-events-sdk":167}],315:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(u,g,f,v){void 0===v&&(v=f);var c=Object.getOwnPropertyDescriptor(g,f);(!c||("get"in c?!g.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return g[f]}}),Object.defineProperty(u,v,c)}:function(u,g,f,v){void 0===v&&(v=f),u[v]=g[f]}),I=this&&this.__setModuleDefault||(Object.create?function(u,g){Object.defineProperty(u,"default",{enumerable:!0,value:g})}:function(u,g){u.default=g}),E=this&&this.__importStar||function(u){if(u&&u.__esModule)return u;var g={};if(null!=u)for(var f in u)"default"!==f&&Object.prototype.hasOwnProperty.call(u,f)&&R(g,u,f);return I(g,u),g};Object.defineProperty(a,"__esModule",{value:!0}),a.getHttpUriForMxc=void 0;const _=E(m("./utils"));a.getHttpUriForMxc=function d(u,g,f,v,c,i=!1){if("string"!=typeof g||!g)return"";if(0!==g.indexOf("mxc://"))return i?g:"";let r=g.slice(6),s="/_matrix/media/r0/download/";const t={};f&&(t.width=Math.round(f).toString()),v&&(t.height=Math.round(v).toString()),c&&(t.method=c),Object.keys(t).length>0&&(s="/_matrix/media/r0/thumbnail/");const n=r.indexOf("#");let o="";return n>=0&&(o=r.slice(n),r=r.slice(0,n)),u+s+r+(0===Object.keys(t).length?"":"?"+_.encodeParams(t))+o}},{"./utils":402}],316:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__awaiter||function(h,l,e,p){return new(e||(e=Promise))(function(y,w){function x(z){try{J(p.next(z))}catch(M){w(M)}}function B(z){try{J(p.throw(z))}catch(M){w(M)}}function J(z){z.done?y(z.value):function b(y){return y instanceof e?y:new e(function(w){w(y)})}(z.value).then(x,B)}J((p=p.apply(h,l||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.requestKeysDuringVerification=a.createCryptoStoreCacheCallbacks=a.DeviceTrustLevel=a.UserTrustLevel=a.CrossSigningLevel=a.CrossSigningInfo=void 0;const _=m("./olmlib"),d=m("../logger"),u=m("../crypto/store/indexeddb-crypto-store"),g=m("./aes");function v(h){return Object.values(h.keys)[0]}class c{constructor(l,e={},p={}){this.userId=l,this.callbacks=e,this.cacheCallbacks=p,this.keys={},this.firstUse=!0,this.crossSigningVerifiedBefore=!1}static fromStorage(l,e){const p=new c(e);for(const b in l)l.hasOwnProperty(b)&&(p[b]=l[b]);return p}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}getCrossSigningKey(l,e){return E(this,void 0,void 0,function*(){const p=["master","self_signing","user_signing"].indexOf(l)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function b(B){if(!B)return;const J=new R.Olm.PkSigning,z=J.init_with_seed(B);if(z===e)return[z,J];J.free()}void 0===e&&(e=this.getId(l));let y=null;this.cacheCallbacks.getCrossSigningKeyCache&&p&&(y=yield this.cacheCallbacks.getCrossSigningKeyCache(l,e));const w=b(y);if(w)return w;y=yield this.callbacks.getCrossSigningKey(l,e);const x=b(y);if(x)return this.cacheCallbacks.storeCrossSigningKeyCache&&p&&(yield this.cacheCallbacks.storeCrossSigningKeyCache(l,y)),x;throw y?new Error("Key type "+l+" from getCrossSigningKey callback did not match"):new Error("getCrossSigningKey callback for "+l+" returned falsey")})}isStoredInSecretStorage(l){return E(this,void 0,void 0,function*(){const e=(yield l.isStored("m.cross_signing.master"))||{};function p(b){for(const y of Object.keys(e))b[y]||delete e[y]}for(const b of["self_signing","user_signing"])p((yield l.isStored(`m.cross_signing.${b}`))||{});return Object.keys(e).length?e:null})}static storeInSecretStorage(l,e){return E(this,void 0,void 0,function*(){for(const[p,b]of l){const y=(0,_.encodeBase64)(b);yield e.store(`m.cross_signing.${p}`,y)}})}static getFromSecretStorage(l,e){return E(this,void 0,void 0,function*(){const p=yield e.get(`m.cross_signing.${l}`);return p?(0,_.decodeBase64)(p):null})}isStoredInKeyCache(l){var e;return E(this,void 0,void 0,function*(){const p=this.cacheCallbacks;if(!p)return!1;const b=l?[l]:["master","self_signing","user_signing"];for(const y of b)if(!(yield null===(e=p.getCrossSigningKeyCache)||void 0===e?void 0:e.call(p,y)))return!1;return!0})}getCrossSigningKeysFromCache(){var l;return E(this,void 0,void 0,function*(){const e=new Map,p=this.cacheCallbacks;if(!p)return e;for(const b of["master","self_signing","user_signing"]){const y=yield null===(l=p.getCrossSigningKeyCache)||void 0===l?void 0:l.call(p,b);y&&e.set(b,y)}return e})}getId(l="master"){return this.keys[l]?v(this.keys[l]):null}resetKeys(l){return E(this,void 0,void 0,function*(){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===l||l&r.MASTER||!this.keys.master)l=r.MASTER|r.USER_SIGNING|r.SELF_SIGNING;else if(0===l)return;const e={},p={};let b,y;try{if(l&r.MASTER?(b=new R.Olm.PkSigning,e.master=b.generate_seed(),y=b.init_with_seed(e.master),p.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+y]:y}}):[y,b]=yield this.getCrossSigningKey("master"),l&r.SELF_SIGNING){const w=new R.Olm.PkSigning;try{e.self_signing=w.generate_seed();const x=w.init_with_seed(e.self_signing);p.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+x]:x}},(0,_.pkSign)(p.self_signing,b,this.userId,y)}finally{w.free()}}if(l&r.USER_SIGNING){const w=new R.Olm.PkSigning;try{e.user_signing=w.generate_seed();const x=w.init_with_seed(e.user_signing);p.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+x]:x}},(0,_.pkSign)(p.user_signing,b,this.userId,y)}finally{w.free()}}Object.assign(this.keys,p),this.callbacks.saveCrossSigningKeys(e)}finally{b&&b.free()}})}clearKeys(){this.keys={}}setKeys(l){const e={};if(l.master){if(l.master.user_id!==this.userId){const b="Mismatched user ID "+l.master.user_id+" in master key from "+this.userId;throw d.logger.error(b),new Error(b)}this.keys.master?v(l.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,e.master=l.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");e.master=this.keys.master}const p=v(e.master);if(l.user_signing){if(l.user_signing.user_id!==this.userId){const b="Mismatched user ID "+l.master.user_id+" in user_signing key from "+this.userId;throw d.logger.error(b),new Error(b)}try{(0,_.pkVerify)(l.user_signing,p,this.userId)}catch(b){throw d.logger.error("invalid signature on user-signing key"),b}}if(l.self_signing){if(l.self_signing.user_id!==this.userId){const b="Mismatched user ID "+l.master.user_id+" in self_signing key from "+this.userId;throw d.logger.error(b),new Error(b)}try{(0,_.pkVerify)(l.self_signing,p,this.userId)}catch(b){throw d.logger.error("invalid signature on self-signing key"),b}}l.master&&(this.keys.master=l.master,delete this.keys.self_signing,delete this.keys.user_signing),l.self_signing&&(this.keys.self_signing=l.self_signing),l.user_signing&&(this.keys.user_signing=l.user_signing)}updateCrossSigningVerifiedBefore(l){!this.crossSigningVerifiedBefore&&l&&(this.crossSigningVerifiedBefore=!0)}signObject(l,e){return E(this,void 0,void 0,function*(){if(!this.keys[e])throw new Error("Attempted to sign with "+e+" key but no such key present");const[p,b]=yield this.getCrossSigningKey(e);try{return(0,_.pkSign)(l,b,this.userId,p),l}finally{b.free()}})}signUser(l){return E(this,void 0,void 0,function*(){if(this.keys.user_signing)return this.signObject(l.keys.master,"user_signing");d.logger.info("No user signing key: not signing user")})}signDevice(l,e){return E(this,void 0,void 0,function*(){if(l!==this.userId)throw new Error(`Trying to sign ${l}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:l},"self_signing");d.logger.info("No self signing key: not signing device")})}checkUserTrust(l){if(this.userId===l.userId&&this.getId()&&this.getId()===l.getId()&&this.getId("self_signing")&&this.getId("self_signing")===l.getId("self_signing"))return new s(!0,!0,this.firstUse);if(!this.keys.user_signing)return new s(!1,!1,l.firstUse);let e;const p=l.keys.master,b=this.getId("user_signing");try{(0,_.pkVerify)(p,b,this.userId),e=!0}catch{e=!1}return new s(e,l.crossSigningVerifiedBefore,l.firstUse)}checkDeviceTrust(l,e,p,b){const y=this.checkUserTrust(l),w=l.keys.self_signing;if(!w)return new t(!1,!1,p,b);const x=function i(h,l){return{algorithms:h.algorithms,keys:h.keys,device_id:h.deviceId,user_id:l,signatures:h.signatures}}(e,l.userId);try{return(0,_.pkVerify)(w,l.getId(),l.userId),(0,_.pkVerify)(x,v(w),l.userId),t.fromUserTrustLevel(y,p,b)}catch{return new t(!1,!1,p,b)}}getCacheCallbacks(){return this.cacheCallbacks}}var r,h;a.CrossSigningInfo=c,(h=r=a.CrossSigningLevel||(a.CrossSigningLevel={}))[h.MASTER=4]="MASTER",h[h.USER_SIGNING=2]="USER_SIGNING",h[h.SELF_SIGNING=1]="SELF_SIGNING";class s{constructor(l,e,p){this.crossSigningVerified=l,this.crossSigningVerifiedBefore=e,this.tofu=p}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}a.UserTrustLevel=s;class t{constructor(l,e,p,b){this.crossSigningVerified=l,this.tofu=e,this.localVerified=p,this.trustCrossSignedDevices=b}static fromUserTrustLevel(l,e,p){return new t(l.isCrossSigningVerified(),l.isTofu(),e,p)}isVerified(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}a.DeviceTrustLevel=t,a.createCryptoStoreCacheCallbacks=function n(h,l){return{getCrossSigningKeyCache:function(e,p){return E(this,void 0,void 0,function*(){const b=yield new Promise(y=>h.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_ACCOUNT],w=>{h.getSecretStorePrivateKey(w,y,e)}));if(b&&b.ciphertext){const y=I.from(l.pickleKey),w=yield(0,g.decryptAES)(b,y,e);return(0,_.decodeBase64)(w)}return b})},storeCrossSigningKeyCache:function(e,p){return E(this,void 0,void 0,function*(){if(!(p instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${p}`);const b=I.from(l.pickleKey),y=yield(0,g.encryptAES)((0,_.encodeBase64)(p),b,e);return h.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT],w=>{h.storeSecretStorePrivateKey(w,e,y)})})}}},a.requestKeysDuringVerification=function o(h,l,e){return E(this,void 0,void 0,function*(){if(h.getUserId()===l)return d.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise((p,b)=>{const y=h,w=y.crypto.crossSigningInfo,x=new c(w.userId,{getCrossSigningKey:z=>E(this,void 0,void 0,function*(){d.logger.debug("Cross-signing: requesting secret",z,e);const{promise:M}=y.requestSecret(`m.cross_signing.${z}`,[e]),L=yield M,j=(0,_.decodeBase64)(L);return Uint8Array.from(j)})},w.getCacheCallbacks());x.keys=w.keys;const B=new Promise(z=>{setTimeout(z,6e4,new Error("Timeout"))}),J=(()=>E(this,void 0,void 0,function*(){if(!(yield y.crypto.getSessionBackupPrivateKey())){d.logger.info("No cached backup key found. Requesting...");const L=yield y.requestSecret("m.megolm_backup.v1",[e]).promise;d.logger.info("Got key backup key, decoding...");const j=(0,_.decodeBase64)(L);d.logger.info("Decoded backup key, storing..."),yield y.crypto.storeSessionBackupPrivateKey(Uint8Array.from(j)),d.logger.info("Backup key stored. Starting backup restore...");const C=yield y.getKeyBackupVersion();y.restoreKeyBackupWithCache(void 0,void 0,C).then(()=>{d.logger.info("Backup restored.")})}}))();return Promise.race([Promise.all([x.getCrossSigningKey("master"),x.getCrossSigningKey("self_signing"),x.getCrossSigningKey("user_signing"),J]),B]).then(p,b)}).catch(p=>{d.logger.warn("Cross-signing: failure while requesting keys:",p)})})}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{"../crypto/store/indexeddb-crypto-store":338,"../logger":365,"./aes":323,"./olmlib":335,buffer:68}],317:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(l,e,p,b){void 0===b&&(b=p);var y=Object.getOwnPropertyDescriptor(e,p);(!y||("get"in y?!e.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return e[p]}}),Object.defineProperty(l,b,y)}:function(l,e,p,b){void 0===b&&(b=p),l[b]=e[p]}),I=this&&this.__setModuleDefault||(Object.create?function(l,e){Object.defineProperty(l,"default",{enumerable:!0,value:e})}:function(l,e){l.default=e}),E=this&&this.__importStar||function(l){if(l&&l.__esModule)return l;var e={};if(null!=l)for(var p in l)"default"!==p&&Object.prototype.hasOwnProperty.call(l,p)&&R(e,l,p);return I(e,l),e},_=this&&this.__awaiter||function(l,e,p,b){return new(p||(p=Promise))(function(w,x){function B(M){try{z(b.next(M))}catch(L){x(L)}}function J(M){try{z(b.throw(M))}catch(L){x(L)}}function z(M){M.done?w(M.value):function y(w){return w instanceof p?w:new p(function(x){x(w)})}(M.value).then(B,J)}z((b=b.apply(l,e||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.DeviceList=a.TrackingStatus=void 0;const d=m("../logger"),u=m("./deviceinfo"),g=m("./CrossSigning"),f=E(m("./olmlib")),v=m("./store/indexeddb-crypto-store"),c=m("../utils"),i=m("../models/typed-event-emitter"),r=m("./index");var s,l;(l=s=a.TrackingStatus||(a.TrackingStatus={}))[l.NotTracked=0]="NotTracked",l[l.PendingDownload=1]="PendingDownload",l[l.DownloadInProgress=2]="DownloadInProgress",l[l.UpToDate=3]="UpToDate",a.DeviceList=class t extends i.TypedEventEmitter{constructor(e,p,b,y=250){super(),this.cryptoStore=p,this.keyDownloadChunkSize=y,this.devices={},this.crossSigningInfo={},this.userByIdentityKey={},this.deviceTrackingStatus={},this.syncToken=null,this.keyDownloadsInProgressByUser=new Map,this.dirty=!1,this.savePromise=null,this.resolveSavePromise=null,this.savePromiseTime=null,this.saveTimer=null,this.hasFetched=null,this.serialiser=new n(e,b,this)}load(){return _(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_DEVICE_DATA],e=>{this.cryptoStore.getEndToEndDeviceData(e,p=>{var b;this.hasFetched=Boolean(p&&p.devices),this.devices=p?p.devices:{},this.crossSigningInfo=p&&p.crossSigningInfo||{},this.deviceTrackingStatus=p?p.trackingStatus:{},this.syncToken=null!==(b=p?.syncToken)&&void 0!==b?b:null,this.userByIdentityKey={};for(const y of Object.keys(this.devices)){const w=this.devices[y];for(const x of Object.keys(w)){const B=w[x].keys["curve25519:"+x];void 0!==B&&(this.userByIdentityKey[B]=y)}}})});for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==s.DownloadInProgress&&(this.deviceTrackingStatus[e]=s.PendingDownload)})}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}saveIfDirty(e=500){return _(this,void 0,void 0,function*(){if(!this.dirty)return Promise.resolve(!1);const p=Date.now()+e;this.savePromiseTime&&p<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let b=this.savePromise;if(null===b&&(b=new Promise(y=>{this.resolveSavePromise=y}),this.savePromise=b),null===this.saveTimer){const y=this.resolveSavePromise;this.savePromiseTime=p,this.saveTimer=setTimeout(()=>{d.logger.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_DEVICE_DATA],w=>{var x;this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:null!==(x=this.syncToken)&&void 0!==x?x:void 0},w)}).then(()=>{this.dirty=!1,y?.(!0)},w=>{d.logger.error("Failed to save device tracking data",this.syncToken),d.logger.error(w)})},e)}return b})}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,p){const b=[],y=[];if(e.forEach(w=>{const x=this.deviceTrackingStatus[w];this.keyDownloadsInProgressByUser.has(w)?(d.logger.log(`downloadKeys: already have a download in progress for ${w}: awaiting its result`),y.push(this.keyDownloadsInProgressByUser.get(w))):(p||x!=s.UpToDate)&&b.push(w)}),0!=b.length){d.logger.log("downloadKeys: downloading for",b);const w=this.doKeyDownload(b);y.push(w)}return 0===y.length&&d.logger.log("downloadKeys: already have all necessary keys"),Promise.all(y).then(()=>this.getDevicesFromStore(e))}getDevicesFromStore(e){const p={};return e.forEach(b=>{p[b]={},(this.getStoredDevicesForUser(b)||[]).forEach(function(w){p[b][w.deviceId]=w})}),p}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const p=this.devices[e];if(!p)return null;const b=[];for(const y in p)p.hasOwnProperty(y)&&b.push(u.DeviceInfo.fromStorage(p[y],y));return b}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?g.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,p){this.crossSigningInfo[e]=p,this.dirty=!0}getStoredDevice(e,p){const b=this.devices[e];if(b?.[p])return u.DeviceInfo.fromStorage(b[p],p)}getUserByIdentityKey(e,p){return e!==f.OLM_ALGORITHM&&e!==f.MEGOLM_ALGORITHM?null:this.userByIdentityKey[p]}getDeviceByIdentityKey(e,p){const b=this.getUserByIdentityKey(e,p);if(!b)return null;const y=this.devices[b];if(!y)return null;for(const w in y){if(!y.hasOwnProperty(w))continue;const x=y[w];for(const B in x.keys)if(x.keys.hasOwnProperty(B)&&0===B.indexOf("curve25519:")&&x.keys[B]==p)return u.DeviceInfo.fromStorage(x,w)}return null}storeDevicesForUser(e,p){this.setRawStoredDevicesForUser(e,p),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(d.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=s.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(d.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=s.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=s.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(d.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=s.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const p of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[p]==s.PendingDownload&&e.push(p);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,p){if(void 0!==this.devices[e])for(const[b,y]of Object.entries(this.devices[e]))delete this.userByIdentityKey[y.keys["curve25519:"+b]];this.devices[e]=p;for(const[b,y]of Object.entries(p))this.userByIdentityKey[y.keys["curve25519:"+b]]=e}setRawStoredCrossSigningForUser(e,p){this.crossSigningInfo[e]=p}doKeyDownload(e){if(0===e.length)return Promise.resolve();const p=this.serialiser.updateDevicesForUsers(e,this.syncToken).then(()=>{b(!0)},y=>{throw d.logger.error("Error downloading keys for "+e+":",y),b(!1),y});e.forEach(y=>{this.keyDownloadsInProgressByUser.set(y,p),this.deviceTrackingStatus[y]==s.PendingDownload&&(this.deviceTrackingStatus[y]=s.DownloadInProgress)});const b=y=>{this.emit(r.CryptoEvent.WillUpdateDevices,e,!this.hasFetched),e.forEach(w=>{this.dirty=!0,this.keyDownloadsInProgressByUser.get(w)===p?(this.keyDownloadsInProgressByUser.delete(w),this.deviceTrackingStatus[w]==s.DownloadInProgress&&(y?(this.deviceTrackingStatus[w]=s.UpToDate,d.logger.log("Device list for",w,"now up to date")):this.deviceTrackingStatus[w]=s.PendingDownload)):d.logger.log("Another update in the queue for",w,"- not marking up-to-date")}),this.saveIfDirty(),this.emit(r.CryptoEvent.DevicesUpdated,e,!this.hasFetched),this.hasFetched=!0};return p}};class n{constructor(e,p,b){this.baseApis=e,this.olmDevice=p,this.deviceList=b,this.downloadInProgress=!1,this.keyDownloadsQueuedByUser={}}updateDevicesForUsers(e,p){return e.forEach(b=>{this.keyDownloadsQueuedByUser[b]=!0}),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,c.defer)()),this.syncToken=p,this.downloadInProgress?(d.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const p=this.queuedQueryDeferred;this.queuedQueryDeferred=void 0,d.logger.log("Starting key download for",e),this.downloadInProgress=!0;const b={};this.syncToken&&(b.token=this.syncToken);const y=[];for(let w=0;w<e.length;w+=this.deviceList.keyDownloadChunkSize){const x=e.slice(w,w+this.deviceList.keyDownloadChunkSize);y.push(()=>this.baseApis.downloadKeysForUsers(x,b))}return(0,c.chunkPromises)(y,3).then(w=>_(this,void 0,void 0,function*(){const x=Object.assign({},...w.map(M=>M.device_keys||{})),B=Object.assign({},...w.map(M=>M.master_keys||{})),J=Object.assign({},...w.map(M=>M.self_signing_keys||{})),z=Object.assign({},...w.map(M=>M.user_signing_keys||{}));for(const M of e){yield(0,c.sleep)(5);try{yield this.processQueryResponseForUser(M,x[M],{master:B?.[M],self_signing:J?.[M],user_signing:z?.[M]})}catch(L){d.logger.error(`Error processing keys for ${M}:`,L)}}})).then(()=>{d.logger.log("Completed key download for "+e),this.downloadInProgress=!1,p?.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()},w=>{d.logger.warn("Error downloading keys for "+e+":",w),this.downloadInProgress=!1,p?.reject(w)}),p.promise}processQueryResponseForUser(e,p,b){return _(this,void 0,void 0,function*(){d.logger.log("got device keys for "+e+":",p),d.logger.log("got cross-signing keys for "+e+":",b);{const y={},w=this.deviceList.getRawStoredDevicesForUser(e);w&&Object.keys(w).forEach(B=>{const J=u.DeviceInfo.fromStorage(w[B],B);y[B]=J}),yield function o(l,e,p,b,y,w){return _(this,void 0,void 0,function*(){let x=!1;for(const B in p)if(p.hasOwnProperty(B)&&!(B in b)){if(e===y&&B===w){d.logger.warn(`Local device ${B} missing from sync, skipping removal`);continue}d.logger.log("Device "+e+":"+B+" has been removed"),delete p[B],x=!0}for(const B in b){if(!b.hasOwnProperty(B))continue;const J=b[B];J.user_id===e?J.device_id===B?(yield h(l,p,J))&&(x=!0):d.logger.warn("Mismatched device_id "+J.device_id+" in keys from "+e+":"+B):d.logger.warn("Mismatched user_id "+J.user_id+" in keys from "+e+":"+B)}return x})}(this.olmDevice,e,y,p||{},this.baseApis.getUserId(),this.baseApis.deviceId);const x={};Object.keys(y).forEach(B=>{x[B]=y[B].toStorage()}),this.deviceList.setRawStoredDevicesForUser(e,x)}if(b&&(b.master||b.self_signing||b.user_signing)){const y=this.deviceList.getStoredCrossSigningForUser(e)||new g.CrossSigningInfo(e);y.setKeys(b),this.deviceList.setRawStoredCrossSigningForUser(e,y.toStorage()),this.deviceList.emit(r.CryptoEvent.UserCrossSigningUpdated,e)}})}}function h(l,e,p){return _(this,void 0,void 0,function*(){if(!p.keys)return!1;const b=p.device_id,y=p.user_id,x=p.keys["ed25519:"+b];if(!x)return d.logger.warn("Device "+y+":"+b+" has no ed25519 key"),!1;const B=p.unsigned||{},J=p.signatures||{};try{yield f.verifySignature(l,p,y,b,x)}catch(M){return d.logger.warn("Unable to verify signature on device "+y+":"+b+":"+M),!1}let z;if(b in e){if(z=e[b],z.getFingerprint()!=x)return d.logger.warn("Ed25519 key for device "+y+":"+b+" has changed"),!1}else e[b]=z=new u.DeviceInfo(b);return z.keys=p.keys||{},z.algorithms=p.algorithms||[],z.unsigned=B,z.signatures=J,!0})}},{"../logger":365,"../models/typed-event-emitter":385,"../utils":402,"./CrossSigning":316,"./deviceinfo":332,"./index":333,"./olmlib":335,"./store/indexeddb-crypto-store":338}],318:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(t,n,o,h){return new(o||(o=Promise))(function(e,p){function b(x){try{w(h.next(x))}catch(B){p(B)}}function y(x){try{w(h.throw(x))}catch(B){p(B)}}function w(x){x.done?e(x.value):function l(e){return e instanceof o?e:new o(function(p){p(e)})}(x.value).then(b,y)}w((h=h.apply(t,n||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.EncryptionSetupOperation=a.EncryptionSetupBuilder=void 0;const I=m("../logger"),E=m("../models/event"),_=m("./CrossSigning"),d=m("./store/indexeddb-crypto-store"),u=m("../http-api"),g=m("../client"),f=m("../models/typed-event-emitter");a.EncryptionSetupBuilder=class v{constructor(n,o){this.accountDataClientAdapter=new i(n),this.crossSigningCallbacks=new r,this.ssssCryptoCallbacks=new s(o)}addCrossSigningKeys(n,o){this.crossSigningKeys={authUpload:n,keys:o}}addSessionBackup(n){this.keyBackupInfo=n}addSessionBackupPrivateKeyToCache(n){this.sessionBackupPrivateKey=n}addKeySignature(n,o,h){this.keySignatures||(this.keySignatures={});const l=this.keySignatures[n]||{};this.keySignatures[n]=l,l[o]=h}setAccountData(n,o){return R(this,void 0,void 0,function*(){yield this.accountDataClientAdapter.setAccountData(n,o)})}buildOperation(){return new c(this.accountDataClientAdapter.values,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}persist(n){var o;return R(this,void 0,void 0,function*(){if(this.crossSigningKeys){const h=(0,_.createCryptoStoreCacheCallbacks)(n.cryptoStore,n.olmDevice);for(const l of["master","self_signing","user_signing"]){I.logger.log(`Cache ${l} cross-signing private key locally`);const e=this.crossSigningCallbacks.privateKeys.get(l);yield null===(o=h.storeCrossSigningKeyCache)||void 0===o?void 0:o.call(h,l,e)}yield n.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT],l=>{n.cryptoStore.storeCrossSigningKeys(l,this.crossSigningKeys.keys)})}this.sessionBackupPrivateKey&&(yield n.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey))})}};class c{constructor(n,o,h,l){this.accountData=n,this.crossSigningKeys=o,this.keyBackupInfo=h,this.keySignatures=l}apply(n){var o,h;return R(this,void 0,void 0,function*(){const l=n.baseApis;if(this.crossSigningKeys){const e={};for(const[p,b]of Object.entries(this.crossSigningKeys.keys))e[p+"_key"]=b;yield null===(h=(o=this.crossSigningKeys).authUpload)||void 0===h?void 0:h.call(o,p=>l.uploadDeviceSigningKeys(p,e)),n.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[e,p]of this.accountData)yield l.setAccountData(e,p);this.keySignatures&&(yield l.uploadKeySignatures(this.keySignatures)),this.keyBackupInfo&&(this.keyBackupInfo.version?yield l.http.authedRequest(u.Method.Put,"/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:u.ClientPrefix.V3}):yield l.http.authedRequest(u.Method.Post,"/room_keys/version",void 0,this.keyBackupInfo,{prefix:u.ClientPrefix.V3}))})}}a.EncryptionSetupOperation=c;class i extends f.TypedEventEmitter{constructor(n){super(),this.existingValues=n,this.values=new Map}getAccountDataFromServer(n){return Promise.resolve(this.getAccountData(n))}getAccountData(n){const o=this.values.get(n);if(o)return o;const h=this.existingValues[n];return h?h.getContent():null}setAccountData(n,o){const h=this.values.get(n);return this.values.set(n,o),Promise.resolve().then(()=>{const l=new E.MatrixEvent({type:n,content:o});return this.emit(g.ClientEvent.AccountData,l,h),{}})}}class r{constructor(){this.privateKeys=new Map}getCrossSigningKeyCache(n,o){return this.getCrossSigningKey(n,o)}storeCrossSigningKeyCache(n,o){return this.privateKeys.set(n,o),Promise.resolve()}getCrossSigningKey(n,o){var h;return Promise.resolve(null!==(h=this.privateKeys.get(n))&&void 0!==h?h:null)}saveCrossSigningKeys(n){for(const[o,h]of Object.entries(n))this.privateKeys.set(o,h)}}class s{constructor(n){this.delegateCryptoCallbacks=n,this.privateKeys=new Map}getSecretStorageKey({keys:n},o){var h;return R(this,void 0,void 0,function*(){for(const l of Object.keys(n)){const e=this.privateKeys.get(l);if(e)return[l,e]}if(null!==(h=null==this?void 0:this.delegateCryptoCallbacks)&&void 0!==h&&h.getSecretStorageKey){const l=yield this.delegateCryptoCallbacks.getSecretStorageKey({keys:n},o);if(l){const[e,p]=l;this.privateKeys.set(e,p)}return l}return null})}addPrivateKey(n,o,h){var l,e;this.privateKeys.set(n,h),null===(e=null===(l=this.delegateCryptoCallbacks)||void 0===l?void 0:l.cacheSecretStorageKey)||void 0===e||e.call(l,n,o,h)}}},{"../client":313,"../http-api":358,"../logger":365,"../models/event":374,"../models/typed-event-emitter":385,"./CrossSigning":316,"./store/indexeddb-crypto-store":338}],319:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(t,n,o,h){void 0===h&&(h=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(t,h,l)}:function(t,n,o,h){void 0===h&&(h=o),t[h]=n[o]}),E=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),_=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&I(n,t,o);return E(n,t),n},d=this&&this.__awaiter||function(t,n,o,h){return new(o||(o=Promise))(function(e,p){function b(x){try{w(h.next(x))}catch(B){p(B)}}function y(x){try{w(h.throw(x))}catch(B){p(B)}}function w(x){x.done?e(x.value):function l(e){return e instanceof o?e:new o(function(p){p(e)})}(x.value).then(b,y)}w((h=h.apply(t,n||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.WITHHELD_MESSAGES=a.OlmDevice=a.PayloadTooLargeError=void 0;const u=m("../logger"),g=m("./store/indexeddb-crypto-store"),f=_(m("./algorithms")),v=49152;class c extends Error{constructor(){super(...arguments),this.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"}}}function i(t){if(void 0===t)throw new Error("payloadString undefined");if(t.length>v)throw new c(`Message too long (${t.length} bytes). The maximum for an encrypted message is ${v} bytes.`)}function s(t){return t.code&&t.code in a.WITHHELD_MESSAGES?a.WITHHELD_MESSAGES[t.code]:t.reason?t.reason:"decryption key withheld"}a.PayloadTooLargeError=c,a.OlmDevice=class r{constructor(n){this.cryptoStore=n,this.pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this.maxOneTimeKeys=null,this.outboundGroupSessionStore={},this.inboundGroupSessionMessageIndexes={},this.sessionsInProgress={},this.olmPrekeyPromise=Promise.resolve()}static getOlmVersion(){return R.Olm.get_library_version()}init({pickleKey:n,fromExportedDevice:o}={}){return d(this,void 0,void 0,function*(){let h;const l=new R.Olm.Account;try{o?(n&&u.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=o.pickleKey,yield this.initialiseFromExportedDevice(o,l)):(n&&(this.pickleKey=n),yield this.initialiseAccount(l)),h=JSON.parse(l.identity_keys()),this.maxOneTimeKeys=l.max_number_of_one_time_keys()}finally{l.free()}this.deviceCurve25519Key=h.curve25519,this.deviceEd25519Key=h.ed25519})}initialiseFromExportedDevice(n,o){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],h=>{this.cryptoStore.storeAccount(h,n.pickledAccount),n.sessions.forEach(l=>{const{deviceKey:e,sessionId:p}=l;this.cryptoStore.storeEndToEndSession(e,p,{session:l.session,lastReceivedMessageTs:l.lastReceivedMessageTs},h)})}),o.unpickle(this.pickleKey,n.pickledAccount)})}initialiseAccount(n){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],o=>{this.cryptoStore.getAccount(o,h=>{null!==h?n.unpickle(this.pickleKey,h):(n.create(),h=n.pickle(this.pickleKey),this.cryptoStore.storeAccount(o,h))})})})}getAccount(n,o){this.cryptoStore.getAccount(n,h=>{const l=new R.Olm.Account;try{l.unpickle(this.pickleKey,h),o(l)}finally{l.free()}})}storeAccount(n,o){this.cryptoStore.storeAccount(n,o.pickle(this.pickleKey))}export(){return d(this,void 0,void 0,function*(){const n={pickleKey:this.pickleKey};return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],o=>{this.cryptoStore.getAccount(o,h=>{n.pickledAccount=h}),n.sessions=[],this.cryptoStore.getAllEndToEndSessions(o,h=>{n.sessions.push(h)})}),n})}getSession(n,o,h,l){this.cryptoStore.getEndToEndSession(n,o,h,e=>{this.unpickleSession(e,l)})}unpickleSession(n,o){const h=new R.Olm.Session;try{h.unpickle(this.pickleKey,n.session),o(Object.assign({},n,{session:h}))}finally{h.free()}}saveSession(n,o,h){const l=o.session.session_id(),e=Object.assign(o,{session:o.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(n,l,e,h)}getUtility(n){const o=new R.Olm.Utility;try{return n(o)}finally{o.free()}}sign(n){return d(this,void 0,void 0,function*(){let o;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],h=>{this.getAccount(h,l=>{o=l.sign(n)})}),o})}getOneTimeKeys(){return d(this,void 0,void 0,function*(){let n;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],o=>{this.getAccount(o,h=>{n=JSON.parse(h.one_time_keys())})}),n})}maxNumberOfOneTimeKeys(){var n;return null!==(n=this.maxOneTimeKeys)&&void 0!==n?n:-1}markKeysAsPublished(){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],n=>{this.getAccount(n,o=>{o.mark_keys_as_published(),this.storeAccount(n,o)})})})}generateOneTimeKeys(n){return this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],o=>{this.getAccount(o,h=>{h.generate_one_time_keys(n),this.storeAccount(o,h)})})}generateFallbackKey(){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],n=>{this.getAccount(n,o=>{o.generate_fallback_key(),this.storeAccount(n,o)})})})}getFallbackKey(){return d(this,void 0,void 0,function*(){let n;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],o=>{this.getAccount(o,h=>{n=JSON.parse(h.unpublished_fallback_key())})}),n})}forgetOldFallbackKey(){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],n=>{this.getAccount(n,o=>{o.forget_old_fallback_key(),this.storeAccount(n,o)})})})}createOutboundSession(n,o){return d(this,void 0,void 0,function*(){let h;return yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],l=>{this.getAccount(l,e=>{const p=new R.Olm.Session;try{p.create_outbound(e,n,o),h=p.session_id(),this.storeAccount(l,e);const b={session:p,lastReceivedMessageTs:Date.now()};this.saveSession(n,b,l)}finally{p.free()}})},u.logger.withPrefix("[createOutboundSession]")),h})}createInboundSession(n,o,h){return d(this,void 0,void 0,function*(){if(0!==o)throw new Error("Need messageType == 0 to create inbound session");let l;return yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],e=>{this.getAccount(e,p=>{const b=new R.Olm.Session;try{b.create_inbound_from(p,n,h),p.remove_one_time_keys(b),this.storeAccount(e,p);const y=b.decrypt(o,h),w={session:b,lastReceivedMessageTs:Date.now()};this.saveSession(n,w,e),l={payload:y,session_id:b.session_id()}}finally{b.free()}})},u.logger.withPrefix("[createInboundSession]")),l})}getSessionIdsForDevice(n){return d(this,void 0,void 0,function*(){const o=u.logger.withPrefix("[getSessionIdsForDevice]");if(n in this.sessionsInProgress){o.debug(`Waiting for Olm session for ${n} to be created`);try{yield this.sessionsInProgress[n]}catch{}}let h;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],l=>{this.cryptoStore.getEndToEndSessions(n,l,e=>{h=Object.keys(e)})},o),h})}getSessionIdForDevice(n,o=!1,h){return d(this,void 0,void 0,function*(){const l=yield this.getSessionInfoForDevice(n,o,h);if(0===l.length)return null;let e=0;for(let p=1;p<l.length;p++){const b=l[p],y=void 0===b.lastReceivedMessageTs?0:b.lastReceivedMessageTs,w=l[e],x=void 0===w.lastReceivedMessageTs?0:w.lastReceivedMessageTs;(y>x||y===x&&b.sessionId<w.sessionId)&&(e=p)}return l[e].sessionId})}getSessionInfoForDevice(n,o=!1,h=u.logger){return d(this,void 0,void 0,function*(){if(h=h.withPrefix("[getSessionInfoForDevice]"),n in this.sessionsInProgress&&!o){h.debug(`Waiting for Olm session for ${n} to be created`);try{yield this.sessionsInProgress[n]}catch{}}const l=[];return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],e=>{this.cryptoStore.getEndToEndSessions(n,e,p=>{const b=Object.keys(p).sort();for(const y of b)this.unpickleSession(p[y],w=>{l.push({lastReceivedMessageTs:w.lastReceivedMessageTs,hasReceivedMessage:w.session.has_received_message(),sessionId:y})})})},h),l})}encryptMessage(n,o,h){return d(this,void 0,void 0,function*(){let l;return i(h),yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_SESSIONS],e=>{this.getSession(n,o,e,p=>{const b=p.session.describe();u.logger.log("encryptMessage: Olm Session ID "+o+" to "+n+": "+b),l=p.session.encrypt(h),this.saveSession(n,p,e)})},u.logger.withPrefix("[encryptMessage]")),l})}decryptMessage(n,o,h,l){return d(this,void 0,void 0,function*(){let e;return yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_SESSIONS],p=>{this.getSession(n,o,p,b=>{const y=b.session.describe();u.logger.log("decryptMessage: Olm Session ID "+o+" from "+n+": "+y),e=b.session.decrypt(h,l),b.lastReceivedMessageTs=Date.now(),this.saveSession(n,b,p)})},u.logger.withPrefix("[decryptMessage]")),e})}matchesSession(n,o,h,l){return d(this,void 0,void 0,function*(){if(0!==h)return!1;let e;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],p=>{this.getSession(n,o,p,b=>{e=b.session.matches_inbound(l)})},u.logger.withPrefix("[matchesSession]")),e})}recordSessionProblem(n,o,h){return d(this,void 0,void 0,function*(){u.logger.info(`Recording problem on olm session with ${n} of type ${o}. Recreating: ${h}`),yield this.cryptoStore.storeEndToEndSessionProblem(n,o,h)})}sessionMayHaveProblems(n,o){return this.cryptoStore.getEndToEndSessionProblem(n,o)}filterOutNotifiedErrorDevices(n){return this.cryptoStore.filterOutNotifiedErrorDevices(n)}saveOutboundGroupSession(n){this.outboundGroupSessionStore[n.session_id()]=n.pickle(this.pickleKey)}getOutboundGroupSession(n,o){const h=this.outboundGroupSessionStore[n];if(void 0===h)throw new Error("Unknown outbound group session "+n);const l=new R.Olm.OutboundGroupSession;try{return l.unpickle(this.pickleKey,h),o(l)}finally{l.free()}}createOutboundGroupSession(){const n=new R.Olm.OutboundGroupSession;try{return n.create(),this.saveOutboundGroupSession(n),n.session_id()}finally{n.free()}}encryptGroupMessage(n,o){return u.logger.log(`encrypting msg with megolm session ${n}`),i(o),this.getOutboundGroupSession(n,h=>{const l=h.encrypt(o);return this.saveOutboundGroupSession(h),l})}getOutboundGroupSessionKey(n){return this.getOutboundGroupSession(n,function(o){return{chain_index:o.message_index(),key:o.session_key()}})}unpickleInboundGroupSession(n,o){const h=new R.Olm.InboundGroupSession;try{return h.unpickle(this.pickleKey,n.session),o(h)}finally{h.free()}}getInboundGroupSession(n,o,h,l,e){this.cryptoStore.getEndToEndInboundGroupSession(o,h,l,(p,b)=>{if(null!==p){if(null!==n&&n!==p.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+p.room_id+", was "+n+")");this.unpickleInboundGroupSession(p,y=>{e(y,p,b)})}else e(null,null,b)})}addInboundGroupSession(n,o,h,l,e,p,b,y={}){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,g.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],w=>{this.getInboundGroupSession(n,o,l,w,(x,B)=>{const J=new R.Olm.InboundGroupSession;try{if(b?J.import_session(e):J.create(e),l!=J.session_id())throw new Error("Mismatched group session ID from senderKey: "+o);if(x&&(u.logger.log(`Update for megolm session ${o}|${l}`),x.first_known_index()<=J.first_known_index())){if(!B.untrusted||y.untrusted)return void u.logger.log(`Keeping existing megolm session ${o}|${l}`);if(x.first_known_index()<J.first_known_index())return void(x.export_session(J.first_known_index())===J.export_session(J.first_known_index())?(u.logger.info(`Upgrading trust of existing megolm session ${o}|${l} based on newly-received trusted session`),B.untrusted=!1,this.cryptoStore.storeEndToEndInboundGroupSession(o,l,B,w)):u.logger.warn(`Newly-received megolm session ${o}|$sessionId} does not match existing session! Keeping existing session`))}u.logger.info(`Storing megolm session ${o}|${l} with first index `+J.first_known_index());const z=Object.assign({},y,{room_id:n,session:J.pickle(this.pickleKey),keysClaimed:p,forwardingCurve25519KeyChain:h});this.cryptoStore.storeEndToEndInboundGroupSession(o,l,z,w),!x&&y.sharedHistory&&this.cryptoStore.addSharedHistoryInboundGroupSession(n,o,l,w)}finally{J.free()}})},u.logger.withPrefix("[addInboundGroupSession]"))})}addInboundGroupSessionWithheld(n,o,h,l,e){return d(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],p=>{this.cryptoStore.storeEndToEndInboundGroupSessionWithheld(o,h,{room_id:n,code:l,reason:e},p)})})}decryptGroupMessage(n,o,h,l,e,p){return d(this,void 0,void 0,function*(){let y,b=null;if(yield this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],w=>{this.getInboundGroupSession(n,o,h,w,(x,B,J)=>{if(null===x||null===B)return J&&(y=new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",s(J),{session:o+"|"+h})),void(b=null);let z;try{z=x.decrypt(l)}catch(L){return void(y="OLM.UNKNOWN_MESSAGE_INDEX"===L?.message&&J?new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",s(J),{session:o+"|"+h}):L)}let M=z.plaintext;if(void 0===M)M=z;else{const L=o+"|"+h+"|"+z.message_index;if(L in this.inboundGroupSessionMessageIndexes){const j=this.inboundGroupSessionMessageIndexes[L];if(j.id!==e||j.timestamp!==p)return void(y=new Error("Duplicate message index, possible replay attack: "+L))}this.inboundGroupSessionMessageIndexes[L]={id:e,timestamp:p}}B.session=x.pickle(this.pickleKey),this.cryptoStore.storeEndToEndInboundGroupSession(o,h,B,w),b={result:M,keysClaimed:B.keysClaimed||{},senderKey:o,forwardingCurve25519KeyChain:B.forwardingCurve25519KeyChain||[],untrusted:!!B.untrusted}})},u.logger.withPrefix("[decryptGroupMessage]")),y)throw y;return b})}hasInboundSessionKeys(n,o,h){return d(this,void 0,void 0,function*(){let l;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],e=>{this.cryptoStore.getEndToEndInboundGroupSession(o,h,e,p=>{null!==p?n!==p.room_id?(u.logger.warn(`requested keys for inbound group session ${o}|${h}, with incorrect room_id (expected ${p.room_id}, was ${n})`),l=!1):l=!0:l=!1})},u.logger.withPrefix("[hasInboundSessionKeys]")),l})}getInboundGroupSessionKey(n,o,h,l){return d(this,void 0,void 0,function*(){let e=null;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],p=>{this.getInboundGroupSession(n,o,h,p,(b,y)=>{if(null===b||null===y)return void(e=null);void 0===l&&(l=b.first_known_index());const w=b.export_session(l),J=y.forwardingCurve25519KeyChain||[];e={chain_index:l,key:w,forwarding_curve25519_key_chain:J,sender_claimed_ed25519_key:(y.keysClaimed||{}).ed25519||null,shared_history:y.sharedHistory||!1,untrusted:"untrusted"in y?y.untrusted:J.length>0}})},u.logger.withPrefix("[getInboundGroupSessionKey]")),e})}exportInboundGroupSession(n,o,h){return this.unpickleInboundGroupSession(h,l=>{const e=l.first_known_index();return{sender_key:n,sender_claimed_keys:h.keysClaimed,room_id:h.room_id,session_id:o,session_key:l.export_session(e),forwarding_curve25519_key_chain:h.forwardingCurve25519KeyChain||[],first_known_index:l.first_known_index(),"org.matrix.msc3061.shared_history":h.sharedHistory||!1}})}getSharedHistoryInboundGroupSessions(n){return d(this,void 0,void 0,function*(){let o;return yield this.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],h=>{o=this.cryptoStore.getSharedHistoryInboundGroupSessions(n,h)},u.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),o})}verifySignature(n,o,h){this.getUtility(function(l){l.ed25519_verify(n,o,h)})}},a.WITHHELD_MESSAGES={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../logger":365,"./algorithms":325,"./store/indexeddb-crypto-store":338}],320:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(c,i,r,s){return new(r||(r=Promise))(function(n,o){function h(p){try{e(s.next(p))}catch(b){o(b)}}function l(p){try{e(s.throw(p))}catch(b){o(b)}}function e(p){p.done?n(p.value):function t(n){return n instanceof r?n:new r(function(o){o(n)})}(p.value).then(h,l)}e((s=s.apply(c,i||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.OutgoingRoomKeyRequestManager=a.RoomKeyRequestState=void 0;const I=m("uuid"),E=m("../logger"),_=m("../@types/event");var u,c;function f(c){return c.room_id+" / "+c.session_id}function v(c){return`[${c.map(i=>`${i.userId}:${i.deviceId}`).join(",")}]`}(c=u=a.RoomKeyRequestState||(a.RoomKeyRequestState={}))[c.Unsent=0]="Unsent",c[c.Sent=1]="Sent",c[c.CancellationPending=2]="CancellationPending",c[c.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend",a.OutgoingRoomKeyRequestManager=class g{constructor(i,r,s){this.baseApis=i,this.deviceId=r,this.cryptoStore=s,this.sendOutgoingRoomKeyRequestsRunning=!1,this.clientRunning=!0}stop(){E.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}queueRoomKeyRequest(i,r,s=!1){return R(this,void 0,void 0,function*(){const t=yield this.cryptoStore.getOutgoingRoomKeyRequest(i);if(t)switch(t.state){case u.CancellationPendingAndWillResend:case u.Unsent:return;case u.CancellationPending:{const n=s?u.CancellationPendingAndWillResend:u.Sent;yield this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,u.CancellationPending,{state:n,cancellationTxnId:this.baseApis.makeTxnId()});break}case u.Sent:if(s){const n=u.CancellationPendingAndWillResend,o=yield this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,u.Sent,{state:n,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return this.queueRoomKeyRequest(i,r,s);try{yield this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(h){E.logger.error("Error sending room key request cancellation; will retry later.",h)}}break;default:throw new Error("unhandled state: "+t.state)}else yield this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:i,recipients:r,requestId:this.baseApis.makeTxnId(),state:u.Unsent})})}cancelRoomKeyRequest(i){return this.cryptoStore.getOutgoingRoomKeyRequest(i).then(r=>{if(r)switch(r.state){case u.CancellationPending:case u.CancellationPendingAndWillResend:return;case u.Unsent:return E.logger.log("deleting unnecessary room key request for "+f(i)),this.cryptoStore.deleteOutgoingRoomKeyRequest(r.requestId,u.Unsent);case u.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,u.Sent,{state:u.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then(s=>{s?this.sendOutgoingRoomKeyRequestCancellation(s).catch(t=>{E.logger.error("Error sending room key request cancellation; will retry later.",t),this.startTimer()}):E.logger.log("Tried to cancel room key request for "+f(i)+" but it was already cancelled in another tab")});default:throw new Error("unhandled state: "+r.state)}})}getOutgoingSentRoomKeyRequest(i,r){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(i,r,[u.Sent])}cancelAndResendAllOutgoingRequests(){return R(this,void 0,void 0,function*(){const i=yield this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(u.Sent);return Promise.all(i.map(({requestBody:r,recipients:s})=>this.queueRoomKeyRequest(r,s,!0)))})}startTimer(){this.sendOutgoingRoomKeyRequestsTimer||(this.sendOutgoingRoomKeyRequestsTimer=setTimeout(()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally(()=>{this.sendOutgoingRoomKeyRequestsRunning=!1}).catch(r=>{E.logger.warn(`error in OutgoingRoomKeyRequestManager: ${r}`)})},500))}sendOutgoingRoomKeyRequests(){return R(this,void 0,void 0,function*(){if(!this.clientRunning)return void(this.sendOutgoingRoomKeyRequestsTimer=void 0);const i=yield this.cryptoStore.getOutgoingRoomKeyRequestByState([u.CancellationPending,u.CancellationPendingAndWillResend,u.Unsent]);if(i)try{switch(i.state){case u.Unsent:yield this.sendOutgoingRoomKeyRequest(i);break;case u.CancellationPending:yield this.sendOutgoingRoomKeyRequestCancellation(i);break;case u.CancellationPendingAndWillResend:yield this.sendOutgoingRoomKeyRequestCancellation(i,!0)}return this.sendOutgoingRoomKeyRequests()}catch(r){E.logger.error("Error sending room key request; will retry later.",r),this.sendOutgoingRoomKeyRequestsTimer=void 0}else this.sendOutgoingRoomKeyRequestsTimer=void 0})}sendOutgoingRoomKeyRequest(i){return E.logger.log(`Requesting keys for ${f(i.requestBody)} from ${v(i.recipients)}(id ${i.requestId})`),this.sendMessageToDevices({action:"request",requesting_device_id:this.deviceId,request_id:i.requestId,body:i.requestBody},i.recipients,i.requestTxnId||i.requestId).then(()=>this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,u.Unsent,{state:u.Sent}))}sendOutgoingRoomKeyRequestCancellation(i,r=!1){return E.logger.log(`Sending cancellation for key request for ${f(i.requestBody)} to ${v(i.recipients)} (cancellation id ${i.cancellationTxnId})`),this.sendMessageToDevices({action:"request_cancellation",requesting_device_id:this.deviceId,request_id:i.requestId},i.recipients,i.cancellationTxnId).then(()=>r?this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,u.CancellationPendingAndWillResend,{state:u.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(i.requestId,u.CancellationPending))}sendMessageToDevices(i,r,s){const t={};for(const n of r)t[n.userId]||(t[n.userId]={}),t[n.userId][n.deviceId]=Object.assign(Object.assign({},i),{[_.ToDeviceMessageId]:(0,I.v4)()});return this.baseApis.sendToDevice(_.EventType.RoomKeyRequest,t,s)}}},{"../@types/event":299,"../logger":365,uuid:287}],321:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(_,d,u,g){return new(u||(u=Promise))(function(v,c){function i(t){try{s(g.next(t))}catch(n){c(n)}}function r(t){try{s(g.throw(t))}catch(n){c(n)}}function s(t){t.done?v(t.value):function f(v){return v instanceof u?v:new u(function(c){c(v)})}(t.value).then(i,r)}s((g=g.apply(_,d||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.RoomList=void 0;const I=m("./store/indexeddb-crypto-store");a.RoomList=class E{constructor(d){this.cryptoStore=d,this.roomEncryption={}}init(){return R(this,void 0,void 0,function*(){yield this.cryptoStore.doTxn("readwrite",[I.IndexedDBCryptoStore.STORE_ROOMS],d=>{this.cryptoStore.getEndToEndRooms(d,u=>{this.roomEncryption=u})})})}getRoomEncryption(d){return this.roomEncryption[d]||null}isRoomEncrypted(d){return Boolean(this.getRoomEncryption(d))}setRoomEncryption(d,u){return R(this,void 0,void 0,function*(){this.roomEncryption[d]=u,yield this.cryptoStore.doTxn("readwrite",[I.IndexedDBCryptoStore.STORE_ROOMS],g=>{this.cryptoStore.storeEndToEndRoom(d,u,g)})})}}},{"./store/indexeddb-crypto-store":338}],322:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(t,n,o,h){void 0===h&&(h=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(t,h,l)}:function(t,n,o,h){void 0===h&&(h=o),t[h]=n[o]}),I=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),E=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&R(n,t,o);return I(n,t),n},_=this&&this.__awaiter||function(t,n,o,h){return new(o||(o=Promise))(function(e,p){function b(x){try{w(h.next(x))}catch(B){p(B)}}function y(x){try{w(h.throw(x))}catch(B){p(B)}}function w(x){x.done?e(x.value):function l(e){return e instanceof o?e:new o(function(p){p(e)})}(x.value).then(b,y)}w((h=h.apply(t,n||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.SecretStorage=a.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;const d=m("uuid"),u=m("../logger"),g=E(m("./olmlib")),f=m("../randomstring"),v=m("./aes"),c=m("../client"),i=m("../utils"),r=m("../@types/event");a.SECRET_STORAGE_ALGORITHM_V1_AES="m.secret_storage.v1.aes-hmac-sha2",a.SecretStorage=class s{constructor(n,o,h){this.accountDataAdapter=n,this.cryptoCallbacks=o,this.baseApis=h,this.requests=new Map}getDefaultKeyId(){return _(this,void 0,void 0,function*(){const n=yield this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return n?n.key:null})}setDefaultKeyId(n){return new Promise((o,h)=>{const l=e=>{"m.secret_storage.default_key"===e.getType()&&e.getContent().key===n&&(this.accountDataAdapter.removeListener(c.ClientEvent.AccountData,l),o())};this.accountDataAdapter.on(c.ClientEvent.AccountData,l),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:n}).catch(e=>{this.accountDataAdapter.removeListener(c.ClientEvent.AccountData,l),h(e)})})}addKey(n,o={},h){return _(this,void 0,void 0,function*(){const l={algorithm:n};if(o.name&&(l.name=o.name),n!==a.SECRET_STORAGE_ALGORITHM_V1_AES)throw new Error(`Unknown key algorithm ${n}`);if(o.passphrase&&(l.passphrase=o.passphrase),o.key){const{iv:e,mac:p}=yield(0,v.calculateKeyCheck)(o.key);l.iv=e,l.mac=p}if(!h)do{h=(0,f.randomString)(32)}while(yield this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${h}`));return yield this.accountDataAdapter.setAccountData(`m.secret_storage.key.${h}`,l),{keyId:h,keyInfo:l}})}getKey(n){return _(this,void 0,void 0,function*(){if(n||(n=yield this.getDefaultKeyId()),!n)return null;const o=yield this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+n);return o?[n,o]:null})}hasKey(n){return _(this,void 0,void 0,function*(){return Boolean(yield this.getKey(n))})}checkKey(n,o){return _(this,void 0,void 0,function*(){if(o.algorithm===a.SECRET_STORAGE_ALGORITHM_V1_AES){if(o.mac){const{mac:h}=yield(0,v.calculateKeyCheck)(n,o.iv);return o.mac.replace(/=+$/g,"")===h.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")})}store(n,o,h){return _(this,void 0,void 0,function*(){const l={};if(!h){const e=yield this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");h=[e]}if(0===h.length)throw new Error("Zero keys given to encrypt with!");for(const e of h){const p=yield this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);if(!p)throw new Error("Unknown key: "+e);if(p.algorithm===a.SECRET_STORAGE_ALGORITHM_V1_AES){const b={[e]:p},[,y]=yield this.getSecretStorageKey(b,n);l[e]=yield y.encrypt(o)}else u.logger.warn("unknown algorithm for secret storage key "+e+": "+p.algorithm)}yield this.accountDataAdapter.setAccountData(n,{encrypted:l})})}get(n){return _(this,void 0,void 0,function*(){const o=yield this.accountDataAdapter.getAccountDataFromServer(n);if(!o)return;if(!o.encrypted)throw new Error("Content is not encrypted!");const h={};for(const b of Object.keys(o.encrypted)){const y=yield this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+b),w=o.encrypted[b];y.algorithm===a.SECRET_STORAGE_ALGORITHM_V1_AES&&w.iv&&w.ciphertext&&w.mac&&(h[b]=y)}if(0===Object.keys(h).length)throw new Error(`Could not decrypt ${n} because none of the keys it is encrypted with are for a supported algorithm`);const[l,e]=yield this.getSecretStorageKey(h,n);return e.decrypt(o.encrypted[l])})}isStored(n){return _(this,void 0,void 0,function*(){const o=yield this.accountDataAdapter.getAccountDataFromServer(n);if(!o?.encrypted)return null;const h={};for(const l of Object.keys(o.encrypted)){const e=yield this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+l);if(!e)continue;const p=o.encrypted[l];e.algorithm===a.SECRET_STORAGE_ALGORITHM_V1_AES&&p.iv&&p.ciphertext&&p.mac&&(h[l]=e)}return Object.keys(h).length?h:null})}request(n,o){const h=this.baseApis.makeTxnId(),l=(0,i.defer)();this.requests.set(h,{name:n,devices:o,deferred:l});const p={name:n,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:h,[r.ToDeviceMessageId]:(0,d.v4)()},b={};for(const y of o)b[y]=p;return u.logger.info(`Request secret ${n} from ${o}, id ${h}`),this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:b}),{requestId:h,promise:l.promise,cancel:y=>{const w={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:h},x={};for(const B of o)x[B]=w;this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:x}),l.reject(new Error(y||"Cancelled"))}}}onRequestReceived(n){return _(this,void 0,void 0,function*(){const o=n.getSender(),h=n.getContent();if(o!==this.baseApis.getUserId()||!(h.name&&h.action&&h.requesting_device_id&&h.request_id))return;const l=h.requesting_device_id;if("request_cancellation"!==h.action&&"request"===h.action){if(l===this.baseApis.deviceId||(u.logger.info("received request for secret ("+o+", "+l+", "+h.request_id+")"),!this.cryptoCallbacks.onSecretRequested))return;const e=yield this.cryptoCallbacks.onSecretRequested(o,l,h.request_id,h.name,this.baseApis.checkDeviceTrust(o,l));if(e){u.logger.info(`Preparing ${h.name} secret for ${l}`);const p={type:"m.secret.send",content:{request_id:h.request_id,secret:e}},b={algorithm:g.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{},[r.ToDeviceMessageId]:(0,d.v4)()};yield g.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,{[o]:[this.baseApis.getStoredDevice(o,l)]}),yield g.encryptMessageForDevice(b.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,o,this.baseApis.getStoredDevice(o,l),p);const y={[o]:{[l]:b}};u.logger.info(`Sending ${h.name} secret for ${l}`),this.baseApis.sendToDevice("m.room.encrypted",y)}else u.logger.info(`Request denied for ${h.name} secret for ${l}`)}})}onSecretReceived(n){if(n.getSender()!==this.baseApis.getUserId())return;if(!g.isOlmEncrypted(n))return void u.logger.error("secret event not properly encrypted");const o=n.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(g.OLM_ALGORITHM,n.getSenderKey()||"")!==n.getSender())return void u.logger.error("sending device does not belong to the user it claims to be from");u.logger.log("got secret share for request",o.request_id);const l=this.requests.get(o.request_id);if(l){const e=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(g.OLM_ALGORITHM,n.getSenderKey());if(!e)return void u.logger.log("secret share from unknown device with key",n.getSenderKey());if(!l.devices.includes(e.deviceId))return void u.logger.log("unsolicited secret share from device",e.deviceId);if(!this.baseApis.crypto.checkDeviceInfoTrust(n.getSender(),e).isVerified())return void u.logger.log("secret share from unverified device");u.logger.log(`Successfully received secret ${l.name} from ${e.deviceId}`),l.deferred.resolve(o.secret)}}getSecretStorageKey(n,o){return _(this,void 0,void 0,function*(){if(!this.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const h=yield this.cryptoCallbacks.getSecretStorageKey({keys:n},o);if(!h)throw new Error("getSecretStorageKey callback returned falsey");if(h.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[l,e]=h;if(!n[l])throw new Error("App returned unknown key from getSecretStorageKey!");if(n[l].algorithm===a.SECRET_STORAGE_ALGORITHM_V1_AES)return[l,{encrypt:function(b){return(0,v.encryptAES)(b,e,o)},decrypt:function(b){return(0,v.decryptAES)(b,e,o)}}];throw new Error("Unknown key type: "+n[l].algorithm)})}}},{"../@types/event":299,"../client":313,"../logger":365,"../randomstring":388,"../utils":402,"./aes":323,"./olmlib":335,uuid:287}],323:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(c,i,r,s){return new(r||(r=Promise))(function(n,o){function h(p){try{e(s.next(p))}catch(b){o(b)}}function l(p){try{e(s.throw(p))}catch(b){o(b)}}function e(p){p.done?n(p.value):function t(n){return n instanceof r?n:new r(function(o){o(n)})}(p.value).then(h,l)}e((s=s.apply(c,i||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.calculateKeyCheck=a.decryptAES=a.encryptAES=void 0;const I=m("./olmlib"),E=m("./crypto"),_=new Uint8Array(8);function d(c,i,r,s){return R(this,void 0,void 0,function*(){let t;s?t=(0,I.decodeBase64)(s):(t=new Uint8Array(16),E.crypto.getRandomValues(t),t[8]&=127);const[n,o]=yield g(i,r),h=(new E.TextEncoder).encode(c),l=yield E.subtleCrypto.encrypt({name:"AES-CTR",counter:t,length:64},n,h),e=yield E.subtleCrypto.sign({name:"HMAC"},o,l);return{iv:(0,I.encodeBase64)(t),ciphertext:(0,I.encodeBase64)(l),mac:(0,I.encodeBase64)(e)}})}function g(c,i){return R(this,void 0,void 0,function*(){const r=yield E.subtleCrypto.importKey("raw",c,{name:"HKDF"},!1,["deriveBits"]),s=yield E.subtleCrypto.deriveBits({name:"HKDF",salt:_,info:(new E.TextEncoder).encode(i),hash:"SHA-256"},r,512),t=s.slice(0,32),n=s.slice(32),o=E.subtleCrypto.importKey("raw",t,{name:"AES-CTR"},!1,["encrypt","decrypt"]),h=E.subtleCrypto.importKey("raw",n,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,h])})}a.encryptAES=d,a.decryptAES=function u(c,i,r){return R(this,void 0,void 0,function*(){const[s,t]=yield g(i,r),n=(0,I.decodeBase64)(c.ciphertext);if(!(yield E.subtleCrypto.verify({name:"HMAC"},t,(0,I.decodeBase64)(c.mac),n)))throw new Error(`Error decrypting secret ${r}: bad MAC`);const o=yield E.subtleCrypto.decrypt({name:"AES-CTR",counter:(0,I.decodeBase64)(c.iv),length:64},s,n);return(new TextDecoder).decode(new Uint8Array(o))})};a.calculateKeyCheck=function v(c,i){return d("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",c,"",i)}},{"./crypto":330,"./olmlib":335}],324:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(f,v,c,i){return new(c||(c=Promise))(function(s,t){function n(l){try{h(i.next(l))}catch(e){t(e)}}function o(l){try{h(i.throw(l))}catch(e){t(e)}}function h(l){l.done?s(l.value):function r(s){return s instanceof c?s:new c(function(t){t(s)})}(l.value).then(n,o)}h((i=i.apply(f,v||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.registerAlgorithm=a.UnknownDeviceError=a.DecryptionError=a.DecryptionAlgorithm=a.EncryptionAlgorithm=a.DECRYPTION_CLASSES=a.ENCRYPTION_CLASSES=void 0,a.ENCRYPTION_CLASSES=new Map,a.DECRYPTION_CLASSES=new Map,a.EncryptionAlgorithm=class I{constructor(v){this.userId=v.userId,this.deviceId=v.deviceId,this.crypto=v.crypto,this.olmDevice=v.olmDevice,this.baseApis=v.baseApis,this.roomId=v.roomId}prepareToEncrypt(v){}onRoomMembership(v,c,i){}},a.DecryptionAlgorithm=class E{constructor(v){this.userId=v.userId,this.crypto=v.crypto,this.olmDevice=v.olmDevice,this.baseApis=v.baseApis,this.roomId=v.roomId}onRoomKeyEvent(v){return R(this,void 0,void 0,function*(){})}importRoomKey(v,c){return R(this,void 0,void 0,function*(){})}hasKeysForKeyRequest(v){return Promise.resolve(!1)}shareKeysWithDevice(v){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}retryDecryptionFromSender(v){return R(this,void 0,void 0,function*(){return!1})}};class _ extends Error{constructor(v,c,i){super(c),this.code=v,this.code=v,this.name="DecryptionError",this.detailedString=function d(f,v){let c=f.name+"[msg: "+f.message;return v&&(c+=", "+Object.keys(v).map(i=>i+": "+v[i]).join(", ")),c+="]",c}(this,i)}}a.DecryptionError=_;class u extends Error{constructor(v,c,i){super(v),this.devices=c,this.event=i,this.name="UnknownDeviceError",this.devices=c}}a.UnknownDeviceError=u,a.registerAlgorithm=function g(f,v,c){a.ENCRYPTION_CLASSES.set(f,v),a.DECRYPTION_CLASSES.set(f,c)}},{}],325:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(E,_,d,u){void 0===u&&(u=d);var g=Object.getOwnPropertyDescriptor(_,d);(!g||("get"in g?!_.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return _[d]}}),Object.defineProperty(E,u,g)}:function(E,_,d,u){void 0===u&&(u=d),E[u]=_[d]}),I=this&&this.__exportStar||function(E,_){for(var d in E)"default"!==d&&!Object.prototype.hasOwnProperty.call(_,d)&&R(_,E,d)};Object.defineProperty(a,"__esModule",{value:!0}),m("./olm"),m("./megolm"),I(m("./base"),a)},{"./base":324,"./megolm":326,"./olm":327}],326:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(h,l,e,p){void 0===p&&(p=e);var b=Object.getOwnPropertyDescriptor(l,e);(!b||("get"in b?!l.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return l[e]}}),Object.defineProperty(h,p,b)}:function(h,l,e,p){void 0===p&&(p=e),h[p]=l[e]}),I=this&&this.__setModuleDefault||(Object.create?function(h,l){Object.defineProperty(h,"default",{enumerable:!0,value:l})}:function(h,l){h.default=l}),E=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var l={};if(null!=h)for(var e in h)"default"!==e&&Object.prototype.hasOwnProperty.call(h,e)&&R(l,h,e);return I(l,h),l},_=this&&this.__awaiter||function(h,l,e,p){return new(e||(e=Promise))(function(y,w){function x(z){try{J(p.next(z))}catch(M){w(M)}}function B(z){try{J(p.throw(z))}catch(M){w(M)}}function J(z){z.done?y(z.value):function b(y){return y instanceof e?y:new e(function(w){w(y)})}(z.value).then(x,B)}J((p=p.apply(h,l||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MegolmDecryption=a.MegolmEncryption=a.isRoomSharedHistory=void 0;const d=m("uuid"),u=m("../../logger"),g=E(m("../olmlib")),f=m("./base"),v=m("../OlmDevice"),c=m("../../@types/event"),i=m("../OutgoingRoomKeyRequestManager");function r(h){var l,e;const b=null===(e=(null===(l=h?.currentState)||void 0===l?void 0:l.getStateEvents("m.room.history_visibility",""))?.getContent())||void 0===e?void 0:e.history_visibility;return["world_readable","shared"].includes(b)}a.isRoomSharedHistory=r;class s{constructor(l,e=!1){this.sessionId=l,this.sharedHistory=e,this.useCount=0,this.sharedWithDevices={},this.blockedDevicesNotified={},this.creationTime=(new Date).getTime()}needsRotation(l,e){const p=(new Date).getTime()-this.creationTime;return(this.useCount>=l||p>=e)&&(u.logger.log("Rotating megolm session after "+this.useCount+" messages, "+p+"ms"),!0)}markSharedWithDevice(l,e,p,b){this.sharedWithDevices[l]||(this.sharedWithDevices[l]={}),this.sharedWithDevices[l][e]={deviceKey:p,messageIndex:b}}markNotifiedBlockedDevice(l,e){this.blockedDevicesNotified[l]||(this.blockedDevicesNotified[l]={}),this.blockedDevicesNotified[l][e]=!0}sharedWithTooManyDevices(l){for(const e in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(e)){if(!l.hasOwnProperty(e))return u.logger.log("Starting new megolm session because we shared with "+e),!0;for(const p in this.sharedWithDevices[e])if(this.sharedWithDevices[e].hasOwnProperty(p)&&!l[e].hasOwnProperty(p))return u.logger.log("Starting new megolm session because we shared with "+e+":"+p),!0}return!1}}class t extends f.EncryptionAlgorithm{constructor(l){var e,p,b,y;super(l),this.setupPromise=Promise.resolve(null),this.outboundSessions={},this.roomId=l.roomId,this.sessionRotationPeriodMsgs=null!==(p=null===(e=l.config)||void 0===e?void 0:e.rotation_period_msgs)&&void 0!==p?p:100,this.sessionRotationPeriodMs=null!==(y=null===(b=l.config)||void 0===b?void 0:b.rotation_period_ms)&&void 0!==y?y:6048e5}ensureOutboundSession(l,e,p,b=!1){return _(this,void 0,void 0,function*(){const w=this.setupPromise.then(x=>_(this,void 0,void 0,function*(){const B=r(l),J=yield this.prepareSession(e,B,x);return yield this.shareSession(e,B,b,p,J),J}));return this.setupPromise=w.catch(x=>(u.logger.error(`Failed to setup outbound session in ${this.roomId}`,x),null)),w})}prepareSession(l,e,p){return _(this,void 0,void 0,function*(){return p&&e!==p.sharedHistory&&(p=null),p?.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(u.logger.log("Starting new megolm session because we need to rotate."),p=null),p?.sharedWithTooManyDevices(l)&&(p=null),p||(u.logger.log(`Starting new megolm session for room ${this.roomId}`),p=yield this.prepareNewSession(e),u.logger.log(`Started new megolm session ${p.sessionId} for room ${this.roomId}`),this.outboundSessions[p.sessionId]=p),p})}shareSession(l,e,p,b,y){return _(this,void 0,void 0,function*(){const w={};for(const[M,L]of Object.entries(l))for(const[j,C]of Object.entries(L))C.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(!y.sharedWithDevices[M]||void 0===y.sharedWithDevices[M][j])&&(w[M]=w[M]||[],w[M].push(C));const x=this.olmDevice.getOutboundGroupSessionKey(y.sessionId),B={type:"m.room_key",content:{algorithm:g.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:y.sessionId,session_key:x.key,chain_index:x.chain_index,"org.matrix.msc3061.shared_history":e}},[J,z]=yield g.getExistingOlmSessions(this.olmDevice,this.baseApis,w);yield Promise.all([(()=>_(this,void 0,void 0,function*(){u.logger.debug(`Sharing keys with existing Olm sessions in ${this.roomId}`,z),yield this.shareKeyWithOlmSessions(y,x,B,z),u.logger.debug(`Shared keys with existing Olm sessions in ${this.roomId}`)}))(),(()=>_(this,void 0,void 0,function*(){u.logger.debug(`Sharing keys (start phase 1) with new Olm sessions in ${this.roomId}`,J);const M=[],L=Date.now(),j=[];yield this.shareKeyWithDevices(y,x,B,J,M,p?1e4:2e3,j),u.logger.debug(`Shared keys (end phase 1) with new Olm sessions in ${this.roomId}`),!p&&Date.now()-L<1e4?_(this,void 0,void 0,function*(){const C={},F=new Set;for(const N of j)F.add(N);const V=[];for(const{userId:N,deviceInfo:T}of M){const S=N.slice(N.indexOf(":")+1);F.has(S)?(C[N]=C[N]||[],C[N].push(T)):V.push({userId:N,deviceInfo:T})}u.logger.debug(`Sharing keys (start phase 2) with new Olm sessions in ${this.roomId}`),yield this.shareKeyWithDevices(y,x,B,C,V,3e4),u.logger.debug(`Shared keys (end phase 2) with new Olm sessions in ${this.roomId}`),yield this.notifyFailedOlmDevices(y,x,V)}):yield this.notifyFailedOlmDevices(y,x,M),u.logger.debug(`Shared keys (all phases done) with new Olm sessions in ${this.roomId}`)}))(),(()=>_(this,void 0,void 0,function*(){u.logger.debug(`There are ${Object.entries(b).length} blocked devices in ${this.roomId}`,Object.entries(b)),u.logger.debug(`Notifying newly blocked devices in ${this.roomId}`);const M={};let L=0;for(const[j,C]of Object.entries(b))for(const[F,V]of Object.entries(C))(!y.blockedDevicesNotified[j]||void 0===y.blockedDevicesNotified[j][F])&&(M[j]=M[j]||{},M[j][F]={device:V},L++);yield this.notifyBlockedDevices(y,M),u.logger.debug(`Notified ${L} newly blocked devices in ${this.roomId}`,M)}))()])})}prepareNewSession(l){return _(this,void 0,void 0,function*(){const e=this.olmDevice.createOutboundGroupSession(),p=this.olmDevice.getOutboundGroupSessionKey(e);return yield this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],e,p.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:l}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,e),new s(e,l)})}getDevicesWithoutSessions(l,e,p=[]){for(const[b,y]of Object.entries(e)){const w=l[b];for(const x of y){const B=x.deviceId;w[B].sessionId||(p.push({userId:b,deviceInfo:x}),delete w[B])}}return p}splitDevices(l){let p=[];const b=[p];for(const[y,w]of Object.entries(l)){for(const x of Object.values(w))p.push({userId:y,deviceInfo:x.device});p.length>20&&(p=[],b.push(p))}return 0===p.length&&b.pop(),b}encryptAndSendKeysToDevices(l,e,p,b){return this.crypto.encryptAndSendToDevices(p,b).then(()=>{for(const y of p)l.markSharedWithDevice(y.userId,y.deviceInfo.deviceId,y.deviceInfo.getIdentityKey(),e)}).catch(y=>{throw u.logger.error("failed to encryptAndSendToDevices",y),y})}sendBlockedNotificationsToDevices(l,e,p){return _(this,void 0,void 0,function*(){const b={};for(const y of e){const w=y.userId,x=y.deviceInfo,J=x.deviceInfo.deviceId,z=Object.assign(Object.assign({},p),{code:x.code,reason:x.reason,[c.ToDeviceMessageId]:(0,d.v4)()});"m.no_olm"===z.code&&(delete z.room_id,delete z.session_id),b[w]||(b[w]={}),b[w][J]=z}yield this.baseApis.sendToDevice("m.room_key.withheld",b);for(const y of Object.keys(b))for(const w of Object.keys(b[y]))l.markNotifiedBlockedDevice(y,w)})}reshareKeyWithDevice(l,e,p,b){return _(this,void 0,void 0,function*(){const y=this.outboundSessions[e];if(!y)return void u.logger.debug(`megolm session ${l}|${e} not found: not re-sharing keys`);if(void 0===y.sharedWithDevices[p])return void u.logger.debug(`megolm session ${l}|${e} never shared with user ${p}`);const w=y.sharedWithDevices[p][b.deviceId];if(void 0===w)return void u.logger.debug(`megolm session ${l}|${e} never shared with device ${p}:${b.deviceId}`);if(w.deviceKey!==b.getIdentityKey())return void u.logger.warn(`Megolm session ${l}|${e} has been shared with device ${b.deviceId} but with identity key ${w.deviceKey}. Key is now ${b.getIdentityKey()}!`);const x=yield this.olmDevice.getInboundGroupSessionKey(this.roomId,l,e,w.messageIndex);if(!x)return void u.logger.warn(`No inbound session key found for megolm session ${l}|${e}: not re-sharing keys`);yield g.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[p]:[b]});const B={type:"m.forwarded_room_key",content:{algorithm:g.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:e,session_key:x.key,chain_index:x.chain_index,sender_key:l,sender_claimed_ed25519_key:x.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:x.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":x.shared_history||!1}},J={algorithm:g.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,d.v4)()};yield g.encryptMessageForDevice(J.ciphertext,this.userId,this.deviceId,this.olmDevice,p,b,B),yield this.baseApis.sendToDevice("m.room.encrypted",{[p]:{[b.deviceId]:J}}),u.logger.debug(`Re-shared key for megolm session ${l}|${e} with ${p}:${b.deviceId}`)})}shareKeyWithDevices(l,e,p,b,y,w,x){var B;return _(this,void 0,void 0,function*(){u.logger.debug(`Ensuring Olm sessions for devices in ${this.roomId}`);const J=yield g.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,b,!1,w,x,null===(B=u.logger.withPrefix)||void 0===B?void 0:B.call(u.logger,`[${this.roomId}]`));u.logger.debug(`Ensured Olm sessions for devices in ${this.roomId}`),this.getDevicesWithoutSessions(J,b,y),u.logger.debug(`Sharing keys with newly created Olm sessions in ${this.roomId}`),yield this.shareKeyWithOlmSessions(l,e,p,J),u.logger.debug(`Shared keys with newly created Olm sessions in ${this.roomId}`)})}shareKeyWithOlmSessions(l,e,p,b){return _(this,void 0,void 0,function*(){const y=this.splitDevices(b);for(let w=0;w<y.length;w++){const x=`megolm keys for ${l.sessionId} in ${this.roomId} (slice ${w+1}/${y.length})`;try{u.logger.debug(`Sharing ${x}`,y[w].map(B=>`${B.userId}/${B.deviceInfo.deviceId}`)),yield this.encryptAndSendKeysToDevices(l,e.chain_index,y[w],p),u.logger.debug(`Shared ${x}`)}catch(B){throw u.logger.error(`Failed to share ${x}`),B}}})}notifyFailedOlmDevices(l,e,p){return _(this,void 0,void 0,function*(){u.logger.debug(`Notifying ${p.length} devices we failed to create Olm sessions in ${this.roomId}`);for(const{userId:w,deviceInfo:x}of p)l.markSharedWithDevice(w,x.deviceId,x.getIdentityKey(),e.chain_index);const b=yield this.olmDevice.filterOutNotifiedErrorDevices(p);u.logger.debug(`Need to notify ${b.length} failed devices which haven't been notified before in ${this.roomId}`);const y={};for(const{userId:w,deviceInfo:x}of b)y[w]=y[w]||{},y[w][x.deviceId]={device:{code:"m.no_olm",reason:v.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:x}};yield this.notifyBlockedDevices(l,y),u.logger.debug(`Notified ${b.length} devices we failed to create Olm sessions in ${this.roomId}`)})}notifyBlockedDevices(l,e){return _(this,void 0,void 0,function*(){const p={room_id:this.roomId,session_id:l.sessionId,algorithm:g.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},b=this.splitDevices(e);for(let y=0;y<b.length;y++)try{yield this.sendBlockedNotificationsToDevices(l,b[y],p),u.logger.log(`Completed blacklist notification for ${l.sessionId} in ${this.roomId} (slice ${y+1}/${b.length})`)}catch(w){throw u.logger.log(`blacklist notification for ${l.sessionId} in ${this.roomId} (slice ${y+1}/${b.length}) failed`),w}})}prepareToEncrypt(l){if(null==this.encryptionPreparation)u.logger.debug(`Preparing to encrypt events for ${this.roomId}`),this.encryptionPreparation={startTime:Date.now(),promise:(()=>_(this,void 0,void 0,function*(){try{u.logger.debug(`Getting devices in ${this.roomId}`);const[e,p]=yield this.getDevicesInRoom(l);this.crypto.globalErrorOnUnknownDevices&&this.removeUnknownDevices(e),u.logger.debug(`Ensuring outbound session in ${this.roomId}`),yield this.ensureOutboundSession(l,e,p,!0),u.logger.debug(`Ready to encrypt events for ${this.roomId}`)}catch(e){u.logger.error(`Failed to prepare to encrypt events for ${this.roomId}`,e)}finally{delete this.encryptionPreparation}}))()};else{const e=Date.now()-this.encryptionPreparation.startTime;u.logger.debug(`Already started preparing to encrypt for ${this.roomId} ${e} ms ago, skipping`)}}encryptMessage(l,e,p){return _(this,void 0,void 0,function*(){if(u.logger.log(`Starting to encrypt event for ${this.roomId}`),null!=this.encryptionPreparation)try{yield this.encryptionPreparation.promise}catch{}const b=this.isVerificationEvent(e,p),[y,w]=yield this.getDevicesInRoom(l,b);this.crypto.globalErrorOnUnknownDevices&&this.checkForUnknownDevices(y);const x=yield this.ensureOutboundSession(l,y,w),J=this.olmDevice.encryptGroupMessage(x.sessionId,JSON.stringify({room_id:this.roomId,type:e,content:p})),z={algorithm:g.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:J,session_id:x.sessionId,device_id:this.deviceId};return x.useCount++,z})}isVerificationEvent(l,e){switch(l){case c.EventType.KeyVerificationCancel:case c.EventType.KeyVerificationDone:case c.EventType.KeyVerificationMac:case c.EventType.KeyVerificationStart:case c.EventType.KeyVerificationKey:case c.EventType.KeyVerificationReady:case c.EventType.KeyVerificationAccept:return!0;case c.EventType.RoomMessage:return e.msgtype===c.MsgType.KeyVerificationRequest;default:return!1}}forceDiscardSession(){this.setupPromise=this.setupPromise.then(()=>null)}checkForUnknownDevices(l){const e={};if(Object.keys(l).forEach(p=>{Object.keys(l[p]).forEach(b=>{const y=l[p][b];y.isUnverified()&&!y.isKnown()&&(e[p]||(e[p]={}),e[p][b]=y)})}),Object.keys(e).length)throw new f.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",e)}removeUnknownDevices(l){for(const[e,p]of Object.entries(l)){for(const[b,y]of Object.entries(p))y.isUnverified()&&!y.isKnown()&&delete p[b];0===Object.keys(p).length&&delete l[e]}}getDevicesInRoom(l,e=!1){return _(this,void 0,void 0,function*(){const b=(yield l.getEncryptionTargetMembers()).map(function(J){return J.userId});let y=this.crypto.globalBlacklistUnverifiedDevices;const w=l.getBlacklistUnverifiedDevices();"boolean"==typeof w&&(y=w);const x=yield this.crypto.downloadKeys(b,!1),B={};for(const J in x){if(!x.hasOwnProperty(J))continue;const z=x[J];for(const M in z){if(!z.hasOwnProperty(M))continue;const L=this.crypto.checkDeviceTrust(J,M);if(z[M].isBlocked()||!L.isVerified()&&y&&!e){B[J]||(B[J]={});const j=z[M].isBlocked();B[J][M]={code:j?"m.blacklisted":"m.unverified",reason:v.WITHHELD_MESSAGES[j?"m.blacklisted":"m.unverified"],deviceInfo:z[M]},delete z[M]}}}return[x,B]})}}a.MegolmEncryption=t;class n extends f.DecryptionAlgorithm{constructor(l){super(l),this.pendingEvents=new Map,this.olmlib=g,this.roomId=l.roomId}decryptEvent(l){return _(this,void 0,void 0,function*(){const e=l.getWireContent();if(!e.sender_key||!e.session_id||!e.ciphertext)throw new f.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let p;this.addEventToPendingList(l);try{p=yield this.olmDevice.decryptGroupMessage(l.getRoomId(),e.sender_key,e.session_id,e.ciphertext,l.getId(),l.getTs())}catch(y){if("DecryptionError"===y.name)throw y;let w="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw"OLM.UNKNOWN_MESSAGE_INDEX"===y?.message&&(this.requestKeysForEvent(l),w="OLM_UNKNOWN_MESSAGE_INDEX"),new f.DecryptionError(w,y?y.toString():"Unknown Error: Error is undefined",{session:e.sender_key+"|"+e.session_id})}if(null===p){this.crypto.backupManager.queryKeyBackupRateLimited(l.getRoomId(),e.session_id).catch(()=>{}),this.requestKeysForEvent(l);const y=yield this.olmDevice.sessionMayHaveProblems(e.sender_key,l.getTs()-12e4);if(y){u.logger.info(`When handling UISI from ${l.getSender()} (sender key ${e.sender_key}): recent session problem with that sender: ${y}`);let w=o[y.type]||o.unknown;throw y.fixed&&(w+=" Trying to create a new secure channel and re-requesting the keys."),new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",w,{session:e.sender_key+"|"+e.session_id})}throw new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:e.sender_key+"|"+e.session_id})}p.untrusted||this.removeEventFromPendingList(l);const b=JSON.parse(p.result);if(b.room_id!==l.getRoomId())throw new f.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+b.room_id);return{clearEvent:b,senderCurve25519Key:p.senderKey,claimedEd25519Key:p.keysClaimed.ed25519,forwardingCurve25519KeyChain:p.forwardingCurve25519KeyChain,untrusted:p.untrusted}})}requestKeysForEvent(l){const e=l.getWireContent(),p=l.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:l.getRoomId(),algorithm:e.algorithm,sender_key:e.sender_key,session_id:e.session_id},p)}addEventToPendingList(l){var e;const p=l.getWireContent(),b=p.sender_key,y=p.session_id;this.pendingEvents.has(b)||this.pendingEvents.set(b,new Map);const w=this.pendingEvents.get(b);w.has(y)||w.set(y,new Set),null===(e=w.get(y))||void 0===e||e.add(l)}removeEventFromPendingList(l){const e=l.getWireContent(),p=e.sender_key,b=e.session_id,y=this.pendingEvents.get(p),w=y?.get(b);w&&(w.delete(l),0===w.size&&y.delete(b),0===y.size&&this.pendingEvents.delete(p))}onRoomKeyEvent(l){var e,p,b,y;return _(this,void 0,void 0,function*(){const w=l.getContent();let z,x=l.getSenderKey(),B=[],J=!1;const M={};if(w.room_id&&w.session_key&&w.session_id&&w.algorithm)if(g.isOlmEncrypted(l)){if(w["org.matrix.msc3061.shared_history"]&&(M.sharedHistory=!0),"m.forwarded_room_key"==l.getType()){const L=this.crypto.deviceList.getDeviceByIdentityKey(g.OLM_ALGORITHM,x);if(this.baseApis.crypto.deviceList.getUserByIdentityKey(g.OLM_ALGORITHM,x)!==l.getSender())return void u.logger.error("sending device does not belong to the user it claims to be from");const F=(L?yield this.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(l.getSender(),L.deviceId,[i.RoomKeyRequestState.Sent]):[]).some(D=>D.requestBody.room_id===w.room_id&&D.requestBody.session_id===w.session_id),V=this.baseApis.getRoom(w.room_id),N=null===(e=V?.getMember(this.userId))||void 0===e?void 0:e.events.member,T=N?.getSender()===l.getSender()||(null===(p=N?.getUnsigned())||void 0===p?void 0:p.prev_sender)===l.getSender()&&"invite"===(null===(b=N?.getPrevContent())||void 0===b?void 0:b.membership),S=l.getSender()===this.baseApis.getUserId();if(!F&&!S){if(!M.sharedHistory)return void u.logger.log("forwarded key not shared history - ignoring");if(V&&!T)return void u.logger.log("forwarded key not from inviter or from us - ignoring")}if(J=!0,B=Array.isArray(w.forwarding_curve25519_key_chain)?w.forwarding_curve25519_key_chain:[],B=B.slice(),B.push(x),!w.sender_key)return void u.logger.error("forwarded_room_key event is missing sender_key field");const U=w.sender_claimed_ed25519_key;if(!U)return void u.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");if(z={ed25519:U},!V){const D={senderId:l.getSender(),senderKey:w.sender_key,sessionId:w.session_id,sessionKey:w.session_key,keysClaimed:z,forwardingCurve25519KeyChain:B};return void(yield this.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],Q=>this.crypto.cryptoStore.addParkedSharedHistory(w.room_id,D,Q),u.logger.withPrefix("[addParkedSharedHistory]")))}const W=null!==(y=this.crypto.deviceList.getDeviceByIdentityKey(g.OLM_ALGORITHM,x))&&void 0!==y?y:void 0,k=this.crypto.checkDeviceInfoTrust(l.getSender(),W);if(S&&!k.isVerified())return;M.untrusted=!0,x=w.sender_key}else z=l.getKeysClaimed();w["org.matrix.msc3061.shared_history"]&&(M.sharedHistory=!0);try{yield this.olmDevice.addInboundGroupSession(w.room_id,x,B,w.session_id,w.session_key,z,J,M),(yield this.retryDecryption(x,w.session_id,!M.untrusted))&&this.crypto.cancelRoomKeyRequest({algorithm:w.algorithm,room_id:w.room_id,session_id:w.session_id,sender_key:x}),yield this.crypto.backupManager.backupGroupSession(x,w.session_id)}catch(L){u.logger.error(`Error handling m.room_key_event: ${L}`)}}else u.logger.error("key event not properly encrypted");else u.logger.error("key event is missing fields")})}onRoomKeyWithheldEvent(l){return _(this,void 0,void 0,function*(){const e=l.getContent(),p=e.sender_key;if("m.no_olm"===e.code){const b=l.getSender();if(u.logger.warn(`${b}:${p} was unable to establish an olm session with us`),yield this.olmDevice.getSessionIdForDevice(p))return u.logger.debug("New session already created.  Not creating a new one."),yield this.olmDevice.recordSessionProblem(p,"no_olm",!0),void this.retryDecryptionFromSender(p);let y=this.crypto.deviceList.getDeviceByIdentityKey(e.algorithm,p);if(!y&&(yield this.crypto.downloadKeys([b],!1),y=this.crypto.deviceList.getDeviceByIdentityKey(e.algorithm,p),!y))return u.logger.info("Couldn't find device for identity key "+p+": not establishing session"),yield this.olmDevice.recordSessionProblem(p,"no_olm",!1),void this.retryDecryptionFromSender(p);yield g.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[b]:[y]},!1);const w={algorithm:g.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,d.v4)()};yield g.encryptMessageForDevice(w.ciphertext,this.userId,void 0,this.olmDevice,b,y,{type:"m.dummy"}),yield this.olmDevice.recordSessionProblem(p,"no_olm",!0),this.retryDecryptionFromSender(p),yield this.baseApis.sendToDevice("m.room.encrypted",{[b]:{[y.deviceId]:w}})}else yield this.olmDevice.addInboundGroupSessionWithheld(e.room_id,p,e.session_id,e.code,e.reason)})}hasKeysForKeyRequest(l){const e=l.requestBody;return this.olmDevice.hasInboundSessionKeys(e.room_id,e.sender_key,e.session_id)}shareKeysWithDevice(l){const e=l.userId,p=l.deviceId,b=this.crypto.getStoredDevice(e,p),y=l.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[e]:[b]}).then(w=>w[e][p].sessionId?(u.logger.log("sharing keys for session "+y.sender_key+"|"+y.session_id+" with device "+e+":"+p),this.buildKeyForwardingMessage(y.room_id,y.sender_key,y.session_id)):null).then(w=>{const x={algorithm:g.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,d.v4)()};return this.olmlib.encryptMessageForDevice(x.ciphertext,this.userId,void 0,this.olmDevice,e,b,w).then(()=>this.baseApis.sendToDevice("m.room.encrypted",{[e]:{[p]:x}}))})}buildKeyForwardingMessage(l,e,p){return _(this,void 0,void 0,function*(){const b=yield this.olmDevice.getInboundGroupSessionKey(l,e,p);return{type:"m.forwarded_room_key",content:{algorithm:g.MEGOLM_ALGORITHM,room_id:l,sender_key:e,sender_claimed_ed25519_key:b.sender_claimed_ed25519_key,session_id:p,session_key:b.key,chain_index:b.chain_index,forwarding_curve25519_key_chain:b.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":b.shared_history||!1}}})}importRoomKey(l,{untrusted:e,source:p}={}){const b={};return(e||l.untrusted)&&(b.untrusted=!0),l["org.matrix.msc3061.shared_history"]&&(b.sharedHistory=!0),this.olmDevice.addInboundGroupSession(l.room_id,l.sender_key,l.forwarding_curve25519_key_chain,l.session_id,l.session_key,l.sender_claimed_keys,!0,b).then(()=>{"backup"!==p&&this.crypto.backupManager.backupGroupSession(l.sender_key,l.session_id).catch(y=>{u.logger.log("Failed to back up megolm session",y)}),this.retryDecryption(l.sender_key,l.session_id,!b.untrusted)})}retryDecryption(l,e,p){var b;return _(this,void 0,void 0,function*(){const y=this.pendingEvents.get(l);if(!y)return!0;const w=y.get(e);return!(w&&(u.logger.debug("Retrying decryption on events",[...w]),yield Promise.all([...w].map(x=>_(this,void 0,void 0,function*(){try{yield x.attemptDecryption(this.crypto,{isRetry:!0,forceRedecryptIfUntrusted:p})}catch{}}))),null!==(b=this.pendingEvents.get(l))&&void 0!==b&&b.has(e)))})}retryDecryptionFromSender(l){return _(this,void 0,void 0,function*(){const e=this.pendingEvents.get(l);return!e||(this.pendingEvents.delete(l),yield Promise.all([...e].map(([p,b])=>_(this,void 0,void 0,function*(){yield Promise.all([...b].map(y=>_(this,void 0,void 0,function*(){try{yield y.attemptDecryption(this.crypto)}catch{}})))}))),!this.pendingEvents.has(l))})}sendSharedHistoryInboundSessions(l){return _(this,void 0,void 0,function*(){yield g.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,l);const e=yield this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);u.logger.log(`Sharing history in ${this.roomId} with users ${Object.keys(l)}`,e.map(([p,b])=>`${p}|${b}`));for(const[p,b]of e){const y=yield this.buildKeyForwardingMessage(this.roomId,p,b),w=[],x={};for(const[B,J]of Object.entries(l)){x[B]={};for(const z of J){const M={algorithm:g.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,d.v4)()};x[B][z.deviceId]=M,w.push(g.encryptMessageForDevice(M.ciphertext,this.userId,void 0,this.olmDevice,B,z,y))}}yield Promise.all(w);for(const B of Object.keys(x)){for(const J of Object.keys(x[B]))0===Object.keys(x[B][J].ciphertext).length&&(u.logger.log("No ciphertext for device "+B+":"+J+": pruning"),delete x[B][J]);0===Object.keys(x[B]).length&&(u.logger.log("Pruned all devices for user "+B),delete x[B])}if(0===Object.keys(x).length)return void u.logger.log("No users left to send to: aborting");yield this.baseApis.sendToDevice("m.room.encrypted",x)}})}}a.MegolmDecryption=n;const o={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,f.registerAlgorithm)(g.MEGOLM_ALGORITHM,t,n)},{"../../@types/event":299,"../../logger":365,"../OlmDevice":319,"../OutgoingRoomKeyRequestManager":320,"../olmlib":335,"./base":324,uuid:287}],327:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(r,s,t,n){void 0===n&&(n=t);var o=Object.getOwnPropertyDescriptor(s,t);(!o||("get"in o?!s.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return s[t]}}),Object.defineProperty(r,n,o)}:function(r,s,t,n){void 0===n&&(n=t),r[n]=s[t]}),I=this&&this.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),E=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var t in r)"default"!==t&&Object.prototype.hasOwnProperty.call(r,t)&&R(s,r,t);return I(s,r),s},_=this&&this.__awaiter||function(r,s,t,n){return new(t||(t=Promise))(function(h,l){function e(y){try{b(n.next(y))}catch(w){l(w)}}function p(y){try{b(n.throw(y))}catch(w){l(w)}}function b(y){y.done?h(y.value):function o(h){return h instanceof t?h:new t(function(l){l(h)})}(y.value).then(e,p)}b((n=n.apply(r,s||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const d=m("../../logger"),u=E(m("../olmlib")),g=m("../deviceinfo"),f=m("./base"),v=g.DeviceInfo.DeviceVerification;(0,f.registerAlgorithm)(u.OLM_ALGORITHM,class c extends f.EncryptionAlgorithm{constructor(){super(...arguments),this.sessionPrepared=!1,this.prepPromise=null}ensureSession(s){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(s).then(()=>this.crypto.ensureOlmSessionsForUsers(s)).then(()=>{this.sessionPrepared=!0}).finally(()=>{this.prepPromise=null}),this.prepPromise)}encryptMessage(s,t,n){return _(this,void 0,void 0,function*(){const h=(yield s.getEncryptionTargetMembers()).map(function(b){return b.userId});yield this.ensureSession(h);const l={room_id:s.roomId,type:t,content:n},e={algorithm:u.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},p=[];for(const b of h){const y=this.crypto.getStoredDevicesForUser(b)||[];for(const w of y)w.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&w.verified!=v.BLOCKED&&p.push(u.encryptMessageForDevice(e.ciphertext,this.userId,this.deviceId,this.olmDevice,b,w,l))}return Promise.all(p).then(()=>e)})}},class i extends f.DecryptionAlgorithm{decryptEvent(s){return _(this,void 0,void 0,function*(){const t=s.getWireContent(),n=t.sender_key,o=t.ciphertext;if(!o)throw new f.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in o))throw new f.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const h=o[this.olmDevice.deviceCurve25519Key];let l;try{l=yield this.decryptMessage(n,h)}catch(y){throw new f.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:n,err:y})}const e=JSON.parse(l);if(e.recipient!=this.userId)throw new f.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+e.recipient);if(e.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new f.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:e.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});yield this.crypto.deviceList.downloadKeys([s.getSender()],!1);const p=this.crypto.deviceList.getUserByIdentityKey(u.OLM_ALGORITHM,n);if(p!==s.getSender()&&null!=p)throw new f.DecryptionError("OLM_BAD_SENDER","Message claimed to be from "+s.getSender(),{real_sender:p});if(e.sender!=s.getSender())throw new f.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+e.sender,{reported_sender:s.getSender()});if(e.room_id!==s.getRoomId())throw new f.DecryptionError("OLM_BAD_ROOM","Message intended for room "+e.room_id,{reported_room:s.getRoomId()||"ROOM_ID_UNDEFINED"});return{clearEvent:e,senderCurve25519Key:n,claimedEd25519Key:(e.keys||{}).ed25519||null}})}decryptMessage(s,t){if(0!==t.type)return this.reallyDecryptMessage(s,t);{const n=this.olmDevice.olmPrekeyPromise.then(()=>this.reallyDecryptMessage(s,t));return this.olmDevice.olmPrekeyPromise=n.catch(()=>{}),n}}reallyDecryptMessage(s,t){return _(this,void 0,void 0,function*(){const n=yield this.olmDevice.getSessionIdsForDevice(s),o={};for(const l of n)try{const e=yield this.olmDevice.decryptMessage(s,l,t.type,t.body);return d.logger.log("Decrypted Olm message from "+s+" with session "+l),e}catch(e){if(yield this.olmDevice.matchesSession(s,l,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+l+": "+e.message);o[l]=e.message}if(0!==t.type)throw 0===n.length?new Error("No existing sessions"):new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(o));let h;try{h=yield this.olmDevice.createInboundSession(s,t.type,t.body)}catch(l){throw o["(new)"]=l.message,new Error("Error decrypting prekey message: "+JSON.stringify(o))}return d.logger.log("created new inbound Olm session ID "+h.session_id+" with "+s),h.payload})}})},{"../../logger":365,"../deviceinfo":332,"../olmlib":335,"./base":324}],328:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.CrossSigningKey=void 0,(I=a.CrossSigningKey||(a.CrossSigningKey={})).Master="master",I.SelfSigning="self_signing",I.UserSigning="user_signing"},{}],329:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__awaiter||function(y,w,x,B){return new(x||(x=Promise))(function(z,M){function L(F){try{C(B.next(F))}catch(V){M(V)}}function j(F){try{C(B.throw(F))}catch(V){M(V)}}function C(F){F.done?z(F.value):function J(z){return z instanceof x?z:new x(function(M){M(z)})}(F.value).then(L,j)}C((B=B.apply(y,w||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.DefaultAlgorithm=a.algorithmsByName=a.Aes256=a.Curve25519=a.BackupManager=void 0;const E=m("../client"),_=m("../logger"),d=m("./olmlib"),u=m("./key_passphrase"),g=m("../utils"),f=m("./store/indexeddb-crypto-store"),v=m("./recoverykey"),c=m("./aes"),i=m("../NamespacedValue"),r=m("./index"),s=m("./crypto"),t=m("../http-api");class h{constructor(w,x){this.baseApis=w,this.getKey=x,this.sessionLastCheckAttemptedTime={},this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(w){const x=a.algorithmsByName[w.algorithm];if(!x)throw new Error("Unknown backup algorithm: "+w.algorithm);if("object"!=typeof w.auth_data)throw new Error("Invalid backup data returned");return x.checkBackupVersion(w)}static makeAlgorithm(w,x){const B=a.algorithmsByName[w.algorithm];if(!B)throw new Error("Unknown backup algorithm");return B.init(w.auth_data,x)}enableKeyBackup(w){return I(this,void 0,void 0,function*(){this.backupInfo=w,this.algorithm&&this.algorithm.free(),this.algorithm=yield h.makeAlgorithm(w,this.getKey),this.baseApis.emit(r.CryptoEvent.KeyBackupStatus,!0),this.scheduleKeyBackupSend()})}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(r.CryptoEvent.KeyBackupStatus,!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}prepareKeyBackupVersion(w,x){return I(this,void 0,void 0,function*(){const B=x?a.algorithmsByName[x]:a.DefaultAlgorithm;if(!B)throw new Error("Unknown backup algorithm");const[J,z]=yield B.prepare(w),M=(0,v.encodeRecoveryKey)(J);return{algorithm:B.algorithmName,auth_data:z,recovery_key:M,privateKey:J}})}createKeyBackupVersion(w){return I(this,void 0,void 0,function*(){this.algorithm=yield h.makeAlgorithm(w,this.getKey)})}checkAndStart(){var w;return I(this,void 0,void 0,function*(){if(_.logger.log("Checking key backup status..."),this.baseApis.isGuest())return _.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let x;try{x=null!==(w=yield this.baseApis.getKeyBackupVersion())&&void 0!==w?w:void 0}catch(J){return _.logger.log("Error checking for active key backup",J),404===J.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const B=yield this.isKeyBackupTrusted(x);return B.usable&&!this.backupInfo?(_.logger.log(`Found usable key backup v${x.version}: enabling key backups`),yield this.enableKeyBackup(x)):!B.usable&&this.backupInfo?(_.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):B.usable||this.backupInfo?B.usable&&this.backupInfo&&(x.version!==this.backupInfo.version?(_.logger.log(`On backup version ${this.backupInfo.version} but found version ${x.version}: switching.`),this.disableKeyBackup(),yield this.enableKeyBackup(x),yield this.scheduleAllGroupSessionsForBackup()):_.logger.log(`Backup version ${x.version} still current`)):_.logger.log("No usable key backup: not enabling key backup"),{backupInfo:x,trustInfo:B}})}checkKeyBackup(){return I(this,void 0,void 0,function*(){return this.checkedForBackup=!1,this.checkAndStart()})}queryKeyBackupRateLimited(w,x){return I(this,void 0,void 0,function*(){if(!this.backupInfo)return;const B=(new Date).getTime();(!this.sessionLastCheckAttemptedTime[x]||B-this.sessionLastCheckAttemptedTime[x]>5e3)&&(this.sessionLastCheckAttemptedTime[x]=B,yield this.baseApis.restoreKeyBackupWithCache(w,x,this.backupInfo,{}))})}isKeyBackupTrusted(w){return I(this,void 0,void 0,function*(){const x={usable:!1,trusted_locally:!1,sigs:[]};if(!(w&&w.algorithm&&w.auth_data&&w.auth_data.signatures))return _.logger.info("Key backup is absent or missing required data"),x;const B=this.baseApis.getUserId(),J=yield this.baseApis.crypto.getSessionBackupPrivateKey();if(J){let M=null;try{M=yield h.makeAlgorithm(w,()=>I(this,void 0,void 0,function*(){return J})),(yield M.keyMatches(J))&&(_.logger.info("Backup is trusted locally"),x.trusted_locally=!0)}catch{}finally{M?.free()}}const z=w.auth_data.signatures[B]||{};for(const M of Object.keys(z)){const L=M.split(":");if("ed25519"!==L[0]){_.logger.log("Ignoring unknown signature type: "+L[0]);continue}const j={deviceId:L[1]},C=this.baseApis.crypto.crossSigningInfo.getId();if(C===j.deviceId){j.crossSigningId=!0;try{yield(0,d.verifySignature)(this.baseApis.crypto.olmDevice,w.auth_data,B,j.deviceId,C),j.valid=!0}catch(V){_.logger.warn("Bad signature from cross signing key "+C,V),j.valid=!1}x.sigs.push(j);continue}const F=this.baseApis.crypto.deviceList.getStoredDevice(B,j.deviceId);if(F){j.device=F,j.deviceTrust=this.baseApis.checkDeviceTrust(B,j.deviceId);try{yield(0,d.verifySignature)(this.baseApis.crypto.olmDevice,w.auth_data,B,F.deviceId,F.getFingerprint()),j.valid=!0}catch(V){_.logger.info("Bad signature from key ID "+M+" userID "+this.baseApis.getUserId()+" device ID "+F.deviceId+" fingerprint: "+F.getFingerprint(),w.auth_data,V),j.valid=!1}}else j.valid=null,_.logger.info("Ignoring signature from unknown key "+M);x.sigs.push(j)}return x.usable=x.sigs.some(M=>{var L;return M.valid&&(M.device&&(null===(L=M.deviceTrust)||void 0===L?void 0:L.isVerified())||M.crossSigningId)}),x})}scheduleKeyBackupSend(w=1e4){return I(this,void 0,void 0,function*(){if(!this.sendingBackups){this.sendingBackups=!0;try{const x=Math.random()*w;yield(0,g.sleep)(x);let B=0;for(;;){if(!this.algorithm)return;try{if(0===(yield this.backupPendingKeys(200)))return;B=0}catch(J){if(B++,_.logger.log("Key backup request failed",J),J.data&&("M_NOT_FOUND"==J.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==J.data.errcode))throw yield this.checkKeyBackup(),this.baseApis.crypto.emit(r.CryptoEvent.KeyBackupFailed,J.data.errcode),J}B&&(yield(0,g.sleep)(1e3*Math.pow(2,Math.min(B-1,4))))}}finally{this.sendingBackups=!1}}})}backupPendingKeys(w){var x;return I(this,void 0,void 0,function*(){const B=yield this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(w);if(!B.length)return 0;let J=yield this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit(r.CryptoEvent.KeyBackupSessionsRemaining,J);const z={};for(const M of B){const L=M.sessionData.room_id;void 0===z[L]&&(z[L]={sessions:{}});const j=this.baseApis.crypto.olmDevice.exportInboundGroupSession(M.senderKey,M.sessionId,M.sessionData);j.algorithm=d.MEGOLM_ALGORITHM;const C=(j.forwarding_curve25519_key_chain||[]).length,F=this.baseApis.crypto.deviceList.getUserByIdentityKey(d.MEGOLM_ALGORITHM,M.senderKey),V=null!==(x=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(d.MEGOLM_ALGORITHM,M.senderKey))&&void 0!==x?x:void 0,N=this.baseApis.crypto.checkDeviceInfoTrust(F,V).isVerified();z[L].sessions[M.sessionId]={first_message_index:j.first_known_index,forwarded_count:C,is_verified:N,session_data:yield this.algorithm.encryptSession(j)}}return yield this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:z}),yield this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(B),J=yield this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit(r.CryptoEvent.KeyBackupSessionsRemaining,J),B.length})}backupGroupSession(w,x){return I(this,void 0,void 0,function*(){yield this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:w,sessionId:x}]),this.backupInfo&&this.scheduleKeyBackupSend()})}scheduleAllGroupSessionsForBackup(){return I(this,void 0,void 0,function*(){yield this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)})}flagAllGroupSessionsForBackup(){return I(this,void 0,void 0,function*(){yield this.baseApis.crypto.cryptoStore.doTxn("readwrite",[f.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,f.IndexedDBCryptoStore.STORE_BACKUP],x=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(x,B=>{null!==B&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([B],x)})});const w=yield this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit(r.CryptoEvent.KeyBackupSessionsRemaining,w),w})}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}a.BackupManager=h;class l{constructor(w,x,B){this.authData=w,this.publicKey=x,this.getKey=B}static init(w,x){return I(this,void 0,void 0,function*(){if(!w||!("public_key"in w))throw new Error("auth_data missing required information");const B=new R.Olm.PkEncryption;return B.set_recipient_key(w.public_key),new l(w,B,x)})}static prepare(w){return I(this,void 0,void 0,function*(){const x=new R.Olm.PkDecryption;try{const B={};if(w)if(w instanceof Uint8Array)B.public_key=x.init_with_private_key(w);else{const z=yield(0,u.keyFromPassphrase)(w);B.private_key_salt=z.salt,B.private_key_iterations=z.iterations,B.public_key=x.init_with_private_key(z.key)}else B.public_key=x.generate_key();return(new R.Olm.PkEncryption).set_recipient_key(B.public_key),[x.get_private_key(),B]}finally{x.free()}})}static checkBackupVersion(w){if(!("public_key"in w.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}encryptSession(w){return I(this,void 0,void 0,function*(){const x=Object.assign({},w);return delete x.session_id,delete x.room_id,delete x.first_known_index,this.publicKey.encrypt(JSON.stringify(x))})}decryptSessions(w){return I(this,void 0,void 0,function*(){const x=yield this.getKey(),B=new R.Olm.PkDecryption;try{if(B.init_with_private_key(x)!==this.authData.public_key)throw new t.MatrixError({errcode:E.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY});const z=[];for(const[M,L]of Object.entries(w))try{const j=JSON.parse(B.decrypt(L.session_data.ephemeral,L.session_data.mac,L.session_data.ciphertext));j.session_id=M,z.push(j)}catch(j){_.logger.log("Failed to decrypt megolm session from backup",j,L)}return z}finally{B.free()}})}keyMatches(w){return I(this,void 0,void 0,function*(){const x=new R.Olm.PkDecryption;let B;try{B=x.init_with_private_key(w)}finally{x.free()}return B===this.authData.public_key})}free(){this.publicKey.free()}}a.Curve25519=l,l.algorithmName="m.megolm_backup.v1.curve25519-aes-sha2";const p=new i.UnstableValue("m.megolm_backup.v1.aes-hmac-sha2","org.matrix.msc3270.v1.aes-hmac-sha2");class b{constructor(w,x){this.authData=w,this.key=x}static init(w,x){return I(this,void 0,void 0,function*(){if(!w)throw new Error("auth_data missing");const B=yield x();if(w.mac){const{mac:J}=yield(0,c.calculateKeyCheck)(B,w.iv);if(w.mac.replace(/=+$/g,"")!==J.replace(/=+/g,""))throw new Error("Key does not match")}return new b(w,B)})}static prepare(w){return I(this,void 0,void 0,function*(){let x;const B={};if(w)if(w instanceof Uint8Array)x=new Uint8Array(w);else{const M=yield(0,u.keyFromPassphrase)(w);B.private_key_salt=M.salt,B.private_key_iterations=M.iterations,x=M.key}else x=function e(y){const w=new Uint8Array(y);return s.crypto.getRandomValues(w),w}(32);const{iv:J,mac:z}=yield(0,c.calculateKeyCheck)(x);return B.iv=J,B.mac=z,[x,B]})}static checkBackupVersion(w){if(!("iv"in w.auth_data)||!("mac"in w.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}encryptSession(w){const x=Object.assign({},w);return delete x.session_id,delete x.room_id,delete x.first_known_index,(0,c.encryptAES)(JSON.stringify(x),this.key,w.session_id)}decryptSessions(w){return I(this,void 0,void 0,function*(){const x=[];for(const[B,J]of Object.entries(w))try{const z=JSON.parse(yield(0,c.decryptAES)(J.session_data,this.key,B));z.session_id=B,x.push(z)}catch(z){_.logger.log("Failed to decrypt megolm session from backup",z,J)}return x})}keyMatches(w){return I(this,void 0,void 0,function*(){if(this.authData.mac){const{mac:x}=yield(0,c.calculateKeyCheck)(w,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===x.replace(/=+/g,"")}return!0})}free(){this.key.fill(0)}}a.Aes256=b,b.algorithmName=p.name,a.algorithmsByName={[l.algorithmName]:l,[b.algorithmName]:b},a.DefaultAlgorithm=l}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../NamespacedValue":308,"../client":313,"../http-api":358,"../logger":365,"../utils":402,"./aes":323,"./crypto":330,"./index":333,"./key_passphrase":334,"./olmlib":335,"./recoverykey":336,"./store/indexeddb-crypto-store":338}],330:[function(m,ie,a){(function(R){(function(){"use strict";var I,E,_,d,u,g,f;Object.defineProperty(a,"__esModule",{value:!0}),a.setTextEncoder=a.setCrypto=a.TextEncoder=a.subtleCrypto=a.crypto=void 0;const v=m("../logger");if(a.crypto=null===(I=R.window)||void 0===I?void 0:I.crypto,a.subtleCrypto=null!==(d=null===(_=null===(E=R.window)||void 0===E?void 0:E.crypto)||void 0===_?void 0:_.subtle)&&void 0!==d?d:null===(g=null===(u=R.window)||void 0===u?void 0:u.crypto)||void 0===g?void 0:g.webkitSubtle,a.TextEncoder=null===(f=R.window)||void 0===f?void 0:f.TextEncoder,!a.crypto)try{a.crypto=m("crypto").webcrypto}catch(r){v.logger.error("Failed to load webcrypto",r)}if(a.subtleCrypto||(a.subtleCrypto=null==a.crypto?void 0:a.crypto.subtle),!a.TextEncoder)try{a.TextEncoder=m("util").TextEncoder}catch(r){v.logger.error("Failed to load TextEncoder util",r)}a.setCrypto=function c(r){var s;a.crypto=r,a.subtleCrypto=null!==(s=r.subtle)&&void 0!==s?s:r.webkitSubtle},a.setTextEncoder=function i(r){a.TextEncoder=r}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../logger":365,crypto:78,util:285}],331:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__awaiter||function(s,t,n,o){return new(n||(n=Promise))(function(l,e){function p(w){try{y(o.next(w))}catch(x){e(x)}}function b(w){try{y(o.throw(w))}catch(x){e(x)}}function y(w){w.done?l(w.value):function h(l){return l instanceof n?l:new n(function(e){e(l)})}(w.value).then(p,b)}y((o=o.apply(s,t||[])).next())})},_=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(a,"__esModule",{value:!0}),a.DehydrationManager=a.DEHYDRATION_ALGORITHM=void 0;const d=_(m("another-json")),u=m("./olmlib"),g=m("../crypto/store/indexeddb-crypto-store"),f=m("./aes"),v=m("../logger"),c=m("../http-api");a.DEHYDRATION_ALGORITHM="org.matrix.msc2697.v1.olm.libolm_pickle";const i=6048e5;a.DehydrationManager=class r{constructor(t){this.crypto=t,this.inProgress=!1,this.getDehydrationKeyFromCache()}getDehydrationKeyFromCache(){return this.crypto.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],t=>{this.crypto.cryptoStore.getSecretStorePrivateKey(t,n=>E(this,void 0,void 0,function*(){if(n){const{key:o,keyInfo:h,deviceDisplayName:l,time:e}=n,p=I.from(this.crypto.olmDevice.pickleKey),b=yield(0,f.decryptAES)(o,p,a.DEHYDRATION_ALGORITHM);this.key=(0,u.decodeBase64)(b),this.keyInfo=h,this.deviceDisplayName=l;const y=Date.now(),w=Math.max(1,e+i-y);this.timeoutId=R.setTimeout(this.dehydrateDevice.bind(this),w)}}),"dehydration")})}setKeyAndQueueDehydration(t,n={},o){return E(this,void 0,void 0,function*(){(yield this.setKey(t,n,o))||this.dehydrateDevice()})}setKey(t,n={},o){return E(this,void 0,void 0,function*(){if(!t)return this.timeoutId&&(R.clearTimeout(this.timeoutId),this.timeoutId=void 0),yield this.crypto.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],l=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(l,"dehydration",null)}),this.key=void 0,void(this.keyInfo=void 0);let h=!!this.key&&t.length==this.key.length;for(let l=0;h&&l<t.length;l++)t[l]!=this.key[l]&&(h=!1);return h||(this.key=t,this.keyInfo=n,this.deviceDisplayName=o),h})}dehydrateDevice(){return E(this,void 0,void 0,function*(){if(this.inProgress)v.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(R.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const t=I.from(this.crypto.olmDevice.pickleKey),n=yield(0,f.encryptAES)((0,u.encodeBase64)(this.key),t,a.DEHYDRATION_ALGORITHM);yield this.crypto.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],L=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(L,"dehydration",{keyInfo:this.keyInfo,key:n,deviceDisplayName:this.deviceDisplayName,time:Date.now()})}),v.logger.log("Attempting to dehydrate device"),v.logger.log("Creating account");const o=new R.Olm.Account;o.create();const h=JSON.parse(o.identity_keys()),l=o.max_number_of_one_time_keys();o.generate_one_time_keys(l/2),o.generate_fallback_key();const e=JSON.parse(o.one_time_keys()),p=JSON.parse(o.fallback_key());o.mark_keys_as_published();const b=o.pickle(new Uint8Array(this.key)),y={algorithm:a.DEHYDRATION_ALGORITHM,account:b};this.keyInfo.passphrase&&(y.passphrase=this.keyInfo.passphrase),v.logger.log("Uploading account to server");const x=(yield this.crypto.baseApis.http.authedRequest(c.Method.Put,"/dehydrated_device",void 0,{device_data:y,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;v.logger.log("Preparing device keys",x);const B={algorithms:this.crypto.supportedAlgorithms,device_id:x,user_id:this.crypto.userId,keys:{[`ed25519:${x}`]:h.ed25519,[`curve25519:${x}`]:h.curve25519}},J=o.sign(d.default.stringify(B));B.signatures={[this.crypto.userId]:{[`ed25519:${x}`]:J}},this.crypto.crossSigningInfo.getId("self_signing")&&(yield this.crypto.crossSigningInfo.signObject(B,"self_signing")),v.logger.log("Preparing one-time keys");const z={};for(const[L,j]of Object.entries(e.curve25519)){const C={key:j},F=o.sign(d.default.stringify(C));C.signatures={[this.crypto.userId]:{[`ed25519:${x}`]:F}},z[`signed_curve25519:${L}`]=C}v.logger.log("Preparing fallback keys");const M={};for(const[L,j]of Object.entries(p.curve25519)){const C={key:j,fallback:!0},F=o.sign(d.default.stringify(C));C.signatures={[this.crypto.userId]:{[`ed25519:${x}`]:F}},M[`signed_curve25519:${L}`]=C}return v.logger.log("Uploading keys to server"),yield this.crypto.baseApis.http.authedRequest(c.Method.Post,"/keys/upload/"+encodeURI(x),void 0,{device_keys:B,one_time_keys:z,"org.matrix.msc2732.fallback_keys":M}),v.logger.log("Done dehydrating"),this.timeoutId=R.setTimeout(this.dehydrateDevice.bind(this),i),x}finally{this.inProgress=!1}}})}stop(){this.timeoutId&&(R.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{"../crypto/store/indexeddb-crypto-store":338,"../http-api":358,"../logger":365,"./aes":323,"./olmlib":335,"another-json":1,buffer:68}],332:[function(m,ie,a){"use strict";var R,E;Object.defineProperty(a,"__esModule",{value:!0}),a.DeviceInfo=void 0,(E=R||(R={}))[E.Blocked=-1]="Blocked",E[E.Unverified=0]="Unverified",E[E.Verified=1]="Verified";class I{static fromStorage(_,d){const u=new I(d);for(const g in _)_.hasOwnProperty(g)&&(u[g]=_[g]);return u}constructor(_){this.deviceId=_,this.algorithms=[],this.keys={},this.verified=R.Unverified,this.known=!1,this.unsigned={},this.signatures={}}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==R.Blocked}isVerified(){return this.verified==R.Verified}isUnverified(){return this.verified==R.Unverified}isKnown(){return!0===this.known}}a.DeviceInfo=I,I.DeviceVerification={VERIFIED:R.Verified,UNVERIFIED:R.Unverified,BLOCKED:R.Blocked}},{}],333:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__createBinding||(Object.create?function(ce,te,P,A){void 0===A&&(A=P);var $=Object.getOwnPropertyDescriptor(te,P);(!$||("get"in $?!te.__esModule:$.writable||$.configurable))&&($={enumerable:!0,get:function(){return te[P]}}),Object.defineProperty(ce,A,$)}:function(ce,te,P,A){void 0===A&&(A=P),ce[A]=te[P]}),_=this&&this.__setModuleDefault||(Object.create?function(ce,te){Object.defineProperty(ce,"default",{enumerable:!0,value:te})}:function(ce,te){ce.default=te}),d=this&&this.__importStar||function(ce){if(ce&&ce.__esModule)return ce;var te={};if(null!=ce)for(var P in ce)"default"!==P&&Object.prototype.hasOwnProperty.call(ce,P)&&E(te,ce,P);return _(te,ce),te},u=this&&this.__awaiter||function(ce,te,P,A){return new(P||(P=Promise))(function(G,se){function he(Ee){try{me(A.next(Ee))}catch(_e){se(_e)}}function pe(Ee){try{me(A.throw(Ee))}catch(_e){se(_e)}}function me(Ee){Ee.done?G(Ee.value):function $(G){return G instanceof P?G:new P(function(se){se(G)})}(Ee.value).then(he,pe)}me((A=A.apply(ce,te||[])).next())})},g=this&&this.__importDefault||function(ce){return ce&&ce.__esModule?ce:{default:ce}};Object.defineProperty(a,"__esModule",{value:!0}),a.IncomingRoomKeyRequest=a.fixBackupKey=a.Crypto=a.CryptoEvent=a.isCryptoAvailable=a.verificationMethods=void 0;const f=g(m("another-json")),v=m("uuid"),c=m("../@types/event"),i=m("../ReEmitter"),r=m("../logger"),s=m("./OlmDevice"),t=d(m("./olmlib")),n=m("./DeviceList"),o=m("./deviceinfo"),h=d(m("./algorithms")),l=m("./CrossSigning"),e=m("./EncryptionSetup"),p=m("./SecretStorage"),b=m("./OutgoingRoomKeyRequestManager"),y=m("./store/indexeddb-crypto-store"),w=m("./verification/QRCode"),x=m("./verification/SAS"),B=m("./key_passphrase"),J=m("./recoverykey"),z=m("./verification/request/VerificationRequest"),M=m("./verification/request/InRoomChannel"),L=m("./verification/request/ToDeviceChannel"),j=m("./verification/IllegalMethod"),C=m("../errors"),F=m("./aes"),V=m("./dehydration"),N=m("./backup"),T=m("../models/room"),S=m("../models/room-member"),U=m("../models/event"),W=m("../client"),k=m("../models/typed-event-emitter"),D=o.DeviceInfo.DeviceVerification,Q={[w.ReciprocateQRCode.NAME]:w.ReciprocateQRCode,[x.SAS.NAME]:x.SAS,[w.SHOW_QR_CODE_METHOD]:j.IllegalMethod,[w.SCAN_QR_CODE_METHOD]:j.IllegalMethod};var ue,ce;function X(ce){if("string"!=typeof ce||ce.indexOf(",")<0)return null;const te=Uint8Array.from(ce.split(","),P=>parseInt(P));return t.encodeBase64(te)}a.verificationMethods={RECIPROCATE_QR_CODE:w.ReciprocateQRCode.NAME,SAS:x.SAS.NAME},a.isCryptoAvailable=function ee(){return Boolean(R.Olm)},(ce=ue=a.CryptoEvent||(a.CryptoEvent={})).DeviceVerificationChanged="deviceVerificationChanged",ce.UserTrustStatusChanged="userTrustStatusChanged",ce.UserCrossSigningUpdated="userCrossSigningUpdated",ce.RoomKeyRequest="crypto.roomKeyRequest",ce.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",ce.KeyBackupStatus="crypto.keyBackupStatus",ce.KeyBackupFailed="crypto.keyBackupFailed",ce.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",ce.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",ce.VerificationRequest="crypto.verification.request",ce.Warning="crypto.warning",ce.WillUpdateDevices="crypto.willUpdateDevices",ce.DevicesUpdated="crypto.devicesUpdated",ce.KeysChanged="crossSigning.keysChanged",a.Crypto=class be extends k.TypedEventEmitter{static getOlmVersion(){return s.OlmDevice.getOlmVersion()}constructor(te,P,A,$,G,se,he){if(super(),this.baseApis=te,this.userId=P,this.deviceId=A,this.clientStore=$,this.cryptoStore=G,this.roomList=se,this.trustCrossSignedDevices=!0,this.lastOneTimeKeyCheck=null,this.oneTimeKeyCheckInProgress=!1,this.roomEncryptors=new Map,this.roomDecryptors=new Map,this.deviceKeys={},this.globalBlacklistUnverifiedDevices=!1,this.globalErrorOnUnknownDevices=!0,this.receivedRoomKeyRequests=[],this.receivedRoomKeyRequestCancellations=[],this.processingRoomKeyRequests=!1,this.lazyLoadMembers=!1,this.roomDeviceTrackingState={},this.lastNewSessionForced={},this.sendKeyRequestsImmediately=!1,this.onDeviceListUserCrossSigningUpdated=Ee=>u(this,void 0,void 0,function*(){if(Ee===this.userId){const _e=this.deviceList.getStoredCrossSigningForUser(Ee),Se=_e?_e.getId():null,De=this.crossSigningInfo.getId();De&&Se&&De===Se?yield this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit(ue.KeysChanged,{}),this.emit(ue.UserTrustStatusChanged,this.userId,this.checkUserTrust(Ee)))}else{yield this.checkDeviceVerifications(Ee);const _e=this.deviceList.getStoredCrossSigningForUser(Ee);_e&&(_e.updateCrossSigningVerifiedBefore(this.checkUserTrust(Ee).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(Ee,_e.toStorage())),this.emit(ue.UserTrustStatusChanged,Ee,this.checkUserTrust(Ee))}}),this.onMembership=(Ee,_e,Se)=>{try{this.onRoomMembership(Ee,_e,Se)}catch(De){r.logger.error("Error handling membership change:",De)}},this.onToDeviceEvent=Ee=>{try{r.logger.log(`received to-device ${Ee.getType()} from: ${Ee.getSender()} id: ${Ee.getContent()[c.ToDeviceMessageId]}`),"m.room_key"==Ee.getType()||"m.forwarded_room_key"==Ee.getType()?this.onRoomKeyEvent(Ee):"m.room_key_request"==Ee.getType()?this.onRoomKeyRequestEvent(Ee):"m.secret.request"===Ee.getType()?this.secretStorage.onRequestReceived(Ee):"m.secret.send"===Ee.getType()?this.secretStorage.onSecretReceived(Ee):"m.room_key.withheld"===Ee.getType()?this.onRoomKeyWithheldEvent(Ee):Ee.getContent().transaction_id?this.onKeyVerificationMessage(Ee):"m.bad.encrypted"===Ee.getContent().msgtype?this.onToDeviceBadEncrypted(Ee):(Ee.isBeingDecrypted()||Ee.shouldAttemptDecryption())&&(Ee.isBeingDecrypted()||Ee.attemptDecryption(this),Ee.once(U.MatrixEventEvent.Decrypted,_e=>{this.onToDeviceEvent(_e)}))}catch(_e){r.logger.error("Error handling toDeviceEvent:",_e)}},this.onTimelineEvent=(Ee,_e,Se,De,{liveEvent:Ae=!0}={})=>{M.InRoomChannel.validateEvent(Ee,this.baseApis)&&this.handleVerificationEvent(Ee,this.inRoomVerificationRequests,qe=>{const Be=new M.InRoomChannel(this.baseApis,qe.getRoomId());return new z.VerificationRequest(Be,this.verificationMethods,this.baseApis)},Ae)},this.reEmitter=new i.TypedReEmitter(this),he){this.verificationMethods=new Map;for(const Ee of he)"string"==typeof Ee?Q[Ee]&&this.verificationMethods.set(Ee,Q[Ee]):Ee.NAME?this.verificationMethods.set(Ee.NAME,Ee):r.logger.warn(`Excluding unknown verification method ${Ee}`)}else this.verificationMethods=new Map(Object.entries(Q));this.backupManager=new N.BackupManager(te,()=>u(this,void 0,void 0,function*(){const Ee=yield this.getSessionBackupPrivateKey();if(Ee)return Ee;const _e=yield this.getSecret("m.megolm_backup.v1");if(_e){const Se=X(_e);if(Se){const De=yield this.getSecretStorageKey();yield this.storeSecret("m.megolm_backup.v1",Se,[De[0]])}return t.decodeBase64(Se||_e)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")})),this.olmDevice=new s.OlmDevice(G),this.deviceList=new n.DeviceList(te,G,this.olmDevice),this.deviceList.on(ue.UserCrossSigningUpdated,this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,[ue.DevicesUpdated,ue.WillUpdateDevices]),this.supportedAlgorithms=Array.from(h.DECRYPTION_CLASSES.keys()),this.outgoingRoomKeyRequestManager=new b.OutgoingRoomKeyRequestManager(te,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new L.ToDeviceRequests,this.inRoomVerificationRequests=new M.InRoomRequests;const pe=this.baseApis.cryptoCallbacks||{},me=(0,l.createCryptoStoreCacheCallbacks)(G,this.olmDevice);this.crossSigningInfo=new l.CrossSigningInfo(P,pe,me),this.secretStorage=new p.SecretStorage(te,pe,te),this.dehydrationManager=new V.DehydrationManager(this),!pe.getCrossSigningKey&&pe.getSecretStorageKey&&(pe.getCrossSigningKey=Ee=>u(this,void 0,void 0,function*(){return l.CrossSigningInfo.getFromSecretStorage(Ee,this.secretStorage)}))}init({exportedOlmDevice:te,pickleKey:P}={}){return u(this,void 0,void 0,function*(){r.logger.log("Crypto: initialising Olm..."),yield R.Olm.init(),r.logger.log(te?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),yield this.olmDevice.init({fromExportedDevice:te,pickleKey:P}),r.logger.log("Crypto: loading device list..."),yield this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,r.logger.log("Crypto: fetching own devices...");let A=this.deviceList.getRawStoredDevicesForUser(this.userId);A||(A={}),A[this.deviceId]||(r.logger.log("Crypto: adding this device to the store..."),A[this.deviceId]={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:D.VERIFIED,known:!0},this.deviceList.storeDevicesForUser(this.userId,A),this.deviceList.saveIfDirty()),yield this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_ACCOUNT],$=>{this.cryptoStore.getCrossSigningKeys($,G=>{G&&0!==Object.keys(G).length&&(r.logger.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(G))})}),this.deviceList.startTrackingDeviceList(this.userId),r.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()})}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setCryptoTrustCrossSignedDevices(te){this.trustCrossSignedDevices=te;for(const P of this.deviceList.getKnownUserIds()){const A=this.deviceList.getRawStoredDevicesForUser(P);for(const $ of Object.keys(A)){const G=this.checkDeviceTrust(P,$);if(!G.isLocallyVerified()&&G.isCrossSigningVerified()){const se=this.deviceList.getStoredDevice(P,$);this.emit(ue.DeviceVerificationChanged,P,$,se)}}}}createRecoveryKeyFromPassphrase(te){return u(this,void 0,void 0,function*(){const P=new R.Olm.PkDecryption;try{const A={};if(te){const se=yield(0,B.keyFromPassphrase)(te);A.passphrase={algorithm:"m.pbkdf2",iterations:se.iterations,salt:se.salt},A.pubkey=P.init_with_private_key(se.key)}else A.pubkey=P.generate_key();const $=P.get_private_key();return{keyInfo:A,encodedPrivateKey:(0,J.encodeRecoveryKey)($),privateKey:$}}finally{P?.free()}})}userHasCrossSigningKeys(){return u(this,void 0,void 0,function*(){return yield this.downloadKeys([this.userId]),null!==this.deviceList.getStoredCrossSigningForUser(this.userId)})}isCrossSigningReady(){return u(this,void 0,void 0,function*(){const te=this.crossSigningInfo.getId(),P=(yield this.crossSigningInfo.isStoredInKeyCache())||(yield this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage));return!(!te||!P)})}isSecretStorageReady(){return u(this,void 0,void 0,function*(){const te=yield this.secretStorage.hasKey(),P=yield this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),A=!this.backupManager.getKeyBackupEnabled()||(yield this.baseApis.isKeyBackupKeyStored());return!!(te&&P&&A)})}bootstrapCrossSigning({authUploadDeviceSigningKeys:te,setupNewCrossSigning:P}={}){return u(this,void 0,void 0,function*(){r.logger.log("Bootstrapping cross-signing");const $=new e.EncryptionSetupBuilder(this.baseApis.store.accountData,this.baseApis.cryptoCallbacks),G=new l.CrossSigningInfo(this.userId,$.crossSigningCallbacks,$.crossSigningCallbacks),he=this.crossSigningInfo.getId(),pe=yield this.crossSigningInfo.isStoredInKeyCache(),me=yield this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),Ee=pe||me;r.logger.log({setupNewCrossSigning:P,publicKeysOnDevice:he,privateKeysInCache:pe,privateKeysInStorage:me,privateKeysExistSomewhere:Ee}),!Ee||P?(r.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),yield(()=>u(this,void 0,void 0,function*(){G.resetKeys(),yield this.signObject(G.keys.master),$.addCrossSigningKeys(te,G.keys);const De=this.deviceList.getStoredDevice(this.userId,this.deviceId),Ae=yield G.signDevice(this.userId,De);$.addKeySignature(this.userId,this.deviceId,Ae),this.backupManager.backupInfo&&(yield G.signObject(this.backupManager.backupInfo.auth_data,"master"),$.addSessionBackup(this.backupManager.backupInfo))}))()):he&&pe?r.logger.log("Cross-signing public keys trusted and private keys found locally"):me&&(r.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),yield this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const _e=$.crossSigningCallbacks.privateKeys;if(_e.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const De=new p.SecretStorage($.accountDataClientAdapter,$.ssssCryptoCallbacks,void 0);(yield De.hasKey())&&(r.logger.log("Storing new cross-signing private keys in secret storage"),yield l.CrossSigningInfo.storeInSecretStorage(_e,De))}yield $.buildOperation().apply(this),yield $.persist(this),r.logger.log("Cross-signing ready")})}bootstrapSecretStorage({createSecretStorageKey:te=(()=>u(this,void 0,void 0,function*(){return{}})),keyBackupInfo:P,setupNewKeyBackup:A,setupNewSecretStorage:$,getKeyBackupPassphrase:G}={}){return u(this,void 0,void 0,function*(){r.logger.log("Bootstrapping Secure Secret Storage");const he=new e.EncryptionSetupBuilder(this.baseApis.store.accountData,this.baseApis.cryptoCallbacks),pe=new p.SecretStorage(he.accountDataClientAdapter,he.ssssCryptoCallbacks,void 0);let me=null;const Ee=(Ue,K)=>u(this,void 0,void 0,function*(){K&&(Ue.key=K);const{keyId:Y,keyInfo:oe}=yield pe.addKey(p.SECRET_STORAGE_ALGORITHM_V1_AES,Ue);return K&&he.ssssCryptoCallbacks.addPrivateKey(Y,oe,K),yield pe.setDefaultKeyId(Y),Y}),Se=Ue=>u(this,void 0,void 0,function*(){if(this.crossSigningInfo.getId()&&(yield this.crossSigningInfo.isStoredInKeyCache("master")))try{r.logger.log("Adding cross-signing signature to key backup"),yield this.crossSigningInfo.signObject(Ue,"master")}catch(K){r.logger.error("Signing key backup with cross-signing keys failed",K)}else r.logger.warn("Cross-signing keys not available, skipping signature on key backup")}),De=yield this.getSecretStorageKey(),[Ae,Ne]=De||[null,null],qe=!$&&Ne&&Ne.algorithm===p.SECRET_STORAGE_ALGORITHM_V1_AES;if(r.logger.log({keyBackupInfo:P,setupNewKeyBackup:A,setupNewSecretStorage:$,storageExists:qe,oldKeyInfo:Ne}),qe||P)if(!qe&&P){r.logger.log("Secret storage does not exist, using key backup key");const Ue=(yield this.getSessionBackupPrivateKey())||(yield G?.()),K={};P.auth_data.private_key_salt&&P.auth_data.private_key_iterations&&(K.passphrase={algorithm:"m.pbkdf2",iterations:P.auth_data.private_key_iterations,salt:P.auth_data.private_key_salt,bits:256}),me=yield Ee(K,Ue),yield pe.store("m.megolm_backup.v1",t.encodeBase64(Ue),[me]),yield Se(P.auth_data),he.addSessionBackup(P)}else r.logger.log("Secret storage exists"),Ne&&Ne.algorithm===p.SECRET_STORAGE_ALGORITHM_V1_AES&&(yield((Ue,K)=>u(this,void 0,void 0,function*(){var Y,oe;if(!K.mac){const le=yield null===(oe=(Y=this.baseApis.cryptoCallbacks).getSecretStorageKey)||void 0===oe?void 0:oe.call(Y,{keys:{[Ue]:K}},"");if(le){const ge=le[1];he.ssssCryptoCallbacks.addPrivateKey(Ue,K,ge);const{iv:Ie,mac:Ce}=yield(0,F.calculateKeyCheck)(ge);K.iv=Ie,K.mac=Ce,yield he.setAccountData(`m.secret_storage.key.${Ue}`,K)}}}))(Ae,Ne));else{r.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:Ue={},privateKey:K}=yield te();me=yield Ee(Ue,K)}if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&(yield this.isCrossSigningReady())&&(me||!(yield this.crossSigningInfo.isStoredInSecretStorage(pe)))){r.logger.log("Copying cross-signing private keys from cache to secret storage");const Ue=yield this.crossSigningInfo.getCrossSigningKeysFromCache();yield l.CrossSigningInfo.storeInSecretStorage(Ue,pe)}if(A&&!P){r.logger.log("Creating new message key backup version");const Ue=yield this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),K=(0,J.decodeRecoveryKey)(Ue.recovery_key);yield pe.store("m.megolm_backup.v1",t.encodeBase64(K));const Y={algorithm:Ue.algorithm,auth_data:Ue.auth_data};yield Se(Y.auth_data),yield this.signObject(Y.auth_data),he.addSessionBackup(Y)}const Be=yield pe.get("m.megolm_backup.v1");if(Be){r.logger.info("Got session backup key from secret storage: caching");const Ue=X(Be);if(Ue){const Y=me||Ae;yield pe.store("m.megolm_backup.v1",Ue,Y?[Y]:null)}const K=new Uint8Array(t.decodeBase64(Ue||Be));he.addSessionBackupPrivateKeyToCache(K)}else if(this.backupManager.getKeyBackupEnabled()){const Ue=(yield this.getSessionBackupPrivateKey())||(yield G?.());if(!Ue)return void r.logger.error("Key backup is enabled but couldn't get key backup key!");r.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),yield pe.store("m.megolm_backup.v1",t.encodeBase64(Ue))}yield he.buildOperation().apply(this),yield he.persist(this),r.logger.log("Secure Secret Storage ready")})}addSecretStorageKey(te,P,A){return this.secretStorage.addKey(te,P,A)}hasSecretStorageKey(te){return this.secretStorage.hasKey(te)}getSecretStorageKey(te){return this.secretStorage.getKey(te)}storeSecret(te,P,A){return this.secretStorage.store(te,P,A)}getSecret(te){return this.secretStorage.get(te)}isSecretStored(te){return this.secretStorage.isStored(te)}requestSecret(te,P){return P||(P=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(te,P)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(te){return this.secretStorage.setDefaultKeyId(te)}checkSecretStorageKey(te,P){return this.secretStorage.checkKey(te,P)}checkSecretStoragePrivateKey(te,P){let A=null;try{return A=new R.Olm.PkDecryption,A.init_with_private_key(te)===P}finally{A?.free()}}getSessionBackupPrivateKey(){return u(this,void 0,void 0,function*(){let te=yield new Promise(P=>{this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_ACCOUNT],A=>{this.cryptoStore.getSecretStorePrivateKey(A,P,"m.megolm_backup.v1")})});if(te&&"string"==typeof te&&(te=new Uint8Array(t.decodeBase64(X(te)||te)),yield this.storeSessionBackupPrivateKey(te)),te&&te.ciphertext){const P=I.from(this.olmDevice.pickleKey),A=yield(0,F.decryptAES)(te,P,"m.megolm_backup.v1");te=t.decodeBase64(A)}return te})}storeSessionBackupPrivateKey(te){return u(this,void 0,void 0,function*(){if(!(te instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${te}`);const P=I.from(this.olmDevice.pickleKey),A=yield(0,F.encryptAES)(t.encodeBase64(te),P,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[y.IndexedDBCryptoStore.STORE_ACCOUNT],$=>{this.cryptoStore.storeSecretStorePrivateKey($,"m.megolm_backup.v1",A)})})}checkCrossSigningPrivateKey(te,P){let A=null;try{return A=new R.Olm.PkSigning,A.init_with_seed(te)===P}finally{A?.free()}}afterCrossSigningLocalKeyChange(){return u(this,void 0,void 0,function*(){r.logger.info("Starting cross-signing key change post-processing");const te=this.deviceList.getStoredDevice(this.userId,this.deviceId),P=yield this.crossSigningInfo.signDevice(this.userId,te);r.logger.info(`Starting background key sig upload for ${this.deviceId}`);const A=({shouldEmit:G=!1})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:P}}).then(se=>{const{failures:he}=se||{};if(Object.keys(he||[]).length>0)throw G&&this.baseApis.emit(ue.KeySignatureUploadFailure,he,"afterCrossSigningLocalKeyChange",A),new C.KeySignatureUploadError("Key upload failed",{failures:he});r.logger.info(`Finished background key sig upload for ${this.deviceId}`)}).catch(se=>{r.logger.error(`Error during background key sig upload for ${this.deviceId}`,se)});A({shouldEmit:!0});const $=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if($){r.logger.info("Starting device verification upgrade");const G={};for(const[se,he]of Object.entries(this.deviceList.crossSigningInfo)){const pe=yield this.checkForDeviceVerificationUpgrade(se,l.CrossSigningInfo.fromStorage(he,se));pe&&(G[se]=pe)}if(Object.keys(G).length>0){r.logger.info(`Found ${Object.keys(G).length} verif users to upgrade`);try{const se=yield $({users:G});if(se)for(const he of se)he in G&&(yield this.baseApis.setDeviceVerified(he,G[he].crossSigningInfo.getId()))}catch(se){r.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",se)}}r.logger.info("Finished device verification upgrade")}r.logger.info("Finished cross-signing key change post-processing")})}checkForDeviceVerificationUpgrade(te,P){return u(this,void 0,void 0,function*(){const A=this.crossSigningInfo.checkUserTrust(P);if(P.firstUse&&!A.isVerified()){const $=this.deviceList.getRawStoredDevicesForUser(te),G=yield this.checkForValidDeviceSignature(te,P.keys.master,$);if(G.length)return{devices:G.map(se=>o.DeviceInfo.fromStorage($[se],se)),crossSigningInfo:P}}})}checkForValidDeviceSignature(te,P,A){return u(this,void 0,void 0,function*(){const $=[];if(A&&P.signatures&&P.signatures[te])for(const G of Object.keys(P.signatures[te])){const[,se]=G.split(":",2);if(se in A&&A[se].verified===D.VERIFIED)try{yield t.verifySignature(this.olmDevice,P,te,se,A[se].keys[G]),$.push(se)}catch{}}return $})}getCrossSigningId(te){return this.crossSigningInfo.getId(te)}getStoredCrossSigningForUser(te){return this.deviceList.getStoredCrossSigningForUser(te)}checkUserTrust(te){const P=this.deviceList.getStoredCrossSigningForUser(te);return P?this.crossSigningInfo.checkUserTrust(P):new l.UserTrustLevel(!1,!1,!1)}checkDeviceTrust(te,P){const A=this.deviceList.getStoredDevice(te,P);return this.checkDeviceInfoTrust(te,A)}checkDeviceInfoTrust(te,P){const A=!!P?.isVerified(),$=this.deviceList.getStoredCrossSigningForUser(te);return P&&$?this.crossSigningInfo.checkDeviceTrust($,P,A,this.trustCrossSignedDevices||te===this.userId):new l.DeviceTrustLevel(!1,!1,A,!1)}checkIfOwnDeviceCrossSigned(te){var P;const A=this.deviceList.getStoredDevice(this.userId,te);if(!A)return!1;const $=this.deviceList.getStoredCrossSigningForUser(this.userId);return null!==(P=$?.checkDeviceTrust($,A,!1,!0).isCrossSigningVerified())&&void 0!==P&&P}checkOwnCrossSigningTrust({allowPrivateKeyRequests:te=!1}={}){return u(this,void 0,void 0,function*(){const P=this.userId;yield this.downloadKeys([this.userId]);const A=yield this.crossSigningInfo.getCrossSigningKeysFromCache(),$=this.deviceList.getStoredCrossSigningForUser(P);if(!$)return void r.logger.error("Got cross-signing update event for user "+P+" but no new cross-signing information found!");const G=$.getId(),se=this.crossSigningInfo.getId()!==G,he=$.getId()&&!A.has("master");if(se&&r.logger.info("Got new master public key",G),te&&(se||he)){r.logger.info("Attempting to retrieve cross-signing master private key");let qe=null;try{qe=(yield this.crossSigningInfo.getCrossSigningKey("master",G))[1],r.logger.info("Got cross-signing master private key")}finally{qe?.free()}}const pe=this.crossSigningInfo.getId("self_signing"),me=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys($.keys);const Ee=pe!==$.getId("self_signing"),_e=me!==$.getId("user_signing"),Se=$.getId("self_signing")&&!A.has("self_signing"),De=$.getId("user_signing")&&!A.has("user_signing"),Ae={};if(Ee&&r.logger.info("Got new self-signing key",$.getId("self_signing")),te&&(Ee||Se)){r.logger.info("Attempting to retrieve cross-signing self-signing private key");let qe=null;try{qe=(yield this.crossSigningInfo.getCrossSigningKey("self_signing",$.getId("self_signing")))[1],r.logger.info("Got cross-signing self-signing private key")}finally{qe?.free()}const Be=this.deviceList.getStoredDevice(this.userId,this.deviceId),Ge=yield this.crossSigningInfo.signDevice(this.userId,Be);Ae[this.deviceId]=Ge}if(_e&&r.logger.info("Got new user-signing key",$.getId("user_signing")),te&&(_e||De)){r.logger.info("Attempting to retrieve cross-signing user-signing private key");let qe=null;try{qe=(yield this.crossSigningInfo.getCrossSigningKey("user_signing",$.getId("user_signing")))[1],r.logger.info("Got cross-signing user-signing private key")}finally{qe?.free()}}if(se){const qe=this.crossSigningInfo.keys.master;yield this.signObject(qe);const Be=qe.signatures[this.userId]["ed25519:"+this.deviceId];Ae[this.crossSigningInfo.getId()]=Object.assign({},qe,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:Be}}})}const Ne=Object.keys(Ae);if(Ne.length){const qe=({shouldEmit:Be=!1})=>(r.logger.info(`Starting background key sig upload for ${Ne}`),this.baseApis.uploadKeySignatures({[this.userId]:Ae}).then(Ge=>{const{failures:Ue}=Ge||{};if(r.logger.info(`Finished background key sig upload for ${Ne}`),Object.keys(Ue||[]).length>0)throw Be&&this.baseApis.emit(ue.KeySignatureUploadFailure,Ue,"checkOwnCrossSigningTrust",qe),new C.KeySignatureUploadError("Key upload failed",{failures:Ue})}).catch(Ge=>{r.logger.error(`Error during background key sig upload for ${Ne}`,Ge)}));qe({shouldEmit:!0})}this.emit(ue.UserTrustStatusChanged,P,this.checkUserTrust(P)),se&&(this.emit(ue.KeysChanged,{}),yield this.afterCrossSigningLocalKeyChange()),yield this.backupManager.checkKeyBackup()})}storeTrustedSelfKeys(te){return u(this,void 0,void 0,function*(){te?this.crossSigningInfo.setKeys(te):this.crossSigningInfo.clearKeys(),yield this.cryptoStore.doTxn("readwrite",[y.IndexedDBCryptoStore.STORE_ACCOUNT],P=>{this.cryptoStore.storeCrossSigningKeys(P,this.crossSigningInfo.keys)})})}checkDeviceVerifications(te){return u(this,void 0,void 0,function*(){const P=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(P){if(r.logger.info(`Starting device verification upgrade for ${te}`),this.crossSigningInfo.keys.user_signing){const A=this.deviceList.getStoredCrossSigningForUser(te);if(A){const $=yield this.checkForDeviceVerificationUpgrade(te,A);$&&(yield P({users:{[te]:$}})).includes(te)&&(yield this.baseApis.setDeviceVerified(te,A.getId()))}}r.logger.info(`Finished device verification upgrade for ${te}`)}})}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(te){te.on(S.RoomMemberEvent.Membership,this.onMembership),te.on(W.ClientEvent.ToDeviceEvent,this.onToDeviceEvent),te.on(T.RoomEvent.Timeline,this.onTimelineEvent),te.on(U.MatrixEventEvent.Decrypted,this.onTimelineEvent)}start(){r.logger.warn("MatrixClient.crypto.start() is deprecated")}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}setGlobalBlacklistUnverifiedDevices(te){this.globalBlacklistUnverifiedDevices=te}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}uploadDeviceKeys(){const te={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(te).then(()=>this.baseApis.uploadKeysRequest({device_keys:te}))}updateOneTimeKeyCount(te){if(!isFinite(te))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=te}setNeedsNewFallback(te){this.needsNewFallback=te}getNeedsNewFallback(){return!!this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const A=Date.now();if(null!==this.lastOneTimeKeyCheck&&A-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=A;const $=this.olmDevice.maxNumberOfOneTimeKeys(),G=Math.floor($/2),se=he=>u(this,void 0,void 0,function*(){for(;G>he||this.getNeedsNewFallback();){if(G>he){r.logger.info("generating oneTimeKeys");const me=Math.min(G-he,5);yield this.olmDevice.generateOneTimeKeys(me)}if(this.getNeedsNewFallback()){const me=yield this.olmDevice.getFallbackKey();(!me.curve25519||0==Object.keys(me.curve25519).length)&&(r.logger.info("generating fallback key"),this.fallbackCleanup&&(clearTimeout(this.fallbackCleanup),delete this.fallbackCleanup),yield this.olmDevice.generateFallbackKey())}r.logger.info("calling uploadOneTimeKeys");const pe=yield this.uploadOneTimeKeys();if(!pe.one_time_key_counts||!pe.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");he=pe.one_time_key_counts.signed_curve25519}});this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then(()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then(he=>he.one_time_key_counts.signed_curve25519||0)).then(he=>se(he)).catch(he=>{r.logger.error("Error uploading one-time keys",he.stack||he)}).finally(()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1})}uploadOneTimeKeys(){return u(this,void 0,void 0,function*(){const te=[];let P;if(this.getNeedsNewFallback()){P={};const he=yield this.olmDevice.getFallbackKey();for(const[pe,me]of Object.entries(he.curve25519)){const Ee={key:me,fallback:!0};P["signed_curve25519:"+pe]=Ee,te.push(this.signObject(Ee))}this.setNeedsNewFallback(!1)}const A=yield this.olmDevice.getOneTimeKeys(),$={};for(const he in A.curve25519)if(A.curve25519.hasOwnProperty(he)){const pe={key:A.curve25519[he]};$["signed_curve25519:"+he]=pe,te.push(this.signObject(pe))}yield Promise.all(te);const G={one_time_keys:$};P&&(G["org.matrix.msc2732.fallback_keys"]=P,G.fallback_keys=P);const se=yield this.baseApis.uploadKeysRequest(G);return P&&(this.fallbackCleanup=setTimeout(()=>{delete this.fallbackCleanup,this.olmDevice.forgetOldFallbackKey()},36e5)),yield this.olmDevice.markKeysAsPublished(),se})}downloadKeys(te,P){return this.deviceList.downloadKeys(te,!!P)}getStoredDevicesForUser(te){return this.deviceList.getStoredDevicesForUser(te)}getStoredDevice(te,P){return this.deviceList.getStoredDevice(te,P)}saveDeviceList(te){return this.deviceList.saveIfDirty(te)}setDeviceVerification(te,P,A=null,$=null,G=null,se){return u(this,void 0,void 0,function*(){const he=this.deviceList.getStoredCrossSigningForUser(te);if(he&&he.getId()===P){if(null!==$||null!==G)throw new Error("Cannot set blocked or known for a cross-signing key");if(!A)throw new Error("Cannot set a cross-signing key as unverified");const De=se?Object.values(se)[0]:null;if(se&&(1!==Object.values(se).length||De!==he.getId()))throw new Error(`Key did not match expected value: expected ${he.getId()}, got ${De}`);if(!this.crossSigningInfo.getId()&&te===this.crossSigningInfo.userId&&(this.storeTrustedSelfKeys(he.keys),this.emit(ue.UserTrustStatusChanged,this.userId,this.checkUserTrust(te))),te!==this.userId){r.logger.info("Master key "+he.getId()+" for "+te+" marked verified. Signing...");const Ae=yield this.crossSigningInfo.signUser(he);if(Ae){const Ne=({shouldEmit:qe=!1})=>u(this,void 0,void 0,function*(){r.logger.info("Uploading signature for "+te+"...");const Be=yield this.baseApis.uploadKeySignatures({[te]:{[P]:Ae}}),{failures:Ge}=Be||{};if(Object.keys(Ge||[]).length>0)throw qe&&this.baseApis.emit(ue.KeySignatureUploadFailure,Ge,"setDeviceVerification",Ne),new C.KeySignatureUploadError("Key upload failed",{failures:Ge})});yield Ne({shouldEmit:!0})}return Ae}return he}const pe=this.deviceList.getRawStoredDevicesForUser(te);if(!pe||!pe[P])throw new Error("Unknown device "+te+":"+P);const me=pe[P];let Ee=me.verified;if(A){if(se)for(const[De,Ae]of Object.entries(se))if(me.keys[De]!==Ae)throw new Error(`Key did not match expected value: expected ${Ae}, got ${me.keys[De]}`);Ee=D.VERIFIED}else null!==A&&Ee==D.VERIFIED&&(Ee=D.UNVERIFIED);$?Ee=D.BLOCKED:null!==$&&Ee==D.BLOCKED&&(Ee=D.UNVERIFIED);let _e=me.known;if(null!==G&&(_e=G),(me.verified!==Ee||me.known!==_e)&&(me.verified=Ee,me.known=_e,this.deviceList.storeDevicesForUser(te,pe),this.deviceList.saveIfDirty()),A&&te===this.userId){let De;if(r.logger.info("Own device "+P+" marked verified: signing"),this.checkDeviceTrust(te,P).isCrossSigningVerified()?r.logger.log(`Own device ${P} already cross-signing verified`):De=yield this.crossSigningInfo.signDevice(te,o.DeviceInfo.fromStorage(me,P)),De){const Ne=({shouldEmit:qe=!1})=>u(this,void 0,void 0,function*(){r.logger.info("Uploading signature for "+P);const Be=yield this.baseApis.uploadKeySignatures({[te]:{[P]:De}}),{failures:Ge}=Be||{};if(Object.keys(Ge||[]).length>0)throw qe&&this.baseApis.emit(ue.KeySignatureUploadFailure,Ge,"setDeviceVerification",Ne),new C.KeySignatureUploadError("Key upload failed",{failures:Ge})});yield Ne({shouldEmit:!0})}this.cancelAndResendAllOutgoingKeyRequests()}const Se=o.DeviceInfo.fromStorage(me,P);return this.emit(ue.DeviceVerificationChanged,te,P,Se),Se})}findVerificationRequestDMInProgress(te){return this.inRoomVerificationRequests.findRequestInProgress(te)}getVerificationRequestsToDeviceInProgress(te){return this.toDeviceVerificationRequests.getRequestsInProgress(te)}requestVerificationDM(te,P){const A=this.inRoomVerificationRequests.findRequestInProgress(P);if(A)return Promise.resolve(A);const $=new M.InRoomChannel(this.baseApis,P,te);return this.requestVerificationWithChannel(te,$,this.inRoomVerificationRequests)}requestVerification(te,P){P||(P=Object.keys(this.deviceList.getRawStoredDevicesForUser(te)));const A=this.toDeviceVerificationRequests.findRequestInProgress(te,P);if(A)return Promise.resolve(A);const $=new L.ToDeviceChannel(this.baseApis,te,P,L.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(te,$,this.toDeviceVerificationRequests)}requestVerificationWithChannel(te,P,A){return u(this,void 0,void 0,function*(){let $=new z.VerificationRequest(P,this.verificationMethods,this.baseApis);P.transactionId&&A.setRequestByChannel(P,$),yield $.sendRequest();const G=A.getRequestByChannel(P);return G?$=G:(r.logger.log(`Crypto: adding new request to requestsByTxnId with id ${P.transactionId} ${P.roomId}`),A.setRequestByChannel(P,$)),$})}beginKeyVerification(te,P,A,$=null){let G;if($){if(G=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(P,$),!G)throw new Error(`No request found for user ${P} with transactionId ${$}`)}else{$=L.ToDeviceChannel.makeTransactionId();const se=new L.ToDeviceChannel(this.baseApis,P,[A],$,A);G=new z.VerificationRequest(se,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(P,$,G)}return G.beginKeyVerification(te,{userId:P,deviceId:A})}legacyDeviceVerification(te,P,A){return u(this,void 0,void 0,function*(){const $=L.ToDeviceChannel.makeTransactionId(),G=new L.ToDeviceChannel(this.baseApis,te,[P],$,P),se=new z.VerificationRequest(G,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(te,$,se);const he=se.beginKeyVerification(A,{userId:te,deviceId:P});return yield Promise.race([he.verify(),se.waitFor(pe=>pe.started)]),se})}getOlmSessionsForUser(te){return u(this,void 0,void 0,function*(){const P=this.getStoredDevicesForUser(te)||[],A={};for(const $ of P){const G=$.getIdentityKey(),se=yield this.olmDevice.getSessionInfoForDevice(G);A[$.deviceId]={deviceIdKey:G,sessions:se}}return A})}getEventSenderDeviceInfo(te){const P=te.getSenderKey(),A=te.getWireContent().algorithm;if(!P||!A||te.isKeySourceUntrusted())return null;const $=this.deviceList.getDeviceByIdentityKey(A,P);if(null===$)return null;const G=te.getClaimedEd25519Key();return G?G!==$.getFingerprint()?(r.logger.warn("Event "+te.getId()+" claims ed25519 key "+G+" but sender device has key "+$.getFingerprint()),null):$:(r.logger.warn("Event "+te.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(te){var P,A;const $={};if($.senderKey=null!==(P=te.getSenderKey())&&void 0!==P?P:void 0,$.algorithm=te.getWireContent().algorithm,!$.senderKey||!$.algorithm)return $.encrypted=!1,$;$.encrypted=!0,$.authenticated=!te.isKeySourceUntrusted(),$.sender=null!==(A=this.deviceList.getDeviceByIdentityKey($.algorithm,$.senderKey))&&void 0!==A?A:void 0;const G=te.getClaimedEd25519Key();return G||(r.logger.warn("Event "+te.getId()+" claims no ed25519 key: cannot verify sending device"),$.mismatchedSender=!0),$.sender&&G!==$.sender.getFingerprint()&&(r.logger.warn("Event "+te.getId()+" claims ed25519 key "+G+"but sender device has key "+$.sender.getFingerprint()),$.mismatchedSender=!0),$}forceDiscardSession(te){const P=this.roomEncryptors.get(te);if(void 0===P)throw new Error("Room not encrypted");if(void 0===P.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");P.forceDiscardSession()}setRoomEncryption(te,P,A){return u(this,void 0,void 0,function*(){const $=this.clientStore.getRoom(te);if(!$)throw new Error(`Unable to enable encryption tracking devices in unknown room ${te}`);yield this.setRoomEncryptionImpl($,P),!this.lazyLoadMembers&&!A&&this.deviceList.refreshOutdatedDeviceLists()})}setRoomEncryptionImpl(te,P){return u(this,void 0,void 0,function*(){const A=te.roomId;if(!P.algorithm)return void r.logger.log("Ignoring setRoomEncryption with no algorithm");const $=this.roomList.getRoomEncryption(A);if($&&JSON.stringify($)!=JSON.stringify(P))return void r.logger.error("Ignoring m.room.encryption event which requests a change of config in "+A);if(this.roomEncryptors.get(A))return;let se=null;$||(se=this.roomList.setRoomEncryption(A,P));const he=h.ENCRYPTION_CLASSES.get(P.algorithm);if(!he)throw new Error("Unable to encrypt with "+P.algorithm);const pe=new he({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:A,config:P});this.roomEncryptors.set(A,pe),se&&(yield se),this.lazyLoadMembers?r.logger.log("Enabling encryption in "+A):(r.logger.log("Enabling encryption in "+A+"; starting to track device lists for all users therein"),yield this.trackRoomDevicesImpl(te))})}trackRoomDevices(te){const P=this.clientStore.getRoom(te);if(!P)throw new Error(`Unable to start tracking devices in unknown room ${te}`);return this.trackRoomDevicesImpl(P)}trackRoomDevicesImpl(te){const P=te.roomId;let $=this.roomDeviceTrackingState[P];return $||($=(()=>u(this,void 0,void 0,function*(){this.roomEncryptors.has(P)&&(r.logger.log(`Starting to track devices for room ${P} ...`),(yield te.getEncryptionTargetMembers()).forEach(se=>{this.deviceList.startTrackingDeviceList(se.userId)}))}))(),this.roomDeviceTrackingState[P]=$.catch(G=>{throw delete this.roomDeviceTrackingState[P],G})),$}ensureOlmSessionsForUsers(te,P){const A={};for(const $ of te){A[$]=[];const G=this.getStoredDevicesForUser($)||[];for(const se of G)se.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&se.verified!=D.BLOCKED&&A[$].push(se)}return t.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,A,P)}exportRoomKeys(){return u(this,void 0,void 0,function*(){const te=[];return yield this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],P=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(P,A=>{if(null===A)return;const $=this.olmDevice.exportInboundGroupSession(A.senderKey,A.sessionId,A.sessionData);delete $.first_known_index,$.algorithm=t.MEGOLM_ALGORITHM,te.push($)})}),te})}importRoomKeys(te,P={}){let A=0,$=0;const G=te.length;function se(){var he;null===(he=P.progressCallback)||void 0===he||he.call(P,{stage:"load_keys",successes:A,failures:$,total:G})}return Promise.all(te.map(he=>he.room_id&&he.algorithm?this.getRoomDecryptor(he.room_id,he.algorithm).importRoomKey(he,P).finally(()=>{A++,P.progressCallback&&se()}):(r.logger.warn("ignoring room key entry with missing fields",he),$++,P.progressCallback&&se(),null))).then()}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(te){const P=this.roomEncryptors.get(te.roomId);P&&P.prepareToEncrypt(te)}encryptEvent(te,P){return u(this,void 0,void 0,function*(){if(!P)throw new Error("Cannot send encrypted messages in unknown rooms");const A=te.getRoomId(),$=this.roomEncryptors.get(A);if(!$)throw new Error("Room "+A+" was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");yield this.trackRoomDevicesImpl(P);let G=te.getContent();const se=G["m.relates_to"];se&&(G=Object.assign({},G),delete G["m.relates_to"]);const he=G["io.element.performance_metrics"];he&&(G=Object.assign({},G),delete G["io.element.performance_metrics"]);const pe=yield $.encryptMessage(P,te.getType(),G);se&&(pe["m.relates_to"]=se),he&&(pe["io.element.performance_metrics"]=he),te.makeEncrypted("m.room.encrypted",pe,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)})}decryptEvent(te){return u(this,void 0,void 0,function*(){if(te.isRedacted()){const P=new U.MatrixEvent(Object.assign({room_id:te.getRoomId()},te.getUnsigned().redacted_because)),A=yield this.decryptEvent(P);return{clearEvent:{room_id:te.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:A.clearEvent}}}}{const P=te.getWireContent();return this.getRoomDecryptor(te.getRoomId(),P.algorithm).decryptEvent(te)}})}handleDeviceListChanges(te,P){return u(this,void 0,void 0,function*(){te.oldSyncToken&&(yield this.evalDeviceListChanges(P))})}requestRoomKey(te,P,A=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(te,P,A).then(()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()}).catch($=>{r.logger.error("Error requesting key for event",$)})}cancelRoomKeyRequest(te){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(te).catch(P=>{r.logger.warn("Error clearing pending room key requests",P)})}cancelAndResendAllOutgoingKeyRequests(){return u(this,void 0,void 0,function*(){yield this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()})}onCryptoEvent(te,P){return u(this,void 0,void 0,function*(){const A=P.getContent();yield this.setRoomEncryptionImpl(te,A)})}onSyncWillProcess(te){return u(this,void 0,void 0,function*(){te.oldSyncToken||(r.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1})}onSyncCompleted(te){var P;return u(this,void 0,void 0,function*(){this.deviceList.setSyncToken(null!==(P=te.nextSyncToken)&&void 0!==P?P:null),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),te.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)})}evalDeviceListChanges(te){return u(this,void 0,void 0,function*(){if(Array.isArray(te?.changed)&&te.changed.forEach(P=>{this.deviceList.invalidateUserDeviceList(P)}),Array.isArray(te?.left)&&te.left.length){const P=new Set(yield this.getTrackedE2eUsers());te.left.forEach(A=>{P.has(A)||this.deviceList.stopTrackingDeviceList(A)})}})}getTrackedE2eUsers(){return u(this,void 0,void 0,function*(){const te=[];for(const P of this.getTrackedE2eRooms()){const A=yield P.getEncryptionTargetMembers();for(const $ of A)te.push($.userId)}return te})}getTrackedE2eRooms(){return this.clientStore.getRooms().filter(te=>{if(!this.roomEncryptors.get(te.roomId)||!this.roomDeviceTrackingState[te.roomId])return!1;const A=te.getMyMembership();return"join"===A||"invite"===A})}encryptAndSendToDevices(te,P){return u(this,void 0,void 0,function*(){const A={eventType:c.EventType.RoomMessageEncrypted,batch:[]};try{yield Promise.all(te.map(({userId:$,deviceInfo:G})=>u(this,void 0,void 0,function*(){const se=G.deviceId,he={algorithm:t.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,v.v4)()};A.batch.push({userId:$,deviceId:se,payload:he}),yield t.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[$]:[G]}),yield t.encryptMessageForDevice(he.ciphertext,this.userId,this.deviceId,this.olmDevice,$,G,P)}))),A.batch=A.batch.filter($=>Object.keys($.payload.ciphertext).length>0||(r.logger.log(`No ciphertext for device ${$.userId}:${$.deviceId}: pruning`),!1));try{yield this.baseApis.queueToDevice(A)}catch($){throw r.logger.error("sendToDevice failed",$),$}}catch($){throw r.logger.error("encryptAndSendToDevices promises failed",$),$}})}onRoomKeyEvent(te){const P=te.getContent();P.room_id&&P.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(P.room_id,P.algorithm).onRoomKeyEvent(te)):r.logger.error("key event is missing fields")}onRoomKeyWithheldEvent(te){const P=te.getContent();if(!(("m.no_olm"===P.code||P.room_id&&P.session_id)&&P.algorithm&&P.sender_key))return void r.logger.error("key withheld event is missing fields");r.logger.info(`Got room key withheld event from ${te.getSender()} for ${P.algorithm} session ${P.sender_key}|${P.session_id} in room ${P.room_id} with code ${P.code} (${P.reason})`);const A=this.getRoomDecryptor(P.room_id,P.algorithm);if(A.onRoomKeyWithheldEvent&&A.onRoomKeyWithheldEvent(te),!P.room_id){const $=this.getRoomDecryptors(P.algorithm);for(const G of $)G.retryDecryptionFromSender(P.sender_key)}}onKeyVerificationMessage(te){L.ToDeviceChannel.validateEvent(te,this.baseApis)&&this.handleVerificationEvent(te,this.toDeviceVerificationRequests,A=>{if(!L.ToDeviceChannel.canCreateRequest(L.ToDeviceChannel.getEventType(A)))return;const $=A.getContent(),G=$&&$.from_device;if(!G)return;const se=A.getSender(),he=new L.ToDeviceChannel(this.baseApis,se,[G]);return new z.VerificationRequest(he,this.verificationMethods,this.baseApis)})}handleVerificationEvent(te,P,A,$=!0){return u(this,void 0,void 0,function*(){if(te.isSending()&&te.status!=U.EventStatus.SENT){let pe,me;try{yield new Promise((Ee,_e)=>{pe=Ee,me=()=>{te.status==U.EventStatus.CANCELLED&&_e(new Error("Event status set to CANCELLED."))},te.once(U.MatrixEventEvent.LocalEventIdReplaced,pe),te.on(U.MatrixEventEvent.Status,me)})}catch(Ee){return void r.logger.error("error while waiting for the verification event to be sent: ",Ee)}finally{te.removeListener(U.MatrixEventEvent.LocalEventIdReplaced,pe),te.removeListener(U.MatrixEventEvent.Status,me)}}let G=P.getRequest(te),se=!1;if(!G){if(G=A(te),!G)return void r.logger.log(`Crypto: could not find VerificationRequest for ${te.getType()}, and could not create one, so ignoring.`);se=!0,P.setRequest(te,G)}te.setVerificationRequest(G);try{yield G.channel.handleEvent(te,G,$)}catch(pe){r.logger.error("error while handling verification event",pe)}se&&!G.initiatedByMe&&!G.invalid&&!G.observeOnly&&this.baseApis.emit(ue.VerificationRequest,G)})}onToDeviceBadEncrypted(te){return u(this,void 0,void 0,function*(){const P=te.getWireContent(),A=te.getSender(),$=P.algorithm,G=P.sender_key,se=()=>{const Se=this.getRoomDecryptors(t.MEGOLM_ALGORITHM);for(const De of Se)De.retryDecryptionFromSender(G)};if(void 0===A||void 0===G||void 0===G)return;this.lastNewSessionForced[A]=this.lastNewSessionForced[A]||{};const he=this.lastNewSessionForced[A][G]||0;if(he+36e5>Date.now())return r.logger.debug("New session already forced with device "+A+":"+G+" at "+he+": not forcing another"),yield this.olmDevice.recordSessionProblem(G,"wedged",!0),void se();let pe=this.deviceList.getDeviceByIdentityKey($,G);if(!pe&&(yield this.downloadKeys([A],!1),pe=this.deviceList.getDeviceByIdentityKey($,G),!pe))return r.logger.info("Couldn't find device for identity key "+G+": not re-establishing session"),yield this.olmDevice.recordSessionProblem(G,"wedged",!1),void se();const me={};me[A]=[pe],yield t.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,me,!0),this.lastNewSessionForced[A][G]=Date.now();const Ee={algorithm:t.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[c.ToDeviceMessageId]:(0,v.v4)()};yield t.encryptMessageForDevice(Ee.ciphertext,this.userId,this.deviceId,this.olmDevice,A,pe,{type:"m.dummy"}),yield this.olmDevice.recordSessionProblem(G,"wedged",!0),se(),yield this.baseApis.sendToDevice("m.room.encrypted",{[A]:{[pe.deviceId]:Ee}});const _e=yield this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(A,pe.deviceId);for(const Se of _e)this.requestRoomKey(Se.requestBody,Se.recipients,!0)})}onRoomMembership(te,P,A){var $;const G=P.roomId,se=this.roomEncryptors.get(G);se&&(G in this.roomDeviceTrackingState&&("join"==P.membership?(r.logger.log("Join event for "+P.userId+" in "+G),this.deviceList.startTrackingDeviceList(P.userId)):"invite"==P.membership&&!(null===($=this.clientStore.getRoom(G))||void 0===$)&&$.shouldEncryptForInvitedMembers()&&(r.logger.log("Invite event for "+P.userId+" in "+G),this.deviceList.startTrackingDeviceList(P.userId))),se.onRoomMembership(te,P,A))}onRoomKeyRequestEvent(te){const P=te.getContent();if("request"===P.action){const A=new H(te);this.receivedRoomKeyRequests.push(A)}else if("request_cancellation"===P.action){const A=new ne(te);this.receivedRoomKeyRequestCancellations.push(A)}}processReceivedRoomKeyRequests(){return u(this,void 0,void 0,function*(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const te=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const P=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],yield Promise.all(te.map(A=>this.processReceivedRoomKeyRequest(A))),yield Promise.all(P.map(A=>this.processReceivedRoomKeyRequestCancellation(A)))}catch(te){r.logger.error(`Error processing room key requsts: ${te}`)}finally{this.processingRoomKeyRequests=!1}}})}processReceivedRoomKeyRequest(te){return u(this,void 0,void 0,function*(){const P=te.userId,A=te.deviceId,$=te.requestBody,G=$.room_id,se=$.algorithm;if(r.logger.log(`m.room_key_request from ${P}:${A} for ${G} / ${$.session_id} (id ${te.requestId})`),P!==this.userId){if(!this.roomEncryptors.get(G))return void r.logger.debug(`room key request for unencrypted room ${G}`);const pe=this.roomEncryptors.get(G),me=this.deviceList.getStoredDevice(P,A);if(!me)return void r.logger.debug(`Ignoring keyshare for unknown device ${P}:${A}`);try{yield pe.reshareKeyWithDevice($.sender_key,$.session_id,P,me)}catch(Ee){r.logger.warn("Failed to re-share keys for session "+$.session_id+" with device "+P+":"+me.deviceId,Ee)}return}if(A===this.deviceId)return void r.logger.log("Ignoring room key request from ourselves");if(!this.roomDecryptors.has(G))return void r.logger.log(`room key request for unencrypted room ${G}`);const he=this.roomDecryptors.get(G).get(se);if(he){if(yield he.hasKeysForKeyRequest(te))return te.share=()=>{he.shareKeysWithDevice(te)},this.checkDeviceTrust(P,A).isVerified()?(r.logger.log("device is already verified: sharing keys"),void te.share()):void this.emit(ue.RoomKeyRequest,te);r.logger.log(`room key request for unknown session ${G} / `+$.session_id)}else r.logger.log(`room key request for unknown alg ${se} in room ${G}`)})}processReceivedRoomKeyRequestCancellation(te){return u(this,void 0,void 0,function*(){r.logger.log(`m.room_key_request cancellation for ${te.userId}:${te.deviceId} (id ${te.requestId})`),this.emit(ue.RoomKeyRequestCancellation,te)})}getRoomDecryptor(te,P){let A,$;if(te&&(A=this.roomDecryptors.get(te),A||(A=new Map,this.roomDecryptors.set(te,A)),$=A.get(P),$))return $;const G=h.DECRYPTION_CLASSES.get(P);if(!G)throw new h.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+P+'".');return $=new G({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:te??void 0}),A&&A.set(P,$),$}getRoomDecryptors(te){const P=[];for(const A of this.roomDecryptors.values())A.has(te)&&P.push(A.get(te));return P}signObject(te){return u(this,void 0,void 0,function*(){const P=te.signatures||{},A=te.unsigned;delete te.signatures,delete te.unsigned,P[this.userId]=P[this.userId]||{},P[this.userId]["ed25519:"+this.deviceId]=yield this.olmDevice.sign(f.default.stringify(te)),te.signatures=P,void 0!==A&&(te.unsigned=A)})}},a.fixBackupKey=X;class H{constructor(te){const P=te.getContent();this.userId=te.getSender(),this.deviceId=P.requesting_device_id,this.requestId=P.request_id,this.requestBody=P.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}a.IncomingRoomKeyRequest=H;class ne{constructor(te){const P=te.getContent();this.userId=te.getSender(),this.deviceId=P.requesting_device_id,this.requestId=P.request_id}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{"../@types/event":299,"../ReEmitter":309,"../client":313,"../errors":351,"../logger":365,"../models/event":374,"../models/room":382,"../models/room-member":379,"../models/typed-event-emitter":385,"./CrossSigning":316,"./DeviceList":317,"./EncryptionSetup":318,"./OlmDevice":319,"./OutgoingRoomKeyRequestManager":320,"./SecretStorage":322,"./aes":323,"./algorithms":325,"./backup":329,"./dehydration":331,"./deviceinfo":332,"./key_passphrase":334,"./olmlib":335,"./recoverykey":336,"./store/indexeddb-crypto-store":338,"./verification/IllegalMethod":343,"./verification/QRCode":344,"./verification/SAS":345,"./verification/request/InRoomChannel":347,"./verification/request/ToDeviceChannel":348,"./verification/request/VerificationRequest":349,"another-json":1,buffer:68,uuid:287}],334:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__awaiter||function(c,i,r,s){return new(r||(r=Promise))(function(n,o){function h(p){try{e(s.next(p))}catch(b){o(b)}}function l(p){try{e(s.throw(p))}catch(b){o(b)}}function e(p){p.done?n(p.value):function t(n){return n instanceof r?n:new r(function(o){o(n)})}(p.value).then(h,l)}e((s=s.apply(c,i||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.deriveKey=a.keyFromPassphrase=a.keyFromAuthData=void 0;const E=m("../randomstring"),_=m("./crypto"),d=5e5,u=256;function v(c,i,r,s=u){return I(this,void 0,void 0,function*(){if(!_.subtleCrypto||!_.TextEncoder)throw new Error("Password-based backup is not available on this platform");const t=yield _.subtleCrypto.importKey("raw",(new _.TextEncoder).encode(c),{name:"PBKDF2"},!1,["deriveBits"]),n=yield _.subtleCrypto.deriveBits({name:"PBKDF2",salt:(new _.TextEncoder).encode(i),iterations:r,hash:"SHA-512"},t,s);return new Uint8Array(n)})}a.keyFromAuthData=function g(c,i){if(!R.Olm)throw new Error("Olm is not available");if(!c.private_key_salt||!c.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return v(i,c.private_key_salt,c.private_key_iterations,c.private_key_bits||u)},a.keyFromPassphrase=function f(c){return I(this,void 0,void 0,function*(){if(!R.Olm)throw new Error("Olm is not available");const i=(0,E.randomString)(32);return{key:yield v(c,i,d,u),salt:i,iterations:d}})},a.deriveKey=v}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../randomstring":388,"./crypto":330}],335:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__awaiter||function(p,b,y,w){return new(y||(y=Promise))(function(B,J){function z(j){try{L(w.next(j))}catch(C){J(C)}}function M(j){try{L(w.throw(j))}catch(C){J(C)}}function L(j){j.done?B(j.value):function x(B){return B instanceof y?B:new y(function(J){J(B)})}(j.value).then(z,M)}L((w=w.apply(p,b||[])).next())})},_=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(a,"__esModule",{value:!0}),a.decodeBase64=a.encodeUnpaddedBase64=a.encodeBase64=a.isOlmEncrypted=a.pkVerify=a.pkSign=a.verifySignature=a.ensureOlmSessionsForDevices=a.getExistingOlmSessions=a.encryptMessageForDevice=a.MEGOLM_BACKUP_ALGORITHM=a.MEGOLM_ALGORITHM=a.OLM_ALGORITHM=void 0;const d=_(m("another-json")),u=m("../logger"),g=m("../@types/event");var f,p;function r(p,b,y,w){return E(this,void 0,void 0,function*(){const x=w.deviceId;try{yield s(p,b,y,x,w.getFingerprint())}catch(J){return u.logger.error("Unable to verify signature on one-time key for device "+y+":"+x+":",J),null}let B;try{B=yield p.createOutboundSession(w.getIdentityKey(),b.key)}catch(J){return u.logger.error("Error starting olm session with device "+y+":"+x+": "+J),null}return u.logger.log("Started new olm sessionid "+B+" for device "+y+":"+x),B})}function s(p,b,y,w,x){return E(this,void 0,void 0,function*(){const M=((b.signatures||{})[y]||{})["ed25519:"+w];if(!M)throw Error("No signature");const L=Object.assign({},b);"unsigned"in L&&delete L.unsigned,delete L.signatures;const j=d.default.stringify(L);p.verifySignature(x,j,M)})}function h(p){return I.from(p).toString("base64")}(p=f||(f={})).Olm="m.olm.v1.curve25519-aes-sha2",p.Megolm="m.megolm.v1.aes-sha2",p.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2",a.OLM_ALGORITHM=f.Olm,a.MEGOLM_ALGORITHM=f.Megolm,a.MEGOLM_BACKUP_ALGORITHM=f.MegolmBackup,a.encryptMessageForDevice=function v(p,b,y,w,x,B,J){return E(this,void 0,void 0,function*(){const z=B.getIdentityKey(),M=yield w.getSessionIdForDevice(z);if(null===M)return void u.logger.log(`[olmlib.encryptMessageForDevice] Unable to find Olm session for device ${x}:${B.deviceId}`);u.logger.log(`[olmlib.encryptMessageForDevice] Using Olm session ${M} for device ${x}:${B.deviceId}`);const L=Object.assign({sender:b,sender_device:y,keys:{ed25519:w.deviceEd25519Key},recipient:x,recipient_keys:{ed25519:B.getFingerprint()}},J);p[z]=yield w.encryptMessage(z,M,JSON.stringify(L))})},a.getExistingOlmSessions=function c(p,b,y){return E(this,void 0,void 0,function*(){const w={},x={},B=[];for(const[J,z]of Object.entries(y))for(const M of z){const L=M.deviceId,j=M.getIdentityKey();B.push((()=>E(this,void 0,void 0,function*(){const C=yield p.getSessionIdForDevice(j,!0);null===C?(w[J]=w[J]||[],w[J].push(M)):(x[J]=x[J]||{},x[J][L]={device:M,sessionId:C})}))())}return yield Promise.all(B),[w,x]})},a.ensureOlmSessionsForDevices=function i(p,b,y,w=!1,x,B,J=u.logger){return E(this,void 0,void 0,function*(){const z=[],M={},L={};for(const[,T]of Object.entries(y))for(const S of T){const U=S.getIdentityKey();U!==p.deviceCurve25519Key&&(p.sessionsInProgress[U]||(p.sessionsInProgress[U]=new Promise(W=>{L[U]=k=>{delete p.sessionsInProgress[U],W(k)}})))}for(const[T,S]of Object.entries(y)){M[T]={};for(const U of S){const W=U.deviceId,k=U.getIdentityKey();if(k===p.deviceCurve25519Key){J.info("Attempted to start session with ourself! Ignoring"),M[T][W]={device:U,sessionId:null};continue}const D=`for ${k} (${T}:${W})`,Q=yield p.getSessionIdForDevice(k,!!L[k],J);null!==Q&&L[k]&&L[k](),(null===Q||w)&&(J.info(w?`Forcing new Olm session ${D}`:`Making new Olm session ${D}`),z.push([T,W])),M[T][W]={device:U,sessionId:Q}}}if(0===z.length)return M;const j="signed_curve25519";let C,F=`one-time keys for ${z.length} devices`;try{J.debug(`Claiming ${F}`),C=yield b.claimOneTimeKeys(z,j,x),J.debug(`Claimed ${F}`)}catch(T){for(const S of Object.values(L))S();throw J.log(`Failed to claim ${F}`,T,z),T}B&&"failures"in C&&B.push(...Object.keys(C.failures));const V=C.one_time_keys||{},N=[];for(const[T,S]of Object.entries(y)){const U=V[T]||{};for(const W of S){const k=W.deviceId,D=W.getIdentityKey();if(D===p.deviceCurve25519Key||M[T][k].sessionId&&!w)continue;const Q=U[k]||{};let ee=null;for(const ae in Q)0===ae.indexOf(j+":")&&(ee=Q[ae]);ee?N.push(r(p,ee,T,W).then(ae=>{L[D]&&L[D](ae??void 0),M[T][k].sessionId=ae},ae=>{throw L[D]&&L[D](),ae})):(J.warn(`No one-time keys (alg=${j}) for device ${T}:${k}`),L[D]&&L[D]())}}return F=`Olm sessions for ${N.length} devices`,J.debug(`Starting ${F}`),yield Promise.all(N),J.debug(`Started ${F}`),M})},a.verifySignature=s,a.pkSign=function t(p,b,y,w){let x=!1;if(b instanceof Uint8Array){const z=new R.Olm.PkSigning;w=z.init_with_seed(b),b=z,x=!0}const B=p.signatures||{};delete p.signatures;const J=p.unsigned;p.unsigned&&delete p.unsigned;try{const z=B[y]||{};return B[y]=z,z["ed25519:"+w]=b.sign(d.default.stringify(p))}finally{p.signatures=B,J&&(p.unsigned=J),x&&b.free()}},a.pkVerify=function n(p,b,y){const w="ed25519:"+b;if(!(p.signatures&&p.signatures[y]&&p.signatures[y][w]))throw new Error("No signature");const x=p.signatures[y][w],B=new R.Olm.Utility,J=p.signatures;delete p.signatures;const z=p.unsigned;p.unsigned&&delete p.unsigned;try{B.ed25519_verify(b,d.default.stringify(p),x)}finally{p.signatures=J,z&&(p.unsigned=z),B.free()}},a.isOlmEncrypted=function o(p){return p.getSenderKey()?!(p.getWireType()!==g.EventType.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(p.getWireContent().algorithm))||(u.logger.error("Event was not encrypted using an appropriate algorithm"),!1):(u.logger.error("Event has no sender key (not encrypted?)"),!1)},a.encodeBase64=h,a.encodeUnpaddedBase64=function l(p){return h(p).replace(/=+$/g,"")},a.decodeBase64=function e(p){return I.from(p,"base64")}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{"../@types/event":299,"../logger":365,"another-json":1,buffer:68}],336:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__createBinding||(Object.create?function(c,i,r,s){void 0===s&&(s=r);var t=Object.getOwnPropertyDescriptor(i,r);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(c,s,t)}:function(c,i,r,s){void 0===s&&(s=r),c[s]=i[r]}),_=this&&this.__setModuleDefault||(Object.create?function(c,i){Object.defineProperty(c,"default",{enumerable:!0,value:i})}:function(c,i){c.default=i}),d=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var i={};if(null!=c)for(var r in c)"default"!==r&&Object.prototype.hasOwnProperty.call(c,r)&&E(i,c,r);return _(i,c),i};Object.defineProperty(a,"__esModule",{value:!0}),a.decodeRecoveryKey=a.encodeRecoveryKey=void 0;const u=d(m("bs58")),g=[139,1];a.encodeRecoveryKey=function f(c){var i;const r=I.alloc(g.length+c.length+1);r.set(g,0),r.set(c,g.length);let s=0;for(let n=0;n<r.length-1;++n)s^=r[n];return r[r.length-1]=s,null===(i=u.encode(r).match(/.{1,4}/g))||void 0===i?void 0:i.join(" ")},a.decodeRecoveryKey=function v(c){const i=u.decode(c.replace(/ /g,""));let r=0;for(const s of i)r^=s;if(0!==r)throw new Error("Incorrect parity");for(let s=0;s<g.length;++s)if(i[s]!==g[s])throw new Error("Incorrect prefix");if(i.length!==g.length+R.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(i.slice(g.length,g.length+R.Olm.PRIVATE_KEY_LENGTH))}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{bs58:65,buffer:68}],337:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(t,n,o,h){void 0===h&&(h=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(t,h,l)}:function(t,n,o,h){void 0===h&&(h=o),t[h]=n[o]}),I=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),E=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&R(n,t,o);return I(n,t),n},_=this&&this.__awaiter||function(t,n,o,h){return new(o||(o=Promise))(function(e,p){function b(x){try{w(h.next(x))}catch(B){p(B)}}function y(x){try{w(h.throw(x))}catch(B){p(B)}}function w(x){x.done?e(x.value):function l(e){return e instanceof o?e:new o(function(p){p(e)})}(x.value).then(b,y)}w((h=h.apply(t,n||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.upgradeDatabase=a.VERSION=a.Backend=void 0;const d=m("../../logger"),u=E(m("../../utils"));a.Backend=class f{constructor(n){this.db=n,this.nextTxnId=0,n.onversionchange=()=>{d.logger.log(`versionchange for indexeddb ${this.db.name}: closing`),n.close()}}startup(){return _(this,void 0,void 0,function*(){return this})}deleteAllData(){return _(this,void 0,void 0,function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")})}getOrAddOutgoingRoomKeyRequest(n){const o=n.requestBody;return new Promise((h,l)=>{const e=this.db.transaction("outgoingRoomKeyRequests","readwrite");e.onerror=l,this._getOutgoingRoomKeyRequest(e,o,p=>{if(p)return d.logger.log(`already have key request outstanding for ${o.room_id} / ${o.session_id}: not sending another`),void h(p);d.logger.log(`enqueueing key request for ${o.room_id} / `+o.session_id),e.oncomplete=()=>{h(n)},e.objectStore("outgoingRoomKeyRequests").add(n)})})}getOutgoingRoomKeyRequest(n){return new Promise((o,h)=>{const l=this.db.transaction("outgoingRoomKeyRequests","readonly");l.onerror=h,this._getOutgoingRoomKeyRequest(l,n,e=>{o(e)})})}_getOutgoingRoomKeyRequest(n,o,h){const p=n.objectStore("outgoingRoomKeyRequests").index("session").openCursor([o.room_id,o.session_id]);p.onsuccess=()=>{const b=p.result;if(!b)return void h(null);const y=b.value;u.deepCompare(y.requestBody,o)?h(y):b.continue()}}getOutgoingRoomKeyRequestByState(n){if(0===n.length)return Promise.resolve(null);let h,o=0;const e=this.db.transaction("outgoingRoomKeyRequests","readonly"),p=e.objectStore("outgoingRoomKeyRequests"),b=n[o];return p.index("state").openCursor(b).onsuccess=function l(){const w=this.result;w?h=w.value:(o++,o>=n.length||(this.source.openCursor(n[o]).onsuccess=l))},s(e).then(()=>h)}getAllOutgoingRoomKeyRequestsByState(n){return new Promise((o,h)=>{const b=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(n);b.onsuccess=()=>o(b.result),b.onerror=()=>h(b.error)})}getOutgoingRoomKeyRequestsByTarget(n,o,h){let l=0;const e=[],b=this.db.transaction("outgoingRoomKeyRequests","readonly"),y=b.objectStore("outgoingRoomKeyRequests"),w=h[l];return y.index("state").openCursor(w).onsuccess=function p(){const B=this.result;if(B){const J=B.value;J.recipients.some(z=>z.userId===n&&z.deviceId===o)&&e.push(J),B.continue()}else{if(l++,l>=h.length)return;this.source.openCursor(h[l]).onsuccess=p}},s(b).then(()=>e)}updateOutgoingRoomKeyRequest(n,o,h){let l=null;const p=this.db.transaction("outgoingRoomKeyRequests","readwrite");return p.objectStore("outgoingRoomKeyRequests").openCursor(n).onsuccess=function e(){const y=this.result;if(!y)return;const w=y.value;w.state==o?(Object.assign(w,h),y.update(w),l=w):d.logger.warn(`Cannot update room key request from ${o} as it was already updated to ${w.state}`)},s(p).then(()=>l)}deleteOutgoingRoomKeyRequest(n,o){const h=this.db.transaction("outgoingRoomKeyRequests","readwrite"),l=h.objectStore("outgoingRoomKeyRequests").openCursor(n);return l.onsuccess=()=>{const e=l.result;if(!e)return;const p=e.value;p.state==o?e.delete():d.logger.warn(`Cannot delete room key request in state ${p.state} (expected ${o})`)},s(h)}getAccount(n,o){const l=n.objectStore("account").get("-");l.onsuccess=function(){try{o(l.result||null)}catch(e){r(n,e)}}}storeAccount(n,o){n.objectStore("account").put(o,"-")}getCrossSigningKeys(n,o){const l=n.objectStore("account").get("crossSigningKeys");l.onsuccess=function(){try{o(l.result||null)}catch(e){r(n,e)}}}getSecretStorePrivateKey(n,o,h){const e=n.objectStore("account").get(`ssss_cache:${h}`);e.onsuccess=function(){try{o(e.result||null)}catch(p){r(n,p)}}}storeCrossSigningKeys(n,o){n.objectStore("account").put(o,"crossSigningKeys")}storeSecretStorePrivateKey(n,o,h){n.objectStore("account").put(h,`ssss_cache:${o}`)}countEndToEndSessions(n,o){const l=n.objectStore("sessions").count();l.onsuccess=function(){try{o(l.result)}catch(e){r(n,e)}}}getEndToEndSessions(n,o,h){const p=o.objectStore("sessions").index("deviceKey").openCursor(n),b={};p.onsuccess=function(){const y=p.result;if(y)b[y.value.sessionId]={session:y.value.session,lastReceivedMessageTs:y.value.lastReceivedMessageTs},y.continue();else try{h(b)}catch(w){r(o,w)}}}getEndToEndSession(n,o,h,l){const p=h.objectStore("sessions").get([n,o]);p.onsuccess=function(){try{l(p.result?{session:p.result.session,lastReceivedMessageTs:p.result.lastReceivedMessageTs}:null)}catch(b){r(h,b)}}}getAllEndToEndSessions(n,o){const l=n.objectStore("sessions").openCursor();l.onsuccess=function(){try{const e=l.result;e?(o(e.value),e.continue()):o(null)}catch(e){r(n,e)}}}storeEndToEndSession(n,o,h,l){l.objectStore("sessions").put({deviceKey:n,sessionId:o,session:h.session,lastReceivedMessageTs:h.lastReceivedMessageTs})}storeEndToEndSessionProblem(n,o,h){return _(this,void 0,void 0,function*(){const l=this.db.transaction("session_problems","readwrite");l.objectStore("session_problems").put({deviceKey:n,type:o,fixed:h,time:Date.now()}),yield s(l)})}getEndToEndSessionProblem(n,o){return _(this,void 0,void 0,function*(){let h=null;const l=this.db.transaction("session_problems","readwrite"),b=l.objectStore("session_problems").index("deviceKey").getAll(n);return b.onsuccess=()=>{const y=b.result;if(!y.length)return void(h=null);y.sort((x,B)=>x.time-B.time);const w=y[y.length-1];for(const x of y)if(x.time>o)return void(h=Object.assign({},x,{fixed:w.fixed}));h=w.fixed?null:w},yield s(l),h})}filterOutNotifiedErrorDevices(n){return _(this,void 0,void 0,function*(){const h=this.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),l=[];return yield Promise.all(n.map(e=>new Promise(p=>{const{userId:b,deviceInfo:y}=e,w=h.get([b,y.deviceId]);w.onsuccess=function(){w.result||(h.put({userId:b,deviceId:y.deviceId}),l.push(e)),p()}}))),l})}getEndToEndInboundGroupSession(n,o,h,l){let e=!1,p=!1;const y=h.objectStore("inbound_group_sessions").get([n,o]);y.onsuccess=function(){try{e=y.result?y.result.session:null,!1!==p&&l(e,p)}catch(B){r(h,B)}};const x=h.objectStore("inbound_group_sessions_withheld").get([n,o]);x.onsuccess=function(){try{p=x.result?x.result.session:null,!1!==e&&l(e,p)}catch(B){r(h,B)}}}getAllEndToEndInboundGroupSessions(n,o){const l=n.objectStore("inbound_group_sessions").openCursor();l.onsuccess=function(){const e=l.result;if(e){try{o({senderKey:e.value.senderCurve25519Key,sessionId:e.value.sessionId,sessionData:e.value.session})}catch(p){r(n,p)}e.continue()}else try{o(null)}catch(p){r(n,p)}}}addEndToEndInboundGroupSession(n,o,h,l){const p=l.objectStore("inbound_group_sessions").add({senderCurve25519Key:n,sessionId:o,session:h});p.onerror=b=>{var y;"ConstraintError"===(null===(y=p.error)||void 0===y?void 0:y.name)?(b.stopPropagation(),b.preventDefault(),d.logger.log("Ignoring duplicate inbound group session: "+n+" / "+o)):r(l,new Error("Failed to add inbound group session: "+p.error))}}storeEndToEndInboundGroupSession(n,o,h,l){l.objectStore("inbound_group_sessions").put({senderCurve25519Key:n,sessionId:o,session:h})}storeEndToEndInboundGroupSessionWithheld(n,o,h,l){l.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:n,sessionId:o,session:h})}getEndToEndDeviceData(n,o){const l=n.objectStore("device_data").get("-");l.onsuccess=function(){try{o(l.result||null)}catch(e){r(n,e)}}}storeEndToEndDeviceData(n,o){o.objectStore("device_data").put(n,"-")}storeEndToEndRoom(n,o,h){h.objectStore("rooms").put(o,n)}getEndToEndRooms(n,o){const h={},e=n.objectStore("rooms").openCursor();e.onsuccess=function(){const p=e.result;if(p)h[p.key]=p.value,p.continue();else try{o(h)}catch(b){r(n,b)}}}getSessionsNeedingBackup(n){return new Promise((o,h)=>{const l=[],e=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");e.onerror=h,e.oncomplete=function(){o(l)};const p=e.objectStore("sessions_needing_backup"),b=e.objectStore("inbound_group_sessions"),y=p.openCursor();y.onsuccess=function(){const w=y.result;if(w){const x=b.get(w.key);x.onsuccess=function(){l.push({senderKey:x.result.senderCurve25519Key,sessionId:x.result.sessionId,sessionData:x.result.session})},(!n||l.length<n)&&w.continue()}}})}countSessionsNeedingBackup(n){n||(n=this.db.transaction("sessions_needing_backup","readonly"));const o=n.objectStore("sessions_needing_backup");return new Promise((h,l)=>{const e=o.count();e.onerror=l,e.onsuccess=()=>h(e.result)})}unmarkSessionsNeedingBackup(n,o){return _(this,void 0,void 0,function*(){o||(o=this.db.transaction("sessions_needing_backup","readwrite"));const h=o.objectStore("sessions_needing_backup");yield Promise.all(n.map(l=>new Promise((e,p)=>{const b=h.delete([l.senderKey,l.sessionId]);b.onsuccess=e,b.onerror=p})))})}markSessionsNeedingBackup(n,o){return _(this,void 0,void 0,function*(){o||(o=this.db.transaction("sessions_needing_backup","readwrite"));const h=o.objectStore("sessions_needing_backup");yield Promise.all(n.map(l=>new Promise((e,p)=>{const b=h.put({senderCurve25519Key:l.senderKey,sessionId:l.sessionId});b.onsuccess=e,b.onerror=p})))})}addSharedHistoryInboundGroupSession(n,o,h,l){l||(l=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));const e=l.objectStore("shared_history_inbound_group_sessions"),p=e.get([n]);p.onsuccess=()=>{const{sessions:b}=p.result||{sessions:[]};b.push([o,h]),e.put({roomId:n,sessions:b})}}getSharedHistoryInboundGroupSessions(n,o){o||(o=this.db.transaction("shared_history_inbound_group_sessions","readonly"));const l=o.objectStore("shared_history_inbound_group_sessions").get([n]);return new Promise((e,p)=>{l.onsuccess=()=>{const{sessions:b}=l.result||{sessions:[]};e(b)},l.onerror=p})}addParkedSharedHistory(n,o,h){h||(h=this.db.transaction("parked_shared_history","readwrite"));const l=h.objectStore("parked_shared_history"),e=l.get([n]);e.onsuccess=()=>{const{parked:p}=e.result||{parked:[]};p.push(o),l.put({roomId:n,parked:p})}}takeParkedSharedHistory(n,o){o||(o=this.db.transaction("parked_shared_history","readwrite"));const h=o.objectStore("parked_shared_history").openCursor(n);return new Promise((l,e)=>{h.onsuccess=()=>{const p=h.result;if(!p)return void l([]);const b=p.value;p.delete(),l(b)},h.onerror=e})}doTxn(n,o,h,l=d.logger){const b=this.db.transaction(o,n),y=s(b),w=h(b);return y.then(()=>w)}};const v=[t=>{!function i(t){const n=t.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});n.createIndex("session",["requestBody.room_id","requestBody.session_id"]),n.createIndex("state","state")}(t)},t=>{t.createObjectStore("account")},t=>{t.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},t=>{t.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("device_data")},t=>{t.createObjectStore("rooms")},t=>{t.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),t.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},t=>{t.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t=>{t.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}];function r(t,n){t._mx_abortexception=n;try{t.abort()}catch{}}function s(t){return new Promise((n,o)=>{t.oncomplete=()=>{void 0!==t._mx_abortexception&&o(t._mx_abortexception),n(null)},t.onerror=h=>{void 0!==t._mx_abortexception?o(t._mx_abortexception):(d.logger.log("Error performing indexeddb txn",h),o(t.error))},t.onabort=h=>{void 0!==t._mx_abortexception?o(t._mx_abortexception):(d.logger.log("Error performing indexeddb txn",h),o(t.error))}})}a.VERSION=v.length,a.upgradeDatabase=function c(t,n){d.logger.log(`Upgrading IndexedDBCryptoStore from version ${n} to ${a.VERSION}`),v.forEach((o,h)=>{n<=h&&o(t)})}},{"../../logger":365,"../../utils":402}],338:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(r,s,t,n){void 0===n&&(n=t);var o=Object.getOwnPropertyDescriptor(s,t);(!o||("get"in o?!s.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return s[t]}}),Object.defineProperty(r,n,o)}:function(r,s,t,n){void 0===n&&(n=t),r[n]=s[t]}),E=this&&this.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),_=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var t in r)"default"!==t&&Object.prototype.hasOwnProperty.call(r,t)&&I(s,r,t);return E(s,r),s};Object.defineProperty(a,"__esModule",{value:!0}),a.IndexedDBCryptoStore=void 0;const d=m("../../logger"),u=m("./localStorage-crypto-store"),g=m("./memory-crypto-store"),f=_(m("./indexeddb-crypto-store-backend")),v=m("../../errors"),c=_(m("../../indexeddb-helpers"));class i{static exists(s,t){return c.exists(s,t)}constructor(s,t){this.indexedDB=s,this.dbName=t}startup(){return this.backendPromise||(this.backendPromise=new Promise((s,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));d.logger.log(`connecting to indexeddb ${this.dbName}`);const n=this.indexedDB.open(this.dbName,f.VERSION);n.onupgradeneeded=o=>{f.upgradeDatabase(n.result,o.oldVersion)},n.onblocked=()=>{d.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=o=>{d.logger.log("Error connecting to indexeddb",o),t(n.error)},n.onsuccess=()=>{const o=n.result;d.logger.log(`connected to indexeddb ${this.dbName}`),s(new f.Backend(o))}}).then(s=>s.doTxn("readonly",[i.STORE_INBOUND_GROUP_SESSIONS,i.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{s.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>s)).catch(s=>{if("VersionError"===s.name)throw d.logger.warn("Crypto DB is too new for us to use!",s),new v.InvalidCryptoStoreError(v.InvalidCryptoStoreState.TooNew);d.logger.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${s}`);try{return new u.LocalStorageCryptoStore(R.localStorage)}catch(t){return d.logger.warn(`unable to open localStorage: falling back to in-memory store: ${t}`),new g.MemoryCryptoStore}}).then(s=>(this.backend=s,s))),this.backendPromise}deleteAllData(){return new Promise((s,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));d.logger.log(`Removing indexeddb instance: ${this.dbName}`);const n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{d.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=o=>{d.logger.log("Error deleting data from indexeddb",o),t(n.error)},n.onsuccess=()=>{d.logger.log(`Removed indexeddb instance: ${this.dbName}`),s()}}).catch(s=>{d.logger.warn(`unable to delete IndexedDBCryptoStore: ${s}`)})}getOrAddOutgoingRoomKeyRequest(s){return this.backend.getOrAddOutgoingRoomKeyRequest(s)}getOutgoingRoomKeyRequest(s){return this.backend.getOutgoingRoomKeyRequest(s)}getOutgoingRoomKeyRequestByState(s){return this.backend.getOutgoingRoomKeyRequestByState(s)}getAllOutgoingRoomKeyRequestsByState(s){return this.backend.getAllOutgoingRoomKeyRequestsByState(s)}getOutgoingRoomKeyRequestsByTarget(s,t,n){return this.backend.getOutgoingRoomKeyRequestsByTarget(s,t,n)}updateOutgoingRoomKeyRequest(s,t,n){return this.backend.updateOutgoingRoomKeyRequest(s,t,n)}deleteOutgoingRoomKeyRequest(s,t){return this.backend.deleteOutgoingRoomKeyRequest(s,t)}getAccount(s,t){this.backend.getAccount(s,t)}storeAccount(s,t){this.backend.storeAccount(s,t)}getCrossSigningKeys(s,t){this.backend.getCrossSigningKeys(s,t)}getSecretStorePrivateKey(s,t,n){this.backend.getSecretStorePrivateKey(s,t,n)}storeCrossSigningKeys(s,t){this.backend.storeCrossSigningKeys(s,t)}storeSecretStorePrivateKey(s,t,n){this.backend.storeSecretStorePrivateKey(s,t,n)}countEndToEndSessions(s,t){this.backend.countEndToEndSessions(s,t)}getEndToEndSession(s,t,n,o){this.backend.getEndToEndSession(s,t,n,o)}getEndToEndSessions(s,t,n){this.backend.getEndToEndSessions(s,t,n)}getAllEndToEndSessions(s,t){this.backend.getAllEndToEndSessions(s,t)}storeEndToEndSession(s,t,n,o){this.backend.storeEndToEndSession(s,t,n,o)}storeEndToEndSessionProblem(s,t,n){return this.backend.storeEndToEndSessionProblem(s,t,n)}getEndToEndSessionProblem(s,t){return this.backend.getEndToEndSessionProblem(s,t)}filterOutNotifiedErrorDevices(s){return this.backend.filterOutNotifiedErrorDevices(s)}getEndToEndInboundGroupSession(s,t,n,o){this.backend.getEndToEndInboundGroupSession(s,t,n,o)}getAllEndToEndInboundGroupSessions(s,t){this.backend.getAllEndToEndInboundGroupSessions(s,t)}addEndToEndInboundGroupSession(s,t,n,o){this.backend.addEndToEndInboundGroupSession(s,t,n,o)}storeEndToEndInboundGroupSession(s,t,n,o){this.backend.storeEndToEndInboundGroupSession(s,t,n,o)}storeEndToEndInboundGroupSessionWithheld(s,t,n,o){this.backend.storeEndToEndInboundGroupSessionWithheld(s,t,n,o)}storeEndToEndDeviceData(s,t){this.backend.storeEndToEndDeviceData(s,t)}getEndToEndDeviceData(s,t){this.backend.getEndToEndDeviceData(s,t)}storeEndToEndRoom(s,t,n){this.backend.storeEndToEndRoom(s,t,n)}getEndToEndRooms(s,t){this.backend.getEndToEndRooms(s,t)}getSessionsNeedingBackup(s){return this.backend.getSessionsNeedingBackup(s)}countSessionsNeedingBackup(s){return this.backend.countSessionsNeedingBackup(s)}unmarkSessionsNeedingBackup(s,t){return this.backend.unmarkSessionsNeedingBackup(s,t)}markSessionsNeedingBackup(s,t){return this.backend.markSessionsNeedingBackup(s,t)}addSharedHistoryInboundGroupSession(s,t,n,o){this.backend.addSharedHistoryInboundGroupSession(s,t,n,o)}getSharedHistoryInboundGroupSessions(s,t){return this.backend.getSharedHistoryInboundGroupSessions(s,t)}addParkedSharedHistory(s,t,n){this.backend.addParkedSharedHistory(s,t,n)}takeParkedSharedHistory(s,t){return this.backend.takeParkedSharedHistory(s,t)}doTxn(s,t,n,o){return this.backend.doTxn(s,t,n,o)}}a.IndexedDBCryptoStore=i,i.STORE_ACCOUNT="account",i.STORE_SESSIONS="sessions",i.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",i.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",i.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",i.STORE_PARKED_SHARED_HISTORY="parked_shared_history",i.STORE_DEVICE_DATA="device_data",i.STORE_ROOMS="rooms",i.STORE_BACKUP="sessions_needing_backup"}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../../errors":351,"../../indexeddb-helpers":363,"../../logger":365,"./indexeddb-crypto-store-backend":337,"./localStorage-crypto-store":339,"./memory-crypto-store":340}],339:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(b,y,w,x){return new(w||(w=Promise))(function(J,z){function M(C){try{j(x.next(C))}catch(F){z(F)}}function L(C){try{j(x.throw(C))}catch(F){z(F)}}function j(C){C.done?J(C.value):function B(J){return J instanceof w?J:new w(function(z){z(J)})}(C.value).then(M,L)}j((x=x.apply(b,y||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.LocalStorageCryptoStore=void 0;const I=m("../../logger"),E=m("./memory-crypto-store"),_="crypto.",d=_+"account",u=_+"cross_signing_keys",g=_+"notified_error_devices",f=_+"device_data",v=_+"inboundgroupsessions/",c=_+"inboundgroupsessions.withheld/",i=_+"rooms/",r=_+"sessionsneedingbackup";function s(b){return _+"sessions/"+b}function t(b){return _+"session.problems/"+b}function n(b,y){return v+b+"/"+y}function o(b,y){return c+b+"/"+y}function h(b){return i+b}function e(b,y){try{return JSON.parse(b.getItem(y))}catch(w){I.logger.log("Error: Failed to get key %s: %s",y,w.message),I.logger.log(w.stack)}return null}function p(b,y,w){b.setItem(y,JSON.stringify(w))}a.LocalStorageCryptoStore=class l extends E.MemoryCryptoStore{static exists(y){var w;const x=y.length;for(let B=0;B<x;B++)if(null!==(w=y.key(B))&&void 0!==w&&w.startsWith(_))return!0;return!1}constructor(y){super(),this.store=y}countEndToEndSessions(y,w){var x;let B=0;for(let J=0;J<this.store.length;++J)null!==(x=this.store.key(J))&&void 0!==x&&x.startsWith(s(""))&&++B;w(B)}_getEndToEndSessions(y){const w=e(this.store,s(y)),x={};for(const[B,J]of Object.entries(w||{}))x[B]="string"==typeof J?{session:J}:J;return x}getEndToEndSession(y,w,x,B){B(this._getEndToEndSessions(y)[w]||{})}getEndToEndSessions(y,w,x){x(this._getEndToEndSessions(y)||{})}getAllEndToEndSessions(y,w){var x;for(let B=0;B<this.store.length;++B)if(null!==(x=this.store.key(B))&&void 0!==x&&x.startsWith(s(""))){const J=this.store.key(B).split("/")[1];for(const z of Object.values(this._getEndToEndSessions(J)))w(z)}}storeEndToEndSession(y,w,x,B){const J=this._getEndToEndSessions(y)||{};J[w]=x,p(this.store,s(y),J)}storeEndToEndSessionProblem(y,w,x){return R(this,void 0,void 0,function*(){const B=t(y),J=e(this.store,B)||[];J.push({type:w,fixed:x,time:Date.now()}),J.sort((z,M)=>z.time-M.time),p(this.store,B,J)})}getEndToEndSessionProblem(y,w){return R(this,void 0,void 0,function*(){const x=t(y),B=e(this.store,x)||[];if(!B.length)return null;const J=B[B.length-1];for(const z of B)if(z.time>w)return Object.assign({},z,{fixed:J.fixed});return J.fixed?null:J})}filterOutNotifiedErrorDevices(y){return R(this,void 0,void 0,function*(){const w=e(this.store,g)||{},x=[];for(const B of y){const{userId:J,deviceInfo:z}=B;J in w?z.deviceId in w[J]||(x.push(B),w[J][z.deviceId]=!0):(x.push(B),w[J]={[z.deviceId]:!0})}return p(this.store,g,w),x})}getEndToEndInboundGroupSession(y,w,x,B){B(e(this.store,n(y,w)),e(this.store,o(y,w)))}getAllEndToEndInboundGroupSessions(y,w){for(let x=0;x<this.store.length;++x){const B=this.store.key(x);B?.startsWith(v)&&w({senderKey:B.slice(v.length,v.length+43),sessionId:B.slice(v.length+44),sessionData:e(this.store,B)})}w(null)}addEndToEndInboundGroupSession(y,w,x,B){e(this.store,n(y,w))||this.storeEndToEndInboundGroupSession(y,w,x,B)}storeEndToEndInboundGroupSession(y,w,x,B){p(this.store,n(y,w),x)}storeEndToEndInboundGroupSessionWithheld(y,w,x,B){p(this.store,o(y,w),x)}getEndToEndDeviceData(y,w){w(e(this.store,f))}storeEndToEndDeviceData(y,w){p(this.store,f,y)}storeEndToEndRoom(y,w,x){p(this.store,h(y),w)}getEndToEndRooms(y,w){const x={},B=h("");for(let J=0;J<this.store.length;++J){const z=this.store.key(J);z?.startsWith(B)&&(x[z.slice(B.length)]=e(this.store,z))}w(x)}getSessionsNeedingBackup(y){const w=e(this.store,r)||{},x=[];for(const B in w)if(Object.prototype.hasOwnProperty.call(w,B)){const J=B.slice(0,43),z=B.slice(44);if(this.getEndToEndInboundGroupSession(J,z,null,M=>{x.push({senderKey:J,sessionId:z,sessionData:M})}),y&&x.length>=y)break}return Promise.resolve(x)}countSessionsNeedingBackup(){const y=e(this.store,r)||{};return Promise.resolve(Object.keys(y).length)}unmarkSessionsNeedingBackup(y){const w=e(this.store,r)||{};for(const x of y)delete w[x.senderKey+"/"+x.sessionId];return p(this.store,r,w),Promise.resolve()}markSessionsNeedingBackup(y){const w=e(this.store,r)||{};for(const x of y)w[x.senderKey+"/"+x.sessionId]=!0;return p(this.store,r,w),Promise.resolve()}deleteAllData(){return this.store.removeItem(d),Promise.resolve()}getAccount(y,w){w(e(this.store,d))}storeAccount(y,w){p(this.store,d,w)}getCrossSigningKeys(y,w){w(e(this.store,u))}getSecretStorePrivateKey(y,w,x){w(e(this.store,_+`ssss_cache.${x}`))}storeCrossSigningKeys(y,w){p(this.store,u,w)}storeSecretStorePrivateKey(y,w,x){p(this.store,_+`ssss_cache.${w}`,x)}doTxn(y,w,x){return Promise.resolve(x(null))}}},{"../../logger":365,"./memory-crypto-store":340}],340:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(f,v,c,i){void 0===i&&(i=c);var r=Object.getOwnPropertyDescriptor(v,c);(!r||("get"in r?!v.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return v[c]}}),Object.defineProperty(f,i,r)}:function(f,v,c,i){void 0===i&&(i=c),f[i]=v[c]}),I=this&&this.__setModuleDefault||(Object.create?function(f,v){Object.defineProperty(f,"default",{enumerable:!0,value:v})}:function(f,v){f.default=v}),E=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var v={};if(null!=f)for(var c in f)"default"!==c&&Object.prototype.hasOwnProperty.call(f,c)&&R(v,f,c);return I(v,f),v},_=this&&this.__awaiter||function(f,v,c,i){return new(c||(c=Promise))(function(s,t){function n(l){try{h(i.next(l))}catch(e){t(e)}}function o(l){try{h(i.throw(l))}catch(e){t(e)}}function h(l){l.done?s(l.value):function r(s){return s instanceof c?s:new c(function(t){t(s)})}(l.value).then(n,o)}h((i=i.apply(f,v||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MemoryCryptoStore=void 0;const d=m("../../logger"),u=E(m("../../utils"));a.MemoryCryptoStore=class g{constructor(){this.outgoingRoomKeyRequests=[],this.account=null,this.crossSigningKeys=null,this.privateKeys={},this.sessions={},this.sessionProblems={},this.notifiedErrorDevices={},this.inboundGroupSessions={},this.inboundGroupSessionsWithheld={},this.deviceData=null,this.rooms={},this.sessionsNeedingBackup={},this.sharedHistoryInboundGroupSessions={},this.parkedSharedHistory=new Map}startup(){return _(this,void 0,void 0,function*(){return this})}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(v){const c=v.requestBody;return u.promiseTry(()=>{const i=this._getOutgoingRoomKeyRequest(c);return i?(d.logger.log(`already have key request outstanding for ${c.room_id} / ${c.session_id}: not sending another`),i):(d.logger.log(`enqueueing key request for ${c.room_id} / `+c.session_id),this.outgoingRoomKeyRequests.push(v),v)})}getOutgoingRoomKeyRequest(v){return Promise.resolve(this._getOutgoingRoomKeyRequest(v))}_getOutgoingRoomKeyRequest(v){for(const c of this.outgoingRoomKeyRequests)if(u.deepCompare(c.requestBody,v))return c;return null}getOutgoingRoomKeyRequestByState(v){for(const c of this.outgoingRoomKeyRequests)for(const i of v)if(c.state===i)return Promise.resolve(c);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(v){return Promise.resolve(this.outgoingRoomKeyRequests.filter(c=>c.state==v))}getOutgoingRoomKeyRequestsByTarget(v,c,i){const r=[];for(const s of this.outgoingRoomKeyRequests)for(const t of i)s.state===t&&s.recipients.some(n=>n.userId===v&&n.deviceId===c)&&r.push(s);return Promise.resolve(r)}updateOutgoingRoomKeyRequest(v,c,i){for(const r of this.outgoingRoomKeyRequests)if(r.requestId===v)return r.state!==c?(d.logger.warn(`Cannot update room key request from ${c} as it was already updated to ${r.state}`),Promise.resolve(null)):(Object.assign(r,i),Promise.resolve(r));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(v,c){for(let i=0;i<this.outgoingRoomKeyRequests.length;i++){const r=this.outgoingRoomKeyRequests[i];if(r.requestId===v)return r.state!=c?(d.logger.warn(`Cannot delete room key request in state ${r.state} (expected ${c})`),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(i,1),Promise.resolve(r))}return Promise.resolve(null)}getAccount(v,c){c(this.account)}storeAccount(v,c){this.account=c}getCrossSigningKeys(v,c){c(this.crossSigningKeys)}getSecretStorePrivateKey(v,c,i){c(this.privateKeys[i]||null)}storeCrossSigningKeys(v,c){this.crossSigningKeys=c}storeSecretStorePrivateKey(v,c,i){this.privateKeys[c]=i}countEndToEndSessions(v,c){c(Object.keys(this.sessions).length)}getEndToEndSession(v,c,i,r){r((this.sessions[v]||{})[c]||null)}getEndToEndSessions(v,c,i){i(this.sessions[v]||{})}getAllEndToEndSessions(v,c){Object.entries(this.sessions).forEach(([i,r])=>{Object.entries(r).forEach(([s,t])=>{c(Object.assign(Object.assign({},t),{deviceKey:i,sessionId:s}))})})}storeEndToEndSession(v,c,i,r){let s=this.sessions[v];void 0===s&&(s={},this.sessions[v]=s),s[c]=i}storeEndToEndSessionProblem(v,c,i){return _(this,void 0,void 0,function*(){const r=this.sessionProblems[v]=this.sessionProblems[v]||[];r.push({type:c,fixed:i,time:Date.now()}),r.sort((s,t)=>s.time-t.time)})}getEndToEndSessionProblem(v,c){return _(this,void 0,void 0,function*(){const i=this.sessionProblems[v]||[];if(!i.length)return null;const r=i[i.length-1];for(const s of i)if(s.time>c)return Object.assign({},s,{fixed:r.fixed});return r.fixed?null:r})}filterOutNotifiedErrorDevices(v){return _(this,void 0,void 0,function*(){const c=this.notifiedErrorDevices,i=[];for(const r of v){const{userId:s,deviceInfo:t}=r;s in c?t.deviceId in c[s]||(i.push(r),c[s][t.deviceId]=!0):(i.push(r),c[s]={[t.deviceId]:!0})}return i})}getEndToEndInboundGroupSession(v,c,i,r){const s=v+"/"+c;r(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}getAllEndToEndInboundGroupSessions(v,c){for(const i of Object.keys(this.inboundGroupSessions))c({senderKey:i.slice(0,43),sessionId:i.slice(44),sessionData:this.inboundGroupSessions[i]});c(null)}addEndToEndInboundGroupSession(v,c,i,r){const s=v+"/"+c;void 0===this.inboundGroupSessions[s]&&(this.inboundGroupSessions[s]=i)}storeEndToEndInboundGroupSession(v,c,i,r){this.inboundGroupSessions[v+"/"+c]=i}storeEndToEndInboundGroupSessionWithheld(v,c,i,r){this.inboundGroupSessionsWithheld[v+"/"+c]=i}getEndToEndDeviceData(v,c){c(this.deviceData)}storeEndToEndDeviceData(v,c){this.deviceData=v}storeEndToEndRoom(v,c,i){this.rooms[v]=c}getEndToEndRooms(v,c){c(this.rooms)}getSessionsNeedingBackup(v){const c=[];for(const i in this.sessionsNeedingBackup)if(this.inboundGroupSessions[i]&&(c.push({senderKey:i.slice(0,43),sessionId:i.slice(44),sessionData:this.inboundGroupSessions[i]}),v&&i.length>=v))break;return Promise.resolve(c)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(v){for(const c of v)delete this.sessionsNeedingBackup[c.senderKey+"/"+c.sessionId];return Promise.resolve()}markSessionsNeedingBackup(v){for(const c of v)this.sessionsNeedingBackup[c.senderKey+"/"+c.sessionId]=!0;return Promise.resolve()}addSharedHistoryInboundGroupSession(v,c,i){const r=this.sharedHistoryInboundGroupSessions[v]||[];r.push([c,i]),this.sharedHistoryInboundGroupSessions[v]=r}getSharedHistoryInboundGroupSessions(v){return Promise.resolve(this.sharedHistoryInboundGroupSessions[v]||[])}addParkedSharedHistory(v,c){var i;const r=null!==(i=this.parkedSharedHistory.get(v))&&void 0!==i?i:[];r.push(c),this.parkedSharedHistory.set(v,r)}takeParkedSharedHistory(v){var c;const i=null!==(c=this.parkedSharedHistory.get(v))&&void 0!==c?c:[];return this.parkedSharedHistory.delete(v),Promise.resolve(i)}doTxn(v,c,i){return Promise.resolve(i(null))}}},{"../../logger":365,"../../utils":402}],341:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(s,t,n,o){return new(n||(n=Promise))(function(l,e){function p(w){try{y(o.next(w))}catch(x){e(x)}}function b(w){try{y(o.throw(w))}catch(x){e(x)}}function y(w){w.done?l(w.value):function h(l){return l instanceof n?l:new n(function(e){e(l)})}(w.value).then(p,b)}y((o=o.apply(s,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.VerificationBase=a.VerificationEvent=a.SwitchStartEventError=void 0;const I=m("../../models/event"),E=m("../../@types/event"),_=m("../../logger"),d=m("../deviceinfo"),u=m("./Error"),g=m("../CrossSigning"),f=m("../../models/typed-event-emitter"),v=new Error("Verification timed out");class c extends Error{constructor(t){super(),this.startEvent=t}}var i;a.SwitchStartEventError=c,(i=a.VerificationEvent||(a.VerificationEvent={})).Cancel="cancel",a.VerificationBase=class r extends f.TypedEventEmitter{constructor(t,n,o,h,l,e){super(),this.channel=t,this.baseApis=n,this.userId=o,this.deviceId=h,this.startEvent=l,this.request=e,this.cancelled=!1,this._done=!1,this.promise=null,this.transactionTimeoutTimer=null}get initiatedByMe(){if(!this.startEvent)return!0;const t=this.startEvent.getSender(),n=this.startEvent.getContent();return t===this.baseApis.getUserId()&&n.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){_.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout(()=>{!this._done&&!this.cancelled&&(_.logger.info("Triggering verification timeout"),this.cancel(v))},6e5)}endTimer(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(t,n){return this.channel.send(t,n)}waitForEvent(t){if(this._done)return Promise.reject(new Error("Verification is already done"));const n=this.request.getEventFromOtherParty(t);return n?Promise.resolve(n):(this.expectedEvent=t,new Promise((o,h)=>{this.resolveEvent=o,this.rejectEvent=h}))}canSwitchStartEvent(t){return!1}switchStartEvent(t){if(this.canSwitchStartEvent(t))if(_.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){const n=this.rejectEvent;this.rejectEvent=void 0,n(new c(t))}else this.startEvent=t}handleEvent(t){var n;if(!this._done)if(t.getType()===this.expectedEvent)this.expectedEvent!==E.EventType.KeyVerificationDone&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),null===(n=this.resolveEvent)||void 0===n||n.call(this,t));else if(t.getType()===E.EventType.KeyVerificationCancel){const o=this.reject;if(this.reject=void 0,o){const h=t.getContent(),{reason:l,code:e}=h;o(new Error(`Other side cancelled verification because ${l} (${e})`))}}else if(this.expectedEvent){const o=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+t.getType());if(this.expectedEvent=void 0,this.rejectEvent){const h=this.rejectEvent;this.rejectEvent=void 0,h(o)}this.cancel(o)}}done(){var t;return R(this,void 0,void 0,function*(){if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),null===(t=this.resolve)||void 0===t||t.call(this),(0,g.requestKeysDuringVerification)(this.baseApis,this.userId,this.deviceId)})}cancel(t){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(t===v){const n=(0,u.newTimeoutError)();this.send(n.getType(),n.getContent())}else if(t instanceof I.MatrixEvent){if(t.getSender()!==this.userId){const o=t.getContent();t.getType()===E.EventType.KeyVerificationCancel?(o.code=o.code||"m.unknown",o.reason=o.reason||o.body||"Unknown reason",this.send(E.EventType.KeyVerificationCancel,o)):this.send(E.EventType.KeyVerificationCancel,{code:"m.unknown",reason:o.body||"Unknown reason"})}}else this.send(E.EventType.KeyVerificationCancel,{code:"m.unknown",reason:t.toString()});null!==this.promise?this.reject&&this.reject(t):this.promise=Promise.reject(t),this.emit(i.Cancel,t)}}verify(){return this.promise||(this.promise=new Promise((t,n)=>{this.resolve=(...o)=>{this._done=!0,this.endTimer(),t(...o)},this.reject=o=>{this._done=!0,this.endTimer(),n(o)}}),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise((t,n)=>{var o;(null===(o=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(this.userId))||void 0===o?void 0:o.getId())===this.deviceId&&n(new Error("Device ID is the same as the cross-signing ID")),t()}).then(()=>this.doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}verifyKeys(t,n,o){return R(this,void 0,void 0,function*(){const h=[];for(const[l,e]of Object.entries(n)){const p=l.split(":",2)[1],b=this.baseApis.getStoredDevice(t,p);if(b)o(l,b,e),h.push([p,l,b.keys[l]]);else{const y=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(t);y&&y.getId()===p?(o(l,d.DeviceInfo.fromStorage({keys:{[l]:p}},p),e),h.push([p,l,p])):_.logger.warn(`verification: Could not find device ${p} to verify`)}}if(!h.length)throw new Error("No devices could be verified");_.logger.info("Verification completed! Marking devices verified: ",h);for(const[l,e,p]of h)yield this.baseApis.crypto.setDeviceVerification(t,l,!0,null,null,{[e]:p});t==this.baseApis.credentials.userId&&(yield this.baseApis.checkKeyBackup())})}get events(){}}},{"../../@types/event":299,"../../logger":365,"../../models/event":374,"../../models/typed-event-emitter":385,"../CrossSigning":316,"../deviceinfo":332,"./Error":342}],342:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.errorFromEvent=a.newInvalidMessageError=a.newKeyMismatchError=a.newUnexpectedMessageError=a.newUnknownMethodError=a.newTimeoutError=a.newUserCancelledError=a.errorFactory=a.newVerificationError=void 0;const R=m("../../models/event"),I=m("../../@types/event");function E(u,g,f){const v=Object.assign({},{code:u,reason:g},f);return new R.MatrixEvent({type:I.EventType.KeyVerificationCancel,content:v})}function _(u,g){return function(f){return E(u,g,f)}}a.newVerificationError=E,a.errorFactory=_,a.newUserCancelledError=_("m.user","Cancelled by user"),a.newTimeoutError=_("m.timeout","Timed out"),a.newUnknownMethodError=_("m.unknown_method","Unknown method"),a.newUnexpectedMessageError=_("m.unexpected_message","Unexpected message"),a.newKeyMismatchError=_("m.key_mismatch","Key mismatch"),a.newInvalidMessageError=_("m.invalid_message","Invalid message"),a.errorFromEvent=function d(u){const g=u.getContent();if(g){const{code:f,reason:v}=g;return{code:f,reason:v}}return{code:"Unknown error",reason:"m.unknown"}}},{"../../@types/event":299,"../../models/event":374}],343:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(_,d,u,g){return new(u||(u=Promise))(function(v,c){function i(t){try{s(g.next(t))}catch(n){c(n)}}function r(t){try{s(g.throw(t))}catch(n){c(n)}}function s(t){t.done?v(t.value):function f(v){return v instanceof u?v:new u(function(c){c(v)})}(t.value).then(i,r)}s((g=g.apply(_,d||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.IllegalMethod=void 0;const I=m("./Base");class E extends I.VerificationBase{constructor(){super(...arguments),this.doVerification=()=>R(this,void 0,void 0,function*(){throw new Error("Verification is not possible with this method")})}static factory(d,u,g,f,v,c){return new E(d,u,g,f,v,c)}static get NAME(){return"org.matrix.illegal_method"}}a.IllegalMethod=E},{"./Base":341}],344:[function(m,ie,a){(function(R,I){(function(){"use strict";var E=this&&this.__awaiter||function(t,n,o,h){return new(o||(o=Promise))(function(e,p){function b(x){try{w(h.next(x))}catch(B){p(B)}}function y(x){try{w(h.throw(x))}catch(B){p(B)}}function w(x){x.done?e(x.value):function l(e){return e instanceof o?e:new o(function(p){p(e)})}(x.value).then(b,y)}w((h=h.apply(t,n||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.QRCodeData=a.ReciprocateQRCode=a.QrCodeEvent=a.SCAN_QR_CODE_METHOD=a.SHOW_QR_CODE_METHOD=void 0;const _=m("./Base"),d=m("./Error"),u=m("../olmlib"),g=m("../../logger");var f,r,t;a.SHOW_QR_CODE_METHOD="m.qr_code.show.v1",a.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1",(f=a.QrCodeEvent||(a.QrCodeEvent={})).ShowReciprocateQr="show_reciprocate_qr";class v extends _.VerificationBase{constructor(){super(...arguments),this.doVerification=()=>E(this,void 0,void 0,function*(){if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:n}=this.request;if(this.startEvent.getContent().secret!==n?.encodedSharedSecret)throw(0,d.newKeyMismatchError)();yield new Promise((h,l)=>{this.reciprocateQREvent={confirm:h,cancel:()=>l((0,d.newUserCancelledError)())},this.emit(f.ShowReciprocateQr,this.reciprocateQREvent)});const o={};switch(n?.mode){case r.VerifyOtherUser:{const h=n.otherUserMasterKey;o[`ed25519:${h}`]=h;break}case r.VerifySelfTrusted:o[`ed25519:${this.request.targetDevice.deviceId}`]=n.otherDeviceKey;break;case r.VerifySelfUntrusted:{const h=n.myMasterKey;o[`ed25519:${h}`]=h;break}}yield this.verifyKeys(this.userId,o,(h,l,e)=>{const p=o[h];if(!p)throw(0,d.newKeyMismatchError)();if(e!==p)throw g.logger.error("key ID from key info does not match"),(0,d.newKeyMismatchError)();for(const b in l.keys){if(!b.startsWith("ed25519"))continue;const y=o[b];if(!y)throw(0,d.newKeyMismatchError)();if(l.keys[b]!==y)throw g.logger.error("master key does not match"),(0,d.newKeyMismatchError)()}})})}static factory(n,o,h,l,e,p){return new v(n,o,h,l,e,p)}static get NAME(){return"m.reciprocate.v1"}}a.ReciprocateQRCode=v,(t=r||(r={}))[t.VerifyOtherUser=0]="VerifyOtherUser",t[t.VerifySelfTrusted=1]="VerifySelfTrusted",t[t.VerifySelfUntrusted=2]="VerifySelfUntrusted";class s{constructor(n,o,h,l,e,p){this.mode=n,this.sharedSecret=o,this.otherUserMasterKey=h,this.otherDeviceKey=l,this.myMasterKey=e,this.buffer=p}static create(n,o){return E(this,void 0,void 0,function*(){const h=s.generateSharedSecret(),l=s.determineMode(n,o);let e=null,p=null,b=null;if(l===r.VerifyOtherUser)e=o.getStoredCrossSigningForUser(n.otherUserId).getId("master");else if(l===r.VerifySelfTrusted)p=yield s.getOtherDeviceKey(n,o);else if(l===r.VerifySelfUntrusted){const x=o.getUserId();b=o.getStoredCrossSigningForUser(x).getId("master")}const y=s.generateQrData(n,o,l,h,e,p,b),w=s.generateBuffer(y);return new s(l,h,e,p,b,w)})}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){const n=new Uint8Array(11);return R.crypto.getRandomValues(n),(0,u.encodeUnpaddedBase64)(n)}static getOtherDeviceKey(n,o){return E(this,void 0,void 0,function*(){const h=o.getUserId(),l=n.targetDevice,e=l.deviceId?o.getStoredDevice(h,l.deviceId):void 0;if(!e)throw new Error("could not find device "+l?.deviceId);return e.getFingerprint()})}static determineMode(n,o){const h=o.getUserId();let e=r.VerifyOtherUser;return h===n.otherUserId&&(e=o.checkUserTrust(h).isCrossSigningVerified()?r.VerifySelfTrusted:r.VerifySelfUntrusted),e}static generateQrData(n,o,h,l,e,p,b){const y=o.getUserId(),x={prefix:"MATRIX",version:2,mode:h,transactionId:n.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:l},B=o.getStoredCrossSigningForUser(y);return h===r.VerifyOtherUser?(x.firstKeyB64=B.getId("master"),x.secondKeyB64=e):h===r.VerifySelfTrusted?(x.firstKeyB64=B.getId("master"),x.secondKeyB64=p):h===r.VerifySelfUntrusted&&(x.firstKeyB64=o.getDeviceEd25519Key(),x.secondKeyB64=b),x}static generateBuffer(n){let o=I.alloc(0);const h=b=>{const y=I.from([b]);o=I.concat([o,y])},e=(b,y,w=!0)=>{const x=I.from(b,y);w&&(b=>{const y=I.alloc(2);y.writeInt16BE(b,0),o=I.concat([o,y])})(x.byteLength),o=I.concat([o,x])},p=b=>{const y=(0,u.decodeBase64)(b),w=I.from(y);o=I.concat([o,w])};return e(n.prefix,"ascii",!1),h(n.version),h(n.mode),e(n.transactionId,"utf-8"),p(n.firstKeyB64),p(n.secondKeyB64),p(n.secretB64),o}}a.QRCodeData=s}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},m("buffer").Buffer)},{"../../logger":365,"../olmlib":335,"./Base":341,"./Error":342,buffer:68}],345:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__awaiter||function(V,N,T,S){return new(T||(T=Promise))(function(W,k){function D(ae){try{ee(S.next(ae))}catch(ue){k(ue)}}function Q(ae){try{ee(S.throw(ae))}catch(ue){k(ue)}}function ee(ae){ae.done?W(ae.value):function U(W){return W instanceof T?W:new T(function(k){k(W)})}(ae.value).then(D,Q)}ee((S=S.apply(V,N||[])).next())})},E=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(a,"__esModule",{value:!0}),a.SAS=a.SasEvent=void 0;const _=E(m("another-json")),d=m("./Base"),u=m("./Error"),g=m("../../logger"),f=m("./SASDecimal"),v=m("../../@types/event"),c=v.EventType.KeyVerificationStart,i=[v.EventType.KeyVerificationAccept,v.EventType.KeyVerificationKey,v.EventType.KeyVerificationMac];let r;const s=(0,u.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),t=(0,u.errorFactory)("m.mismatched_commitment","Mismatched commitment"),n=[["\u{1f436}","dog"],["\u{1f431}","cat"],["\u{1f981}","lion"],["\u{1f40e}","horse"],["\u{1f984}","unicorn"],["\u{1f437}","pig"],["\u{1f418}","elephant"],["\u{1f430}","rabbit"],["\u{1f43c}","panda"],["\u{1f413}","rooster"],["\u{1f427}","penguin"],["\u{1f422}","turtle"],["\u{1f41f}","fish"],["\u{1f419}","octopus"],["\u{1f98b}","butterfly"],["\u{1f337}","flower"],["\u{1f333}","tree"],["\u{1f335}","cactus"],["\u{1f344}","mushroom"],["\u{1f30f}","globe"],["\u{1f319}","moon"],["\u2601\ufe0f","cloud"],["\u{1f525}","fire"],["\u{1f34c}","banana"],["\u{1f34e}","apple"],["\u{1f353}","strawberry"],["\u{1f33d}","corn"],["\u{1f355}","pizza"],["\u{1f382}","cake"],["\u2764\ufe0f","heart"],["\u{1f642}","smiley"],["\u{1f916}","robot"],["\u{1f3a9}","hat"],["\u{1f453}","glasses"],["\u{1f527}","spanner"],["\u{1f385}","santa"],["\u{1f44d}","thumbs up"],["\u2602\ufe0f","umbrella"],["\u231b","hourglass"],["\u23f0","clock"],["\u{1f381}","gift"],["\u{1f4a1}","light bulb"],["\u{1f4d5}","book"],["\u270f\ufe0f","pencil"],["\u{1f4ce}","paperclip"],["\u2702\ufe0f","scissors"],["\u{1f512}","lock"],["\u{1f511}","key"],["\u{1f528}","hammer"],["\u260e\ufe0f","telephone"],["\u{1f3c1}","flag"],["\u{1f682}","train"],["\u{1f6b2}","bicycle"],["\u2708\ufe0f","aeroplane"],["\u{1f680}","rocket"],["\u{1f3c6}","trophy"],["\u26bd","ball"],["\u{1f3b8}","guitar"],["\u{1f3ba}","trumpet"],["\u{1f514}","bell"],["\u2693\ufe0f","anchor"],["\u{1f3a7}","headphones"],["\u{1f4c1}","folder"],["\u{1f4cc}","pin"]],h={decimal:f.generateDecimalSas,emoji:function o(V){return[V[0]>>2,(3&V[0])<<4|V[1]>>4,(15&V[1])<<2|V[2]>>6,63&V[2],V[3]>>2,(3&V[3])<<4|V[4]>>4,(15&V[4])<<2|V[5]>>6].map(T=>n[T])}};function l(V,N){const T={};for(const S of N)S in h&&(T[S]=h[S](Array.from(V)));return T}const e={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function p(V,N){return function(T,S){const U=V[e[N]](T,S);return g.logger.log("SAS calculateMAC:",N,[T,S],U),U}}const b={"curve25519-hkdf-sha256":function(V,N,T){const S=`${V.baseApis.getUserId()}|${V.baseApis.deviceId}|${V.ourSASPubKey}|`,U=`${V.userId}|${V.deviceId}|${V.theirSASPubKey}|`;return N.generate_bytes("MATRIX_KEY_VERIFICATION_SAS|"+(V.initiatedByMe?S+U:U+S)+V.channel.transactionId,T)},curve25519:function(V,N,T){const S=`${V.baseApis.getUserId()}${V.baseApis.deviceId}`,U=`${V.userId}${V.deviceId}`;return N.generate_bytes("MATRIX_KEY_VERIFICATION_SAS"+(V.initiatedByMe?S+U:U+S)+V.channel.transactionId,T)}},y=["curve25519-hkdf-sha256","curve25519"],w=["sha256"],x=["org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],B=Object.keys(h),J=new Set(y),z=new Set(w),M=new Set(x),L=new Set(B);function j(V,N){return Array.isArray(V)?V.filter(T=>N.has(T)):[]}var C;(C=a.SasEvent||(a.SasEvent={})).ShowSas="show_sas";class F extends d.VerificationBase{constructor(){super(...arguments),this.doVerification=()=>I(this,void 0,void 0,function*(){yield R.Olm.init(),r=r||new R.Olm.Utility,yield this.baseApis.downloadKeys([this.userId]);let N=!1;do{try{return this.initiatedByMe?yield this.doSendVerification():yield this.doRespondVerification()}catch(T){if(!(T instanceof d.SwitchStartEventError))throw T;this.startEvent=T.startEvent,N=!0}}while(N)})}static get NAME(){return"m.sas.v1"}get events(){return i}canSwitchStartEvent(N){return N.getType()===c&&(N.getContent()?.method===F.NAME&&!!this.waitingForAccept)}sendStart(){return I(this,void 0,void 0,function*(){const N=this.channel.completeContent(c,{method:F.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:y,hashes:w,message_authentication_codes:x,short_authentication_string:B});return yield this.channel.sendCompleted(c,N),N})}verifyAndCheckMAC(N,T,S,U){return I(this,void 0,void 0,function*(){const W=b[N](this,S,6),k=new Promise((ee,ae)=>{this.sasEvent={sas:l(W,T),confirm:()=>I(this,void 0,void 0,function*(){try{yield this.sendMAC(S,U),ee()}catch(ue){ae(ue)}}),cancel:()=>ae((0,u.newUserCancelledError)()),mismatch:()=>ae(s())},this.emit(C.ShowSas,this.sasEvent)}),[D]=yield Promise.all([this.waitForEvent(v.EventType.KeyVerificationMac).then(ee=>(this.expectedEvent=v.EventType.KeyVerificationDone,ee)),k]),Q=D.getContent();yield this.checkMAC(S,Q,U)})}doSendVerification(){return I(this,void 0,void 0,function*(){let N,T;if(this.waitingForAccept=!0,N=this.startEvent?this.channel.completedContentFromEvent(this.startEvent):yield this.sendStart(),!this.initiatedByMe)throw new d.SwitchStartEventError(this.startEvent);try{T=yield this.waitForEvent(v.EventType.KeyVerificationAccept)}finally{this.waitingForAccept=!1}let S=T.getContent();const U=j(S.short_authentication_string,L);if(!(J.has(S.key_agreement_protocol)&&z.has(S.hash)&&M.has(S.message_authentication_code)&&U.length))throw(0,u.newUnknownMethodError)();if("string"!=typeof S.commitment)throw(0,u.newInvalidMessageError)();const W=S.key_agreement_protocol,k=S.message_authentication_code,D=S.commitment,Q=new R.Olm.SAS;try{this.ourSASPubKey=Q.get_pubkey(),yield this.send(v.EventType.KeyVerificationKey,{key:this.ourSASPubKey}),T=yield this.waitForEvent(v.EventType.KeyVerificationKey),S=T.getContent();const ee=S.key+_.default.stringify(N);if(r.sha256(ee)!==D)throw t();this.theirSASPubKey=S.key,Q.set_their_key(S.key),yield this.verifyAndCheckMAC(W,U,Q,k)}finally{Q.free()}})}doRespondVerification(){return I(this,void 0,void 0,function*(){let N=this.channel.completedContentFromEvent(this.startEvent);const T=j(y,new Set(N.key_agreement_protocols))[0],S=j(w,new Set(N.hashes))[0],U=j(x,new Set(N.message_authentication_codes))[0],W=j(N.short_authentication_string,L);if(void 0===T||void 0===S||void 0===U||!W.length)throw(0,u.newUnknownMethodError)();const k=new R.Olm.SAS;try{const D=k.get_pubkey()+_.default.stringify(N);yield this.send(v.EventType.KeyVerificationAccept,{key_agreement_protocol:T,hash:S,message_authentication_code:U,short_authentication_string:W,commitment:r.sha256(D)}),N=(yield this.waitForEvent(v.EventType.KeyVerificationKey)).getContent(),this.theirSASPubKey=N.key,k.set_their_key(N.key),this.ourSASPubKey=k.get_pubkey(),yield this.send(v.EventType.KeyVerificationKey,{key:this.ourSASPubKey}),yield this.verifyAndCheckMAC(T,W,k,U)}finally{k.free()}})}sendMAC(N,T){const S={},U=[],W="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,k=`ed25519:${this.baseApis.deviceId}`;S[k]=p(N,T)(this.baseApis.getDeviceEd25519Key(),W+k),U.push(k);const D=this.baseApis.getCrossSigningId();if(D){const ee=`ed25519:${D}`;S[ee]=p(N,T)(D,W+ee),U.push(ee)}const Q=p(N,T)(U.sort().join(","),W+"KEY_IDS");return this.send(v.EventType.KeyVerificationMac,{mac:S,keys:Q})}checkMAC(N,T,S){return I(this,void 0,void 0,function*(){const U="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId;if(T.keys!==p(N,S)(Object.keys(T.mac).sort().join(","),U+"KEY_IDS"))throw(0,u.newKeyMismatchError)();yield this.verifyKeys(this.userId,T.mac,(W,k,D)=>{if(D!==p(N,S)(k.keys[W],U+W))throw(0,u.newKeyMismatchError)()})})}}a.SAS=F}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../../@types/event":299,"../../logger":365,"./Base":341,"./Error":342,"./SASDecimal":346,"another-json":1}],346:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.generateDecimalSas=void 0,a.generateDecimalSas=function R(I){return[1e3+(I[0]<<5|I[1]>>3),1e3+((7&I[1])<<10|I[2]<<2|I[3]>>6),1e3+((63&I[3])<<7|I[4]>>1)]}},{}],347:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(c,i,r,s){return new(r||(r=Promise))(function(n,o){function h(p){try{e(s.next(p))}catch(b){o(b)}}function l(p){try{e(s.throw(p))}catch(b){o(b)}}function e(p){p.done?n(p.value):function t(n){return n instanceof r?n:new r(function(o){o(n)})}(p.value).then(h,l)}e((s=s.apply(c,i||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.InRoomRequests=a.InRoomChannel=void 0;const I=m("./VerificationRequest"),E=m("../../../logger"),d=m("../../../@types/event").EventType.RoomMessage,u="m.reference",g="m.relates_to";class f{constructor(i,r,s){this.client=i,this.roomId=r,this.userId=s}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(i,r){if(f.getEventType(i)!==I.REQUEST_TYPE)return;const t=r.getUserId(),n=i.getSender(),h=i.getContent().to;return n===t?h:h===t?n:void 0}getTimestamp(i){return i.getTs()}static canCreateRequest(i){return i===I.REQUEST_TYPE}canCreateRequest(i){return f.canCreateRequest(i)}static getTransactionId(i){if(f.getEventType(i)===I.REQUEST_TYPE)return i.getId();{const r=i.getRelation();if(r?.rel_type===u)return r.event_id}}static validateEvent(i,r){const s=f.getTransactionId(i);if("string"!=typeof s||0===s.length)return!1;const t=f.getEventType(i),n=i.getContent();if(t===I.REQUEST_TYPE){if(!n||"string"!=typeof n.to||!n.to.length)return E.logger.log("InRoomChannel: validateEvent: no valid to "+(n&&n.to)),!1;if(!f.getOtherPartyUserId(i,r))return E.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${i.getSender()}, ${n&&n.to}`),!1}return I.VerificationRequest.validateEvent(t,i,r)}static getEventType(i){const r=i.getType();if(r===d){const s=i.getContent();if(s){const{msgtype:t}=s;if(t===I.REQUEST_TYPE)return I.REQUEST_TYPE}}return r&&r!==I.REQUEST_TYPE?r:""}handleEvent(i,r,s=!1){return R(this,void 0,void 0,function*(){if(r.hasEventId(i.getId()))return;const t=f.getEventType(i);if(i.getRoomId()!==this.roomId)return;if(!this.userId){const e=f.getOtherPartyUserId(i,this.client);e&&(this.userId=e)}const n=this.client.getUserId(),o=i.getSender();if(this.userId&&o!==n&&o!==this.userId)return void E.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${o}`);this.requestEventId||(this.requestEventId=f.getTransactionId(i));const h=!!i.getUnsigned().transaction_id,l=i.getSender()===this.client.getUserId();return r.handleEvent(t,i,s,h,l)})}completedContentFromEvent(i){const r=Object.assign({},i.getContent());return r[g]=i.getRelation(),r}completeContent(i,r){return r=Object.assign({},r),(i===I.REQUEST_TYPE||i===I.READY_TYPE||i===I.START_TYPE)&&(r.from_device=this.client.getDeviceId()),i===I.REQUEST_TYPE?r={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:I.REQUEST_TYPE,to:this.userId,from_device:r.from_device,methods:r.methods}:r[g]={rel_type:u,event_id:this.transactionId},r}send(i,r){const s=this.completeContent(i,r);return this.sendCompleted(i,s)}sendCompleted(i,r){return R(this,void 0,void 0,function*(){let s=i;i===I.REQUEST_TYPE&&(s=d);const t=yield this.client.sendEvent(this.roomId,s,r);i===I.REQUEST_TYPE&&(this.requestEventId=t.event_id)})}}a.InRoomChannel=f,a.InRoomRequests=class v{constructor(){this.requestsByRoomId=new Map}getRequest(i){const r=i.getRoomId(),s=f.getTransactionId(i);return this.getRequestByTxnId(r,s)}getRequestByChannel(i){return this.getRequestByTxnId(i.roomId,i.transactionId)}getRequestByTxnId(i,r){const s=this.requestsByRoomId.get(i);if(s)return s.get(r)}setRequest(i,r){this.doSetRequest(i.getRoomId(),f.getTransactionId(i),r)}setRequestByChannel(i,r){this.doSetRequest(i.roomId,i.transactionId,r)}doSetRequest(i,r,s){let t=this.requestsByRoomId.get(i);t||(t=new Map,this.requestsByRoomId.set(i,t)),t.set(r,s)}removeRequest(i){const r=i.getRoomId(),s=this.requestsByRoomId.get(r);s&&(s.delete(f.getTransactionId(i)),0===s.size&&this.requestsByRoomId.delete(r))}findRequestInProgress(i){const r=this.requestsByRoomId.get(i);if(r)for(const s of r.values())if(s.pending)return s}}},{"../../../@types/event":299,"../../../logger":365,"./VerificationRequest":349}],348:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(v,c,i,r){return new(i||(i=Promise))(function(t,n){function o(e){try{l(r.next(e))}catch(p){n(p)}}function h(e){try{l(r.throw(e))}catch(p){n(p)}}function l(e){e.done?t(e.value):function s(t){return t instanceof i?t:new i(function(n){n(t)})}(e.value).then(o,h)}l((r=r.apply(v,c||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.ToDeviceRequests=a.ToDeviceChannel=void 0;const I=m("../../../randomstring"),E=m("../../../logger"),_=m("./VerificationRequest"),d=m("../Error"),u=m("../../../models/event");class g{constructor(c,i,r,s,t){this.client=c,this.userId=i,this.devices=r,this.transactionId=s,this.deviceId=t}isToDevices(c){if(c.length===this.devices.length){for(const i of c)if(!this.devices.includes(i))return!1;return!0}return!1}static getEventType(c){return c.getType()}static getTransactionId(c){const i=c.getContent();return i&&i.transaction_id}static canCreateRequest(c){return c===_.REQUEST_TYPE||c===_.START_TYPE}canCreateRequest(c){return g.canCreateRequest(c)}static validateEvent(c,i){if(c.isCancelled())return E.logger.warn("Ignoring flagged verification request from "+c.getSender()),!1;const r=c.getContent();if(!r)return E.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!r.transaction_id)return E.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const s=c.getType();if(s===_.REQUEST_TYPE){if(!Number.isFinite(r.timestamp))return E.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(c.getSender()===i.getUserId()&&r.from_device==i.getDeviceId())return E.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return _.VerificationRequest.validateEvent(s,c,i)}getTimestamp(c){const i=c.getContent();return i&&i.timestamp}handleEvent(c,i,r=!1){return R(this,void 0,void 0,function*(){const s=c.getType(),t=c.getContent();if(s===_.REQUEST_TYPE||s===_.READY_TYPE||s===_.START_TYPE){this.transactionId||(this.transactionId=t.transaction_id);const l=t.from_device;if(!this.deviceId&&this.devices.includes(l)&&(this.deviceId=l),!this.deviceId||this.deviceId!==l){const e=this.completeContent(_.CANCEL_TYPE,(0,d.errorFromEvent)((0,d.newUnexpectedMessageError)()));return this.sendToDevices(_.CANCEL_TYPE,e,[l])}}const n=i.phase===_.PHASE_STARTED||i.phase===_.PHASE_READY;if(yield i.handleEvent(c.getType(),c,r,!1,!1),(s===_.START_TYPE||s===_.READY_TYPE)&&!n&&(i.phase===_.PHASE_STARTED||i.phase===_.PHASE_READY)&&this.deviceId){const l=this.devices.filter(e=>e!==this.deviceId&&e!==this.client.getDeviceId());if(l.length){const e=this.completeContent(_.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"});yield this.sendToDevices(_.CANCEL_TYPE,e,l)}}})}completedContentFromEvent(c){return c.getContent()}completeContent(c,i){return i=Object.assign({},i),this.transactionId&&(i.transaction_id=this.transactionId),(c===_.REQUEST_TYPE||c===_.READY_TYPE||c===_.START_TYPE)&&(i.from_device=this.client.getDeviceId()),c===_.REQUEST_TYPE&&(i.timestamp=Date.now()),i}send(c,i={}){(c===_.REQUEST_TYPE||c===_.START_TYPE)&&!this.transactionId&&(this.transactionId=g.makeTransactionId());const r=this.completeContent(c,i);return this.sendCompleted(c,r)}sendCompleted(c,i){return R(this,void 0,void 0,function*(){let r;r=c===_.REQUEST_TYPE||c===_.CANCEL_TYPE&&!this.deviceId?yield this.sendToDevices(c,i,this.devices):yield this.sendToDevices(c,i,[this.deviceId]);const s=new u.MatrixEvent({sender:this.client.getUserId(),content:i,type:c});return yield this.request.handleEvent(c,s,!0,!0,!0),r})}sendToDevices(c,i,r){return R(this,void 0,void 0,function*(){if(r.length){const s={};for(const t of r)s[t]=i;yield this.client.sendToDevice(c,{[this.userId]:s})}})}static makeTransactionId(){return(0,I.randomString)(32)}}a.ToDeviceChannel=g,a.ToDeviceRequests=class f{constructor(){this.requestsByUserId=new Map}getRequest(c){return this.getRequestBySenderAndTxnId(c.getSender(),g.getTransactionId(c))}getRequestByChannel(c){return this.getRequestBySenderAndTxnId(c.userId,c.transactionId)}getRequestBySenderAndTxnId(c,i){const r=this.requestsByUserId.get(c);if(r)return r.get(i)}setRequest(c,i){this.setRequestBySenderAndTxnId(c.getSender(),g.getTransactionId(c),i)}setRequestByChannel(c,i){this.setRequestBySenderAndTxnId(c.userId,c.transactionId,i)}setRequestBySenderAndTxnId(c,i,r){let s=this.requestsByUserId.get(c);s||(s=new Map,this.requestsByUserId.set(c,s)),s.set(i,r)}removeRequest(c){const i=c.getSender(),r=this.requestsByUserId.get(i);r&&(r.delete(g.getTransactionId(c)),0===r.size&&this.requestsByUserId.delete(i))}findRequestInProgress(c,i){const r=this.requestsByUserId.get(c);if(r)for(const s of r.values())if(s.pending&&s.channel.isToDevices(i))return s}getRequestsInProgress(c){const i=this.requestsByUserId.get(c);return i?Array.from(i.values()).filter(r=>r.pending):[]}}},{"../../../logger":365,"../../../models/event":374,"../../../randomstring":388,"../Error":342,"./VerificationRequest":349}],349:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(s,t,n,o){return new(n||(n=Promise))(function(l,e){function p(w){try{y(o.next(w))}catch(x){e(x)}}function b(w){try{y(o.throw(w))}catch(x){e(x)}}function y(w){w.done?l(w.value):function h(l){return l instanceof n?l:new n(function(e){e(l)})}(w.value).then(p,b)}y((o=o.apply(s,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.VerificationRequest=a.VerificationRequestEvent=a.PHASE_DONE=a.PHASE_CANCELLED=a.PHASE_STARTED=a.PHASE_READY=a.PHASE_REQUESTED=a.PHASE_UNSENT=a.Phase=a.READY_TYPE=a.DONE_TYPE=a.CANCEL_TYPE=a.START_TYPE=a.REQUEST_TYPE=a.EVENT_PREFIX=void 0;const I=m("../../../logger"),E=m("../Error"),_=m("../QRCode"),d=m("../../../@types/event"),u=m("../../../models/typed-event-emitter");var c,s,i;a.EVENT_PREFIX="m.key.verification.",a.REQUEST_TYPE=a.EVENT_PREFIX+"request",a.START_TYPE=a.EVENT_PREFIX+"start",a.CANCEL_TYPE=a.EVENT_PREFIX+"cancel",a.DONE_TYPE=a.EVENT_PREFIX+"done",a.READY_TYPE=a.EVENT_PREFIX+"ready",(s=c=a.Phase||(a.Phase={}))[s.Unsent=1]="Unsent",s[s.Requested=2]="Requested",s[s.Ready=3]="Ready",s[s.Started=4]="Started",s[s.Cancelled=5]="Cancelled",s[s.Done=6]="Done",a.PHASE_UNSENT=c.Unsent,a.PHASE_REQUESTED=c.Requested,a.PHASE_READY=c.Ready,a.PHASE_STARTED=c.Started,a.PHASE_CANCELLED=c.Cancelled,a.PHASE_DONE=c.Done,function(s){s.Change="change"}(i=a.VerificationRequestEvent||(a.VerificationRequestEvent={})),a.VerificationRequest=class r extends u.TypedEventEmitter{constructor(t,n,o){super(),this.channel=t,this.verificationMethods=n,this.client=o,this.eventsByUs=new Map,this.eventsByThem=new Map,this._observeOnly=!1,this.timeoutTimer=null,this._accepting=!1,this._declining=!1,this.verifierHasFinished=!1,this._cancelled=!1,this._chosenMethod=null,this._qrCodeData=null,this.requestReceivedAt=null,this.commonMethods=[],this.cancelOnTimeout=()=>R(this,void 0,void 0,function*(){try{this.initiatedByMe?yield this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):yield this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(h){I.logger.error("Error while cancelling verification request",h)}}),this.channel.request=this,this.setPhase(a.PHASE_UNSENT,!1)}static validateEvent(t,n,o){const h=n.getContent();return!(!t||!t.startsWith(a.EVENT_PREFIX))&&(h?t!==a.REQUEST_TYPE&&t!==a.READY_TYPE||Array.isArray(h.methods)?t!==a.REQUEST_TYPE&&t!==a.READY_TYPE&&t!==a.START_TYPE||"string"==typeof h.from_device&&0!==h.from_device.length||(I.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(I.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(I.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return this.phase===a.PHASE_UNSENT}get requested(){return this.phase===a.PHASE_REQUESTED}get cancelled(){return this.phase===a.PHASE_CANCELLED}get ready(){return this.phase===a.PHASE_READY}get started(){return this.phase===a.PHASE_STARTED}get done(){return this.phase===a.PHASE_DONE}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(t){let n=this.channel.getTimestamp(t)+6e5;return this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=a.PHASE_REQUESTED&&(n=Math.min(n,this.requestReceivedAt+12e4)),Math.max(0,n-Date.now())}get timeout(){const t=this.getEventByEither(a.REQUEST_TYPE);return t?this.calculateEventTimeout(t):0}get requestEvent(){return this.getEventByEither(a.REQUEST_TYPE)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<a.PHASE_READY&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==a.PHASE_DONE&&this._phase!==a.PHASE_CANCELLED}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(t,n=!1){if(!n&&!this.ready&&!this.started)return!1;const o=this.eventsByThem.get(a.REQUEST_TYPE)||this.eventsByThem.get(a.READY_TYPE);if(!o){if(this.started&&this.initiatedByMe){const e=this.eventsByUs.get(a.START_TYPE),p=e&&e.getContent();return t==(p&&p.method)}return!1}const h=o.getContent();if(!h)return!1;const{methods:l}=h;return!!Array.isArray(l)&&l.includes(t)}get initiatedByMe(){if(this._phase===a.PHASE_UNSENT&&this.eventsByUs.size+this.eventsByThem.size===0)return!0;const n=this.eventsByUs.has(a.REQUEST_TYPE),o=this.eventsByThem.has(a.REQUEST_TYPE);if(n&&!o)return!0;if(!n&&o)return!1;const h=this.eventsByUs.has(a.START_TYPE),l=this.eventsByThem.has(a.START_TYPE);return!(!h||l)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){const t=this.eventsByUs.get(a.CANCEL_TYPE),n=this.eventsByThem.get(a.CANCEL_TYPE);return t&&(!n||t.getId()<n.getId())?t.getSender():n?n.getSender():void 0}get cancellationCode(){const t=this.getEventByEither(a.CANCEL_TYPE);return t?t.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const n=(this.eventsByThem.get(a.REQUEST_TYPE)||this.eventsByThem.get(a.READY_TYPE)||this.eventsByThem.get(a.START_TYPE))?.getContent(),o=n?.from_device;return{userId:this.otherUserId,deviceId:o}}beginKeyVerification(t,n=null){if(!this.observeOnly&&!this._verifier&&(this.phase===a.PHASE_REQUESTED||this.phase===a.PHASE_READY||this.phase===a.PHASE_UNSENT&&this.channel.canCreateRequest(a.START_TYPE))){if(this.commonMethods.length&&!this.commonMethods.includes(t)||(this._verifier=this.createVerifier(t,null,n),!this._verifier))throw(0,E.newUnknownMethodError)();this._chosenMethod=t}return this._verifier}sendRequest(){return R(this,void 0,void 0,function*(){if(!this.observeOnly&&this._phase===a.PHASE_UNSENT){const t=[...this.verificationMethods.keys()];yield this.channel.send(a.REQUEST_TYPE,{methods:t})}})}cancel({reason:t="User declined",code:n="m.user"}={}){return R(this,void 0,void 0,function*(){if(!this.observeOnly&&this._phase!==a.PHASE_CANCELLED){if(this._declining=!0,this.emit(i.Change),this._verifier)return this._verifier.cancel((0,E.errorFactory)(n,t)());this._cancellingUserId=this.client.getUserId(),yield this.channel.send(a.CANCEL_TYPE,{code:n,reason:t})}})}accept(){return R(this,void 0,void 0,function*(){if(!this.observeOnly&&this.phase===a.PHASE_REQUESTED&&!this.initiatedByMe){const t=[...this.verificationMethods.keys()];this._accepting=!0,this.emit(i.Change),yield this.channel.send(a.READY_TYPE,{methods:t})}})}waitFor(t){return new Promise((n,o)=>{const h=()=>{let l=!1;return t(this)?(n(this),l=!0):this.cancelled&&(o(new Error("cancelled")),l=!0),l&&this.off(i.Change,h),l};h()||this.on(i.Change,h)})}setPhase(t,n=!0){this._phase=t,n&&this.emit(i.Change)}getEventByEither(t){return this.eventsByThem.get(t)||this.eventsByUs.get(t)}getEventBy(t,n=!1){return n?this.eventsByThem.get(t):this.eventsByUs.get(t)}calculatePhaseTransitions(){const t=[{phase:a.PHASE_UNSENT}],n=()=>t[t.length-1].phase,o=this.eventsByThem.has(a.REQUEST_TYPE),h=this.getEventBy(a.REQUEST_TYPE,o);h&&t.push({phase:a.PHASE_REQUESTED,event:h});const l=h&&this.getEventBy(a.READY_TYPE,!o);let e;if(l&&n()===a.PHASE_REQUESTED&&t.push({phase:a.PHASE_READY,event:l}),l||!h){const y=this.eventsByThem.get(a.START_TYPE),w=this.eventsByUs.get(a.START_TYPE);e=y&&w?y.getSender()<w.getSender()?y:w:y||w}else e=this.getEventBy(a.START_TYPE,!o);if(e){const y=n()===a.PHASE_REQUESTED&&h?.getSender()!==e.getSender(),w=n()===a.PHASE_UNSENT&&this.channel.canCreateRequest(a.START_TYPE);(y||n()===a.PHASE_READY||w)&&t.push({phase:a.PHASE_STARTED,event:e})}const p=this.eventsByUs.get(a.DONE_TYPE);(this.verifierHasFinished||p&&n()===a.PHASE_STARTED)&&t.push({phase:a.PHASE_DONE});const b=this.getEventByEither(a.CANCEL_TYPE);return(this._cancelled||b)&&n()!==a.PHASE_DONE&&t.push({phase:a.PHASE_CANCELLED,event:b}),t}transitionToPhase(t){const{phase:n,event:o}=t;if((n===a.PHASE_REQUESTED||n===a.PHASE_READY)&&!this.wasSentByOwnDevice(o)){const h=o.getContent();this.commonMethods=h.methods.filter(l=>this.verificationMethods.has(l))}if(this.observeOnly||(n===a.PHASE_REQUESTED||n===a.PHASE_STARTED||n===a.PHASE_READY)&&this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(o)&&!this.wasSentByOwnDevice(o)&&(this._observeOnly=!0),n===a.PHASE_STARTED){const{method:h}=o.getContent();!this._verifier&&!this.observeOnly&&(this._verifier=this.createVerifier(h,o),this._verifier?this._chosenMethod=h:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${h}`}))}}applyPhaseTransitions(){const t=this.calculatePhaseTransitions(),n=t.findIndex(h=>h.phase===this.phase),o=t.slice(n+1);for(const h of o)this.transitionToPhase(h);return o}isWinningStartRace(t){if(t.getType()!==a.START_TYPE)return!1;const n=this._verifier.startEvent;let o,h;if(this.isSelfVerification)if(n){const l=n.getContent();o=l&&l.from_device}else o=this.client.getDeviceId();else o=n?n.getSender():this.client.getUserId();if(this.isSelfVerification){const l=t.getContent();h=l&&l.from_device}else h=t.getSender();return h<o}hasEventId(t){for(const n of this.eventsByUs.values())if(n.getId()===t)return!0;for(const n of this.eventsByThem.values())if(n.getId()===t)return!0;return!1}handleEvent(t,n,o,h,l){var e;return R(this,void 0,void 0,function*(){if(this.done||this.cancelled)return;const p=this._observeOnly;if(this.adjustObserveOnly(n,o),!this.observeOnly&&!h&&(yield this.cancelOnError(t,n))||(l?this.eventsByUs.has(t):this.eventsByThem.has(t)))return;const y=this.phase;this.addEvent(t,n,l);const w=this.applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const x=this.isWinningStartRace(n);this._verifier.canSwitchStartEvent(n)&&x?this._verifier.switchStartEvent(n):h||(t===a.CANCEL_TYPE||null!==(e=this._verifier.events)&&void 0!==e&&e.includes(t))&&this._verifier.handleEvent(n)}if(w.length){o&&w.some(J=>J.phase===a.PHASE_READY)&&this.otherPartySupportsMethod(_.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=yield _.QRCodeData.create(this,this.client));const x=w[w.length-1],{phase:B}=x;this.setupTimeout(B),this.setPhase(B)}else this._observeOnly!==p&&this.emit(i.Change)}finally{I.logger.log(`Verification request ${this.channel.transactionId}: ${t} event with id:${n.getId()}, content:${JSON.stringify(n.getContent())} deviceId:${this.channel.deviceId}, sender:${n.getSender()}, isSentByUs:${l}, isLiveEvent:${o}, isRemoteEcho:${h}, phase:${y}=>${this.phase}, observeOnly:${p}=>${this._observeOnly}`)}})}setupTimeout(t){!this.timeoutTimer&&!this.observeOnly&&t===a.PHASE_REQUESTED&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer&&(t===a.PHASE_STARTED||t===a.PHASE_READY||t===a.PHASE_DONE||t===a.PHASE_CANCELLED)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}cancelOnError(t,n){return R(this,void 0,void 0,function*(){if(t===a.START_TYPE){const l=n.getContent().method;if(!this.verificationMethods.has(l))return yield this.cancel((0,E.errorFromEvent)((0,E.newUnknownMethodError)())),!0}if(this.phase!==a.PHASE_UNSENT&&(t===a.REQUEST_TYPE&&this.phase!==a.PHASE_UNSENT||t===a.READY_TYPE&&this.phase!==a.PHASE_REQUESTED&&this.phase!==a.PHASE_STARTED)){I.logger.warn(`Cancelling, unexpected ${t} verification event from ${n.getSender()}`);const l=`Unexpected ${t} event in phase ${this.phase}`;return yield this.cancel((0,E.errorFromEvent)((0,E.newUnexpectedMessageError)({reason:l}))),!0}return!1})}adjustObserveOnly(t,n=!1){n||(this._observeOnly=!0),this.calculateEventTimeout(t)<3e3&&(this._observeOnly=!0)}addEvent(t,n,o=!1){if(o?this.eventsByUs.set(t,n):this.eventsByThem.set(t,n),t===a.REQUEST_TYPE){for(const[h,l]of this.eventsByThem.entries())l.getSender()!==this.otherUserId&&this.eventsByThem.delete(h);this.requestReceivedAt=Date.now()}}createVerifier(t,n=null,o=null){o||(o=this.targetDevice);const{userId:h,deviceId:l}=o,e=this.verificationMethods.get(t);if(e)return new e(this.channel,this.client,h,l,n,this);I.logger.warn("could not find verifier constructor for method",t)}wasSentByOwnUser(t){return t?.getSender()===this.client.getUserId()}wasSentByOwnDevice(t){if(!this.wasSentByOwnUser(t))return!1;const n=t.getContent();return!(!n||n.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const t=this.applyPhaseTransitions();t.length&&this.setPhase(t[t.length-1].phase)}onVerifierFinished(){this.channel.send(d.EventType.KeyVerificationDone,{}),this.verifierHasFinished=!0;const t=this.applyPhaseTransitions();t.length&&this.setPhase(t[t.length-1].phase)}getEventFromOtherParty(t){return this.eventsByThem.get(t)}}},{"../../../@types/event":299,"../../../logger":365,"../../../models/typed-event-emitter":385,"../Error":342,"../QRCode":344}],350:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(s,t,n,o){return new(n||(n=Promise))(function(l,e){function p(w){try{y(o.next(w))}catch(x){e(x)}}function b(w){try{y(o.throw(w))}catch(x){e(x)}}function y(w){w.done?l(w.value):function h(l){return l instanceof n?l:new n(function(e){e(l)})}(w.value).then(p,b)}y((o=o.apply(s,t||[])).next())})},I=this&&this.__asyncValues||function(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=s[Symbol.asyncIterator];return t?t.call(s):(s="function"==typeof __values?__values(s):s[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(l){n[l]=s[l]&&function(e){return new Promise(function(p,b){!function h(l,e,p,b){Promise.resolve(b).then(function(y){l({value:y,done:p})},e)}(p,b,(e=s[l](e)).done,e.value)})}}};Object.defineProperty(a,"__esModule",{value:!0}),a.RoomWidgetClient=void 0;const E=m("matrix-widget-api"),_=m("./models/event"),d=m("./@types/event"),u=m("./logger"),g=m("./client"),f=m("./sync"),v=m("./sliding-sync-sdk"),c=m("./models/event"),i=m("./models/user");a.RoomWidgetClient=class r extends g.MatrixClient{constructor(t,n,o,h){var l,e,p,b,y,w,x,B,J,z;super(h),this.widgetApi=t,this.capabilities=n,this.roomId=o,this.widgetApiReady=new Promise(M=>this.widgetApi.once("ready",M)),this.syncState=null,this.onEvent=M=>R(this,void 0,void 0,function*(){if(M.preventDefault(),M.detail.data.room_id===this.roomId){const L=new c.MatrixEvent(M.detail.data);yield this.syncApi.injectRoomEvents(this.room,[],[L]),this.emit(g.ClientEvent.Event,L),this.setSyncState(f.SyncState.Syncing),u.logger.info(`Received event ${L.getId()} ${L.getType()} ${L.getStateKey()}`)}else{const{event_id:L,room_id:j}=M.detail.data;u.logger.info(`Received event ${L} for a different room ${j}; discarding`)}yield this.ack(M)}),this.onToDevice=M=>R(this,void 0,void 0,function*(){M.preventDefault();const L=new c.MatrixEvent({type:M.detail.data.type,sender:M.detail.data.sender,content:M.detail.data.content});M.detail.data.encrypted&&L.makeEncrypted(d.EventType.RoomMessageEncrypted,{},"",""),this.emit(g.ClientEvent.ToDeviceEvent,L),this.setSyncState(f.SyncState.Syncing),yield this.ack(M)}),(!(null===(l=n.sendEvent)||void 0===l)&&l.length||!(null===(e=n.receiveEvent)||void 0===e)&&e.length||!0===n.sendMessage||Array.isArray(n.sendMessage)&&n.sendMessage.length||!0===n.receiveMessage||Array.isArray(n.receiveMessage)&&n.receiveMessage.length||!(null===(p=n.sendState)||void 0===p)&&p.length||!(null===(b=n.receiveState)||void 0===b)&&b.length)&&t.requestCapabilityForRoomTimeline(o),null===(y=n.sendEvent)||void 0===y||y.forEach(M=>t.requestCapabilityToSendEvent(M)),null===(w=n.receiveEvent)||void 0===w||w.forEach(M=>t.requestCapabilityToReceiveEvent(M)),!0===n.sendMessage?t.requestCapabilityToSendMessage():Array.isArray(n.sendMessage)&&n.sendMessage.forEach(M=>t.requestCapabilityToSendMessage(M)),!0===n.receiveMessage?t.requestCapabilityToReceiveMessage():Array.isArray(n.receiveMessage)&&n.receiveMessage.forEach(M=>t.requestCapabilityToReceiveMessage(M)),null===(x=n.sendState)||void 0===x||x.forEach(({eventType:M,stateKey:L})=>t.requestCapabilityToSendState(M,L)),null===(B=n.receiveState)||void 0===B||B.forEach(({eventType:M,stateKey:L})=>t.requestCapabilityToReceiveState(M,L)),null===(J=n.sendToDevice)||void 0===J||J.forEach(M=>t.requestCapabilityToSendToDevice(M)),null===(z=n.receiveToDevice)||void 0===z||z.forEach(M=>t.requestCapabilityToReceiveToDevice(M)),n.turnServers&&t.requestCapability(E.MatrixCapabilities.MSC3846TurnServers),t.on(`action:${E.WidgetApiToWidgetAction.SendEvent}`,this.onEvent),t.on(`action:${E.WidgetApiToWidgetAction.SendToDevice}`,this.onToDevice),t.start()}startClient(t={}){var n,o;return R(this,void 0,void 0,function*(){this.lifecycle=new AbortController;const h=this.getUserId();h&&this.store.storeUser(new i.User(h)),this.syncApi=t.slidingSync?new v.SlidingSyncSdk(t.slidingSync,this,t):new f.SyncApi(this,t),this.room=this.syncApi.createRoom(this.roomId),this.store.storeRoom(this.room),yield this.widgetApiReady,yield Promise.all(null!==(o=null===(n=this.capabilities.receiveState)||void 0===n?void 0:n.map(({eventType:l,stateKey:e})=>R(this,void 0,void 0,function*(){const b=(yield this.widgetApi.readStateEvents(l,void 0,e,[this.roomId])).map(y=>new c.MatrixEvent(y));yield this.syncApi.injectRoomEvents(this.room,[],b),b.forEach(y=>{this.emit(g.ClientEvent.Event,y),u.logger.info(`Backfilled event ${y.getId()} ${y.getType()} ${y.getStateKey()}`)})})))&&void 0!==o?o:[]),this.setSyncState(f.SyncState.Syncing),u.logger.info("Finished backfilling events"),this.capabilities.turnServers&&this.watchTurnServers()})}stopClient(){this.widgetApi.off(`action:${E.WidgetApiToWidgetAction.SendEvent}`,this.onEvent),this.widgetApi.off(`action:${E.WidgetApiToWidgetAction.SendToDevice}`,this.onToDevice),super.stopClient(),this.lifecycle.abort()}joinRoom(t){return R(this,void 0,void 0,function*(){if(t===this.roomId)return this.room;throw new Error(`Unknown room: ${t}`)})}encryptAndSendEvent(t,n){return R(this,void 0,void 0,function*(){let o;try{o=yield this.widgetApi.sendRoomEvent(n.getType(),n.getContent(),t.roomId)}catch(h){throw this.updatePendingEventStatus(t,n,_.EventStatus.NOT_SENT),h}return t.updatePendingEvent(n,_.EventStatus.SENT,o.event_id),{event_id:o.event_id}})}sendStateEvent(t,n,o,h=""){return R(this,void 0,void 0,function*(){return yield this.widgetApi.sendStateEvent(n,h,o,t)})}sendToDevice(t,n){return R(this,void 0,void 0,function*(){return yield this.widgetApi.sendToDevice(t,!1,n),{}})}queueToDevice({eventType:t,batch:n}){return R(this,void 0,void 0,function*(){const o={};for(const{userId:h,deviceId:l,payload:e}of n)o[h]||(o[h]={}),o[h][l]=e;yield this.widgetApi.sendToDevice(t,!1,o)})}encryptAndSendToDevices(t,n){return R(this,void 0,void 0,function*(){const o={};for(const{userId:h,deviceInfo:{deviceId:l}}of t)o[h]||(o[h]={}),o[h][l]=n;yield this.widgetApi.sendToDevice(n.type,!0,o)})}checkTurnServers(){return R(this,void 0,void 0,function*(){return this.turnServers.length>0})}getSyncState(){return this.syncState}setSyncState(t){const n=this.syncState;this.syncState=t,this.emit(g.ClientEvent.Sync,t,n)}ack(t){return R(this,void 0,void 0,function*(){yield this.widgetApi.transport.reply(t.detail,{})})}watchTurnServers(){var t,n,o,h;return R(this,void 0,void 0,function*(){const l=this.widgetApi.getTurnServers(),e=()=>{l.return(void 0)};this.lifecycle.signal.addEventListener("abort",e);try{try{for(var y,p=!0,b=I(l);y=yield b.next(),!(t=y.done);){h=y.value,p=!1;try{const w=h;this.turnServers=[{urls:w.uris,username:w.username,credential:w.password}],this.emit(g.ClientEvent.TurnServers,this.turnServers),u.logger.log(`Received TURN server: ${w.uris}`)}finally{p=!0}}}catch(w){n={error:w}}finally{try{!p&&!t&&(o=b.return)&&(yield o.call(b))}finally{if(n)throw n.error}}}catch(w){u.logger.warn("Error watching TURN servers",w)}finally{this.lifecycle.signal.removeEventListener("abort",e)}})}}},{"./@types/event":299,"./client":313,"./logger":365,"./models/event":374,"./models/user":386,"./sliding-sync-sdk":392,"./sync":400,"matrix-widget-api":178}],351:[function(m,ie,a){"use strict";var R,u,E;Object.defineProperty(a,"__esModule",{value:!0}),a.KeySignatureUploadError=a.InvalidCryptoStoreError=a.InvalidCryptoStoreState=a.InvalidStoreError=a.InvalidStoreState=void 0,(u=R=a.InvalidStoreState||(a.InvalidStoreState={}))[u.ToggledLazyLoading=0]="ToggledLazyLoading";class I extends Error{constructor(g,f){super(`Store is invalid because ${g}, please stop the client, delete all data and start the client again`),this.reason=g,this.value=f,this.name="InvalidStoreError"}}a.InvalidStoreError=I,I.TOGGLED_LAZY_LOADING=R.ToggledLazyLoading,function(u){u.TooNew="TOO_NEW"}(E=a.InvalidCryptoStoreState||(a.InvalidCryptoStoreState={}));class _ extends Error{constructor(g){super(`Crypto store is invalid because ${g}, please stop the client, delete all data and start the client again`),this.reason=g,this.name="InvalidCryptoStoreError"}}a.InvalidCryptoStoreError=_,_.TOO_NEW=E.TooNew;class d extends Error{constructor(g,f){super(g),this.value=f}}a.KeySignatureUploadError=d},{}],352:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.eventMapperFor=void 0;const R=m("./models/event");a.eventMapperFor=function I(E,_){let d=Boolean(_.preventReEmit);const u=!1!==_.decrypt;return function g(f){_.toDevice&&delete f.room_id;const v=E.getRoom(f.room_id);let c;v&&void 0===f.state_key&&(c=v.findEventById(f.event_id)),!c||c.status?c=new R.MatrixEvent(f):(c.setUnsigned(Object.assign(Object.assign({},c.getUnsigned()),f.unsigned)),d=!0);const i=v?.findThreadForEvent(c);return i&&c.setThread(i),c.isEncrypted()&&(d||E.reEmitter.reEmit(c,[R.MatrixEventEvent.Decrypted]),u&&E.decryptEventIfNeeded(c)),d||(E.reEmitter.reEmit(c,[R.MatrixEventEvent.Replaced,R.MatrixEventEvent.VisibilityChange]),v?.reEmitter.reEmit(c,[R.MatrixEventEvent.BeforeRedaction])),c}}},{"./models/event":374}],353:[function(m,ie,a){"use strict";var I,u,E,R=this&&this.__awaiter||function(u,g,f,v){return new(f||(f=Promise))(function(i,r){function s(o){try{n(v.next(o))}catch(h){r(h)}}function t(o){try{n(v.throw(o))}catch(h){r(h)}}function n(o){o.done?i(o.value):function c(i){return i instanceof f?i:new f(function(r){r(i)})}(o.value).then(s,t)}n((v=v.apply(u,g||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.buildFeatureSupportMap=a.Feature=a.ServerSupport=void 0,(u=I=a.ServerSupport||(a.ServerSupport={}))[u.Stable=0]="Stable",u[u.Unstable=1]="Unstable",u[u.Unsupported=2]="Unsupported",function(u){u.Thread="Thread",u.ThreadUnreadNotifications="ThreadUnreadNotifications",u.LoginTokenRequest="LoginTokenRequest"}(E=a.Feature||(a.Feature={}));const _={[E.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[E.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[E.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]}};a.buildFeatureSupportMap=function d(u){var g,f,v,c;return R(this,void 0,void 0,function*(){const i=new Map;for(const[r,s]of Object.entries(_)){const t=null!==(f=null===(g=u.versions)||void 0===g?void 0:g.includes(s.matrixVersion||""))&&void 0!==f&&f,n=null!==(c=null===(v=s.unstablePrefixes)||void 0===v?void 0:v.every(o=>{var h;return!0===(null===(h=u.unstable_features)||void 0===h?void 0:h[o])}))&&void 0!==c&&c;i.set(r,t?I.Stable:n?I.Unstable:I.Unsupported)}return i})}},{}],354:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.FilterComponent=void 0;const R=m("./models/thread");a.FilterComponent=class E{constructor(d,u){this.filterJson=d,this.userId=u}check(d){var u,g;const f=(null===(u=d.getUnsigned())||void 0===u?void 0:u["m.relations"])||{},v=Object.keys(f),c=[];return this.userId&&!(null===(g=f?.[R.THREAD_RELATION_TYPE.name])||void 0===g)&&g.current_user_participated&&c.push(this.userId),this.checkFields(d.getRoomId(),d.getSender(),d.getType(),!!d.getContent()&&void 0!==d.getContent().url,v,c)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[R.FILTER_RELATED_BY_SENDERS.name]:this.filterJson[R.FILTER_RELATED_BY_SENDERS.name]||[],[R.FILTER_RELATED_BY_REL_TYPES.name]:this.filterJson[R.FILTER_RELATED_BY_REL_TYPES.name]||[]}}checkFields(d,u,g,f,v,c){const i={rooms:function(n){return d===n},senders:function(n){return u===n},types:function(n){return function I(_,d){if(d.endsWith("*")){const u=d.slice(0,-1);return _.slice(0,u.length)===u}return _===d}(g,n)}};for(const n in i){const o=i[n];if(this.filterJson["not_"+n]?.some(o))return!1;const e=this.filterJson[n];if(e&&!e.some(o))return!1}const r=this.filterJson.contains_url;if(void 0!==r&&r!==f)return!1;const s=this.filterJson[R.FILTER_RELATED_BY_REL_TYPES.name];if(void 0!==s&&!this.arrayMatchesFilter(s,v))return!1;const t=this.filterJson[R.FILTER_RELATED_BY_SENDERS.name];return!(void 0!==t&&!this.arrayMatchesFilter(t,c))}arrayMatchesFilter(d,u){return u.length>0&&d.every(g=>u.includes(g))}filter(d){return d.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}},{"./models/thread":384}],355:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Filter=void 0;const R=m("./@types/sync"),I=m("./filter-component");function E(d,u,g){const f=u.split(".");let v=d;for(let c=0;c<f.length-1;c++)v[f[c]]||(v[f[c]]={}),v=v[f[c]];v[f[f.length-1]]=g}class _{static fromJson(u,g,f){const v=new _(u,g);return v.setDefinition(f),v}constructor(u,g){this.userId=u,this.filterId=g,this.definition={}}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(u){this.definition=u;const g=u.room,f={};g&&(g.rooms&&(f.rooms=g.rooms),g.rooms&&(f.not_rooms=g.not_rooms)),this.roomFilter=new I.FilterComponent(f,this.userId),this.roomTimelineFilter=new I.FilterComponent(g?.timeline||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(u){return this.roomFilter&&(u=this.roomFilter.filter(u)),this.roomTimelineFilter&&(u=this.roomTimelineFilter.filter(u)),u}setTimelineLimit(u){E(this.definition,"room.timeline.limit",u)}setUnreadThreadNotifications(u){var g,f,v;this.definition=Object.assign(Object.assign({},this.definition),{room:Object.assign(Object.assign({},null===(g=this.definition)||void 0===g?void 0:g.room),{timeline:Object.assign(Object.assign({},null===(v=null===(f=this.definition)||void 0===f?void 0:f.room)||void 0===v?void 0:v.timeline),{[R.UNREAD_THREAD_NOTIFICATIONS.name]:u})})})}setLazyLoadMembers(u){E(this.definition,"room.state.lazy_load_members",u)}setIncludeLeaveRooms(u){E(this.definition,"room.include_leave",u)}}a.Filter=_,_.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0}},{"./@types/sync":306,"./filter-component":354}],356:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ConnectionError=a.MatrixError=a.HTTPError=void 0;class R extends Error{constructor(d,u){super(d),this.httpStatus=u}}a.HTTPError=R,a.MatrixError=class I extends R{constructor(d={},u,g,f){let v=d.error||"Unknown message";u&&(v=`[${u}] ${v}`),g&&(v=`${v} (${g})`),super(`MatrixError: ${v}`,u),this.httpStatus=u,this.url=g,this.event=f,this.errcode=d.errcode,this.name=d.errcode||"Unknown error code",this.data=d}};class E extends Error{constructor(d,u){super(d+(u?`: ${u.message}`:""))}get name(){return"ConnectionError"}}a.ConnectionError=E},{}],357:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(r,s,t,n){void 0===n&&(n=t);var o=Object.getOwnPropertyDescriptor(s,t);(!o||("get"in o?!s.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return s[t]}}),Object.defineProperty(r,n,o)}:function(r,s,t,n){void 0===n&&(n=t),r[n]=s[t]}),E=this&&this.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),_=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var t in r)"default"!==t&&Object.prototype.hasOwnProperty.call(r,t)&&I(s,r,t);return E(s,r),s},d=this&&this.__awaiter||function(r,s,t,n){return new(t||(t=Promise))(function(h,l){function e(y){try{b(n.next(y))}catch(w){l(w)}}function p(y){try{b(n.throw(y))}catch(w){l(w)}}function b(y){y.done?h(y.value):function o(h){return h instanceof t?h:new t(function(l){l(h)})}(y.value).then(e,p)}b((n=n.apply(r,s||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.FetchHttpApi=void 0;const u=_(m("../utils")),g=m("./method"),f=m("./errors"),v=m("./interface"),c=m("./utils");a.FetchHttpApi=class i{constructor(s,t){var n;this.eventEmitter=s,this.opts=t,this.abortController=new AbortController,u.checkObjectHasKeys(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=null===(n=t.useAuthorizationHeader)||void 0===n||n}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(s,t){return this.opts.fetchFn?this.opts.fetchFn(s,t):R.fetch(s,t)}setIdBaseUrl(s){this.opts.idBaseUrl=s}idServerRequest(s,t,n,o,h){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");let l,e;s===g.Method.Get?l=n:e=n;const p=this.getUrl(t,l,o,this.opts.idBaseUrl),b={json:!0,headers:{}};return h&&(b.headers.Authorization=`Bearer ${h}`),this.requestOtherUrl(s,p,e,b)}authedRequest(s,t,n,o,h={}){n||(n={}),this.opts.accessToken&&(this.opts.useAuthorizationHeader?(h.headers||(h.headers={}),h.headers.Authorization||(h.headers.Authorization="Bearer "+this.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=this.opts.accessToken));const l=this.request(s,t,n,o,h);return l.catch(e=>{"M_UNKNOWN_TOKEN"!=e.errcode||h?.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==e.errcode&&this.eventEmitter.emit(v.HttpApiEvent.NoConsent,e.message,e.data.consent_uri):this.eventEmitter.emit(v.HttpApiEvent.SessionLoggedOut,e)}),l}request(s,t,n,o,h){const l=this.getUrl(t,n,h?.prefix,h?.baseUrl);return this.requestOtherUrl(s,l,o,h)}requestOtherUrl(s,t,n,o={}){var h,l,e,p;return d(this,void 0,void 0,function*(){const b=Object.assign({},o.headers||{}),y=null===(h=o.json)||void 0===h||h,w=y&&(null===(l=n?.constructor)||void 0===l?void 0:l.name)===Object.name;y&&(w&&!b["Content-Type"]&&(b["Content-Type"]="application/json"),b.Accept||(b.Accept="application/json"));const x=null!==(e=o.localTimeoutMs)&&void 0!==e?e:this.opts.localTimeoutMs,B=null!==(p=o.keepAlive)&&void 0!==p&&p,J=[this.abortController.signal];let z;void 0!==x&&J.push((0,c.timeoutSignal)(x)),o.abortSignal&&J.push(o.abortSignal),z=w?JSON.stringify(n):n;const{signal:M,cleanup:L}=(0,c.anySignal)(J);let j;try{j=yield this.fetch(t,{signal:M,method:s,body:z,headers:b,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:B})}catch(C){throw"AbortError"===C.name?C:new f.ConnectionError("fetch failed",C)}finally{L()}if(!j.ok)throw(0,c.parseErrorResponse)(j,yield j.text());return this.opts.onlyData?y?j.json():j.text():j})}getUrl(s,t,n,o){const h=new URL((o??this.opts.baseUrl)+(n??this.opts.prefix)+s);return t&&u.encodeParams(t,h.searchParams),h}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../utils":402,"./errors":356,"./interface":359,"./method":360,"./utils":362}],358:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(t,n,o,h){void 0===h&&(h=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(t,h,l)}:function(t,n,o,h){void 0===h&&(h=o),t[h]=n[o]}),E=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),_=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&I(n,t,o);return E(n,t),n},d=this&&this.__exportStar||function(t,n){for(var o in t)"default"!==o&&!Object.prototype.hasOwnProperty.call(n,o)&&I(n,t,o)};Object.defineProperty(a,"__esModule",{value:!0}),a.MatrixHttpApi=void 0;const u=m("./fetch"),g=m("./prefix"),f=_(m("../utils")),v=_(m("../realtime-callbacks")),c=m("./method"),i=m("./errors"),r=m("./utils");d(m("./interface"),a),d(m("./prefix"),a),d(m("./errors"),a),d(m("./method"),a),d(m("./utils"),a),a.MatrixHttpApi=class s extends u.FetchHttpApi{constructor(){super(...arguments),this.uploads=[]}uploadContent(n,o={}){var h,l,e,p,b;const y=null===(h=o.includeFilename)||void 0===h||h,w=null!==(l=o.abortController)&&void 0!==l?l:new AbortController,x=null!==(p=null!==(e=o.type)&&void 0!==e?e:n.type)&&void 0!==p?p:"application/octet-stream",B=null!==(b=o.name)&&void 0!==b?b:n.name,J={loaded:0,total:0,abortController:w},z=f.defer();if(R.XMLHttpRequest){const M=new R.XMLHttpRequest,L=function(){M.abort(),z.reject(new Error("Timeout"))};let j=v.setTimeout(L,3e4);M.onreadystatechange=function(){if(M.readyState===R.XMLHttpRequest.DONE){v.clearTimeout(j);try{if(0===M.status)throw new DOMException(M.statusText,"AbortError");if(!M.responseText)throw new Error("No response body.");M.status>=400?z.reject((0,r.parseErrorResponse)(M,M.responseText)):z.resolve(JSON.parse(M.responseText))}catch(F){if("AbortError"===F.name)return void z.reject(F);z.reject(new i.ConnectionError("request failed",F))}}},M.upload.onprogress=F=>{var V;v.clearTimeout(j),J.loaded=F.loaded,J.total=F.total,j=v.setTimeout(L,3e4),null===(V=o.progressHandler)||void 0===V||V.call(o,{loaded:F.loaded,total:F.total})};const C=this.getUrl("/upload",void 0,g.MediaPrefix.R0);y&&B&&C.searchParams.set("filename",encodeURIComponent(B)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&C.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),M.open(c.Method.Post,C.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&M.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),M.setRequestHeader("Content-Type",x),M.send(n),w.signal.addEventListener("abort",()=>{M.abort()})}else{const M={};y&&B&&(M.filename=B),this.authedRequest(c.Method.Post,"/upload",M,n,{prefix:g.MediaPrefix.R0,headers:{"Content-Type":x},abortSignal:w.signal}).then(j=>this.opts.onlyData?j:j.json()).then(z.resolve,z.reject)}return J.promise=z.promise.finally(()=>{f.removeElement(this.uploads,M=>M===J)}),w.signal.addEventListener("abort",()=>{f.removeElement(this.uploads,M=>M===J),z.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(J),J.promise}cancelUpload(n){const o=this.uploads.find(h=>h.promise===n);return!!o&&(o.abortController.abort(),!0)}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:g.MediaPrefix.R0+"/upload",params:{access_token:this.opts.accessToken}}}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../realtime-callbacks":389,"../utils":402,"./errors":356,"./fetch":357,"./interface":359,"./method":360,"./prefix":361,"./utils":362}],359:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.HttpApiEvent=void 0,(I=a.HttpApiEvent||(a.HttpApiEvent={})).SessionLoggedOut="Session.logged_out",I.NoConsent="no_consent"},{}],360:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.Method=void 0,(I=a.Method||(a.Method={})).Get="GET",I.Put="PUT",I.Post="POST",I.Delete="DELETE"},{}],361:[function(m,ie,a){"use strict";var _;Object.defineProperty(a,"__esModule",{value:!0}),a.MediaPrefix=a.IdentityPrefix=a.ClientPrefix=void 0,(_=a.ClientPrefix||(a.ClientPrefix={})).R0="/_matrix/client/r0",_.V1="/_matrix/client/v1",_.V3="/_matrix/client/v3",_.Unstable="/_matrix/client/unstable",function(_){_.V1="/_matrix/identity/api/v1",_.V2="/_matrix/identity/v2"}(a.IdentityPrefix||(a.IdentityPrefix={})),function(_){_.R0="/_matrix/media/r0"}(a.MediaPrefix||(a.MediaPrefix={}))},{}],362:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(r,s,t,n){return new(t||(t=Promise))(function(h,l){function e(y){try{b(n.next(y))}catch(w){l(w)}}function p(y){try{b(n.throw(y))}catch(w){l(w)}}function b(y){y.done?h(y.value):function o(h){return h instanceof t?h:new t(function(l){l(h)})}(y.value).then(e,p)}b((n=n.apply(r,s||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.retryNetworkOperation=a.parseErrorResponse=a.anySignal=a.timeoutSignal=void 0;const I=m("content-type"),E=m("../logger"),_=m("../utils"),d=m("./errors");function v(r){return"getResponseHeader"in r}a.timeoutSignal=function u(r){const s=new AbortController;return setTimeout(()=>{s.abort()},r),s.signal},a.anySignal=function g(r){const s=new AbortController;function t(){for(const o of r)o.removeEventListener("abort",n)}function n(){s.abort(),t()}for(const o of r){if(o.aborted){n();break}o.addEventListener("abort",n)}return{signal:s.signal,cleanup:t}},a.parseErrorResponse=function f(r,s){let t;try{t=function c(r){let s;if(s=v(r)?r.getResponseHeader("Content-Type"):r.headers.get("Content-Type"),!s)return null;try{return(0,I.parse)(s)}catch(t){throw new Error(`Error parsing Content-Type '${s}': ${t}`)}}(r)}catch(n){return n}return"application/json"===t?.type&&s?new d.MatrixError(JSON.parse(s),r.status,v(r)?r.responseURL:r.url):new d.HTTPError("text/plain"===t?.type?`Server returned ${r.status} error: ${s}`:`Server returned ${r.status} error`,r.status)},a.retryNetworkOperation=function i(r,s){return R(this,void 0,void 0,function*(){let t=0,n=null;for(;t<r;)try{if(t>0){const o=1e3*Math.pow(2,t);E.logger.log(`network operation failed ${t} times, retrying in ${o}ms...`),yield(0,_.sleep)(o)}return yield s()}catch(o){if(!(o instanceof d.ConnectionError))throw o;t+=1,n=o}throw n})}},{"../logger":365,"../utils":402,"./errors":356,"content-type":72}],363:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.exists=void 0,a.exists=function R(I,E){return new Promise((_,d)=>{let u=!0;const g=I.open(E);g.onupgradeneeded=()=>{u=!1},g.onblocked=()=>d(g.error),g.onsuccess=()=>{g.result.close(),u||I.deleteDatabase(E),_(u)},g.onerror=()=>d(g.error)})}},{}],364:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(v,c,i,r){return new(i||(i=Promise))(function(t,n){function o(e){try{l(r.next(e))}catch(p){n(p)}}function h(e){try{l(r.throw(e))}catch(p){n(p)}}function l(e){e.done?t(e.value):function s(t){return t instanceof i?t:new i(function(n){n(t)})}(e.value).then(o,h)}l((r=r.apply(v,c||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.InteractiveAuth=a.AuthType=void 0;const I=m("./logger"),E=m("./utils"),_="m.login.email.identity",d="m.login.msisdn";var u,v;(v=u=a.AuthType||(a.AuthType={})).Password="m.login.password",v.Recaptcha="m.login.recaptcha",v.Terms="m.login.terms",v.Email="m.login.email.identity",v.Msisdn="m.login.msisdn",v.Sso="m.login.sso",v.SsoUnstable="org.matrix.login.sso",v.Dummy="m.login.dummy",v.RegistrationToken="m.login.registration_token",v.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token";class g extends Error{constructor(c,i,r){super(c),this.required_stages=i,this.flows=r,this.name="NoAuthFlowFoundError"}}a.InteractiveAuth=class f{constructor(c){this.requestingEmailToken=!1,this.attemptAuthDeferred=null,this.chosenFlow=null,this.currentStage=null,this.emailAttempt=1,this.submitPromise=null,this.requestEmailToken=()=>R(this,void 0,void 0,function*(){if(this.requestingEmailToken)I.logger.warn("Could not request email token: Already requesting");else{I.logger.trace("Requesting email token. Attempt: "+this.emailAttempt),this.requestingEmailToken=!0;try{const i=yield this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,this.emailAttempt++,this.data.session);this.emailSid=i.sid,I.logger.trace("Email token request succeeded")}finally{this.requestingEmailToken=!1}}}),this.matrixClient=c.matrixClient,this.data=c.authData||{},this.requestCallback=c.doRequest,this.busyChangedCallback=c.busyChanged,this.stateUpdatedCallback=c.stateUpdated||c.startAuthStage,this.requestEmailTokenCallback=c.requestEmailToken,this.inputs=c.inputs||{},c.sessionId&&(this.data.session=c.sessionId),this.clientSecret=c.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=c.emailSid}attemptAuth(){var c,i;this.attemptAuthDeferred=(0,E.defer)();const r=this.attemptAuthDeferred.promise;return null!==(c=this.data)&&void 0!==c&&c.flows?this.startNextAuthStage():(null===(i=this.busyChangedCallback)||void 0===i||i.call(this,!0),this.doRequest(this.data.session?{session:this.data.session}:null).finally(()=>{var t;null===(t=this.busyChangedCallback)||void 0===t||t.call(this,!1)})),r}poll(){return R(this,void 0,void 0,function*(){if(!this.data.session||!this.attemptAuthDeferred||this.submitPromise)return;let c={};if(this.currentStage==_&&this.emailSid){const i={sid:this.emailSid,client_secret:this.clientSecret};if(yield this.matrixClient.doesServerRequireIdServerParam()){const r=new URL(this.matrixClient.getIdentityServerUrl());i.id_server=r.host}c={type:_,threepid_creds:i,threepidCreds:i}}this.submitAuthDict(c,!0)})}getSessionId(){var c;return null===(c=this.data)||void 0===c?void 0:c.session}getClientSecret(){return this.clientSecret}getStageParams(c){var i;return null===(i=this.data.params)||void 0===i?void 0:i[c]}getChosenFlow(){return this.chosenFlow}submitAuthDict(c,i=!1){var r,s;return R(this,void 0,void 0,function*(){if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");for(i||null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!0);this.submitPromise;)try{yield this.submitPromise}catch{}let t;this.data.session?(t={session:this.data.session},Object.assign(t,c)):t=c;try{this.submitPromise=this.doRequest(t,i),yield this.submitPromise}finally{this.submitPromise=null,i||null===(s=this.busyChangedCallback)||void 0===s||s.call(this,!1)}})}getEmailSid(){return this.emailSid}setEmailSid(c){this.emailSid=c}doRequest(c,i=!1){var r,s,t,n;return R(this,void 0,void 0,function*(){try{const o=yield this.requestCallback(c,i);this.attemptAuthDeferred.resolve(o),this.attemptAuthDeferred=null}catch(o){const h=null!==(s=null===(r=o.data)||void 0===r?void 0:r.flows)&&void 0!==s?s:null,l=this.data.flows||Boolean(h);(401!==o.httpStatus||!o.data||!l)&&(i?I.logger.log("Background poll request failed doing UI auth: ignoring",o):null===(t=this.attemptAuthDeferred)||void 0===t||t.reject(o)),o.data||(o.data={}),!o.data.flows&&!o.data.completed&&!o.data.session&&(o.data.flows=this.data.flows,o.data.completed=this.data.completed,o.data.session=this.data.session),this.data=o.data;try{this.startNextAuthStage()}catch(e){return this.attemptAuthDeferred.reject(e),void(this.attemptAuthDeferred=null)}if(!this.emailSid&&null!==(n=this.chosenFlow)&&void 0!==n&&n.stages.includes(u.Email))try{yield this.requestEmailToken()}catch(e){this.attemptAuthDeferred.reject(e),this.attemptAuthDeferred=null}}})}startNextAuthStage(){var c,i,r,s;const t=this.chooseStage();if(!t)throw new Error("No incomplete flows from the server");this.currentStage=t,t!==u.Dummy?null!==(c=this.data)&&void 0!==c&&c.errcode||null!==(i=this.data)&&void 0!==i&&i.error?this.stateUpdatedCallback(t,{errcode:(null===(r=this.data)||void 0===r?void 0:r.errcode)||"",error:(null===(s=this.data)||void 0===s?void 0:s.error)||""}):this.stateUpdatedCallback(t,t===_?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),I.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));const c=this.firstUncompletedStage(this.chosenFlow);return I.logger.log("Next stage: %s",c),c}chooseFlow(){const c=this.data.flows||[],i=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),r=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber);for(const t of c){let n=!1,o=!1;for(const h of t.stages)h===_?n=!0:h==d&&(o=!0);if(n==i&&o==r)return t}const s=[];throw i&&s.push(_),r&&s.push(d),new g("No appropriate authentication flow found",s,c)}firstUncompletedStage(c){const i=this.data.completed||[];return c.stages.find(r=>!i.includes(r))}}},{"./logger":365,"./utils":402}],365:[function(m,ie,a){"use strict";var R=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(a,"__esModule",{value:!0}),a.logger=void 0;const I=R(m("loglevel")),E="matrix";I.default.methodFactory=function(u,g,f){return function(...v){return this.prefix&&v.unshift(this.prefix),"error"===u||"warn"===u||"trace"===u||"info"===u?console[u](...v):console.log(...v)}},a.logger=I.default.getLogger(E),a.logger.setLevel(I.default.levels.DEBUG,!1),function _(u){u.withPrefix=function(g){return function d(u){const g=I.default.getLogger(`${E}-${u}`);return g.prefix!==u&&(_(g),g.prefix=u,g.setLevel(I.default.levels.DEBUG,!1)),g}((this.prefix||"")+g)}}(a.logger)},{loglevel:151}],366:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(l,e,p,b){void 0===b&&(b=p);var y=Object.getOwnPropertyDescriptor(e,p);(!y||("get"in y?!e.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return e[p]}}),Object.defineProperty(l,b,y)}:function(l,e,p,b){void 0===b&&(b=p),l[b]=e[p]}),E=this&&this.__setModuleDefault||(Object.create?function(l,e){Object.defineProperty(l,"default",{enumerable:!0,value:e})}:function(l,e){l.default=e}),_=this&&this.__exportStar||function(l,e){for(var p in l)"default"!==p&&!Object.prototype.hasOwnProperty.call(e,p)&&I(e,l,p)},d=this&&this.__importStar||function(l){if(l&&l.__esModule)return l;var e={};if(null!=l)for(var p in l)"default"!==p&&Object.prototype.hasOwnProperty.call(l,p)&&I(e,l,p);return E(e,l),e};Object.defineProperty(a,"__esModule",{value:!0}),a.createRoomWidgetClient=a.createClient=a.setCryptoStoreFactory=a.GroupCallType=a.GroupCallState=a.GroupCallIntent=a.GroupCallEvent=a.createNewMatrixCall=a.ContentHelpers=void 0;const u=m("./crypto/store/memory-crypto-store"),g=m("./store/memory"),f=m("./scheduler"),v=m("./client"),c=m("./embedded");_(m("./client"),a),_(m("./embedded"),a),_(m("./http-api"),a),_(m("./autodiscovery"),a),_(m("./sync-accumulator"),a),_(m("./errors"),a),_(m("./models/beacon"),a),_(m("./models/event"),a),_(m("./models/room"),a),_(m("./models/event-timeline"),a),_(m("./models/event-timeline-set"),a),_(m("./models/room-member"),a),_(m("./models/room-state"),a),_(m("./models/user"),a),_(m("./scheduler"),a),_(m("./filter"),a),_(m("./timeline-window"),a),_(m("./interactive-auth"),a),_(m("./service-types"),a),_(m("./store/memory"),a),_(m("./store/indexeddb"),a),_(m("./crypto/store/memory-crypto-store"),a),_(m("./crypto/store/indexeddb-crypto-store"),a),_(m("./content-repo"),a),_(m("./@types/event"),a),_(m("./@types/PushRules"),a),_(m("./@types/partials"),a),_(m("./@types/requests"),a),_(m("./@types/search"),a),_(m("./models/room-summary"),a),a.ContentHelpers=d(m("./content-helpers"));var i=m("./webrtc/call");Object.defineProperty(a,"createNewMatrixCall",{enumerable:!0,get:function(){return i.createNewMatrixCall}});var r=m("./webrtc/groupCall");Object.defineProperty(a,"GroupCallEvent",{enumerable:!0,get:function(){return r.GroupCallEvent}}),Object.defineProperty(a,"GroupCallIntent",{enumerable:!0,get:function(){return r.GroupCallIntent}}),Object.defineProperty(a,"GroupCallState",{enumerable:!0,get:function(){return r.GroupCallState}}),Object.defineProperty(a,"GroupCallType",{enumerable:!0,get:function(){return r.GroupCallType}});let s=()=>new u.MemoryCryptoStore;function n(l){var e,p,b;return l.store=null!==(e=l.store)&&void 0!==e?e:new g.MemoryStore({localStorage:R.localStorage}),l.scheduler=null!==(p=l.scheduler)&&void 0!==p?p:new f.MatrixScheduler,l.cryptoStore=null!==(b=l.cryptoStore)&&void 0!==b?b:s(),l}a.setCryptoStoreFactory=function t(l){s=l},a.createClient=function o(l){return new v.MatrixClient(n(l))},a.createRoomWidgetClient=function h(l,e,p,b){return new c.RoomWidgetClient(l,e,p,n(b))}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./@types/PushRules":297,"./@types/event":299,"./@types/partials":302,"./@types/requests":304,"./@types/search":305,"./autodiscovery":311,"./client":313,"./content-helpers":314,"./content-repo":315,"./crypto/store/indexeddb-crypto-store":338,"./crypto/store/memory-crypto-store":340,"./embedded":350,"./errors":351,"./filter":355,"./http-api":358,"./interactive-auth":364,"./models/beacon":369,"./models/event":374,"./models/event-timeline":373,"./models/event-timeline-set":372,"./models/room":382,"./models/room-member":379,"./models/room-state":380,"./models/room-summary":381,"./models/user":386,"./scheduler":390,"./service-types":391,"./store/indexeddb":396,"./store/memory":397,"./sync-accumulator":399,"./timeline-window":401,"./webrtc/call":404,"./webrtc/groupCall":408}],367:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(d,u,g,f){return new(g||(g=Promise))(function(c,i){function r(n){try{t(f.next(n))}catch(o){i(o)}}function s(n){try{t(f.throw(n))}catch(o){i(o)}}function t(n){n.done?c(n.value):function v(c){return c instanceof g?c:new g(function(i){i(c)})}(n.value).then(r,s)}t((f=f.apply(d,u||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MSC3089Branch=void 0;const I=m("../@types/event"),E=m("./event-timeline");a.MSC3089Branch=class _{constructor(u,g,f){this.client=u,this.indexEvent=g,this.directory=f}get id(){const u=this.indexEvent.getStateKey();if(!u)throw new Error("State key not found for branch");return u}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var u;return null!==(u=this.indexEvent.getContent().version)&&void 0!==u?u:1}get roomId(){return this.indexEvent.getRoomId()}delete(){return R(this,void 0,void 0,function*(){yield this.client.sendStateEvent(this.roomId,I.UNSTABLE_MSC3089_BRANCH.name,{},this.id),yield this.client.redactEvent(this.roomId,this.id);const u=(yield this.getVersionHistory())[1];u&&(yield u.delete())})}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(u){return R(this,void 0,void 0,function*(){yield this.client.sendStateEvent(this.roomId,I.UNSTABLE_MSC3089_BRANCH.name,Object.assign(Object.assign({},this.indexEvent.getContent()),{name:u}),this.id)})}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(u){return R(this,void 0,void 0,function*(){yield this.client.sendStateEvent(this.roomId,I.UNSTABLE_MSC3089_BRANCH.name,Object.assign(Object.assign({},this.indexEvent.getContent()),{locked:u}),this.id)})}getFileInfo(){return R(this,void 0,void 0,function*(){const g=(yield this.getFileEvent()).getOriginalContent().file,f=this.client.mxcUrlToHttp(g.url);if(!f)throw new Error(`No HTTP URL available for ${g.url}`);return{info:g,httpUrl:f}})}getFileEvent(){return R(this,void 0,void 0,function*(){const u=this.client.getRoom(this.roomId);if(!u)throw new Error("Unknown room");let g=u.getUnfilteredTimelineSet().findEventById(this.id);for(;!g&&u.getLiveTimeline().getState(E.EventTimeline.BACKWARDS).paginationToken;)yield this.client.scrollback(u,100),g=u.getUnfilteredTimelineSet().findEventById(this.id);if(!g)throw new Error("Failed to find event");return yield this.client.decryptEventIfNeeded(g,{emit:!0,isRetry:!0}),g})}createNewVersion(u,g,f,v){return R(this,void 0,void 0,function*(){const c=yield this.directory.createFile(u,g,f,Object.assign(Object.assign({},v??{}),{"m.new_content":!0,"m.relates_to":{rel_type:I.RelationType.Replace,event_id:this.id}}));return yield this.client.sendStateEvent(this.roomId,I.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:u,version:this.version+1},c.event_id),yield this.client.sendStateEvent(this.roomId,I.UNSTABLE_MSC3089_BRANCH.name,Object.assign(Object.assign({},this.indexEvent.getContent()),{active:!1}),this.id),c})}getVersionHistory(){return R(this,void 0,void 0,function*(){const u=[];u.push(this);const g=this.client.getRoom(this.roomId);if(!g)throw new Error("Invalid or unknown room");const f=[...g.getLiveTimeline().getEvents()].reverse();let v,c=yield this.getFileEvent();do{if(v=f.find(i=>i.replacingEventId()===c.getId()),v){const i=this.directory.getFile(v.getId());if(!i)break;u.push(i),c=v}}while(v);return u})}}},{"../@types/event":299,"./event-timeline":373}],368:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(i,r,s,t){return new(s||(s=Promise))(function(o,h){function l(b){try{p(t.next(b))}catch(y){h(y)}}function e(b){try{p(t.throw(b))}catch(y){h(y)}}function p(b){b.done?o(b.value):function n(o){return o instanceof s?o:new s(function(h){h(o)})}(b.value).then(l,e)}p((t=t.apply(i,r||[])).next())})},I=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(a,"__esModule",{value:!0}),a.MSC3089TreeSpace=a.TreePermissions=a.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;const E=I(m("p-retry")),_=m("../@types/event"),d=m("../logger"),u=m("../utils"),g=m("./MSC3089Branch"),f=m("../crypto/algorithms/megolm");var v,i;a.DEFAULT_TREE_POWER_LEVELS_TEMPLATE={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[_.EventType.RoomPowerLevels]:100,[_.EventType.RoomHistoryVisibility]:100,[_.EventType.RoomTombstone]:100,[_.EventType.RoomEncryption]:100,[_.EventType.RoomName]:50,[_.EventType.RoomMessage]:50,[_.EventType.RoomMessageEncrypted]:50,[_.EventType.Sticker]:50},users:{}},(i=v=a.TreePermissions||(a.TreePermissions={})).Viewer="viewer",i.Editor="editor",i.Owner="owner",a.MSC3089TreeSpace=class c{constructor(r,s){if(this.client=r,this.roomId=s,this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const r=this.room.currentState.getStateEvents(_.EventType.SpaceParent);return!r?.length||r.every(s=>{var t;return!(null!==(t=s.getContent())&&void 0!==t&&t.via)})}setName(r){return R(this,void 0,void 0,function*(){yield this.client.sendStateEvent(this.roomId,_.EventType.RoomName,{name:r},"")})}invite(r,s=!0,t=!0){return R(this,void 0,void 0,function*(){const n=[this.retryInvite(r)];return s&&n.push(...this.getDirectories().map(o=>o.invite(r,s,t))),Promise.all(n).then(()=>{t&&(0,f.isRoomSharedHistory)(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[r])})})}retryInvite(r){return(0,u.simpleRetryOperation)(()=>R(this,void 0,void 0,function*(){yield this.client.invite(this.roomId,r).catch(s=>{throw"M_FORBIDDEN"===s?.errcode?new E.default.AbortError(s):s})}))}setPermissions(r,s){var t;return R(this,void 0,void 0,function*(){const n=this.room.currentState.getStateEvents(_.EventType.RoomPowerLevels,"");if(Array.isArray(n))throw new Error("Unexpected return type for power levels");const o=n?.getContent()||{},h=o.users_default||0,l=o.events_default||50,e=(null===(t=o.events)||void 0===t?void 0:t[_.EventType.RoomPowerLevels])||100,p=o.users||{};switch(s){case v.Viewer:p[r]=h;break;case v.Editor:p[r]=l;break;case v.Owner:p[r]=e;break;default:throw new Error("Invalid role: "+s)}o.users=p,yield this.client.sendStateEvent(this.roomId,_.EventType.RoomPowerLevels,o,"")})}getPermissions(r){var s,t;const n=this.room.currentState.getStateEvents(_.EventType.RoomPowerLevels,"");if(Array.isArray(n))throw new Error("Unexpected return type for power levels");const o=n?.getContent()||{},e=(null===(s=o.events)||void 0===s?void 0:s[_.EventType.RoomPowerLevels])||100,p=(null===(t=o.users)||void 0===t?void 0:t[r])||o.users_default||0;return p>=e?v.Owner:p>=(o.events_default||50)?v.Editor:v.Viewer}createDirectory(r){return R(this,void 0,void 0,function*(){const s=yield this.client.unstableCreateFileTree(r);return yield this.client.sendStateEvent(this.roomId,_.EventType.SpaceChild,{via:[this.client.getDomain()]},s.roomId),yield this.client.sendStateEvent(s.roomId,_.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId),s})}getDirectories(){const r=[],s=this.room.currentState.getStateEvents(_.EventType.SpaceChild);for(const t of s)try{const n=t.getStateKey();if(n){const o=this.client.unstableGetFileTreeSpace(n);o&&r.push(o)}}catch(n){d.logger.warn("Unable to create tree space instance for listing. Are we joined?",n)}return r}getDirectory(r){return this.getDirectories().find(s=>s.roomId===r)}delete(){return R(this,void 0,void 0,function*(){const r=this.getDirectories();for(const n of r)yield n.delete();const s=["invite","knock","join"],t=this.room.currentState.getStateEvents(_.EventType.RoomMember);for(const n of t)if(n.getStateKey()!==this.client.getUserId()&&s.includes(n.getContent().membership)){const h=n.getStateKey();if(!h)throw new Error("State key not found for branch");yield this.client.kick(this.roomId,h,"Room deleted")}yield this.client.leave(this.roomId)})}getOrderedChildren(r){const s=r.map(t=>({roomId:t.getStateKey(),order:t.getContent().order})).filter(t=>t.roomId);return s.sort((t,n)=>{var o,h,l,e;if(t.order&&!n.order)return-1;if(!t.order&&n.order)return 1;if(t.order||n.order)return(0,u.lexicographicCompare)(t.order,n.order);{const p=this.client.getRoom(t.roomId),b=this.client.getRoom(n.roomId);if(!p||!b)return(0,u.lexicographicCompare)(t.roomId,n.roomId);const y=null!==(h=null===(o=p.currentState.getStateEvents(_.EventType.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==h?h:0,w=null!==(e=null===(l=b.currentState.getStateEvents(_.EventType.RoomCreate,""))||void 0===l?void 0:l.getTs())&&void 0!==e?e:0;return y===w?(0,u.lexicographicCompare)(t.roomId,n.roomId):y-w}}),s}getParentRoom(){const s=this.room.currentState.getStateEvents(_.EventType.SpaceParent)[0];if(!s)throw new Error("Expected to have a parent in a non-top level space");const t=s.getStateKey();if(!t)throw new Error("No state key found for parent");const n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;const s=this.getParentRoom().currentState.getStateEvents(_.EventType.SpaceChild);return this.getOrderedChildren(s).findIndex(n=>n.roomId===this.roomId)}setOrder(r){var s,t;return R(this,void 0,void 0,function*(){if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const n=this.getParentRoom(),o=n.currentState.getStateEvents(_.EventType.SpaceChild),h=this.getOrderedChildren(o);r=Math.max(Math.min(r,h.length-1),0);const e=this.getOrder()<r;e&&r===h.length-1?r--:!e&&0===r&&r++;const p=h[e?r:r-1],b=h[e?r+1:r];let y=u.DEFAULT_ALPHABET[0],w=!1;if(p)if(r===h.length-1)b?.order&&(y=(0,u.nextString)(b.order));else{const J=p?.order,z=b?.order;J&&z?y=J===z?(0,u.nextString)(J):(0,u.averageBetweenStrings)(J,z):J?y=(0,u.nextString)(J):z?y=(0,u.prevString)(z):w=!0}else b?.order&&(y=(0,u.prevString)(b.order));if(w){let J;for(let z=0;z<=r;z++){const M=h[z];if(0===z&&(J=M.order),M.order)J=M.order;else{J=J?(0,u.nextString)(J):u.DEFAULT_ALPHABET[0];const L=n.currentState.getStateEvents(_.EventType.SpaceChild,M.roomId),j=null!==(s=L?.getContent())&&void 0!==s?s:{via:[this.client.getDomain()]};yield this.client.sendStateEvent(n.roomId,_.EventType.SpaceChild,Object.assign(Object.assign({},j),{order:J}),M.roomId)}}J&&(y=(0,u.nextString)(J))}const x=n.currentState.getStateEvents(_.EventType.SpaceChild,this.roomId),B=null!==(t=x?.getContent())&&void 0!==t?t:{via:[this.client.getDomain()]};yield this.client.sendStateEvent(n.roomId,_.EventType.SpaceChild,Object.assign(Object.assign({},B),{order:y}),this.roomId)})}createFile(r,s,t,n){return R(this,void 0,void 0,function*(){const{content_uri:o}=yield this.client.uploadContent(s,{includeFilename:!1});t.url=o;const h={msgtype:_.MsgType.File,body:r,url:o,file:t};(n=n??{})["m.new_content"]&&(n["m.new_content"]=h);const l=yield this.client.sendMessage(this.roomId,Object.assign(Object.assign(Object.assign({},n),h),{[_.UNSTABLE_MSC3089_LEAF.name]:{}}));return yield this.client.sendStateEvent(this.roomId,_.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:r},l.event_id),l})}getFile(r){const s=this.room.currentState.getStateEvents(_.UNSTABLE_MSC3089_BRANCH.name,r);return s?new g.MSC3089Branch(this.client,s,this):null}listFiles(){return this.listAllFiles().filter(r=>r.isActive)}listAllFiles(){var r;return(null!==(r=this.room.currentState.getStateEvents(_.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==r?r:[]).map(t=>new g.MSC3089Branch(this.client,t,this))}}},{"../@types/event":299,"../crypto/algorithms/megolm":326,"../logger":365,"../utils":402,"./MSC3089Branch":367,"p-retry":225}],369:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Beacon=a.getBeaconInfoIdentifier=a.isTimestampInDuration=a.BeaconEvent=void 0;const R=m("../content-helpers"),I=m("../utils"),E=m("./typed-event-emitter");var _,f;(f=_=a.BeaconEvent||(a.BeaconEvent={})).New="Beacon.new",f.Update="Beacon.update",f.LivenessChange="Beacon.LivenessChange",f.Destroy="Beacon.Destroy",f.LocationUpdate="Beacon.LocationUpdate",a.isTimestampInDuration=(f,v,c)=>c>=f&&f+v>=c,a.getBeaconInfoIdentifier=f=>`${f.getRoomId()}_${f.getStateKey()}`,a.Beacon=class g extends E.TypedEventEmitter{constructor(v){super(),this.rootEvent=v,this.clearLatestLocation=()=>{this._latestLocationEvent=void 0,this.emit(_.LocationUpdate,this.latestLocationState)},this.setBeaconInfo(this.rootEvent),this.roomId=this.rootEvent.getRoomId()}get isLive(){return!!this._isLive}get identifier(){return(0,a.getBeaconInfoIdentifier)(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&(0,R.parseBeaconContent)(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(v){if((0,a.getBeaconInfoIdentifier)(v)!==this.identifier)throw new Error("Invalid updating event");v.getTs()<this.rootEvent.getTs()||(this.rootEvent=v,this.setBeaconInfo(this.rootEvent),this.emit(_.Update,v,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(_.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){const v=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();v>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},v))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(v){var c;if(!this.isLive)return;const r=null===(c=v.filter(s=>{const t=s.getContent(),n=(0,R.parseBeaconContent)(t);if(!n.uri||!n.timestamp)return!1;const{timestamp:o}=n;return this._beaconInfo.timestamp&&(0,a.isTimestampInDuration)(this._beaconInfo.timestamp,this._beaconInfo.timeout,o)&&(!this.latestLocationState||o>this.latestLocationState.timestamp)}).sort(I.sortEventsByLatestContentTimestamp))||void 0===c?void 0:c[0];r&&(this._latestLocationEvent=r,this.emit(_.LocationUpdate,this.latestLocationState))}setBeaconInfo(v){this._beaconInfo=(0,R.parseBeaconInfoContent)(v.getContent()),this.checkLiveness()}checkLiveness(){var v,c;const i=this.isLive;if(!this.beaconInfo)return;const r=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!(null===(v=this._beaconInfo)||void 0===v||!v.live)&&!!r&&(0,a.isTimestampInDuration)(r,null===(c=this._beaconInfo)||void 0===c?void 0:c.timeout,Date.now()),i!==this.isLive&&this.emit(_.LivenessChange,this.isLive,this)}}},{"../content-helpers":314,"../utils":402,"./typed-event-emitter":385}],370:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.EventContext=void 0;const R=m("./event-timeline");a.EventContext=class I{constructor(_){this.ourEvent=_,this.ourEventIndex=0,this.paginateTokens={[R.Direction.Backward]:null,[R.Direction.Forward]:null},this.timeline=[_]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(_=!1){return this.paginateTokens[_?R.Direction.Backward:R.Direction.Forward]}setPaginateToken(_,d=!1){this.paginateTokens[d?R.Direction.Backward:R.Direction.Forward]=_??null}addEvents(_,d=!1){d?(this.timeline=_.concat(this.timeline),this.ourEventIndex+=_.length):this.timeline=this.timeline.concat(_)}}},{"./event-timeline":373}],371:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.EventStatus=void 0,(I=a.EventStatus||(a.EventStatus={})).NOT_SENT="not_sent",I.ENCRYPTING="encrypting",I.SENDING="sending",I.QUEUED="queued",I.SENT="sent",I.CANCELLED="cancelled"},{}],372:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.EventTimelineSet=a.DuplicateStrategy=void 0;const R=m("./event-timeline"),I=m("../logger"),E=m("./room"),_=m("./typed-event-emitter"),d=m("./relations-container");let g;var f,c;g=I.logger.log.bind(I.logger),(c=f=a.DuplicateStrategy||(a.DuplicateStrategy={})).Ignore="ignore",c.Replace="replace",a.EventTimelineSet=class v extends _.TypedEventEmitter{constructor(i,r={},s,t,n=null){var o,h,l;super(),this.room=i,this.thread=t,this.threadListType=n,this._eventIdToTimeline=new Map,this.timelineSupport=Boolean(r.timelineSupport),this.liveTimeline=new R.EventTimeline(this),this.displayPendingEvents=!1!==r.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=r.filter,this.relations=null!==(h=null===(o=this.room)||void 0===o?void 0:o.relations)&&void 0!==h?h:new d.RelationsContainer(null!==(l=i?.client)&&void 0!==l?l:s)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(i){this.filter=i}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(i){this.liveTimeline=i}eventIdToTimeline(i){return this._eventIdToTimeline.get(i)}replaceEventId(i,r){const s=this._eventIdToTimeline.get(i);s&&(this._eventIdToTimeline.delete(i),this._eventIdToTimeline.set(r,s))}resetLiveTimeline(i,r){const s=!this.timelineSupport||!r,t=this.liveTimeline,n=s?t.forkLive(R.EventTimeline.FORWARDS):t.fork(R.EventTimeline.FORWARDS);s?(this.timelines=[n],this._eventIdToTimeline=new Map):this.timelines.push(n),r&&t.setPaginationToken(r,R.EventTimeline.FORWARDS),n.setPaginationToken(i??null,R.EventTimeline.BACKWARDS),this.liveTimeline=n,this.emit(E.RoomEvent.TimelineReset,this.room,this,s)}getTimelineForEvent(i){if(null==i)return null;const r=this._eventIdToTimeline.get(i);return void 0===r?null:r}findEventById(i){const r=this.getTimelineForEvent(i);if(r)return r.getEvents().find(function(s){return s.getId()==i})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const i=new R.EventTimeline(this);return this.timelines.push(i),i}addEventsToTimeline(i,r,s,t){if(!s)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!r&&s==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&!(i=this.filter.filterRoomTimeline(i)).length)return;const n=r?R.EventTimeline.BACKWARDS:R.EventTimeline.FORWARDS,o=r?R.EventTimeline.FORWARDS:R.EventTimeline.BACKWARDS;let h=!1,l=!1;for(const e of i){const p=e.getId(),b=this._eventIdToTimeline.get(p);if(!b){this.addEventToTimeline(e,s,{toStartOfTimeline:r}),l=!0,h=!0;continue}if(l=!1,b==s){g("Event "+p+" already in timeline "+s);continue}const y=s.getNeighbouringTimeline(n);if(y){g(b==y?"Event "+p+" in neighbouring timeline - switching to "+b:"Event "+p+" already in a different timeline "+b),s=b;continue}I.logger.info("Already have timeline for "+p+" - joining timeline "+s+" to "+b);const B=n===R.EventTimeline.BACKWARDS&&b===this.liveTimeline,J=n===R.EventTimeline.FORWARDS&&s===this.liveTimeline;B||J?(B&&I.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+b+")"),J&&I.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+s+")")):(s.setNeighbouringTimeline(b,n),b.setNeighbouringTimeline(s,o),s=b,h=!0)}if(l||!h){if(n===R.EventTimeline.FORWARDS&&s===this.liveTimeline)return I.logger.warn({lastEventWasNew:l,didUpdate:h}),void I.logger.warn(`Refusing to set forwards pagination token of live timeline ${s} to ${t}`);s.setPaginationToken(t??null,n)}}addLiveEvent(i,r,s=!1,t){let o,n=r||f.Ignore;if("object"==typeof r?({duplicateStrategy:n=f.Ignore,fromCache:s=!1,roomState:t,timelineWasEmpty:o}=r):void 0!==r&&I.logger.warn("Overload deprecated: `EventTimelineSet.addLiveEvent(event, duplicateStrategy?, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addLiveEvent(event, IAddLiveEventOptions)`"),this.filter&&!this.filter.filterRoomTimeline([i]).length)return;const h=this._eventIdToTimeline.get(i.getId());if(h)if(n===f.Replace){g("EventTimelineSet.addLiveEvent: replacing duplicate event "+i.getId());const l=h.getEvents();for(let e=0;e<l.length;e++)if(l[e].getId()===i.getId()){t||(t=h.getState(R.EventTimeline.FORWARDS)),R.EventTimeline.setEventMetadata(i,t,!1),l[e]=i;break}}else g("EventTimelineSet.addLiveEvent: ignoring duplicate event "+i.getId());else this.addEventToTimeline(i,this.liveTimeline,{toStartOfTimeline:!1,fromCache:s,roomState:t,timelineWasEmpty:o})}addEventToTimeline(i,r,s,t=!1,n){var o,h;let e,l=!!s;if("object"==typeof s?({toStartOfTimeline:l,fromCache:t=!1,roomState:n,timelineWasEmpty:e}=s):void 0!==s&&I.logger.warn("Overload deprecated: `EventTimelineSet.addEventToTimeline(event, timeline, toStartOfTimeline, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addEventToTimeline(event, timeline, IAddEventToTimelineOptions)`"),r.getTimelineSet()!==this)throw new Error(`EventTimelineSet.addEventToTimeline: Timeline=${r.toString()} does not belong " +\n                "in timelineSet(threadId=${null===(o=this.thread)||void 0===o?void 0:o.id})`);if(this.room&&!this.canContain(i)){let y=`event=${i.getId()}`;return i.threadRootId&&(y+=`(belongs to thread=${i.threadRootId})`),void I.logger.warn(`EventTimelineSet.addEventToTimeline: Ignoring ${y} that does not belong in timeline=${r.toString()} timelineSet(threadId=${null===(h=this.thread)||void 0===h?void 0:h.id})`)}const p=i.getId();r.addEvent(i,{toStartOfTimeline:l,roomState:n,timelineWasEmpty:e}),this._eventIdToTimeline.set(p,r),this.relations.aggregateParentEvent(i),this.relations.aggregateChildEvent(i,this);const b={timeline:r,liveEvent:!l&&r==this.liveTimeline&&!t};this.emit(E.RoomEvent.Timeline,i,this.room,Boolean(l),!1,b)}handleRemoteEcho(i,r,s){const t=this._eventIdToTimeline.get(r);t?(this._eventIdToTimeline.delete(r),this._eventIdToTimeline.set(s,t)):(!this.filter||this.filter.filterRoomTimeline([i]).length)&&this.addEventToTimeline(i,this.liveTimeline,{toStartOfTimeline:!1})}removeEvent(i){const r=this._eventIdToTimeline.get(i);if(!r)return null;const s=r.removeEvent(i);return s&&(this._eventIdToTimeline.delete(i),this.emit(E.RoomEvent.Timeline,s,this.room,void 0,!0,{timeline:r})),s}compareEventOrdering(i,r){if(i==r)return 0;const s=this._eventIdToTimeline.get(i),t=this._eventIdToTimeline.get(r);if(void 0===s||void 0===t)return null;if(s===t){let o,h;const l=s.getEvents();for(let e=0;e<l.length&&(void 0===o||void 0===h);e++){const p=l[e].getId();p==i&&(o=e),p==r&&(h=e)}return o-h}let n=s;for(;n;){if(n===t)return-1;n=n.getNeighbouringTimeline(R.EventTimeline.FORWARDS)}for(n=s;n;){if(n===t)return 1;n=n.getNeighbouringTimeline(R.EventTimeline.BACKWARDS)}return null}canContain(i){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");const{threadId:r,shouldLiveInRoom:s}=this.room.eventShouldLiveIn(i);return this.thread?this.thread.id===r:s}}},{"../logger":365,"./event-timeline":373,"./relations-container":377,"./room":382,"./typed-event-emitter":385}],373:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.EventTimeline=a.Direction=void 0;const R=m("../logger"),I=m("./room-state"),E=m("../@types/event");var _,u;(u=_=a.Direction||(a.Direction={})).Backward="b",u.Forward="f";class d{static setEventMetadata(g,f,v){var c,i,r,s;!(null===(i=null===(c=g.sender)||void 0===c?void 0:c.events)||void 0===i)&&i.member||(g.sender=f.getSentinelMember(g.getSender())),!(null!==(s=null===(r=g.target)||void 0===r?void 0:r.events)&&void 0!==s&&s.member)&&g.getType()===E.EventType.RoomMember&&(g.target=f.getSentinelMember(g.getStateKey())),g.isState()&&v&&(g.forwardLooking=!1)}constructor(g){var f,v;this.eventTimelineSet=g,this.events=[],this.baseIndex=0,this.startToken=null,this.endToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={[_.Backward]:null,[_.Forward]:null},this.roomId=null!==(v=null===(f=g.room)||void 0===f?void 0:f.roomId)&&void 0!==v?v:null,this.roomId&&(this.startState=new I.RoomState(this.roomId),this.endState=new I.RoomState(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(g,{timelineWasEmpty:f}={}){var v,c;if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(v=this.startState)||void 0===v||v.setStateEvents(g,{timelineWasEmpty:f}),null===(c=this.endState)||void 0===c||c.setStateEvents(g,{timelineWasEmpty:f})}forkLive(g){const f=this.getState(g),v=new d(this.eventTimelineSet);return v.startState=f?.clone(),v.endState=f,this.endState=f?.clone(),v}fork(g){const f=this.getState(g),v=new d(this.eventTimelineSet);return v.startState=f?.clone(),v.endState=f?.clone(),v}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(g){if(g==d.BACKWARDS)return this.startState;if(g==d.FORWARDS)return this.endState;throw new Error("Invalid direction '"+g+"'")}getPaginationToken(g){return this.roomId?this.getState(g).paginationToken:g===_.Backward?this.startToken:this.endToken}setPaginationToken(g,f){this.roomId?this.getState(f).paginationToken=g:f===_.Backward?this.startToken=g:this.endToken=g}getNeighbouringTimeline(g){if(g==d.BACKWARDS)return this.prevTimeline;if(g==d.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+g+"'")}setNeighbouringTimeline(g,f){if(this.getNeighbouringTimeline(f))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+f+")");if(f==d.BACKWARDS)this.prevTimeline=g;else{if(f!=d.FORWARDS)throw new Error("Invalid direction '"+f+"'");this.nextTimeline=g}this.setPaginationToken(null,f)}addEvent(g,f,v){let i,c=!!f;"object"==typeof f?({toStartOfTimeline:c,roomState:v,timelineWasEmpty:i}=f):void 0!==f&&R.logger.warn("Overload deprecated: `EventTimeline.addEvent(event, toStartOfTimeline, roomState?)` is deprecated in favor of the overload with `EventTimeline.addEvent(event, IAddEventOptions)`"),v||(v=c?this.startState:this.endState);const r=this.getTimelineSet();let s;r.room&&(d.setEventMetadata(g,v,c),g.isState()&&r.room.getUnfilteredTimelineSet()===r&&(v?.setStateEvents([g],{timelineWasEmpty:i}),(!g.sender||g.getType()===E.EventType.RoomMember&&!c)&&d.setEventMetadata(g,v,c))),s=c?0:this.events.length,this.events.splice(s,0,g),c&&this.baseIndex++}removeEvent(g){for(let f=this.events.length-1;f>=0;f--){const v=this.events[f];if(v.getId()==g)return this.events.splice(f,1),f<this.baseIndex&&this.baseIndex--,v}return null}toString(){return this.name}}a.EventTimeline=d,d.BACKWARDS=_.Backward,d.FORWARDS=_.Forward},{"../@types/event":299,"../logger":365,"./room-state":380}],374:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(n,o,h,l){return new(h||(h=Promise))(function(p,b){function y(B){try{x(l.next(B))}catch(J){b(J)}}function w(B){try{x(l.throw(B))}catch(J){b(J)}}function x(B){B.done?p(B.value):function e(p){return p instanceof h?p:new h(function(b){b(p)})}(B.value).then(y,w)}x((l=l.apply(n,o||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MatrixEvent=a.MatrixEventEvent=a.EventStatus=void 0;const I=m("matrix-events-sdk"),E=m("../logger"),_=m("../@types/event"),d=m("../utils"),u=m("./thread"),g=m("../ReEmitter"),f=m("./typed-event-emitter");var v=m("./event-status");Object.defineProperty(a,"EventStatus",{enumerable:!0,get:function(){return v.EventStatus}});const c=Object.freeze({visible:!0});var i,n;(n=i=a.MatrixEventEvent||(a.MatrixEventEvent={})).Decrypted="Event.decrypted",n.BeforeRedaction="Event.beforeRedaction",n.VisibilityChange="Event.visibilityChange",n.LocalEventIdReplaced="Event.localEventIdReplaced",n.Status="Event.status",n.Replaced="Event.replaced",n.RelationsCreated="Event.relationsCreated";class r extends f.TypedEventEmitter{constructor(o={}){var h;super(),this.event=o,this.pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this.visibility=c,this._hasCachedExtEv=!1,this._cachedExtEv=void 0,this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=null,this.decryptionPromise=null,this.retryDecryption=!1,this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,["state_key","type","sender","room_id","membership"].forEach(l=>{"string"==typeof o[l]&&(o[l]=(0,d.internaliseString)(o[l]))}),["membership","avatar_url","displayname"].forEach(l=>{var e;"string"==typeof(null===(e=o.content)||void 0===e?void 0:e[l])&&(o.content[l]=(0,d.internaliseString)(o.content[l]))}),["rel_type"].forEach(l=>{var e,p;"string"==typeof(null===(p=null===(e=o.content)||void 0===e?void 0:e["m.relates_to"])||void 0===p?void 0:p[l])&&(o.content["m.relates_to"][l]=(0,d.internaliseString)(o.content["m.relates_to"][l]))}),this.txnId=o.txn_id,this.localTimestamp=Date.now()-(null!==(h=this.getAge())&&void 0!==h?h:0),this.reEmitter=new g.TypedReEmitter(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=I.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const o=Object.assign({},this.getContent());if(this.getWireType()===_.EventType.RoomMessageEncrypted)for(const[h,l]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(h)||void 0===o[h]&&(o[h]=l);return Object.assign({},this.event,this.clearEvent,{content:o})}getId(){return this.event.event_id}getSender(){return this.event.sender||this.event.user_id}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){let o=`id=${this.getId()} type=${this.getWireType()} sender=${this.getSender()}`;const h=this.getRoomId();h&&(o+=` room=${h}`);const l=this.getDate();return l&&(o+=` ts=${l.toISOString()}`),o}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var o,h;const l=null===(o=this.getWireContent())||void 0===o?void 0:o["m.relates_to"];return l?.rel_type===u.THREAD_RELATION_TYPE.name?l.event_id:(null===(h=this.getThread())||void 0===h?void 0:h.id)||this.threadId}get isThreadRoot(){var o;return!!this.getServerAggregatedRelation(u.THREAD_RELATION_TYPE.name)||(null===(o=this.getThread())||void 0===o?void 0:o.id)===this.getId()}get replyEventId(){var o;return null===(o=(this.getContent()["m.relates_to"]||this.getWireContent()["m.relates_to"])?.["m.in_reply_to"])||void 0===o?void 0:o.event_id}get relationEventId(){var o,h;return null===(h=null===(o=this.getWireContent())||void 0===o?void 0:o["m.relates_to"])||void 0===h?void 0:h.event_id}getPrevContent(){return this.getUnsigned().prev_content||this.event.prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age||this.event.age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}makeEncrypted(o,h,l,e){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=o,this.event.content=h,this.senderCurve25519Key=l,this.claimedEd25519Key=e}isBeingDecrypted(){return null!=this.decryptionPromise}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){var o,h;return"m.bad.encrypted"===(null===(h=null===(o=this.clearEvent)||void 0===o?void 0:o.content)||void 0===h?void 0:h.msgtype)}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(o,h={}){return R(this,void 0,void 0,function*(){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");const l=this.clearEvent&&!this.isDecryptionFailure(),e=h.forceRedecryptIfUntrusted&&this.isKeySourceUntrusted();if(l&&!e)throw new Error("Attempt to decrypt event which has already been decrypted");return this.decryptionPromise?(E.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this.decryptionPromise):(this.decryptionPromise=this.decryptionLoop(o,h),this.decryptionPromise)})}cancelAndResendKeyRequest(o,h){const l=this.getWireContent();return o.requestRoomKey({algorithm:l.algorithm,room_id:this.getRoomId(),session_id:l.session_id,sender_key:l.sender_key},this.getKeyRequestRecipients(h),!0)}getKeyRequestRecipients(o){const h=this.getWireContent(),l=[{userId:o,deviceId:"*"}],e=this.getSender();return e!==o&&l.push({userId:e,deviceId:h.device_id}),l}decryptionLoop(o,h={}){return R(this,void 0,void 0,function*(){for(yield Promise.resolve();;){let l,e;this.retryDecryption=!1;try{o?(l=yield o.decryptEvent(this),!0===h.isRetry&&E.logger.info(`Decrypted event on retry (${this.getDetails()})`)):l=this.badEncryptedMessage("Encryption not enabled")}catch(p){if("DecryptionError"!==p.name)return E.logger.error(`Error ${h.isRetry?"re":""}decrypting event (${this.getDetails()})`,p),this.decryptionPromise=null,void(this.retryDecryption=!1);if(e=p,this.retryDecryption){E.logger.log(`Error decrypting event (${this.getDetails()}), but retrying: `+p.detailedString);continue}E.logger.warn(`Error decrypting event (${this.getDetails()}): `+p.detailedString),l=this.badEncryptedMessage(p.message)}return this.decryptionPromise=null,this.retryDecryption=!1,this.setClearData(l),this.setPushActions(null),void(!1!==h.emit&&this.emit(i.Decrypted,this,e))}})}badEncryptedMessage(o){return{clearEvent:{type:_.EventType.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+o+" **"}}}}setClearData(o){var h,l;this.clearEvent=o.clearEvent,this.senderCurve25519Key=null!==(h=o.senderCurve25519Key)&&void 0!==h?h:null,this.claimedEd25519Key=null!==(l=o.claimedEd25519Key)&&void 0!==l?l:null,this.forwardingCurve25519KeyChain=o.forwardingCurve25519KeyChain||[],this.untrusted=o.untrusted||!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===_.EventType.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(o){this.event.unsigned=o}unmarkLocallyRedacted(){const o=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!o}markLocallyRedacted(o){this._localRedactionEvent||(this.emit(i.BeforeRedaction,this,o),this._localRedactionEvent=o,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=o.event)}applyVisibilityEvent(o){var h,l;const e=null===(h=o?.visible)||void 0===h||h,p=null!==(l=o?.reason)&&void 0!==l?l:null;let b=!1;(this.visibility.visible!==e||!this.visibility.visible&&this.visibility.reason!==p)&&(b=!0),b&&(this.visibility=e?c:Object.freeze({visible:!1,reason:p}),this.emit(i.VisibilityChange,this,e))}messageVisibility(){return this.visibility}makeRedacted(o){if(!o.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(i.BeforeRedaction,this,o),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=o.event;for(const e in this.event)this.event.hasOwnProperty(e)&&!s.has(e)&&delete this.event[e];this.isEncrypted()&&(this.clearEvent=void 0);const h=this.getType()in t?t[this.getType()]:{},l=this.getContent();for(const e in l)l.hasOwnProperty(e)&&!h[e]&&delete l[e];this.invalidateExtensibleEvent()}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return this.getType()===_.EventType.RoomRedaction}asVisibilityChange(){if(!_.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType()))return null;const o=this.getRelation();if(!o||"m.reference"!=o.rel_type)return null;const h=o.event_id;if(!h)return null;const l=this.getWireContent(),p=l.reason;return p&&"string"!=typeof p?null:{visible:!!l.visible,reason:p,eventId:h}}isVisibilityEvent(){return _.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType())}getRedactionEvent(){var o,h,l,e;return this.isRedacted()?null!==(o=this.clearEvent)&&void 0!==o&&o.unsigned?null!==(l=null===(h=this.clearEvent)||void 0===h?void 0:h.unsigned.redacted_because)&&void 0!==l?l:null:null!==(e=this.event.unsigned)&&void 0!==e&&e.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushActions}setPushActions(o){this.pushActions=o}handleRemoteEcho(o){const h=this.getUnsigned(),l=this.getId();this.event=o,h.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=h.redacted_because),this.setStatus(null),this.getId()!==l&&this.emit(i.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-this.getAge()}isSending(){return!!this.status}setStatus(o){this.status=o,this.emit(i.Status,this,o)}replaceLocalEventId(o){this.event.event_id=o,this.emit(i.LocalEventIdReplaced,this)}isRelation(o){var h;const l=null===(h=this.getWireContent())||void 0===h?void 0:h["m.relates_to"];return!(this.isState()&&l?.rel_type===_.RelationType.Replace||!l?.rel_type||!l.event_id||o&&l.rel_type!==o)}getRelation(){var o;return this.isRelation()&&null!==(o=this.getWireContent()["m.relates_to"])&&void 0!==o?o:null}makeReplaced(o){this.isRedacted()&&o||this.isState()||this._replacingEvent!==o&&(this._replacingEvent=o??null,this.emit(i.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(o){var h;return null===(h=this.getUnsigned()["m.relations"])||void 0===h?void 0:h[o]}replacingEventId(){const o=this.getServerAggregatedRelation(_.RelationType.Replace);return o?o.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){var o;const h=this.getServerAggregatedRelation(_.RelationType.Replace);if(h){const l=h.origin_server_ts;if(Number.isFinite(l))return new Date(l)}else if(this._replacingEvent)return null!==(o=this._replacingEvent.getDate())&&void 0!==o?o:void 0}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const o=this.getRelation();return this.replyEventId?this.replyEventId:o?o.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssocation(){return!!this.getAssociatedId()}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(o){const h=this.getRelation();h?h.event_id=o:this.isRedaction()&&(this.event.redacts=o)}flagCancelled(o=!0){this._isCancelled=o}isCancelled(){return this._isCancelled}toSnapshot(){const o=new r(JSON.parse(JSON.stringify(this.event)));for(const[h,l]of Object.entries(this))"event"!==h&&(o[h]=l);return o}isEquivalentTo(o){if(!o)return!1;if(o===this)return!0;const h=(0,d.deepSortedObjectEntries)(this.event),l=(0,d.deepSortedObjectEntries)(o.event);return JSON.stringify(h)===JSON.stringify(l)}toJSON(){const o=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:o,encrypted:this.event}:o}setVerificationRequest(o){this.verificationRequest=o}setTxnId(o){this.txnId=o}getTxnId(){return this.txnId}setThread(o){this.thread&&this.reEmitter.stopReEmitting(this.thread,[u.ThreadEvent.Update]),this.thread=o,this.setThreadId(o?.id),o&&this.reEmitter.reEmit(o,[u.ThreadEvent.Update])}getThread(){return this.thread}setThreadId(o){this.threadId=o}}a.MatrixEvent=r;const s=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),t={[_.EventType.RoomMember]:{membership:1},[_.EventType.RoomCreate]:{creator:1},[_.EventType.RoomJoinRules]:{join_rule:1},[_.EventType.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}}},{"../@types/event":299,"../ReEmitter":309,"../logger":365,"../utils":402,"./event-status":371,"./thread":384,"./typed-event-emitter":385,"matrix-events-sdk":167}],375:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(v,c,i,r){return new(i||(i=Promise))(function(t,n){function o(e){try{l(r.next(e))}catch(p){n(p)}}function h(e){try{l(r.throw(e))}catch(p){n(p)}}function l(e){e.done?t(e.value):function s(t){return t instanceof i?t:new i(function(n){n(t)})}(e.value).then(o,h)}l((r=r.apply(v,c||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.IgnoredInvites=a.PolicyScope=a.IGNORE_INVITES_ACCOUNT_EVENT_KEY=a.POLICIES_ACCOUNT_EVENT_TYPE=void 0;const I=m("matrix-events-sdk"),E=m("./event-timeline"),_=m("../@types/partials"),d=m("../utils");var u,g,v;a.POLICIES_ACCOUNT_EVENT_TYPE=new I.UnstableValue("m.policies","org.matrix.msc3847.policies"),a.IGNORE_INVITES_ACCOUNT_EVENT_KEY=new I.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),(u||(u={})).Ban="m.ban",(v=g=a.PolicyScope||(a.PolicyScope={})).User="m.policy.user",v.Room="m.policy.room",v.Server="m.policy.server",a.IgnoredInvites=class f{constructor(c){this.client=c}addRule(c,i,r){return R(this,void 0,void 0,function*(){const s=yield this.getOrCreateTargetRoom();return(yield this.client.sendStateEvent(s.roomId,c,{entity:i,reason:r,recommendation:u.Ban})).event_id})}removeRule(c){return R(this,void 0,void 0,function*(){yield this.client.redactEvent(c.getRoomId(),c.getId())})}addSource(c){return R(this,void 0,void 0,function*(){yield this.client.joinRoom(c);const i=(yield this.getOrCreateSourceRooms()).map(r=>r.roomId);return!i.includes(c)&&(i.push(c),yield this.withIgnoreInvitesPolicies(r=>{r.sources=i}),!0)})}getRuleForInvite({sender:c,roomId:i}){return R(this,void 0,void 0,function*(){const r=yield this.getOrCreateSourceRooms(),s=c.split(":")[1],t=i.split(":")[1];for(const n of r){const o=n.getUnfilteredTimelineSet().getLiveTimeline().getState(E.EventTimeline.FORWARDS);for(const{scope:h,entities:l}of[{scope:g.Room,entities:[i]},{scope:g.User,entities:[c]},{scope:g.Server,entities:[s,t]}]){const e=o.getStateEvents(h);for(const p of e){const b=p.getContent();if(b?.recommendation!=u.Ban)continue;const y=b?.entity;if(!y)continue;let w;try{w=new RegExp((0,d.globToRegexp)(y,!1))}catch{continue}for(const x of l)if(x&&w.test(x))return p}}}return null})}getOrCreateTargetRoom(){return R(this,void 0,void 0,function*(){let i=this.getIgnoreInvitesPolicies().target;if("string"!=typeof i&&(i=null),i){const r=this.client.getRoom(i);if(r)return r;i=null}return i=(yield this.client.createRoom({name:"Individual Policy Room",preset:_.Preset.PrivateChat})).room_id,yield this.withIgnoreInvitesPolicies(r=>{r.target=i}),this.client.getRoom(i)})}getOrCreateSourceRooms(){return R(this,void 0,void 0,function*(){let i=this.getIgnoreInvitesPolicies().sources,r=!1;Array.isArray(i)||(r=!0,i=[]);let s=i.filter(t=>"string"==typeof t).map(t=>this.client.getRoom(t)).filter(t=>!!t);return s.length!=i.length&&(r=!0),0==s.length&&(r=!0,s=[yield this.getOrCreateTargetRoom()]),r&&(yield this.withIgnoreInvitesPolicies(t=>{t.sources=i})),s})}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(c){return R(this,void 0,void 0,function*(){const{policies:i,ignoreInvitesPolicies:r}=this.getPoliciesAndIgnoreInvitesPolicies();c(r),i[a.IGNORE_INVITES_ACCOUNT_EVENT_KEY.name]=r,yield this.client.setAccountData(a.POLICIES_ACCOUNT_EVENT_TYPE.name,i)})}getPoliciesAndIgnoreInvitesPolicies(){var c;let i={};for(const t of[a.POLICIES_ACCOUNT_EVENT_TYPE.name,a.POLICIES_ACCOUNT_EVENT_TYPE.altName]){if(!t)continue;const n=null===(c=this.client.getAccountData(t))||void 0===c?void 0:c.getContent();if(n){i=n;break}}let r={},s=!1;for(const t of[a.IGNORE_INVITES_ACCOUNT_EVENT_KEY.name,a.IGNORE_INVITES_ACCOUNT_EVENT_KEY.altName]){if(!t)continue;const n=i[t];if(n&&"object"==typeof n){r=n,s=!0;break}}return s||(i[a.IGNORE_INVITES_ACCOUNT_EVENT_KEY.name]=r),{policies:i,ignoreInvitesPolicies:r}}}},{"../@types/partials":302,"../utils":402,"./event-timeline":373,"matrix-events-sdk":167}],376:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(s,t,n,o){void 0===o&&(o=n);var h=Object.getOwnPropertyDescriptor(t,n);(!h||("get"in h?!t.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(s,o,h)}:function(s,t,n,o){void 0===o&&(o=n),s[o]=t[n]}),I=this&&this.__setModuleDefault||(Object.create?function(s,t){Object.defineProperty(s,"default",{enumerable:!0,value:t})}:function(s,t){s.default=t}),E=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var t={};if(null!=s)for(var n in s)"default"!==n&&Object.prototype.hasOwnProperty.call(s,n)&&R(t,s,n);return I(t,s),t};Object.defineProperty(a,"__esModule",{value:!0}),a.ReadReceipt=a.synthesizeReceipt=void 0;const _=m("../@types/read_receipts"),d=m("./typed-event-emitter"),u=E(m("../utils")),g=m("./event"),f=m("../@types/event");function v(s,t,n){var o;return new g.MatrixEvent({content:{[t.getId()]:{[n]:{[s]:{ts:t.getTs(),thread_id:null!==(o=t.threadRootId)&&void 0!==o?o:_.MAIN_ROOM_TIMELINE}}}},type:f.EventType.Receipt,room_id:t.getRoomId()})}a.synthesizeReceipt=v,a.ReadReceipt=class r extends d.TypedEventEmitter{constructor(){super(...arguments),this.receipts={},this.receiptCacheByEventId={}}getReadReceiptForUserId(t,n=!1,o=_.ReceiptType.Read){var h,l;const[e,p]=null!==(l=null===(h=this.receipts[o])||void 0===h?void 0:h[t])&&void 0!==l?l:[];return n?e:p??e}getEventReadUpTo(t,n=!1){var o,h,l,e,p,b,y;const w=this.getUnfilteredTimelineSet(),x=this.getReadReceiptForUserId(t,n,_.ReceiptType.Read),B=this.getReadReceiptForUserId(t,n,_.ReceiptType.ReadPrivate);let J;return x?.eventId&&B?.eventId&&(J=w.compareEventOrdering(x?.eventId,B?.eventId)),!J&&!(null===(o=x?.data)||void 0===o)&&o.ts&&!(null===(h=B?.data)||void 0===h)&&h.ts&&(J=(null===(l=x?.data)||void 0===l?void 0:l.ts)-(null===(e=B?.data)||void 0===e?void 0:e.ts)),J?null!==(y=J<0?B?.eventId:x?.eventId)&&void 0!==y?y:null:null!==(b=null!==(p=B?.eventId)&&void 0!==p?p:x?.eventId)&&void 0!==b?b:null}addReceiptToStructure(t,n,o,h,l){var e,p,b;this.receipts[n]||(this.receipts[n]={}),this.receipts[n][o]||(this.receipts[n][o]=[null,null]);const y=this.receipts[n][o];let w=y[0];if(l&&(w=null!==(e=y[1])&&void 0!==e?e:y[0]),w){const C=this.getUnfilteredTimelineSet().compareEventOrdering(w.eventId,t);if(null!==C&&C>=0)return}const x={eventId:t,data:h},B=l?y[0]:x,J=l?x:y[1];let z=null;B&&J&&(z=this.getUnfilteredTimelineSet().compareEventOrdering(B.eventId,J.eventId));const M=null===z||z<0,L=null!==(p=y[1])&&void 0!==p?p:y[0];if(l&&M?y[1]=x:l||(y[0]=x,M||(y[1]=null)),L!==(null!==(b=y[1])&&void 0!==b?b:y[0])){if(L&&this.receiptCacheByEventId[L.eventId]){const C=L.eventId;this.receiptCacheByEventId[C]=this.receiptCacheByEventId[C].filter(F=>F.type!==n||F.userId!==o),this.receiptCacheByEventId[C].length<1&&delete this.receiptCacheByEventId[C]}this.receiptCacheByEventId[t]||(this.receiptCacheByEventId[t]=[]),this.receiptCacheByEventId[t].push({userId:o,type:n,data:h})}}getReceiptsForEvent(t){return this.receiptCacheByEventId[t.getId()]||[]}addLocalEchoReceipt(t,n,o){this.addReceipt(v(t,n,o),!0)}getUsersReadUpTo(t){return this.getReceiptsForEvent(t).filter(function(n){return u.isSupportedReceiptType(n.type)}).map(function(n){return n.userId})}hasUserReadEvent(t,n){var o,h;const l=this.getEventReadUpTo(t,!1);if(l===n||null!==(o=this.timeline)&&void 0!==o&&o.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===t)return!0;for(let e=(null===(h=this.timeline)||void 0===h?void 0:h.length)-1;e>=0;--e){const p=this.timeline[e];if(p.getId()===n)return!1;if(p.getId()===l)return!0}return!1}}},{"../@types/event":299,"../@types/read_receipts":303,"../utils":402,"./event":374,"./typed-event-emitter":385}],377:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.RelationsContainer=void 0;const R=m("./relations"),I=m("./event");a.RelationsContainer=class E{constructor(d,u){this.client=d,this.room=u,this.relations=new Map}getChildEventsForEvent(d,u,g){var f,v;return null===(v=null===(f=this.relations.get(d))||void 0===f?void 0:f.get(u))||void 0===v?void 0:v.get(g)}getAllChildEventsForEvent(d){var u;const g=null!==(u=this.relations.get(d))&&void 0!==u?u:new Map,f=[];for(const v of g.values())for(const c of v.values())f.push(...c.getRelations());return f}aggregateParentEvent(d){const u=this.relations.get(d.getId());if(u)for(const g of u.values())for(const f of g.values())f.setTargetEvent(d)}aggregateChildEvent(d,u){var g,f,v;if(d.isRedacted()||d.status===I.EventStatus.CANCELLED)return;const c=d.getRelation();if(!c)return;const i=()=>{d.isDecryptionFailure()?d.once(I.MatrixEventEvent.Decrypted,i):this.aggregateChildEvent(d,u)};if(d.isBeingDecrypted()||d.shouldAttemptDecryption())return void d.once(I.MatrixEventEvent.Decrypted,i);const{event_id:r,rel_type:s}=c,t=d.getType();let n=this.relations.get(r);n||(n=new Map,this.relations.set(r,n));let o=n.get(s);o||(o=new Map,n.set(s,o));let h=o.get(t);if(!h){h=new R.Relations(s,t,this.client),o.set(t,h);const l=null!==(g=this.room)&&void 0!==g?g:u?.room,e=null!==(v=null!==(f=u?.findEventById(r))&&void 0!==f?f:l?.findEventById(r))&&void 0!==v?v:l?.getPendingEvent(r);e&&h.setTargetEvent(e)}h.addEvent(d)}}},{"./event":374,"./relations":378}],378:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(v,c,i,r){return new(i||(i=Promise))(function(t,n){function o(e){try{l(r.next(e))}catch(p){n(p)}}function h(e){try{l(r.throw(e))}catch(p){n(p)}}function l(e){e.done?t(e.value):function s(t){return t instanceof i?t:new i(function(n){n(t)})}(e.value).then(o,h)}l((r=r.apply(v,c||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.Relations=a.RelationsEvent=void 0;const I=m("./event"),E=m("../logger"),_=m("../@types/event"),d=m("./typed-event-emitter"),u=m("./room");var g,v;(v=g=a.RelationsEvent||(a.RelationsEvent={})).Add="Relations.add",v.Remove="Relations.remove",v.Redaction="Relations.redaction",a.Relations=class f extends d.TypedEventEmitter{constructor(c,i,r){super(),this.relationType=c,this.eventType=i,this.relationEventIds=new Set,this.relations=new Set,this.annotationsByKey={},this.annotationsBySender={},this.sortedAnnotationsByKey=[],this.targetEvent=null,this.creationEmitted=!1,this.onEventStatus=(s,t)=>{s.isSending()?t===I.EventStatus.CANCELLED&&(s.removeListener(I.MatrixEventEvent.Status,this.onEventStatus),this.removeEvent(s)):s.removeListener(I.MatrixEventEvent.Status,this.onEventStatus)},this.onBeforeRedaction=s=>R(this,void 0,void 0,function*(){if(this.relations.has(s)){if(this.relations.delete(s),this.relationType===_.RelationType.Annotation)this.removeAnnotationFromAggregation(s);else if(this.relationType===_.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const t=yield this.getLastReplacement();this.targetEvent.makeReplaced(t)}s.removeListener(I.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(g.Redaction,s)}}),this.client=r instanceof u.Room?r.client:r}addEvent(c){return R(this,void 0,void 0,function*(){if(this.relationEventIds.has(c.getId()))return;const i=c.getRelation();if(!i)return void E.logger.error("Event must have relation info");const r=i.rel_type,s=c.getType();if(this.relationType===r&&this.eventType===s){if(c.isSending()&&c.on(I.MatrixEventEvent.Status,this.onEventStatus),this.relations.add(c),this.relationEventIds.add(c.getId()),this.relationType===_.RelationType.Annotation)this.addAnnotationToAggregation(c);else if(this.relationType===_.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const t=yield this.getLastReplacement();this.targetEvent.makeReplaced(t)}c.on(I.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(g.Add,c),this.maybeEmitCreated()}else E.logger.error("Event relation info doesn't match this container")})}removeEvent(c){return R(this,void 0,void 0,function*(){if(!this.relations.has(c))return;const i=c.getRelation();if(!i)return void E.logger.error("Event must have relation info");const r=i.rel_type,s=c.getType();if(this.relationType===r&&this.eventType===s){if(this.relations.delete(c),this.relationType===_.RelationType.Annotation)this.removeAnnotationFromAggregation(c);else if(this.relationType===_.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const t=yield this.getLastReplacement();this.targetEvent.makeReplaced(t)}this.emit(g.Remove,c)}else E.logger.error("Event relation info doesn't match this container")})}getRelations(){return[...this.relations]}addAnnotationToAggregation(c){var i;const{key:r}=null!==(i=c.getRelation())&&void 0!==i?i:{};if(!r)return;let s=this.annotationsByKey[r];s||(s=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,s])),s.add(c),this.sortedAnnotationsByKey.sort((o,h)=>h[1].size-o[1].size);const t=c.getSender();let n=this.annotationsBySender[t];n||(n=this.annotationsBySender[t]=new Set),n.add(c)}removeAnnotationFromAggregation(c){var i;const{key:r}=null!==(i=c.getRelation())&&void 0!==i?i:{};if(!r)return;const s=this.annotationsByKey[r];s&&(s.delete(c),this.sortedAnnotationsByKey.sort((o,h)=>h[1].size-o[1].size));const t=c.getSender(),n=this.annotationsBySender[t];n&&n.delete(c)}getSortedAnnotationsByKey(){return this.relationType!==_.RelationType.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==_.RelationType.Annotation?null:this.annotationsBySender}getLastReplacement(){return R(this,void 0,void 0,function*(){if(this.relationType!==_.RelationType.Replace||!this.targetEvent)return null;const i=this.targetEvent.getServerAggregatedRelation(_.RelationType.Replace)?.origin_server_ts,r=this.getRelations().reduce((s,t)=>t.getSender()!==this.targetEvent.getSender()||i&&i>t.getTs()||s&&s.getTs()>t.getTs()?s:t,null);return r?.shouldAttemptDecryption()&&this.client.isCryptoEnabled()?yield r.attemptDecryption(this.client.crypto):r?.isBeingDecrypted()&&(yield r.getDecryptionPromise()),r})}setTargetEvent(c){return R(this,void 0,void 0,function*(){if(!this.targetEvent){if(this.targetEvent=c,this.relationType===_.RelationType.Replace&&!this.targetEvent.isState()){const i=yield this.getLastReplacement();i&&this.targetEvent.makeReplaced(i)}this.maybeEmitCreated()}})}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(I.MatrixEventEvent.RelationsCreated,this.relationType,this.eventType))}}},{"../@types/event":299,"../logger":365,"./event":374,"./room":382,"./typed-event-emitter":385}],379:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(n,o,h,l){void 0===l&&(l=h);var e=Object.getOwnPropertyDescriptor(o,h);(!e||("get"in e?!o.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return o[h]}}),Object.defineProperty(n,l,e)}:function(n,o,h,l){void 0===l&&(l=h),n[l]=o[h]}),I=this&&this.__setModuleDefault||(Object.create?function(n,o){Object.defineProperty(n,"default",{enumerable:!0,value:o})}:function(n,o){n.default=o}),E=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var o={};if(null!=n)for(var h in n)"default"!==h&&Object.prototype.hasOwnProperty.call(n,h)&&R(o,n,h);return I(o,n),o};Object.defineProperty(a,"__esModule",{value:!0}),a.RoomMember=a.RoomMemberEvent=void 0;const _=m("../content-repo"),d=E(m("../utils")),u=m("../logger"),g=m("./typed-event-emitter"),f=m("../@types/event");var v,n;(n=v=a.RoomMemberEvent||(a.RoomMemberEvent={})).Membership="RoomMember.membership",n.Name="RoomMember.name",n.PowerLevel="RoomMember.powerLevel",n.Typing="RoomMember.typing",a.RoomMember=class c extends g.TypedEventEmitter{constructor(o,h){super(),this.roomId=o,this.userId=h,this._isOutOfBand=!1,this.modified=-1,this.requestedProfileInfo=!1,this.typing=!1,this.powerLevel=0,this.powerLevelNorm=0,this.disambiguate=!1,this.events={},this.name=h,this.rawDisplayName=h,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(o,h){var l,e;const p=null!==(l=o.getDirectionalContent().displayname)&&void 0!==l?l:"";if(o.getType()!==f.EventType.RoomMember)return;this._isOutOfBand=!1,this.events.member=o;const b=this.membership;this.membership=o.getDirectionalContent().membership,void 0===this.membership&&u.logger.trace(`membership event with membership undefined (forwardLooking: ${o.forwardLooking})!`,o.getContent(),"prevcontent is ",o.getPrevContent()),this.disambiguate=function s(n,o,h){return!!(o&&o!==n&&d.removeHiddenChars(o)&&h)&&!!(i.test(o)||r.test(o)||h.getUserIdsWithDisplayName(o).some(e=>e!==n))}(this.userId,p,h);const y=this.name;this.name=function t(n,o,h){return o&&o!==n?h?d.removeDirectionOverrideChars(o)+" ("+n+")":d.removeHiddenChars(o)?d.removeDirectionOverrideChars(o):n:n}(this.userId,p,this.disambiguate),this.rawDisplayName=d.removeDirectionOverrideChars(null!==(e=o.getDirectionalContent().displayname)&&void 0!==e?e:""),(!this.rawDisplayName||!d.removeHiddenChars(this.rawDisplayName))&&(this.rawDisplayName=this.userId),b!==this.membership&&(this.updateModifiedTime(),this.emit(v.Membership,o,this,b)),y!==this.name&&(this.updateModifiedTime(),this.emit(v.Name,o,this,y))}setPowerLevelEvent(o){if(o.getType()!==f.EventType.RoomPowerLevels||""!==o.getStateKey())return;const h=o.getDirectionalContent();let l=h.users_default||0;const e=h.users||{};Object.values(e).forEach(y=>{l=Math.max(l,y)});const p=this.powerLevel,b=this.powerLevelNorm;this.powerLevel=void 0!==e[this.userId]&&Number.isInteger(e[this.userId])?e[this.userId]:void 0!==h.users_default?h.users_default:0,this.powerLevelNorm=0,l>0&&(this.powerLevelNorm=100*this.powerLevel/l),(p!==this.powerLevel||b!==this.powerLevelNorm)&&(this.updateModifiedTime(),this.emit(v.PowerLevel,o,this))}setTypingEvent(o){if("m.typing"!==o.getType())return;const h=this.typing;this.typing=!1;const l=o.getContent().user_ids;Array.isArray(l)&&(-1!==l.indexOf(this.userId)&&(this.typing=!0),h!==this.typing&&(this.updateModifiedTime(),this.emit(v.Typing,o,this)))}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return"leave"===this.membership&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const o=this.events.member;let h=o.getContent(),l=o.getSender();if("join"===h.membership&&(h=o.getPrevContent(),l=o.getUnsigned().prev_sender),"invite"===h.membership&&h.is_direct)return l}}getAvatarUrl(o,h,l,e,p=!0,b){const y=this.getMxcAvatarUrl();return(y||p)&&(0,_.getHttpUriForMxc)(o,y,h,l,e,b)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}};const i=/@.+:.+/,r=/[\u200E\u200F\u202A-\u202F]/},{"../@types/event":299,"../content-repo":315,"../logger":365,"../utils":402,"./typed-event-emitter":385}],380:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(l,e,p,b){void 0===b&&(b=p);var y=Object.getOwnPropertyDescriptor(e,p);(!y||("get"in y?!e.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return e[p]}}),Object.defineProperty(l,b,y)}:function(l,e,p,b){void 0===b&&(b=p),l[b]=e[p]}),I=this&&this.__setModuleDefault||(Object.create?function(l,e){Object.defineProperty(l,"default",{enumerable:!0,value:e})}:function(l,e){l.default=e}),E=this&&this.__importStar||function(l){if(l&&l.__esModule)return l;var e={};if(null!=l)for(var p in l)"default"!==p&&Object.prototype.hasOwnProperty.call(l,p)&&R(e,l,p);return I(e,l),e},_=this&&this.__awaiter||function(l,e,p,b){return new(p||(p=Promise))(function(w,x){function B(M){try{z(b.next(M))}catch(L){x(L)}}function J(M){try{z(b.throw(M))}catch(L){x(L)}}function z(M){M.done?w(M.value):function y(w){return w instanceof p?w:new p(function(x){x(w)})}(M.value).then(B,J)}z((b=b.apply(l,e||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.RoomState=a.RoomStateEvent=void 0;const d=m("./room-member"),u=m("../logger"),g=E(m("../utils")),f=m("../@types/event"),v=m("./event"),c=m("../@types/partials"),i=m("./typed-event-emitter"),r=m("./beacon"),s=m("../ReEmitter"),t=m("../@types/beacon");var n,l,o;(l=n||(n={}))[l.NotStarted=0]="NotStarted",l[l.InProgress=1]="InProgress",l[l.Finished=2]="Finished",function(l){l.Events="RoomState.events",l.Members="RoomState.members",l.NewMember="RoomState.newMember",l.Update="RoomState.update",l.BeaconLiveness="RoomState.BeaconLiveness",l.Marker="RoomState.Marker"}(o=a.RoomStateEvent||(a.RoomStateEvent={}));class h extends i.TypedEventEmitter{constructor(e,p={status:n.NotStarted}){super(),this.roomId=e,this.oobMemberFlags=p,this.reEmitter=new s.TypedReEmitter(this),this.sentinels={},this.displayNameToUserIds=new Map,this.userIdsToDisplayNames={},this.tokenToInvite={},this.joinedMemberCount=null,this.summaryJoinedMemberCount=null,this.invitedMemberCount=null,this.summaryInvitedMemberCount=null,this.modified=-1,this.members={},this.events=new Map,this.paginationToken=null,this.beacons=new Map,this._liveBeaconIds=[],this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce((e,p)=>"join"===p.membership?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce((e,p)=>"invite"===p.membership?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(p=>!e.includes(p.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let p=this.sentinels[e];if(void 0===p){p=new d.RoomMember(this.roomId,e);const b=this.members[e];b?.events.member&&p.setMembershipEvent(b.events.member,this),this.sentinels[e]=p}return p}getStateEvents(e,p){return this.events.has(e)?void 0===p?Array.from(this.events.get(e).values()):this.events.get(e).get(p)||null:void 0===p?[]:null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){const e=new h(this.roomId,this.oobMemberFlags),p=this.oobMemberFlags.status;return this.oobMemberFlags.status=n.NotStarted,Array.from(this.events.values()).forEach(b=>{e.setStateEvents(Array.from(b.values()))}),this.oobMemberFlags.status=p,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==n.Finished&&this.getMembers().forEach(b=>{var y;b.isOutOfBand()&&(null===(y=e.getMember(b.userId))||void 0===y||y.markOutOfBand())}),e}setUnknownStateEvents(e){const p=e.filter(b=>!this.events.has(b.getType())||!this.events.get(b.getType()).has(b.getStateKey()));this.setStateEvents(p)}setStateEvents(e,p){this.updateModifiedTime(),e.forEach(b=>{var y;if(b.getRoomId()!==this.roomId||!b.isState())return;t.M_BEACON_INFO.matches(b.getType())&&this.setBeacon(b);const w=this.getStateEventMatching(b);this.setStateEvent(b),b.getType()===f.EventType.RoomMember&&(this.updateDisplayNameCache(b.getStateKey(),null!==(y=b.getContent().displayname)&&void 0!==y?y:""),this.updateThirdPartyTokenCache(b)),this.emit(o.Events,b,this,w)}),this.onBeaconLivenessChange(),e.forEach(b=>{if(b.getRoomId()===this.roomId&&b.isState())if(b.getType()===f.EventType.RoomMember){const y=b.getStateKey();("leave"===b.getContent().membership||"ban"===b.getContent().membership)&&(b.getContent().avatar_url=b.getContent().avatar_url||b.getPrevContent().avatar_url,b.getContent().displayname=b.getContent().displayname||b.getPrevContent().displayname);const w=this.getOrCreateMember(y,b);w.setMembershipEvent(b,this),this.updateMember(w),this.emit(o.Members,b,this,w)}else if(b.getType()===f.EventType.RoomPowerLevels){if(""!==b.getStateKey())return;Object.values(this.members).forEach(w=>{const x=w.getLastModifiedTime();w.setPowerLevelEvent(b),x!==w.getLastModifiedTime()&&this.emit(o.Members,b,this,w)}),this.sentinels={}}else f.UNSTABLE_MSC2716_MARKER.matches(b.getType())&&this.emit(o.Marker,b,p)}),this.emit(o.Update,this)}processBeaconEvents(e,p){if(!e.length||!this.beacons.size)return;const b=[...this.beacons.values()].reduce((w,x)=>Object.assign(Object.assign({},w),{[x.beaconInfoId]:x}),{}),y=(w,x)=>{if(!t.M_BEACON.matches(x.getType()))return;const B=b[w];B&&B.addLocations([x])};e.forEach(w=>{var x;const B=null===(x=w.getRelation())||void 0===x?void 0:x.event_id;!B||!b[B]||(p.decryptEventIfNeeded(w),w.isBeingDecrypted()||w.isDecryptionFailure()?w.once(v.MatrixEventEvent.Decrypted,()=>_(this,void 0,void 0,function*(){y(B,w)})):y(B,w))})}getOrCreateMember(e,p){let b=this.members[e];return b||(b=new d.RoomMember(this.roomId,e),this.members[e]=b,this.emit(o.NewMember,p,this,b)),b}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var p;const b=(0,r.getBeaconInfoIdentifier)(e);if(this.beacons.has(b)){const w=this.beacons.get(b);return e.isRedacted()?void(w.beaconInfoId===(null===(p=e.getRedactionEvent())||void 0===p?void 0:p.redacts)&&(w.destroy(),this.beacons.delete(b))):w.update(e)}if(e.isRedacted())return;const y=new r.Beacon(e);this.reEmitter.reEmit(y,[r.BeaconEvent.New,r.BeaconEvent.Update,r.BeaconEvent.Destroy,r.BeaconEvent.LivenessChange]),this.emit(r.BeaconEvent.New,e,y),y.on(r.BeaconEvent.LivenessChange,this.onBeaconLivenessChange.bind(this)),y.on(r.BeaconEvent.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(y.identifier,y)}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit(o.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var p,b;return null!==(b=null===(p=this.events.get(e.getType()))||void 0===p?void 0:p.get(e.getStateKey()))&&void 0!==b?b:null}updateMember(e){const p=this.getStateEvents(f.EventType.RoomPowerLevels,"");p&&e.setPowerLevelEvent(p),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===n.NotStarted}markOutOfBandMembersStarted(){this.oobMemberFlags.status===n.NotStarted&&(this.oobMemberFlags.status=n.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===n.InProgress&&(this.oobMemberFlags.status=n.NotStarted)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach(p=>{this.members[p].isOutOfBand()&&(++e,delete this.members[p])}),u.logger.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=n.NotStarted}setOutOfBandMembers(e){u.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===n.InProgress&&(u.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=n.Finished,e.forEach(p=>this.setOutOfBandMember(p)),this.emit(o.Update,this))}setOutOfBandMember(e){if(e.getType()!==f.EventType.RoomMember)return;const p=e.getStateKey(),b=this.getMember(p);if(b&&!b.isOutOfBand())return;const y=this.getOrCreateMember(p,e);y.setMembershipEvent(e,this),y.markOutOfBand(),this.updateDisplayNameCache(y.userId,y.name),this.setStateEvent(e),this.updateMember(y),this.emit(o.Members,e,this,y)}setTypingEvent(e){Object.values(this.members).forEach(function(p){p.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var p;return null!==(p=this.displayNameToUserIds.get(g.removeHiddenChars(e)))&&void 0!==p?p:[]}maySendRedactionForEvent(e,p){const b=this.getMember(p);if(!b||"leave"===b.membership||e.status||e.isRedacted())return!1;const y=this.maySendEvent(f.EventType.RoomRedaction,p);return e.getSender()===p?y:this.hasSufficientPowerLevelFor("redact",b.powerLevel)}hasSufficientPowerLevelFor(e,p){const b=this.getStateEvents(f.EventType.RoomPowerLevels,"");let y={};b&&(y=b.getContent());let w=50;return g.isNumber(y[e])&&(w=y[e]),p>=w}maySendMessage(e){return this.maySendEventOfType(f.EventType.RoomMessage,e,!1)}maySendEvent(e,p){return this.maySendEventOfType(e,p,!1)}mayClientSendStateEvent(e,p){return!(p.isGuest()||!p.credentials.userId)&&this.maySendStateEvent(e,p.credentials.userId)}maySendStateEvent(e,p){return this.maySendEventOfType(e,p,!0)}maySendEventOfType(e,p,b){const y=this.getStateEvents(f.EventType.RoomPowerLevels,"");let w,x={},B=0,J=0,z=0;if(y){w=y.getContent(),x=w.events||{},B=Number.isSafeInteger(w.state_default)?w.state_default:50;const L=w.users&&w.users[p];Number.isSafeInteger(L)?z=L:Number.isSafeInteger(w.users_default)&&(z=w.users_default),Number.isSafeInteger(w.events_default)&&(J=w.events_default)}let M=b?B:J;return Number.isSafeInteger(x[e])&&(M=x[e]),z>=M}mayTriggerNotifOfType(e,p){const b=this.getMember(p);if(!b)return!1;const y=this.getStateEvents(f.EventType.RoomPowerLevels,"");let w=50;return y&&y.getContent()&&y.getContent().notifications&&g.isNumber(y.getContent().notifications[e])&&(w=y.getContent().notifications[e]),b.powerLevel>=w}getJoinRule(){var e;return(null!==(e=this.getStateEvents(f.EventType.RoomJoinRules,"")?.getContent())&&void 0!==e?e:{}).join_rule||c.JoinRule.Invite}getHistoryVisibility(){var e;return(null!==(e=this.getStateEvents(f.EventType.RoomHistoryVisibility,"")?.getContent())&&void 0!==e?e:{}).history_visibility||c.HistoryVisibility.Shared}getGuestAccess(){var e;return(null!==(e=this.getStateEvents(f.EventType.RoomGuestAccess,"")?.getContent())&&void 0!==e?e:{}).guest_access||c.GuestAccess.Forbidden}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const p=(e.getContent().third_party_invite.signed||{}).token;!p||!this.getStateEvents(f.EventType.RoomThirdPartyInvite,p)||(this.tokenToInvite[p]=e)}updateDisplayNameCache(e,p){var b;const y=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],y){const x=g.removeHiddenChars(y),B=this.displayNameToUserIds.get(x);if(B){const J=B.filter(z=>z!==e);this.displayNameToUserIds.set(x,J)}}this.userIdsToDisplayNames[e]=p;const w=p&&g.removeHiddenChars(p);if(w){const x=null!==(b=this.displayNameToUserIds.get(w))&&void 0!==b?b:[];x.push(e),this.displayNameToUserIds.set(w,x)}}}a.RoomState=h},{"../@types/beacon":298,"../@types/event":299,"../@types/partials":302,"../ReEmitter":309,"../logger":365,"../utils":402,"./beacon":369,"./event":374,"./room-member":379,"./typed-event-emitter":385}],381:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.RoomSummary=void 0,a.RoomSummary=class R{constructor(E,_){this.roomId=E}}},{}],382:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(N,T,S,U){void 0===U&&(U=S);var W=Object.getOwnPropertyDescriptor(T,S);(!W||("get"in W?!T.__esModule:W.writable||W.configurable))&&(W={enumerable:!0,get:function(){return T[S]}}),Object.defineProperty(N,U,W)}:function(N,T,S,U){void 0===U&&(U=S),N[U]=T[S]}),I=this&&this.__setModuleDefault||(Object.create?function(N,T){Object.defineProperty(N,"default",{enumerable:!0,value:T})}:function(N,T){N.default=T}),E=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var T={};if(null!=N)for(var S in N)"default"!==S&&Object.prototype.hasOwnProperty.call(N,S)&&R(T,N,S);return I(T,N),T},_=this&&this.__awaiter||function(N,T,S,U){return new(S||(S=Promise))(function(k,D){function Q(ue){try{ae(U.next(ue))}catch(be){D(be)}}function ee(ue){try{ae(U.throw(ue))}catch(be){D(be)}}function ae(ue){ue.done?k(ue.value):function W(k){return k instanceof S?k:new S(function(D){D(k)})}(ue.value).then(Q,ee)}ae((U=U.apply(N,T||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.RoomNameType=a.Room=a.RoomEvent=a.NotificationCountType=a.KNOWN_SAFE_ROOM_VERSION=void 0;const d=m("./event-timeline-set"),u=m("./event-timeline"),g=m("../content-repo"),f=E(m("../utils")),v=m("../utils"),c=m("./event"),i=m("./event-status"),r=m("./room-member"),s=m("./room-summary"),t=m("../logger"),n=m("../ReEmitter"),o=m("../@types/event"),h=m("../client"),l=m("../filter"),e=m("./room-state"),p=m("./beacon"),b=m("./thread"),y=m("../@types/read_receipts"),w=m("./relations-container"),x=m("./read-receipt"),B=m("../feature");a.KNOWN_SAFE_ROOM_VERSION="9";const J=["1","2","3","4","5","6","7","8","9"];var M,N,L;(N=M=a.NotificationCountType||(a.NotificationCountType={})).Highlight="highlight",N.Total="total",function(N){N.MyMembership="Room.myMembership",N.Tags="Room.tags",N.AccountData="Room.accountData",N.Receipt="Room.receipt",N.Name="Room.name",N.Redaction="Room.redaction",N.RedactionCancelled="Room.redactionCancelled",N.LocalEchoUpdated="Room.localEchoUpdated",N.Timeline="Room.timeline",N.TimelineReset="Room.timelineReset",N.TimelineRefresh="Room.TimelineRefresh",N.OldStateUpdated="Room.OldStateUpdated",N.CurrentStateUpdated="Room.CurrentStateUpdated",N.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",N.UnreadNotifications="Room.UnreadNotifications"}(L=a.RoomEvent||(a.RoomEvent={})),a.Room=class j extends x.ReadReceipt{constructor(T,S,U,W={}){super(),this.roomId=T,this.client=S,this.myUserId=U,this.opts=W,this.txnToEvent={},this.notificationCounts={},this.threadNotifications=new Map,this.cachedThreadReadReceipts=new Map,this.threadsTimelineSets=[],this.filteredTimelineSets={},this.timelineNeedsRefresh=!1,this.summaryHeroes=null,this.getTypeWarning=!1,this.getVersionWarning=!1,this.tags={},this.accountData={},this.summary=null,this.relations=new w.RelationsContainer(this.client,this),this.threads=new Map,this.visibilityEvents=new Map,this.threadTimelineSetsPromise=null,this.threadsReady=!1,this.updateThreadRootEvents=(k,D,Q)=>{var ee,ae;k.length&&(this.updateThreadRootEvent(null===(ee=this.threadsTimelineSets)||void 0===ee?void 0:ee[0],k,D,Q),k.hasCurrentUserParticipated&&this.updateThreadRootEvent(null===(ae=this.threadsTimelineSets)||void 0===ae?void 0:ae[1],k,D,Q))},this.updateThreadRootEvent=(k,D,Q,ee)=>{k&&D.rootEvent&&(ee&&k.removeEvent(D.id),b.Thread.hasServerSideSupport?k.addLiveEvent(D.rootEvent,{duplicateStrategy:d.DuplicateStrategy.Replace,fromCache:!1,roomState:this.currentState}):k.addEventToTimeline(D.rootEvent,k.getLiveTimeline(),{toStartOfTimeline:Q}))},this.applyRedaction=k=>{if(k.isRedaction()){const D=k.event.redacts,Q=D?this.findEventById(D):void 0;Q&&(Q.makeRedacted(k),Q.isState()&&this.currentState.getStateEvents(Q.getType(),Q.getStateKey())?.getId()===Q.getId()&&this.currentState.setStateEvents([Q]),this.emit(L.Redaction,k,this),this.visibilityEvents.delete(D),Q.isVisibilityEvent()&&this.redactVisibilityChangeEvent(k))}},this.setMaxListeners(100),this.reEmitter=new n.TypedReEmitter(this),W.pendingEventOrdering=W.pendingEventOrdering||h.PendingEventOrdering.Chronological,this.name=T,this.normalizedName=T,this.timelineSets=[new d.EventTimelineSet(this,W)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[L.Timeline,L.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===h.PendingEventOrdering.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(k=>{const D=this.client.getEventMapper({toDevice:!1,decrypt:!1});k.forEach(Q=>_(this,void 0,void 0,function*(){const ee=D(Q);ee.getType()===o.EventType.RoomMessageEncrypted&&this.client.isCryptoEnabled()&&(yield ee.attemptDecryption(this.client.crypto)),ee.setStatus(i.EventStatus.NOT_SENT),this.addPendingEvent(ee,ee.getTxnId())}))})),this.membersPromise=this.opts.lazyLoadMembers?void 0:Promise.resolve(!1)}createThreadsTimelineSets(){var T;return _(this,void 0,void 0,function*(){if(this.threadTimelineSetsPromise)return this.threadTimelineSetsPromise;if(null!==(T=this.client)&&void 0!==T&&T.supportsExperimentalThreads())try{this.threadTimelineSetsPromise=Promise.all([this.createThreadTimelineSet(),this.createThreadTimelineSet(b.ThreadFilterType.My)]);const S=yield this.threadTimelineSetsPromise;return this.threadsTimelineSets.push(...S),S}catch{return this.threadTimelineSetsPromise=null,null}return null})}decryptCriticalEvents(){return _(this,void 0,void 0,function*(){if(!this.client.isCryptoEnabled())return;const T=this.getEventReadUpTo(this.client.getUserId(),!0),S=this.getLiveTimeline().getEvents(),U=S.findIndex(k=>k.event.event_id===T),W=S.slice(U).filter(k=>k.shouldAttemptDecryption()).reverse().map(k=>k.attemptDecryption(this.client.crypto,{isRetry:!0}));yield Promise.allSettled(W)})}decryptAllEvents(){return _(this,void 0,void 0,function*(){if(!this.client.isCryptoEnabled())return;const T=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter(S=>S.shouldAttemptDecryption()).reverse().map(S=>S.attemptDecryption(this.client.crypto,{isRetry:!0}));yield Promise.allSettled(T)})}getCreator(){var T;return null!==(T=this.currentState.getStateEvents(o.EventType.RoomCreate,"")?.getContent().creator)&&void 0!==T?T:null}getVersion(){var T;const S=this.currentState.getStateEvents(o.EventType.RoomCreate,"");return S?null!==(T=S.getContent().room_version)&&void 0!==T?T:"1":(this.getVersionWarning||(t.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}shouldUpgradeToVersion(){return J.includes(this.getVersion())?null:a.KNOWN_SAFE_ROOM_VERSION}getRecommendedVersion(){return _(this,void 0,void 0,function*(){let S=(yield this.client.getCapabilities())["m.room_versions"];if(!S){S={default:a.KNOWN_SAFE_ROOM_VERSION,available:{}};for(const W of J)S.available[W]=h.RoomVersionStability.Stable}let U=this.checkVersionAgainstCapability(S);if(U.urgent&&U.needsUpgrade){if(t.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),S=(yield this.client.getCapabilities(!0))["m.room_versions"],!S)return t.logger.warn("No room version capability - assuming upgrade required."),U;U=this.checkVersionAgainstCapability(S)}return U})}checkVersionAgainstCapability(T){const S=this.getVersion();t.logger.log(`[${this.roomId}] Current version: ${S}`),t.logger.log(`[${this.roomId}] Version capability: `,T);const U={version:S,needsUpgrade:!1,urgent:!1};return S===T.default||Object.keys(T.available).filter(k=>"stable"===T.available[k]).includes(S)||(U.version=T.default,U.needsUpgrade=!0,U.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),t.logger.warn(U.urgent?`URGENT upgrade required on ${this.roomId}`:`Non-urgent upgrade required on ${this.roomId}`)),U}userMayUpgradeRoom(T){return this.currentState.maySendStateEvent(o.EventType.RoomTombstone,T)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(T){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const S=f.removeElement(this.pendingEventList,function(U){return U.getId()==T},!1);return this.savePendingEvents(),S}hasPendingEvent(T){var S,U;return null!==(U=null===(S=this.pendingEventList)||void 0===S?void 0:S.some(W=>W.getId()===T))&&void 0!==U&&U}getPendingEvent(T){var S,U;return null!==(U=null===(S=this.pendingEventList)||void 0===S?void 0:S.find(W=>W.getId()===T))&&void 0!==U?U:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}getLastActiveTimestamp(){const S=this.getLiveTimeline().getEvents();return S.length?S[S.length-1].getTs():Number.MIN_SAFE_INTEGER}getMyMembership(){var T;return null!==(T=this.selfMembership)&&void 0!==T?T:"leave"}getDMInviter(){var T;const S=this.getMember(this.myUserId);return S?S.getDMInviter():"invite"===this.selfMembership&&2===this.getInvitedAndJoinedMemberCount()?null===(T=this.summaryHeroes)||void 0===T?void 0:T[0]:void 0}guessDMUserId(){const T=this.getMember(this.myUserId);if(T){const W=T.getDMInviter();if(W)return W}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const U=this.currentState.getMembers().find(W=>W.userId!==this.myUserId);return U?U.userId:this.myUserId}getAvatarFallbackMember(){if(this.getInvitedAndJoinedMemberCount()>2)return;const S=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(S){const W=this.summaryHeroes.map(k=>this.getMember(k)).find(k=>!!k);if(W)return W}const U=this.currentState.getMembers();if(U.length<=2){const W=U.find(k=>k.userId!==this.myUserId);if(W)return W}if(S){const W=this.summaryHeroes.map(k=>this.client.getUser(k)).find(k=>!!k);if(W){const k=new r.RoomMember(this.roomId,W.userId);return k.user=W,k}}}updateMyMembership(T){const S=this.selfMembership;this.selfMembership=T,S!==T&&("leave"===T&&this.cleanupAfterLeaving(),this.emit(L.MyMembership,this,T,S))}loadMembersFromServer(){return _(this,void 0,void 0,function*(){const T=this.client.store.getSyncToken();return(yield this.client.members(this.roomId,void 0,"leave",T??void 0)).chunk})}loadMembers(){return _(this,void 0,void 0,function*(){let T=!1,S=yield this.client.store.getOutOfBandMembers(this.roomId);return(null===S||this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId))&&(T=!0,S=yield this.loadMembersFromServer(),t.logger.log(`LL: got ${S.length} members from server for room ${this.roomId}`)),{memberEvents:S.map(this.client.getEventMapper()),fromServer:T}})}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const T=this.loadMembers().then(S=>(this.currentState.setOutOfBandMembers(S.memberEvents),this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId)&&this.client.crypto.trackRoomDevices(this.roomId),S.fromServer)).catch(S=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),S});return T.then(S=>{if(S){const U=this.currentState.getMembers().filter(k=>k.isOutOfBand()).map(k=>{var D;return null===(D=k.events.member)||void 0===D?void 0:D.event});return t.logger.log(`LL: telling store to write ${U.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,U).catch(k=>{t.logger.log("LL: storing OOB room members failed, oh well",k)})}}).catch(S=>{t.logger.error(S)}),this.membersPromise=T,this.membersPromise}clearLoadedMembersIfNeeded(){return _(this,void 0,void 0,function*(){this.opts.lazyLoadMembers&&this.membersPromise&&(yield this.loadMembersIfNeeded(),yield this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=void 0)})}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(T=>{t.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),t.logger.log(T)})}refreshLiveTimeline(){return _(this,void 0,void 0,function*(){const T=this.getLiveTimeline(),S=T.getPaginationToken(u.EventTimeline.FORWARDS),U=T.getPaginationToken(u.EventTimeline.BACKWARDS),W=T.getEvents(),k=W[W.length-1];t.logger.log(`[refreshLiveTimeline for ${this.roomId}] at mostRecentEventInTimeline=${k&&k.getId()} liveTimelineBefore=${T.toString()} forwardPaginationToken=${S} backwardPaginationToken=${U}`);const D=this.getUnfilteredTimelineSet();let Q;k?(this.resetLiveTimeline(null,null),this.emit(L.TimelineRefresh,this,D),Q=yield this.client.getEventTimeline(D,k.getId())):Q=yield this.client.getLatestTimeline(D);const ee=D.getLiveTimeline();!ee||null===ee.getPaginationToken(u.Direction.Forward)&&null===ee.getPaginationToken(u.Direction.Backward)&&0===ee.getEvents().length?(t.logger.log(`[refreshLiveTimeline for ${this.roomId}] using our new live timeline`),Q.setPaginationToken(S,u.EventTimeline.FORWARDS),D.setLiveTimeline(Q),this.fixUpLegacyTimelineFields()):t.logger.log(`[refreshLiveTimeline for ${this.roomId}] \`/sync\` or some other request beat us to creating a new live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history.`),this.setTimelineNeedsRefresh(!1),this.emit(L.TimelineRefresh,this,D)})}resetLiveTimeline(T,S){for(const U of this.timelineSets)U.resetLiveTimeline(T??void 0,S??void 0);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){const T=this.oldState,S=this.currentState;this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(u.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(u.EventTimeline.FORWARDS),T!==this.oldState&&this.emit(L.OldStateUpdated,this,T,this.oldState),S!==this.currentState&&(this.emit(L.CurrentStateUpdated,this,S,this.currentState),this.reEmitter.stopReEmitting(S,[e.RoomStateEvent.Events,e.RoomStateEvent.Members,e.RoomStateEvent.NewMember,e.RoomStateEvent.Update,e.RoomStateEvent.Marker,p.BeaconEvent.New,p.BeaconEvent.Update,p.BeaconEvent.Destroy,p.BeaconEvent.LivenessChange]),this.reEmitter.reEmit(this.currentState,[e.RoomStateEvent.Events,e.RoomStateEvent.Members,e.RoomStateEvent.NewMember,e.RoomStateEvent.Update,e.RoomStateEvent.Marker,p.BeaconEvent.New,p.BeaconEvent.Update,p.BeaconEvent.Destroy,p.BeaconEvent.LivenessChange]))}hasUnverifiedDevices(){return _(this,void 0,void 0,function*(){if(!this.client.isRoomEncrypted(this.roomId))return!1;const T=yield this.getEncryptionTargetMembers();for(const S of T)if(this.client.getStoredDevicesForUser(S.userId).some(W=>W.isUnverified()))return!0;return!1})}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(T){const S=this.findEventById(T),U=this.findThreadForEvent(S);return U?U.timelineSet.getLiveTimeline():this.getUnfilteredTimelineSet().getTimelineForEvent(T)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(T){this.timelineNeedsRefresh=T}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(T){let S=this.getUnfilteredTimelineSet().findEventById(T);if(!S){const U=this.getThreads();for(let W=0;W<U.length;W++)if(S=U[W].findEventById(T),S)return S}return S}getUnreadNotificationCount(T=M.Total){var S;let U=this.getRoomUnreadNotificationCount(T);if(this.client.canSupport.get(B.Feature.ThreadUnreadNotifications)!==B.ServerSupport.Unsupported)for(const W of this.threadNotifications.values())U+=null!==(S=W[T])&&void 0!==S?S:0;return U}getUnreadCountForEventContext(T=M.Total,S){var U;return null!==(U=S.threadRootId&&!S.isThreadRoot?this.getThreadUnreadNotificationCount(S.threadRootId,T):this.getRoomUnreadNotificationCount(T))&&void 0!==U?U:0}getRoomUnreadNotificationCount(T=M.Total){var S;return null!==(S=this.notificationCounts[T])&&void 0!==S?S:0}getThreadUnreadNotificationCount(T,S=M.Total){var U,W;return null!==(W=null===(U=this.threadNotifications.get(T))||void 0===U?void 0:U[S])&&void 0!==W?W:0}hasThreadUnreadNotification(){var T,S;for(const U of this.threadNotifications.values())if((null!==(T=U.highlight)&&void 0!==T?T:0)>0||(null!==(S=U.total)&&void 0!==S?S:0)>0)return!0;return!1}setThreadUnreadNotificationCount(T,S,U){var W,k;const D=Object.assign({highlight:null===(W=this.threadNotifications.get(T))||void 0===W?void 0:W.highlight,total:null===(k=this.threadNotifications.get(T))||void 0===k?void 0:k.total},{[S]:U});this.threadNotifications.set(T,D),this.emit(L.UnreadNotifications,D,T)}get threadsAggregateNotificationType(){var T,S;let U=null;for(const W of this.threadNotifications.values()){if((null!==(T=W.highlight)&&void 0!==T?T:0)>0)return M.Highlight;(null!==(S=W.total)&&void 0!==S?S:0)>0&&!U&&(U=M.Total)}return U}resetThreadUnreadNotificationCount(T){if(T)for(const[S]of this.threadNotifications)T.includes(S)||this.threadNotifications.delete(S);else this.threadNotifications.clear();this.emit(L.UnreadNotifications)}setUnreadNotificationCount(T,S){this.notificationCounts[T]=S,this.emit(L.UnreadNotifications,this.notificationCounts)}setSummary(T){const S=T["m.heroes"],U=T["m.joined_member_count"],W=T["m.invited_member_count"];Number.isInteger(U)&&this.currentState.setJoinedMemberCount(U),Number.isInteger(W)&&this.currentState.setInvitedMemberCount(W),Array.isArray(S)&&(this.summaryHeroes=S.filter(k=>k!==this.myUserId))}setBlacklistUnverifiedDevices(T){this.blacklistUnverifiedDevices=T}getBlacklistUnverifiedDevices(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}getAvatarUrl(T,S,U,W,k=!0){const D=this.currentState.getStateEvents(o.EventType.RoomAvatar,"");if(!D&&!k)return null;const Q=D?D.getContent().url:null;return Q?(0,g.getHttpUriForMxc)(T,Q,S,U,W):null}getMxcAvatarUrl(){var T,S;return(null===(S=null===(T=this.currentState.getStateEvents(o.EventType.RoomAvatar,""))||void 0===T?void 0:T.getContent())||void 0===S?void 0:S.url)||null}getCanonicalAlias(){const T=this.currentState.getStateEvents(o.EventType.RoomCanonicalAlias,"");return T&&T.getContent().alias||null}getAltAliases(){const T=this.currentState.getStateEvents(o.EventType.RoomCanonicalAlias,"");return T&&T.getContent().alt_aliases||[]}addEventsToTimeline(T,S,U,W){U.getTimelineSet().addEventsToTimeline(T,S,U,W)}getThread(T){var S;return null!==(S=this.threads.get(T))&&void 0!==S?S:null}getThreads(){return Array.from(this.threads.values())}getMember(T){return this.currentState.getMember(T)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership("join")}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(T){return this.currentState.getMembers().filter(function(S){return S.membership===T})}getEncryptionTargetMembers(){return _(this,void 0,void 0,function*(){yield this.loadMembersIfNeeded();let T=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(T=T.concat(this.getMembersWithMembership("invite"))),T})}shouldEncryptForInvitedMembers(){var T;return"joined"!==(null===(T=this.currentState.getStateEvents(o.EventType.RoomHistoryVisibility,"")?.getContent())||void 0===T?void 0:T.history_visibility)}getDefaultRoomName(T){return this.calculateRoomName(T,!0)}hasMembershipState(T,S){const U=this.getMember(T);return!!U&&U.membership===S}getOrCreateFilteredTimelineSet(T,{prepopulateTimeline:S=!0,useSyncEvents:U=!0,pendingEvents:W=!0}={}){if(this.filteredTimelineSets[T.filterId])return this.filteredTimelineSets[T.filterId];const k=Object.assign({filter:T,pendingEvents:W},this.opts),D=new d.EventTimelineSet(this,k);this.reEmitter.reEmit(D,[L.Timeline,L.TimelineReset]),U&&(this.filteredTimelineSets[T.filterId]=D,this.timelineSets.push(D));const Q=this.getLiveTimeline();if(S){Q.getEvents().forEach(function(ae){D.addLiveEvent(ae)});let ee=Q;for(;ee.getNeighbouringTimeline(u.EventTimeline.BACKWARDS);)ee=ee.getNeighbouringTimeline(u.EventTimeline.BACKWARDS);D.getLiveTimeline().setPaginationToken(ee.getPaginationToken(u.EventTimeline.BACKWARDS),u.EventTimeline.BACKWARDS)}else if(U){const ee=Q.getPaginationToken(u.Direction.Forward);D.getLiveTimeline().setPaginationToken(ee,u.Direction.Backward)}return D}getThreadListFilter(T=b.ThreadFilterType.All){return _(this,void 0,void 0,function*(){const S=this.client.getUserId(),U=new l.Filter(S),W={room:{timeline:{[b.FILTER_RELATED_BY_REL_TYPES.name]:[b.THREAD_RELATION_TYPE.name]}}};T===b.ThreadFilterType.My&&(W.room.timeline[b.FILTER_RELATED_BY_SENDERS.name]=[S]),U.setDefinition(W);const k=yield this.client.getOrCreateFilter(`THREAD_PANEL_${this.roomId}_${T}`,U);return U.filterId=k,U})}createThreadTimelineSet(T){return _(this,void 0,void 0,function*(){let S;if(b.Thread.hasServerSideListSupport)S=new d.EventTimelineSet(this,Object.assign(Object.assign({},this.opts),{pendingEvents:!1}),void 0,void 0,T??b.ThreadFilterType.All),this.reEmitter.reEmit(S,[L.Timeline,L.TimelineReset]);else if(b.Thread.hasServerSideSupport){const U=yield this.getThreadListFilter(T);S=this.getOrCreateFilteredTimelineSet(U,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else S=new d.EventTimelineSet(this,{pendingEvents:!1}),Array.from(this.threads).forEach(([,U])=>{if(0===U.length)return;const W=U.timeline.some(k=>k.getSender()===this.client.getUserId());(T!==b.ThreadFilterType.My||W)&&S.getLiveTimeline().addEvent(U.rootEvent,{toStartOfTimeline:!1})});return S})}processThreadRoots(T,S){for(const U of T)u.EventTimeline.setEventMetadata(U,this.currentState,S),this.getThread(U.getId())||this.createThread(U.getId(),U,[],S)}fetchRoomThreads(){var T,S;return _(this,void 0,void 0,function*(){if(!this.threadsReady&&this.client.supportsExperimentalThreads()){if(b.Thread.hasServerSideListSupport)yield Promise.all([this.fetchRoomThreadList(b.ThreadFilterType.All),this.fetchRoomThreadList(b.ThreadFilterType.My)]);else{const U=yield this.getThreadListFilter(),{chunk:W}=yield this.client.createMessagesRequest(this.roomId,"",Number.MAX_SAFE_INTEGER,u.Direction.Backward,U);if(!W.length)return;const k=W.map(this.client.getEventMapper()).sort((ee,ae)=>{const ue=ee.getServerAggregatedRelation(b.THREAD_RELATION_TYPE.name),be=ae.getServerAggregatedRelation(b.THREAD_RELATION_TYPE.name);return ue.latest_event.origin_server_ts-be.latest_event.origin_server_ts});let D;const Q=this.getLiveTimeline().getState(u.EventTimeline.FORWARDS);for(const ee of k){const ae={duplicateStrategy:d.DuplicateStrategy.Ignore,fromCache:!1,roomState:Q};null===(T=this.threadsTimelineSets[0])||void 0===T||T.addLiveEvent(ee,ae),ee.getServerAggregatedRelation(b.THREAD_RELATION_TYPE.name)?.current_user_participated&&(null===(S=this.threadsTimelineSets[1])||void 0===S||S.addLiveEvent(ee,ae),D=ee)}this.processThreadRoots(k,!0),this.client.decryptEventIfNeeded(k[k.length-1]),D&&this.client.decryptEventIfNeeded(D)}this.on(b.ThreadEvent.NewReply,this.onThreadNewReply),this.on(b.ThreadEvent.Delete,this.onThreadDelete),this.threadsReady=!0}})}fetchRoomThreadList(T){return _(this,void 0,void 0,function*(){const S=T===b.ThreadFilterType.My?this.threadsTimelineSets[1]:this.threadsTimelineSets[0],{chunk:U,end:W}=yield this.client.createThreadListMessagesRequest(this.roomId,null,void 0,u.Direction.Backward,S.threadListType,S.getFilter());if(S.getLiveTimeline().setPaginationToken(W??null,u.Direction.Backward),!U.length)return;const k=U.map(this.client.getEventMapper());this.processThreadRoots(k,!0);const D=this.getLiveTimeline().getState(u.EventTimeline.FORWARDS);for(const Q of k)S.addLiveEvent(Q,{duplicateStrategy:d.DuplicateStrategy.Replace,fromCache:!1,roomState:D})})}onThreadNewReply(T){this.updateThreadRootEvents(T,!1,!0)}onThreadDelete(T){var S;this.threads.delete(T.id);const W=null===(S=this.getTimelineForEvent(T.id)?.getEvents())||void 0===S?void 0:S.find(k=>k.getId()===T.id);W?T.clearEventMetadata(W):t.logger.debug("onThreadDelete: Could not find root event in room timeline");for(const k of this.threadsTimelineSets)k.removeEvent(T.id)}removeFilteredTimelineSet(T){const S=this.filteredTimelineSets[T.filterId];delete this.filteredTimelineSets[T.filterId];const U=this.timelineSets.indexOf(S);U>-1&&this.timelineSets.splice(U,1)}eventShouldLiveIn(T,S,U){var W,k;if(null===(W=this.client)||void 0===W||!W.supportsExperimentalThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(T.isThreadRoot||U?.has(T.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:T.getId()};if(T.isRelation(b.THREAD_RELATION_TYPE.name))return{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:T.threadRootId};const D=T.getAssociatedId(),Q=null!==(k=this.findEventById(D))&&void 0!==k?k:S?.find(ee=>ee.getId()===D);return Q&&(T.isRelation()||T.isRedaction())?this.eventShouldLiveIn(Q,S,U):U?.has(T.relationEventId)?{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:T.relationEventId}:{shouldLiveInRoom:!0,shouldLiveInThread:!1}}findThreadForEvent(T){if(!T)return null;const{threadId:S}=this.eventShouldLiveIn(T);return S?this.getThread(S):null}addThreadedEvents(T,S,U=!1){var W;let k=this.getThread(T);if(!k){const D=null!==(W=this.findEventById(T))&&void 0!==W?W:S.find(Q=>Q.getId()===T);k=this.createThread(T,D,S,U)}k.addEvents(S,U)}processThreadedEvents(T,S){var U;T.forEach(this.applyRedaction);const W={};for(const k of T){const{threadId:D,shouldLiveInThread:Q}=this.eventShouldLiveIn(k);Q&&!W[D]&&(W[D]=[]),null===(U=W[D])||void 0===U||U.push(k)}Object.entries(W).map(([k,D])=>this.addThreadedEvents(k,D,S))}createThread(T,S,U=[],W){var k,D,Q;if(this.threads.has(T))return this.threads.get(T);if(S){const ue=this.relations.getAllChildEventsForEvent(S.getId());ue?.length&&(U=U.concat(ue.filter(be=>!be.isRelation(o.RelationType.Replace))))}const ee=new b.Thread(T,S,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(k=this.cachedThreadReadReceipts.get(T))&&void 0!==k?k:[]});this.cachedThreadReadReceipts.delete(T),ee.addEvents(U,!1),this.threads.set(ee.id,ee),this.reEmitter.reEmit(ee,[b.ThreadEvent.Delete,b.ThreadEvent.Update,b.ThreadEvent.NewReply,L.Timeline,L.TimelineReset]);const ae=(null===(D=this.lastThread)||void 0===D?void 0:D.rootEvent)&&S?.localTimestamp&&(null===(Q=this.lastThread.rootEvent)||void 0===Q?void 0:Q.localTimestamp)<S?.localTimestamp;return(!this.lastThread||ae)&&(this.lastThread=ee),this.threadsReady&&this.updateThreadRootEvents(ee,W,!1),this.emit(b.ThreadEvent.New,ee,W),ee}processLiveEvent(T){if(this.applyRedaction(T),T.isVisibilityEvent()&&this.applyNewVisibilityEvent(T),this.applyPendingVisibilityEvents(T),!T.getUnsigned().transaction_id&&T.getSender()===this.myUserId)for(const U in this.txnToEvent)if(this.txnToEvent[U].getId()===T.getId()){t.logger.debug("processLiveEvent: found sent event without txn ID: ",U,T.getId());const k=T.getUnsigned();k.transaction_id=U,T.setUnsigned(k);break}}addLiveEvent(T,S){const{duplicateStrategy:U,timelineWasEmpty:W,fromCache:k}=S;for(const D of this.timelineSets)D.addLiveEvent(T,{duplicateStrategy:U,fromCache:k,timelineWasEmpty:W});T.sender&&T.getType()!==o.EventType.RoomRedaction&&this.addReceipt((0,x.synthesizeReceipt)(T.sender.userId,T,y.ReceiptType.Read),!0)}addPendingEvent(T,S){if(T.status!==i.EventStatus.SENDING&&T.status!==i.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+T.status);if(this.txnToEvent[S])throw new Error("addPendingEvent called on an event with known txnId "+S);if(u.EventTimeline.setEventMetadata(T,this.getLiveTimeline().getState(u.EventTimeline.FORWARDS),!1),this.txnToEvent[S]=T,this.pendingEventList){if(this.pendingEventList.some(U=>U.status===i.EventStatus.NOT_SENT)&&(t.logger.warn("Setting event as NOT_SENT due to messages in the same state"),T.setStatus(i.EventStatus.NOT_SENT)),this.pendingEventList.push(T),this.savePendingEvents(),T.isRelation()&&this.aggregateNonLiveRelation(T),T.isRedaction()){const U=T.event.redacts;let W=this.pendingEventList.find(k=>k.getId()===U);!W&&U&&(W=this.findEventById(U)),W&&(W.markLocallyRedacted(T),this.emit(L.Redaction,T,this))}}else for(const U of this.timelineSets)U.getFilter()?U.getFilter().filterRoomTimeline([T]).length&&U.addEventToTimeline(T,U.getLiveTimeline(),{toStartOfTimeline:!1}):U.addEventToTimeline(T,U.getLiveTimeline(),{toStartOfTimeline:!1});this.emit(L.LocalEchoUpdated,T,this)}savePendingEvents(){if(this.pendingEventList){const T=this.pendingEventList.map(S=>Object.assign(Object.assign({},S.event),{txn_id:S.getTxnId()})).filter(S=>{const U=S.type===o.EventType.RoomMessageEncrypted,W=this.client.isRoomEncrypted(this.roomId);return U||!W});this.client.store.setPendingEvents(this.roomId,T)}}aggregateNonLiveRelation(T){this.relations.aggregateChildEvent(T)}getEventForTxnId(T){return this.txnToEvent[T]}handleRemoteEcho(T,S){const U=S.getId(),W=T.getId(),k=S.status;t.logger.debug(`Got remote echo for event ${U} -> ${W} old status ${k}`),delete this.txnToEvent[T.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(U),S.handleRemoteEcho(T.event);const{shouldLiveInRoom:D,threadId:Q}=this.eventShouldLiveIn(T);if((Q?this.getThread(Q):null)?.timelineSet.handleRemoteEcho(S,U,W),D)for(const ae of this.timelineSets)ae.handleRemoteEcho(S,U,W);this.emit(L.LocalEchoUpdated,S,this,U,k)}updatePendingEvent(T,S,U){if(t.logger.log(`setting pendingEvent status to ${S} in ${T.getRoomId()} event ID ${T.getId()} -> ${U}`),S==i.EventStatus.SENT&&!U)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(S==i.EventStatus.SENT&&this.getTimelineForEvent(U)){const ee=this.findEventById(U);if(!ee?.getUnsigned().transaction_id&&ee){const ue=ee.getUnsigned();ue.transaction_id=T.getTxnId(),ee.setUnsigned(ue),this.removeEvent(ee.getId()),this.handleRemoteEcho(ee,T)}return}const W=T.status,k=T.getId();if(!W)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");if(!C[W]?.includes(S))throw new Error(`Invalid EventStatus transition ${W}->${S}`);if(T.setStatus(S),S==i.EventStatus.SENT){T.replaceLocalEventId(U);const{shouldLiveInRoom:Q,threadId:ee}=this.eventShouldLiveIn(T);if((ee?this.getThread(ee):void 0)?.timelineSet.replaceEventId(k,U),Q)for(const ue of this.timelineSets)ue.replaceEventId(k,U)}else if(S==i.EventStatus.CANCELLED){if(this.pendingEventList){const Q=this.getPendingEvent(k);this.removePendingEvent(k),Q?.isRedaction()&&this.revertRedactionLocalEcho(Q)}this.removeEvent(k)}this.savePendingEvents(),this.emit(L.LocalEchoUpdated,T,this,k,W)}revertRedactionLocalEcho(T){const S=T.event.redacts;if(!S)return;const U=this.getUnfilteredTimelineSet().findEventById(S);U&&(U.unmarkLocallyRedacted(),this.emit(L.RedactionCancelled,T,this),U.isRelation()&&this.aggregateNonLiveRelation(U))}addLiveEvents(T,S,U=!1){var W;let k=S,D=!1;if("object"==typeof S?({duplicateStrategy:k,fromCache:U=!1,timelineWasEmpty:D}=S):void 0!==S&&t.logger.warn("Overload deprecated: `Room.addLiveEvents(events, duplicateStrategy?, fromCache?)` is deprecated in favor of the overload with `Room.addLiveEvents(events, IAddLiveEventOptions)`"),k&&-1===["replace","ignore"].indexOf(k))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(let ue=0;ue<this.timelineSets.length;ue++){const be=this.timelineSets[ue].getLiveTimeline();if(be.getPaginationToken(u.EventTimeline.FORWARDS))throw new Error("live timeline "+ue+" is no longer live - it has a pagination token ("+be.getPaginationToken(u.EventTimeline.FORWARDS)+")");if(be.getNeighbouringTimeline(u.EventTimeline.FORWARDS))throw new Error(`live timeline ${ue} is no longer live - it has a neighbouring timeline`)}const Q=this.findThreadRoots(T),ee={},ae={duplicateStrategy:k,fromCache:U,timelineWasEmpty:D};for(const ue of T){if(this.processLiveEvent(ue),ue.getUnsigned().transaction_id){const ne=this.txnToEvent[ue.getUnsigned().transaction_id];if(ne){this.handleRemoteEcho(ue,ne);continue}}const{shouldLiveInRoom:be,shouldLiveInThread:X,threadId:H}=this.eventShouldLiveIn(ue,T,Q);X&&!ee[H??""]&&(ee[H??""]=[]),null===(W=ee[H??""])||void 0===W||W.push(ue),be&&this.addLiveEvent(ue,ae)}Object.entries(ee).forEach(([ue,be])=>{this.addThreadedEvents(ue,be,!1)})}partitionThreadedEvents(T){if(this.client.supportsExperimentalThreads()){const W=this.findThreadRoots(T);return T.reduce((k,D)=>{const{shouldLiveInRoom:Q,shouldLiveInThread:ee,threadId:ae}=this.eventShouldLiveIn(D,T,W);return Q&&k[0].push(D),ee&&(D.setThreadId(ae??""),k[1].push(D)),k},[[],[]])}return[T,[]]}findThreadRoots(T){var S;const U=new Set;for(const W of T)W.isRelation(b.THREAD_RELATION_TYPE.name)&&U.add(null!==(S=W.relationEventId)&&void 0!==S?S:"");return U}addReceipt(T,S=!1){const U=T.getContent();Object.keys(U).forEach(W=>{Object.keys(U[W]).forEach(k=>{Object.keys(U[W][k]).forEach(D=>{var Q,ee;const ae=U[W][k][D],be=ae.thread_id&&ae.thread_id!==y.MAIN_ROOM_TIMELINE?this.threads.get(null!==(Q=ae.thread_id)&&void 0!==Q?Q:""):this;be?be.addReceiptToStructure(W,k,D,ae,S):this.cachedThreadReadReceipts.set(ae.thread_id,[...null!==(ee=this.cachedThreadReadReceipts.get(ae.thread_id))&&void 0!==ee?ee:[],{event:T,synthetic:S}])})})}),this.emit(L.Receipt,T,this)}addEphemeralEvents(T){for(const S of T)S.getType()===o.EventType.Typing?this.currentState.setTypingEvent(S):S.getType()===o.EventType.Receipt&&this.addReceipt(S)}removeEvents(T){for(const S of T)this.removeEvent(S)}removeEvent(T){let S=!1;for(const U of this.timelineSets){const W=U.removeEvent(T);W&&(W.isRedaction()&&this.revertRedactionLocalEcho(W),S=!0)}return S}recalculate(){const T=this.currentState.getStateEvents(o.EventType.RoomMember,this.myUserId);if(T){const U=T.getContent().membership;this.updateMyMembership(U),"invite"===U&&(T.getUnsigned().invite_room_state||[]).forEach(k=>{this.currentState.getStateEvents(k.type,k.state_key)||this.currentState.setStateEvents([new c.MatrixEvent({type:k.type,state_key:k.state_key,content:k.content,event_id:"$fake"+Date.now(),room_id:this.roomId,user_id:this.myUserId})])})}const S=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,v.normalize)(this.name),this.summary=new s.RoomSummary(this.roomId,{title:this.name}),S!==this.name&&this.emit(L.Name,this)}addTags(T){this.tags=T.getContent().tags||{},this.emit(L.Tags,T,this)}addAccountData(T){for(const S of T){"m.tag"===S.getType()&&this.addTags(S);const U=this.accountData[S.getType()];this.accountData[S.getType()]=S,this.emit(L.AccountData,S,this,U)}}getAccountData(T){return this.accountData[T]}maySendMessage(){return"join"===this.getMyMembership()&&(this.client.isRoomEncrypted(this.roomId)?this.currentState.maySendEvent(o.EventType.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(o.EventType.RoomMessage,this.myUserId))}canInvite(T){let S="join"===this.getMyMembership();const U=this.currentState.getStateEvents(o.EventType.RoomPowerLevels,""),W=U&&U.getContent(),k=this.getMember(T);return W&&k&&W.invite>k.powerLevel&&(S=!1),S}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const T=this.currentState.getStateEvents(o.EventType.RoomCreate,"");if(T)return T.getContent()[o.RoomCreateTypeField];this.getTypeWarning||(t.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===o.RoomType.Space}isCallRoom(){return this.getType()===o.RoomType.UnstableCall}isElementVideoRoom(){return this.getType()===o.RoomType.ElementVideo}roomNameGenerator(T){if(this.client.roomNameGenerator){const S=this.client.roomNameGenerator(this.roomId,T);if(null!==S)return S}switch(T.type){case F.Actual:return T.name;case F.Generated:return"Inviting"===T.subtype?`Inviting ${V(T.names,T.count)}`:V(T.names,T.count);case F.EmptyRoom:return T.oldName?`Empty room (was ${T.oldName})`:"Empty room"}}calculateRoomName(T,S=!1){if(!S){const H=this.currentState.getStateEvents(o.EventType.RoomName,"");if(H?.getContent().name)return this.roomNameGenerator({type:F.Actual,name:H.getContent().name})}const U=this.getCanonicalAlias();if(U)return this.roomNameGenerator({type:F.Actual,name:U});let D=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,Q=[];const ee=this.currentState.getStateEvents(o.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(ee?.getContent().service_members)&&(Q=ee.getContent().service_members);let ae=[];if(this.summaryHeroes)this.summaryHeroes.forEach(H=>{if(Q.includes(H))return void D--;const ne=this.getMember(H);ae.push(ne?ne.name:H)});else{let H=this.currentState.getMembers().filter(ne=>ne.userId!==T&&("invite"===ne.membership||"join"===ne.membership));H=H.filter(({userId:ne})=>!Q.includes(ne)||(D--,!1)),H.sort((ne,ce)=>f.compare(ne.userId,ce.userId)),H=H.slice(0,5),ae=H.map(ne=>ne.name)}if(D)return this.roomNameGenerator({type:F.Generated,names:ae,count:D});if("join"==this.getMyMembership()){const H=this.currentState.getStateEvents(o.EventType.RoomThirdPartyInvite);if(H?.length){const ne=H.map(ce=>ce.getContent().display_name);return this.roomNameGenerator({type:F.Generated,subtype:"Inviting",names:ne,count:ne.length+1})}}let X,be=ae;return be.length||(be=this.currentState.getMembers().filter(H=>H.userId!==T&&"invite"!==H.membership&&"join"!==H.membership).map(H=>H.name)),be.length&&(X=this.roomNameGenerator({type:F.Generated,names:be,count:be.length+1})),this.roomNameGenerator({type:F.EmptyRoom,oldName:X})}applyNewVisibilityEvent(T){const S=T.asVisibilityChange();if(!S)return;const U=T.getSender();if(!U||!(o.EVENT_VISIBILITY_CHANGE_TYPE.name&&this.currentState.maySendStateEvent(o.EVENT_VISIBILITY_CHANGE_TYPE.name,U)||o.EVENT_VISIBILITY_CHANGE_TYPE.altName&&this.currentState.maySendStateEvent(o.EVENT_VISIBILITY_CHANGE_TYPE.altName,U)))return;const k=this.visibilityEvents.get(S.eventId);if(k){let Q=k.length-1;const ee=Math.max(0,k.length-30);for(;Q>=ee&&!(k[Q].getTs()<T.getTs());--Q);-1===Q?k.unshift(T):k.splice(Q+1,0,T)}else this.visibilityEvents.set(S.eventId,[T]);const D=this.findEventById(S.eventId);D&&D.applyVisibilityEvent(S)}redactVisibilityChangeEvent(T){if(!T.isVisibilityEvent)throw new Error("expected a visibility change event");const U=T.getRelation()?.event_id,W=this.visibilityEvents.get(U);if(!W)return;const k=W.findIndex(D=>D.getId()===T.getId());if(-1!==k&&(W.splice(k,1),k===W.length)){const D=this.findEventById(U);if(!D)return;if(0===k)this.visibilityEvents.delete(U),D.applyVisibilityEvent();else{const ee=W[W.length-1].asVisibilityChange();if(!ee)throw new Error("at this stage, visibility changes should be well-formed");D.applyVisibilityEvent(ee)}}}applyPendingVisibilityEvents(T){const S=this.visibilityEvents.get(T.getId());if(!S||0==S.length)return;const U=S[S.length-1],W=U.asVisibilityChange();W&&!(U.getTs()<T.getTs())&&T.applyVisibilityEvent(W)}};const C={[i.EventStatus.ENCRYPTING]:[i.EventStatus.SENDING,i.EventStatus.NOT_SENT,i.EventStatus.CANCELLED],[i.EventStatus.SENDING]:[i.EventStatus.ENCRYPTING,i.EventStatus.QUEUED,i.EventStatus.NOT_SENT,i.EventStatus.SENT],[i.EventStatus.QUEUED]:[i.EventStatus.SENDING,i.EventStatus.CANCELLED],[i.EventStatus.SENT]:[],[i.EventStatus.NOT_SENT]:[i.EventStatus.SENDING,i.EventStatus.QUEUED,i.EventStatus.CANCELLED],[i.EventStatus.CANCELLED]:[]};var F;function V(N,T){const S=T-1;return N.length?1===N.length&&S<=1?N[0]:2===N.length&&S<=2?`${N[0]} and ${N[1]}`:S>1?`${N[0]} and ${S} others`:`${N[0]} and 1 other`:"Empty room"}!function(N){N[N.EmptyRoom=0]="EmptyRoom",N[N.Generated=1]="Generated",N[N.Actual=2]="Actual"}(F=a.RoomNameType||(a.RoomNameType={}))},{"../@types/event":299,"../@types/read_receipts":303,"../ReEmitter":309,"../client":313,"../content-repo":315,"../feature":353,"../filter":355,"../logger":365,"../utils":402,"./beacon":369,"./event":374,"./event-status":371,"./event-timeline":373,"./event-timeline-set":372,"./read-receipt":376,"./relations-container":377,"./room-member":379,"./room-state":380,"./room-summary":381,"./thread":384}],383:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SearchResult=void 0;const R=m("./event-context");class I{static fromJson(_,d){const u=_.context||{};let g=(u.events_before||[]).map(d),f=(u.events_after||[]).map(d);const v=new R.EventContext(d(_.result)),c=v.ourEvent.threadRootId;return g=g.filter(i=>i.threadRootId===c),f=f.filter(i=>i.threadRootId===c),v.setPaginateToken(u.start,!0),v.addEvents(g,!0),v.addEvents(f,!1),v.setPaginateToken(u.end,!1),new I(_.rank,v)}constructor(_,d){this.rank=_,this.context=d}}a.SearchResult=I},{"./event-context":370}],384:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(e,p,b,y){return new(b||(b=Promise))(function(x,B){function J(L){try{M(y.next(L))}catch(j){B(j)}}function z(L){try{M(y.throw(L))}catch(j){B(j)}}function M(L){L.done?x(L.value):function w(x){return x instanceof b?x:new b(function(B){B(x)})}(L.value).then(J,z)}M((y=y.apply(e,p||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.threadFilterTypeToFilter=a.ThreadFilterType=a.THREAD_RELATION_TYPE=a.FILTER_RELATED_BY_REL_TYPES=a.FILTER_RELATED_BY_SENDERS=a.Thread=a.determineFeatureSupport=a.FeatureSupport=a.ThreadEvent=void 0;const I=m("../client"),E=m("../ReEmitter"),_=m("../@types/event"),d=m("./event"),u=m("./event-timeline"),g=m("./event-timeline-set"),f=m("./room"),v=m("../NamespacedValue"),c=m("../logger"),i=m("./read-receipt"),r=m("../@types/read_receipts");var s,e,t,h;(e=s=a.ThreadEvent||(a.ThreadEvent={})).New="Thread.new",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thread.viewThread",e.Delete="Thread.delete",function(e){e[e.None=0]="None",e[e.Experimental=1]="Experimental",e[e.Stable=2]="Stable"}(t=a.FeatureSupport||(a.FeatureSupport={})),a.determineFeatureSupport=function n(e,p){return e?t.Stable:p?t.Experimental:t.None};class o extends i.ReadReceipt{constructor(p,b,y){var w;if(super(),this.id=p,this.rootEvent=b,this.timeline=[],this._currentUserParticipated=!1,this.replyCount=0,this.pendingReplyCount=0,this.initialEventsFetched=!o.hasServerSideSupport,this.onBeforeRedaction=(x,B)=>{x?.isRelation(a.THREAD_RELATION_TYPE.name)&&this.room.eventShouldLiveIn(x).threadId===this.id&&x.getId()!==this.id&&!B.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(s.Update,this))},this.onRedaction=x=>R(this,void 0,void 0,function*(){if(x.threadRootId===this.id)if(this.replyCount<=0){for(const B of this.timeline)this.clearEventMetadata(B);this.lastEvent=this.rootEvent,this._currentUserParticipated=!1,this.emit(s.Delete,this)}else yield this.updateThreadMetadata()}),this.onTimelineEvent=(x,B,J)=>{J||B.addLocalEchoReceipt(x.getSender(),x,r.ReceiptType.Read),this.onEcho(x,J??!1)},this.onLocalEcho=x=>{this.onEcho(x,!1)},this.onEcho=(x,B)=>R(this,void 0,void 0,function*(){x.threadRootId===this.id&&this.lastEvent!==x&&(yield this.updateThreadMetadata(),x.isRelation(a.THREAD_RELATION_TYPE.name)&&(B||this.emit(s.NewReply,this,x)))}),!y?.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=y.room,this.client=y.client,this.pendingEventOrdering=null!==(w=y.pendingEventOrdering)&&void 0!==w?w:I.PendingEventOrdering.Chronological,this.timelineSet=new g.EventTimelineSet(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new E.TypedReEmitter(this),this.reEmitter.reEmit(this.timelineSet,[f.RoomEvent.Timeline,f.RoomEvent.TimelineReset]),this.room.on(d.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.room.on(f.RoomEvent.Redaction,this.onRedaction),this.room.on(f.RoomEvent.LocalEchoUpdated,this.onLocalEcho),this.timelineSet.on(f.RoomEvent.Timeline,this.onTimelineEvent),this.processReceipts(y.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){return R(this,void 0,void 0,function*(){this.rootEvent=this.room.findEventById(this.id);try{const p=yield this.client.fetchRoomEvent(this.roomId,this.id),b=this.client.getEventMapper();this.rootEvent=b(p)}catch(p){c.logger.error("Failed to fetch thread root to construct thread with",p)}yield this.processEvent(this.rootEvent)})}static setServerSideSupport(p){o.hasServerSideSupport=p,p!==t.Stable&&(a.FILTER_RELATED_BY_SENDERS.setPreferUnstable(!0),a.FILTER_RELATED_BY_REL_TYPES.setPreferUnstable(!0),a.THREAD_RELATION_TYPE.setPreferUnstable(!0))}static setServerSideListSupport(p){o.hasServerSideListSupport=p}static setServerSideFwdPaginationSupport(p){o.hasServerSideFwdPaginationSupport=p}get roomState(){return this.room.getLiveTimeline().getState(u.EventTimeline.FORWARDS)}addEventToTimeline(p,b){this.findEventById(p.getId())||(this.timelineSet.addEventToTimeline(p,this.liveTimeline,{toStartOfTimeline:b,fromCache:!1,roomState:this.roomState}),this.timeline=this.events)}addEvents(p,b){p.forEach(y=>this.addEvent(y,b,!1)),this.updateThreadMetadata()}addEvent(p,b,y=!0){var w,x;return R(this,void 0,void 0,function*(){this.setEventMetadata(p);const B=this.lastReply();if(o.hasServerSideSupport){if(!b&&this.initialEventsFetched&&(!B||p.localTimestamp>B.localTimestamp))this.addEventToTimeline(p,!1),this.fetchEditsWhereNeeded(p);else if(p.isRelation(_.RelationType.Annotation)||p.isRelation(_.RelationType.Replace))return null===(w=this.timelineSet.relations)||void 0===w||w.aggregateParentEvent(p),void(null===(x=this.timelineSet.relations)||void 0===x||x.aggregateChildEvent(p,this.timelineSet))}else this.addEventToTimeline(p,b),this.client.decryptEventIfNeeded(p,{});(!o.hasServerSideSupport||!this.rootEvent)&&p.isRelation(a.THREAD_RELATION_TYPE.name)&&this.replyCount++,y&&(this.emit(s.NewReply,this,p),this.updateThreadMetadata())})}processEvent(p){return R(this,void 0,void 0,function*(){p&&(this.setEventMetadata(p),yield this.fetchEditsWhereNeeded(p)),this.timeline=this.events})}processReceipts(p=[]){for(const{event:b,synthetic:y}of p){const w=b.getContent();Object.keys(w).forEach(x=>{Object.keys(w[x]).forEach(B=>{Object.keys(w[x][B]).forEach(J=>{this.addReceiptToStructure(x,B,J,w[x][B][J],y)})})})}}getRootEventBundledRelationship(p=this.rootEvent){return p?.getServerAggregatedRelation(a.THREAD_RELATION_TYPE.name)}processRootEvent(){return R(this,void 0,void 0,function*(){const p=this.getRootEventBundledRelationship();if(o.hasServerSideSupport&&p){this.replyCount=p.count,this._currentUserParticipated=!!p.current_user_participated;const b=this.client.getEventMapper();this.lastEvent=b(Object.assign(Object.assign({},p.latest_event),{room_id:this.roomId})),this.updatePendingReplyCount(),yield this.processEvent(this.lastEvent)}})}updatePendingReplyCount(){const b=(this.pendingEventOrdering===I.PendingEventOrdering.Detached?this.room.getPendingEvents():this.events).filter(y=>{var w;return y.threadRootId===this.id&&y.isRelation(a.THREAD_RELATION_TYPE.name)&&null!==y.status&&y.getId()!==(null===(w=this.lastEvent)||void 0===w?void 0:w.getId())});this.lastPendingEvent=b.length?b[b.length-1]:void 0,this.pendingReplyCount=b.length}updateThreadMetadata(){return R(this,void 0,void 0,function*(){if(this.updatePendingReplyCount(),o.hasServerSideSupport&&(this.initialEventsFetched||(yield this.processRootEvent()),yield this.fetchRootEvent()),yield this.processRootEvent(),!this.initialEventsFetched){this.initialEventsFetched=!0;try{0===this.replyCount&&this.rootEvent?(this.timelineSet.addEventsToTimeline([this.rootEvent],!0,this.liveTimeline,null),this.liveTimeline.setPaginationToken(null,u.Direction.Backward)):yield this.client.paginateEventTimeline(this.liveTimeline,{backwards:!0,limit:Math.max(1,this.length)}),this.emit(f.RoomEvent.TimelineReset,this.room,this.timelineSet,!0)}catch(p){c.logger.error("Failed to load start of newly created thread: ",p),this.initialEventsFetched=!1}}this.emit(s.Update,this)})}fetchEditsWhereNeeded(...p){return R(this,void 0,void 0,function*(){return Promise.all(p.filter(b=>b.isEncrypted()).map(b=>{if(!b.isRelation())return this.client.relations(this.roomId,b.getId(),_.RelationType.Replace,b.getType(),{limit:1}).then(y=>{y.events.length&&b.makeReplaced(y.events[0])}).catch(y=>{c.logger.error("Failed to load edits for encrypted thread event",y)})}))})}setEventMetadata(p){p&&(u.EventTimeline.setEventMetadata(p,this.roomState,!1),p.setThread(this))}clearEventMetadata(p){var b,y,w;p&&(p.setThread(void 0),null===(w=null===(y=null===(b=p.event)||void 0===b?void 0:b.unsigned)||void 0===y?void 0:y["m.relations"])||void 0===w||delete w[a.THREAD_RELATION_TYPE.name])}findEventById(p){return this.timelineSet.findEventById(p)}lastReply(p=(()=>!0)){for(let b=this.timeline.length-1;b>=0;b--){const y=this.timeline[b];if(p(y))return y}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var p,b;return null!==(b=null!==(p=this.lastPendingEvent)&&void 0!==p?p:this.lastEvent)&&void 0!==b?b:this.lastReply()}get events(){return this.liveTimeline.getEvents()}has(p){return this.timelineSet.findEventById(p)instanceof d.MatrixEvent}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(p,b){throw new Error("Unsupported function on the thread model")}hasUserReadEvent(p,b){if(p===this.client.getUserId()){const y=this.getReadReceiptForUserId(p,!1,r.ReceiptType.Read),w=this.getReadReceiptForUserId(p,!1,r.ReceiptType.ReadPrivate),x=this.room.getThreadUnreadNotificationCount(this.id,f.NotificationCountType.Total)>0;if(!y&&!w&&!x)return!0}return super.hasUserReadEvent(p,b)}}a.Thread=o,o.hasServerSideSupport=t.None,o.hasServerSideListSupport=t.None,o.hasServerSideFwdPaginationSupport=t.None,a.FILTER_RELATED_BY_SENDERS=new v.ServerControlledNamespacedValue("related_by_senders","io.element.relation_senders"),a.FILTER_RELATED_BY_REL_TYPES=new v.ServerControlledNamespacedValue("related_by_rel_types","io.element.relation_types"),a.THREAD_RELATION_TYPE=new v.ServerControlledNamespacedValue("m.thread","io.element.thread"),function(e){e[e.My=0]="My",e[e.All=1]="All"}(h=a.ThreadFilterType||(a.ThreadFilterType={})),a.threadFilterTypeToFilter=function l(e){return e===h.My?"participated":"all"}},{"../@types/event":299,"../@types/read_receipts":303,"../NamespacedValue":308,"../ReEmitter":309,"../client":313,"../logger":365,"./event":374,"./event-timeline":373,"./event-timeline-set":372,"./read-receipt":376,"./room":382}],385:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.TypedEventEmitter=a.EventEmitterEvents=void 0;const R=m("events");var _;(_=a.EventEmitterEvents||(a.EventEmitterEvents={})).NewListener="newListener",_.RemoveListener="removeListener",_.Error="error",a.TypedEventEmitter=class E extends R.EventEmitter{addListener(d,u){return super.addListener(d,u)}emit(d,...u){return super.emit(d,...u)}eventNames(){return super.eventNames()}listenerCount(d){return super.listenerCount(d)}listeners(d){return super.listeners(d)}off(d,u){return super.off(d,u)}on(d,u){return super.on(d,u)}once(d,u){return super.once(d,u)}prependListener(d,u){return super.prependListener(d,u)}prependOnceListener(d,u){return super.prependOnceListener(d,u)}removeAllListeners(d){return super.removeAllListeners(d)}removeListener(d,u){return super.removeListener(d,u)}rawListeners(d){return super.rawListeners(d)}}},{events:105}],386:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.User=a.UserEvent=void 0;const R=m("./typed-event-emitter");var I,_;(_=I=a.UserEvent||(a.UserEvent={})).DisplayName="User.displayName",_.AvatarUrl="User.avatarUrl",_.Presence="User.presence",_.CurrentlyActive="User.currentlyActive",_.LastPresenceTs="User.lastPresenceTs",a.User=class E extends R.TypedEventEmitter{constructor(d){super(),this.userId=d,this.modified=-1,this.presence="offline",this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={},this.displayName=d,this.rawDisplayName=d,this.updateModifiedTime()}setPresenceEvent(d){if("m.presence"!==d.getType())return;const u=null===this.events.presence;this.events.presence=d;const g=[];(d.getContent().presence!==this.presence||u)&&g.push(I.Presence),d.getContent().avatar_url&&d.getContent().avatar_url!==this.avatarUrl&&g.push(I.AvatarUrl),d.getContent().displayname&&d.getContent().displayname!==this.displayName&&g.push(I.DisplayName),void 0!==d.getContent().currently_active&&d.getContent().currently_active!==this.currentlyActive&&g.push(I.CurrentlyActive),this.presence=d.getContent().presence,g.push(I.LastPresenceTs),d.getContent().status_msg&&(this.presenceStatusMsg=d.getContent().status_msg),d.getContent().displayname&&(this.displayName=d.getContent().displayname),d.getContent().avatar_url&&(this.avatarUrl=d.getContent().avatar_url),this.lastActiveAgo=d.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=d.getContent().currently_active,this.updateModifiedTime();for(const f of g)this.emit(f,d,this)}setDisplayName(d){const u=this.displayName;this.displayName=d,d!==u&&this.updateModifiedTime()}setRawDisplayName(d){this.rawDisplayName=d}setAvatarUrl(d){const u=this.avatarUrl;this.avatarUrl=d,d!==u&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}},{"./typed-event-emitter":385}],387:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PushProcessor=void 0;const R=m("./utils"),I=m("./logger"),E=m("./@types/PushRules"),_=m("./@types/event"),d=[E.PushRuleKind.Override,E.PushRuleKind.ContentSpecific,E.PushRuleKind.RoomSpecific,E.PushRuleKind.SenderSpecific,E.PushRuleKind.Underride],u=[{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:E.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[E.PushRuleActionName.DontNotify]},{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:E.ConditionKind.EventMatch,key:"type",pattern:_.EventType.RoomServerAcl},{kind:E.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[]}],g=[{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:E.ConditionKind.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:E.ConditionKind.CallStarted}],actions:[E.PushRuleActionName.Notify,{set_tweak:E.TweakName.Sound,value:"default"}]}];class f{constructor(c){this.client=c}static actionListToActionsObject(c){const i={notify:!1,tweaks:{}};for(const r of c)r===E.PushRuleActionName.Notify?i.notify=!0:"object"==typeof r&&(void 0===r.value&&(r.value=!0),i.tweaks[r.set_tweak]=r.value);return i}static rewriteDefaultRules(c){var i;let r=JSON.parse(JSON.stringify(c));r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.override||(r.global.underride=[]);const s=r.global.override;for(const n of u){const o=s.find(h=>h.rule_id===n.rule_id);o?(o.default=n.default,o.conditions=n.conditions,o.actions=n.actions):(I.logger.warn(`Adding default global override for ${n.rule_id}`),s.push(n))}const t=null!==(i=r.global.underride)&&void 0!==i?i:[];for(const n of g){const o=t.find(h=>h.rule_id===n.rule_id);o?(o.default=n.default,o.conditions=n.conditions,o.actions=n.actions):(I.logger.warn(`Adding default global underride for ${n.rule_id}`),t.push(n))}return r}matchingRuleFromKindSet(c,i){for(const r of d){const s=i[r];if(s)for(const t of s){if(!t.enabled)continue;const n=this.templateRuleToRaw(r,t);if(n&&this.ruleMatchesEvent(n,c))return Object.assign(Object.assign({},t),{kind:r})}}return null}templateRuleToRaw(c,i){const r={rule_id:i.rule_id,actions:i.actions,conditions:[]};switch(c){case E.PushRuleKind.Underride:case E.PushRuleKind.Override:r.conditions=i.conditions;break;case E.PushRuleKind.RoomSpecific:if(!i.rule_id)return null;r.conditions.push({kind:E.ConditionKind.EventMatch,key:"room_id",value:i.rule_id});break;case E.PushRuleKind.SenderSpecific:if(!i.rule_id)return null;r.conditions.push({kind:E.ConditionKind.EventMatch,key:"user_id",value:i.rule_id});break;case E.PushRuleKind.ContentSpecific:if(!i.pattern)return null;r.conditions.push({kind:E.ConditionKind.EventMatch,key:"content.body",pattern:i.pattern})}return r}eventFulfillsCondition(c,i){switch(c.kind){case E.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(c,i);case E.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(c,i);case E.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(c,i);case E.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(c,i);case E.ConditionKind.CallStarted:case E.ConditionKind.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(c,i)}return!1}eventFulfillsSenderNotifPermCondition(c,i){const r=c.key;if(!r)return!1;const s=this.client.getRoom(i.getRoomId());return!!s?.currentState&&s.currentState.mayTriggerNotifOfType(r,i.getSender())}eventFulfillsRoomMemberCountCondition(c,i){if(!c.is)return!1;const r=this.client.getRoom(i.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;const s=r.currentState.getJoinedMemberCount(),t=c.is.match(/^([=<>]*)(\d*)$/);if(!t)return!1;const n=t[1],o=parseInt(t[2]);if(isNaN(o))return!1;switch(n){case"":case"==":return s==o;case"<":return s<o;case">":return s>o;case"<=":return s<=o;case">=":return s>=o;default:return!1}}eventFulfillsDisplayNameCondition(c,i){var r;let s=i.getContent();if(i.isEncrypted()&&i.getClearContent()&&(s=i.getClearContent()),!s||!s.body||"string"!=typeof s.body)return!1;const n=null===(r=this.client.getRoom(i.getRoomId())?.currentState)||void 0===r?void 0:r.getMember(this.client.credentials.userId);if(!n)return!1;const h=new RegExp("(^|\\W)"+(0,R.escapeRegExp)(n.name)+"(\\W|$)","i");return s.body.search(h)>-1}eventFulfillsEventMatchCondition(c,i){if(!c.key)return!1;const r=this.valueForDottedKey(c.key,i);if("string"!=typeof r)return!1;if(c.value)return c.value===r;if("string"!=typeof c.pattern)return!1;const s="content.body"===c.key?this.createCachedRegex("(^|\\W)",c.pattern,"(\\W|$)"):this.createCachedRegex("^",c.pattern,"$");return!!r.match(s)}eventFulfillsCallStartedCondition(c,i){return["m.ring","m.prompt"].includes(i.getContent()["m.intent"])&&!("m.terminated"in i.getContent())&&(i.getPrevContent()["m.terminated"]!==i.getContent()["m.terminated"]||(0,R.deepCompare)(i.getPrevContent(),{}))}createCachedRegex(c,i,r){return f.cachedGlobToRegex[i]||(f.cachedGlobToRegex[i]=new RegExp(c+(0,R.globToRegexp)(i)+r,"i")),f.cachedGlobToRegex[i]}valueForDottedKey(c,i){const r=c.split(".");let s;const t=r[0];for("content"===t?(s=i.getContent(),r.shift()):"type"===t?(s=i.getType(),r.shift()):s=i.event;r.length>0;){const n=r.shift();if((0,R.isNullOrUndefined)(s[n]))return null;s=s[n]}return s}matchingRuleForEventWithRulesets(c,i){return i&&c.getSender()!==this.client.credentials.userId?this.matchingRuleFromKindSet(c,i.global):null}pushActionsForEventAndRulesets(c,i){const r=this.matchingRuleForEventWithRulesets(c,i);if(!r)return{};const s=f.actionListToActionsObject(r.actions);return void 0===s.tweaks.highlight&&(s.tweaks.highlight=r.kind==E.PushRuleKind.ContentSpecific),s}ruleMatchesEvent(c,i){var r;return!(null!==(r=c.conditions)&&void 0!==r&&r.some(s=>!this.eventFulfillsCondition(s,i)))}actionsForEvent(c){return this.pushActionsForEventAndRulesets(c,this.client.pushRules)}getPushRuleById(c){var i;for(const r of["global"])if(void 0!==(null===(i=this.client.pushRules)||void 0===i?void 0:i[r]))for(const s of d)if(void 0!==this.client.pushRules[r][s])for(const t of this.client.pushRules[r][s])if(t.rule_id===c)return t;return null}}a.PushProcessor=f,f.cachedGlobToRegex={}},{"./@types/PushRules":297,"./@types/event":299,"./logger":365,"./utils":402}],388:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.randomUppercaseString=a.randomLowercaseString=a.randomString=void 0;const R="abcdefghijklmnopqrstuvwxyz",I="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function g(f,v){let c="";for(let i=0;i<f;++i)c+=v.charAt(Math.floor(Math.random()*v.length));return c}a.randomString=function _(f){return g(f,I+R+"0123456789")},a.randomLowercaseString=function d(f){return g(f,R)},a.randomUppercaseString=function u(f){return g(f,I)}},{}],389:[function(m,ie,a){(function(R){(function(){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.clearTimeout=a.setTimeout=void 0;const I=m("./logger"),E=1e3;let d,_=0;const u=[],g=function(...s){};function c(){d&&R.clearTimeout(d);const s=u[0];if(!s)return void g("scheduleRealCallback: no more callbacks, not rescheduling");const t=Date.now(),n=Math.min(s.runAt-t,E);g("scheduleRealCallback: now:",t,"delay:",n),d=R.setTimeout(i,n)}function i(){const s=Date.now();g("runCallbacks: now:",s);const t=[];for(;;){const n=u[0];if(!n||n.runAt>s)break;const o=u.shift();g("runCallbacks: popping",o.key),t.push(o)}c();for(const n of t)try{n.func.apply(R,n.params)}catch(o){I.logger.error("Uncaught exception in callback function",o)}}a.setTimeout=function f(s,t,...n){(t=t||0)<0&&(t=0);const o=Date.now()+t,h=_++;g("setTimeout: scheduling cb",h,"at",o,"(delay",t,")");const l={runAt:o,func:s,params:n,key:h},e=function r(s,t){let n=0,o=s.length;for(;n<o;){const h=n+o>>1;t(s[h])>0?o=h:n=h+1}return n}(u,function(p){return p.runAt-o});return u.splice(e,0,l),c(),h},a.clearTimeout=function v(s){if(0===u.length)return;let t;for(t=0;t<u.length;t++)if(u[t].key==s){u.splice(t,1);break}0===t&&c()}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./logger":365}],390:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(i,r,s,t){void 0===t&&(t=s);var n=Object.getOwnPropertyDescriptor(r,s);(!n||("get"in n?!r.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,t,n)}:function(i,r,s,t){void 0===t&&(t=s),i[t]=r[s]}),I=this&&this.__setModuleDefault||(Object.create?function(i,r){Object.defineProperty(i,"default",{enumerable:!0,value:r})}:function(i,r){i.default=r}),E=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var r={};if(null!=i)for(var s in i)"default"!==s&&Object.prototype.hasOwnProperty.call(i,s)&&R(r,i,s);return I(r,i),r};Object.defineProperty(a,"__esModule",{value:!0}),a.MatrixScheduler=void 0;const _=E(m("./utils")),d=m("./logger"),u=m("./@types/event"),g=m("./http-api"),f=!1;class v{static RETRY_BACKOFF_RATELIMIT(r,s,t){if(400===t.httpStatus||403===t.httpStatus||401===t.httpStatus||t instanceof g.ConnectionError||"M_TOO_LARGE"===t.name)return-1;if("M_LIMIT_EXCEEDED"===t.name){const n=t.data.retry_after_ms;if(n>0)return n}return s>4?-1:1e3*Math.pow(2,s)}static QUEUE_MESSAGES(r){return r.getType()===u.EventType.RoomMessage||r.hasAssociation()?"message":null}constructor(r=v.RETRY_BACKOFF_RATELIMIT,s=v.QUEUE_MESSAGES){this.retryAlgorithm=r,this.queueAlgorithm=s,this.queues={},this.activeQueues=[],this.procFn=null,this.processQueue=t=>{const n=this.peekNextEvent(t);if(!n){const o=this.activeQueues.indexOf(t);return o>=0&&this.activeQueues.splice(o,1),void c("Stopping queue '%s' as it is now empty",t)}c("Queue '%s' has %s pending events",t,this.queues[t].length),Promise.resolve().then(()=>this.procFn(n.event)).then(o=>{this.removeNextEvent(t),c("Queue '%s' sent event %s",t,n.event.getId()),n.defer.resolve(o),this.processQueue(t)},o=>{n.attempts+=1;const h=this.retryAlgorithm(n.event,n.attempts,o);c("retry(%s) err=%s event_id=%s waitTime=%s",n.attempts,o,n.event.getId(),h),-1===h?(c("Queue '%s' giving up on event %s",t,n.event.getId()),this.removeNextEvent(t),n.defer.reject(o),this.processQueue(t)):setTimeout(this.processQueue,h,t)})}}getQueueForEvent(r){const s=this.queueAlgorithm(r);return s&&this.queues[s]?this.queues[s].map(function(t){return t.event}):null}removeEventFromQueue(r){const s=this.queueAlgorithm(r);if(!s||!this.queues[s])return!1;let t=!1;return _.removeElement(this.queues[s],n=>n.event.getId()===r.getId()&&(t=!0,!0)),t}setProcessFunction(r){this.procFn=r,this.startProcessingQueues()}queueEvent(r){const s=this.queueAlgorithm(r);if(!s)return null;this.queues[s]||(this.queues[s]=[]);const t=_.defer();return this.queues[s].push({event:r,defer:t,attempts:0}),c("Queue algorithm dumped event %s into queue '%s'",r.getId(),s),this.startProcessingQueues(),t.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(r=>-1===this.activeQueues.indexOf(r)&&this.queues[r].length>0).forEach(r=>{this.activeQueues.push(r),c("Spinning up queue: '%s'",r),this.processQueue(r)})}peekNextEvent(r){const s=this.queues[r];if(Array.isArray(s))return s[0]}removeNextEvent(r){const s=this.queues[r];if(Array.isArray(s))return s.shift()}}function c(...i){f&&d.logger.log(...i)}a.MatrixScheduler=v},{"./@types/event":299,"./http-api":358,"./logger":365,"./utils":402}],391:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.SERVICE_TYPES=void 0,(I=a.SERVICE_TYPES||(a.SERVICE_TYPES={})).IS="SERVICE_TYPE_IS",I.IM="SERVICE_TYPE_IM"},{}],392:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(z,M,L,j){void 0===j&&(j=L);var C=Object.getOwnPropertyDescriptor(M,L);(!C||("get"in C?!M.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return M[L]}}),Object.defineProperty(z,j,C)}:function(z,M,L,j){void 0===j&&(j=L),z[j]=M[L]}),I=this&&this.__setModuleDefault||(Object.create?function(z,M){Object.defineProperty(z,"default",{enumerable:!0,value:M})}:function(z,M){z.default=M}),E=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var M={};if(null!=z)for(var L in z)"default"!==L&&Object.prototype.hasOwnProperty.call(z,L)&&R(M,z,L);return I(M,z),M},_=this&&this.__awaiter||function(z,M,L,j){return new(L||(L=Promise))(function(F,V){function N(U){try{S(j.next(U))}catch(W){V(W)}}function T(U){try{S(j.throw(U))}catch(W){V(W)}}function S(U){U.done?F(U.value):function C(F){return F instanceof L?F:new L(function(V){V(F)})}(U.value).then(N,T)}S((j=j.apply(z,M||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.SlidingSyncSdk=void 0;const d=m("./models/room"),u=m("./logger"),g=E(m("./utils")),f=m("./models/event-timeline"),v=m("./client"),c=m("./sync"),i=m("./http-api"),r=m("./sliding-sync"),s=m("./@types/event"),t=m("./pushprocessor"),n=m("./models/room-state"),o=m("./models/room-member");class l{constructor(M){this.crypto=M}name(){return"e2ee"}when(){return r.ExtensionState.PreProcess}onRequest(M){if(M)return{enabled:!0}}onResponse(M){return _(this,void 0,void 0,function*(){if(M.device_lists&&(yield this.crypto.handleDeviceListChanges({oldSyncToken:"yep"},M.device_lists)),M.device_one_time_keys_count&&this.crypto.updateOneTimeKeyCount(M.device_one_time_keys_count.signed_curve25519||0),M.device_unused_fallback_key_types||M["org.matrix.msc2732.device_unused_fallback_key_types"]){const L=M.device_unused_fallback_key_types||M["org.matrix.msc2732.device_unused_fallback_key_types"];this.crypto.setNeedsNewFallback(Array.isArray(L)&&!L.includes("signed_curve25519"))}})}}class e{constructor(M){this.client=M,this.nextBatch=null}name(){return"to_device"}when(){return r.ExtensionState.PreProcess}onRequest(M){const L={since:null!==this.nextBatch?this.nextBatch:void 0};return M&&(L.limit=100,L.enabled=!0),L}onResponse(M){var L;return _(this,void 0,void 0,function*(){const j=[];null===(L=M.events)||void 0===L||L.map(this.client.getEventMapper()).map(C=>{if("m.key.verification.cancel"===C.getType()){const F=C.getContent().transaction_id;F&&j.push(F)}return C}).forEach(C=>{const F=C.getContent();"m.room.message"!=C.getType()||"m.bad.encrypted"!=F.msgtype?("m.key.verification.start"!==C.getType()&&"m.key.verification.request"!==C.getType()||j.includes(F.transaction_id)&&C.flagCancelled(),this.client.emit(v.ClientEvent.ToDeviceEvent,C)):u.logger.log("Ignoring undecryptable to-device event from "+C.getSender())}),this.nextBatch=M.next_batch})}}class p{constructor(M){this.client=M}name(){return"account_data"}when(){return r.ExtensionState.PostProcess}onRequest(M){if(M)return{enabled:!0}}onResponse(M){M.global&&M.global.length>0&&this.processGlobalAccountData(M.global);for(const L in M.rooms){const j=B(this.client,L,M.rooms[L]),C=this.client.getRoom(L);C?(C.addAccountData(j),j.forEach(F=>{this.client.emit(v.ClientEvent.Event,F)})):u.logger.warn("got account data for room but room doesn't exist on client:",L)}}processGlobalAccountData(M){const L=B(this.client,void 0,M),j=L.reduce((C,F)=>(C[F.getType()]=this.client.store.getAccountData(F.getType()),C),{});this.client.store.storeAccountDataEvents(L),L.forEach(C=>{if(C.getType()===s.EventType.PushRules){const V=C.getContent();this.client.pushRules=t.PushProcessor.rewriteDefaultRules(V)}const F=j[C.getType()];return this.client.emit(v.ClientEvent.AccountData,C,F),C})}}class b{constructor(M){this.client=M}name(){return"typing"}when(){return r.ExtensionState.PostProcess}onRequest(M){if(M)return{enabled:!0}}onResponse(M){if(M?.rooms)for(const L in M.rooms)J(this.client,L,[M.rooms[L]])}}class y{constructor(M){this.client=M}name(){return"receipts"}when(){return r.ExtensionState.PostProcess}onRequest(M){if(M)return{enabled:!0}}onResponse(M){if(M?.rooms)for(const L in M.rooms)J(this.client,L,[M.rooms[L]])}}function B(z,M,L,j=!0){const C=z.getEventMapper({decrypt:j});return L.map(function(F){return F.room_id=M,C(F)})}function J(z,M,L){const j=B(z,M,L),C=z.getRoom(M);C?(C.addEphemeralEvents(j),j.forEach(F=>{z.emit(v.ClientEvent.Event,F)})):u.logger.warn("got ephemeral events for room but room doesn't exist on client:",M)}a.SlidingSyncSdk=class w{constructor(M,L,j={}){var C;this.slidingSync=M,this.client=L,this.opts=j,this.syncState=null,this.lastPos=null,this.failCount=0,this.notifEvents=[],this.opts.initialSyncLimit=null!==(C=this.opts.initialSyncLimit)&&void 0!==C?C:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||v.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,j.canResetEntireTimeline||(j.canResetEntireTimeline=V=>!1),L.getNotifTimelineSet()&&L.reEmitter.reEmit(L.getNotifTimelineSet(),[d.RoomEvent.Timeline,d.RoomEvent.TimelineReset]),this.slidingSync.on(r.SlidingSyncEvent.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(r.SlidingSyncEvent.RoomData,this.onRoomData.bind(this));const F=[new e(this.client),new p(this.client),new b(this.client),new y(this.client)];this.opts.crypto&&F.push(new l(this.opts.crypto)),F.forEach(V=>{this.slidingSync.registerExtension(V)})}onRoomData(M,L){let j=this.client.store.getRoom(M);if(!j){if(!L.initial)return void u.logger.debug("initial flag not set but no stored room exists for room ",M,L);j=(0,c._createAndReEmitRoom)(this.client,M,this.opts)}this.processRoomData(this.client,j,L)}onLifecycle(M,L,j){switch(j&&u.logger.debug("onLifecycle",M,j),M){case r.SlidingSyncState.Complete:if(this.purgeNotifications(),!L)break;this.lastPos||this.updateSyncState(c.SyncState.Prepared,{oldSyncToken:void 0,nextSyncToken:L.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(c.SyncState.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:L.pos,catchingUp:!1,fromCache:!1}),this.lastPos=L.pos;break;case r.SlidingSyncState.RequestFinished:if(j){if(this.failCount+=1,this.updateSyncState(this.failCount>3?c.SyncState.Error:c.SyncState.Reconnecting,{error:new i.MatrixError(j)}),this.shouldAbortSync(new i.MatrixError(j)))return}else this.failCount=0}}syncLeftRooms(){return _(this,void 0,void 0,function*(){return[]})}peek(M){return _(this,void 0,void 0,function*(){return null})}stopPeeking(){}getSyncState(){return this.syncState}getSyncStateData(){var M;return null!==(M=this.syncStateData)&&void 0!==M?M:null}createRoom(M){const{timelineSupport:L}=this.client,j=new d.Room(M,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:L});return this.client.reEmitter.reEmit(j,[d.RoomEvent.Name,d.RoomEvent.Redaction,d.RoomEvent.RedactionCancelled,d.RoomEvent.Receipt,d.RoomEvent.Tags,d.RoomEvent.LocalEchoUpdated,d.RoomEvent.AccountData,d.RoomEvent.MyMembership,d.RoomEvent.Timeline,d.RoomEvent.TimelineReset]),this.registerStateListeners(j),j}registerStateListeners(M){this.client.reEmitter.reEmit(M.currentState,[n.RoomStateEvent.Events,n.RoomStateEvent.Members,n.RoomStateEvent.NewMember,n.RoomStateEvent.Update]),M.currentState.on(n.RoomStateEvent.NewMember,(L,j,C)=>{var F;C.user=null!==(F=this.client.getUser(C.userId))&&void 0!==F?F:void 0,this.client.reEmitter.reEmit(C,[o.RoomMemberEvent.Name,o.RoomMemberEvent.Typing,o.RoomMemberEvent.PowerLevel,o.RoomMemberEvent.Membership])})}shouldAbortSync(M){return"M_UNKNOWN_TOKEN"===M.errcode&&(u.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(c.SyncState.Error,{error:M}),!0)}processRoomData(M,L,j){var C;return _(this,void 0,void 0,function*(){j=function x(z,M,L){if(!L.name)return L;for(const j of L.required_state)if(j.type===s.EventType.RoomName&&""===j.state_key)return j.content={name:L.name},L;return L.required_state.push({event_id:"$fake-sliding-sync-name-event-"+M,state_key:"",type:s.EventType.RoomName,content:{name:L.name},sender:z.getUserId(),origin_server_ts:(new Date).getTime()}),L}(M,L.roomId,j);const F=B(this.client,L.roomId,j.required_state);let V=B(this.client,L.roomId,j.timeline,!1);const N=[];if(j.initial){const U=new Set;L.getLiveTimeline().getEvents().forEach(Q=>{U.add(Q.getId())});const W=[],k=[];let D=!1;for(let Q=V.length-1;Q>=0;Q--){const ee=V[Q];U.has(ee.getId())?D=!0:D?W.push(ee):k.unshift(ee)}V=k,W.length>0&&L.addEventsToTimeline(W,!0,L.getLiveTimeline(),j.prev_batch)}const T=this.client.isRoomEncrypted(L.roomId);if(null!=j.notification_count&&L.setUnreadNotificationCount(d.NotificationCountType.Total,j.notification_count),null!=j.highlight_count&&(!T||T&&L.getUnreadNotificationCount(d.NotificationCountType.Highlight)<=0)&&L.setUnreadNotificationCount(d.NotificationCountType.Highlight,j.highlight_count),Number.isInteger(j.invited_count)&&L.currentState.setInvitedMemberCount(j.invited_count),Number.isInteger(j.joined_count)&&L.currentState.setJoinedMemberCount(j.joined_count),j.invite_state){const U=B(this.client,L.roomId,j.invite_state);return this.injectRoomEvents(L,U),j.initial&&(L.recalculate(),this.client.store.storeRoom(L),this.client.emit(v.ClientEvent.Room,L)),U.forEach(W=>{this.client.emit(v.ClientEvent.Event,W)}),void L.updateMyMembership("invite")}j.initial&&L.getLiveTimeline().setPaginationToken(null!==(C=j.prev_batch)&&void 0!==C?C:null,f.EventTimeline.BACKWARDS),this.injectRoomEvents(L,F,V,j.num_live),L.addEphemeralEvents(N),L.updateMyMembership("join"),L.recalculate(),j.initial&&(M.store.storeRoom(L),M.emit(v.ClientEvent.Room,L)),this.addNotifications(V);const S=U=>_(this,void 0,void 0,function*(){M.emit(v.ClientEvent.Event,U),U.isState()&&U.getType()==s.EventType.RoomEncryption&&this.opts.crypto&&(yield this.opts.crypto.onCryptoEvent(L,U))});yield g.promiseMapSeries(F,S),yield g.promiseMapSeries(V,S),N.forEach(function(U){M.emit(v.ClientEvent.Event,U)}),L.decryptCriticalEvents()})}injectRoomEvents(M,L,j,C){j=j||[],L=L||[],C=C||0;const F=M.getLiveTimeline(),V=0==F.getEvents().length;if(V){for(const T of L)this.client.getPushActionsForEvent(T);F.initialiseState(L)}V||(M.oldState.setStateEvents(L),M.currentState.setStateEvents(L));let N=[];C>0&&(N=j.slice(-1*C),j=j.slice(0,-1*N.length)),M.addLiveEvents(j,{fromCache:!0}),N.length>0&&M.addLiveEvents(N,{fromCache:!1}),M.recalculate(),this.resolveInvites(M)}resolveInvites(M){if(!M||!this.opts.resolveInvitesToProfiles)return;const L=this.client;M.getMembersWithMembership("invite").forEach(function(j){if(j.requestedProfileInfo)return;j.requestedProfileInfo=!0;const C=L.getUser(j.userId);let F;F=C?Promise.resolve({avatar_url:C.avatarUrl,displayname:C.displayName}):L.getProfileInfo(j.userId),F.then(function(V){const N=j.events.member;"invite"===N.getContent().membership&&(N.getContent().avatar_url=V.avatar_url,N.getContent().displayname=V.displayname,j.setMembershipEvent(N,M.currentState))},function(V){})})}retryImmediately(){return!0}sync(){return _(this,void 0,void 0,function*(){for(u.logger.debug("Sliding sync init loop");!this.client.isGuest();)try{u.logger.debug("Getting push rules...");const M=yield this.client.getPushRules();u.logger.debug("Got push rules"),this.client.pushRules=M;break}catch(M){if(u.logger.error("Getting push rules failed",M),this.shouldAbortSync(M))return}yield this.slidingSync.start()})}stop(){u.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(M,L){const j=this.syncState;this.syncState=M,this.syncStateData=L,this.client.emit(v.ClientEvent.Sync,this.syncState,j,L)}addNotifications(M){if(this.client.getNotifTimelineSet())for(const L of M){const j=this.client.getPushActionsForEvent(L);j&&j.notify&&j.tweaks&&j.tweaks.highlight&&this.notifEvents.push(L)}}purgeNotifications(){this.notifEvents.sort(function(M,L){return M.getTs()-L.getTs()}),this.notifEvents.forEach(M=>{var L;null===(L=this.client.getNotifTimelineSet())||void 0===L||L.addLiveEvent(M)}),this.notifEvents=[]}}},{"./@types/event":299,"./client":313,"./http-api":358,"./logger":365,"./models/event-timeline":373,"./models/room":382,"./models/room-member":379,"./models/room-state":380,"./pushprocessor":387,"./sliding-sync":393,"./sync":400,"./utils":402}],393:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(r,s,t,n){return new(t||(t=Promise))(function(h,l){function e(y){try{b(n.next(y))}catch(w){l(w)}}function p(y){try{b(n.throw(y))}catch(w){l(w)}}function b(y){y.done?h(y.value):function o(h){return h instanceof t?h:new t(function(l){l(h)})}(y.value).then(e,p)}b((n=n.apply(r,s||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.SlidingSync=a.SlidingSyncEvent=a.ExtensionState=a.SlidingSyncState=a.MSC3575_STATE_KEY_LAZY=a.MSC3575_STATE_KEY_ME=a.MSC3575_WILDCARD=void 0;const I=m("./logger"),E=m("./models/typed-event-emitter"),_=m("./utils");var u,r,f,v;a.MSC3575_WILDCARD="*",a.MSC3575_STATE_KEY_ME="$ME",a.MSC3575_STATE_KEY_LAZY="$LAZY",(r=u=a.SlidingSyncState||(a.SlidingSyncState={})).RequestFinished="FINISHED",r.Complete="COMPLETE";class g{constructor(s){this.roomIndexToRoomId={},this.joinedCount=0,this.replaceList(s)}setModified(s){this.isModified=s}updateListRange(s){this.list.ranges=JSON.parse(JSON.stringify(s))}replaceList(s){s.filters=s.filters||{},s.ranges=s.ranges||[],this.list=JSON.parse(JSON.stringify(s)),this.isModified=!0,this.roomIndexToRoomId={},this.joinedCount=0}getList(s){let t={ranges:JSON.parse(JSON.stringify(this.list.ranges))};return(this.isModified||s)&&(t=JSON.parse(JSON.stringify(this.list))),t}isIndexInRange(s){for(const t of this.list.ranges)if(t[0]<=s&&s<=t[1])return!0;return!1}}!function(r){r.PreProcess="ExtState.PreProcess",r.PostProcess="ExtState.PostProcess"}(f=a.ExtensionState||(a.ExtensionState={})),function(r){r.RoomData="SlidingSync.RoomData",r.Lifecycle="SlidingSync.Lifecycle",r.List="SlidingSync.List"}(v=a.SlidingSyncEvent||(a.SlidingSyncEvent={})),a.SlidingSync=class c extends E.TypedEventEmitter{constructor(s,t,n,o,h){super(),this.proxyBaseUrl=s,this.roomSubscriptionInfo=n,this.client=o,this.timeoutMS=h,this.listModifiedCount=0,this.terminated=!1,this.needsResend=!1,this.txnId=null,this.txnIdDefers=[],this.extensions={},this.desiredRoomSubscriptions=new Set,this.confirmedRoomSubscriptions=new Set,this.customSubscriptions=new Map,this.roomIdToCustomSubscription=new Map,this.lists=t.map(l=>new g(l))}addCustomSubscription(s,t){this.customSubscriptions.set(s,t)}useCustomSubscription(s,t){this.roomIdToCustomSubscription.set(s,t),this.confirmedRoomSubscriptions.delete(s)}listLength(){return this.lists.length}getListData(s){return this.lists[s]?{joinedCount:this.lists[s].joinedCount,roomIndexToRoomId:Object.assign({},this.lists[s].roomIndexToRoomId)}:null}getList(s){return this.lists[s]?this.lists[s].getList(!0):null}setListRanges(s,t){return this.lists[s].updateListRange(t),this.resend()}setList(s,t){return this.lists[s]?this.lists[s].replaceList(t):this.lists[s]=new g(t),this.listModifiedCount+=1,this.resend()}getRoomSubscriptions(){return new Set(Array.from(this.desiredRoomSubscriptions))}modifyRoomSubscriptions(s){return this.desiredRoomSubscriptions=s,this.resend()}modifyRoomSubscriptionInfo(s){return this.roomSubscriptionInfo=s,this.confirmedRoomSubscriptions=new Set,this.resend()}registerExtension(s){if(this.extensions[s.name()])throw new Error(`registerExtension: ${s.name()} already exists as an extension`);this.extensions[s.name()]=s}getExtensionRequest(s){const t={};return Object.keys(this.extensions).forEach(n=>{t[n]=this.extensions[n].onRequest(s)}),t}onPreExtensionsResponse(s){Object.keys(s).forEach(t=>{this.extensions[t].when()==f.PreProcess&&this.extensions[t].onResponse(s[t])})}onPostExtensionsResponse(s){Object.keys(s).forEach(t=>{this.extensions[t].when()==f.PostProcess&&this.extensions[t].onResponse(s[t])})}invokeRoomDataListeners(s,t){t.required_state||(t.required_state=[]),t.timeline||(t.timeline=[]),this.emit(v.RoomData,s,t)}invokeLifecycleListeners(s,t,n){this.emit(v.Lifecycle,s,t,n)}shiftRight(s,t,n){for(let o=t;o>n;o--)this.lists[s].isIndexInRange(o)&&(this.lists[s].roomIndexToRoomId[o]=this.lists[s].roomIndexToRoomId[o-1])}shiftLeft(s,t,n){for(let o=n;o<t;o++)this.lists[s].isIndexInRange(o)&&(this.lists[s].roomIndexToRoomId[o]=this.lists[s].roomIndexToRoomId[o+1])}removeEntry(s,t){let n=-1;for(const o in this.lists[s].roomIndexToRoomId)Number(o)>n&&(n=Number(o));n<0||t>n||(this.shiftLeft(s,n,t),delete this.lists[s].roomIndexToRoomId[n])}addEntry(s,t){let n=-1;for(const o in this.lists[s].roomIndexToRoomId)Number(o)>n&&(n=Number(o));n<0||t>n||this.shiftRight(s,n+1,t)}processListOps(s,t){let n=-1;s.ops.forEach(o=>{switch(o.op){case"DELETE":I.logger.debug("DELETE",t,o.index,";"),delete this.lists[t].roomIndexToRoomId[o.index],-1!==n&&this.removeEntry(t,n),n=o.index;break;case"INSERT":I.logger.debug("INSERT",t,o.index,o.room_id,";"),this.lists[t].roomIndexToRoomId[o.index]&&(n<0?this.addEntry(t,o.index):n>o.index?this.shiftRight(t,n,o.index):n<o.index&&this.shiftLeft(t,o.index,n)),n=-1,this.lists[t].roomIndexToRoomId[o.index]=o.room_id;break;case"INVALIDATE":for(let l=o.range[0];l<=o.range[1];l++)delete this.lists[t].roomIndexToRoomId[l];I.logger.debug("INVALIDATE",t,o.range[0],o.range[1],";");break;case"SYNC":{const h=o.range[0];for(let l=h;l<=o.range[1];l++){const e=o.room_ids[l-h];if(!e)break;this.lists[t].roomIndexToRoomId[l]=e}I.logger.debug("SYNC",t,o.range[0],o.range[1],(o.room_ids||[]).join(" "),";");break}}}),-1!==n&&this.removeEntry(t,n)}resend(){var s;if(this.needsResend&&this.txnIdDefers.length>0)return this.txnIdDefers[this.txnIdDefers.length-1].promise;this.needsResend=!0,this.txnId=this.client.makeTxnId();const t=(0,_.defer)();return this.txnIdDefers.push(Object.assign(Object.assign({},t),{txnId:this.txnId})),null===(s=this.abortController)||void 0===s||s.abort(),this.abortController=new AbortController,t.promise}resolveTransactionDefers(s){if(!s)return;let t=-1;for(let n=0;n<this.txnIdDefers.length;n++)if(this.txnIdDefers[n].txnId===s){t=n;break}if(-1!==t){for(let n=0;n<t;n++)this.txnIdDefers[n].reject(this.txnIdDefers[n].txnId);this.txnIdDefers[t].resolve(s),this.txnIdDefers=this.txnIdDefers.slice(t+1)}else I.logger.warn(`resolveTransactionDefers: seen ${s} but it isn't a pending txn, ignoring.`)}stop(){var s;this.terminated=!0,null===(s=this.abortController)||void 0===s||s.abort(),this.removeAllListeners(v.Lifecycle),this.removeAllListeners(v.List),this.removeAllListeners(v.RoomData)}resetup(){var s;I.logger.warn("SlidingSync: resetting connection info"),this.txnIdDefers.forEach(t=>{t.reject(t.txnId)}),this.txnIdDefers=[],this.lists.forEach(t=>{t.setModified(!0)}),this.confirmedRoomSubscriptions=new Set,this.needsResend=!0,null===(s=this.abortController)||void 0===s||s.abort(),this.abortController=new AbortController}start(){return R(this,void 0,void 0,function*(){let s;for(this.abortController=new AbortController;!this.terminated;){this.needsResend=!1;let n,t=!1;try{const h=this.listModifiedCount,l={lists:this.lists.map(b=>b.getList(!1)),pos:s,timeout:this.timeoutMS,clientTimeout:this.timeoutMS+1e4,extensions:this.getExtensionRequest(void 0===s)},e=i(this.desiredRoomSubscriptions,this.confirmedRoomSubscriptions),p=i(this.confirmedRoomSubscriptions,this.desiredRoomSubscriptions);if(p.size>0&&(l.unsubscribe_rooms=Array.from(p)),e.size>0){l.room_subscriptions={};for(const b of e){const y=this.roomIdToCustomSubscription.get(b);let w=this.roomSubscriptionInfo;y&&this.customSubscriptions.has(y)&&(w=this.customSubscriptions.get(y)),l.room_subscriptions[b]=w}}this.txnId&&(l.txn_id=this.txnId,this.txnId=null),this.pendingReq=this.client.slidingSync(l,this.proxyBaseUrl,this.abortController.signal),n=yield this.pendingReq,s=n.pos;for(const b of e)this.confirmedRoomSubscriptions.add(b);for(const b of p)this.confirmedRoomSubscriptions.delete(b);h!==this.listModifiedCount&&(I.logger.debug("list modified during await call, not updating list"),t=!0),this.lists.forEach(b=>{b.setModified(!1)}),n.lists=n.lists||[],n.rooms=n.rooms||{},n.extensions=n.extensions||{},n.lists.forEach((b,y)=>{this.lists[y].joinedCount=b.count}),this.invokeLifecycleListeners(u.RequestFinished,n)}catch(h){if(h.httpStatus){if(this.invokeLifecycleListeners(u.RequestFinished,null,h),400===h.httpStatus){this.resetup(),s=void 0,yield(0,_.sleep)(50);continue}}else if(this.needsResend||"AbortError"===h.name)continue;I.logger.error(h),yield(0,_.sleep)(5e3)}if(!n)continue;this.onPreExtensionsResponse(n.extensions),Object.keys(n.rooms).forEach(h=>{this.invokeRoomDataListeners(h,n.rooms[h])});const o=new Set;t||n.lists.forEach((h,l)=>{h.ops=h.ops||[],h.ops.length>0&&o.add(l),this.processListOps(h,l)}),this.invokeLifecycleListeners(u.Complete,n),this.onPostExtensionsResponse(n.extensions),o.forEach(h=>{this.emit(v.List,h,this.lists[h].joinedCount,Object.assign({},this.lists[h].roomIndexToRoomId))}),this.resolveTransactionDefers(n.txn_id)}})}};const i=(r,s)=>{const t=new Set(r);for(const n of s)t.delete(n);return t}},{"./logger":365,"./models/typed-event-emitter":385,"./utils":402}],394:[function(m,ie,a){"use strict";var R=this&&this.__createBinding||(Object.create?function(h,l,e,p){void 0===p&&(p=e);var b=Object.getOwnPropertyDescriptor(l,e);(!b||("get"in b?!l.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return l[e]}}),Object.defineProperty(h,p,b)}:function(h,l,e,p){void 0===p&&(p=e),h[p]=l[e]}),I=this&&this.__setModuleDefault||(Object.create?function(h,l){Object.defineProperty(h,"default",{enumerable:!0,value:l})}:function(h,l){h.default=l}),E=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var l={};if(null!=h)for(var e in h)"default"!==e&&Object.prototype.hasOwnProperty.call(h,e)&&R(l,h,e);return I(l,h),l},_=this&&this.__awaiter||function(h,l,e,p){return new(e||(e=Promise))(function(y,w){function x(z){try{J(p.next(z))}catch(M){w(M)}}function B(z){try{J(p.throw(z))}catch(M){w(M)}}function J(z){z.done?y(z.value):function b(y){return y instanceof e?y:new e(function(w){w(y)})}(z.value).then(x,B)}J((p=p.apply(h,l||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.LocalIndexedDBStoreBackend=void 0;const d=m("../sync-accumulator"),u=E(m("../utils")),g=E(m("../indexeddb-helpers")),f=m("../logger"),v=[h=>{h.createObjectStore("users",{keyPath:["userId"]}),h.createObjectStore("accountData",{keyPath:["type"]}),h.createObjectStore("sync",{keyPath:["clobber"]})},h=>{h.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},h=>{h.createObjectStore("client_options",{keyPath:["clobber"]})},h=>{h.createObjectStore("to_device_queue",{autoIncrement:!0})}],c=v.length;function i(h,l,e){const p=h.openCursor(l);return new Promise((b,y)=>{const w=[];p.onerror=()=>{y(new Error("Query failed: "+p.error))},p.onsuccess=()=>{const x=p.result;x?(w.push(e(x)),x.continue()):b(w)}})}function r(h){return new Promise((l,e)=>{h.oncomplete=function(p){l(p)},h.onerror=function(){e(h.error)}})}function s(h){return new Promise((l,e)=>{h.onsuccess=function(p){l(p)},h.onerror=function(){e(h.error)}})}function n(h){return s(h).then(l=>h.result)}a.LocalIndexedDBStoreBackend=class o{static exists(l,e){return g.exists(l,e="matrix-js-sdk:"+(e||"default"))}constructor(l,e="default"){this.indexedDB=l,this.disconnected=!0,this._isNewlyCreated=!1,this.isPersisting=!1,this.pendingUserPresenceData=[],this.dbName="matrix-js-sdk:"+e,this.syncAccumulator=new d.SyncAccumulator}connect(){if(!this.disconnected)return f.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,f.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const l=this.indexedDB.open(this.dbName,c);return l.onupgradeneeded=e=>{const p=l.result,b=e.oldVersion;f.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${b}`),b<1&&(this._isNewlyCreated=!0),v.forEach((y,w)=>{b<=w&&y(p)})},l.onblocked=()=>{f.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},f.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),s(l).then(()=>_(this,void 0,void 0,function*(){f.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=l.result,this.db.onversionchange=()=>{var e;null===(e=this.db)||void 0===e||e.close()},yield this.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(([l,e])=>{f.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:e.nextBatch,rooms:e.roomsData,account_data:{events:l}},!0)})}getOutOfBandMembers(l){return new Promise((e,p)=>{const w=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),x=IDBKeyRange.only(l),B=w.openCursor(x),J=[];let z=!1;B.onsuccess=()=>{const M=B.result;if(!M)return e(J.length||z?J:null);const L=M.value;L.oob_written?z=!0:J.push(L),M.continue()},B.onerror=M=>{p(M)}}).then(e=>(f.logger.log(`LL: got ${e?.length} membershipEvents from storage for room ${l} ...`),e))}setOutOfBandMembers(l,e){return _(this,void 0,void 0,function*(){f.logger.log(`LL: backend about to store ${e.length} members for ${l}`);const p=this.db.transaction(["oob_membership_events"],"readwrite"),b=p.objectStore("oob_membership_events");e.forEach(w=>{b.put(w)}),b.put({room_id:l,oob_written:!0,state_key:0}),yield r(p),f.logger.log(`LL: backend done storing for ${l}!`)})}clearOutOfBandMembers(l){return _(this,void 0,void 0,function*(){const b=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),y=IDBKeyRange.only(l),w=n(b.openKeyCursor(y,"next")).then(j=>j?.primaryKey[1]),x=n(b.openKeyCursor(y,"prev")).then(j=>j?.primaryKey[1]),[B,J]=yield Promise.all([w,x]),M=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),L=IDBKeyRange.bound([l,B],[l,J]);f.logger.log(`LL: Deleting all users + marker in storage for room ${l}, with key range:`,[l,B],[l,J]),yield function t(h){return new Promise((l,e)=>{h.onsuccess=()=>l(h),h.onerror=p=>e(p)})}(M.delete(L))})}clearDatabase(){return new Promise(l=>{f.logger.log(`Removing indexeddb instance: ${this.dbName}`);const e=this.indexedDB.deleteDatabase(this.dbName);e.onblocked=()=>{f.logger.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},e.onerror=()=>{f.logger.warn(`unable to delete js-sdk store indexeddb: ${e.error}`),l()},e.onsuccess=()=>{f.logger.log(`Removed indexeddb instance: ${this.dbName}`),l()}})}getSavedSync(l=!0){const e=this.syncAccumulator.getJSON();return Promise.resolve(e.nextBatch?l?u.deepCopy(e):e:null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(l){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(l)})}syncToDatabase(l){return _(this,void 0,void 0,function*(){if(this.isPersisting)return f.logger.warn("Skipping syncToDatabase() as persist already in flight"),void this.pendingUserPresenceData.push(...l);l.unshift(...this.pendingUserPresenceData),this.isPersisting=!0;try{const e=this.syncAccumulator.getJSON(!0);yield Promise.all([this.persistUserPresenceEvents(l),this.persistAccountData(e.accountData),this.persistSyncData(e.nextBatch,e.roomsData)])}finally{this.isPersisting=!1}})}persistSyncData(l,e){return f.logger.log("Persisting sync data up to",l),u.promiseTry(()=>{const p=this.db.transaction(["sync"],"readwrite");return p.objectStore("sync").put({clobber:"-",nextBatch:l,roomsData:e}),r(p).then(()=>{f.logger.log("Persisted sync data up to",l)})})}persistAccountData(l){return u.promiseTry(()=>{const e=this.db.transaction(["accountData"],"readwrite"),p=e.objectStore("accountData");for(const b of l)p.put(b);return r(e).then()})}persistUserPresenceEvents(l){return u.promiseTry(()=>{const e=this.db.transaction(["users"],"readwrite"),p=e.objectStore("users");for(const b of l)p.put({userId:b[0],event:b[1]});return r(e).then()})}getUserPresenceEvents(){return u.promiseTry(()=>i(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,p=>[p.value.userId,p.value.event]))}loadAccountData(){return f.logger.log("LocalIndexedDBStoreBackend: loading account data..."),u.promiseTry(()=>i(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,p=>p.value).then(p=>(f.logger.log("LocalIndexedDBStoreBackend: loaded account data"),p)))}loadSyncData(){return f.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),u.promiseTry(()=>i(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,p=>p.value).then(p=>(f.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),p.length>1&&f.logger.warn("loadSyncData: More than 1 sync row found."),p.length>0?p[0]:{})))}getClientOptions(){return Promise.resolve().then(()=>i(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,p=>{var b;return null===(b=p.value)||void 0===b?void 0:b.options}).then(p=>p[0]))}storeClientOptions(l){return _(this,void 0,void 0,function*(){const e=this.db.transaction(["client_options"],"readwrite");e.objectStore("client_options").put({clobber:"-",options:l}),yield r(e)})}saveToDeviceBatches(l){return _(this,void 0,void 0,function*(){const e=this.db.transaction(["to_device_queue"],"readwrite"),p=e.objectStore("to_device_queue");for(const b of l)p.add(b);yield r(e)})}getOldestToDeviceBatch(){return _(this,void 0,void 0,function*(){const e=this.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),p=yield n(e.openCursor());if(!p)return null;const b=p.value;return{id:p.key,txnId:b.txnId,eventType:b.eventType,batch:b.batch}})}removeToDeviceBatch(l){return _(this,void 0,void 0,function*(){const e=this.db.transaction(["to_device_queue"],"readwrite");e.objectStore("to_device_queue").delete(l),yield r(e)})}}},{"../indexeddb-helpers":363,"../logger":365,"../sync-accumulator":399,"../utils":402}],395:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(d,u,g,f){return new(g||(g=Promise))(function(c,i){function r(n){try{t(f.next(n))}catch(o){i(o)}}function s(n){try{t(f.throw(n))}catch(o){i(o)}}function t(n){n.done?c(n.value):function v(c){return c instanceof g?c:new g(function(i){i(c)})}(n.value).then(r,s)}t((f=f.apply(d,u||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.RemoteIndexedDBStoreBackend=void 0;const I=m("../logger"),E=m("../utils");a.RemoteIndexedDBStoreBackend=class _{constructor(u,g){this.workerFactory=u,this.dbName=g,this.nextSeq=0,this.inFlight={},this.onWorkerMessage=f=>{const v=f.data;if("cmd_success"==v.command||"cmd_fail"==v.command){if(void 0===v.seq)return void I.logger.error("Got reply from worker with no seq");const c=this.inFlight[v.seq];if(void 0===c)return void I.logger.error("Got reply for unknown seq "+v.seq);if(delete this.inFlight[v.seq],"cmd_success"==v.command)c.resolve(v.result);else{const i=new Error(v.error.message);i.name=v.error.name,c.reject(i)}}else I.logger.warn("Unrecognised message from worker: ",v)}}connect(){return this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(u){return this.doCmd("setSyncData",[u])}syncToDatabase(u){return this.doCmd("syncToDatabase",[u])}getOutOfBandMembers(u){return this.doCmd("getOutOfBandMembers",[u])}setOutOfBandMembers(u,g){return this.doCmd("setOutOfBandMembers",[u,g])}clearOutOfBandMembers(u){return this.doCmd("clearOutOfBandMembers",[u])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(u){return this.doCmd("storeClientOptions",[u])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(u){return R(this,void 0,void 0,function*(){return this.doCmd("saveToDeviceBatches",[u])})}getOldestToDeviceBatch(){return R(this,void 0,void 0,function*(){return this.doCmd("getOldestToDeviceBatch")})}removeToDeviceBatch(u){return R(this,void 0,void 0,function*(){return this.doCmd("removeToDeviceBatch",[u])})}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{I.logger.log("IndexedDB worker is ready")})),this.startPromise}doCmd(u,g){return Promise.resolve().then(()=>{var f;const v=this.nextSeq++,c=(0,E.defer)();return this.inFlight[v]=c,null===(f=this.worker)||void 0===f||f.postMessage({command:u,seq:v,args:g}),c.promise})}}},{"../logger":365,"../utils":402}],396:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(r,s,t,n){return new(t||(t=Promise))(function(h,l){function e(y){try{b(n.next(y))}catch(w){l(w)}}function p(y){try{b(n.throw(y))}catch(w){l(w)}}function b(y){y.done?h(y.value):function o(h){return h instanceof t?h:new t(function(l){l(h)})}(y.value).then(e,p)}b((n=n.apply(r,s||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.IndexedDBStore=void 0;const I=m("./memory"),E=m("./indexeddb-local-backend"),_=m("./indexeddb-remote-backend"),d=m("../models/user"),u=m("../models/event"),g=m("../logger"),f=m("../models/typed-event-emitter");function i(r){return`mx_pending_events_${r}`}a.IndexedDBStore=class c extends I.MemoryStore{static exists(s,t){return E.LocalIndexedDBStoreBackend.exists(s,t)}constructor(s){if(super(s),this.startedUp=!1,this.syncTs=0,this.userModifiedMap={},this.emitter=new f.TypedEventEmitter,this.on=this.emitter.on.bind(this.emitter),this.getSavedSync=this.degradable(()=>this.backend.getSavedSync(),"getSavedSync"),this.isNewlyCreated=this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated"),this.getSavedSyncToken=this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken"),this.deleteAllData=this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{g.logger.log("Deleted indexeddb data.")},t=>{throw g.logger.error(`Failed to delete indexeddb data: ${t}`),t}))),this.reallySave=this.degradable(()=>{this.syncTs=Date.now();const t=[];for(const n of this.getUsers())this.userModifiedMap[n.userId]!==n.getLastModifiedTime()&&n.events.presence&&(t.push([n.userId,n.events.presence.event]),this.userModifiedMap[n.userId]=n.getLastModifiedTime());return this.backend.syncToDatabase(t)}),this.setSyncData=this.degradable(t=>this.backend.setSyncData(t),"setSyncData"),this.getOutOfBandMembers=this.degradable(t=>this.backend.getOutOfBandMembers(t),"getOutOfBandMembers"),this.setOutOfBandMembers=this.degradable((t,n)=>(super.setOutOfBandMembers(t,n),this.backend.setOutOfBandMembers(t,n)),"setOutOfBandMembers"),this.clearOutOfBandMembers=this.degradable(t=>(super.clearOutOfBandMembers(t),this.backend.clearOutOfBandMembers(t)),"clearOutOfBandMembers"),this.getClientOptions=this.degradable(()=>this.backend.getClientOptions(),"getClientOptions"),this.storeClientOptions=this.degradable(t=>(super.storeClientOptions(t),this.backend.storeClientOptions(t)),"storeClientOptions"),!s.indexedDB)throw new Error("Missing required option: indexedDB");this.backend=s.workerFactory?new _.RemoteIndexedDBStoreBackend(s.workerFactory,s.dbName):new E.LocalIndexedDBStoreBackend(s.indexedDB,s.dbName)}startup(){return this.startedUp?(g.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(g.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then(()=>(g.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(s=>{g.logger.log("IndexedDBStore.startup: processing presence events"),s.forEach(([t,n])=>{const o=new d.User(t);n&&o.setPresenceEvent(new u.MatrixEvent(n)),this.userModifiedMap[o.userId]=o.getLastModifiedTime(),this.storeUser(o)})}))}wantsSave(){return Date.now()-this.syncTs>3e5}save(s=!1){return s||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(s,t){const n=t?super[t]:null;return(...o)=>R(this,void 0,void 0,function*(){try{return yield s.call(this,...o)}catch(h){g.logger.error("IndexedDBStore failure, degrading to MemoryStore",h),this.emitter.emit("degraded",h);try{g.logger.log("IndexedDBStore trying to delete degraded data"),yield this.backend.clearDatabase(),g.logger.log("IndexedDBStore delete after degrading succeeded")}catch(l){g.logger.warn("IndexedDBStore delete after degrading failed",l)}if(n)return n.call(this,...o)}})}getPendingEvents(s){const t=Object.create(null,{getPendingEvents:{get:()=>super.getPendingEvents}});return R(this,void 0,void 0,function*(){if(!this.localStorage)return t.getPendingEvents.call(this,s);const n=this.localStorage.getItem(i(s));if(n)try{return JSON.parse(n)}catch(o){g.logger.error("Could not parse persisted pending events",o)}return[]})}setPendingEvents(s,t){const n=Object.create(null,{setPendingEvents:{get:()=>super.setPendingEvents}});return R(this,void 0,void 0,function*(){if(!this.localStorage)return n.setPendingEvents.call(this,s,t);t.length>0?this.localStorage.setItem(i(s),JSON.stringify(t)):this.localStorage.removeItem(i(s))})}saveToDeviceBatches(s){return this.backend.saveToDeviceBatches(s)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(s){return this.backend.removeToDeviceBatch(s)}}},{"../logger":365,"../models/event":374,"../models/typed-event-emitter":385,"../models/user":386,"./indexeddb-local-backend":394,"./indexeddb-remote-backend":395,"./memory":397}],397:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(u,g,f,v){return new(f||(f=Promise))(function(i,r){function s(o){try{n(v.next(o))}catch(h){r(h)}}function t(o){try{n(v.throw(o))}catch(h){r(h)}}function n(o){o.done?i(o.value):function c(i){return i instanceof f?i:new f(function(r){r(i)})}(o.value).then(s,t)}n((v=v.apply(u,g||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MemoryStore=void 0;const I=m("../models/user"),E=m("../models/room-state");function _(u){return"string"==typeof u&&!!u&&"undefined"!==u&&"null"!==u||"number"==typeof u}a.MemoryStore=class d{constructor(g={}){this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.oobMembers={},this.pendingEvents={},this.pendingToDeviceBatches=[],this.nextToDeviceBatchId=0,this.onRoomMember=(f,v,c)=>{if("invite"===c.membership)return;const i=this.users[c.userId]||new I.User(c.userId);c.name&&(i.setDisplayName(c.name),c.events.member&&i.setRawDisplayName(c.events.member.getDirectionalContent().displayname)),c.events.member&&c.events.member.getContent().avatar_url&&i.setAvatarUrl(c.events.member.getContent().avatar_url),this.users[i.userId]=i},this.localStorage=g.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(g){this.syncToken=g}storeRoom(g){this.rooms[g.roomId]=g,g.currentState.on(E.RoomStateEvent.Members,this.onRoomMember),g.currentState.getMembers().forEach(f=>{this.onRoomMember(null,g.currentState,f)})}getRoom(g){return this.rooms[g]||null}getRooms(){return Object.values(this.rooms)}removeRoom(g){this.rooms[g]&&this.rooms[g].currentState.removeListener(E.RoomStateEvent.Members,this.onRoomMember),delete this.rooms[g]}getRoomSummaries(){return Object.values(this.rooms).map(function(g){return g.summary})}storeUser(g){this.users[g.userId]=g}getUser(g){return this.users[g]||null}getUsers(){return Object.values(this.users)}scrollback(g,f){return[]}storeEvents(g,f,v,c){}storeFilter(g){!g?.userId||!g?.filterId||(this.filters[g.userId]||(this.filters[g.userId]={}),this.filters[g.userId][g.filterId]=g)}getFilter(g,f){return this.filters[g]&&this.filters[g][f]?this.filters[g][f]:null}getFilterIdByName(g){if(!this.localStorage)return null;const f="mxjssdk_memory_filter_"+g;try{const v=this.localStorage.getItem(f);if(_(v))return v}catch{}return null}setFilterIdByName(g,f){if(!this.localStorage)return;const v="mxjssdk_memory_filter_"+g;try{_(f)?this.localStorage.setItem(v,f):this.localStorage.removeItem(v)}catch{}}storeAccountDataEvents(g){g.forEach(f=>{this.accountData[f.getType()]=f})}getAccountData(g){return this.accountData[g]}setSyncData(g){return Promise.resolve()}wantsSave(){return!1}save(g){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}getOutOfBandMembers(g){return Promise.resolve(this.oobMembers[g]||null)}setOutOfBandMembers(g,f){return this.oobMembers[g]=f,Promise.resolve()}clearOutOfBandMembers(g){return this.oobMembers={},Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(g){return this.clientOptions=Object.assign({},g),Promise.resolve()}getPendingEvents(g){var f;return R(this,void 0,void 0,function*(){return null!==(f=this.pendingEvents[g])&&void 0!==f?f:[]})}setPendingEvents(g,f){return R(this,void 0,void 0,function*(){this.pendingEvents[g]=f})}saveToDeviceBatches(g){for(const f of g)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:f.eventType,txnId:f.txnId,batch:f.batch});return Promise.resolve()}getOldestToDeviceBatch(){return R(this,void 0,void 0,function*(){return 0===this.pendingToDeviceBatches.length?null:this.pendingToDeviceBatches[0]})}removeToDeviceBatch(g){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(f=>f.id!==g),Promise.resolve()}}},{"../models/room-state":380,"../models/user":386}],398:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(E,_,d,u){return new(d||(d=Promise))(function(f,v){function c(s){try{r(u.next(s))}catch(t){v(t)}}function i(s){try{r(u.throw(s))}catch(t){v(t)}}function r(s){s.done?f(s.value):function g(f){return f instanceof d?f:new d(function(v){v(f)})}(s.value).then(c,i)}r((u=u.apply(E,_||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.StubStore=void 0,a.StubStore=class I{constructor(){this.accountData={},this.fromToken=null}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(_){this.fromToken=_}storeRoom(_){}getRoom(_){return null}getRooms(){return[]}removeRoom(_){}getRoomSummaries(){return[]}storeUser(_){}getUser(_){return null}getUsers(){return[]}scrollback(_,d){return[]}storeEvents(_,d,u,g){}storeFilter(_){}getFilter(_,d){return null}getFilterIdByName(_){return null}setFilterIdByName(_,d){}storeAccountDataEvents(_){}getAccountData(_){}setSyncData(_){return Promise.resolve()}wantsSave(){return!1}save(){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(_,d){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(_){return Promise.resolve()}getPendingEvents(_){return R(this,void 0,void 0,function*(){return[]})}setPendingEvents(_,d){return Promise.resolve()}saveToDeviceBatches(_){return R(this,void 0,void 0,function*(){return Promise.resolve()})}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(_){return R(this,void 0,void 0,function*(){return Promise.resolve()})}}},{}],399:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SyncAccumulator=a.Category=void 0;const R=m("./logger"),I=m("./utils"),E=m("./@types/event"),_=m("./@types/read_receipts"),d=m("./@types/sync");var u,c;function v(c,i){null==i.state_key||!i.type||(c[i.type]||(c[i.type]=Object.create(null)),c[i.type][i.state_key]=i)}(c=u=a.Category||(a.Category={})).Invite="invite",c.Leave="leave",c.Join="join",a.SyncAccumulator=class f{constructor(i={}){this.opts=i,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(i,r=!1){this.accumulateRooms(i,r),this.accumulateAccountData(i),this.nextBatch=i.next_batch}accumulateAccountData(i){!i.account_data||!i.account_data.events||i.account_data.events.forEach(r=>{this.accountData[r.type]=r})}accumulateRooms(i,r=!1){i.rooms&&(i.rooms.invite&&Object.keys(i.rooms.invite).forEach(s=>{this.accumulateRoom(s,u.Invite,i.rooms.invite[s],r)}),i.rooms.join&&Object.keys(i.rooms.join).forEach(s=>{this.accumulateRoom(s,u.Join,i.rooms.join[s],r)}),i.rooms.leave&&Object.keys(i.rooms.leave).forEach(s=>{this.accumulateRoom(s,u.Leave,i.rooms.leave[s],r)}))}accumulateRoom(i,r,s,t=!1){switch(r){case u.Invite:this.accumulateInviteState(i,s);break;case u.Join:this.inviteRooms[i]&&delete this.inviteRooms[i],this.accumulateJoinState(i,s,t);break;case u.Leave:this.inviteRooms[i]?delete this.inviteRooms[i]:delete this.joinRooms[i];break;default:R.logger.error("Unknown cateogory: ",r)}}accumulateInviteState(i,r){if(!r.invite_state||!r.invite_state.events)return;if(!this.inviteRooms[i])return void(this.inviteRooms[i]={invite_state:r.invite_state});const s=this.inviteRooms[i];r.invite_state.events.forEach(t=>{let n=!1;for(let o=0;o<s.invite_state.events.length;o++){const h=s.invite_state.events[o];h.type===t.type&&h.state_key==t.state_key&&(s.invite_state.events[o]=t,n=!0)}n||s.invite_state.events.push(t)})}accumulateJoinState(i,r,s=!1){var t,n,o,h,l,e,p,b;this.joinRooms[i]||(this.joinRooms[i]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_readReceipts:{},_threadReadReceipts:{}});const y=this.joinRooms[i];if(r.account_data&&r.account_data.events&&r.account_data.events.forEach(w=>{y._accountData[w.type]=w}),r.unread_notifications&&(y._unreadNotifications=r.unread_notifications),y._unreadThreadNotifications=null!==(n=null!==(t=r[d.UNREAD_THREAD_NOTIFICATIONS.stable])&&void 0!==t?t:r[d.UNREAD_THREAD_NOTIFICATIONS.unstable])&&void 0!==n?n:void 0,r.summary){const w="m.heroes",x="m.invited_member_count",B="m.joined_member_count",J=y._summary,z=r.summary;J[w]=z[w]||J[w],J[B]=z[B]||J[B],J[x]=z[x]||J[x]}if(null===(h=null===(o=r.ephemeral)||void 0===o?void 0:o.events)||void 0===h||h.forEach(w=>{w.type!==E.EventType.Receipt||!w.content||Object.keys(w.content).forEach(x=>{Object.entries(w.content[x]).forEach(([B,J])=>{var z;if((0,I.isSupportedReceiptType)(B))for(const M of Object.keys(J)){const L=w.content[x][B][M],j={data:w.content[x][B][M],type:B,eventId:x};L.thread_id&&L.thread_id!==_.MAIN_ROOM_TIMELINE?y._threadReadReceipts=Object.assign(Object.assign({},y._threadReadReceipts),{[L.thread_id]:Object.assign(Object.assign({},null!==(z=y._threadReadReceipts[L.thread_id])&&void 0!==z?z:{}),{[M]:j})}):y._readReceipts[M]=j}})})}),r.timeline&&r.timeline.limited&&(y._timeline=[]),null===(e=null===(l=r.state)||void 0===l?void 0:l.events)||void 0===e||e.forEach(w=>{v(y._currentState,w)}),null===(b=null===(p=r.timeline)||void 0===p?void 0:p.events)||void 0===b||b.forEach((w,x)=>{var B;let J;if(v(y._currentState,w),s)J=w;else{J=Object.assign({},w),void 0!==J.unsigned&&(J.unsigned=Object.assign({},J.unsigned));const z=w.unsigned?w.unsigned.age:w.age;void 0!==z&&(J._localTs=Date.now()-z)}y._timeline.push({event:J,token:0===x&&null!==(B=r.timeline.prev_batch)&&void 0!==B?B:null})}),y._timeline.length>this.opts.maxTimelineEntries)for(let x=y._timeline.length-this.opts.maxTimelineEntries;x<y._timeline.length;x++)if(y._timeline[x].token){y._timeline=y._timeline.slice(x,y._timeline.length);break}}getJSON(i=!1){const r={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach(t=>{r.invite[t]=this.inviteRooms[t]}),Object.keys(this.joinRooms).forEach(t=>{const n=this.joinRooms[t],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:n._unreadNotifications,unread_thread_notifications:n._unreadThreadNotifications,summary:n._summary};Object.keys(n._accountData).forEach(e=>{o.account_data.events.push(n._accountData[e])});const h={type:E.EventType.Receipt,room_id:t,content:{}};for(const[e,p]of Object.entries(n._readReceipts))h.content[p.eventId]||(h.content[p.eventId]={}),h.content[p.eventId][p.type]||(h.content[p.eventId][p.type]={}),h.content[p.eventId][p.type][e]=p.data;for(const e of Object.values(n._threadReadReceipts))for(const[p,b]of Object.entries(e))h.content[b.eventId]||(h.content[b.eventId]={}),h.content[b.eventId][b.type]||(h.content[b.eventId][b.type]={}),h.content[b.eventId][b.type][p]=b.data;Object.keys(h.content).length>0&&o.ephemeral.events.push(h),n._timeline.forEach(e=>{if(!o.timeline.prev_batch){if(!e.token)return;o.timeline.prev_batch=e.token}let p;!i&&function g(c){return"_localTs"in c&&void 0!==c._localTs}(e.event)?(p=Object.assign({},e.event),void 0!==p.unsigned&&(p.unsigned=Object.assign({},p.unsigned)),delete p._localTs,p.unsigned=p.unsigned||{},p.unsigned.age=Date.now()-e.event._localTs):p=e.event,o.timeline.events.push(p)});const l=Object.create(null);for(let e=o.timeline.events.length-1;e>=0;e--){const p=o.timeline.events[e];if(null==p.state_key)continue;const b=(0,I.deepCopy)(p);b.unsigned&&(b.unsigned.prev_content&&(b.content=b.unsigned.prev_content),b.unsigned.prev_sender&&(b.sender=b.unsigned.prev_sender)),v(l,b)}Object.keys(n._currentState).forEach(e=>{Object.keys(n._currentState[e]).forEach(p=>{let b=n._currentState[e][p];l[e]&&l[e][p]&&(b=l[e][p]),o.state.events.push(b)})}),r.join[t]=o});const s=[];return Object.keys(this.accountData).forEach(t=>{s.push(this.accountData[t])}),{nextBatch:this.nextBatch,roomsData:r,accountData:s}}getNextBatchToken(){return this.nextBatch}}},{"./@types/event":299,"./@types/read_receipts":303,"./@types/sync":306,"./logger":365,"./utils":402}],400:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(V,N,T,S){void 0===S&&(S=T);var U=Object.getOwnPropertyDescriptor(N,T);(!U||("get"in U?!N.__esModule:U.writable||U.configurable))&&(U={enumerable:!0,get:function(){return N[T]}}),Object.defineProperty(V,S,U)}:function(V,N,T,S){void 0===S&&(S=T),V[S]=N[T]}),E=this&&this.__setModuleDefault||(Object.create?function(V,N){Object.defineProperty(V,"default",{enumerable:!0,value:N})}:function(V,N){V.default=N}),_=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var N={};if(null!=V)for(var T in V)"default"!==T&&Object.prototype.hasOwnProperty.call(V,T)&&I(N,V,T);return E(N,V),N},d=this&&this.__awaiter||function(V,N,T,S){return new(T||(T=Promise))(function(W,k){function D(ae){try{ee(S.next(ae))}catch(ue){k(ue)}}function Q(ae){try{ee(S.throw(ae))}catch(ue){k(ue)}}function ee(ae){ae.done?W(ae.value):function U(W){return W instanceof T?W:new T(function(k){k(W)})}(ae.value).then(D,Q)}ee((S=S.apply(V,N||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a._createAndReEmitRoom=a.SyncApi=a.SyncState=void 0;const u=m("./models/user"),g=m("./models/room"),f=_(m("./utils")),v=m("./filter"),c=m("./models/event-timeline"),i=m("./pushprocessor"),r=m("./logger"),s=m("./errors"),t=m("./client"),n=m("./http-api"),o=m("./@types/event"),h=m("./models/room-state"),l=m("./models/room-member"),e=m("./models/beacon"),p=m("./@types/sync"),b=m("./feature"),y=!0;var B,V;(V=B=a.SyncState||(a.SyncState={})).Error="ERROR",V.Prepared="PREPARED",V.Stopped="STOPPED",V.Syncing="SYNCING",V.Catchup="CATCHUP",V.Reconnecting="RECONNECTING";const J=["org.matrix.msc2716v3"];function z(V,N){return`FILTER_SYNC_${V}`+(N?"_"+N:"")}function M(...V){y&&r.logger.log(...V)}var L;function C(V,N){const T=new u.User(N);return V.reEmitter.reEmit(T,[u.UserEvent.AvatarUrl,u.UserEvent.DisplayName,u.UserEvent.Presence,u.UserEvent.CurrentlyActive,u.UserEvent.LastPresenceTs]),T}function F(V,N,T){const{timelineSupport:S}=V,U=new g.Room(N,V,V.getUserId(),{lazyLoadMembers:T.lazyLoadMembers,pendingEventOrdering:T.pendingEventOrdering,timelineSupport:S});return V.reEmitter.reEmit(U,[g.RoomEvent.Name,g.RoomEvent.Redaction,g.RoomEvent.RedactionCancelled,g.RoomEvent.Receipt,g.RoomEvent.Tags,g.RoomEvent.LocalEchoUpdated,g.RoomEvent.AccountData,g.RoomEvent.MyMembership,g.RoomEvent.Timeline,g.RoomEvent.TimelineReset,h.RoomStateEvent.Events,h.RoomStateEvent.Members,h.RoomStateEvent.NewMember,h.RoomStateEvent.Update,e.BeaconEvent.New,e.BeaconEvent.Update,e.BeaconEvent.Destroy,e.BeaconEvent.LivenessChange]),U.on(h.RoomStateEvent.NewMember,(W,k,D)=>{var Q;D.user=null!==(Q=V.getUser(D.userId))&&void 0!==Q?Q:void 0,V.reEmitter.reEmit(D,[l.RoomMemberEvent.Name,l.RoomMemberEvent.Typing,l.RoomMemberEvent.PowerLevel,l.RoomMemberEvent.Membership])}),U}!function(V){V.Offline="offline",V.Online="online",V.Unavailable="unavailable"}(L||(L={})),a.SyncApi=class j{constructor(N,T={}){var S;this.client=N,this.opts=T,this._peekRoom=null,this.syncState=null,this.catchingUp=!1,this.running=!1,this.notifEvents=[],this.failedSyncCount=0,this.storeIsInvalid=!1,this.getPushRules=()=>d(this,void 0,void 0,function*(){try{M("Getting push rules...");const U=yield this.client.getPushRules();M("Got push rules"),this.client.pushRules=U}catch(U){return r.logger.error("Getting push rules failed",U),this.shouldAbortSync(U)?void 0:(M("Waiting for saved sync before retrying push rules..."),yield this.recoverFromSyncStartupError(this.savedSyncPromise,U),this.getPushRules())}}),this.buildDefaultFilter=()=>{const U=new v.Filter(this.client.credentials.userId);return this.client.canSupport.get(b.Feature.ThreadUnreadNotifications)!==b.ServerSupport.Unsupported&&U.setUnreadThreadNotifications(!0),U},this.checkLazyLoadStatus=()=>d(this,void 0,void 0,function*(){var U;if(M("Checking lazy load status..."),this.opts.lazyLoadMembers&&this.client.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(M("Checking server lazy load support..."),(yield this.client.doesServerSupportLazyLoading())?(M("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=this.buildDefaultFilter()),this.opts.filter.setLazyLoadMembers(!0)):(M("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)),M("Checking whether lazy loading has changed in store..."),yield this.wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this.storeIsInvalid=!0;const k=new s.InvalidStoreError(s.InvalidStoreState.ToggledLazyLoading,!!this.opts.lazyLoadMembers);return this.updateSyncState(B.Error,{error:k}),void r.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&(null===(U=this.opts.crypto)||void 0===U||U.enableLazyLoading());try{M("Storing client options..."),yield this.client.storeClientOptions(),M("Stored client options")}catch(k){throw r.logger.error("Storing client options failed",k),k}}),this.getFilter=()=>d(this,void 0,void 0,function*(){let U,W;M("Getting filter..."),U=this.opts.filter?this.opts.filter:this.buildDefaultFilter();try{W=yield this.client.getOrCreateFilter(z(this.client.credentials.userId),U)}catch(k){return r.logger.error("Getting filter failed",k),this.shouldAbortSync(k)?{}:(M("Waiting for saved sync before retrying filter..."),yield this.recoverFromSyncStartupError(this.savedSyncPromise,k),this.getFilter())}return{filter:U,filterId:W}}),this.onOnline=()=>{M("Browser thinks we are back online"),this.startKeepAlives(0)},this.opts.initialSyncLimit=null!==(S=this.opts.initialSyncLimit)&&void 0!==S?S:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||t.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,T.canResetEntireTimeline||(T.canResetEntireTimeline=U=>!1),N.getNotifTimelineSet()&&N.reEmitter.reEmit(N.getNotifTimelineSet(),[g.RoomEvent.Timeline,g.RoomEvent.TimelineReset])}createRoom(N){const T=F(this.client,N,this.opts);return T.on(h.RoomStateEvent.Marker,(S,U)=>{this.onMarkerStateEvent(T,S,U)}),T}onMarkerStateEvent(N,T,{timelineWasEmpty:S}={}){S?r.logger.debug(`MarkerState: Ignoring markerEventId=${T.getId()} in roomId=${N.roomId} because the timeline was empty before the marker arrived which means there is nothing to refresh.`):J.includes(N.getVersion())||T.getSender()===N.getCreator()?(r.logger.debug(`MarkerState: Timeline needs to be refreshed because a new markerEventId=${T.getId()} was sent in roomId=${N.roomId}`),N.setTimelineNeedsRefresh(!0),N.emit(g.RoomEvent.HistoryImportedWithinTimeline,T,N)):r.logger.debug(`MarkerState: Ignoring markerEventId=${T.getId()} in roomId=${N.roomId} because MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.`)}syncLeftRooms(){var N;return d(this,void 0,void 0,function*(){const T=this.client,S=new v.Filter(this.client.credentials.userId);S.setTimelineLimit(1),S.setIncludeLeaveRooms(!0);const U=this.opts.pollTimeout+8e4,k={timeout:0,filter:yield T.getOrCreateFilter(z(T.credentials.userId,"LEFT_ROOMS"),S)},D=yield T.http.authedRequest(n.Method.Get,"/sync",k,void 0,{localTimeoutMs:U});let Q=[];return!(null===(N=D.rooms)||void 0===N)&&N.leave&&(Q=this.mapSyncResponseToRoomArray(D.rooms.leave)),(yield Promise.all(Q.map(ae=>d(this,void 0,void 0,function*(){const ue=ae.room;if(!ae.isBrandNewRoom)return;ae.timeline=ae.timeline||{prev_batch:null,events:[]};const be=this.mapSyncEventsFormat(ae.timeline,ue),X=this.mapSyncEventsFormat(ae.state,ue);return ue.getLiveTimeline().setPaginationToken(ae.timeline.prev_batch,c.EventTimeline.BACKWARDS),yield this.injectRoomEvents(ue,X,be),ue.recalculate(),T.store.storeRoom(ue),T.emit(t.ClientEvent.Room,ue),this.processEventsForNotifs(ue,be),ue})))).filter(Boolean)})}peek(N){var T;if((null===(T=this._peekRoom)||void 0===T?void 0:T.roomId)===N)return Promise.resolve(this._peekRoom);const S=this.client;return this._peekRoom=this.createRoom(N),this.client.roomInitialSync(N,20).then(U=>{U.messages=U.messages||{chunk:[]},U.messages.chunk=U.messages.chunk||[],U.state=U.state||[];const W=f.deepCopy(U.state).map(S.getEventMapper()),k=U.state.map(S.getEventMapper()),D=U.messages.chunk.map(S.getEventMapper());return Array.isArray(U.presence)&&U.presence.map(S.getEventMapper()).forEach(function(Q){let ee=S.store.getUser(Q.getContent().user_id);ee?ee.setPresenceEvent(Q):(ee=C(S,Q.getContent().user_id),ee.setPresenceEvent(Q),S.store.storeUser(ee)),S.emit(t.ClientEvent.Event,Q)}),U.messages.start&&(this._peekRoom.oldState.paginationToken=U.messages.start),this._peekRoom.oldState.setStateEvents(W),this._peekRoom.currentState.setStateEvents(k),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(D.reverse(),!0,this._peekRoom.getLiveTimeline(),U.messages.start),S.store.storeRoom(this._peekRoom),S.emit(t.ClientEvent.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(N,T){var S;this._peekRoom===N?this.client.http.authedRequest(n.Method.Get,"/events",{room_id:N.roomId,timeout:String(3e4),from:T},void 0,{localTimeoutMs:5e4,abortSignal:null===(S=this.abortController)||void 0===S?void 0:S.signal}).then(U=>{if(this._peekRoom!==N)return void M("Stopped peeking in room %s",N.roomId);U.chunk.filter(function(k){return"m.presence"===k.type}).map(this.client.getEventMapper()).forEach(k=>{let D=this.client.store.getUser(k.getContent().user_id);D?D.setPresenceEvent(k):(D=C(this.client,k.getContent().user_id),D.setPresenceEvent(k),this.client.store.storeUser(D)),this.client.emit(t.ClientEvent.Event,k)});const W=U.chunk.filter(function(k){return k.room_id===N.roomId&&k.event_id}).map(this.client.getEventMapper());N.addLiveEvents(W),this.peekPoll(N,U.end)},U=>{r.logger.error("[%s] Peek poll failed: %s",N.roomId,U),setTimeout(()=>{this.peekPoll(N,T)},3e4)}):M("Stopped peeking in room %s",N.roomId)}getSyncState(){return this.syncState}getSyncStateData(){var N;return null!==(N=this.syncStateData)&&void 0!==N?N:null}recoverFromSyncStartupError(N,T){return d(this,void 0,void 0,function*(){yield N;const S=this.startKeepAlives();this.updateSyncState(B.Error,{error:T}),yield S})}wasLazyLoadingToggled(N=!1){return d(this,void 0,void 0,function*(){let T=!1;if(!(yield this.client.store.isNewlyCreated())){const U=yield this.client.store.getClientOptions();return U&&(T=!!U.lazyLoadMembers),T!==N}return!1})}shouldAbortSync(N){return"M_UNKNOWN_TOKEN"===N.errcode&&(r.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(B.Error,{error:N}),!0)}sync(){var N,T;return d(this,void 0,void 0,function*(){if(this.running=!0,this.abortController=new AbortController,null===(T=null===(N=R.window)||void 0===N?void 0:N.addEventListener)||void 0===T||T.call(N,"online",this.onOnline,!1),this.client.isGuest())return this.doSync({});M("Getting saved sync token...");const S=this.client.store.getSavedSyncToken().then(k=>(M("Got saved sync token"),k));this.savedSyncPromise=this.client.store.getSavedSync().then(k=>{if(M(`Got reply from saved sync, exists? ${!!k}`),k)return this.syncFromCache(k)}).catch(k=>{r.logger.error("Getting saved sync failed",k)}),yield this.getPushRules(),yield this.checkLazyLoadStatus();const{filterId:U,filter:W}=yield this.getFilter();if(W){if(this.client.resetNotifTimelineSet(),!this.currentSyncRequest){let k=U;const D=yield S;if(D)M("Sending first sync request...");else{M("Sending initial sync request...");const Q=this.buildDefaultFilter();Q.setDefinition(W.getDefinition()),Q.setTimelineLimit(this.opts.initialSyncLimit),k=JSON.stringify(Q.getDefinition())}this.currentSyncRequest=this.doSyncRequest({filter:k},D)}return M("Waiting for saved sync before starting sync processing..."),yield this.savedSyncPromise,this.doSync({filter:U})}})}stop(){var N,T,S;M("SyncApi.stop"),null===(T=null===(N=R.window)||void 0===N?void 0:N.removeEventListener)||void 0===T||T.call(N,"online",this.onOnline,!1),this.running=!1,null===(S=this.abortController)||void 0===S||S.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}syncFromCache(N){return d(this,void 0,void 0,function*(){M("sync(): not doing HTTP hit, instead returning stored /sync data");const T=N.nextBatch;this.client.store.setSyncToken(T);const S={nextSyncToken:T,catchingUp:!1,fromCache:!0},U={next_batch:T,rooms:N.roomsData,account_data:{events:N.accountData}};try{yield this.processSyncResponse(S,U)}catch(W){r.logger.error("Error processing cached sync",W)}this.storeIsInvalid||this.updateSyncState(B.Prepared,S)})}doSync(N){return d(this,void 0,void 0,function*(){for(;this.running;){const T=this.client.store.getSyncToken();let S;try{this.currentSyncRequest||(this.currentSyncRequest=this.doSyncRequest(N,T)),S=yield this.currentSyncRequest}catch(W){if(yield this.onSyncError(W))return;continue}finally{this.currentSyncRequest=void 0}this.client.store.setSyncToken(S.next_batch),this.failedSyncCount=0,yield this.client.store.setSyncData(S);const U={oldSyncToken:T??void 0,nextSyncToken:S.next_batch,catchingUp:this.catchingUp};this.opts.crypto&&(yield this.opts.crypto.onSyncWillProcess(U));try{yield this.processSyncResponse(U,S)}catch(W){r.logger.error("Caught /sync error",W),this.client.emit(t.ClientEvent.SyncUnexpectedError,W)}U.catchingUp=this.catchingUp,N.hasSyncedBefore||(this.updateSyncState(B.Prepared,U),N.hasSyncedBefore=!0),this.opts.crypto&&(yield this.opts.crypto.onSyncCompleted(U)),this.updateSyncState(B.Syncing,U),this.client.store.wantsSave()&&(this.opts.crypto&&(yield this.opts.crypto.saveDeviceList(0)),this.client.store.save())}this.running||(M("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState(B.Stopped))})}doSyncRequest(N,T){var S;const U=this.getSyncParams(N,T);return this.client.http.authedRequest(n.Method.Get,"/sync",U,void 0,{localTimeoutMs:U.timeout+8e4,abortSignal:null===(S=this.abortController)||void 0===S?void 0:S.signal})}getSyncParams(N,T){let S=this.opts.pollTimeout;(this.getSyncState()!==B.Syncing||this.catchingUp)&&(this.catchingUp=!0,S=0);let U=N.filter;this.client.isGuest()&&!U&&(U=this.getGuestFilter());const W={filter:U,timeout:S};return this.opts.disablePresence&&(W.set_presence=L.Offline),T?W.since=T:W._cacheBuster=Date.now(),[B.Reconnecting,B.Error].includes(this.getSyncState())&&(W.timeout=0),W}onSyncError(N){return d(this,void 0,void 0,function*(){if(!this.running)return M("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState(B.Stopped),!0;if(r.logger.error("/sync error %s",N),this.shouldAbortSync(N))return!0;this.failedSyncCount++,r.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),M("Starting keep-alive");const T=this.startKeepAlives();return this.currentSyncRequest=void 0,this.updateSyncState(this.failedSyncCount>=3?B.Error:B.Reconnecting,{error:N}),(yield T)&&this.getSyncState()===B.Error&&this.updateSyncState(B.Catchup,{catchingUp:!0}),!1})}processSyncResponse(N,T){var S,U,W;return d(this,void 0,void 0,function*(){const k=this.client;if(Array.isArray(null===(S=T.presence)||void 0===S?void 0:S.events)&&T.presence.events.map(k.getEventMapper()).forEach(function(ae){let ue=k.store.getUser(ae.getSender());ue?ue.setPresenceEvent(ae):(ue=C(k,ae.getSender()),ue.setPresenceEvent(ae),k.store.storeUser(ue)),k.emit(t.ClientEvent.Event,ae)}),Array.isArray(null===(U=T.account_data)||void 0===U?void 0:U.events)){const ae=T.account_data.events.map(k.getEventMapper()),ue=ae.reduce((be,X)=>(be[X.getType()]=k.store.getAccountData(X.getType()),be),{});k.store.storeAccountDataEvents(ae),ae.forEach(function(be){if(be.getType()===o.EventType.PushRules){const H=be.getContent();k.pushRules=i.PushProcessor.rewriteDefaultRules(H)}const X=ue[be.getType()];return k.emit(t.ClientEvent.AccountData,be,X),be})}if(Array.isArray(null===(W=T.to_device)||void 0===W?void 0:W.events)&&T.to_device.events.length>0){const ae=[];T.to_device.events.filter(ue=>{var be;return!(ue.type===o.EventType.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes(null===(be=ue.content)||void 0===be?void 0:be.algorithm)&&(r.logger.log("Ignoring invalid encrypted to-device event from "+ue.sender),1))}).map(k.getEventMapper({toDevice:!0})).map(ue=>{if("m.key.verification.cancel"===ue.getType()){const be=ue.getContent().transaction_id;be&&ae.push(be)}return ue}).forEach(function(ue){const be=ue.getContent();"m.room.message"!=ue.getType()||"m.bad.encrypted"!=be.msgtype?("m.key.verification.start"!==ue.getType()&&"m.key.verification.request"!==ue.getType()||ae.includes(be.transaction_id)&&ue.flagCancelled(),k.emit(t.ClientEvent.ToDeviceEvent,ue)):r.logger.log("Ignoring undecryptable to-device event from "+ue.getSender())})}else this.catchingUp=!1;let D=[],Q=[],ee=[];if(T.rooms&&(T.rooms.invite&&(D=this.mapSyncResponseToRoomArray(T.rooms.invite)),T.rooms.join&&(Q=this.mapSyncResponseToRoomArray(T.rooms.join)),T.rooms.leave&&(ee=this.mapSyncResponseToRoomArray(T.rooms.leave))),this.notifEvents=[],yield f.promiseMapSeries(D,ae=>d(this,void 0,void 0,function*(){var ue;const be=ae.room,X=this.mapSyncEventsFormat(ae.invite_state,be);yield this.injectRoomEvents(be,X);const H=null===(ue=be.currentState.getStateEvents(o.EventType.RoomMember,k.getUserId()))||void 0===ue?void 0:ue.getSender();if(k.isCryptoEnabled()){const ne=yield k.crypto.cryptoStore.takeParkedSharedHistory(be.roomId);for(const ce of ne)ce.senderId===H&&(yield k.crypto.olmDevice.addInboundGroupSession(be.roomId,ce.senderKey,ce.forwardingCurve25519KeyChain,ce.sessionId,ce.sessionKey,ce.keysClaimed,!0,{sharedHistory:!0,untrusted:!0}))}ae.isBrandNewRoom?(be.recalculate(),k.store.storeRoom(be),k.emit(t.ClientEvent.Room,be)):be.recalculate(),X.forEach(function(ne){k.emit(t.ClientEvent.Event,ne)})})),yield f.promiseMapSeries(Q,ae=>d(this,void 0,void 0,function*(){var ue,be,X,H,ne,ce;const te=ae.room,P=this.mapSyncEventsFormat(ae.state,te),A=this.mapSyncEventsFormat(ae.timeline,te,!1),$=this.mapSyncEventsFormat(ae.ephemeral),G=this.mapSyncEventsFormat(ae.account_data),se=k.isRoomEncrypted(te.roomId);ae.unread_notifications&&(te.setUnreadNotificationCount(g.NotificationCountType.Total,null!==(ue=ae.unread_notifications.notification_count)&&void 0!==ue?ue:0),(!se||te.getUnreadNotificationCount(g.NotificationCountType.Highlight)<=0)&&te.setUnreadNotificationCount(g.NotificationCountType.Highlight,null!==(be=ae.unread_notifications.highlight_count)&&void 0!==be?be:0));const he=null!==(X=ae[p.UNREAD_THREAD_NOTIFICATIONS.name])&&void 0!==X?X:ae[p.UNREAD_THREAD_NOTIFICATIONS.altName];if(he){te.resetThreadUnreadNotificationCount(Object.keys(he));for(const[me,Ee]of Object.entries(he)){te.setThreadUnreadNotificationCount(me,g.NotificationCountType.Total,null!==(H=Ee.notification_count)&&void 0!==H?H:0);const _e=te.getThreadUnreadNotificationCount(me,g.NotificationCountType.Highlight)<=0;(!se||se&&_e)&&te.setThreadUnreadNotificationCount(me,g.NotificationCountType.Highlight,null!==(ne=Ee.highlight_count)&&void 0!==ne?ne:0)}}else te.resetThreadUnreadNotificationCount();if(ae.timeline=ae.timeline||{},ae.isBrandNewRoom)null!==ae.timeline.prev_batch&&te.getLiveTimeline().setPaginationToken(ae.timeline.prev_batch,c.EventTimeline.BACKWARDS);else if(ae.timeline.limited){let me=!0;for(let Ee=A.length-1;Ee>=0;Ee--){const _e=A[Ee].getId();if(te.getTimelineForEvent(_e)){M(`Already have event ${_e} in limited sync - not resetting`),me=!1,A.splice(0,Ee);break}}me&&(te.resetLiveTimeline(ae.timeline.prev_batch,this.opts.canResetEntireTimeline(te.roomId)?null:null!==(ce=N.oldSyncToken)&&void 0!==ce?ce:null),k.resetNotifTimelineSet())}if(this.opts.crypto)for(const me of P.concat(A))me.isState()&&me.getType()===o.EventType.RoomEncryption&&""===me.getStateKey()&&(yield this.opts.crypto.onCryptoEvent(te,me));try{yield this.injectRoomEvents(te,P,A,N.fromCache)}catch(me){r.logger.error(`Failed to process events on room ${te.roomId}:`,me)}ae.summary&&te.setSummary(ae.summary),te.addEphemeralEvents($),te.addAccountData(G),te.recalculate(),ae.isBrandNewRoom&&(k.store.storeRoom(te),k.emit(t.ClientEvent.Room,te)),this.processEventsForNotifs(te,A);const pe=me=>k.emit(t.ClientEvent.Event,me);P.forEach(pe),A.forEach(pe),$.forEach(pe),G.forEach(pe),te.decryptCriticalEvents()})),yield f.promiseMapSeries(ee,ae=>d(this,void 0,void 0,function*(){const ue=ae.room,be=this.mapSyncEventsFormat(ae.state,ue),X=this.mapSyncEventsFormat(ae.timeline,ue),H=this.mapSyncEventsFormat(ae.account_data);yield this.injectRoomEvents(ue,be,X),ue.addAccountData(H),ue.recalculate(),ae.isBrandNewRoom&&(k.store.storeRoom(ue),k.emit(t.ClientEvent.Room,ue)),this.processEventsForNotifs(ue,X),be.forEach(function(ne){k.emit(t.ClientEvent.Event,ne)}),X.forEach(function(ne){k.emit(t.ClientEvent.Event,ne)}),H.forEach(function(ne){k.emit(t.ClientEvent.Event,ne)})})),N.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort(function(ae,ue){return ae.getTs()-ue.getTs()}),this.notifEvents.forEach(function(ae){var ue;null===(ue=k.getNotifTimelineSet())||void 0===ue||ue.addLiveEvent(ae)})),T.device_lists&&this.opts.crypto&&(yield this.opts.crypto.handleDeviceListChanges(N,T.device_lists)),this.opts.crypto&&T.device_one_time_keys_count&&this.opts.crypto.updateOneTimeKeyCount(T.device_one_time_keys_count.signed_curve25519||0),this.opts.crypto&&(T.device_unused_fallback_key_types||T["org.matrix.msc2732.device_unused_fallback_key_types"])){const ae=T.device_unused_fallback_key_types||T["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(Array.isArray(ae)&&!ae.includes("signed_curve25519"))}})}startKeepAlives(N){return void 0===N&&(N=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),N>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),N):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=f.defer()),this.connectionReturnedDefer.promise}pokeKeepAlive(N=!1){var T;const S=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(N),this.connectionReturnedDefer=void 0)};this.client.http.request(n.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(T=this.abortController)||void 0===T?void 0:T.signal}).then(()=>{S()},U=>{400==U.httpStatus||404==U.httpStatus?this.keepAliveTimer=setTimeout(S,2e3):(N=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,N),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(B.Error,{error:U}))})}mapSyncResponseToRoomArray(N){const T=this.client;return Object.keys(N).map(S=>{const U=N[S];let W=T.store.getRoom(S),k=!1;return W||(W=this.createRoom(S),k=!0),U.room=W,U.isBrandNewRoom=k,U})}mapSyncEventsFormat(N,T,S=!0){if(!N||!Array.isArray(N.events))return[];const U=this.client.getEventMapper({decrypt:S});return N.events.map(function(W){return T&&(W.room_id=T.roomId),U(W)})}resolveInvites(N){if(!N||!this.opts.resolveInvitesToProfiles)return;const T=this.client;N.getMembersWithMembership("invite").forEach(function(S){if(S.requestedProfileInfo)return;S.requestedProfileInfo=!0;const U=T.getUser(S.userId);let W;W=U?Promise.resolve({avatar_url:U.avatarUrl,displayname:U.displayName}):T.getProfileInfo(S.userId),W.then(function(k){const D=S.events.member;"invite"===D?.getContent().membership&&(D.getContent().avatar_url=k.avatar_url,D.getContent().displayname=k.displayname,S.setMembershipEvent(D,N.currentState))},function(k){})})}injectRoomEvents(N,T,S,U=!1){return d(this,void 0,void 0,function*(){const W=N.getLiveTimeline(),k=0==W.getEvents().length;if(k){for(const D of T)this.client.getPushActionsForEvent(D);W.initialiseState(T,{timelineWasEmpty:k})}this.resolveInvites(N),N.recalculate(),k||(N.oldState.setStateEvents(T||[]),N.currentState.setStateEvents(T||[])),N.addLiveEvents(S||[],{fromCache:U,timelineWasEmpty:k}),this.client.processBeaconEvents(N,S)})}processEventsForNotifs(N,T){var S;if(this.client.getNotifTimelineSet())for(const U of T){const W=this.client.getPushActionsForEvent(U);W?.notify&&null!==(S=W.tweaks)&&void 0!==S&&S.highlight&&this.notifEvents.push(U)}}getGuestFilter(){return"{}"}updateSyncState(N,T){const S=this.syncState;this.syncState=N,this.syncStateData=T,this.client.emit(t.ClientEvent.Sync,this.syncState,S,T)}},a._createAndReEmitRoom=F}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./@types/event":299,"./@types/sync":306,"./client":313,"./errors":351,"./feature":353,"./filter":355,"./http-api":358,"./logger":365,"./models/beacon":369,"./models/event-timeline":373,"./models/room":382,"./models/room-member":379,"./models/room-state":380,"./models/user":386,"./pushprocessor":387,"./utils":402}],401:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(v,c,i,r){return new(i||(i=Promise))(function(t,n){function o(e){try{l(r.next(e))}catch(p){n(p)}}function h(e){try{l(r.throw(e))}catch(p){n(p)}}function l(e){e.done?t(e.value):function s(t){return t instanceof i?t:new i(function(n){n(t)})}(e.value).then(o,h)}l((r=r.apply(v,c||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.TimelineIndex=a.TimelineWindow=void 0;const I=m("./models/event-timeline"),d=(m("./logger"),function(){});a.TimelineWindow=class g{constructor(c,i,r={}){this.client=c,this.timelineSet=i,this.eventCount=0,this.windowLimit=r.windowLimit||1e3}load(c,i=20){const r=s=>{if(!s)throw new Error("No timeline given to initFields");let t;const n=s.getEvents();if(c){if(t=n.findIndex(l=>l.getId()===c),t<0)throw new Error("getEventTimeline result didn't include requested event")}else t=n.length;const o=Math.min(n.length,t+Math.ceil(i/2)),h=Math.max(0,o-i);this.start=new f(s,h-s.getBaseIndex()),this.end=new f(s,o-s.getBaseIndex()),this.eventCount=o-h};return this.timelineSet.getTimelineForEvent(c)?(r(this.timelineSet.getTimelineForEvent(c)),Promise.resolve()):c?this.client.getEventTimeline(this.timelineSet,c).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(c){var i,r;if(c==I.EventTimeline.BACKWARDS)return null!==(i=this.start)&&void 0!==i?i:null;if(c==I.EventTimeline.FORWARDS)return null!==(r=this.end)&&void 0!==r?r:null;throw new Error("Invalid direction '"+c+"'")}extend(c,i){const r=this.getTimelineIndex(c);if(!r)return d("TimelineWindow: no timeline yet"),!1;const s=c==I.EventTimeline.BACKWARDS?r.retreat(i):r.advance(i);if(s){this.eventCount+=s,d("TimelineWindow: increased cap by "+s+" (now "+this.eventCount+")");const t=this.eventCount-this.windowLimit;return t>0&&this.unpaginate(t,c!=I.EventTimeline.BACKWARDS),!0}return!1}canPaginate(c){const i=this.getTimelineIndex(c);if(!i)return d("TimelineWindow: no timeline yet"),!1;if(c==I.EventTimeline.BACKWARDS){if(i.index>i.minIndex())return!0}else if(i.index<i.maxIndex())return!0;const r=i.timeline.getNeighbouringTimeline(c),s=i.timeline.getPaginationToken(c);return Boolean(r)||Boolean(s)}paginate(c,i,r=!0,s=5){return R(this,void 0,void 0,function*(){const t=this.getTimelineIndex(c);if(!t)return d("TimelineWindow: no timeline yet"),!1;if(t.pendingPaginate)return t.pendingPaginate;if(this.extend(c,i))return!0;if(!r||0===s)return!1;if(!t.timeline.getPaginationToken(c))return d("TimelineWindow: no token"),!1;d("TimelineWindow: starting request");const o=this.client.paginateEventTimeline(t.timeline,{backwards:c==I.EventTimeline.BACKWARDS,limit:i}).finally(function(){t.pendingPaginate=void 0}).then(h=>(d("TimelineWindow: request completed with result "+h),h?this.paginate(c,i,!0,s-1):this.paginate(c,i,!1,0)));return t.pendingPaginate=o,o})}unpaginate(c,i){const r=i?this.start:this.end;if(!r)throw new Error(`Attempting to unpaginate startOfTimeline=${i} but don't have this direction`);if(c>this.eventCount||c<0)throw new Error(`Attemting to unpaginate ${c} events, but only have ${this.eventCount} in the timeline`);for(;c>0;){const s=i?r.advance(c):r.retreat(c);if(s<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");c-=s,this.eventCount-=s,d("TimelineWindow.unpaginate: dropped "+s+" (now "+this.eventCount+")")}}getEvents(){var c,i;if(!this.start)return[];const r=[];let s=this.start.timeline;for(;;){const t=s.getEvents();let n=0,o=t.length;s===this.start.timeline&&(n=this.start.index+s.getBaseIndex()),s===(null===(c=this.end)||void 0===c?void 0:c.timeline)&&(o=this.end.index+s.getBaseIndex());for(let h=n;h<o;h++)r.push(t[h]);if(s===(null===(i=this.end)||void 0===i?void 0:i.timeline))break;s=s.getNeighbouringTimeline(I.EventTimeline.FORWARDS)}return r}};class f{constructor(c,i){this.timeline=c,this.index=i}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(c){if(!c)return 0;let i;if(c<0){if(i=Math.max(c,this.minIndex()-this.index),i<0)return this.index+=i,i}else if(i=Math.min(c,this.maxIndex()-this.index),i>0)return this.index+=i,i;const r=this.timeline.getNeighbouringTimeline(c<0?I.EventTimeline.BACKWARDS:I.EventTimeline.FORWARDS);return r?(this.timeline=r,this.index=c<0?this.maxIndex():this.minIndex(),d("paginate: switched to new neighbour"),this.advance(c)):0}retreat(c){return-1*this.advance(-1*c)}}a.TimelineIndex=f},{"./logger":365,"./models/event-timeline":373}],402:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(ne,ce,te,P){return new(te||(te=Promise))(function($,G){function se(me){try{pe(P.next(me))}catch(Ee){G(Ee)}}function he(me){try{pe(P.throw(me))}catch(Ee){G(Ee)}}function pe(me){me.done?$(me.value):function A($){return $ instanceof te?$:new te(function(G){G($)})}(me.value).then(se,he)}pe((P=P.apply(ne,ce||[])).next())})},I=this&&this.__importDefault||function(ne){return ne&&ne.__esModule?ne:{default:ne}};Object.defineProperty(a,"__esModule",{value:!0}),a.mapsEqual=a.isSupportedReceiptType=a.sortEventsByLatestContentTimestamp=a.recursivelyAssign=a.compare=a.lexicographicCompare=a.prevString=a.nextString=a.averageBetweenStrings=a.stringToBase=a.baseToString=a.alphabetPad=a.DEFAULT_ALPHABET=a.simpleRetryOperation=a.chunkPromises=a.promiseTry=a.promiseMapSeries=a.defer=a.isNullOrUndefined=a.sleep=a.ensureNoTrailingSlash=a.globToRegexp=a.escapeRegExp=a.normalize=a.removeDirectionOverrideChars=a.removeHiddenChars=a.isNumber=a.deepSortedObjectEntries=a.deepCompare=a.deepCopy=a.checkObjectHasKeys=a.isFunction=a.removeElement=a.encodeUri=a.decodeParams=a.replaceParam=a.encodeParams=a.internaliseString=void 0;const E=I(m("unhomoglyph")),_=I(m("p-retry")),d=m("./@types/location"),u=m("./@types/read_receipts"),g=new Map;function p(ne){return"string"==typeof ne?(0,E.default)(ne.normalize("NFD").replace(w,"")):""}a.internaliseString=function f(ne){return ne instanceof String&&(ne=ne.toString()),g.has(ne)||g.set(ne,ne),g.get(ne)},a.encodeParams=function v(ne,ce){const te=ce??new URLSearchParams;for(const[P,A]of Object.entries(ne))null!=A&&(Array.isArray(A)?A.forEach($=>{te.append(P,String($))}):te.append(P,String(A)));return te},a.replaceParam=function c(ne,ce,te){const P=Object.assign(Object.assign({},te),{[ce]:te[ne]});return delete P[ne],P},a.decodeParams=function i(ne){const ce={},te=new URLSearchParams(ne);for(const P of te.keys()){const A=te.getAll(P);ce[P]=1===A.length?A[0]:A}return ce},a.encodeUri=function r(ne,ce){for(const te in ce){if(!ce.hasOwnProperty(te))continue;const P=ce[te];null!=P&&(ne=ne.replace(te,encodeURIComponent(P)))}return ne},a.removeElement=function s(ne,ce,te){let P;if(te){for(P=ne.length-1;P>=0;P--)if(ce(ne[P],P,ne))return ne.splice(P,1),!0}else for(P=0;P<ne.length;P++)if(ce(ne[P],P,ne))return ne.splice(P,1),!0;return!1},a.isFunction=function t(ne){return"[object Function]"===Object.prototype.toString.call(ne)},a.checkObjectHasKeys=function n(ne,ce){for(const te of ce)if(!ne.hasOwnProperty(te))throw new Error("Missing required key: "+te)},a.deepCopy=function o(ne){return JSON.parse(JSON.stringify(ne))},a.deepCompare=function h(ne,ce){if(ne===ce)return!0;if(typeof ne!=typeof ce)return!1;if("number"==typeof ne&&isNaN(ne)&&isNaN(ce))return!0;if(null===ne||null===ce)return ne===ce;if(!(ne instanceof Object)||ne.constructor!==ce.constructor||ne.prototype!==ce.prototype)return!1;if(ne instanceof RegExp||ne instanceof Date)return ne.toString()===ce.toString();if(Array.isArray(ne)){if(ne.length!==ce.length)return!1;for(let te=0;te<ne.length;te++)if(!h(ne[te],ce[te]))return!1}else{for(const te in ce)if(ce.hasOwnProperty(te)!==ne.hasOwnProperty(te))return!1;for(const te in ne)if(ce.hasOwnProperty(te)!==ne.hasOwnProperty(te)||!h(ne[te],ce[te]))return!1}return!0},a.deepSortedObjectEntries=function l(ne){if("object"!=typeof ne||null==ne||Array.isArray(ne))return ne;const ce=[];for(const[te,P]of Object.entries(ne))ce.push([te,l(P)]);return ce.sort((te,P)=>D(te[0],P[0])),ce},a.isNumber=function e(ne){return"number"==typeof ne&&isFinite(ne)},a.removeHiddenChars=p,a.removeDirectionOverrideChars=function b(ne){return"string"==typeof ne?ne.replace(/[\u202d-\u202e]/g,""):""},a.normalize=function y(ne){return p(ne.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()};const w=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function x(ne){return ne.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function N(ne,ce,te=a.DEFAULT_ALPHABET){return ne.padEnd(ce,te[0])}function T(ne,ce=a.DEFAULT_ALPHABET){var te;const P=BigInt(ce.length);if(ne<=P)return null!==(te=ce[Number(ne)-1])&&void 0!==te?te:"";let A=ne/P,$=Number(ne%P)-1;return $<0&&(A-=BigInt(Math.abs($)),$=Number(P)-1),T(A,ce)+ce[$]}function S(ne,ce=a.DEFAULT_ALPHABET){const te=BigInt(ce.length);let P=BigInt(0);for(let A=ne.length-1,$=BigInt(0);A>=0;A--,$++){const G=ne.charCodeAt(A)-ce.charCodeAt(0);P+=BigInt(1+G)*te**$}return P}function D(ne,ce){return ne<ce?-1:ne>ce?1:0}a.escapeRegExp=x,a.globToRegexp=function B(ne,ce=!1){const te=[[/\\\*/g,".*"],[/\?/g,"."]];return ce||te.push([/\\\[(!|)(.*)\\]/g,(P,A,$)=>["[",A?"^":"",$.replace(/\\-/,"-"),"]"].join("")]),te.reduce((P,A)=>A?P.replace(A[0],A[1]):P,x(ne))},a.ensureNoTrailingSlash=function J(ne){return ne?.endsWith("/")?ne.slice(0,-1):ne},a.sleep=function z(ne,ce){return new Promise(te=>{setTimeout(te,ne,ce)})},a.isNullOrUndefined=function M(ne){return null==ne},a.defer=function L(){let ne,ce;const te=new Promise((P,A)=>{ne=P,ce=A});return{resolve:ne,reject:ce,promise:te}},a.promiseMapSeries=function j(ne,ce){return R(this,void 0,void 0,function*(){for(const te of ne)yield ce(yield te)})},a.promiseTry=function C(ne){return Promise.resolve(ne())},a.chunkPromises=function F(ne,ce){return R(this,void 0,void 0,function*(){const te=[];for(let P=0;P<ne.length;P+=ce)te.push(...yield Promise.all(ne.slice(P,P+ce).map(A=>A())));return te})},a.simpleRetryOperation=function V(ne){return(0,_.default)(ce=>ne(ce),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},a.DEFAULT_ALPHABET=(()=>{let ne="";for(let ce=32;ce<=126;ce++)ne+=String.fromCharCode(ce);return ne})(),a.alphabetPad=N,a.baseToString=T,a.stringToBase=S,a.averageBetweenStrings=function U(ne,ce,te=a.DEFAULT_ALPHABET){const P=Math.max(ne.length,ce.length),A=S(N(ne,P,te),te),$=S(N(ce,P,te),te),G=(A+$)/BigInt(2);return G===A||G==$?T(G,te)+te[0]:T(G,te)},a.nextString=function W(ne,ce=a.DEFAULT_ALPHABET){return T(S(ne,ce)+BigInt(1),ce)},a.prevString=function k(ne,ce=a.DEFAULT_ALPHABET){return T(S(ne,ce)-BigInt(1),ce)},a.lexicographicCompare=D;const Q=new Intl.Collator;function ue(ne){var ce;return null!==(ce=d.M_TIMESTAMP.findIn(ne.getContent()))&&void 0!==ce?ce:-1}a.compare=function ee(ne,ce){return Q.compare(ne,ce)},a.recursivelyAssign=function ae(ne,ce,te=!1){for(const[P,A]of Object.entries(ce))ne[P]instanceof Object&&A?ae(ne[P],A):null==A&&te||(ne[P]=A);return ne},a.sortEventsByLatestContentTimestamp=function be(ne,ce){return ue(ce)-ue(ne)},a.isSupportedReceiptType=function X(ne){return[u.ReceiptType.Read,u.ReceiptType.ReadPrivate].includes(ne)},a.mapsEqual=function H(ne,ce,te=((P,A)=>P===A)){if(ne.size!==ce.size)return!1;for(const[P,A]of ne){const $=ce.get(P);if(void 0===$||!te(A,$))return!1}return!0}},{"./@types/location":301,"./@types/read_receipts":303,"p-retry":225,unhomoglyph:281}],403:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.releaseContext=a.acquireContext=void 0;let R=null,I=0;a.acquireContext=()=>(null===R&&(R=new AudioContext),I++,R),a.releaseContext=()=>{I--,0===I&&(R?.close(),R=null)}},{}],404:[function(m,ie,a){(function(R){(function(){"use strict";var I=this&&this.__createBinding||(Object.create?function(k,D,Q,ee){void 0===ee&&(ee=Q);var ae=Object.getOwnPropertyDescriptor(D,Q);(!ae||("get"in ae?!D.__esModule:ae.writable||ae.configurable))&&(ae={enumerable:!0,get:function(){return D[Q]}}),Object.defineProperty(k,ee,ae)}:function(k,D,Q,ee){void 0===ee&&(ee=Q),k[ee]=D[Q]}),E=this&&this.__setModuleDefault||(Object.create?function(k,D){Object.defineProperty(k,"default",{enumerable:!0,value:D})}:function(k,D){k.default=D}),_=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var D={};if(null!=k)for(var Q in k)"default"!==Q&&Object.prototype.hasOwnProperty.call(k,Q)&&I(D,k,Q);return E(D,k),D},d=this&&this.__awaiter||function(k,D,Q,ee){return new(Q||(Q=Promise))(function(ue,be){function X(ce){try{ne(ee.next(ce))}catch(te){be(te)}}function H(ce){try{ne(ee.throw(ce))}catch(te){be(te)}}function ne(ce){ce.done?ue(ce.value):function ae(ue){return ue instanceof Q?ue:new Q(function(be){be(ue)})}(ce.value).then(X,H)}ne((ee=ee.apply(k,D||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.createNewMatrixCall=a.supportsMatrixCall=a.setTracksEnabled=a.MatrixCall=a.genCallID=a.CallError=a.CallErrorCode=a.CallEvent=a.CallParty=a.CallDirection=a.CallType=a.CallState=void 0;const u=m("uuid"),g=m("sdp-transform"),f=m("../logger"),v=_(m("../utils")),c=m("../@types/event"),i=m("../randomstring"),r=m("./callEventTypes"),s=m("./callFeed"),t=m("../models/typed-event-emitter"),n=m("../crypto/deviceinfo"),o=m("./groupCall"),h=m("../http-api");var l,k,e,p,b,y,w,x,B;(k=l||(l={})).AUDIO="audio",k.VIDEO="video",function(k){k.OPUS="opus"}(e||(e={})),function(k){k.Fledgling="fledgling",k.InviteSent="invite_sent",k.WaitLocalMedia="wait_local_media",k.CreateOffer="create_offer",k.CreateAnswer="create_answer",k.Connecting="connecting",k.Connected="connected",k.Ringing="ringing",k.Ended="ended"}(p=a.CallState||(a.CallState={})),function(k){k.Voice="voice",k.Video="video"}(b=a.CallType||(a.CallType={})),function(k){k.Inbound="inbound",k.Outbound="outbound"}(y=a.CallDirection||(a.CallDirection={})),function(k){k.Local="local",k.Remote="remote"}(w=a.CallParty||(a.CallParty={})),function(k){k.Hangup="hangup",k.State="state",k.Error="error",k.Replaced="replaced",k.LocalHoldUnhold="local_hold_unhold",k.RemoteHoldUnhold="remote_hold_unhold",k.HoldUnhold="hold_unhold",k.FeedsChanged="feeds_changed",k.AssertedIdentityChanged="asserted_identity_changed",k.LengthChanged="length_changed",k.DataChannel="datachannel",k.SendVoipEvent="send_voip_event"}(x=a.CallEvent||(a.CallEvent={})),function(k){k.UserHangup="user_hangup",k.LocalOfferFailed="local_offer_failed",k.NoUserMedia="no_user_media",k.UnknownDevices="unknown_devices",k.SendInvite="send_invite",k.CreateAnswer="create_answer",k.CreateOffer="create_offer",k.SendAnswer="send_answer",k.SetRemoteDescription="set_remote_description",k.SetLocalDescription="set_local_description",k.AnsweredElsewhere="answered_elsewhere",k.IceFailed="ice_failed",k.InviteTimeout="invite_timeout",k.Replaced="replaced",k.SignallingFailed="signalling_timeout",k.UserBusy="user_busy",k.Transfered="transferred",k.NewSession="new_session"}(B=a.CallErrorCode||(a.CallErrorCode={}));class C extends Error{constructor(D,Q,ee){super(Q+": "+ee),this.code=D}}function F(){return Date.now().toString()+(0,i.randomString)(16)}function V(k){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:k?12e3:void 0}]}function N(k,D){return k+":"+D}a.CallError=C,a.genCallID=F;class T extends t.TypedEventEmitter{constructor(D){var Q;if(super(),this.toDeviceSeq=0,this.isPtt=!1,this._state=p.Fledgling,this.candidateSendQueue=[],this.candidateSendTries=0,this.candidatesEnded=!1,this.feeds=[],this.transceivers=new Map,this.inviteOrAnswerSent=!1,this.waitForLocalAVStream=!1,this.removeTrackListeners=new Map,this.remoteOnHold=!1,this.makingOffer=!1,this.ignoreOffer=!1,this.remoteCandidateBuffer=new Map,this.gotLocalIceCandidate=ee=>{if(ee.candidate){if(this.candidatesEnded)return void f.logger.warn("Got candidate after candidates have ended - ignoring!");if(f.logger.debug("Call "+this.callId+" got local ICE "+ee.candidate.sdpMid+" candidate: "+ee.candidate.candidate),this.callHasEnded())return;this.queueCandidate(""===ee.candidate.candidate?null:ee.candidate)}},this.onIceGatheringStateChange=ee=>{var ae;f.logger.debug(`Call ${this.callId} ice gathering state changed to  ${this.peerConn.iceGatheringState}`),"complete"===(null===(ae=this.peerConn)||void 0===ae?void 0:ae.iceGatheringState)&&this.queueCandidate(null)},this.getLocalOfferFailed=ee=>{f.logger.error(`Call ${this.callId} Failed to get local offer`,ee),this.emit(x.Error,new C(B.LocalOfferFailed,"Failed to get local offer!",ee)),this.terminate(w.Local,B.LocalOfferFailed,!1)},this.getUserMediaFailed=ee=>{this.successor?this.successor.getUserMediaFailed(ee):(f.logger.warn(`Failed to get user media - ending call ${this.callId}`,ee),this.emit(x.Error,new C(B.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",ee)),this.terminate(w.Local,B.NoUserMedia,!1))},this.onIceConnectionStateChanged=()=>{var ee,ae,ue,be,X,H;if(!this.callHasEnded()&&(f.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+(null===(ee=this.peerConn)||void 0===ee?void 0:ee.iceConnectionState)),["connected","completed"].includes(null!==(ue=null===(ae=this.peerConn)||void 0===ae?void 0:ae.iceConnectionState)&&void 0!==ue?ue:"")?(clearTimeout(this.iceDisconnectedTimeout),this.state=p.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit(x.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3))},1e3))):"failed"==(null===(be=this.peerConn)||void 0===be?void 0:be.iceConnectionState)?null!==(X=this.peerConn)&&void 0!==X&&X.restartIce?(this.candidatesEnded=!1,this.peerConn.restartIce()):(f.logger.info(`Hanging up call ${this.callId} (ICE failed and no ICE restart method)`),this.hangup(B.IceFailed,!1)):"disconnected"==(null===(H=this.peerConn)||void 0===H?void 0:H.iceConnectionState)&&(this.iceDisconnectedTimeout=setTimeout(()=>{f.logger.info(`Hanging up call ${this.callId} (ICE disconnected for too long)`),this.hangup(B.IceFailed,!1)},3e4),this.state=p.Connecting),this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState)))for(const ne of this.getRemoteFeeds())ne.setAudioVideoMuted(!0,!0)},this.onSignallingStateChanged=()=>{var ee;f.logger.debug(`call ${this.callId}: Signalling state changed to: ${null===(ee=this.peerConn)||void 0===ee?void 0:ee.signalingState}`)},this.onTrack=ee=>{if(0===ee.streams.length)return void f.logger.warn(`Call ${this.callId} Streamless ${ee.track.kind} found: ignoring.`);const ae=ee.streams[0];if(this.pushRemoteFeed(ae),!this.removeTrackListeners.has(ae)){const ue=()=>{0===ae.getTracks().length&&(f.logger.info(`Call ${this.callId} removing track streamId: ${ae.id}`),this.deleteFeedByStream(ae),ae.removeEventListener("removetrack",ue),this.removeTrackListeners.delete(ae))};ae.addEventListener("removetrack",ue),this.removeTrackListeners.set(ae,ue)}},this.onDataChannel=ee=>{this.emit(x.DataChannel,ee.channel)},this.onNegotiationNeeded=()=>d(this,void 0,void 0,function*(){f.logger.info(`Call ${this.callId} Negotiation is needed!`),this.state===p.CreateOffer||0!==this.opponentVersion?this.queueGotLocalOffer():f.logger.info(`Call ${this.callId} Opponent does not support renegotiation: ignoring negotiationneeded event`)}),this.onHangupReceived=ee=>{f.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(ee)||this.state===p.Ringing?this.terminate(w.Remote,ee.reason||B.UserHangup,!0):f.logger.info(`Call ${this.callId} Ignoring message from party ID ${ee.party_id}: our partner is ${this.opponentPartyId}`)},this.onRejectReceived=ee=>{f.logger.debug("Reject received for call ID "+this.callId),[p.InviteSent,p.Ringing].includes(this.state)||this.state===p.Fledgling&&this.direction===y.Inbound?this.terminate(w.Remote,ee.reason||B.UserHangup,!0):f.logger.debug(`Call ${this.callId} is in state: ${this.state}: ignoring reject`)},this.onAnsweredElsewhere=ee=>{f.logger.debug("Call "+this.callId+" answered elsewhere"),this.terminate(w.Remote,B.AnsweredElsewhere,!0)},this.roomId=D.roomId,this.invitee=D.invitee,this.client=D.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=null!==(Q=D.forceTURN)&&void 0!==Q&&Q,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=D.opponentDeviceId,this.opponentSessionId=D.opponentSessionId,this.groupCallId=D.groupCallId,this.turnServers=D.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const ee of this.turnServers)v.checkObjectHasKeys(ee,["urls"]);this.callId=F()}placeVoiceCall(){return d(this,void 0,void 0,function*(){yield this.placeCall(!0,!1)})}placeVideoCall(){return d(this,void 0,void 0,function*(){yield this.placeCall(!0,!0)})}createDataChannel(D,Q){const ee=this.peerConn.createDataChannel(D,Q);return this.emit(x.DataChannel,ee),ee}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(D){const Q=this._state;this._state=D,this.emit(x.State,D,Q)}get type(){return this.hasLocalUserMediaVideoTrack||this.hasRemoteUserMediaVideoTrack?b.Video:b.Voice}get hasLocalUserMediaVideoTrack(){var D;return!(null===(D=this.localUsermediaStream)||void 0===D||!D.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(D=>{var Q;return D.purpose===r.SDPStreamMetadataPurpose.Usermedia&&(null===(Q=D.stream)||void 0===Q?void 0:Q.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var D;return!(null===(D=this.localUsermediaStream)||void 0===D||!D.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(D=>{var Q;return D.purpose===r.SDPStreamMetadataPurpose.Usermedia&&!(null===(Q=D.stream)||void 0===Q||!Q.getAudioTracks().length)})}get localUsermediaFeed(){return this.getLocalFeeds().find(D=>D.purpose===r.SDPStreamMetadataPurpose.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(D=>D.purpose===r.SDPStreamMetadataPurpose.Screenshare)}get localUsermediaStream(){var D;return null===(D=this.localUsermediaFeed)||void 0===D?void 0:D.stream}get localScreensharingStream(){var D;return null===(D=this.localScreensharingFeed)||void 0===D?void 0:D.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(D=>D.purpose===r.SDPStreamMetadataPurpose.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(D=>D.purpose===r.SDPStreamMetadataPurpose.Screenshare)}get remoteUsermediaStream(){var D;return null===(D=this.remoteUsermediaFeed)||void 0===D?void 0:D.stream}get remoteScreensharingStream(){var D;return null===(D=this.remoteScreensharingFeed)||void 0===D?void 0:D.stream}getFeedByStreamId(D){return this.getFeeds().find(Q=>Q.stream.id===D)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(D=>D.isLocal())}getRemoteFeeds(){return this.feeds.filter(D=>!D.isLocal())}initOpponentCrypto(){var D;return d(this,void 0,void 0,function*(){if(!this.opponentDeviceId||!this.client.getUseE2eForGroupCall())return;if(!this.client.isCryptoEnabled())return void(this.opponentDeviceInfo=new n.DeviceInfo(this.opponentDeviceId));if(!this.client.crypto)throw new Error("Crypto is not initialised.");const Q=this.invitee||(null===(D=this.getOpponentMember())||void 0===D?void 0:D.userId);if(!Q)throw new Error("Couldn't find opponent user ID to init crypto");const ee=yield this.client.crypto.deviceList.downloadKeys([Q],!1);if(this.opponentDeviceInfo=ee[Q][this.opponentDeviceId],void 0===this.opponentDeviceInfo)throw new o.GroupCallUnknownDeviceError(Q)})}getLocalSDPStreamMetadata(D=!1){const Q={};for(const ee of this.getLocalFeeds())D&&(ee.sdpMetadataStreamId=ee.stream.id),Q[ee.sdpMetadataStreamId]={purpose:ee.purpose,audio_muted:ee.isAudioMuted(),video_muted:ee.isVideoMuted()};return Q}noIncomingFeeds(){return!this.feeds.some(D=>!D.isLocal())}pushRemoteFeed(D){if(!this.opponentSupportsSDPStreamMetadata())return void this.pushRemoteFeedWithoutMetadata(D);const Q=this.getOpponentMember().userId,ee=this.remoteSDPStreamMetadata[D.id].purpose,ae=this.remoteSDPStreamMetadata[D.id].audio_muted,ue=this.remoteSDPStreamMetadata[D.id].video_muted;ee?this.getFeedByStreamId(D.id)?f.logger.warn(`Ignoring stream with id ${D.id} because we already have a feed for it`):(this.feeds.push(new s.CallFeed({client:this.client,call:this,roomId:this.roomId,userId:Q,deviceId:this.getOpponentDeviceId(),stream:D,purpose:ee,audioMuted:ae,videoMuted:ue})),this.emit(x.FeedsChanged,this.feeds),f.logger.info(`Call ${this.callId} pushed remote stream (id="${D.id}", active="${D.active}", purpose=${ee})`)):f.logger.warn(`Call ${this.callId} Ignoring stream with id ${D.id} because we didn't get any metadata about it`)}pushRemoteFeedWithoutMetadata(D){var Q;const ee=this.getOpponentMember().userId,ae=r.SDPStreamMetadataPurpose.Usermedia,ue=null===(Q=this.feeds.find(be=>!be.isLocal()))||void 0===Q?void 0:Q.stream;ue&&D.id!==ue.id?f.logger.warn(`Call ${this.callId} Ignoring new stream ID ${D.id}: we already have stream ID ${ue.id}`):this.getFeedByStreamId(D.id)?f.logger.warn(`Ignoring stream with id ${D.id} because we already have a feed for it`):(this.feeds.push(new s.CallFeed({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:ee,deviceId:this.getOpponentDeviceId(),stream:D,purpose:ae})),this.emit(x.FeedsChanged,this.feeds),f.logger.info(`Call ${this.callId} pushed remote stream (id="${D.id}", active="${D.active}")`))}pushNewLocalFeed(D,Q,ee=!0){const ae=this.client.getUserId();S(D.getAudioTracks(),!0),S(D.getVideoTracks(),!0),this.getFeedByStreamId(D.id)?f.logger.warn(`Ignoring stream with id ${D.id} because we already have a feed for it`):this.pushLocalFeed(new s.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:ae,deviceId:this.getOpponentDeviceId(),stream:D,purpose:Q}),ee)}pushLocalFeed(D,Q=!0){if(this.feeds.some(ee=>D.stream.id===ee.stream.id))f.logger.info(`Ignoring duplicate local stream ${D.stream.id} in call ${this.callId}`);else{if(this.feeds.push(D),Q)for(const ee of D.stream.getTracks()){f.logger.info(`Call ${this.callId} Adding track (id="${ee.id}", kind="${ee.kind}", streamId="${D.stream.id}", streamPurpose="${D.purpose}", enabled=${ee.enabled}) to peer connection`);const ae=N(D.purpose,ee.kind);if(this.transceivers.has(ae)){const ue=this.transceivers.get(ae);ue.sender.setStreams&&ue.sender.setStreams(D.stream),ue.sender.replaceTrack(ee),ue.direction="inactive"===ue.direction?"sendonly":"sendrecv"}else{const ue=this.peerConn.addTrack(ee,D.stream),be=this.peerConn.getTransceivers().find(X=>X.sender===ue);be?this.transceivers.set(ae,be):f.logger.warn("Didn't find a matching transceiver after adding track!")}}f.logger.info(`Call ${this.callId} Pushed local stream (id="${D.stream.id}", active="${D.stream.active}", purpose="${D.purpose}")`),this.emit(x.FeedsChanged,this.feeds)}}removeLocalFeed(D){const Q=N(D.purpose,"audio"),ee=N(D.purpose,"video");for(const ae of[Q,ee])if(this.transceivers.has(ae)){const ue=this.transceivers.get(ae);ue.sender&&this.peerConn.removeTrack(ue.sender)}D.purpose===r.SDPStreamMetadataPurpose.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(D.stream),this.deleteFeed(D)}deleteAllFeeds(){for(const D of this.feeds)(!D.isLocal()||!this.groupCallId)&&D.dispose();this.feeds=[],this.emit(x.FeedsChanged,this.feeds)}deleteFeedByStream(D){const Q=this.getFeedByStreamId(D.id);Q?this.deleteFeed(Q):f.logger.warn(`Call ${this.callId} Didn't find the feed with stream id ${D.id} to delete`)}deleteFeed(D){D.dispose(),this.feeds.splice(this.feeds.indexOf(D),1),this.emit(x.FeedsChanged,this.feeds)}getCurrentCallStats(){return d(this,void 0,void 0,function*(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()})}collectCallStats(){return d(this,void 0,void 0,function*(){if(!this.peerConn)return;const D=yield this.peerConn.getStats(),Q=[];return D.forEach(ee=>{Q.push(ee)}),Q})}initWithInvite(D){var Q;return d(this,void 0,void 0,function*(){const ee=D.getContent();this.direction=y.Inbound,(yield this.client.checkTurnServers())||f.logger.warn(`Call ${this.callId} Failed to get TURN credentials! Proceeding with call anyway...`);const ue=ee[r.SDPStreamMetadataKey];ue?this.updateRemoteSDPStreamMetadata(ue):f.logger.debug(`Call ${this.callId} did not get any SDPStreamMetadata! Can not send/receive multiple streams`),this.peerConn=this.createPeerConnection(),this.chooseOpponent(D),yield this.initOpponentCrypto();try{yield this.peerConn.setRemoteDescription(ee.offer),yield this.addBufferedIceCandidates()}catch(X){return f.logger.debug(`Call ${this.callId} failed to set remote description`,X),void this.terminate(w.Local,B.SetRemoteDescription,!1)}const be=null===(Q=this.feeds.find(X=>!X.isLocal()))||void 0===Q?void 0:Q.stream;if(!be||0===be.getTracks().length)return f.logger.error(`Call ${this.callId} no remote stream or no tracks after setting remote description!`),void this.terminate(w.Local,B.SetRemoteDescription,!1);if(this.state=p.Ringing,D.getLocalAge()){const X=setTimeout(()=>{this.state==p.Ringing&&(f.logger.debug(`Call ${this.callId} invite has expired. Hanging up.`),this.hangupParty=w.Remote,this.state=p.Ended,this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(x.Hangup,this))},ee.lifetime-D.getLocalAge()),H=ne=>{ne!==p.Ringing&&(clearTimeout(X),this.off(x.State,H))};this.on(x.State,H)}})}initWithHangup(D){this.state=p.Ended}shouldAnswerWithMediaType(D,Q,ee){return D&&!Q?(f.logger.warn(`Call ${this.callId} Unable to answer with ${ee} because the other side isn't sending it either.`),!1):v.isNullOrUndefined(D)||D===Q||this.opponentSupportsSDPStreamMetadata()?D??Q:(f.logger.warn(`Call ${this.callId} Unable to answer with ${ee}=${D} because the other side doesn't support it. Answering with ${ee}=${Q}.`),Q)}answer(D,Q){var ee;return d(this,void 0,void 0,function*(){if(!this.inviteOrAnswerSent){if(!1===D&&!1===Q)throw new Error("You CANNOT answer a call without media");if(this.localUsermediaStream||this.waitForLocalAVStream)this.waitForLocalAVStream&&(this.state=p.WaitLocalMedia);else{const ae=this.state,ue=this.shouldAnswerWithMediaType(D,this.hasRemoteUserMediaAudioTrack,"audio"),be=this.shouldAnswerWithMediaType(Q,this.hasRemoteUserMediaVideoTrack,"video");this.state=p.WaitLocalMedia,this.waitForLocalAVStream=!0;try{const X=yield this.client.getMediaHandler().getUserMediaStream(ue,be);this.waitForLocalAVStream=!1;const ne=[new s.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:null!==(ee=this.client.getDeviceId())&&void 0!==ee?ee:void 0,stream:X,purpose:r.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&ne.push(this.localScreensharingFeed),this.answerWithCallFeeds(ne)}catch(X){if(!be)return void this.getUserMediaFailed(X);f.logger.warn(`Call ${this.callId} Failed to getUserMedia(), trying to getUserMedia() without video`),this.state=ae,this.waitForLocalAVStream=!1,yield this.answer(ue,!1)}}}})}answerWithCallFeeds(D){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(D)}replacedBy(D){f.logger.debug(`Call ${this.callId} replaced by ${D.callId}`),this.state===p.WaitLocalMedia?(f.logger.debug(`Call ${this.callId} telling new call ${D.callId} to wait for local media`),D.waitForLocalAVStream=!0):[p.CreateOffer,p.InviteSent].includes(this.state)&&(D.direction===y.Outbound?D.queueGotCallFeedsForAnswer([]):(f.logger.debug(`Call ${this.callId} handing local stream to new call ${D.callId}`),D.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(Q=>Q.clone())))),this.successor=D,this.emit(x.Replaced,D),this.hangup(B.Replaced,!0)}hangup(D,Q){if(this.callHasEnded()||(f.logger.debug(`Ending call ${this.callId} with reason ${D}`),this.terminate(w.Local,D,!Q),[p.Fledgling,p.WaitLocalMedia].includes(this.state)))return;const ee={};(this.opponentVersion&&0!==this.opponentVersion||D!==B.UserHangup)&&(ee.reason=D),this.sendVoipEvent(c.EventType.CallHangup,ee)}reject(){if(this.state!==p.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return f.logger.info(`Call ${this.callId} Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(B.UserHangup,!0);f.logger.debug("Rejecting call: "+this.callId),this.terminate(w.Local,B.UserHangup,!0),this.sendVoipEvent(c.EventType.CallReject,{})}upgradeCall(D,Q){return d(this,void 0,void 0,function*(){if((D||Q)&&this.opponentSupportsSDPStreamMetadata())try{f.logger.debug(`Upgrading call ${this.callId}: audio?=${D} video?=${Q}`);const ee=D||this.hasLocalUserMediaAudioTrack,ae=Q||this.hasLocalUserMediaVideoTrack,ue=yield this.client.getMediaHandler().getUserMediaStream(ee,ae,!1);yield this.updateLocalUsermediaStream(ue,D,Q)}catch(ee){f.logger.error(`Call ${this.callId} Failed to upgrade the call`,ee),this.emit(x.Error,new C(B.NoUserMedia,"Failed to get camera access: ",ee))}})}opponentSupportsSDPStreamMetadata(){return Boolean(this.remoteSDPStreamMetadata)}isScreensharing(){return Boolean(this.localScreensharingStream)}setScreensharingEnabled(D,Q){return d(this,void 0,void 0,function*(){if(D&&this.isScreensharing())return f.logger.warn(`Call ${this.callId} There is already a screensharing stream - there is nothing to do!`),!0;if(!D&&!this.isScreensharing())return f.logger.warn(`Call ${this.callId} There already isn't a screensharing stream - there is nothing to do!`),!1;if(!this.opponentSupportsSDPStreamMetadata())return this.setScreensharingEnabledWithoutMetadataSupport(D,Q);if(f.logger.debug(`Call ${this.callId} set screensharing enabled? ${D}`),!D){const ee=this.transceivers.get(N(r.SDPStreamMetadataPurpose.Screenshare,"audio")),ae=this.transceivers.get(N(r.SDPStreamMetadataPurpose.Screenshare,"video"));for(const ue of[ee,ae])ue&&ue.sender&&this.peerConn.removeTrack(ue.sender);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const ee=yield this.client.getMediaHandler().getScreensharingStream(Q);return!!ee&&(this.pushNewLocalFeed(ee,r.SDPStreamMetadataPurpose.Screenshare),!0)}catch(ee){return f.logger.error(`Call ${this.callId} Failed to get screen-sharing stream:`,ee),!1}})}setScreensharingEnabledWithoutMetadataSupport(D,Q){var ee,ae,ue;return d(this,void 0,void 0,function*(){if(f.logger.debug(`Call ${this.callId} Set screensharing enabled? ${D} using replaceTrack()`),!D){const be=null===(ae=this.localUsermediaStream)||void 0===ae?void 0:ae.getTracks().find(H=>"video"===H.kind);return(null===(ue=this.transceivers.get(N(r.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===ue?void 0:ue.sender)?.replaceTrack(be??null),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const be=yield this.client.getMediaHandler().getScreensharingStream(Q);if(!be)return!1;const X=be.getTracks().find(ne=>"video"===ne.kind);return(null===(ee=this.transceivers.get(N(r.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===ee?void 0:ee.sender)?.replaceTrack(X??null),this.pushNewLocalFeed(be,r.SDPStreamMetadataPurpose.Screenshare,!1),!0}catch(be){return f.logger.error(`Call ${this.callId} Failed to get screen-sharing stream:`,be),!1}})}updateLocalUsermediaStream(D,Q=!1,ee=!1){var ae;return d(this,void 0,void 0,function*(){const ue=this.localUsermediaFeed,be=Q||!ue.isAudioMuted()&&!this.remoteOnHold,X=ee||!ue.isVideoMuted()&&!this.remoteOnHold;f.logger.log(`call ${this.callId} updateLocalUsermediaStream stream ${D.id} audioEnabled ${be} videoEnabled ${X}`),S(D.getAudioTracks(),be),S(D.getVideoTracks(),X);for(const H of this.localUsermediaStream.getTracks())this.localUsermediaStream.removeTrack(H),H.stop();for(const H of D.getTracks())this.localUsermediaStream.addTrack(H);for(const H of D.getTracks()){const ne=N(r.SDPStreamMetadataPurpose.Usermedia,H.kind),ce=null===(ae=this.transceivers.get(ne))||void 0===ae?void 0:ae.sender;let te=!1;if(ce)try{f.logger.info(`Call ${this.callId} Replacing track (id="${H.id}", kind="${H.kind}", streamId="${D.id}", streamPurpose="${ue.purpose}") to peer connection`),yield ce.replaceTrack(H),te=!0}catch(P){f.logger.warn("replaceTrack failed: adding new transceiver instead",P)}if(!te){f.logger.info(`Call ${this.callId} Adding track (id="${H.id}", kind="${H.kind}", streamId="${D.id}", streamPurpose="${ue.purpose}") to peer connection`);const P=this.peerConn.addTrack(H,this.localUsermediaStream),A=this.peerConn.getTransceivers().find($=>$.sender===P);A?this.transceivers.set(ne,A):f.logger.warn("Couldn't find matching transceiver for newly added track!")}}})}setLocalVideoMuted(D){var Q;return d(this,void 0,void 0,function*(){return f.logger.log(`call ${this.callId} setLocalVideoMuted ${D}`),(yield this.client.getMediaHandler().hasVideoDevice())?this.hasLocalUserMediaVideoTrack||D?(null===(Q=this.localUsermediaFeed)||void 0===Q||Q.setAudioVideoMuted(null,D),this.updateMuteStatus(),yield this.sendMetadataUpdate(),this.isLocalVideoMuted()):(yield this.upgradeCall(!1,!0),this.isLocalVideoMuted()):this.isLocalVideoMuted()})}isLocalVideoMuted(){var D,Q;return null!==(Q=null===(D=this.localUsermediaFeed)||void 0===D?void 0:D.isVideoMuted())&&void 0!==Q&&Q}setMicrophoneMuted(D){var Q;return d(this,void 0,void 0,function*(){return f.logger.log(`call ${this.callId} setMicrophoneMuted ${D}`),(yield this.client.getMediaHandler().hasAudioDevice())?this.hasLocalUserMediaAudioTrack||D?(null===(Q=this.localUsermediaFeed)||void 0===Q||Q.setAudioVideoMuted(D,null),this.updateMuteStatus(),yield this.sendMetadataUpdate(),this.isMicrophoneMuted()):(yield this.upgradeCall(!0,!1),this.isMicrophoneMuted()):this.isMicrophoneMuted()})}isMicrophoneMuted(){var D,Q;return null!==(Q=null===(D=this.localUsermediaFeed)||void 0===D?void 0:D.isAudioMuted())&&void 0!==Q&&Q}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(D){if(this.isRemoteOnHold()!==D){this.remoteOnHold=D;for(const Q of this.peerConn.getTransceivers())Q.direction=D?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(x.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==p.Connected)return!1;let D=!0;for(const Q of this.peerConn.getTransceivers())["inactive","recvonly"].includes(Q.currentDirection)||(D=!1);return D}sendDtmfDigit(D){var Q;for(const ee of this.peerConn.getSenders())if("audio"===(null===(Q=ee.track)||void 0===Q?void 0:Q.kind)&&ee.dtmf)return void ee.dtmf.insertDTMF(D);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){const D=this.isMicrophoneMuted()||this.remoteOnHold,Q=this.isLocalVideoMuted()||this.remoteOnHold;f.logger.log(`call ${this.callId} updateMuteStatus stream ${this.localUsermediaStream.id} micShouldBeMuted ${D} vidShouldBeMuted ${Q}`),S(this.localUsermediaStream.getAudioTracks(),!D),S(this.localUsermediaStream.getVideoTracks(),!Q)}sendMetadataUpdate(){return d(this,void 0,void 0,function*(){yield this.sendVoipEvent(c.EventType.CallSDPStreamMetadataChangedPrefix,{[r.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()})})}gotCallFeedsForInvite(D,Q=!1){if(this.successor)this.successor.queueGotCallFeedsForAnswer(D);else if(this.callHasEnded())this.stopAllMedia();else{for(const ee of D)this.pushLocalFeed(ee);Q&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=p.CreateOffer,f.logger.debug(`Call ${this.callId} gotUserMediaForInvite`)}}sendAnswer(){return d(this,void 0,void 0,function*(){const D={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[r.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata(!0)};D.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1};const Q=this.discardDuplicateCandidates();f.logger.info(`Call ${this.callId} Discarding ${Q} candidates that will be sent in answer`);try{yield this.sendVoipEvent(c.EventType.CallAnswer,D),this.inviteOrAnswerSent=!0}catch(ee){this.state=p.Ringing,ee instanceof h.MatrixError&&ee.event&&this.client.cancelPendingEvent(ee.event);let ae=B.SendAnswer,ue="Failed to send answer";throw"UnknownDeviceError"==ee.name&&(ae=B.UnknownDevices,ue="Unknown devices present in the room"),this.emit(x.Error,new C(ae,ue,ee)),ee}this.sendCandidateQueue()})}queueGotCallFeedsForAnswer(D){this.responsePromiseChain=this.responsePromiseChain?this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(D)):this.gotCallFeedsForAnswer(D)}mungeSdp(D,Q){const ee=(0,g.parse)(D.sdp);ee.media.forEach(ae=>{const ue=new Map,be=new Map;for(const X of ae.rtp)ue.set(X.payload,X.codec),be.set(X.codec,X.payload);for(const X of Q){if(X.mediaType!==ae.type)continue;if(!be.has(X.codec)){f.logger.info(`Ignoring SDP modifications for ${X.codec} as it's not present.`);continue}const H=[];void 0!==X.enableDtx&&H.push("usedtx="+(X.enableDtx?"1":"0")),void 0!==X.maxAverageBitrate&&H.push(`maxaveragebitrate=${X.maxAverageBitrate}`);let ne=!1;for(const ce of ae.fmtp)ue.get(ce.payload)===X.codec&&(ne=!0,ce.config+=";"+H.join(";"));ne||ae.fmtp.push({payload:be.get(X.codec),config:H.join(";")})}}),D.sdp=(0,g.write)(ee)}createOffer(){return d(this,void 0,void 0,function*(){const D=yield this.peerConn.createOffer();return this.mungeSdp(D,V(this.isPtt)),D})}createAnswer(){return d(this,void 0,void 0,function*(){const D=yield this.peerConn.createAnswer();return this.mungeSdp(D,V(this.isPtt)),D})}gotCallFeedsForAnswer(D){return d(this,void 0,void 0,function*(){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const ee of D)this.pushLocalFeed(ee);let Q;this.state=p.CreateAnswer;try{this.getRidOfRTXCodecs(),Q=yield this.createAnswer()}catch(ee){return f.logger.debug(`Call ${this.callId} Failed to create answer: `,ee),void this.terminate(w.Local,B.CreateAnswer,!0)}try{if(yield this.peerConn.setLocalDescription(Q),this.callHasEnded()||(this.state=p.Connecting,yield new Promise(ee=>{setTimeout(ee,200)}),this.callHasEnded()))return;this.sendAnswer()}catch(ee){return f.logger.debug(`Call ${this.callId} Error setting local description!`,ee),void this.terminate(w.Local,B.SetLocalDescription,!0)}})}onRemoteIceCandidatesReceived(D){return d(this,void 0,void 0,function*(){if(this.callHasEnded())return;const Q=D.getContent(),ee=Q.candidates;if(!ee)return void f.logger.info(`Call ${this.callId} Ignoring candidates event with no candidates!`);const ae=0===Q.version?null:Q.party_id||null;if(void 0!==this.opponentPartyId)this.partyIdMatches(Q)?yield this.addIceCandidates(ee):f.logger.info(`Call ${this.callId} Ignoring candidates from party ID ${Q.party_id}: we have chosen party ID ${this.opponentPartyId}`);else if(ae){f.logger.info(`Call ${this.callId} Buffering ${ee.length} candidates until we pick an opponent`);const ue=this.remoteCandidateBuffer.get(ae)||[];ue.push(...ee),this.remoteCandidateBuffer.set(ae,ue)}})}onAnswerReceived(D){return d(this,void 0,void 0,function*(){const Q=D.getContent();if(f.logger.debug(`Got answer for call ID ${this.callId} from party ID ${Q.party_id}`),this.callHasEnded())return void f.logger.debug(`Ignoring answer because call ID ${this.callId} has ended`);if(void 0!==this.opponentPartyId)return void f.logger.info(`Call ${this.callId} Ignoring answer from party ID ${Q.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);this.chooseOpponent(D),yield this.addBufferedIceCandidates(),this.state=p.Connecting;const ee=Q[r.SDPStreamMetadataKey];ee?this.updateRemoteSDPStreamMetadata(ee):f.logger.warn(`Call ${this.callId} Did not get any SDPStreamMetadata! Can not send/receive multiple streams`);try{yield this.peerConn.setRemoteDescription(Q.answer)}catch(ae){return f.logger.debug(`Call ${this.callId} Failed to set remote description`,ae),void this.terminate(w.Local,B.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{yield this.sendVoipEvent(c.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(ae){f.logger.warn(`Call ${this.callId} Failed to send select_answer event`,ae)}})}onSelectAnswerReceived(D){return d(this,void 0,void 0,function*(){if(this.direction!==y.Inbound)return void f.logger.warn(`Call ${this.callId} Got select_answer for an outbound call: ignoring`);const Q=D.getContent().selected_party_id;null!=Q?Q!==this.ourPartyId&&(f.logger.info(`Call ${this.callId} Got select_answer for party ID ${Q}: we are party ID ${this.ourPartyId}.`),yield this.terminate(w.Remote,B.AnsweredElsewhere,!0)):f.logger.warn(`Call ${this.callId} Got nonsensical select_answer with null/undefined selected_party_id: ignoring`)})}onNegotiateReceived(D){var Q;return d(this,void 0,void 0,function*(){const ee=D.getContent(),ae=ee.description;if(!ae||!ae.sdp||!ae.type)return void f.logger.info(`Call ${this.callId} Ignoring invalid m.call.negotiate event`);if(this.ignoreOffer=!(this.direction===y.Inbound)&&"offer"===ae.type&&(this.makingOffer||"stable"!==this.peerConn.signalingState),this.ignoreOffer)return void f.logger.info(`Call ${this.callId} Ignoring colliding negotiate event because we're impolite`);const X=this.isLocalOnHold(),H=ee[r.SDPStreamMetadataKey];H?this.updateRemoteSDPStreamMetadata(H):f.logger.warn(`Call ${this.callId} Received negotiation event without SDPStreamMetadata!`);try{if(yield this.peerConn.setRemoteDescription(ae),"offer"===ae.type){let ce;try{this.getRidOfRTXCodecs(),ce=yield this.createAnswer()}catch(te){return f.logger.debug(`Call ${this.callId} Failed to create answer: `,te),void this.terminate(w.Local,B.CreateAnswer,!0)}yield this.peerConn.setLocalDescription(ce),this.sendVoipEvent(c.EventType.CallNegotiate,{description:null===(Q=this.peerConn.localDescription)||void 0===Q?void 0:Q.toJSON(),[r.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata(!0)})}}catch(ce){f.logger.warn(`Call ${this.callId} Failed to complete negotiation`,ce)}const ne=this.isLocalOnHold();X!==ne&&(this.emit(x.LocalHoldUnhold,ne),this.emit(x.HoldUnhold,ne))})}updateRemoteSDPStreamMetadata(D){var Q;this.remoteSDPStreamMetadata=v.recursivelyAssign(this.remoteSDPStreamMetadata||{},D,!0);for(const ee of this.getRemoteFeeds()){const ae=ee.stream.id,ue=this.remoteSDPStreamMetadata[ae];ee.setAudioVideoMuted(ue?.audio_muted,ue?.video_muted),ee.purpose=null===(Q=this.remoteSDPStreamMetadata[ae])||void 0===Q?void 0:Q.purpose}}onSDPStreamMetadataChangedReceived(D){const ee=D.getContent()[r.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(ee)}onAssertedIdentityReceived(D){return d(this,void 0,void 0,function*(){const Q=D.getContent();Q.asserted_identity&&(this.remoteAssertedIdentity={id:Q.asserted_identity.id,displayName:Q.asserted_identity.display_name},this.emit(x.AssertedIdentityChanged))})}callHasEnded(){return this.state===p.Ended}queueGotLocalOffer(){this.responsePromiseChain=this.responsePromiseChain?this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){return d(this,void 0,void 0,function*(){this.makingOffer=!0;try{yield this.gotLocalOffer()}catch(D){return void this.getLocalOfferFailed(D)}finally{this.makingOffer=!1}})}gotLocalOffer(){var D,Q;return d(this,void 0,void 0,function*(){if(f.logger.debug(`Call ${this.callId} Setting local description`),this.callHasEnded())return void f.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");let ee;try{this.getRidOfRTXCodecs(),ee=yield this.createOffer()}catch(X){return f.logger.debug(`Call ${this.callId} Failed to create offer: `,X),void this.terminate(w.Local,B.CreateOffer,!0)}try{yield this.peerConn.setLocalDescription(ee)}catch(X){return f.logger.debug(`Call ${this.callId} Error setting local description!`,X),void this.terminate(w.Local,B.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&(yield new Promise(X=>{setTimeout(X,200)})),this.callHasEnded())return;const ae=this.state===p.CreateOffer?c.EventType.CallInvite:c.EventType.CallNegotiate,ue={lifetime:6e4};ae===c.EventType.CallInvite&&this.invitee&&(ue.invitee=this.invitee),this.state===p.CreateOffer?ue.offer=null===(D=this.peerConn.localDescription)||void 0===D?void 0:D.toJSON():ue.description=null===(Q=this.peerConn.localDescription)||void 0===Q?void 0:Q.toJSON(),ue.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},ue[r.SDPStreamMetadataKey]=this.getLocalSDPStreamMetadata(!0);const be=this.discardDuplicateCandidates();f.logger.info(`Call ${this.callId} Discarding ${be} candidates that will be sent in offer`);try{yield this.sendVoipEvent(ae,ue)}catch(X){f.logger.error(`Call ${this.callId} Failed to send invite`,X),X instanceof h.MatrixError&&X.event&&this.client.cancelPendingEvent(X.event);let H=B.SignallingFailed,ne="Signalling failed";return this.state===p.CreateOffer&&(H=B.SendInvite,ne="Failed to send invite"),"UnknownDeviceError"==X.name&&(H=B.UnknownDevices,ne="Unknown devices present in the room"),this.emit(x.Error,new C(H,ne,X)),void this.terminate(w.Local,H,!1)}this.sendCandidateQueue(),this.state===p.CreateOffer&&(this.inviteOrAnswerSent=!0,this.state=p.InviteSent,this.inviteTimeout=setTimeout(()=>{this.inviteTimeout=void 0,this.state===p.InviteSent&&this.hangup(B.InviteTimeout,!1)},6e4))})}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const D=RTCRtpReceiver.getCapabilities("video").codecs,ee=[...RTCRtpSender.getCapabilities("video").codecs,...D];for(const ue of ee)if("video/rtx"===ue.mimeType){const be=ee.indexOf(ue);ee.splice(be,1)}const ae=this.transceivers.get(N(r.SDPStreamMetadataPurpose.Screenshare,"video"));ae&&ae.setCodecPreferences(ee)}sendVoipEvent(D,Q){var ee,ae;return d(this,void 0,void 0,function*(){const ue=Object.assign({},Q,{version:"1",call_id:this.callId,party_id:this.ourPartyId,conf_id:this.groupCallId});if(this.opponentDeviceId){const be=this.toDeviceSeq++,X=Object.assign(Object.assign({},ue),{device_id:this.client.deviceId,sender_session_id:this.client.getSessionId(),dest_session_id:this.opponentSessionId,seq:be,[c.ToDeviceMessageId]:(0,u.v4)()});this.emit(x.SendVoipEvent,{type:"toDevice",eventType:D,userId:this.invitee||(null===(ee=this.getOpponentMember())||void 0===ee?void 0:ee.userId),opponentDeviceId:this.opponentDeviceId,content:X});const H=this.invitee||this.getOpponentMember().userId;this.client.getUseE2eForGroupCall()?yield this.client.encryptAndSendToDevices([{userId:H,deviceInfo:this.opponentDeviceInfo}],{type:D,content:X}):yield this.client.sendToDevice(D,{[H]:{[this.opponentDeviceId]:X}})}else this.emit(x.SendVoipEvent,{type:"sendEvent",eventType:D,roomId:this.roomId,content:ue,userId:this.invitee||(null===(ae=this.getOpponentMember())||void 0===ae?void 0:ae.userId)}),yield this.client.sendEvent(this.roomId,D,ue)})}queueCandidate(D){D?this.candidateSendQueue.push(D):this.candidatesEnded=!0,this.state!==p.Ringing&&this.inviteOrAnswerSent&&0===this.candidateSendTries&&setTimeout(()=>{this.sendCandidateQueue()},this.direction===y.Inbound?500:2e3)}discardDuplicateCandidates(){let D=0;const Q=[];for(let ee=0;ee<this.candidateSendQueue.length;ee++){const ae=this.candidateSendQueue[ee];""===ae.candidate?Q.push(ae):D++}return this.candidateSendQueue=Q,D}transfer(D){return d(this,void 0,void 0,function*(){const Q=yield this.client.getProfileInfo(D),ee=F(),ae={replacement_id:F(),target_user:{id:D,display_name:Q.displayname,avatar_url:Q.avatar_url},create_call:ee};yield this.sendVoipEvent(c.EventType.CallReplaces,ae),yield this.terminate(w.Local,B.Transfered,!0)})}transferToCall(D){var Q,ee;return d(this,void 0,void 0,function*(){const ae=null===(Q=D.getOpponentMember())||void 0===Q?void 0:Q.userId,ue=ae?yield this.client.getProfileInfo(ae):void 0,be=null===(ee=this.getOpponentMember())||void 0===ee?void 0:ee.userId,X=be?yield this.client.getProfileInfo(be):void 0,H=F(),ne={replacement_id:F(),target_user:{id:be,display_name:X?.displayname,avatar_url:X?.avatar_url},await_call:H};yield D.sendVoipEvent(c.EventType.CallReplaces,ne);const ce={replacement_id:F(),target_user:{id:ae,display_name:ue?.displayname,avatar_url:ue?.avatar_url},create_call:H};yield this.sendVoipEvent(c.EventType.CallReplaces,ce),yield this.terminate(w.Local,B.Transfered,!0),yield D.terminate(w.Local,B.Transfered,!0)})}terminate(D,Q,ee){return d(this,void 0,void 0,function*(){if(!this.callHasEnded()){this.hangupParty=D,this.hangupReason=Q,this.state=p.Ended,this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=void 0),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=void 0);for(const[ae,ue]of this.removeTrackListeners)ae.removeEventListener("removetrack",ue);this.removeTrackListeners.clear(),this.callStatsAtEnd=yield this.collectCallStats(),this.stopAllMedia(),this.deleteAllFeeds(),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),ee&&this.emit(x.Hangup,this),this.client.callEventHandler.calls.delete(this.callId)}})}stopAllMedia(){f.logger.debug(this.groupCallId?`Call ${this.callId} stopping all media except local feeds`:`Call ${this.callId} stopping all media`);for(const D of this.feeds)if(D.isLocal()&&D.purpose===r.SDPStreamMetadataPurpose.Usermedia&&!this.groupCallId)this.client.getMediaHandler().stopUserMediaStream(D.stream);else if(D.isLocal()&&D.purpose===r.SDPStreamMetadataPurpose.Screenshare&&!this.groupCallId)this.client.getMediaHandler().stopScreensharingStream(D.stream);else if(!D.isLocal()||!this.groupCallId){f.logger.debug("Stopping remote stream",D.stream.id);for(const Q of D.stream.getTracks())Q.stop()}}checkForErrorListener(){if(0===this.listeners(t.EventEmitterEvents.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){return d(this,void 0,void 0,function*(){if(0===this.candidateSendQueue.length||this.callHasEnded())return;const D=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const Q={candidates:D.map(ee=>ee.toJSON())};this.candidatesEnded&&Q.candidates.push({candidate:""}),f.logger.debug(`Call ${this.callId} attempting to send ${D.length} candidates`);try{yield this.sendVoipEvent(c.EventType.CallCandidates,Q),this.candidateSendTries=0,this.sendCandidateQueue()}catch(ee){if(ee instanceof h.MatrixError&&ee.event&&this.client.cancelPendingEvent(ee.event),this.candidateSendQueue.push(...D),this.candidateSendTries>5){f.logger.debug(`Call ${this.callId} failed to send candidates on attempt ${this.candidateSendTries}. Giving up on this call.`,ee);const ue=B.SignallingFailed;return this.emit(x.Error,new C(ue,"Signalling failed",ee)),void this.hangup(ue,!1)}const ae=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,f.logger.debug(`Call ${this.callId} failed to send candidates. Retrying in ${ae}ms`,ee),setTimeout(()=>{this.sendCandidateQueue()},ae)}})}placeCall(D,Q){var ee;return d(this,void 0,void 0,function*(){if(!D)throw new Error("You CANNOT start a call without audio");this.state=p.WaitLocalMedia;try{const ae=yield this.client.getMediaHandler().getUserMediaStream(D,Q);S(ae.getAudioTracks(),!0),S(ae.getVideoTracks(),!0);const ue=new s.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:null!==(ee=this.client.getDeviceId())&&void 0!==ee?ee:void 0,stream:ae,purpose:r.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1});yield this.placeCallWithCallFeeds([ue])}catch(ae){return void this.getUserMediaFailed(ae)}})}placeCallWithCallFeeds(D,Q=!1){return d(this,void 0,void 0,function*(){this.checkForErrorListener(),this.direction=y.Outbound,yield this.initOpponentCrypto(),this.client.callEventHandler.calls.set(this.callId,this),(yield this.client.checkTurnServers())||f.logger.warn(`Call ${this.callId} Failed to get TURN credentials! Proceeding with call anyway...`),this.peerConn=this.createPeerConnection(),this.gotCallFeedsForInvite(D,Q)})}createPeerConnection(){const D=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});return D.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),D.addEventListener("signalingstatechange",this.onSignallingStateChanged),D.addEventListener("icecandidate",this.gotLocalIceCandidate),D.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),D.addEventListener("track",this.onTrack),D.addEventListener("negotiationneeded",this.onNegotiationNeeded),D.addEventListener("datachannel",this.onDataChannel),D}partyIdMatches(D){return(0===D.version?null:D.party_id||null)===this.opponentPartyId}chooseOpponent(D){var Q;const ee=D.getContent();f.logger.debug(`Call ${this.callId} choosing opponent party ID ${ee.party_id}`),this.opponentVersion=ee.version,this.opponentPartyId=0===this.opponentVersion?null:ee.party_id||null,this.opponentCaps=ee.capabilities||{},this.opponentMember=null!==(Q=this.client.getRoom(this.roomId).getMember(D.getSender()))&&void 0!==Q?Q:void 0}addBufferedIceCandidates(){return d(this,void 0,void 0,function*(){const D=this.remoteCandidateBuffer.get(this.opponentPartyId);D&&(f.logger.info(`Call ${this.callId} Adding ${D.length} buffered candidates for opponent ${this.opponentPartyId}`),yield this.addIceCandidates(D)),this.remoteCandidateBuffer.clear()})}addIceCandidates(D){return d(this,void 0,void 0,function*(){for(const Q of D){f.logger.debug(null==Q.sdpMid&&null==Q.sdpMLineIndex?`Call ${this.callId} got remote ICE end-of-candidates`:`Call ${this.callId} got remote ICE ${Q.sdpMid} candidate: ${Q.candidate}`);try{yield this.peerConn.addIceCandidate(Q)}catch(ee){this.ignoreOffer||f.logger.info(`Call ${this.callId} failed to add remote ICE candidate`,ee)}}})}get hasPeerConnection(){return Boolean(this.peerConn)}}function S(k,D){for(const Q of k)Q.enabled=D}function U(){if(typeof window>"u"||typeof document>"u")return!1;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return"test"!==R.env.NODE_ENV&&f.logger.error("WebRTC is not supported in this browser / environment"),!1}catch(k){return f.logger.error("Exception thrown when trying to access WebRTC",k),!1}return!0}a.MatrixCall=T,a.setTracksEnabled=S,a.supportsMatrixCall=U,a.createNewMatrixCall=function W(k,D,Q){if(!U())return null;const ee=!!Q&&Q.forceTURN,ae={client:k,roomId:D,invitee:Q?.invitee,turnServers:k.getTurnServers(),forceTURN:k.forceTURN||ee,opponentDeviceId:Q?.opponentDeviceId,opponentSessionId:Q?.opponentSessionId,groupCallId:Q?.groupCallId},ue=new T(ae);return k.reEmitter.reEmit(ue,Object.values(x)),ue}}).call(this)}).call(this,m("_process"))},{"../@types/event":299,"../crypto/deviceinfo":332,"../http-api":358,"../logger":365,"../models/typed-event-emitter":385,"../randomstring":388,"../utils":402,"./callEventTypes":406,"./callFeed":407,"./groupCall":408,_process:237,"sdp-transform":253,uuid:287}],405:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(i,r,s,t){return new(s||(s=Promise))(function(o,h){function l(b){try{p(t.next(b))}catch(y){h(y)}}function e(b){try{p(t.throw(b))}catch(y){h(y)}}function p(b){b.done?o(b.value):function n(o){return o instanceof s?o:new s(function(h){h(o)})}(b.value).then(l,e)}p((t=t.apply(i,r||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.CallEventHandler=a.CallEventHandlerEvent=void 0;const I=m("../logger"),E=m("./call"),_=m("../@types/event"),d=m("../client"),u=m("./groupCall"),g=m("../models/room");var v;(v=a.CallEventHandlerEvent||(a.CallEventHandlerEvent={})).Incoming="Call.incoming",a.CallEventHandler=class c{constructor(r){this.nextSeqByCall=new Map,this.toDeviceEventBuffers=new Map,this.onSync=()=>{const s=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain=this.eventBufferPromiseChain?this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(s)):this.evaluateEventBuffer(s)},this.onRoomTimeline=s=>{this.callEventBuffer.push(s)},this.onToDeviceEvent=s=>{const t=s.getContent();if(!t.call_id)return void this.callEventBuffer.push(s);if(this.nextSeqByCall.has(t.call_id)||this.nextSeqByCall.set(t.call_id,0),void 0===t.seq)return void this.callEventBuffer.push(s);const n=this.nextSeqByCall.get(t.call_id)||0;if(t.seq!==n){this.toDeviceEventBuffers.has(t.call_id)||this.toDeviceEventBuffers.set(t.call_id,[]);const o=this.toDeviceEventBuffers.get(t.call_id),h=o.findIndex(l=>l.getContent().seq>t.seq);-1===h?o.push(s):o.splice(h,0,s)}else{const o=t.call_id;this.callEventBuffer.push(s),this.nextSeqByCall.set(o,t.seq+1);const h=this.toDeviceEventBuffers.get(o);let l=h&&h.shift();for(;l&&l.getContent().seq===this.nextSeqByCall.get(o);)this.callEventBuffer.push(l),this.nextSeqByCall.set(o,l.getContent().seq+1),l=h.shift()}},this.client=r,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(d.ClientEvent.Sync,this.onSync),this.client.on(g.RoomEvent.Timeline,this.onRoomTimeline),this.client.on(d.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(d.ClientEvent.Sync,this.onSync),this.client.removeListener(g.RoomEvent.Timeline,this.onRoomTimeline),this.client.removeListener(d.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(r){return R(this,void 0,void 0,function*(){yield Promise.all(r.map(n=>this.client.decryptEventIfNeeded(n)));const s=r.filter(n=>{const o=n.getType();return o.startsWith("m.call.")||o.startsWith("org.matrix.call.")}),t=new Set;for(const n of s){const o=n.getType();(o===_.EventType.CallAnswer||o===_.EventType.CallHangup)&&t.add(n.getContent().call_id)}for(const n of s){const o=n.getType(),h=n.getContent().call_id;if(o!==_.EventType.CallInvite||!t.has(h))try{yield this.handleCallEvent(n)}catch(l){I.logger.error("Caught exception handling call event",l)}}})}handleCallEvent(r){var s,t,n,o,h,l;return R(this,void 0,void 0,function*(){this.client.emit(d.ClientEvent.ReceivedVoipEvent,r);const e=r.getContent(),p=r.getRoomId()||(null===(t=null===(s=this.client.groupCallEventHandler.getGroupCallById(e.conf_id))||void 0===s?void 0:s.room)||void 0===t?void 0:t.roomId),b=e.conf_id,y=r.getType(),w=r.getSender();let B,J,x=e.call_id?this.calls.get(e.call_id):void 0;if(b){if(J=this.client.groupCallEventHandler.getGroupCallById(b),!J)return void I.logger.warn(`Cannot find a group call ${b} for event ${y}. Ignoring event.`);if(B=e.device_id,!B)return I.logger.warn(`Cannot find a device id for ${w}. Ignoring event.`),void J.emit(u.GroupCallEvent.Error,new u.GroupCallUnknownDeviceError(w));if(e.dest_session_id!==this.client.getSessionId())return void I.logger.warn("Call event does not match current session id, ignoring.")}const z=w===this.client.credentials.userId&&(void 0===B||B===this.client.getDeviceId());if(p){if(y===_.EventType.CallInvite){if(z||r.getLocalAge()>e.lifetime-3e3||x&&x.state===E.CallState.Ended||(x&&I.logger.log(`WARN: Already have a MatrixCall with id ${e.call_id} but got an invite. Clobbering.`),e.invitee&&e.invitee!==this.client.getUserId()))return;const M=(null!==(n=this.client.getTurnServersExpiry())&&void 0!==n?n:0)-Date.now();if(I.logger.info("Current turn creds expire in "+M+" ms"),x=null!==(o=(0,E.createNewMatrixCall)(this.client,p,{forceTURN:this.client.forceTURN,opponentDeviceId:B,groupCallId:b,opponentSessionId:e.sender_session_id}))&&void 0!==o?o:void 0,!x)return void I.logger.log("Incoming call ID "+e.call_id+" but this client doesn't support WebRTC");x.callId=e.call_id;try{yield x.initWithInvite(r)}catch(j){j instanceof E.CallError&&(j.code===u.GroupCallErrorCode.UnknownDevice?J?.emit(u.GroupCallEvent.Error,j):I.logger.error(j))}if(this.calls.set(x.callId,x),this.candidateEventsByCall.get(x.callId))for(const j of this.candidateEventsByCall.get(x.callId))x.onRemoteIceCandidatesReceived(j);let L;for(const j of this.calls.values()){const C=[E.CallState.WaitLocalMedia,E.CallState.CreateOffer,E.CallState.InviteSent].includes(j.state);if(x.roomId===j.roomId&&j.direction===E.CallDirection.Outbound&&(null===(h=x.getOpponentMember())||void 0===h?void 0:h.userId)===j.invitee&&C){L=j;break}}return void(L?L.callId>x.callId?(I.logger.log("Glare detected: answering incoming call "+x.callId+" and canceling outgoing call "+L.callId),L.replacedBy(x)):(I.logger.log("Glare detected: rejecting incoming call "+x.callId+" and keeping outgoing call "+L.callId),x.hangup(E.CallErrorCode.Replaced,!0)):this.client.emit(v.Incoming,x))}if(y===_.EventType.CallCandidates){if(z)return;return void(x?x.onRemoteIceCandidatesReceived(r):(this.candidateEventsByCall.has(e.call_id)||this.candidateEventsByCall.set(e.call_id,[]),this.candidateEventsByCall.get(e.call_id).push(r)))}if([_.EventType.CallHangup,_.EventType.CallReject].includes(y))return void(x?x.state!==E.CallState.Ended&&(y===_.EventType.CallHangup?x.onHangupReceived(e):x.onRejectReceived(e),x.state===E.CallState.Ended&&this.calls.delete(e.call_id)):(x=null!==(l=(0,E.createNewMatrixCall)(this.client,p,{opponentDeviceId:B,opponentSessionId:e.sender_session_id}))&&void 0!==l?l:void 0,x&&(x.callId=e.call_id,x.initWithHangup(r),this.calls.set(e.call_id,x))));if(!x||!x.hasPeerConnection)return void I.logger.info(`Discarding possible call event ${r.getId()} as we don't have a call/peerConn`,y);if(r.getContent().party_id!==x.ourPartyId)switch(y){case _.EventType.CallAnswer:z?x.state===E.CallState.Ringing&&x.onAnsweredElsewhere(e):x.onAnswerReceived(r);break;case _.EventType.CallSelectAnswer:x.onSelectAnswerReceived(r);break;case _.EventType.CallNegotiate:x.onNegotiateReceived(r);break;case _.EventType.CallAssertedIdentity:case _.EventType.CallAssertedIdentityPrefix:x.onAssertedIdentityReceived(r);break;case _.EventType.CallSDPStreamMetadataChanged:case _.EventType.CallSDPStreamMetadataChangedPrefix:x.onSDPStreamMetadataChangedReceived(r)}}})}}},{"../@types/event":299,"../client":313,"../logger":365,"../models/room":382,"./call":404,"./groupCall":408}],406:[function(m,ie,a){"use strict";var I;Object.defineProperty(a,"__esModule",{value:!0}),a.SDPStreamMetadataPurpose=a.SDPStreamMetadataKey=void 0,a.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",(I=a.SDPStreamMetadataPurpose||(a.SDPStreamMetadataPurpose={})).Usermedia="m.usermedia",I.Screenshare="m.screenshare"},{}],407:[function(m,ie,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.CallFeed=a.CallFeedEvent=a.SPEAKING_THRESHOLD=void 0;const R=m("./callEventTypes"),I=m("./audioContext"),E=m("../logger"),_=m("../models/typed-event-emitter"),d=m("./call");var f,c;a.SPEAKING_THRESHOLD=-60,(c=f=a.CallFeedEvent||(a.CallFeedEvent={})).NewStream="new_stream",c.MuteStateChanged="mute_state_changed",c.LocalVolumeChanged="local_volume_changed",c.VolumeChanged="volume_changed",c.ConnectedChanged="connected_changed",c.Speaking="speaking",c.Disposed="disposed";class v extends _.TypedEventEmitter{constructor(i){super(),this.localVolume=1,this.measuringVolumeActivity=!1,this.speakingThreshold=a.SPEAKING_THRESHOLD,this.speaking=!1,this._disposed=!1,this._connected=!1,this.onAddTrack=()=>{this.emit(f.NewStream,this.stream)},this.onCallState=r=>{r===d.CallState.Connected?this.connected=!0:r===d.CallState.Connecting&&(this.connected=!1)},this.volumeLooper=()=>{if(!this.analyser||!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let r=-1/0;for(const t of this.frequencyBinCount)t>r&&(r=t);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(r),this.emit(f.VolumeChanged,r);let s=!1;for(const t of this.speakingVolumeSamples)if(t>this.speakingThreshold){s=!0;break}this.speaking!==s&&(this.speaking=s,this.emit(f.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,200)},this.client=i.client,this.call=i.call,this.roomId=i.roomId,this.userId=i.userId,this.deviceId=i.deviceId,this.purpose=i.purpose,this.audioMuted=i.audioMuted,this.videoMuted=i.videoMuted,this.speakingVolumeSamples=new Array(8).fill(-1/0),this.sdpMetadataStreamId=i.stream.id,this.updateStream(null,i.stream),this.stream=i.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),i.call&&(i.call.addListener(d.CallEvent.State,this.onCallState),this.onCallState(i.call.state))}get connected(){return this.isLocal()||this._connected}set connected(i){this._connected=i,this.emit(f.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(i,r){r!==i&&(i&&(i.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=r,r.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1),this.emit(f.NewStream,this.stream))}initVolumeMeasuring(){this.hasAudioTrack&&(this.audioContext||(this.audioContext=(0,I.acquireContext)()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){var i;return null!==(i=this.client.getRoom(this.roomId)?.getMember(this.userId))&&void 0!==i?i:null}isLocal(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(i){this.updateStream(this.stream,i)}setAudioVideoMuted(i,r){null!==i&&(this.audioMuted!==i&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=i),null!==r&&(this.videoMuted=r),this.emit(f.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(i){if(i){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(f.VolumeChanged,-1/0)}setSpeakingThreshold(i){this.speakingThreshold=i}clone(){const i=this.client.getMediaHandler(),r=this.stream.clone();return E.logger.log(`callFeed cloning stream ${this.stream.id} newStream ${r.id}`),this.purpose===R.SDPStreamMetadataPurpose.Usermedia?i.userMediaStreams.push(r):i.screensharingStreams.push(r),new v({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:r,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var i,r;clearTimeout(this.volumeLooperTimeout),null===(i=this.stream)||void 0===i||i.removeEventListener("addtrack",this.onAddTrack),null===(r=this.call)||void 0===r||r.removeListener(d.CallEvent.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,(0,I.releaseContext)()),this._disposed=!0,this.emit(f.Disposed)}get disposed(){return this._disposed}set disposed(i){this._disposed=i}getLocalVolume(){return this.localVolume}setLocalVolume(i){this.localVolume=i,this.emit(f.LocalVolumeChanged,i)}}a.CallFeed=v},{"../logger":365,"../models/typed-event-emitter":385,"./audioContext":403,"./call":404,"./callEventTypes":406}],408:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(B,J,z,M){return new(z||(z=Promise))(function(j,C){function F(T){try{N(M.next(T))}catch(S){C(S)}}function V(T){try{N(M.throw(T))}catch(S){C(S)}}function N(T){T.done?j(T.value):function L(j){return j instanceof z?j:new z(function(C){C(j)})}(T.value).then(F,V)}N((M=M.apply(B,J||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.GroupCall=a.GroupCallState=a.OtherUserSpeakingError=a.GroupCallUnknownDeviceError=a.GroupCallError=a.GroupCallErrorCode=a.GroupCallEvent=a.GroupCallTerminationReason=a.GroupCallType=a.GroupCallIntent=void 0;const I=m("../models/typed-event-emitter"),E=m("./callFeed"),_=m("./call"),d=m("../models/room-state"),u=m("../logger"),g=m("../ReEmitter"),f=m("./callEventTypes"),v=m("../@types/event"),c=m("./callEventHandler"),i=m("./groupCallEventHandler"),r=m("../utils");var B,t,n,o,h,b;(B=a.GroupCallIntent||(a.GroupCallIntent={})).Ring="m.ring",B.Prompt="m.prompt",B.Room="m.room",function(B){B.Video="m.video",B.Voice="m.voice"}(t=a.GroupCallType||(a.GroupCallType={})),function(B){B.CallEnded="call_ended"}(n=a.GroupCallTerminationReason||(a.GroupCallTerminationReason={})),function(B){B.GroupCallStateChanged="group_call_state_changed",B.ActiveSpeakerChanged="active_speaker_changed",B.CallsChanged="calls_changed",B.UserMediaFeedsChanged="user_media_feeds_changed",B.ScreenshareFeedsChanged="screenshare_feeds_changed",B.LocalScreenshareStateChanged="local_screenshare_state_changed",B.LocalMuteStateChanged="local_mute_state_changed",B.ParticipantsChanged="participants_changed",B.Error="error"}(o=a.GroupCallEvent||(a.GroupCallEvent={})),function(B){B.NoUserMedia="no_user_media",B.UnknownDevice="unknown_device",B.PlaceCallFailed="place_call_failed"}(h=a.GroupCallErrorCode||(a.GroupCallErrorCode={}));class l extends Error{constructor(J,z,M){super(M?z+": "+M:z),this.code=J}}a.GroupCallError=l,a.GroupCallUnknownDeviceError=class e extends l{constructor(J){super(h.UnknownDevice,"No device found for "+J),this.userId=J}};class p extends Error{constructor(){super("Cannot unmute: another user is speaking")}}a.OtherUserSpeakingError=p,function(B){B.LocalCallFeedUninitialized="local_call_feed_uninitialized",B.InitializingLocalCallFeed="initializing_local_call_feed",B.LocalCallFeedInitialized="local_call_feed_initialized",B.Entered="entered",B.Ended="ended"}(b=a.GroupCallState||(a.GroupCallState={}));const y=36e5;function w(B){var J;return(null===(J=B.getOpponentMember())||void 0===J?void 0:J.userId)||B.invitee||null}a.GroupCall=class x extends I.TypedEventEmitter{constructor(J,z,M,L,j,C,F,V){var N,T;super(),this.client=J,this.room=z,this.type=M,this.isPtt=L,this.intent=j,this.dataChannelsEnabled=F,this.dataChannelOptions=V,this.activeSpeakerInterval=1e3,this.retryCallInterval=5e3,this.participantTimeout=15e3,this.pttMaxTransmitTime=2e4,this.userMediaFeeds=[],this.screenshareFeeds=[],this.calls=new Map,this.callHandlers=new Map,this.retryCallCounts=new Map,this.transmitTimer=null,this.participantsExpirationTimer=null,this.resendMemberStateTimer=null,this.initWithAudioMuted=!1,this.initWithVideoMuted=!1,this._state=b.LocalCallFeedUninitialized,this._participants=new Map,this._creationTs=null,this._enteredViaAnotherSession=!1,this.onIncomingCall=S=>{var U;if(S.roomId!==this.room.roomId)return;if(S.state!==_.CallState.Ringing)return void u.logger.warn("Incoming call no longer in ringing state. Ignoring.");if(!S.groupCallId||S.groupCallId!==this.groupCallId)return u.logger.log(`Incoming call with groupCallId ${S.groupCallId} ignored because it doesn't match the current group call`),void S.reject();const W=S.getOpponentMember();if(void 0===W)return void u.logger.warn("Incoming call with no member. Ignoring.");const k=null!==(U=this.calls.get(W))&&void 0!==U?U:new Map,D=k.get(S.getOpponentDeviceId());D?.callId!==S.callId&&(u.logger.log(`GroupCall: incoming call from ${W.userId} with ID ${S.callId}`),D&&this.disposeCall(D,_.CallErrorCode.Replaced),this.initCall(S),S.answerWithCallFeeds(this.getLocalFeeds().map(Q=>Q.clone())),k.set(S.getOpponentDeviceId(),S),this.calls.set(W,k),this.emit(o.CallsChanged,this.calls))},this.onRetryCallLoop=()=>{var S;let U=!1;for(const[W,k]of this.participants){const D=this.calls.get(W);let Q=this.retryCallCounts.get(W);for(const[ee,ae]of k){const ue=D?.get(ee),be=null!==(S=Q?.get(ee))&&void 0!==S?S:0;ue?.getOpponentSessionId()!==ae.sessionId&&this.wantsOutgoingCall(W.userId,ee)&&be<3&&(void 0===Q&&(Q=new Map,this.retryCallCounts.set(W,Q)),Q.set(ee,be+1),U=!0)}}U&&this.placeOutgoingCalls()},this.onCallFeedsChanged=S=>{const U=w(S),W=S.getOpponentDeviceId();if(!U)throw new Error("Cannot change call feeds without user id");const k=this.getUserMediaFeed(U,W),D=S.remoteUsermediaFeed;D!==k&&(!k&&D?this.addUserMediaFeed(D):k&&D?this.replaceUserMediaFeed(k,D):k&&!D&&this.removeUserMediaFeed(k));const ee=this.getScreenshareFeed(U,W),ae=S.remoteScreensharingFeed;ae!==ee&&(!ee&&ae?this.addScreenshareFeed(ae):ee&&ae?this.replaceScreenshareFeed(ee,ae):ee&&!ae&&this.removeScreenshareFeed(ee))},this.onCallStateChanged=(S,U,W)=>{const k=this.localCallFeed.isAudioMuted();S.localUsermediaStream&&S.isMicrophoneMuted()!==k&&S.setMicrophoneMuted(k);const D=this.localCallFeed.isVideoMuted();if(S.localUsermediaStream&&S.isLocalVideoMuted()!==D&&S.setLocalVideoMuted(D),U===_.CallState.Connected){const Q=S.getOpponentMember(),ee=this.retryCallCounts.get(Q);ee?.delete(S.getOpponentDeviceId()),0===ee?.size&&this.retryCallCounts.delete(Q)}},this.onCallHangup=S=>{var U;if(S.hangupReason===_.CallErrorCode.Replaced)return;const W=null!==(U=S.getOpponentMember())&&void 0!==U?U:this.room.getMember(S.invitee),k=this.calls.get(W);k?.get(S.getOpponentDeviceId())===S&&(this.disposeCall(S,S.hangupReason),k.delete(S.getOpponentDeviceId()),0===k.size&&this.calls.delete(W),this.emit(o.CallsChanged,this.calls))},this.onCallReplaced=(S,U)=>{const W=S.getOpponentMember();let k=this.calls.get(W);void 0===k&&(k=new Map,this.calls.set(W,k)),this.disposeCall(S,_.CallErrorCode.Replaced),this.initCall(U),k.set(S.getOpponentDeviceId(),U),this.emit(o.CallsChanged,this.calls)},this.onActiveSpeakerLoop=()=>{let S,U;for(const W of this.userMediaFeeds){if(W.isLocal()&&this.userMediaFeeds.length>1)continue;const D=W.speakingVolumeSamples.reduce((Q,ee)=>Q+Math.max(ee,E.SPEAKING_THRESHOLD))/W.speakingVolumeSamples.length;(!S||D>S)&&(S=D,U=W)}U&&this.activeSpeaker!==U&&S&&S>E.SPEAKING_THRESHOLD&&(this.activeSpeaker=U,this.emit(o.ActiveSpeakerChanged,this.activeSpeaker))},this.onRoomState=()=>this.updateParticipants(),this.onParticipantsChanged=()=>{this.state===b.Entered&&this.placeOutgoingCalls()},this.onStateChanged=(S,U)=>{(S===b.Entered||U===b.Entered||S===b.Ended)&&(this.updateParticipants(),this.updateMemberState().catch(W=>u.logger.error("Failed to update member state devices",W)))},this.onLocalFeedsChanged=()=>{this.state===b.Entered&&this.updateMemberState().catch(S=>u.logger.error("Failed to update member state feeds",S))},this.reEmitter=new g.ReEmitter(this),this.groupCallId=C??(0,_.genCallID)(),this.creationTs=null!==(T=null===(N=z.currentState.getStateEvents(v.EventType.GroupCallPrefix,this.groupCallId))||void 0===N?void 0:N.getTs())&&void 0!==T?T:null,this.updateParticipants(),z.on(d.RoomStateEvent.Update,this.onRoomState),this.on(o.ParticipantsChanged,this.onParticipantsChanged),this.on(o.GroupCallStateChanged,this.onStateChanged),this.on(o.LocalScreenshareStateChanged,this.onLocalFeedsChanged)}create(){return R(this,void 0,void 0,function*(){this.creationTs=Date.now(),this.client.groupCallEventHandler.groupCalls.set(this.room.roomId,this),this.client.emit(i.GroupCallEventHandlerEvent.Outgoing,this);const J={"m.intent":this.intent,"m.type":this.type,"io.element.ptt":this.isPtt,dataChannelsEnabled:this.dataChannelsEnabled,dataChannelOptions:this.dataChannelsEnabled?this.dataChannelOptions:void 0};return yield this.client.sendStateEvent(this.room.roomId,v.EventType.GroupCallPrefix,J,this.groupCallId),this})}get state(){return this._state}set state(J){const z=this._state;J!==z&&(this._state=J,this.emit(o.GroupCallStateChanged,J,z))}get participants(){return this._participants}set participants(J){const M=(j,C)=>j.sessionId===C.sessionId&&j.screensharing===C.screensharing;(0,r.mapsEqual)(J,this._participants,(j,C)=>(0,r.mapsEqual)(j,C,M))||(this._participants=J,this.emit(o.ParticipantsChanged,J))}get creationTs(){return this._creationTs}set creationTs(J){this._creationTs=J}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(J){this._enteredViaAnotherSession=J,this.updateParticipants()}forEachCall(J){for(const z of this.calls.values())for(const M of z.values())J(M)}getLocalFeeds(){const J=[];return this.localCallFeed&&J.push(this.localCallFeed),this.localScreenshareFeed&&J.push(this.localScreenshareFeed),J}hasLocalParticipant(){var J,z;return null!==(z=null===(J=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===J?void 0:J.has(this.client.getDeviceId()))&&void 0!==z&&z}initLocalCallFeed(){return R(this,void 0,void 0,function*(){if(u.logger.log(`groupCall ${this.groupCallId} initLocalCallFeed`),this.state!==b.LocalCallFeedUninitialized)throw new Error(`Cannot initialize local call feed in the "${this.state}" state.`);this.state=b.InitializingLocalCallFeed;let J,z=!1;const M=j=>{j===b.LocalCallFeedUninitialized&&(z=!0)};this.on(o.GroupCallStateChanged,M);try{J=yield this.client.getMediaHandler().getUserMediaStream(!0,this.type===t.Video)}catch(j){throw this.state=b.LocalCallFeedUninitialized,j}finally{this.off(o.GroupCallStateChanged,M)}if(z)throw new Error("Group call disposed");const L=new E.CallFeed({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:J,purpose:f.SDPStreamMetadataPurpose.Usermedia,audioMuted:this.initWithAudioMuted||0===J.getAudioTracks().length||this.isPtt,videoMuted:this.initWithVideoMuted||0===J.getVideoTracks().length});return(0,_.setTracksEnabled)(J.getAudioTracks(),!L.isAudioMuted()),(0,_.setTracksEnabled)(J.getVideoTracks(),!L.isVideoMuted()),this.localCallFeed=L,this.addUserMediaFeed(L),this.state=b.LocalCallFeedInitialized,L})}updateLocalUsermediaStream(J){return R(this,void 0,void 0,function*(){if(this.localCallFeed){const z=this.localCallFeed.stream;this.localCallFeed.setNewStream(J);const M=this.localCallFeed.isAudioMuted(),L=this.localCallFeed.isVideoMuted();u.logger.log(`groupCall ${this.groupCallId} updateLocalUsermediaStream oldStream ${z.id} newStream ${J.id} micShouldBeMuted ${M} vidShouldBeMuted ${L}`),(0,_.setTracksEnabled)(J.getAudioTracks(),!M),(0,_.setTracksEnabled)(J.getVideoTracks(),!L),this.client.getMediaHandler().stopUserMediaStream(z)}})}enter(){return R(this,void 0,void 0,function*(){if(this.state===b.LocalCallFeedUninitialized)yield this.initLocalCallFeed();else if(this.state!==b.LocalCallFeedInitialized)throw new Error(`Cannot enter call in the "${this.state}" state`);u.logger.log(`Entered group call ${this.groupCallId}`),this.state=b.Entered,this.client.on(c.CallEventHandlerEvent.Incoming,this.onIncomingCall);for(const J of this.client.callEventHandler.calls.values())this.onIncomingCall(J);this.retryCallLoopInterval=setInterval(this.onRetryCallLoop,this.retryCallInterval),this.activeSpeaker=void 0,this.onActiveSpeakerLoop(),this.activeSpeakerLoopInterval=setInterval(this.onActiveSpeakerLoop,this.activeSpeakerInterval)})}dispose(){this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.state===b.Entered&&(this.forEachCall(J=>this.disposeCall(J,_.CallErrorCode.UserHangup)),this.calls.clear(),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(c.CallEventHandlerEvent.Incoming,this.onIncomingCall))}leave(){this.dispose(),this.state=b.LocalCallFeedUninitialized}terminate(J=!0){return R(this,void 0,void 0,function*(){if(this.dispose(),this.room.off(d.RoomStateEvent.Update,this.onRoomState),this.client.groupCallEventHandler.groupCalls.delete(this.room.roomId),this.client.emit(i.GroupCallEventHandlerEvent.Ended,this),this.state=b.Ended,J){const z=this.room.currentState.getStateEvents(v.EventType.GroupCallPrefix,this.groupCallId);yield this.client.sendStateEvent(this.room.roomId,v.EventType.GroupCallPrefix,Object.assign(Object.assign({},z.getContent()),{"m.terminated":n.CallEnded}),this.groupCallId)}})}isLocalVideoMuted(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}isMicrophoneMuted(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}setMicrophoneMuted(J){return R(this,void 0,void 0,function*(){if(!J&&!(yield this.client.getMediaHandler().hasAudioDevice()))return!1;const z=!J&&this.isPtt;this.isPtt&&(!J&&this.isMicrophoneMuted()?this.transmitTimer=setTimeout(()=>{this.setMicrophoneMuted(!0)},this.pttMaxTransmitTime):J&&!this.isMicrophoneMuted()&&(null!==this.transmitTimer&&clearTimeout(this.transmitTimer),this.transmitTimer=null)),this.forEachCall(L=>{var j;return null===(j=L.localUsermediaFeed)||void 0===j?void 0:j.setAudioVideoMuted(J,null)});const M=()=>R(this,void 0,void 0,function*(){const L=[];this.forEachCall(j=>L.push(j.sendMetadataUpdate())),yield Promise.all(L).catch(j=>u.logger.info("Failed to send some metadata updates",j))});return z&&(yield M()),this.localCallFeed?(u.logger.log(`groupCall ${this.groupCallId} setMicrophoneMuted stream ${this.localCallFeed.stream.id} muted ${J}`),this.localCallFeed.setAudioVideoMuted(J,null),(0,_.setTracksEnabled)(this.localCallFeed.stream.getAudioTracks(),!J)):(u.logger.log(`groupCall ${this.groupCallId} setMicrophoneMuted no stream muted ${J}`),this.initWithAudioMuted=J),this.forEachCall(L=>(0,_.setTracksEnabled)(L.localUsermediaFeed.stream.getAudioTracks(),!J)),this.emit(o.LocalMuteStateChanged,J,this.isLocalVideoMuted()),z||(yield M()),!0})}setLocalVideoMuted(J){return R(this,void 0,void 0,function*(){if(!J&&!(yield this.client.getMediaHandler().hasVideoDevice()))return!1;this.localCallFeed?(u.logger.log(`groupCall ${this.groupCallId} setLocalVideoMuted stream ${this.localCallFeed.stream.id} muted ${J}`),this.localCallFeed.setAudioVideoMuted(null,J),(0,_.setTracksEnabled)(this.localCallFeed.stream.getVideoTracks(),!J)):(u.logger.log(`groupCall ${this.groupCallId} setLocalVideoMuted no stream muted ${J}`),this.initWithVideoMuted=J);const z=[];return this.forEachCall(M=>z.push(M.setLocalVideoMuted(J))),yield Promise.all(z),this.emit(o.LocalMuteStateChanged,this.isMicrophoneMuted(),J),!0})}setScreensharingEnabled(J,z={}){return R(this,void 0,void 0,function*(){if(J===this.isScreensharing())return J;if(!J)return this.forEachCall(M=>{M.localScreensharingFeed&&M.removeLocalFeed(M.localScreensharingFeed)}),this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0,this.emit(o.LocalScreenshareStateChanged,!1,void 0,void 0),!1;try{u.logger.log("Asking for screensharing permissions...");const M=yield this.client.getMediaHandler().getScreensharingStream(z);for(const L of M.getTracks()){const j=()=>{this.setScreensharingEnabled(!1),L.removeEventListener("ended",j)};L.addEventListener("ended",j)}return u.logger.log("Screensharing permissions granted. Setting screensharing enabled on all calls"),this.localDesktopCapturerSourceId=z.desktopCapturerSourceId,this.localScreenshareFeed=new E.CallFeed({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:M,purpose:f.SDPStreamMetadataPurpose.Screenshare,audioMuted:!1,videoMuted:!1}),this.addScreenshareFeed(this.localScreenshareFeed),this.emit(o.LocalScreenshareStateChanged,!0,this.localScreenshareFeed,this.localDesktopCapturerSourceId),this.forEachCall(L=>L.pushLocalFeed(this.localScreenshareFeed.clone())),!0}catch(M){if(z.throwOnFail)throw M;return u.logger.error("Enabling screensharing error",M),this.emit(o.Error,new l(h.NoUserMedia,"Failed to get screen-sharing stream: ",M)),!1}})}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(J,z){const M=this.client.getUserId(),L=this.client.getDeviceId();return J>=M&&(J!==M||z>L)}placeOutgoingCalls(){var J;let z=!1;for(const[M,L]of this.participants){const j=null!==(J=this.calls.get(M))&&void 0!==J?J:new Map;for(const[C,F]of L){const V=j.get(C);if(V?.getOpponentSessionId()!==F.sessionId&&this.wantsOutgoingCall(M.userId,C)){z=!0,void 0!==V&&(u.logger.debug(`Replacing call ${V.callId} to ${M.userId} ${C}`),this.disposeCall(V,_.CallErrorCode.NewSession));const N=(0,_.createNewMatrixCall)(this.client,this.room.roomId,{invitee:M.userId,opponentDeviceId:C,opponentSessionId:F.sessionId,groupCallId:this.groupCallId});null===N?(u.logger.error(`Failed to create call with ${M.userId} ${C}`),j.delete(C)):(this.initCall(N),j.set(C,N),u.logger.debug(`Placing call to ${M.userId} ${C} (session ${F.sessionId})`),N.placeCallWithCallFeeds(this.getLocalFeeds().map(T=>T.clone()),F.screensharing).then(()=>{this.dataChannelsEnabled&&N.createDataChannel("datachannel",this.dataChannelOptions)}).catch(T=>{u.logger.warn(`Failed to place call to ${M.userId}`,T),this.emit(o.Error,T instanceof _.CallError&&T.code===h.UnknownDevice?T:new l(h.PlaceCallFailed,`Failed to place call to ${M.userId}`)),this.disposeCall(N,_.CallErrorCode.SignallingFailed),j.get(C)===N&&j.delete(C)}))}}j.size>0?this.calls.set(M,j):this.calls.delete(M)}z&&this.emit(o.CallsChanged,this.calls)}getMemberStateEvents(J){return void 0===J?this.room.currentState.getStateEvents(v.EventType.GroupCallMemberPrefix):this.room.currentState.getStateEvents(v.EventType.GroupCallMemberPrefix,J)}initCall(J){const z=w(J);if(!z)throw new Error("Cannot init call without user id");const M=()=>this.onCallFeedsChanged(J),L=(V,N)=>this.onCallStateChanged(J,V,N),j=this.onCallHangup,C=V=>this.onCallReplaced(J,V);let F=this.callHandlers.get(z);void 0===F&&(F=new Map,this.callHandlers.set(z,F)),F.set(J.getOpponentDeviceId(),{onCallFeedsChanged:M,onCallStateChanged:L,onCallHangup:j,onCallReplaced:C}),J.on(_.CallEvent.FeedsChanged,M),J.on(_.CallEvent.State,L),J.on(_.CallEvent.Hangup,j),J.on(_.CallEvent.Replaced,C),J.isPtt=this.isPtt,this.reEmitter.reEmit(J,Object.values(_.CallEvent)),M()}disposeCall(J,z){const M=w(J),L=J.getOpponentDeviceId();if(!M)throw new Error("Cannot dispose call without user id");const j=this.callHandlers.get(M),{onCallFeedsChanged:C,onCallStateChanged:F,onCallHangup:V,onCallReplaced:N}=j.get(L);if(J.removeListener(_.CallEvent.FeedsChanged,C),J.removeListener(_.CallEvent.State,F),J.removeListener(_.CallEvent.Hangup,V),J.removeListener(_.CallEvent.Replaced,N),j.delete(M),0===j.size&&this.callHandlers.delete(M),J.hangupReason===_.CallErrorCode.Replaced)return;J.state!==_.CallState.Ended&&J.hangup(z,!1);const T=this.getUserMediaFeed(M,L);T&&this.removeUserMediaFeed(T);const S=this.getScreenshareFeed(M,L);S&&this.removeScreenshareFeed(S)}getUserMediaFeed(J,z){return this.userMediaFeeds.find(M=>M.userId===J&&M.deviceId===z)}addUserMediaFeed(J){this.userMediaFeeds.push(J),J.measureVolumeActivity(!0),this.emit(o.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(J,z){const M=this.userMediaFeeds.findIndex(L=>L.userId===J.userId&&L.deviceId===J.deviceId);if(-1===M)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(M,1,z),J.dispose(),z.measureVolumeActivity(!0),this.emit(o.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(J){const z=this.userMediaFeeds.findIndex(M=>M.userId===J.userId&&M.deviceId===J.deviceId);if(-1===z)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(z,1),J.dispose(),this.emit(o.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===J&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(o.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(J,z){return this.screenshareFeeds.find(M=>M.userId===J&&M.deviceId===z)}addScreenshareFeed(J){this.screenshareFeeds.push(J),this.emit(o.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(J,z){const M=this.screenshareFeeds.findIndex(L=>L.userId===J.userId&&L.deviceId===J.deviceId);if(-1===M)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(M,1,z),J.dispose(),this.emit(o.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(J){const z=this.screenshareFeeds.findIndex(M=>M.userId===J.userId&&M.deviceId===J.deviceId);if(-1===z)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(z,1),J.dispose(),this.emit(o.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===b.Ended)return void(this.participants=new Map);const J=new Map,z=Date.now(),M=this.state===b.Entered||this.enteredViaAnotherSession;let L=1/0;for(const j of this.getMemberStateEvents()){const C=this.room.getMember(j.getStateKey()),F=j.getContent(),N=(Array.isArray(F["m.calls"])?F["m.calls"]:[]).find(U=>U["m.call_id"]===this.groupCallId);let S=(Array.isArray(N?.["m.devices"])?N["m.devices"]:[]).filter(U=>"string"==typeof U.device_id&&"string"==typeof U.session_id&&"number"==typeof U.expires_ts&&U.expires_ts>z&&Array.isArray(U.feeds));if(!M&&C?.userId===this.client.getUserId()&&(S=S.filter(U=>U.device_id!==this.client.getDeviceId())),S.length>0&&"join"===C?.membership){const U=new Map;J.set(C,U);for(const W of S)U.set(W.device_id,{sessionId:W.session_id,screensharing:W.feeds.some(k=>k.purpose===f.SDPStreamMetadataPurpose.Screenshare)}),W.expires_ts<L&&(L=W.expires_ts)}}if(M){const j=this.room.getMember(this.client.getUserId());let C=J.get(j);void 0===C&&(C=new Map,J.set(j,C)),C.has(this.client.getDeviceId())||C.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(F=>F.purpose===f.SDPStreamMetadataPurpose.Screenshare)})}this.participants=J,L<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),L-z))}updateDevices(J,z=!1){var M;return R(this,void 0,void 0,function*(){const L=Date.now(),j=this.client.getUserId(),C=this.getMemberStateEvents(j),F=null!==(M=C?.getContent())&&void 0!==M?M:{},V=Array.isArray(F["m.calls"])?F["m.calls"]:[];let N=null;const T=[];for(const Q of V)Q["m.call_id"]===this.groupCallId?N=Q:T.push(Q);null===N&&(N={});const U=(Array.isArray(N["m.devices"])?N["m.devices"]:[]).filter(Q=>"string"==typeof Q.device_id&&"string"==typeof Q.session_id&&"number"==typeof Q.expires_ts&&Q.expires_ts>L&&Array.isArray(Q.feeds)),W=J(U);if(null===W)return;const k=[...T];W.length>0&&k.push(Object.assign(Object.assign({},N),{"m.call_id":this.groupCallId,"m.devices":W}));const D={"m.calls":k};yield this.client.sendStateEvent(this.room.roomId,v.EventType.GroupCallMemberPrefix,D,j,{keepAlive:z})})}addDeviceToMemberState(){return R(this,void 0,void 0,function*(){yield this.updateDevices(J=>[...J.filter(z=>z.device_id!==this.client.getDeviceId()),{device_id:this.client.getDeviceId(),session_id:this.client.getSessionId(),expires_ts:Date.now()+y,feeds:this.getLocalFeeds().map(z=>({purpose:z.purpose}))}])})}updateMemberState(){return R(this,void 0,void 0,function*(){null!==this.resendMemberStateTimer&&(clearInterval(this.resendMemberStateTimer),this.resendMemberStateTimer=null),this.state===b.Entered?(yield this.addDeviceToMemberState(),this.resendMemberStateTimer=setInterval(()=>R(this,void 0,void 0,function*(){u.logger.log("Resending call member state");try{yield this.addDeviceToMemberState()}catch(J){u.logger.error("Failed to resend call member state",J)}}),3*y/4)):yield this.updateDevices(J=>J.filter(z=>z.device_id!==this.client.getDeviceId()),!0)})}cleanMemberState(){return R(this,void 0,void 0,function*(){const{devices:J}=yield this.client.getDevices(),z=new Map(J.map(M=>[M.device_id,M]));yield this.updateDevices(M=>{const L=M.filter(j=>void 0!==z.get(j.device_id)?.last_seen_ts&&!(j.device_id===this.client.getDeviceId()&&this.state!==b.Entered&&!this.enteredViaAnotherSession));return L.length===M.length?null:L})})}}},{"../@types/event":299,"../ReEmitter":309,"../logger":365,"../models/room-state":380,"../models/typed-event-emitter":385,"../utils":402,"./call":404,"./callEventHandler":405,"./callEventTypes":406,"./callFeed":407,"./groupCallEventHandler":409}],409:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(c,i,r,s){return new(r||(r=Promise))(function(n,o){function h(p){try{e(s.next(p))}catch(b){o(b)}}function l(p){try{e(s.throw(p))}catch(b){o(b)}}function e(p){p.done?n(p.value):function t(n){return n instanceof r?n:new r(function(o){o(n)})}(p.value).then(h,l)}e((s=s.apply(c,i||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.GroupCallEventHandler=a.GroupCallEventHandlerEvent=void 0;const I=m("../client"),E=m("./groupCall"),_=m("../models/room-state"),d=m("../logger"),u=m("../@types/event"),g=m("../sync");var f,c;(c=f=a.GroupCallEventHandlerEvent||(a.GroupCallEventHandlerEvent={})).Incoming="GroupCall.incoming",c.Outgoing="GroupCall.outgoing",c.Ended="GroupCall.ended",c.Participants="GroupCall.participants",a.GroupCallEventHandler=class v{constructor(i){this.client=i,this.groupCalls=new Map,this.roomDeferreds=new Map,this.onRoomsChanged=r=>{this.createGroupCallForRoom(r)},this.onRoomStateChanged=(r,s)=>{if(r.getType()===u.EventType.GroupCallPrefix){const n=r.getStateKey(),o=r.getContent(),h=this.groupCalls.get(s.roomId);h||o["m.terminated"]?h&&h.groupCallId===n?o["m.terminated"]?h.terminate(!1):o["m.type"]!==h.type&&d.logger.warn(`The group call type changed for room: ${s.roomId}. Changing the group call type is currently unsupported.`):h&&h.groupCallId!==n&&d.logger.warn(`Multiple group calls detected for room: ${s.roomId}. Multiple group calls are currently unsupported.`):this.createGroupCallFromRoomStateEvent(r)}}}start(){return R(this,void 0,void 0,function*(){this.client.getSyncState()!==g.SyncState.Syncing&&(d.logger.debug("Waiting for client to start syncing..."),yield new Promise(r=>{const s=()=>{if(this.client.getSyncState()===g.SyncState.Syncing)return this.client.off(I.ClientEvent.Sync,s),r()};this.client.on(I.ClientEvent.Sync,s)}));const i=this.client.getRooms();for(const r of i)this.createGroupCallForRoom(r);this.client.on(I.ClientEvent.Room,this.onRoomsChanged),this.client.on(_.RoomStateEvent.Events,this.onRoomStateChanged)})}stop(){this.client.removeListener(_.RoomStateEvent.Events,this.onRoomStateChanged)}getRoomDeferred(i){let r=this.roomDeferreds.get(i);if(void 0===r){let s;r={prom:new Promise(t=>{s=t})},r.resolve=s,this.roomDeferreds.set(i,r)}return r}waitUntilRoomReadyForGroupCalls(i){return this.getRoomDeferred(i).prom}getGroupCallById(i){return[...this.groupCalls.values()].find(r=>r.groupCallId===i)}createGroupCallForRoom(i){const r=i.currentState.getStateEvents(u.EventType.GroupCallPrefix),s=r.sort((t,n)=>n.getTs()-t.getTs());for(const t of s)if(!t.getContent()["m.terminated"]){d.logger.debug(`Choosing group call ${t.getStateKey()} with TS ${t.getTs()} for room ${i.roomId} from ${r.length} possible calls.`),this.createGroupCallFromRoomStateEvent(t);break}d.logger.info("Group call event handler processed room",i.roomId),this.getRoomDeferred(i.roomId).resolve()}createGroupCallFromRoomStateEvent(i){const r=i.getRoomId(),s=i.getContent(),t=this.client.getRoom(r);if(!t)return void d.logger.warn(`Couldn't find room ${r} for GroupCall`);const n=i.getStateKey(),o=s["m.type"];if(!Object.values(E.GroupCallType).includes(o))return void d.logger.warn(`Received invalid group call type ${o} for room ${r}.`);const h=s["m.intent"];if(!Object.values(E.GroupCallIntent).includes(h))return void d.logger.warn(`Received invalid group call intent ${o} for room ${r}.`);const l=Boolean(s["io.element.ptt"]);let e;if(s?.dataChannelsEnabled&&s?.dataChannelOptions){const{ordered:b,maxPacketLifeTime:y,maxRetransmits:w,protocol:x}=s.dataChannelOptions;e={ordered:b,maxPacketLifeTime:y,maxRetransmits:w,protocol:x}}const p=new E.GroupCall(this.client,t,o,l,h,n,s?.dataChannelsEnabled,e);return this.groupCalls.set(t.roomId,p),this.client.emit(f.Incoming,p),p}}},{"../@types/event":299,"../client":313,"../logger":365,"../models/room-state":380,"../sync":400,"./groupCall":408}],410:[function(m,ie,a){"use strict";var R=this&&this.__awaiter||function(g,f,v,c){return new(v||(v=Promise))(function(r,s){function t(h){try{o(c.next(h))}catch(l){s(l)}}function n(h){try{o(c.throw(h))}catch(l){s(l)}}function o(h){h.done?r(h.value):function i(r){return r instanceof v?r:new v(function(s){s(r)})}(h.value).then(t,n)}o((c=c.apply(g,f||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0}),a.MediaHandler=a.MediaHandlerEvent=void 0;const I=m("../models/typed-event-emitter"),E=m("../webrtc/groupCall"),_=m("../logger");var d;(d=a.MediaHandlerEvent||(a.MediaHandlerEvent={})).LocalStreamsChanged="local_streams_changed",a.MediaHandler=class u extends I.TypedEventEmitter{constructor(f){super(),this.client=f,this.userMediaStreams=[],this.screensharingStreams=[]}restoreMediaSettings(f,v){this.audioInput=f,this.videoInput=v}setAudioInput(f){return R(this,void 0,void 0,function*(){_.logger.info("Setting audio input to",f),this.audioInput!==f&&(this.audioInput=f,yield this.updateLocalUsermediaStreams())})}setAudioSettings(f){return R(this,void 0,void 0,function*(){_.logger.info("Setting audio settings to",f),this.audioSettings=Object.assign({},f),yield this.updateLocalUsermediaStreams()})}setVideoInput(f){return R(this,void 0,void 0,function*(){_.logger.info("Setting video input to",f),this.videoInput!==f&&(this.videoInput=f,yield this.updateLocalUsermediaStreams())})}setMediaInputs(f,v){return R(this,void 0,void 0,function*(){_.logger.log(`mediaHandler setMediaInputs audioInput: ${f} videoInput: ${v}`),this.audioInput=f,this.videoInput=v,yield this.updateLocalUsermediaStreams()})}updateLocalUsermediaStreams(){return R(this,void 0,void 0,function*(){if(0===this.userMediaStreams.length)return;const f=new Map;for(const v of this.client.callEventHandler.calls.values())f.set(v.callId,{audio:v.hasLocalUserMediaAudioTrack,video:v.hasLocalUserMediaVideoTrack});for(const v of this.userMediaStreams){_.logger.log(`mediaHandler stopping all tracks for stream ${v.id}`);for(const c of v.getTracks())c.stop()}this.userMediaStreams=[],this.localUserMediaStream=void 0;for(const v of this.client.callEventHandler.calls.values()){if(v.callHasEnded()||!f.has(v.callId))continue;const{audio:c,video:i}=f.get(v.callId);_.logger.log(`mediaHandler updateLocalUsermediaStreams getUserMediaStream call ${v.callId}`);const r=yield this.getUserMediaStream(c,i);v.callHasEnded()||(yield v.updateLocalUsermediaStream(r))}for(const v of this.client.groupCallEventHandler.groupCalls.values()){if(!v.localCallFeed)continue;_.logger.log(`mediaHandler updateLocalUsermediaStreams getUserMediaStream groupCall ${v.groupCallId}`);const c=yield this.getUserMediaStream(!0,v.type===E.GroupCallType.Video);v.state!==E.GroupCallState.Ended&&(yield v.updateLocalUsermediaStream(c))}this.emit(d.LocalStreamsChanged)})}hasAudioDevice(){return R(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(v=>"audioinput"===v.kind).length>0})}hasVideoDevice(){return R(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(v=>"videoinput"===v.kind).length>0})}getUserMediaStream(f,v,c=!0){var i,r,s,t,n;return R(this,void 0,void 0,function*(){const o=f&&(yield this.hasAudioDevice()),h=v&&(yield this.hasVideoDevice());let l,e=!0;if(this.localUserMediaStream?(o&&(0===this.localUserMediaStream.getAudioTracks().length||(null===(r=null===(i=this.localUserMediaStream.getAudioTracks()[0])||void 0===i?void 0:i.getSettings())||void 0===r?void 0:r.deviceId)!==this.audioInput)&&(e=!1),h&&(0===this.localUserMediaStream.getVideoTracks().length||(null===(t=null===(s=this.localUserMediaStream.getVideoTracks()[0])||void 0===s?void 0:s.getSettings())||void 0===t?void 0:t.deviceId)!==this.videoInput)&&(e=!1)):e=!1,e){if(l=this.localUserMediaStream.clone(),_.logger.log(`mediaHandler clone userMediaStream ${null===(n=this.localUserMediaStream)||void 0===n?void 0:n.id} new stream ${l.id} shouldRequestAudio ${o} shouldRequestVideo ${h}`),!o)for(const p of l.getAudioTracks())l.removeTrack(p);if(!h)for(const p of l.getVideoTracks())l.removeTrack(p)}else{const p=this.getUserMediaContraints(o,h);l=yield navigator.mediaDevices.getUserMedia(p),_.logger.log(`mediaHandler getUserMediaStream streamId ${l.id} shouldRequestAudio ${o} shouldRequestVideo ${h}`,p);for(const b of l.getTracks()){const y=b.getSettings();"audio"===b.kind?this.audioInput=y.deviceId:"video"===b.kind&&(this.videoInput=y.deviceId)}c&&(this.localUserMediaStream=l)}return c&&this.userMediaStreams.push(l),this.emit(d.LocalStreamsChanged),l})}stopUserMediaStream(f){_.logger.log(`mediaHandler stopUserMediaStream stopping stream ${f.id}`);for(const c of f.getTracks())c.stop();const v=this.userMediaStreams.indexOf(f);-1!==v&&(_.logger.debug("Splicing usermedia stream out stream array",f.id),this.userMediaStreams.splice(v,1)),this.emit(d.LocalStreamsChanged),this.localUserMediaStream===f&&(this.localUserMediaStream=void 0)}getScreensharingStream(f={},v=!0){return R(this,void 0,void 0,function*(){let c;if(0===this.screensharingStreams.length){const i=this.getScreenshareContraints(f);f.desktopCapturerSourceId?(_.logger.debug("Getting screensharing stream using getUserMedia()",f),c=yield navigator.mediaDevices.getUserMedia(i)):(_.logger.debug("Getting screensharing stream using getDisplayMedia()",f),c=yield navigator.mediaDevices.getDisplayMedia(i))}else{const i=this.screensharingStreams[this.screensharingStreams.length-1];_.logger.log("Cloning screensharing stream",i.id),c=i.clone()}return v&&this.screensharingStreams.push(c),this.emit(d.LocalStreamsChanged),c})}stopScreensharingStream(f){_.logger.debug("Stopping screensharing stream",f.id);for(const c of f.getTracks())c.stop();const v=this.screensharingStreams.indexOf(f);-1!==v&&(_.logger.debug("Splicing screensharing stream out stream array",f.id),this.screensharingStreams.splice(v,1)),this.emit(d.LocalStreamsChanged)}stopAllStreams(){for(const f of this.userMediaStreams){_.logger.log(`mediaHandler stopAllStreams stopping stream ${f.id}`);for(const v of f.getTracks())v.stop()}for(const f of this.screensharingStreams)for(const v of f.getTracks())v.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(d.LocalStreamsChanged)}getUserMediaContraints(f,v){const c=!!navigator.webkitGetUserMedia;return{audio:!!f&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!v&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:c?{exact:640}:{ideal:640},height:c?{exact:360}:{ideal:360}}}}getScreenshareContraints(f){const{desktopCapturerSourceId:v,audio:c}=f;return v?(_.logger.debug("Using desktop capturer source",v),{audio:c??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:v}}}):(_.logger.debug("Not using desktop capturer source"),{audio:c??!1,video:!0})}}},{"../logger":365,"../models/typed-event-emitter":385,"../webrtc/groupCall":408}]},{},[312]);